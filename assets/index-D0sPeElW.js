const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/raw-in9isEBO.js","assets/basedecoder-B2c5_Eok.js","assets/lzw-_aCqfs4w.js","assets/jpeg-vtRboCKw.js","assets/deflate-B9JhHpvg.js","assets/pako.esm-Cram60i4.js","assets/packbits-DDWKfGV_.js","assets/lerc-CMEo9q1U.js","assets/webimage-DBgUwIbt.js"])))=>i.map(i=>d[i]);
function ND(t,e){for(var r=0;r<e.length;r++){const n=e[r];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in t)){const a=Object.getOwnPropertyDescriptor(n,i);a&&Object.defineProperty(t,i,a.get?a:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function r(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=r(i);fetch(i.href,a)}})();function xl(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var zw={exports:{}},Q_={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var VC;function BF(){if(VC)return Q_;VC=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function r(n,i,a){var c=null;if(a!==void 0&&(c=""+a),i.key!==void 0&&(c=""+i.key),"key"in i){a={};for(var s in i)s!=="key"&&(a[s]=i[s])}else a=i;return i=a.ref,{$$typeof:t,type:n,key:c,ref:i!==void 0?i:null,props:a}}return Q_.Fragment=e,Q_.jsx=r,Q_.jsxs=r,Q_}var $C;function NF(){return $C||($C=1,zw.exports=BF()),zw.exports}var Se=NF(),Fw={exports:{}},Fr={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var HC;function zF(){if(HC)return Fr;HC=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),c=Symbol.for("react.context"),s=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),_=Symbol.for("react.memo"),v=Symbol.for("react.lazy"),T=Symbol.for("react.activity"),M=Symbol.iterator;function O(pe){return pe===null||typeof pe!="object"?null:(pe=M&&pe[M]||pe["@@iterator"],typeof pe=="function"?pe:null)}var F={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},j=Object.assign,V={};function q(pe,Pe,rt){this.props=pe,this.context=Pe,this.refs=V,this.updater=rt||F}q.prototype.isReactComponent={},q.prototype.setState=function(pe,Pe){if(typeof pe!="object"&&typeof pe!="function"&&pe!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,pe,Pe,"setState")},q.prototype.forceUpdate=function(pe){this.updater.enqueueForceUpdate(this,pe,"forceUpdate")};function Y(){}Y.prototype=q.prototype;function X(pe,Pe,rt){this.props=pe,this.context=Pe,this.refs=V,this.updater=rt||F}var ae=X.prototype=new Y;ae.constructor=X,j(ae,q.prototype),ae.isPureReactComponent=!0;var ue=Array.isArray;function ge(){}var Le={H:null,A:null,T:null,S:null},qe=Object.prototype.hasOwnProperty;function Ze(pe,Pe,rt){var vt=rt.ref;return{$$typeof:t,type:pe,key:Pe,ref:vt!==void 0?vt:null,props:rt}}function _t(pe,Pe){return Ze(pe.type,Pe,pe.props)}function it(pe){return typeof pe=="object"&&pe!==null&&pe.$$typeof===t}function gt(pe){var Pe={"=":"=0",":":"=2"};return"$"+pe.replace(/[=:]/g,function(rt){return Pe[rt]})}var Lt=/\/+/g;function Ot(pe,Pe){return typeof pe=="object"&&pe!==null&&pe.key!=null?gt(""+pe.key):Pe.toString(36)}function Yt(pe){switch(pe.status){case"fulfilled":return pe.value;case"rejected":throw pe.reason;default:switch(typeof pe.status=="string"?pe.then(ge,ge):(pe.status="pending",pe.then(function(Pe){pe.status==="pending"&&(pe.status="fulfilled",pe.value=Pe)},function(Pe){pe.status==="pending"&&(pe.status="rejected",pe.reason=Pe)})),pe.status){case"fulfilled":return pe.value;case"rejected":throw pe.reason}}throw pe}function ce(pe,Pe,rt,vt,At){var $t=typeof pe;($t==="undefined"||$t==="boolean")&&(pe=null);var Gt=!1;if(pe===null)Gt=!0;else switch($t){case"bigint":case"string":case"number":Gt=!0;break;case"object":switch(pe.$$typeof){case t:case e:Gt=!0;break;case v:return Gt=pe._init,ce(Gt(pe._payload),Pe,rt,vt,At)}}if(Gt)return At=At(pe),Gt=vt===""?"."+Ot(pe,0):vt,ue(At)?(rt="",Gt!=null&&(rt=Gt.replace(Lt,"$&/")+"/"),ce(At,Pe,rt,"",function(Wt){return Wt})):At!=null&&(it(At)&&(At=_t(At,rt+(At.key==null||pe&&pe.key===At.key?"":(""+At.key).replace(Lt,"$&/")+"/")+Gt)),Pe.push(At)),1;Gt=0;var nr=vt===""?".":vt+":";if(ue(pe))for(var Et=0;Et<pe.length;Et++)vt=pe[Et],$t=nr+Ot(vt,Et),Gt+=ce(vt,Pe,rt,$t,At);else if(Et=O(pe),typeof Et=="function")for(pe=Et.call(pe),Et=0;!(vt=pe.next()).done;)vt=vt.value,$t=nr+Ot(vt,Et++),Gt+=ce(vt,Pe,rt,$t,At);else if($t==="object"){if(typeof pe.then=="function")return ce(Yt(pe),Pe,rt,vt,At);throw Pe=String(pe),Error("Objects are not valid as a React child (found: "+(Pe==="[object Object]"?"object with keys {"+Object.keys(pe).join(", ")+"}":Pe)+"). If you meant to render a collection of children, use an array instead.")}return Gt}function we(pe,Pe,rt){if(pe==null)return pe;var vt=[],At=0;return ce(pe,vt,"","",function($t){return Pe.call(rt,$t,At++)}),vt}function Re(pe){if(pe._status===-1){var Pe=pe._result;Pe=Pe(),Pe.then(function(rt){(pe._status===0||pe._status===-1)&&(pe._status=1,pe._result=rt)},function(rt){(pe._status===0||pe._status===-1)&&(pe._status=2,pe._result=rt)}),pe._status===-1&&(pe._status=0,pe._result=Pe)}if(pe._status===1)return pe._result.default;throw pe._result}var Ue=typeof reportError=="function"?reportError:function(pe){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Pe=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof pe=="object"&&pe!==null&&typeof pe.message=="string"?String(pe.message):String(pe),error:pe});if(!window.dispatchEvent(Pe))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",pe);return}console.error(pe)},at={map:we,forEach:function(pe,Pe,rt){we(pe,function(){Pe.apply(this,arguments)},rt)},count:function(pe){var Pe=0;return we(pe,function(){Pe++}),Pe},toArray:function(pe){return we(pe,function(Pe){return Pe})||[]},only:function(pe){if(!it(pe))throw Error("React.Children.only expected to receive a single React element child.");return pe}};return Fr.Activity=T,Fr.Children=at,Fr.Component=q,Fr.Fragment=r,Fr.Profiler=i,Fr.PureComponent=X,Fr.StrictMode=n,Fr.Suspense=g,Fr.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Le,Fr.__COMPILER_RUNTIME={__proto__:null,c:function(pe){return Le.H.useMemoCache(pe)}},Fr.cache=function(pe){return function(){return pe.apply(null,arguments)}},Fr.cacheSignal=function(){return null},Fr.cloneElement=function(pe,Pe,rt){if(pe==null)throw Error("The argument must be a React element, but you passed "+pe+".");var vt=j({},pe.props),At=pe.key;if(Pe!=null)for($t in Pe.key!==void 0&&(At=""+Pe.key),Pe)!qe.call(Pe,$t)||$t==="key"||$t==="__self"||$t==="__source"||$t==="ref"&&Pe.ref===void 0||(vt[$t]=Pe[$t]);var $t=arguments.length-2;if($t===1)vt.children=rt;else if(1<$t){for(var Gt=Array($t),nr=0;nr<$t;nr++)Gt[nr]=arguments[nr+2];vt.children=Gt}return Ze(pe.type,At,vt)},Fr.createContext=function(pe){return pe={$$typeof:c,_currentValue:pe,_currentValue2:pe,_threadCount:0,Provider:null,Consumer:null},pe.Provider=pe,pe.Consumer={$$typeof:a,_context:pe},pe},Fr.createElement=function(pe,Pe,rt){var vt,At={},$t=null;if(Pe!=null)for(vt in Pe.key!==void 0&&($t=""+Pe.key),Pe)qe.call(Pe,vt)&&vt!=="key"&&vt!=="__self"&&vt!=="__source"&&(At[vt]=Pe[vt]);var Gt=arguments.length-2;if(Gt===1)At.children=rt;else if(1<Gt){for(var nr=Array(Gt),Et=0;Et<Gt;Et++)nr[Et]=arguments[Et+2];At.children=nr}if(pe&&pe.defaultProps)for(vt in Gt=pe.defaultProps,Gt)At[vt]===void 0&&(At[vt]=Gt[vt]);return Ze(pe,$t,At)},Fr.createRef=function(){return{current:null}},Fr.forwardRef=function(pe){return{$$typeof:s,render:pe}},Fr.isValidElement=it,Fr.lazy=function(pe){return{$$typeof:v,_payload:{_status:-1,_result:pe},_init:Re}},Fr.memo=function(pe,Pe){return{$$typeof:_,type:pe,compare:Pe===void 0?null:Pe}},Fr.startTransition=function(pe){var Pe=Le.T,rt={};Le.T=rt;try{var vt=pe(),At=Le.S;At!==null&&At(rt,vt),typeof vt=="object"&&vt!==null&&typeof vt.then=="function"&&vt.then(ge,Ue)}catch($t){Ue($t)}finally{Pe!==null&&rt.types!==null&&(Pe.types=rt.types),Le.T=Pe}},Fr.unstable_useCacheRefresh=function(){return Le.H.useCacheRefresh()},Fr.use=function(pe){return Le.H.use(pe)},Fr.useActionState=function(pe,Pe,rt){return Le.H.useActionState(pe,Pe,rt)},Fr.useCallback=function(pe,Pe){return Le.H.useCallback(pe,Pe)},Fr.useContext=function(pe){return Le.H.useContext(pe)},Fr.useDebugValue=function(){},Fr.useDeferredValue=function(pe,Pe){return Le.H.useDeferredValue(pe,Pe)},Fr.useEffect=function(pe,Pe){return Le.H.useEffect(pe,Pe)},Fr.useEffectEvent=function(pe){return Le.H.useEffectEvent(pe)},Fr.useId=function(){return Le.H.useId()},Fr.useImperativeHandle=function(pe,Pe,rt){return Le.H.useImperativeHandle(pe,Pe,rt)},Fr.useInsertionEffect=function(pe,Pe){return Le.H.useInsertionEffect(pe,Pe)},Fr.useLayoutEffect=function(pe,Pe){return Le.H.useLayoutEffect(pe,Pe)},Fr.useMemo=function(pe,Pe){return Le.H.useMemo(pe,Pe)},Fr.useOptimistic=function(pe,Pe){return Le.H.useOptimistic(pe,Pe)},Fr.useReducer=function(pe,Pe,rt){return Le.H.useReducer(pe,Pe,rt)},Fr.useRef=function(pe){return Le.H.useRef(pe)},Fr.useState=function(pe){return Le.H.useState(pe)},Fr.useSyncExternalStore=function(pe,Pe,rt){return Le.H.useSyncExternalStore(pe,Pe,rt)},Fr.useTransition=function(){return Le.H.useTransition()},Fr.version="19.2.0",Fr}var WC;function ky(){return WC||(WC=1,Fw.exports=zF()),Fw.exports}var Q=ky();const FF=xl(Q),UF=ND({__proto__:null,default:FF},[Q]);var Uw={exports:{}},J_={},jw={exports:{}},Vw={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qC;function jF(){return qC||(qC=1,(function(t){function e(ce,we){var Re=ce.length;ce.push(we);e:for(;0<Re;){var Ue=Re-1>>>1,at=ce[Ue];if(0<i(at,we))ce[Ue]=we,ce[Re]=at,Re=Ue;else break e}}function r(ce){return ce.length===0?null:ce[0]}function n(ce){if(ce.length===0)return null;var we=ce[0],Re=ce.pop();if(Re!==we){ce[0]=Re;e:for(var Ue=0,at=ce.length,pe=at>>>1;Ue<pe;){var Pe=2*(Ue+1)-1,rt=ce[Pe],vt=Pe+1,At=ce[vt];if(0>i(rt,Re))vt<at&&0>i(At,rt)?(ce[Ue]=At,ce[vt]=Re,Ue=vt):(ce[Ue]=rt,ce[Pe]=Re,Ue=Pe);else if(vt<at&&0>i(At,Re))ce[Ue]=At,ce[vt]=Re,Ue=vt;else break e}}return we}function i(ce,we){var Re=ce.sortIndex-we.sortIndex;return Re!==0?Re:ce.id-we.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var a=performance;t.unstable_now=function(){return a.now()}}else{var c=Date,s=c.now();t.unstable_now=function(){return c.now()-s}}var g=[],_=[],v=1,T=null,M=3,O=!1,F=!1,j=!1,V=!1,q=typeof setTimeout=="function"?setTimeout:null,Y=typeof clearTimeout=="function"?clearTimeout:null,X=typeof setImmediate<"u"?setImmediate:null;function ae(ce){for(var we=r(_);we!==null;){if(we.callback===null)n(_);else if(we.startTime<=ce)n(_),we.sortIndex=we.expirationTime,e(g,we);else break;we=r(_)}}function ue(ce){if(j=!1,ae(ce),!F)if(r(g)!==null)F=!0,ge||(ge=!0,gt());else{var we=r(_);we!==null&&Yt(ue,we.startTime-ce)}}var ge=!1,Le=-1,qe=5,Ze=-1;function _t(){return V?!0:!(t.unstable_now()-Ze<qe)}function it(){if(V=!1,ge){var ce=t.unstable_now();Ze=ce;var we=!0;try{e:{F=!1,j&&(j=!1,Y(Le),Le=-1),O=!0;var Re=M;try{t:{for(ae(ce),T=r(g);T!==null&&!(T.expirationTime>ce&&_t());){var Ue=T.callback;if(typeof Ue=="function"){T.callback=null,M=T.priorityLevel;var at=Ue(T.expirationTime<=ce);if(ce=t.unstable_now(),typeof at=="function"){T.callback=at,ae(ce),we=!0;break t}T===r(g)&&n(g),ae(ce)}else n(g);T=r(g)}if(T!==null)we=!0;else{var pe=r(_);pe!==null&&Yt(ue,pe.startTime-ce),we=!1}}break e}finally{T=null,M=Re,O=!1}we=void 0}}finally{we?gt():ge=!1}}}var gt;if(typeof X=="function")gt=function(){X(it)};else if(typeof MessageChannel<"u"){var Lt=new MessageChannel,Ot=Lt.port2;Lt.port1.onmessage=it,gt=function(){Ot.postMessage(null)}}else gt=function(){q(it,0)};function Yt(ce,we){Le=q(function(){ce(t.unstable_now())},we)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(ce){ce.callback=null},t.unstable_forceFrameRate=function(ce){0>ce||125<ce?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):qe=0<ce?Math.floor(1e3/ce):5},t.unstable_getCurrentPriorityLevel=function(){return M},t.unstable_next=function(ce){switch(M){case 1:case 2:case 3:var we=3;break;default:we=M}var Re=M;M=we;try{return ce()}finally{M=Re}},t.unstable_requestPaint=function(){V=!0},t.unstable_runWithPriority=function(ce,we){switch(ce){case 1:case 2:case 3:case 4:case 5:break;default:ce=3}var Re=M;M=ce;try{return we()}finally{M=Re}},t.unstable_scheduleCallback=function(ce,we,Re){var Ue=t.unstable_now();switch(typeof Re=="object"&&Re!==null?(Re=Re.delay,Re=typeof Re=="number"&&0<Re?Ue+Re:Ue):Re=Ue,ce){case 1:var at=-1;break;case 2:at=250;break;case 5:at=1073741823;break;case 4:at=1e4;break;default:at=5e3}return at=Re+at,ce={id:v++,callback:we,priorityLevel:ce,startTime:Re,expirationTime:at,sortIndex:-1},Re>Ue?(ce.sortIndex=Re,e(_,ce),r(g)===null&&ce===r(_)&&(j?(Y(Le),Le=-1):j=!0,Yt(ue,Re-Ue))):(ce.sortIndex=at,e(g,ce),F||O||(F=!0,ge||(ge=!0,gt()))),ce},t.unstable_shouldYield=_t,t.unstable_wrapCallback=function(ce){var we=M;return function(){var Re=M;M=we;try{return ce.apply(this,arguments)}finally{M=Re}}}})(Vw)),Vw}var GC;function VF(){return GC||(GC=1,jw.exports=jF()),jw.exports}var $w={exports:{}},Pa={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var XC;function $F(){if(XC)return Pa;XC=1;var t=ky();function e(g){var _="https://react.dev/errors/"+g;if(1<arguments.length){_+="?args[]="+encodeURIComponent(arguments[1]);for(var v=2;v<arguments.length;v++)_+="&args[]="+encodeURIComponent(arguments[v])}return"Minified React error #"+g+"; visit "+_+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(){}var n={d:{f:r,r:function(){throw Error(e(522))},D:r,C:r,L:r,m:r,X:r,S:r,M:r},p:0,findDOMNode:null},i=Symbol.for("react.portal");function a(g,_,v){var T=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:T==null?null:""+T,children:g,containerInfo:_,implementation:v}}var c=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function s(g,_){if(g==="font")return"";if(typeof _=="string")return _==="use-credentials"?_:""}return Pa.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,Pa.createPortal=function(g,_){var v=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!_||_.nodeType!==1&&_.nodeType!==9&&_.nodeType!==11)throw Error(e(299));return a(g,_,null,v)},Pa.flushSync=function(g){var _=c.T,v=n.p;try{if(c.T=null,n.p=2,g)return g()}finally{c.T=_,n.p=v,n.d.f()}},Pa.preconnect=function(g,_){typeof g=="string"&&(_?(_=_.crossOrigin,_=typeof _=="string"?_==="use-credentials"?_:"":void 0):_=null,n.d.C(g,_))},Pa.prefetchDNS=function(g){typeof g=="string"&&n.d.D(g)},Pa.preinit=function(g,_){if(typeof g=="string"&&_&&typeof _.as=="string"){var v=_.as,T=s(v,_.crossOrigin),M=typeof _.integrity=="string"?_.integrity:void 0,O=typeof _.fetchPriority=="string"?_.fetchPriority:void 0;v==="style"?n.d.S(g,typeof _.precedence=="string"?_.precedence:void 0,{crossOrigin:T,integrity:M,fetchPriority:O}):v==="script"&&n.d.X(g,{crossOrigin:T,integrity:M,fetchPriority:O,nonce:typeof _.nonce=="string"?_.nonce:void 0})}},Pa.preinitModule=function(g,_){if(typeof g=="string")if(typeof _=="object"&&_!==null){if(_.as==null||_.as==="script"){var v=s(_.as,_.crossOrigin);n.d.M(g,{crossOrigin:v,integrity:typeof _.integrity=="string"?_.integrity:void 0,nonce:typeof _.nonce=="string"?_.nonce:void 0})}}else _==null&&n.d.M(g)},Pa.preload=function(g,_){if(typeof g=="string"&&typeof _=="object"&&_!==null&&typeof _.as=="string"){var v=_.as,T=s(v,_.crossOrigin);n.d.L(g,v,{crossOrigin:T,integrity:typeof _.integrity=="string"?_.integrity:void 0,nonce:typeof _.nonce=="string"?_.nonce:void 0,type:typeof _.type=="string"?_.type:void 0,fetchPriority:typeof _.fetchPriority=="string"?_.fetchPriority:void 0,referrerPolicy:typeof _.referrerPolicy=="string"?_.referrerPolicy:void 0,imageSrcSet:typeof _.imageSrcSet=="string"?_.imageSrcSet:void 0,imageSizes:typeof _.imageSizes=="string"?_.imageSizes:void 0,media:typeof _.media=="string"?_.media:void 0})}},Pa.preloadModule=function(g,_){if(typeof g=="string")if(_){var v=s(_.as,_.crossOrigin);n.d.m(g,{as:typeof _.as=="string"&&_.as!=="script"?_.as:void 0,crossOrigin:v,integrity:typeof _.integrity=="string"?_.integrity:void 0})}else n.d.m(g)},Pa.requestFormReset=function(g){n.d.r(g)},Pa.unstable_batchedUpdates=function(g,_){return g(_)},Pa.useFormState=function(g,_,v){return c.H.useFormState(g,_,v)},Pa.useFormStatus=function(){return c.H.useHostTransitionStatus()},Pa.version="19.2.0",Pa}var ZC;function zD(){if(ZC)return $w.exports;ZC=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),$w.exports=$F(),$w.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var YC;function HF(){if(YC)return J_;YC=1;var t=VF(),e=ky(),r=zD();function n(u){var p="https://react.dev/errors/"+u;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var b=2;b<arguments.length;b++)p+="&args[]="+encodeURIComponent(arguments[b])}return"Minified React error #"+u+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(u){return!(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)}function a(u){var p=u,b=u;if(u.alternate)for(;p.return;)p=p.return;else{u=p;do p=u,(p.flags&4098)!==0&&(b=p.return),u=p.return;while(u)}return p.tag===3?b:null}function c(u){if(u.tag===13){var p=u.memoizedState;if(p===null&&(u=u.alternate,u!==null&&(p=u.memoizedState)),p!==null)return p.dehydrated}return null}function s(u){if(u.tag===31){var p=u.memoizedState;if(p===null&&(u=u.alternate,u!==null&&(p=u.memoizedState)),p!==null)return p.dehydrated}return null}function g(u){if(a(u)!==u)throw Error(n(188))}function _(u){var p=u.alternate;if(!p){if(p=a(u),p===null)throw Error(n(188));return p!==u?null:u}for(var b=u,S=p;;){var k=b.return;if(k===null)break;var z=k.alternate;if(z===null){if(S=k.return,S!==null){b=S;continue}break}if(k.child===z.child){for(z=k.child;z;){if(z===b)return g(k),u;if(z===S)return g(k),p;z=z.sibling}throw Error(n(188))}if(b.return!==S.return)b=k,S=z;else{for(var J=!1,he=k.child;he;){if(he===b){J=!0,b=k,S=z;break}if(he===S){J=!0,S=k,b=z;break}he=he.sibling}if(!J){for(he=z.child;he;){if(he===b){J=!0,b=z,S=k;break}if(he===S){J=!0,S=z,b=k;break}he=he.sibling}if(!J)throw Error(n(189))}}if(b.alternate!==S)throw Error(n(190))}if(b.tag!==3)throw Error(n(188));return b.stateNode.current===b?u:p}function v(u){var p=u.tag;if(p===5||p===26||p===27||p===6)return u;for(u=u.child;u!==null;){if(p=v(u),p!==null)return p;u=u.sibling}return null}var T=Object.assign,M=Symbol.for("react.element"),O=Symbol.for("react.transitional.element"),F=Symbol.for("react.portal"),j=Symbol.for("react.fragment"),V=Symbol.for("react.strict_mode"),q=Symbol.for("react.profiler"),Y=Symbol.for("react.consumer"),X=Symbol.for("react.context"),ae=Symbol.for("react.forward_ref"),ue=Symbol.for("react.suspense"),ge=Symbol.for("react.suspense_list"),Le=Symbol.for("react.memo"),qe=Symbol.for("react.lazy"),Ze=Symbol.for("react.activity"),_t=Symbol.for("react.memo_cache_sentinel"),it=Symbol.iterator;function gt(u){return u===null||typeof u!="object"?null:(u=it&&u[it]||u["@@iterator"],typeof u=="function"?u:null)}var Lt=Symbol.for("react.client.reference");function Ot(u){if(u==null)return null;if(typeof u=="function")return u.$$typeof===Lt?null:u.displayName||u.name||null;if(typeof u=="string")return u;switch(u){case j:return"Fragment";case q:return"Profiler";case V:return"StrictMode";case ue:return"Suspense";case ge:return"SuspenseList";case Ze:return"Activity"}if(typeof u=="object")switch(u.$$typeof){case F:return"Portal";case X:return u.displayName||"Context";case Y:return(u._context.displayName||"Context")+".Consumer";case ae:var p=u.render;return u=u.displayName,u||(u=p.displayName||p.name||"",u=u!==""?"ForwardRef("+u+")":"ForwardRef"),u;case Le:return p=u.displayName||null,p!==null?p:Ot(u.type)||"Memo";case qe:p=u._payload,u=u._init;try{return Ot(u(p))}catch{}}return null}var Yt=Array.isArray,ce=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,we=r.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Re={pending:!1,data:null,method:null,action:null},Ue=[],at=-1;function pe(u){return{current:u}}function Pe(u){0>at||(u.current=Ue[at],Ue[at]=null,at--)}function rt(u,p){at++,Ue[at]=u.current,u.current=p}var vt=pe(null),At=pe(null),$t=pe(null),Gt=pe(null);function nr(u,p){switch(rt($t,p),rt(At,u),rt(vt,null),p.nodeType){case 9:case 11:u=(u=p.documentElement)&&(u=u.namespaceURI)?Zc(u):0;break;default:if(u=p.tagName,p=p.namespaceURI)p=Zc(p),u=V_(p,u);else switch(u){case"svg":u=1;break;case"math":u=2;break;default:u=0}}Pe(vt),rt(vt,u)}function Et(){Pe(vt),Pe(At),Pe($t)}function Wt(u){u.memoizedState!==null&&rt(Gt,u);var p=vt.current,b=V_(p,u.type);p!==b&&(rt(At,u),rt(vt,b))}function mr(u){At.current===u&&(Pe(vt),Pe(At)),Gt.current===u&&(Pe(Gt),St._currentValue=Re)}var Mt,Cr;function cr(u){if(Mt===void 0)try{throw Error()}catch(b){var p=b.stack.trim().match(/\n( *(at )?)/);Mt=p&&p[1]||"",Cr=-1<b.stack.indexOf(`
    at`)?" (<anonymous>)":-1<b.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Mt+u+Cr}var or=!1;function ur(u,p){if(!u||or)return"";or=!0;var b=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var S={DetermineComponentFrameRoot:function(){try{if(p){var It=function(){throw Error()};if(Object.defineProperty(It.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(It,[])}catch(pt){var ht=pt}Reflect.construct(u,[],It)}else{try{It.call()}catch(pt){ht=pt}u.call(It.prototype)}}else{try{throw Error()}catch(pt){ht=pt}(It=u())&&typeof It.catch=="function"&&It.catch(function(){})}}catch(pt){if(pt&&ht&&typeof pt.stack=="string")return[pt.stack,ht.stack]}return[null,null]}};S.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var k=Object.getOwnPropertyDescriptor(S.DetermineComponentFrameRoot,"name");k&&k.configurable&&Object.defineProperty(S.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var z=S.DetermineComponentFrameRoot(),J=z[0],he=z[1];if(J&&he){var Be=J.split(`
`),ut=he.split(`
`);for(k=S=0;S<Be.length&&!Be[S].includes("DetermineComponentFrameRoot");)S++;for(;k<ut.length&&!ut[k].includes("DetermineComponentFrameRoot");)k++;if(S===Be.length||k===ut.length)for(S=Be.length-1,k=ut.length-1;1<=S&&0<=k&&Be[S]!==ut[k];)k--;for(;1<=S&&0<=k;S--,k--)if(Be[S]!==ut[k]){if(S!==1||k!==1)do if(S--,k--,0>k||Be[S]!==ut[k]){var xt=`
`+Be[S].replace(" at new "," at ");return u.displayName&&xt.includes("<anonymous>")&&(xt=xt.replace("<anonymous>",u.displayName)),xt}while(1<=S&&0<=k);break}}}finally{or=!1,Error.prepareStackTrace=b}return(b=u?u.displayName||u.name:"")?cr(b):""}function gs(u,p){switch(u.tag){case 26:case 27:case 5:return cr(u.type);case 16:return cr("Lazy");case 13:return u.child!==p&&p!==null?cr("Suspense Fallback"):cr("Suspense");case 19:return cr("SuspenseList");case 0:case 15:return ur(u.type,!1);case 11:return ur(u.type.render,!1);case 1:return ur(u.type,!0);case 31:return cr("Activity");default:return""}}function Os(u){try{var p="",b=null;do p+=gs(u,b),b=u,u=u.return;while(u);return p}catch(S){return`
Error generating stack: `+S.message+`
`+S.stack}}var pa=Object.prototype.hasOwnProperty,Tl=t.unstable_scheduleCallback,Ya=t.unstable_cancelCallback,Sl=t.unstable_shouldYield,Al=t.unstable_requestPaint,Ei=t.unstable_now,El=t.unstable_getCurrentPriorityLevel,Oo=t.unstable_ImmediatePriority,ko=t.unstable_UserBlockingPriority,Do=t.unstable_NormalPriority,je=t.unstable_LowPriority,ie=t.unstable_IdlePriority,se=t.log,fe=t.unstable_setDisableYieldValue,Me=null,ke=null;function Fe(u){if(typeof se=="function"&&fe(u),ke&&typeof ke.setStrictMode=="function")try{ke.setStrictMode(Me,u)}catch{}}var Qe=Math.clz32?Math.clz32:kt,We=Math.log,dt=Math.LN2;function kt(u){return u>>>=0,u===0?32:31-(We(u)/dt|0)|0}var mt=256,Xt=262144,He=4194304;function fr(u){var p=u&42;if(p!==0)return p;switch(u&-u){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return u&261888;case 262144:case 524288:case 1048576:case 2097152:return u&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return u&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return u}}function Ir(u,p,b){var S=u.pendingLanes;if(S===0)return 0;var k=0,z=u.suspendedLanes,J=u.pingedLanes;u=u.warmLanes;var he=S&134217727;return he!==0?(S=he&~z,S!==0?k=fr(S):(J&=he,J!==0?k=fr(J):b||(b=he&~u,b!==0&&(k=fr(b))))):(he=S&~z,he!==0?k=fr(he):J!==0?k=fr(J):b||(b=S&~u,b!==0&&(k=fr(b)))),k===0?0:p!==0&&p!==k&&(p&z)===0&&(z=k&-k,b=p&-p,z>=b||z===32&&(b&4194048)!==0)?p:k}function er(u,p){return(u.pendingLanes&~(u.suspendedLanes&~u.pingedLanes)&p)===0}function Ar(u,p){switch(u){case 1:case 2:case 4:case 8:case 64:return p+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function mn(){var u=He;return He<<=1,(He&62914560)===0&&(He=4194304),u}function $n(u){for(var p=[],b=0;31>b;b++)p.push(u);return p}function Hn(u,p){u.pendingLanes|=p,p!==268435456&&(u.suspendedLanes=0,u.pingedLanes=0,u.warmLanes=0)}function Ci(u,p,b,S,k,z){var J=u.pendingLanes;u.pendingLanes=b,u.suspendedLanes=0,u.pingedLanes=0,u.warmLanes=0,u.expiredLanes&=b,u.entangledLanes&=b,u.errorRecoveryDisabledLanes&=b,u.shellSuspendCounter=0;var he=u.entanglements,Be=u.expirationTimes,ut=u.hiddenUpdates;for(b=J&~b;0<b;){var xt=31-Qe(b),It=1<<xt;he[xt]=0,Be[xt]=-1;var ht=ut[xt];if(ht!==null)for(ut[xt]=null,xt=0;xt<ht.length;xt++){var pt=ht[xt];pt!==null&&(pt.lane&=-536870913)}b&=~It}S!==0&&yi(u,S,0),z!==0&&k===0&&u.tag!==0&&(u.suspendedLanes|=z&~(J&~p))}function yi(u,p,b){u.pendingLanes|=p,u.suspendedLanes&=~p;var S=31-Qe(p);u.entangledLanes|=p,u.entanglements[S]=u.entanglements[S]|1073741824|b&261930}function yn(u,p){var b=u.entangledLanes|=p;for(u=u.entanglements;b;){var S=31-Qe(b),k=1<<S;k&p|u[S]&p&&(u[S]|=p),b&=~k}}function Jn(u,p){var b=p&-p;return b=(b&42)!==0?1:bt(b),(b&(u.suspendedLanes|p))!==0?0:b}function bt(u){switch(u){case 2:u=1;break;case 8:u=4;break;case 32:u=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:u=128;break;case 268435456:u=134217728;break;default:u=0}return u}function Wn(u){return u&=-u,2<u?8<u?(u&134217727)!==0?32:268435456:8:2}function ks(){var u=we.p;return u!==0?u:(u=window.event,u===void 0?32:Ea(u.type))}function Cl(u,p){var b=we.p;try{return we.p=u,p()}finally{we.p=b}}var qn=Math.random().toString(36).slice(2),Pt="__reactFiber$"+qn,lr="__reactProps$"+qn,_r="__reactContainer$"+qn,Pi="__reactEvents$"+qn,wc="__reactListeners$"+qn,Pl="__reactHandles$"+qn,xr="__reactResources$"+qn,Ml="__reactMarker$"+qn;function Ka(u){delete u[Pt],delete u[lr],delete u[Pi],delete u[wc],delete u[Pl]}function Lo(u){var p=u[Pt];if(p)return p;for(var b=u.parentNode;b;){if(p=b[_r]||b[Pt]){if(b=p.alternate,p.child!==null||b!==null&&b.child!==null)for(u=pb(u);u!==null;){if(b=u[Pt])return b;u=pb(u)}return p}u=b,b=u.parentNode}return null}function ms(u){if(u=u[Pt]||u[_r]){var p=u.tag;if(p===5||p===6||p===13||p===31||p===26||p===27||p===3)return u}return null}function Qa(u){var p=u.tag;if(p===5||p===26||p===27||p===6)return u.stateNode;throw Error(n(33))}function _n(u){var p=u[xr];return p||(p=u[xr]={hoistableStyles:new Map,hoistableScripts:new Map}),p}function ni(u){u[Ml]=!0}var ys=new Set,un={};function Il(u,p){Ja(u,p),Ja(u+"Capture",p)}function Ja(u,p){for(un[u]=p,u=0;u<p.length;u++)ys.add(p[u])}var qd=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Bo={},No={};function Gd(u){return pa.call(No,u)?!0:pa.call(Bo,u)?!1:qd.test(u)?No[u]=!0:(Bo[u]=!0,!1)}function fh(u,p,b){if(Gd(p))if(b===null)u.removeAttribute(p);else{switch(typeof b){case"undefined":case"function":case"symbol":u.removeAttribute(p);return;case"boolean":var S=p.toLowerCase().slice(0,5);if(S!=="data-"&&S!=="aria-"){u.removeAttribute(p);return}}u.setAttribute(p,""+b)}}function dh(u,p,b){if(b===null)u.removeAttribute(p);else{switch(typeof b){case"undefined":case"function":case"symbol":case"boolean":u.removeAttribute(p);return}u.setAttribute(p,""+b)}}function Ds(u,p,b,S){if(S===null)u.removeAttribute(b);else{switch(typeof S){case"undefined":case"function":case"symbol":case"boolean":u.removeAttribute(b);return}u.setAttributeNS(p,b,""+S)}}function ea(u){switch(typeof u){case"bigint":case"boolean":case"number":case"string":case"undefined":return u;case"object":return u;default:return""}}function $g(u){var p=u.type;return(u=u.nodeName)&&u.toLowerCase()==="input"&&(p==="checkbox"||p==="radio")}function Xy(u,p,b){var S=Object.getOwnPropertyDescriptor(u.constructor.prototype,p);if(!u.hasOwnProperty(p)&&typeof S<"u"&&typeof S.get=="function"&&typeof S.set=="function"){var k=S.get,z=S.set;return Object.defineProperty(u,p,{configurable:!0,get:function(){return k.call(this)},set:function(J){b=""+J,z.call(this,J)}}),Object.defineProperty(u,p,{enumerable:S.enumerable}),{getValue:function(){return b},setValue:function(J){b=""+J},stopTracking:function(){u._valueTracker=null,delete u[p]}}}}function Xd(u){if(!u._valueTracker){var p=$g(u)?"checked":"value";u._valueTracker=Xy(u,p,""+u[p])}}function Rf(u){if(!u)return!1;var p=u._valueTracker;if(!p)return!0;var b=p.getValue(),S="";return u&&(S=$g(u)?u.checked?"true":"false":u.value),u=S,u!==b?(p.setValue(u),!0):!1}function zo(u){if(u=u||(typeof document<"u"?document:void 0),typeof u>"u")return null;try{return u.activeElement||u.body}catch{return u.body}}var Zd=/[\n"\\]/g;function Ls(u){return u.replace(Zd,function(p){return"\\"+p.charCodeAt(0).toString(16)+" "})}function Rl(u,p,b,S,k,z,J,he){u.name="",J!=null&&typeof J!="function"&&typeof J!="symbol"&&typeof J!="boolean"?u.type=J:u.removeAttribute("type"),p!=null?J==="number"?(p===0&&u.value===""||u.value!=p)&&(u.value=""+ea(p)):u.value!==""+ea(p)&&(u.value=""+ea(p)):J!=="submit"&&J!=="reset"||u.removeAttribute("value"),p!=null?ph(u,J,ea(p)):b!=null?ph(u,J,ea(b)):S!=null&&u.removeAttribute("value"),k==null&&z!=null&&(u.defaultChecked=!!z),k!=null&&(u.checked=k&&typeof k!="function"&&typeof k!="symbol"),he!=null&&typeof he!="function"&&typeof he!="symbol"&&typeof he!="boolean"?u.name=""+ea(he):u.removeAttribute("name")}function Of(u,p,b,S,k,z,J,he){if(z!=null&&typeof z!="function"&&typeof z!="symbol"&&typeof z!="boolean"&&(u.type=z),p!=null||b!=null){if(!(z!=="submit"&&z!=="reset"||p!=null)){Xd(u);return}b=b!=null?""+ea(b):"",p=p!=null?""+ea(p):b,he||p===u.value||(u.value=p),u.defaultValue=p}S=S??k,S=typeof S!="function"&&typeof S!="symbol"&&!!S,u.checked=he?u.checked:!!S,u.defaultChecked=!!S,J!=null&&typeof J!="function"&&typeof J!="symbol"&&typeof J!="boolean"&&(u.name=J),Xd(u)}function ph(u,p,b){p==="number"&&zo(u.ownerDocument)===u||u.defaultValue===""+b||(u.defaultValue=""+b)}function hu(u,p,b,S){if(u=u.options,p){p={};for(var k=0;k<b.length;k++)p["$"+b[k]]=!0;for(b=0;b<u.length;b++)k=p.hasOwnProperty("$"+u[b].value),u[b].selected!==k&&(u[b].selected=k),k&&S&&(u[b].defaultSelected=!0)}else{for(b=""+ea(b),p=null,k=0;k<u.length;k++){if(u[k].value===b){u[k].selected=!0,S&&(u[k].defaultSelected=!0);return}p!==null||u[k].disabled||(p=u[k])}p!==null&&(p.selected=!0)}}function Tc(u,p,b){if(p!=null&&(p=""+ea(p),p!==u.value&&(u.value=p),b==null)){u.defaultValue!==p&&(u.defaultValue=p);return}u.defaultValue=b!=null?""+ea(b):""}function fu(u,p,b,S){if(p==null){if(S!=null){if(b!=null)throw Error(n(92));if(Yt(S)){if(1<S.length)throw Error(n(93));S=S[0]}b=S}b==null&&(b=""),p=b}b=ea(p),u.defaultValue=b,S=u.textContent,S===b&&S!==""&&S!==null&&(u.value=S),Xd(u)}function ts(u,p){if(p){var b=u.firstChild;if(b&&b===u.lastChild&&b.nodeType===3){b.nodeValue=p;return}}u.textContent=p}var Dr=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ol(u,p,b){var S=p.indexOf("--")===0;b==null||typeof b=="boolean"||b===""?S?u.setProperty(p,""):p==="float"?u.cssFloat="":u[p]="":S?u.setProperty(p,b):typeof b!="number"||b===0||Dr.has(p)?p==="float"?u.cssFloat=b:u[p]=(""+b).trim():u[p]=b+"px"}function Fo(u,p,b){if(p!=null&&typeof p!="object")throw Error(n(62));if(u=u.style,b!=null){for(var S in b)!b.hasOwnProperty(S)||p!=null&&p.hasOwnProperty(S)||(S.indexOf("--")===0?u.setProperty(S,""):S==="float"?u.cssFloat="":u[S]="");for(var k in p)S=p[k],p.hasOwnProperty(k)&&b[k]!==S&&Ol(u,k,S)}else for(var z in p)p.hasOwnProperty(z)&&Ol(u,z,p[z])}function La(u){if(u.indexOf("-")===-1)return!1;switch(u){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Sc=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Lr=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function eo(u){return Lr.test(""+u)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":u}function ga(){}var du=null;function Yi(u){return u=u.target||u.srcElement||window,u.correspondingUseElement&&(u=u.correspondingUseElement),u.nodeType===3?u.parentNode:u}var Gn=null,_i=null;function ii(u){var p=ms(u);if(p&&(u=p.stateNode)){var b=u[lr]||null;e:switch(u=p.stateNode,p.type){case"input":if(Rl(u,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name),p=b.name,b.type==="radio"&&p!=null){for(b=u;b.parentNode;)b=b.parentNode;for(b=b.querySelectorAll('input[name="'+Ls(""+p)+'"][type="radio"]'),p=0;p<b.length;p++){var S=b[p];if(S!==u&&S.form===u.form){var k=S[lr]||null;if(!k)throw Error(n(90));Rl(S,k.value,k.defaultValue,k.defaultValue,k.checked,k.defaultChecked,k.type,k.name)}}for(p=0;p<b.length;p++)S=b[p],S.form===u.form&&Rf(S)}break e;case"textarea":Tc(u,b.value,b.defaultValue);break e;case"select":p=b.value,p!=null&&hu(u,!!b.multiple,p,!1)}}}var nn=!1;function Yd(u,p,b){if(nn)return u(p,b);nn=!0;try{var S=u(p);return S}finally{if(nn=!1,(Gn!==null||_i!==null)&&(Em(),Gn&&(p=Gn,u=_i,_i=Gn=null,ii(p),u)))for(p=0;p<u.length;p++)ii(u[p])}}function Mi(u,p){var b=u.stateNode;if(b===null)return null;var S=b[lr]||null;if(S===null)return null;b=S[p];e:switch(p){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(S=!S.disabled)||(u=u.type,S=!(u==="button"||u==="input"||u==="select"||u==="textarea")),u=!S;break e;default:u=!1}if(u)return null;if(b&&typeof b!="function")throw Error(n(231,p,typeof b));return b}var si=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),zi=!1;if(si)try{var sn={};Object.defineProperty(sn,"passive",{get:function(){zi=!0}}),window.addEventListener("test",sn,sn),window.removeEventListener("test",sn,sn)}catch{zi=!1}var Bs=null,hr=null,yr=null;function to(){if(yr)return yr;var u,p=hr,b=p.length,S,k="value"in Bs?Bs.value:Bs.textContent,z=k.length;for(u=0;u<b&&p[u]===k[u];u++);var J=b-u;for(S=1;S<=J&&p[b-S]===k[z-S];S++);return yr=k.slice(u,1<S?1-S:void 0)}function zr(u){var p=u.keyCode;return"charCode"in u?(u=u.charCode,u===0&&p===13&&(u=13)):u=p,u===10&&(u=13),32<=u||u===13?u:0}function rs(){return!0}function Ba(){return!1}function Xn(u){function p(b,S,k,z,J){this._reactName=b,this._targetInst=k,this.type=S,this.nativeEvent=z,this.target=J,this.currentTarget=null;for(var he in u)u.hasOwnProperty(he)&&(b=u[he],this[he]=b?b(z):z[he]);return this.isDefaultPrevented=(z.defaultPrevented!=null?z.defaultPrevented:z.returnValue===!1)?rs:Ba,this.isPropagationStopped=Ba,this}return T(p.prototype,{preventDefault:function(){this.defaultPrevented=!0;var b=this.nativeEvent;b&&(b.preventDefault?b.preventDefault():typeof b.returnValue!="unknown"&&(b.returnValue=!1),this.isDefaultPrevented=rs)},stopPropagation:function(){var b=this.nativeEvent;b&&(b.stopPropagation?b.stopPropagation():typeof b.cancelBubble!="unknown"&&(b.cancelBubble=!0),this.isPropagationStopped=rs)},persist:function(){},isPersistent:rs}),p}var ro={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(u){return u.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},pu=Xn(ro),no=T({},ro,{view:0,detail:0}),gh=Xn(no),gu,mu,kl,Ns=T({},no,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ec,button:0,buttons:0,relatedTarget:function(u){return u.relatedTarget===void 0?u.fromElement===u.srcElement?u.toElement:u.fromElement:u.relatedTarget},movementX:function(u){return"movementX"in u?u.movementX:(u!==kl&&(kl&&u.type==="mousemove"?(gu=u.screenX-kl.screenX,mu=u.screenY-kl.screenY):mu=gu=0,kl=u),gu)},movementY:function(u){return"movementY"in u?u.movementY:mu}}),Ii=Xn(Ns),yu=T({},Ns,{dataTransfer:0}),mh=Xn(yu),Ac=T({},no,{relatedTarget:0}),zn=Xn(Ac),Hg=T({},ro,{animationName:0,elapsedTime:0,pseudoElement:0}),yh=Xn(Hg),Kd=T({},ro,{clipboardData:function(u){return"clipboardData"in u?u.clipboardData:window.clipboardData}}),Zy=Xn(Kd),_u=T({},ro,{data:0}),Fi=Xn(_u),_h={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},io={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},vh={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function bh(u){var p=this.nativeEvent;return p.getModifierState?p.getModifierState(u):(u=vh[u])?!!p[u]:!1}function Ec(){return bh}var ns=T({},no,{key:function(u){if(u.key){var p=_h[u.key]||u.key;if(p!=="Unidentified")return p}return u.type==="keypress"?(u=zr(u),u===13?"Enter":String.fromCharCode(u)):u.type==="keydown"||u.type==="keyup"?io[u.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ec,charCode:function(u){return u.type==="keypress"?zr(u):0},keyCode:function(u){return u.type==="keydown"||u.type==="keyup"?u.keyCode:0},which:function(u){return u.type==="keypress"?zr(u):u.type==="keydown"||u.type==="keyup"?u.keyCode:0}}),Wg=Xn(ns),kf=T({},Ns,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),qg=Xn(kf),Qd=T({},no,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ec}),Yy=Xn(Qd),Ky=T({},ro,{propertyName:0,elapsedTime:0,pseudoElement:0}),Df=Xn(Ky),Jd=T({},Ns,{deltaX:function(u){return"deltaX"in u?u.deltaX:"wheelDeltaX"in u?-u.wheelDeltaX:0},deltaY:function(u){return"deltaY"in u?u.deltaY:"wheelDeltaY"in u?-u.wheelDeltaY:"wheelDelta"in u?-u.wheelDelta:0},deltaZ:0,deltaMode:0}),Cc=Xn(Jd),ep=T({},ro,{newState:0,oldState:0}),Lf=Xn(ep),Na=[9,13,27,32],tp=si&&"CompositionEvent"in window,Dl=null;si&&"documentMode"in document&&(Dl=document.documentMode);var xh=si&&"TextEvent"in window&&!Dl,vu=si&&(!tp||Dl&&8<Dl&&11>=Dl),Gg=" ",wh=!1;function Xg(u,p){switch(u){case"keyup":return Na.indexOf(p.keyCode)!==-1;case"keydown":return p.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ll(u){return u=u.detail,typeof u=="object"&&"data"in u?u.data:null}var Pc=!1;function rp(u,p){switch(u){case"compositionend":return Ll(p);case"keypress":return p.which!==32?null:(wh=!0,Gg);case"textInput":return u=p.data,u===Gg&&wh?null:u;default:return null}}function Qy(u,p){if(Pc)return u==="compositionend"||!tp&&Xg(u,p)?(u=to(),yr=hr=Bs=null,Pc=!1,u):null;switch(u){case"paste":return null;case"keypress":if(!(p.ctrlKey||p.altKey||p.metaKey)||p.ctrlKey&&p.altKey){if(p.char&&1<p.char.length)return p.char;if(p.which)return String.fromCharCode(p.which)}return null;case"compositionend":return vu&&p.locale!=="ko"?null:p.data;default:return null}}var Zg={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Bf(u){var p=u&&u.nodeName&&u.nodeName.toLowerCase();return p==="input"?!!Zg[u.type]:p==="textarea"}function np(u,p,b,S){Gn?_i?_i.push(S):_i=[S]:Gn=S,p=gd(p,"onChange"),0<p.length&&(b=new pu("onChange","change",null,b,S),u.push({event:b,listeners:p}))}var Bl=null,bu=null;function Yg(u){sb(u,0)}function so(u){var p=Qa(u);if(Rf(p))return u}function Nf(u,p){if(u==="change")return p}var zf=!1;if(si){var Mc;if(si){var ip="oninput"in document;if(!ip){var xu=document.createElement("div");xu.setAttribute("oninput","return;"),ip=typeof xu.oninput=="function"}Mc=ip}else Mc=!1;zf=Mc&&(!document.documentMode||9<document.documentMode)}function sp(){Bl&&(Bl.detachEvent("onpropertychange",Kg),bu=Bl=null)}function Kg(u){if(u.propertyName==="value"&&so(bu)){var p=[];np(p,bu,u,Yi(u)),Yd(Yg,p)}}function Qg(u,p,b){u==="focusin"?(sp(),Bl=p,bu=b,Bl.attachEvent("onpropertychange",Kg)):u==="focusout"&&sp()}function Jg(u){if(u==="selectionchange"||u==="keyup"||u==="keydown")return so(bu)}function ap(u,p){if(u==="click")return so(p)}function op(u,p){if(u==="input"||u==="change")return so(p)}function em(u,p){return u===p&&(u!==0||1/u===1/p)||u!==u&&p!==p}var is=typeof Object.is=="function"?Object.is:em;function ta(u,p){if(is(u,p))return!0;if(typeof u!="object"||u===null||typeof p!="object"||p===null)return!1;var b=Object.keys(u),S=Object.keys(p);if(b.length!==S.length)return!1;for(S=0;S<b.length;S++){var k=b[S];if(!pa.call(p,k)||!is(u[k],p[k]))return!1}return!0}function Gr(u){for(;u&&u.firstChild;)u=u.firstChild;return u}function Ff(u,p){var b=Gr(u);u=0;for(var S;b;){if(b.nodeType===3){if(S=u+b.textContent.length,u<=p&&S>=p)return{node:b,offset:p-u};u=S}e:{for(;b;){if(b.nextSibling){b=b.nextSibling;break e}b=b.parentNode}b=void 0}b=Gr(b)}}function Uf(u,p){return u&&p?u===p?!0:u&&u.nodeType===3?!1:p&&p.nodeType===3?Uf(u,p.parentNode):"contains"in u?u.contains(p):u.compareDocumentPosition?!!(u.compareDocumentPosition(p)&16):!1:!1}function lp(u){u=u!=null&&u.ownerDocument!=null&&u.ownerDocument.defaultView!=null?u.ownerDocument.defaultView:window;for(var p=zo(u.document);p instanceof u.HTMLIFrameElement;){try{var b=typeof p.contentWindow.location.href=="string"}catch{b=!1}if(b)u=p.contentWindow;else break;p=zo(u.document)}return p}function Th(u){var p=u&&u.nodeName&&u.nodeName.toLowerCase();return p&&(p==="input"&&(u.type==="text"||u.type==="search"||u.type==="tel"||u.type==="url"||u.type==="password")||p==="textarea"||u.contentEditable==="true")}var Ic=si&&"documentMode"in document&&11>=document.documentMode,Nl=null,cp=null,Sh=null,up=!1;function tm(u,p,b){var S=b.window===b?b.document:b.nodeType===9?b:b.ownerDocument;up||Nl==null||Nl!==zo(S)||(S=Nl,"selectionStart"in S&&Th(S)?S={start:S.selectionStart,end:S.selectionEnd}:(S=(S.ownerDocument&&S.ownerDocument.defaultView||window).getSelection(),S={anchorNode:S.anchorNode,anchorOffset:S.anchorOffset,focusNode:S.focusNode,focusOffset:S.focusOffset}),Sh&&ta(Sh,S)||(Sh=S,S=gd(cp,"onSelect"),0<S.length&&(p=new pu("onSelect","select",null,p,b),u.push({event:p,listeners:S}),p.target=Nl)))}function zl(u,p){var b={};return b[u.toLowerCase()]=p.toLowerCase(),b["Webkit"+u]="webkit"+p,b["Moz"+u]="moz"+p,b}var wu={animationend:zl("Animation","AnimationEnd"),animationiteration:zl("Animation","AnimationIteration"),animationstart:zl("Animation","AnimationStart"),transitionrun:zl("Transition","TransitionRun"),transitionstart:zl("Transition","TransitionStart"),transitioncancel:zl("Transition","TransitionCancel"),transitionend:zl("Transition","TransitionEnd")},jf={},Ah={};si&&(Ah=document.createElement("div").style,"AnimationEvent"in window||(delete wu.animationend.animation,delete wu.animationiteration.animation,delete wu.animationstart.animation),"TransitionEvent"in window||delete wu.transitionend.transition);function ao(u){if(jf[u])return jf[u];if(!wu[u])return u;var p=wu[u],b;for(b in p)if(p.hasOwnProperty(b)&&b in Ah)return jf[u]=p[b];return u}var Eh=ao("animationend"),Vf=ao("animationiteration"),Fl=ao("animationstart"),Ch=ao("transitionrun"),Tu=ao("transitionstart"),ma=ao("transitioncancel"),hp=ao("transitionend"),fp=new Map,Ph="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Ph.push("scrollEnd");function Ki(u,p){fp.set(u,p),Il(p,[u])}var Rc=typeof reportError=="function"?reportError:function(u){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var p=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof u=="object"&&u!==null&&typeof u.message=="string"?String(u.message):String(u),error:u});if(!window.dispatchEvent(p))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",u);return}console.error(u)},_s=[],oo=0,Su=0;function Mh(){for(var u=oo,p=Su=oo=0;p<u;){var b=_s[p];_s[p++]=null;var S=_s[p];_s[p++]=null;var k=_s[p];_s[p++]=null;var z=_s[p];if(_s[p++]=null,S!==null&&k!==null){var J=S.pending;J===null?k.next=k:(k.next=J.next,J.next=k),S.pending=k}z!==0&&$f(b,k,z)}}function Uo(u,p,b,S){_s[oo++]=u,_s[oo++]=p,_s[oo++]=b,_s[oo++]=S,Su|=S,u.lanes|=S,u=u.alternate,u!==null&&(u.lanes|=S)}function lo(u,p,b,S){return Uo(u,p,b,S),Rr(u)}function Ul(u,p){return Uo(u,null,null,p),Rr(u)}function $f(u,p,b){u.lanes|=b;var S=u.alternate;S!==null&&(S.lanes|=b);for(var k=!1,z=u.return;z!==null;)z.childLanes|=b,S=z.alternate,S!==null&&(S.childLanes|=b),z.tag===22&&(u=z.stateNode,u===null||u._visibility&1||(k=!0)),u=z,z=z.return;return u.tag===3?(z=u.stateNode,k&&p!==null&&(k=31-Qe(b),u=z.hiddenUpdates,S=u[k],S===null?u[k]=[p]:S.push(p),p.lane=b|536870912),z):null}function Rr(u){if(50<Yh)throw Yh=0,Hu=null,Error(n(185));for(var p=u.return;p!==null;)u=p,p=u.return;return u.tag===3?u.stateNode:null}var co={};function Jy(u,p,b,S){this.tag=u,this.key=b,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=p,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=S,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zs(u,p,b,S){return new Jy(u,p,b,S)}function uo(u){return u=u.prototype,!(!u||!u.isReactComponent)}function ho(u,p){var b=u.alternate;return b===null?(b=zs(u.tag,p,u.key,u.mode),b.elementType=u.elementType,b.type=u.type,b.stateNode=u.stateNode,b.alternate=u,u.alternate=b):(b.pendingProps=p,b.type=u.type,b.flags=0,b.subtreeFlags=0,b.deletions=null),b.flags=u.flags&65011712,b.childLanes=u.childLanes,b.lanes=u.lanes,b.child=u.child,b.memoizedProps=u.memoizedProps,b.memoizedState=u.memoizedState,b.updateQueue=u.updateQueue,p=u.dependencies,b.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext},b.sibling=u.sibling,b.index=u.index,b.ref=u.ref,b.refCleanup=u.refCleanup,b}function rm(u,p){u.flags&=65011714;var b=u.alternate;return b===null?(u.childLanes=0,u.lanes=p,u.child=null,u.subtreeFlags=0,u.memoizedProps=null,u.memoizedState=null,u.updateQueue=null,u.dependencies=null,u.stateNode=null):(u.childLanes=b.childLanes,u.lanes=b.lanes,u.child=b.child,u.subtreeFlags=0,u.deletions=null,u.memoizedProps=b.memoizedProps,u.memoizedState=b.memoizedState,u.updateQueue=b.updateQueue,u.type=b.type,p=b.dependencies,u.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),u}function Ih(u,p,b,S,k,z){var J=0;if(S=u,typeof u=="function")uo(u)&&(J=1);else if(typeof u=="string")J=ne(u,b,vt.current)?26:u==="html"||u==="head"||u==="body"?27:5;else e:switch(u){case Ze:return u=zs(31,b,p,k),u.elementType=Ze,u.lanes=z,u;case j:return Oc(b.children,k,z,p);case V:J=8,k|=24;break;case q:return u=zs(12,b,p,k|2),u.elementType=q,u.lanes=z,u;case ue:return u=zs(13,b,p,k),u.elementType=ue,u.lanes=z,u;case ge:return u=zs(19,b,p,k),u.elementType=ge,u.lanes=z,u;default:if(typeof u=="object"&&u!==null)switch(u.$$typeof){case X:J=10;break e;case Y:J=9;break e;case ae:J=11;break e;case Le:J=14;break e;case qe:J=16,S=null;break e}J=29,b=Error(n(130,u===null?"null":typeof u,"")),S=null}return p=zs(J,b,p,k),p.elementType=u,p.type=S,p.lanes=z,p}function Oc(u,p,b,S){return u=zs(7,u,S,p),u.lanes=b,u}function Rh(u,p,b){return u=zs(6,u,null,p),u.lanes=b,u}function Oh(u){var p=zs(18,null,null,0);return p.stateNode=u,p}function kc(u,p,b){return p=zs(4,u.children!==null?u.children:[],u.key,p),p.lanes=b,p.stateNode={containerInfo:u.containerInfo,pendingChildren:null,implementation:u.implementation},p}var Au=new WeakMap;function Fs(u,p){if(typeof u=="object"&&u!==null){var b=Au.get(u);return b!==void 0?b:(p={value:u,source:p,stack:Os(p)},Au.set(u,p),p)}return{value:u,source:p,stack:Os(p)}}var Dc=[],fo=0,jl=null,jo=0,Ui=[],ss=0,po=null,as=1,ya="";function ra(u,p){Dc[fo++]=jo,Dc[fo++]=jl,jl=u,jo=p}function kh(u,p,b){Ui[ss++]=as,Ui[ss++]=ya,Ui[ss++]=po,po=u;var S=as;u=ya;var k=32-Qe(S)-1;S&=~(1<<k),b+=1;var z=32-Qe(p)+k;if(30<z){var J=k-k%5;z=(S&(1<<J)-1).toString(32),S>>=J,k-=J,as=1<<32-Qe(p)+k|b<<k|S,ya=z+u}else as=1<<z|b<<k|S,ya=u}function Dh(u){u.return!==null&&(ra(u,1),kh(u,1,0))}function Hf(u){for(;u===jl;)jl=Dc[--fo],Dc[fo]=null,jo=Dc[--fo],Dc[fo]=null;for(;u===po;)po=Ui[--ss],Ui[ss]=null,ya=Ui[--ss],Ui[ss]=null,as=Ui[--ss],Ui[ss]=null}function dp(u,p){Ui[ss++]=as,Ui[ss++]=ya,Ui[ss++]=po,as=p.id,ya=p.overflow,po=u}var vi=null,vn=null,$r=!1,go=null,Hr=!1,Vo=Error(n(519));function bi(u){var p=Error(n(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Ho(Fs(p,u)),Vo}function Lh(u){var p=u.stateNode,b=u.type,S=u.memoizedProps;switch(p[Pt]=u,p[lr]=S,b){case"dialog":jr("cancel",p),jr("close",p);break;case"iframe":case"object":case"embed":jr("load",p);break;case"video":case"audio":for(b=0;b<Wp.length;b++)jr(Wp[b],p);break;case"source":jr("error",p);break;case"img":case"image":case"link":jr("error",p),jr("load",p);break;case"details":jr("toggle",p);break;case"input":jr("invalid",p),Of(p,S.value,S.defaultValue,S.checked,S.defaultChecked,S.type,S.name,!0);break;case"select":jr("invalid",p);break;case"textarea":jr("invalid",p),fu(p,S.value,S.defaultValue,S.children)}b=S.children,typeof b!="string"&&typeof b!="number"&&typeof b!="bigint"||p.textContent===""+b||S.suppressHydrationWarning===!0||Aa(p.textContent,b)?(S.popover!=null&&(jr("beforetoggle",p),jr("toggle",p)),S.onScroll!=null&&jr("scroll",p),S.onScrollEnd!=null&&jr("scrollend",p),S.onClick!=null&&(p.onclick=ga),p=!0):p=!1,p||bi(u,!0)}function Bh(u){for(vi=u.return;vi;)switch(vi.tag){case 5:case 31:case 13:Hr=!1;return;case 27:case 3:Hr=!0;return;default:vi=vi.return}}function Vl(u){if(u!==vi)return!1;if(!$r)return Bh(u),$r=!0,!1;var p=u.tag,b;if((b=p!==3&&p!==27)&&((b=p===5)&&(b=u.type,b=!(b!=="form"&&b!=="button")||Nm(u.type,u.memoizedProps)),b=!b),b&&vn&&bi(u),Bh(u),p===13){if(u=u.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(n(317));vn=jm(u)}else if(p===31){if(u=u.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(n(317));vn=jm(u)}else p===27?(p=vn,Yc(u.type)?(u=Um,Um=null,vn=u):vn=p):vn=vi?$a(u.stateNode.nextSibling):null;return!0}function na(){vn=vi=null,$r=!1}function $o(){var u=go;return u!==null&&(ws===null?ws=u:ws.push.apply(ws,u),go=null),u}function Ho(u){go===null?go=[u]:go.push(u)}var Nh=pe(null),$l=null,mo=null;function Wo(u,p,b){rt(Nh,p._currentValue),p._currentValue=b}function yo(u){u._currentValue=Nh.current,Pe(Nh)}function Hl(u,p,b){for(;u!==null;){var S=u.alternate;if((u.childLanes&p)!==p?(u.childLanes|=p,S!==null&&(S.childLanes|=p)):S!==null&&(S.childLanes&p)!==p&&(S.childLanes|=p),u===b)break;u=u.return}}function ia(u,p,b,S){var k=u.child;for(k!==null&&(k.return=u);k!==null;){var z=k.dependencies;if(z!==null){var J=k.child;z=z.firstContext;e:for(;z!==null;){var he=z;z=k;for(var Be=0;Be<p.length;Be++)if(he.context===p[Be]){z.lanes|=b,he=z.alternate,he!==null&&(he.lanes|=b),Hl(z.return,b,u),S||(J=null);break e}z=he.next}}else if(k.tag===18){if(J=k.return,J===null)throw Error(n(341));J.lanes|=b,z=J.alternate,z!==null&&(z.lanes|=b),Hl(J,b,u),J=null}else J=k.child;if(J!==null)J.return=k;else for(J=k;J!==null;){if(J===u){J=null;break}if(k=J.sibling,k!==null){k.return=J.return,J=k;break}J=J.return}k=J}}function Ri(u,p,b,S){u=null;for(var k=p,z=!1;k!==null;){if(!z){if((k.flags&524288)!==0)z=!0;else if((k.flags&262144)!==0)break}if(k.tag===10){var J=k.alternate;if(J===null)throw Error(n(387));if(J=J.memoizedProps,J!==null){var he=k.type;is(k.pendingProps.value,J.value)||(u!==null?u.push(he):u=[he])}}else if(k===Gt.current){if(J=k.alternate,J===null)throw Error(n(387));J.memoizedState.memoizedState!==k.memoizedState.memoizedState&&(u!==null?u.push(St):u=[St])}k=k.return}u!==null&&ia(p,u,b,S),p.flags|=262144}function qo(u){for(u=u.firstContext;u!==null;){if(!is(u.context._currentValue,u.memoizedValue))return!0;u=u.next}return!1}function Go(u){$l=u,mo=null,u=u.dependencies,u!==null&&(u.firstContext=null)}function ji(u){return Lc($l,u)}function zh(u,p){return $l===null&&Go(u),Lc(u,p)}function Lc(u,p){var b=p._currentValue;if(p={context:p,memoizedValue:b,next:null},mo===null){if(u===null)throw Error(n(308));mo=p,u.dependencies={lanes:0,firstContext:p},u.flags|=524288}else mo=mo.next=p;return b}var pp=typeof AbortController<"u"?AbortController:function(){var u=[],p=this.signal={aborted:!1,addEventListener:function(b,S){u.push(S)}};this.abort=function(){p.aborted=!0,u.forEach(function(b){return b()})}},Wf=t.unstable_scheduleCallback,qf=t.unstable_NormalPriority,Zn={$$typeof:X,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Us(){return{controller:new pp,data:new Map,refCount:0}}function Oi(u){u.refCount--,u.refCount===0&&Wf(qf,function(){u.controller.abort()})}var Eu=null,sa=0,za=0,_o=null;function e_(u,p){if(Eu===null){var b=Eu=[];sa=0,za=Om(),_o={status:"pending",value:void 0,then:function(S){b.push(S)}}}return sa++,p.then(nm,nm),p}function nm(){if(--sa===0&&Eu!==null){_o!==null&&(_o.status="fulfilled");var u=Eu;Eu=null,za=0,_o=null;for(var p=0;p<u.length;p++)(0,u[p])()}}function Gf(u,p){var b=[],S={status:"pending",value:null,reason:null,then:function(k){b.push(k)}};return u.then(function(){S.status="fulfilled",S.value=p;for(var k=0;k<b.length;k++)(0,b[k])(p)},function(k){for(S.status="rejected",S.reason=k,k=0;k<b.length;k++)(0,b[k])(void 0)}),S}var gp=ce.S;ce.S=function(u,p){G0=Ei(),typeof p=="object"&&p!==null&&typeof p.then=="function"&&e_(u,p),gp!==null&&gp(u,p)};var aa=pe(null);function js(){var u=aa.current;return u!==null?u:In.pooledCache}function Ht(u,p){p===null?rt(aa,aa.current):rt(aa,p.pool)}function Xf(){var u=js();return u===null?null:{parent:Zn._currentValue,pool:u}}var Xo=Error(n(460)),Fh=Error(n(474)),vo=Error(n(542)),Zo={then:function(){}};function Zf(u){return u=u.status,u==="fulfilled"||u==="rejected"}function Br(u,p,b){switch(b=u[b],b===void 0?u.push(p):b!==p&&(p.then(ga,ga),p=b),p.status){case"fulfilled":return p.value;case"rejected":throw u=p.reason,mp(u),u;default:if(typeof p.status=="string")p.then(ga,ga);else{if(u=In,u!==null&&100<u.shellSuspendCounter)throw Error(n(482));u=p,u.status="pending",u.then(function(S){if(p.status==="pending"){var k=p;k.status="fulfilled",k.value=S}},function(S){if(p.status==="pending"){var k=p;k.status="rejected",k.reason=S}})}switch(p.status){case"fulfilled":return p.value;case"rejected":throw u=p.reason,mp(u),u}throw Wl=p,Xo}}function Yo(u){try{var p=u._init;return p(u._payload)}catch(b){throw b!==null&&typeof b=="object"&&typeof b.then=="function"?(Wl=b,Xo):b}}var Wl=null;function Yf(){if(Wl===null)throw Error(n(459));var u=Wl;return Wl=null,u}function mp(u){if(u===Xo||u===vo)throw Error(n(483))}var Bc=null,Cu=0;function Pu(u){var p=Cu;return Cu+=1,Bc===null&&(Bc=[]),Br(Bc,u,p)}function Nc(u,p){p=p.props.ref,u.ref=p!==void 0?p:null}function Uh(u,p){throw p.$$typeof===M?Error(n(525)):(u=Object.prototype.toString.call(p),Error(n(31,u==="[object Object]"?"object with keys {"+Object.keys(p).join(", ")+"}":u)))}function Kf(u){function p(Ke,Ve){if(u){var ct=Ke.deletions;ct===null?(Ke.deletions=[Ve],Ke.flags|=16):ct.push(Ve)}}function b(Ke,Ve){if(!u)return null;for(;Ve!==null;)p(Ke,Ve),Ve=Ve.sibling;return null}function S(Ke){for(var Ve=new Map;Ke!==null;)Ke.key!==null?Ve.set(Ke.key,Ke):Ve.set(Ke.index,Ke),Ke=Ke.sibling;return Ve}function k(Ke,Ve){return Ke=ho(Ke,Ve),Ke.index=0,Ke.sibling=null,Ke}function z(Ke,Ve,ct){return Ke.index=ct,u?(ct=Ke.alternate,ct!==null?(ct=ct.index,ct<Ve?(Ke.flags|=67108866,Ve):ct):(Ke.flags|=67108866,Ve)):(Ke.flags|=1048576,Ve)}function J(Ke){return u&&Ke.alternate===null&&(Ke.flags|=67108866),Ke}function he(Ke,Ve,ct,Ct){return Ve===null||Ve.tag!==6?(Ve=Rh(ct,Ke.mode,Ct),Ve.return=Ke,Ve):(Ve=k(Ve,ct),Ve.return=Ke,Ve)}function Be(Ke,Ve,ct,Ct){var gr=ct.type;return gr===j?xt(Ke,Ve,ct.props.children,Ct,ct.key):Ve!==null&&(Ve.elementType===gr||typeof gr=="object"&&gr!==null&&gr.$$typeof===qe&&Yo(gr)===Ve.type)?(Ve=k(Ve,ct.props),Nc(Ve,ct),Ve.return=Ke,Ve):(Ve=Ih(ct.type,ct.key,ct.props,null,Ke.mode,Ct),Nc(Ve,ct),Ve.return=Ke,Ve)}function ut(Ke,Ve,ct,Ct){return Ve===null||Ve.tag!==4||Ve.stateNode.containerInfo!==ct.containerInfo||Ve.stateNode.implementation!==ct.implementation?(Ve=kc(ct,Ke.mode,Ct),Ve.return=Ke,Ve):(Ve=k(Ve,ct.children||[]),Ve.return=Ke,Ve)}function xt(Ke,Ve,ct,Ct,gr){return Ve===null||Ve.tag!==7?(Ve=Oc(ct,Ke.mode,Ct,gr),Ve.return=Ke,Ve):(Ve=k(Ve,ct),Ve.return=Ke,Ve)}function It(Ke,Ve,ct){if(typeof Ve=="string"&&Ve!==""||typeof Ve=="number"||typeof Ve=="bigint")return Ve=Rh(""+Ve,Ke.mode,ct),Ve.return=Ke,Ve;if(typeof Ve=="object"&&Ve!==null){switch(Ve.$$typeof){case O:return ct=Ih(Ve.type,Ve.key,Ve.props,null,Ke.mode,ct),Nc(ct,Ve),ct.return=Ke,ct;case F:return Ve=kc(Ve,Ke.mode,ct),Ve.return=Ke,Ve;case qe:return Ve=Yo(Ve),It(Ke,Ve,ct)}if(Yt(Ve)||gt(Ve))return Ve=Oc(Ve,Ke.mode,ct,null),Ve.return=Ke,Ve;if(typeof Ve.then=="function")return It(Ke,Pu(Ve),ct);if(Ve.$$typeof===X)return It(Ke,zh(Ke,Ve),ct);Uh(Ke,Ve)}return null}function ht(Ke,Ve,ct,Ct){var gr=Ve!==null?Ve.key:null;if(typeof ct=="string"&&ct!==""||typeof ct=="number"||typeof ct=="bigint")return gr!==null?null:he(Ke,Ve,""+ct,Ct);if(typeof ct=="object"&&ct!==null){switch(ct.$$typeof){case O:return ct.key===gr?Be(Ke,Ve,ct,Ct):null;case F:return ct.key===gr?ut(Ke,Ve,ct,Ct):null;case qe:return ct=Yo(ct),ht(Ke,Ve,ct,Ct)}if(Yt(ct)||gt(ct))return gr!==null?null:xt(Ke,Ve,ct,Ct,null);if(typeof ct.then=="function")return ht(Ke,Ve,Pu(ct),Ct);if(ct.$$typeof===X)return ht(Ke,Ve,zh(Ke,ct),Ct);Uh(Ke,ct)}return null}function pt(Ke,Ve,ct,Ct,gr){if(typeof Ct=="string"&&Ct!==""||typeof Ct=="number"||typeof Ct=="bigint")return Ke=Ke.get(ct)||null,he(Ve,Ke,""+Ct,gr);if(typeof Ct=="object"&&Ct!==null){switch(Ct.$$typeof){case O:return Ke=Ke.get(Ct.key===null?ct:Ct.key)||null,Be(Ve,Ke,Ct,gr);case F:return Ke=Ke.get(Ct.key===null?ct:Ct.key)||null,ut(Ve,Ke,Ct,gr);case qe:return Ct=Yo(Ct),pt(Ke,Ve,ct,Ct,gr)}if(Yt(Ct)||gt(Ct))return Ke=Ke.get(ct)||null,xt(Ve,Ke,Ct,gr,null);if(typeof Ct.then=="function")return pt(Ke,Ve,ct,Pu(Ct),gr);if(Ct.$$typeof===X)return pt(Ke,Ve,ct,zh(Ve,Ct),gr);Uh(Ve,Ct)}return null}function ir(Ke,Ve,ct,Ct){for(var gr=null,Tr=null,Kt=Ve,Er=Ve=0,Mr=null;Kt!==null&&Er<ct.length;Er++){Kt.index>Er?(Mr=Kt,Kt=null):Mr=Kt.sibling;var qr=ht(Ke,Kt,ct[Er],Ct);if(qr===null){Kt===null&&(Kt=Mr);break}u&&Kt&&qr.alternate===null&&p(Ke,Kt),Ve=z(qr,Ve,Er),Tr===null?gr=qr:Tr.sibling=qr,Tr=qr,Kt=Mr}if(Er===ct.length)return b(Ke,Kt),$r&&ra(Ke,Er),gr;if(Kt===null){for(;Er<ct.length;Er++)Kt=It(Ke,ct[Er],Ct),Kt!==null&&(Ve=z(Kt,Ve,Er),Tr===null?gr=Kt:Tr.sibling=Kt,Tr=Kt);return $r&&ra(Ke,Er),gr}for(Kt=S(Kt);Er<ct.length;Er++)Mr=pt(Kt,Ke,Er,ct[Er],Ct),Mr!==null&&(u&&Mr.alternate!==null&&Kt.delete(Mr.key===null?Er:Mr.key),Ve=z(Mr,Ve,Er),Tr===null?gr=Mr:Tr.sibling=Mr,Tr=Mr);return u&&Kt.forEach(function(Ss){return p(Ke,Ss)}),$r&&ra(Ke,Er),gr}function vr(Ke,Ve,ct,Ct){if(ct==null)throw Error(n(151));for(var gr=null,Tr=null,Kt=Ve,Er=Ve=0,Mr=null,qr=ct.next();Kt!==null&&!qr.done;Er++,qr=ct.next()){Kt.index>Er?(Mr=Kt,Kt=null):Mr=Kt.sibling;var Ss=ht(Ke,Kt,qr.value,Ct);if(Ss===null){Kt===null&&(Kt=Mr);break}u&&Kt&&Ss.alternate===null&&p(Ke,Kt),Ve=z(Ss,Ve,Er),Tr===null?gr=Ss:Tr.sibling=Ss,Tr=Ss,Kt=Mr}if(qr.done)return b(Ke,Kt),$r&&ra(Ke,Er),gr;if(Kt===null){for(;!qr.done;Er++,qr=ct.next())qr=It(Ke,qr.value,Ct),qr!==null&&(Ve=z(qr,Ve,Er),Tr===null?gr=qr:Tr.sibling=qr,Tr=qr);return $r&&ra(Ke,Er),gr}for(Kt=S(Kt);!qr.done;Er++,qr=ct.next())qr=pt(Kt,Ke,Er,qr.value,Ct),qr!==null&&(u&&qr.alternate!==null&&Kt.delete(qr.key===null?Er:qr.key),Ve=z(qr,Ve,Er),Tr===null?gr=qr:Tr.sibling=qr,Tr=qr);return u&&Kt.forEach(function(LF){return p(Ke,LF)}),$r&&ra(Ke,Er),gr}function Wr(Ke,Ve,ct,Ct){if(typeof ct=="object"&&ct!==null&&ct.type===j&&ct.key===null&&(ct=ct.props.children),typeof ct=="object"&&ct!==null){switch(ct.$$typeof){case O:e:{for(var gr=ct.key;Ve!==null;){if(Ve.key===gr){if(gr=ct.type,gr===j){if(Ve.tag===7){b(Ke,Ve.sibling),Ct=k(Ve,ct.props.children),Ct.return=Ke,Ke=Ct;break e}}else if(Ve.elementType===gr||typeof gr=="object"&&gr!==null&&gr.$$typeof===qe&&Yo(gr)===Ve.type){b(Ke,Ve.sibling),Ct=k(Ve,ct.props),Nc(Ct,ct),Ct.return=Ke,Ke=Ct;break e}b(Ke,Ve);break}else p(Ke,Ve);Ve=Ve.sibling}ct.type===j?(Ct=Oc(ct.props.children,Ke.mode,Ct,ct.key),Ct.return=Ke,Ke=Ct):(Ct=Ih(ct.type,ct.key,ct.props,null,Ke.mode,Ct),Nc(Ct,ct),Ct.return=Ke,Ke=Ct)}return J(Ke);case F:e:{for(gr=ct.key;Ve!==null;){if(Ve.key===gr)if(Ve.tag===4&&Ve.stateNode.containerInfo===ct.containerInfo&&Ve.stateNode.implementation===ct.implementation){b(Ke,Ve.sibling),Ct=k(Ve,ct.children||[]),Ct.return=Ke,Ke=Ct;break e}else{b(Ke,Ve);break}else p(Ke,Ve);Ve=Ve.sibling}Ct=kc(ct,Ke.mode,Ct),Ct.return=Ke,Ke=Ct}return J(Ke);case qe:return ct=Yo(ct),Wr(Ke,Ve,ct,Ct)}if(Yt(ct))return ir(Ke,Ve,ct,Ct);if(gt(ct)){if(gr=gt(ct),typeof gr!="function")throw Error(n(150));return ct=gr.call(ct),vr(Ke,Ve,ct,Ct)}if(typeof ct.then=="function")return Wr(Ke,Ve,Pu(ct),Ct);if(ct.$$typeof===X)return Wr(Ke,Ve,zh(Ke,ct),Ct);Uh(Ke,ct)}return typeof ct=="string"&&ct!==""||typeof ct=="number"||typeof ct=="bigint"?(ct=""+ct,Ve!==null&&Ve.tag===6?(b(Ke,Ve.sibling),Ct=k(Ve,ct),Ct.return=Ke,Ke=Ct):(b(Ke,Ve),Ct=Rh(ct,Ke.mode,Ct),Ct.return=Ke,Ke=Ct),J(Ke)):b(Ke,Ve)}return function(Ke,Ve,ct,Ct){try{Cu=0;var gr=Wr(Ke,Ve,ct,Ct);return Bc=null,gr}catch(Kt){if(Kt===Xo||Kt===vo)throw Kt;var Tr=zs(29,Kt,null,Ke.mode);return Tr.lanes=Ct,Tr.return=Ke,Tr}finally{}}}var ql=Kf(!0),jh=Kf(!1),vs=!1;function Qr(u){u.updateQueue={baseState:u.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function yp(u,p){u=u.updateQueue,p.updateQueue===u&&(p.updateQueue={baseState:u.baseState,firstBaseUpdate:u.firstBaseUpdate,lastBaseUpdate:u.lastBaseUpdate,shared:u.shared,callbacks:null})}function Fa(u){return{lane:u,tag:0,payload:null,callback:null,next:null}}function Ua(u,p,b){var S=u.updateQueue;if(S===null)return null;if(S=S.shared,(ln&2)!==0){var k=S.pending;return k===null?p.next=p:(p.next=k.next,k.next=p),S.pending=p,p=Rr(u),$f(u,null,b),p}return Uo(u,S,p,b),Rr(u)}function zc(u,p,b){if(p=p.updateQueue,p!==null&&(p=p.shared,(b&4194048)!==0)){var S=p.lanes;S&=u.pendingLanes,b|=S,p.lanes=b,yn(u,b)}}function Vh(u,p){var b=u.updateQueue,S=u.alternate;if(S!==null&&(S=S.updateQueue,b===S)){var k=null,z=null;if(b=b.firstBaseUpdate,b!==null){do{var J={lane:b.lane,tag:b.tag,payload:b.payload,callback:null,next:null};z===null?k=z=J:z=z.next=J,b=b.next}while(b!==null);z===null?k=z=p:z=z.next=p}else k=z=p;b={baseState:S.baseState,firstBaseUpdate:k,lastBaseUpdate:z,shared:S.shared,callbacks:S.callbacks},u.updateQueue=b;return}u=b.lastBaseUpdate,u===null?b.firstBaseUpdate=p:u.next=p,b.lastBaseUpdate=p}var Qf=!1;function $h(){if(Qf){var u=_o;if(u!==null)throw u}}function Vs(u,p,b,S){Qf=!1;var k=u.updateQueue;vs=!1;var z=k.firstBaseUpdate,J=k.lastBaseUpdate,he=k.shared.pending;if(he!==null){k.shared.pending=null;var Be=he,ut=Be.next;Be.next=null,J===null?z=ut:J.next=ut,J=Be;var xt=u.alternate;xt!==null&&(xt=xt.updateQueue,he=xt.lastBaseUpdate,he!==J&&(he===null?xt.firstBaseUpdate=ut:he.next=ut,xt.lastBaseUpdate=Be))}if(z!==null){var It=k.baseState;J=0,xt=ut=Be=null,he=z;do{var ht=he.lane&-536870913,pt=ht!==he.lane;if(pt?(Zr&ht)===ht:(S&ht)===ht){ht!==0&&ht===za&&(Qf=!0),xt!==null&&(xt=xt.next={lane:0,tag:he.tag,payload:he.payload,callback:null,next:null});e:{var ir=u,vr=he;ht=p;var Wr=b;switch(vr.tag){case 1:if(ir=vr.payload,typeof ir=="function"){It=ir.call(Wr,It,ht);break e}It=ir;break e;case 3:ir.flags=ir.flags&-65537|128;case 0:if(ir=vr.payload,ht=typeof ir=="function"?ir.call(Wr,It,ht):ir,ht==null)break e;It=T({},It,ht);break e;case 2:vs=!0}}ht=he.callback,ht!==null&&(u.flags|=64,pt&&(u.flags|=8192),pt=k.callbacks,pt===null?k.callbacks=[ht]:pt.push(ht))}else pt={lane:ht,tag:he.tag,payload:he.payload,callback:he.callback,next:null},xt===null?(ut=xt=pt,Be=It):xt=xt.next=pt,J|=ht;if(he=he.next,he===null){if(he=k.shared.pending,he===null)break;pt=he,he=pt.next,pt.next=null,k.lastBaseUpdate=pt,k.shared.pending=null}}while(!0);xt===null&&(Be=It),k.baseState=Be,k.firstBaseUpdate=ut,k.lastBaseUpdate=xt,z===null&&(k.shared.lanes=0),qc|=J,u.lanes=J,u.memoizedState=It}}function Hh(u,p){if(typeof u!="function")throw Error(n(191,u));u.call(p)}function Qt(u,p){var b=u.callbacks;if(b!==null)for(u.callbacks=null,u=0;u<b.length;u++)Hh(b[u],p)}var tr=pe(null),Gl=pe(0);function _p(u,p){u=Wc,rt(Gl,u),rt(tr,p),Wc=u|p.baseLanes}function Mu(){rt(Gl,Wc),rt(tr,tr.current)}function Vi(){Wc=Gl.current,Pe(tr),Pe(Gl)}var $s=pe(null),ei=null;function Hs(u){var p=u.alternate;rt(Dn,Dn.current&1),rt($s,u),ei===null&&(p===null||tr.current!==null||p.memoizedState!==null)&&(ei=u)}function Xl(u){rt(Dn,Dn.current),rt($s,u),ei===null&&(ei=u)}function bn(u){u.tag===22?(rt(Dn,Dn.current),rt($s,u),ei===null&&(ei=u)):an()}function an(){rt(Dn,Dn.current),rt($s,$s.current)}function os(u){Pe($s),ei===u&&(ei=null),Pe(Dn)}var Dn=pe(0);function bo(u){for(var p=u;p!==null;){if(p.tag===13){var b=p.memoizedState;if(b!==null&&(b=b.dehydrated,b===null||Gu(b)||Wi(b)))return p}else if(p.tag===19&&(p.memoizedProps.revealOrder==="forwards"||p.memoizedProps.revealOrder==="backwards"||p.memoizedProps.revealOrder==="unstable_legacy-backwards"||p.memoizedProps.revealOrder==="together")){if((p.flags&128)!==0)return p}else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===u)break;for(;p.sibling===null;){if(p.return===null||p.return===u)return null;p=p.return}p.sibling.return=p.return,p=p.sibling}return null}var bs=0,Pr=null,Jr=null,dn=null,Iu=!1,Zl=!1,xo=!1,Ru=0,E=0,o=null,d=0;function y(){throw Error(n(321))}function w(u,p){if(p===null)return!1;for(var b=0;b<p.length&&b<u.length;b++)if(!is(u[b],p[b]))return!1;return!0}function C(u,p,b,S,k,z){return bs=z,Pr=p,p.memoizedState=null,p.updateQueue=null,p.lanes=0,ce.H=u===null||u.memoizedState===null?sm:am,xo=!1,z=b(S,k),xo=!1,Zl&&(z=B(p,b,S,k)),I(u),z}function I(u){ce.H=td;var p=Jr!==null&&Jr.next!==null;if(bs=0,dn=Jr=Pr=null,Iu=!1,E=0,o=null,p)throw Error(n(300));u===null||Yn||(u=u.dependencies,u!==null&&qo(u)&&(Yn=!0))}function B(u,p,b,S){Pr=u;var k=0;do{if(Zl&&(o=null),E=0,Zl=!1,25<=k)throw Error(n(301));if(k+=1,dn=Jr=null,u.updateQueue!=null){var z=u.updateQueue;z.lastEffect=null,z.events=null,z.stores=null,z.memoCache!=null&&(z.memoCache.index=0)}ce.H=Lu,z=p(b,S)}while(Zl);return z}function N(){var u=ce.H,p=u.useState()[0];return p=typeof p.then=="function"?me(p):p,u=u.useState()[0],(Jr!==null?Jr.memoizedState:null)!==u&&(Pr.flags|=1024),p}function H(){var u=Ru!==0;return Ru=0,u}function W(u,p,b){p.updateQueue=u.updateQueue,p.flags&=-2053,u.lanes&=~b}function K(u){if(Iu){for(u=u.memoizedState;u!==null;){var p=u.queue;p!==null&&(p.pending=null),u=u.next}Iu=!1}bs=0,dn=Jr=Pr=null,Zl=!1,E=Ru=0,o=null}function Z(){var u={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return dn===null?Pr.memoizedState=dn=u:dn=dn.next=u,dn}function te(){if(Jr===null){var u=Pr.alternate;u=u!==null?u.memoizedState:null}else u=Jr.next;var p=dn===null?Pr.memoizedState:dn.next;if(p!==null)dn=p,Jr=u;else{if(u===null)throw Pr.alternate===null?Error(n(467)):Error(n(310));Jr=u,u={memoizedState:Jr.memoizedState,baseState:Jr.baseState,baseQueue:Jr.baseQueue,queue:Jr.queue,next:null},dn===null?Pr.memoizedState=dn=u:dn=dn.next=u}return dn}function oe(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function me(u){var p=E;return E+=1,o===null&&(o=[]),u=Br(o,u,p),p=Pr,(dn===null?p.memoizedState:dn.next)===null&&(p=p.alternate,ce.H=p===null||p.memoizedState===null?sm:am),u}function ye(u){if(u!==null&&typeof u=="object"){if(typeof u.then=="function")return me(u);if(u.$$typeof===X)return ji(u)}throw Error(n(438,String(u)))}function _e(u){var p=null,b=Pr.updateQueue;if(b!==null&&(p=b.memoCache),p==null){var S=Pr.alternate;S!==null&&(S=S.updateQueue,S!==null&&(S=S.memoCache,S!=null&&(p={data:S.data.map(function(k){return k.slice()}),index:0})))}if(p==null&&(p={data:[],index:0}),b===null&&(b=oe(),Pr.updateQueue=b),b.memoCache=p,b=p.data[p.index],b===void 0)for(b=p.data[p.index]=Array(u),S=0;S<u;S++)b[S]=_t;return p.index++,b}function be(u,p){return typeof p=="function"?p(u):p}function Ee(u){var p=te();return Te(p,Jr,u)}function Te(u,p,b){var S=u.queue;if(S===null)throw Error(n(311));S.lastRenderedReducer=b;var k=u.baseQueue,z=S.pending;if(z!==null){if(k!==null){var J=k.next;k.next=z.next,z.next=J}p.baseQueue=k=z,S.pending=null}if(z=u.baseState,k===null)u.memoizedState=z;else{p=k.next;var he=J=null,Be=null,ut=p,xt=!1;do{var It=ut.lane&-536870913;if(It!==ut.lane?(Zr&It)===It:(bs&It)===It){var ht=ut.revertLane;if(ht===0)Be!==null&&(Be=Be.next={lane:0,revertLane:0,gesture:null,action:ut.action,hasEagerState:ut.hasEagerState,eagerState:ut.eagerState,next:null}),It===za&&(xt=!0);else if((bs&ht)===ht){ut=ut.next,ht===za&&(xt=!0);continue}else It={lane:0,revertLane:ut.revertLane,gesture:null,action:ut.action,hasEagerState:ut.hasEagerState,eagerState:ut.eagerState,next:null},Be===null?(he=Be=It,J=z):Be=Be.next=It,Pr.lanes|=ht,qc|=ht;It=ut.action,xo&&b(z,It),z=ut.hasEagerState?ut.eagerState:b(z,It)}else ht={lane:It,revertLane:ut.revertLane,gesture:ut.gesture,action:ut.action,hasEagerState:ut.hasEagerState,eagerState:ut.eagerState,next:null},Be===null?(he=Be=ht,J=z):Be=Be.next=ht,Pr.lanes|=It,qc|=It;ut=ut.next}while(ut!==null&&ut!==p);if(Be===null?J=z:Be.next=he,!is(z,u.memoizedState)&&(Yn=!0,xt&&(b=_o,b!==null)))throw b;u.memoizedState=z,u.baseState=J,u.baseQueue=Be,S.lastRenderedState=z}return k===null&&(S.lanes=0),[u.memoizedState,S.dispatch]}function Oe(u){var p=te(),b=p.queue;if(b===null)throw Error(n(311));b.lastRenderedReducer=u;var S=b.dispatch,k=b.pending,z=p.memoizedState;if(k!==null){b.pending=null;var J=k=k.next;do z=u(z,J.action),J=J.next;while(J!==k);is(z,p.memoizedState)||(Yn=!0),p.memoizedState=z,p.baseQueue===null&&(p.baseState=z),b.lastRenderedState=z}return[z,S]}function Ne(u,p,b){var S=Pr,k=te(),z=$r;if(z){if(b===void 0)throw Error(n(407));b=b()}else b=p();var J=!is((Jr||k).memoizedState,b);if(J&&(k.memoizedState=b,Yn=!0),k=k.queue,wo(ot.bind(null,S,k,u),[u]),k.getSnapshot!==p||J||dn!==null&&dn.memoizedState.tag&1){if(S.flags|=2048,hn(9,{destroy:void 0},ze.bind(null,S,k,b,p),null),In===null)throw Error(n(349));z||(bs&127)!==0||Ce(S,p,b)}return b}function Ce(u,p,b){u.flags|=16384,u={getSnapshot:p,value:b},p=Pr.updateQueue,p===null?(p=oe(),Pr.updateQueue=p,p.stores=[u]):(b=p.stores,b===null?p.stores=[u]:b.push(u))}function ze(u,p,b,S){p.value=b,p.getSnapshot=S,tt(p)&&nt(u)}function ot(u,p,b){return b(function(){tt(p)&&nt(u)})}function tt(u){var p=u.getSnapshot;u=u.value;try{var b=p();return!is(u,b)}catch{return!0}}function nt(u){var p=Ul(u,2);p!==null&&Sa(p,u,2)}function lt(u){var p=Z();if(typeof u=="function"){var b=u;if(u=b(),xo){Fe(!0);try{b()}finally{Fe(!1)}}}return p.memoizedState=p.baseState=u,p.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:be,lastRenderedState:u},p}function Nt(u,p,b,S){return u.baseState=b,Te(u,Jr,typeof S=="function"?S:be)}function Bt(u,p,b,S,k){if(Uc(u))throw Error(n(485));if(u=p.action,u!==null){var z={payload:k,action:u,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(J){z.listeners.push(J)}};ce.T!==null?b(!0):z.isTransition=!1,S(z),b=p.pending,b===null?(z.next=p.pending=z,Tt(p,z)):(z.next=b.next,p.pending=b.next=z)}}function Tt(u,p){var b=p.action,S=p.payload,k=u.state;if(p.isTransition){var z=ce.T,J={};ce.T=J;try{var he=b(k,S),Be=ce.S;Be!==null&&Be(J,he),qt(u,p,he)}catch(ut){Yr(u,p,ut)}finally{z!==null&&J.types!==null&&(z.types=J.types),ce.T=z}}else try{z=b(k,S),qt(u,p,z)}catch(ut){Yr(u,p,ut)}}function qt(u,p,b){b!==null&&typeof b=="object"&&typeof b.then=="function"?b.then(function(S){wr(u,p,S)},function(S){return Yr(u,p,S)}):wr(u,p,b)}function wr(u,p,b){p.status="fulfilled",p.value=b,xn(p),u.state=b,p=u.pending,p!==null&&(b=p.next,b===p?u.pending=null:(b=b.next,p.next=b,Tt(u,b)))}function Yr(u,p,b){var S=u.pending;if(u.pending=null,S!==null){S=S.next;do p.status="rejected",p.reason=b,xn(p),p=p.next;while(p!==S)}u.action=null}function xn(u){u=u.listeners;for(var p=0;p<u.length;p++)(0,u[p])()}function pn(u,p){return p}function En(u,p){if($r){var b=In.formState;if(b!==null){e:{var S=Pr;if($r){if(vn){t:{for(var k=vn,z=Hr;k.nodeType!==8;){if(!z){k=null;break t}if(k=$a(k.nextSibling),k===null){k=null;break t}}z=k.data,k=z==="F!"||z==="F"?k:null}if(k){vn=$a(k.nextSibling),S=k.data==="F!";break e}}bi(S)}S=!1}S&&(p=b[0])}}return b=Z(),b.memoizedState=b.baseState=p,S={pending:null,lanes:0,dispatch:null,lastRenderedReducer:pn,lastRenderedState:p},b.queue=S,b=So.bind(null,Pr,S),S.dispatch=b,S=lt(!1),z=qh.bind(null,Pr,!1,S.queue),S=Z(),k={state:p,dispatch:null,action:u,pending:null},S.queue=k,b=Bt.bind(null,Pr,k,z,b),k.dispatch=b,S.memoizedState=u,[p,b,!1]}function wn(u){var p=te();return xi(p,Jr,u)}function xi(u,p,b){if(p=Te(u,p,pn)[0],u=Ee(be)[0],typeof p=="object"&&p!==null&&typeof p.then=="function")try{var S=me(p)}catch(J){throw J===Xo?vo:J}else S=p;p=te();var k=p.queue,z=k.dispatch;return b!==p.memoizedState&&(Pr.flags|=2048,hn(9,{destroy:void 0},Cn.bind(null,k,b),null)),[S,z,u]}function Cn(u,p){u.action=p}function on(u){var p=te(),b=Jr;if(b!==null)return xi(p,b,u);te(),p=p.memoizedState,b=te();var S=b.queue.dispatch;return b.memoizedState=u,[p,S,!1]}function hn(u,p,b,S){return u={tag:u,create:b,deps:S,inst:p,next:null},p=Pr.updateQueue,p===null&&(p=oe(),Pr.updateQueue=p),b=p.lastEffect,b===null?p.lastEffect=u.next=u:(S=b.next,b.next=u,u.next=S,p.lastEffect=u),u}function Or(){return te().memoizedState}function wi(u,p,b,S){var k=Z();Pr.flags|=u,k.memoizedState=hn(1|p,{destroy:void 0},b,S===void 0?null:S)}function _a(u,p,b,S){var k=te();S=S===void 0?null:S;var z=k.memoizedState.inst;Jr!==null&&S!==null&&w(S,Jr.memoizedState.deps)?k.memoizedState=hn(p,z,b,S):(Pr.flags|=u,k.memoizedState=hn(1|p,z,b,S))}function Yl(u,p){wi(8390656,8,u,p)}function wo(u,p){_a(2048,8,u,p)}function Fc(u){Pr.flags|=4;var p=Pr.updateQueue;if(p===null)p=oe(),Pr.updateQueue=p,p.events=[u];else{var b=p.events;b===null?p.events=[u]:b.push(u)}}function Ou(u){var p=te().memoizedState;return Fc({ref:p,nextImpl:u}),function(){if((ln&2)!==0)throw Error(n(440));return p.impl.apply(void 0,arguments)}}function Ko(u,p){return _a(4,2,u,p)}function Kl(u,p){return _a(4,4,u,p)}function Ws(u,p){if(typeof p=="function"){u=u();var b=p(u);return function(){typeof b=="function"?b():p(null)}}if(p!=null)return u=u(),p.current=u,function(){p.current=null}}function Qo(u,p,b){b=b!=null?b.concat([u]):null,_a(4,4,Ws.bind(null,p,u),b)}function ja(){}function Jo(u,p){var b=te();p=p===void 0?null:p;var S=b.memoizedState;return p!==null&&w(p,S[1])?S[0]:(b.memoizedState=[u,p],u)}function ai(u,p){var b=te();p=p===void 0?null:p;var S=b.memoizedState;if(p!==null&&w(p,S[1]))return S[0];if(S=u(),xo){Fe(!0);try{u()}finally{Fe(!1)}}return b.memoizedState=[S,p],S}function ti(u,p,b){return b===void 0||(bs&1073741824)!==0&&(Zr&261930)===0?u.memoizedState=p:(u.memoizedState=b,u=X0(),Pr.lanes|=u,qc|=u,b)}function ls(u,p,b,S){return is(b,p)?b:tr.current!==null?(u=ti(u,b,S),is(u,p)||(Yn=!0),u):(bs&42)===0||(bs&1073741824)!==0&&(Zr&261930)===0?(Yn=!0,u.memoizedState=b):(u=X0(),Pr.lanes|=u,qc|=u,p)}function Tn(u,p,b,S,k){var z=we.p;we.p=z!==0&&8>z?z:8;var J=ce.T,he={};ce.T=he,qh(u,!1,p,b);try{var Be=k(),ut=ce.S;if(ut!==null&&ut(he,Be),Be!==null&&typeof Be=="object"&&typeof Be.then=="function"){var xt=Gf(Be,S);Ql(u,p,xt,Ta(u))}else Ql(u,p,S,Ta(u))}catch(It){Ql(u,p,{then:function(){},status:"rejected",reason:It},Ta())}finally{we.p=z,J!==null&&he.types!==null&&(J.types=he.types),ce.T=J}}function Jf(){}function ed(u,p,b,S){if(u.tag!==5)throw Error(n(476));var k=vp(u).queue;Tn(u,k,p,Re,b===null?Jf:function(){return im(u),b(S)})}function vp(u){var p=u.memoizedState;if(p!==null)return p;p={memoizedState:Re,baseState:Re,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:be,lastRenderedState:Re},next:null};var b={};return p.next={memoizedState:b,baseState:b,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:be,lastRenderedState:b},next:null},u.memoizedState=p,u=u.alternate,u!==null&&(u.memoizedState=p),p}function im(u){var p=vp(u);p.next===null&&(p=u.alternate.memoizedState),Ql(u,p.next.queue,{},Ta())}function Wh(){return ji(St)}function ku(){return te().memoizedState}function qs(){return te().memoizedState}function To(u){for(var p=u.return;p!==null;){switch(p.tag){case 24:case 3:var b=Ta();u=Fa(b);var S=Ua(p,u,b);S!==null&&(Sa(S,p,b),zc(S,p,b)),p={cache:Us()},u.payload=p;return}p=p.return}}function va(u,p,b){var S=Ta();b={lane:S,revertLane:0,gesture:null,action:b,hasEagerState:!1,eagerState:null,next:null},Uc(u)?Du(p,b):(b=lo(u,p,b,S),b!==null&&(Sa(b,u,S),P0(b,p,S)))}function So(u,p,b){var S=Ta();Ql(u,p,b,S)}function Ql(u,p,b,S){var k={lane:S,revertLane:0,gesture:null,action:b,hasEagerState:!1,eagerState:null,next:null};if(Uc(u))Du(p,k);else{var z=u.alternate;if(u.lanes===0&&(z===null||z.lanes===0)&&(z=p.lastRenderedReducer,z!==null))try{var J=p.lastRenderedState,he=z(J,b);if(k.hasEagerState=!0,k.eagerState=he,is(he,J))return Uo(u,p,k,0),In===null&&Mh(),!1}catch{}finally{}if(b=lo(u,p,k,S),b!==null)return Sa(b,u,S),P0(b,p,S),!0}return!1}function qh(u,p,b,S){if(S={lane:2,revertLane:Om(),gesture:null,action:S,hasEagerState:!1,eagerState:null,next:null},Uc(u)){if(p)throw Error(n(479))}else p=lo(u,b,S,2),p!==null&&Sa(p,u,2)}function Uc(u){var p=u.alternate;return u===Pr||p!==null&&p===Pr}function Du(u,p){Zl=Iu=!0;var b=u.pending;b===null?p.next=p:(p.next=b.next,b.next=p),u.pending=p}function P0(u,p,b){if((b&4194048)!==0){var S=p.lanes;S&=u.pendingLanes,b|=S,p.lanes=b,yn(u,b)}}var td={readContext:ji,use:ye,useCallback:y,useContext:y,useEffect:y,useImperativeHandle:y,useLayoutEffect:y,useInsertionEffect:y,useMemo:y,useReducer:y,useRef:y,useState:y,useDebugValue:y,useDeferredValue:y,useTransition:y,useSyncExternalStore:y,useId:y,useHostTransitionStatus:y,useFormState:y,useActionState:y,useOptimistic:y,useMemoCache:y,useCacheRefresh:y};td.useEffectEvent=y;var sm={readContext:ji,use:ye,useCallback:function(u,p){return Z().memoizedState=[u,p===void 0?null:p],u},useContext:ji,useEffect:Yl,useImperativeHandle:function(u,p,b){b=b!=null?b.concat([u]):null,wi(4194308,4,Ws.bind(null,p,u),b)},useLayoutEffect:function(u,p){return wi(4194308,4,u,p)},useInsertionEffect:function(u,p){wi(4,2,u,p)},useMemo:function(u,p){var b=Z();p=p===void 0?null:p;var S=u();if(xo){Fe(!0);try{u()}finally{Fe(!1)}}return b.memoizedState=[S,p],S},useReducer:function(u,p,b){var S=Z();if(b!==void 0){var k=b(p);if(xo){Fe(!0);try{b(p)}finally{Fe(!1)}}}else k=p;return S.memoizedState=S.baseState=k,u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:u,lastRenderedState:k},S.queue=u,u=u.dispatch=va.bind(null,Pr,u),[S.memoizedState,u]},useRef:function(u){var p=Z();return u={current:u},p.memoizedState=u},useState:function(u){u=lt(u);var p=u.queue,b=So.bind(null,Pr,p);return p.dispatch=b,[u.memoizedState,b]},useDebugValue:ja,useDeferredValue:function(u,p){var b=Z();return ti(b,u,p)},useTransition:function(){var u=lt(!1);return u=Tn.bind(null,Pr,u.queue,!0,!1),Z().memoizedState=u,[!1,u]},useSyncExternalStore:function(u,p,b){var S=Pr,k=Z();if($r){if(b===void 0)throw Error(n(407));b=b()}else{if(b=p(),In===null)throw Error(n(349));(Zr&127)!==0||Ce(S,p,b)}k.memoizedState=b;var z={value:b,getSnapshot:p};return k.queue=z,Yl(ot.bind(null,S,z,u),[u]),S.flags|=2048,hn(9,{destroy:void 0},ze.bind(null,S,z,b,p),null),b},useId:function(){var u=Z(),p=In.identifierPrefix;if($r){var b=ya,S=as;b=(S&~(1<<32-Qe(S)-1)).toString(32)+b,p="_"+p+"R_"+b,b=Ru++,0<b&&(p+="H"+b.toString(32)),p+="_"}else b=d++,p="_"+p+"r_"+b.toString(32)+"_";return u.memoizedState=p},useHostTransitionStatus:Wh,useFormState:En,useActionState:En,useOptimistic:function(u){var p=Z();p.memoizedState=p.baseState=u;var b={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return p.queue=b,p=qh.bind(null,Pr,!0,b),b.dispatch=p,[u,p]},useMemoCache:_e,useCacheRefresh:function(){return Z().memoizedState=To.bind(null,Pr)},useEffectEvent:function(u){var p=Z(),b={impl:u};return p.memoizedState=b,function(){if((ln&2)!==0)throw Error(n(440));return b.impl.apply(void 0,arguments)}}},am={readContext:ji,use:ye,useCallback:Jo,useContext:ji,useEffect:wo,useImperativeHandle:Qo,useInsertionEffect:Ko,useLayoutEffect:Kl,useMemo:ai,useReducer:Ee,useRef:Or,useState:function(){return Ee(be)},useDebugValue:ja,useDeferredValue:function(u,p){var b=te();return ls(b,Jr.memoizedState,u,p)},useTransition:function(){var u=Ee(be)[0],p=te().memoizedState;return[typeof u=="boolean"?u:me(u),p]},useSyncExternalStore:Ne,useId:ku,useHostTransitionStatus:Wh,useFormState:wn,useActionState:wn,useOptimistic:function(u,p){var b=te();return Nt(b,Jr,u,p)},useMemoCache:_e,useCacheRefresh:qs};am.useEffectEvent=Ou;var Lu={readContext:ji,use:ye,useCallback:Jo,useContext:ji,useEffect:wo,useImperativeHandle:Qo,useInsertionEffect:Ko,useLayoutEffect:Kl,useMemo:ai,useReducer:Oe,useRef:Or,useState:function(){return Oe(be)},useDebugValue:ja,useDeferredValue:function(u,p){var b=te();return Jr===null?ti(b,u,p):ls(b,Jr.memoizedState,u,p)},useTransition:function(){var u=Oe(be)[0],p=te().memoizedState;return[typeof u=="boolean"?u:me(u),p]},useSyncExternalStore:Ne,useId:ku,useHostTransitionStatus:Wh,useFormState:on,useActionState:on,useOptimistic:function(u,p){var b=te();return Jr!==null?Nt(b,Jr,u,p):(b.baseState=u,[u,b.queue.dispatch])},useMemoCache:_e,useCacheRefresh:qs};Lu.useEffectEvent=Ou;function jc(u,p,b,S){p=u.memoizedState,b=b(S,p),b=b==null?p:T({},p,b),u.memoizedState=b,u.lanes===0&&(u.updateQueue.baseState=b)}var om={enqueueSetState:function(u,p,b){u=u._reactInternals;var S=Ta(),k=Fa(S);k.payload=p,b!=null&&(k.callback=b),p=Ua(u,k,S),p!==null&&(Sa(p,u,S),zc(p,u,S))},enqueueReplaceState:function(u,p,b){u=u._reactInternals;var S=Ta(),k=Fa(S);k.tag=1,k.payload=p,b!=null&&(k.callback=b),p=Ua(u,k,S),p!==null&&(Sa(p,u,S),zc(p,u,S))},enqueueForceUpdate:function(u,p){u=u._reactInternals;var b=Ta(),S=Fa(b);S.tag=2,p!=null&&(S.callback=p),p=Ua(u,S,b),p!==null&&(Sa(p,u,b),zc(p,u,b))}};function M0(u,p,b,S,k,z,J){return u=u.stateNode,typeof u.shouldComponentUpdate=="function"?u.shouldComponentUpdate(S,z,J):p.prototype&&p.prototype.isPureReactComponent?!ta(b,S)||!ta(k,z):!0}function lm(u,p,b,S){u=p.state,typeof p.componentWillReceiveProps=="function"&&p.componentWillReceiveProps(b,S),typeof p.UNSAFE_componentWillReceiveProps=="function"&&p.UNSAFE_componentWillReceiveProps(b,S),p.state!==u&&om.enqueueReplaceState(p,p.state,null)}function Bu(u,p){var b=p;if("ref"in p){b={};for(var S in p)S!=="ref"&&(b[S]=p[S])}if(u=u.defaultProps){b===p&&(b=T({},b));for(var k in u)b[k]===void 0&&(b[k]=u[k])}return b}function bp(u){Rc(u)}function t_(u){console.error(u)}function I0(u){Rc(u)}function rd(u,p){try{var b=u.onUncaughtError;b(p.value,{componentStack:p.stack})}catch(S){setTimeout(function(){throw S})}}function R0(u,p,b){try{var S=u.onCaughtError;S(b.value,{componentStack:b.stack,errorBoundary:p.tag===1?p.stateNode:null})}catch(k){setTimeout(function(){throw k})}}function xp(u,p,b){return b=Fa(b),b.tag=3,b.payload={element:null},b.callback=function(){rd(u,p)},b}function r_(u){return u=Fa(u),u.tag=3,u}function n_(u,p,b,S){var k=b.type.getDerivedStateFromError;if(typeof k=="function"){var z=S.value;u.payload=function(){return k(z)},u.callback=function(){R0(p,b,S)}}var J=b.stateNode;J!==null&&typeof J.componentDidCatch=="function"&&(u.callback=function(){R0(p,b,S),typeof k!="function"&&(Xc===null?Xc=new Set([this]):Xc.add(this));var he=S.stack;this.componentDidCatch(S.value,{componentStack:he!==null?he:""})})}function nd(u,p,b,S,k){if(b.flags|=32768,S!==null&&typeof S=="object"&&typeof S.then=="function"){if(p=b.alternate,p!==null&&Ri(p,b,k,!0),b=$s.current,b!==null){switch(b.tag){case 31:case 13:return ei===null?cd():b.alternate===null&&Ti===0&&(Ti=3),b.flags&=-257,b.flags|=65536,b.lanes=k,S===Zo?b.flags|=16384:(p=b.updateQueue,p===null?b.updateQueue=new Set([S]):p.add(S),M_(u,S,k)),!1;case 22:return b.flags|=65536,S===Zo?b.flags|=16384:(p=b.updateQueue,p===null?(p={transitions:null,markerInstances:null,retryQueue:new Set([S])},b.updateQueue=p):(b=p.retryQueue,b===null?p.retryQueue=new Set([S]):b.add(S)),M_(u,S,k)),!1}throw Error(n(435,b.tag))}return M_(u,S,k),cd(),!1}if($r)return p=$s.current,p!==null?((p.flags&65536)===0&&(p.flags|=256),p.flags|=65536,p.lanes=k,S!==Vo&&(u=Error(n(422),{cause:S}),Ho(Fs(u,b)))):(S!==Vo&&(p=Error(n(423),{cause:S}),Ho(Fs(p,b))),u=u.current.alternate,u.flags|=65536,k&=-k,u.lanes|=k,S=Fs(S,b),k=xp(u.stateNode,S,k),Vh(u,k),Ti!==4&&(Ti=2)),!1;var z=Error(n(520),{cause:S});if(z=Fs(z,b),Np===null?Np=[z]:Np.push(z),Ti!==4&&(Ti=2),p===null)return!0;S=Fs(S,b),b=p;do{switch(b.tag){case 3:return b.flags|=65536,u=k&-k,b.lanes|=u,u=xp(b.stateNode,S,u),Vh(b,u),!1;case 1:if(p=b.type,z=b.stateNode,(b.flags&128)===0&&(typeof p.getDerivedStateFromError=="function"||z!==null&&typeof z.componentDidCatch=="function"&&(Xc===null||!Xc.has(z))))return b.flags|=65536,k&=-k,b.lanes|=k,k=r_(k),n_(k,u,b,S),Vh(b,k),!1}b=b.return}while(b!==null);return!1}var i_=Error(n(461)),Yn=!1;function $i(u,p,b,S){p.child=u===null?jh(p,null,b,S):ql(p,u.child,b,S)}function wp(u,p,b,S,k){b=b.render;var z=p.ref;if("ref"in S){var J={};for(var he in S)he!=="ref"&&(J[he]=S[he])}else J=S;return Go(p),S=C(u,p,b,J,z,k),he=H(),u!==null&&!Yn?(W(u,p,k),Vc(u,p,k)):($r&&he&&Dh(p),p.flags|=1,$i(u,p,S,k),p.child)}function O0(u,p,b,S,k){if(u===null){var z=b.type;return typeof z=="function"&&!uo(z)&&z.defaultProps===void 0&&b.compare===null?(p.tag=15,p.type=z,k0(u,p,z,S,k)):(u=Ih(b.type,null,S,p,p.mode,k),u.ref=p.ref,u.return=p,p.child=u)}if(z=u.child,!fm(u,k)){var J=z.memoizedProps;if(b=b.compare,b=b!==null?b:ta,b(J,S)&&u.ref===p.ref)return Vc(u,p,k)}return p.flags|=1,u=ho(z,S),u.ref=p.ref,u.return=p,p.child=u}function k0(u,p,b,S,k){if(u!==null){var z=u.memoizedProps;if(ta(z,S)&&u.ref===p.ref)if(Yn=!1,p.pendingProps=S=z,fm(u,k))(u.flags&131072)!==0&&(Yn=!0);else return p.lanes=u.lanes,Vc(u,p,k)}return o_(u,p,b,S,k)}function D0(u,p,b,S){var k=S.children,z=u!==null?u.memoizedState:null;if(u===null&&p.stateNode===null&&(p.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),S.mode==="hidden"){if((p.flags&128)!==0){if(z=z!==null?z.baseLanes|b:b,u!==null){for(S=p.child=u.child,k=0;S!==null;)k=k|S.lanes|S.childLanes,S=S.sibling;S=k&~z}else S=0,p.child=null;return s_(u,p,z,b,S)}if((b&536870912)!==0)p.memoizedState={baseLanes:0,cachePool:null},u!==null&&Ht(p,z!==null?z.cachePool:null),z!==null?_p(p,z):Mu(),bn(p);else return S=p.lanes=536870912,s_(u,p,z!==null?z.baseLanes|b:b,b,S)}else z!==null?(Ht(p,z.cachePool),_p(p,z),an(),p.memoizedState=null):(u!==null&&Ht(p,null),Mu(),an());return $i(u,p,k,b),p.child}function Tp(u,p){return u!==null&&u.tag===22||p.stateNode!==null||(p.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),p.sibling}function s_(u,p,b,S,k){var z=js();return z=z===null?null:{parent:Zn._currentValue,pool:z},p.memoizedState={baseLanes:b,cachePool:z},u!==null&&Ht(p,null),Mu(),bn(p),u!==null&&Ri(u,p,S,!0),p.childLanes=k,null}function id(u,p){return p=Ep({mode:p.mode,children:p.children},u.mode),p.ref=u.ref,u.child=p,p.return=u,p}function a_(u,p,b){return ql(p,u.child,null,b),u=id(p,p.pendingProps),u.flags|=2,os(p),p.memoizedState=null,u}function L0(u,p,b){var S=p.pendingProps,k=(p.flags&128)!==0;if(p.flags&=-129,u===null){if($r){if(S.mode==="hidden")return u=id(p,S),p.lanes=536870912,Tp(null,u);if(Xl(p),(u=vn)?(u=db(u,Hr),u=u!==null&&u.data==="&"?u:null,u!==null&&(p.memoizedState={dehydrated:u,treeContext:po!==null?{id:as,overflow:ya}:null,retryLane:536870912,hydrationErrors:null},b=Oh(u),b.return=p,p.child=b,vi=p,vn=null)):u=null,u===null)throw bi(p);return p.lanes=536870912,null}return id(p,S)}var z=u.memoizedState;if(z!==null){var J=z.dehydrated;if(Xl(p),k)if(p.flags&256)p.flags&=-257,p=a_(u,p,b);else if(p.memoizedState!==null)p.child=u.child,p.flags|=128,p=null;else throw Error(n(558));else if(Yn||Ri(u,p,b,!1),k=(b&u.childLanes)!==0,Yn||k){if(S=In,S!==null&&(J=Jn(S,b),J!==0&&J!==z.retryLane))throw z.retryLane=J,Ul(u,J),Sa(S,u,J),i_;cd(),p=a_(u,p,b)}else u=z.treeContext,vn=$a(J.nextSibling),vi=p,$r=!0,go=null,Hr=!1,u!==null&&dp(p,u),p=id(p,S),p.flags|=4096;return p}return u=ho(u.child,{mode:S.mode,children:S.children}),u.ref=p.ref,p.child=u,u.return=p,u}function cm(u,p){var b=p.ref;if(b===null)u!==null&&u.ref!==null&&(p.flags|=4194816);else{if(typeof b!="function"&&typeof b!="object")throw Error(n(284));(u===null||u.ref!==b)&&(p.flags|=4194816)}}function o_(u,p,b,S,k){return Go(p),b=C(u,p,b,S,void 0,k),S=H(),u!==null&&!Yn?(W(u,p,k),Vc(u,p,k)):($r&&S&&Dh(p),p.flags|=1,$i(u,p,b,k),p.child)}function l_(u,p,b,S,k,z){return Go(p),p.updateQueue=null,b=B(p,S,b,k),I(u),S=H(),u!==null&&!Yn?(W(u,p,z),Vc(u,p,z)):($r&&S&&Dh(p),p.flags|=1,$i(u,p,b,z),p.child)}function c_(u,p,b,S,k){if(Go(p),p.stateNode===null){var z=co,J=b.contextType;typeof J=="object"&&J!==null&&(z=ji(J)),z=new b(S,z),p.memoizedState=z.state!==null&&z.state!==void 0?z.state:null,z.updater=om,p.stateNode=z,z._reactInternals=p,z=p.stateNode,z.props=S,z.state=p.memoizedState,z.refs={},Qr(p),J=b.contextType,z.context=typeof J=="object"&&J!==null?ji(J):co,z.state=p.memoizedState,J=b.getDerivedStateFromProps,typeof J=="function"&&(jc(p,b,J,S),z.state=p.memoizedState),typeof b.getDerivedStateFromProps=="function"||typeof z.getSnapshotBeforeUpdate=="function"||typeof z.UNSAFE_componentWillMount!="function"&&typeof z.componentWillMount!="function"||(J=z.state,typeof z.componentWillMount=="function"&&z.componentWillMount(),typeof z.UNSAFE_componentWillMount=="function"&&z.UNSAFE_componentWillMount(),J!==z.state&&om.enqueueReplaceState(z,z.state,null),Vs(p,S,z,k),$h(),z.state=p.memoizedState),typeof z.componentDidMount=="function"&&(p.flags|=4194308),S=!0}else if(u===null){z=p.stateNode;var he=p.memoizedProps,Be=Bu(b,he);z.props=Be;var ut=z.context,xt=b.contextType;J=co,typeof xt=="object"&&xt!==null&&(J=ji(xt));var It=b.getDerivedStateFromProps;xt=typeof It=="function"||typeof z.getSnapshotBeforeUpdate=="function",he=p.pendingProps!==he,xt||typeof z.UNSAFE_componentWillReceiveProps!="function"&&typeof z.componentWillReceiveProps!="function"||(he||ut!==J)&&lm(p,z,S,J),vs=!1;var ht=p.memoizedState;z.state=ht,Vs(p,S,z,k),$h(),ut=p.memoizedState,he||ht!==ut||vs?(typeof It=="function"&&(jc(p,b,It,S),ut=p.memoizedState),(Be=vs||M0(p,b,Be,S,ht,ut,J))?(xt||typeof z.UNSAFE_componentWillMount!="function"&&typeof z.componentWillMount!="function"||(typeof z.componentWillMount=="function"&&z.componentWillMount(),typeof z.UNSAFE_componentWillMount=="function"&&z.UNSAFE_componentWillMount()),typeof z.componentDidMount=="function"&&(p.flags|=4194308)):(typeof z.componentDidMount=="function"&&(p.flags|=4194308),p.memoizedProps=S,p.memoizedState=ut),z.props=S,z.state=ut,z.context=J,S=Be):(typeof z.componentDidMount=="function"&&(p.flags|=4194308),S=!1)}else{z=p.stateNode,yp(u,p),J=p.memoizedProps,xt=Bu(b,J),z.props=xt,It=p.pendingProps,ht=z.context,ut=b.contextType,Be=co,typeof ut=="object"&&ut!==null&&(Be=ji(ut)),he=b.getDerivedStateFromProps,(ut=typeof he=="function"||typeof z.getSnapshotBeforeUpdate=="function")||typeof z.UNSAFE_componentWillReceiveProps!="function"&&typeof z.componentWillReceiveProps!="function"||(J!==It||ht!==Be)&&lm(p,z,S,Be),vs=!1,ht=p.memoizedState,z.state=ht,Vs(p,S,z,k),$h();var pt=p.memoizedState;J!==It||ht!==pt||vs||u!==null&&u.dependencies!==null&&qo(u.dependencies)?(typeof he=="function"&&(jc(p,b,he,S),pt=p.memoizedState),(xt=vs||M0(p,b,xt,S,ht,pt,Be)||u!==null&&u.dependencies!==null&&qo(u.dependencies))?(ut||typeof z.UNSAFE_componentWillUpdate!="function"&&typeof z.componentWillUpdate!="function"||(typeof z.componentWillUpdate=="function"&&z.componentWillUpdate(S,pt,Be),typeof z.UNSAFE_componentWillUpdate=="function"&&z.UNSAFE_componentWillUpdate(S,pt,Be)),typeof z.componentDidUpdate=="function"&&(p.flags|=4),typeof z.getSnapshotBeforeUpdate=="function"&&(p.flags|=1024)):(typeof z.componentDidUpdate!="function"||J===u.memoizedProps&&ht===u.memoizedState||(p.flags|=4),typeof z.getSnapshotBeforeUpdate!="function"||J===u.memoizedProps&&ht===u.memoizedState||(p.flags|=1024),p.memoizedProps=S,p.memoizedState=pt),z.props=S,z.state=pt,z.context=Be,S=xt):(typeof z.componentDidUpdate!="function"||J===u.memoizedProps&&ht===u.memoizedState||(p.flags|=4),typeof z.getSnapshotBeforeUpdate!="function"||J===u.memoizedProps&&ht===u.memoizedState||(p.flags|=1024),S=!1)}return z=S,cm(u,p),S=(p.flags&128)!==0,z||S?(z=p.stateNode,b=S&&typeof b.getDerivedStateFromError!="function"?null:z.render(),p.flags|=1,u!==null&&S?(p.child=ql(p,u.child,null,k),p.child=ql(p,null,b,k)):$i(u,p,b,k),p.memoizedState=z.state,u=p.child):u=Vc(u,p,k),u}function B0(u,p,b,S){return na(),p.flags|=256,$i(u,p,b,S),p.child}var Sp={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function um(u){return{baseLanes:u,cachePool:Xf()}}function Ap(u,p,b){return u=u!==null?u.childLanes&~b:0,p&&(u|=wa),u}function sd(u,p,b){var S=p.pendingProps,k=!1,z=(p.flags&128)!==0,J;if((J=z)||(J=u!==null&&u.memoizedState===null?!1:(Dn.current&2)!==0),J&&(k=!0,p.flags&=-129),J=(p.flags&32)!==0,p.flags&=-33,u===null){if($r){if(k?Hs(p):an(),(u=vn)?(u=db(u,Hr),u=u!==null&&u.data!=="&"?u:null,u!==null&&(p.memoizedState={dehydrated:u,treeContext:po!==null?{id:as,overflow:ya}:null,retryLane:536870912,hydrationErrors:null},b=Oh(u),b.return=p,p.child=b,vi=p,vn=null)):u=null,u===null)throw bi(p);return Wi(u)?p.lanes=32:p.lanes=536870912,null}var he=S.children;return S=S.fallback,k?(an(),k=p.mode,he=Ep({mode:"hidden",children:he},k),S=Oc(S,k,b,null),he.return=p,S.return=p,he.sibling=S,p.child=he,S=p.child,S.memoizedState=um(b),S.childLanes=Ap(u,J,b),p.memoizedState=Sp,Tp(null,S)):(Hs(p),xs(p,he))}var Be=u.memoizedState;if(Be!==null&&(he=Be.dehydrated,he!==null)){if(z)p.flags&256?(Hs(p),p.flags&=-257,p=Cp(u,p,b)):p.memoizedState!==null?(an(),p.child=u.child,p.flags|=128,p=null):(an(),he=S.fallback,k=p.mode,S=Ep({mode:"visible",children:S.children},k),he=Oc(he,k,b,null),he.flags|=2,S.return=p,he.return=p,S.sibling=he,p.child=S,ql(p,u.child,null,b),S=p.child,S.memoizedState=um(b),S.childLanes=Ap(u,J,b),p.memoizedState=Sp,p=Tp(null,S));else if(Hs(p),Wi(he)){if(J=he.nextSibling&&he.nextSibling.dataset,J)var ut=J.dgst;J=ut,S=Error(n(419)),S.stack="",S.digest=J,Ho({value:S,source:null,stack:null}),p=Cp(u,p,b)}else if(Yn||Ri(u,p,b,!1),J=(b&u.childLanes)!==0,Yn||J){if(J=In,J!==null&&(S=Jn(J,b),S!==0&&S!==Be.retryLane))throw Be.retryLane=S,Ul(u,S),Sa(J,u,S),i_;Gu(he)||cd(),p=Cp(u,p,b)}else Gu(he)?(p.flags|=192,p.child=u.child,p=null):(u=Be.treeContext,vn=$a(he.nextSibling),vi=p,$r=!0,go=null,Hr=!1,u!==null&&dp(p,u),p=xs(p,S.children),p.flags|=4096);return p}return k?(an(),he=S.fallback,k=p.mode,Be=u.child,ut=Be.sibling,S=ho(Be,{mode:"hidden",children:S.children}),S.subtreeFlags=Be.subtreeFlags&65011712,ut!==null?he=ho(ut,he):(he=Oc(he,k,b,null),he.flags|=2),he.return=p,S.return=p,S.sibling=he,p.child=S,Tp(null,S),S=p.child,he=u.child.memoizedState,he===null?he=um(b):(k=he.cachePool,k!==null?(Be=Zn._currentValue,k=k.parent!==Be?{parent:Be,pool:Be}:k):k=Xf(),he={baseLanes:he.baseLanes|b,cachePool:k}),S.memoizedState=he,S.childLanes=Ap(u,J,b),p.memoizedState=Sp,Tp(u.child,S)):(Hs(p),b=u.child,u=b.sibling,b=ho(b,{mode:"visible",children:S.children}),b.return=p,b.sibling=null,u!==null&&(J=p.deletions,J===null?(p.deletions=[u],p.flags|=16):J.push(u)),p.child=b,p.memoizedState=null,b)}function xs(u,p){return p=Ep({mode:"visible",children:p},u.mode),p.return=u,u.child=p}function Ep(u,p){return u=zs(22,u,null,p),u.lanes=0,u}function Cp(u,p,b){return ql(p,u.child,null,b),u=xs(p,p.pendingProps.children),u.flags|=2,p.memoizedState=null,u}function N0(u,p,b){u.lanes|=p;var S=u.alternate;S!==null&&(S.lanes|=p),Hl(u.return,p,b)}function hm(u,p,b,S,k,z){var J=u.memoizedState;J===null?u.memoizedState={isBackwards:p,rendering:null,renderingStartTime:0,last:S,tail:b,tailMode:k,treeForkCount:z}:(J.isBackwards=p,J.rendering=null,J.renderingStartTime=0,J.last=S,J.tail=b,J.tailMode=k,J.treeForkCount=z)}function z0(u,p,b){var S=p.pendingProps,k=S.revealOrder,z=S.tail;S=S.children;var J=Dn.current,he=(J&2)!==0;if(he?(J=J&1|2,p.flags|=128):J&=1,rt(Dn,J),$i(u,p,S,b),S=$r?jo:0,!he&&u!==null&&(u.flags&128)!==0)e:for(u=p.child;u!==null;){if(u.tag===13)u.memoizedState!==null&&N0(u,b,p);else if(u.tag===19)N0(u,b,p);else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===p)break e;for(;u.sibling===null;){if(u.return===null||u.return===p)break e;u=u.return}u.sibling.return=u.return,u=u.sibling}switch(k){case"forwards":for(b=p.child,k=null;b!==null;)u=b.alternate,u!==null&&bo(u)===null&&(k=b),b=b.sibling;b=k,b===null?(k=p.child,p.child=null):(k=b.sibling,b.sibling=null),hm(p,!1,k,b,z,S);break;case"backwards":case"unstable_legacy-backwards":for(b=null,k=p.child,p.child=null;k!==null;){if(u=k.alternate,u!==null&&bo(u)===null){p.child=k;break}u=k.sibling,k.sibling=b,b=k,k=u}hm(p,!0,b,null,z,S);break;case"together":hm(p,!1,null,null,void 0,S);break;default:p.memoizedState=null}return p.child}function Vc(u,p,b){if(u!==null&&(p.dependencies=u.dependencies),qc|=p.lanes,(b&p.childLanes)===0)if(u!==null){if(Ri(u,p,b,!1),(b&p.childLanes)===0)return null}else return null;if(u!==null&&p.child!==u.child)throw Error(n(153));if(p.child!==null){for(u=p.child,b=ho(u,u.pendingProps),p.child=b,b.return=p;u.sibling!==null;)u=u.sibling,b=b.sibling=ho(u,u.pendingProps),b.return=p;b.sibling=null}return p.child}function fm(u,p){return(u.lanes&p)!==0?!0:(u=u.dependencies,!!(u!==null&&qo(u)))}function Tw(u,p,b){switch(p.tag){case 3:nr(p,p.stateNode.containerInfo),Wo(p,Zn,u.memoizedState.cache),na();break;case 27:case 5:Wt(p);break;case 4:nr(p,p.stateNode.containerInfo);break;case 10:Wo(p,p.type,p.memoizedProps.value);break;case 31:if(p.memoizedState!==null)return p.flags|=128,Xl(p),null;break;case 13:var S=p.memoizedState;if(S!==null)return S.dehydrated!==null?(Hs(p),p.flags|=128,null):(b&p.child.childLanes)!==0?sd(u,p,b):(Hs(p),u=Vc(u,p,b),u!==null?u.sibling:null);Hs(p);break;case 19:var k=(u.flags&128)!==0;if(S=(b&p.childLanes)!==0,S||(Ri(u,p,b,!1),S=(b&p.childLanes)!==0),k){if(S)return z0(u,p,b);p.flags|=128}if(k=p.memoizedState,k!==null&&(k.rendering=null,k.tail=null,k.lastEffect=null),rt(Dn,Dn.current),S)break;return null;case 22:return p.lanes=0,D0(u,p,b,p.pendingProps);case 24:Wo(p,Zn,u.memoizedState.cache)}return Vc(u,p,b)}function dm(u,p,b){if(u!==null)if(u.memoizedProps!==p.pendingProps)Yn=!0;else{if(!fm(u,b)&&(p.flags&128)===0)return Yn=!1,Tw(u,p,b);Yn=(u.flags&131072)!==0}else Yn=!1,$r&&(p.flags&1048576)!==0&&kh(p,jo,p.index);switch(p.lanes=0,p.tag){case 16:e:{var S=p.pendingProps;if(u=Yo(p.elementType),p.type=u,typeof u=="function")uo(u)?(S=Bu(u,S),p.tag=1,p=c_(null,p,u,S,b)):(p.tag=0,p=o_(null,p,u,S,b));else{if(u!=null){var k=u.$$typeof;if(k===ae){p.tag=11,p=wp(null,p,u,S,b);break e}else if(k===Le){p.tag=14,p=O0(null,p,u,S,b);break e}}throw p=Ot(u)||u,Error(n(306,p,""))}}return p;case 0:return o_(u,p,p.type,p.pendingProps,b);case 1:return S=p.type,k=Bu(S,p.pendingProps),c_(u,p,S,k,b);case 3:e:{if(nr(p,p.stateNode.containerInfo),u===null)throw Error(n(387));S=p.pendingProps;var z=p.memoizedState;k=z.element,yp(u,p),Vs(p,S,null,b);var J=p.memoizedState;if(S=J.cache,Wo(p,Zn,S),S!==z.cache&&ia(p,[Zn],b,!0),$h(),S=J.element,z.isDehydrated)if(z={element:S,isDehydrated:!1,cache:J.cache},p.updateQueue.baseState=z,p.memoizedState=z,p.flags&256){p=B0(u,p,S,b);break e}else if(S!==k){k=Fs(Error(n(424)),p),Ho(k),p=B0(u,p,S,b);break e}else{switch(u=p.stateNode.containerInfo,u.nodeType){case 9:u=u.body;break;default:u=u.nodeName==="HTML"?u.ownerDocument.body:u}for(vn=$a(u.firstChild),vi=p,$r=!0,go=null,Hr=!0,b=jh(p,null,S,b),p.child=b;b;)b.flags=b.flags&-3|4096,b=b.sibling}else{if(na(),S===k){p=Vc(u,p,b);break e}$i(u,p,S,b)}p=p.child}return p;case 26:return cm(u,p),u===null?(b=f(p.type,null,p.pendingProps,null))?p.memoizedState=b:$r||(b=p.type,u=p.pendingProps,S=Gp($t.current).createElement(b),S[Pt]=p,S[lr]=u,oi(S,b,u),ni(S),p.stateNode=S):p.memoizedState=f(p.type,u.memoizedProps,p.pendingProps,u.memoizedState),null;case 27:return Wt(p),u===null&&$r&&(S=p.stateNode=W_(p.type,p.pendingProps,$t.current),vi=p,Hr=!0,k=vn,Yc(p.type)?(Um=k,vn=$a(S.firstChild)):vn=k),$i(u,p,p.pendingProps.children,b),cm(u,p),u===null&&(p.flags|=4194304),p.child;case 5:return u===null&&$r&&((k=S=vn)&&(S=Lw(S,p.type,p.pendingProps,Hr),S!==null?(p.stateNode=S,vi=p,vn=$a(S.firstChild),Hr=!1,k=!0):k=!1),k||bi(p)),Wt(p),k=p.type,z=p.pendingProps,J=u!==null?u.memoizedProps:null,S=z.children,Nm(k,z)?S=null:J!==null&&Nm(k,J)&&(p.flags|=32),p.memoizedState!==null&&(k=C(u,p,N,null,null,b),St._currentValue=k),cm(u,p),$i(u,p,S,b),p.child;case 6:return u===null&&$r&&((u=b=vn)&&(b=Bw(b,p.pendingProps,Hr),b!==null?(p.stateNode=b,vi=p,vn=null,u=!0):u=!1),u||bi(p)),null;case 13:return sd(u,p,b);case 4:return nr(p,p.stateNode.containerInfo),S=p.pendingProps,u===null?p.child=ql(p,null,S,b):$i(u,p,S,b),p.child;case 11:return wp(u,p,p.type,p.pendingProps,b);case 7:return $i(u,p,p.pendingProps,b),p.child;case 8:return $i(u,p,p.pendingProps.children,b),p.child;case 12:return $i(u,p,p.pendingProps.children,b),p.child;case 10:return S=p.pendingProps,Wo(p,p.type,S.value),$i(u,p,S.children,b),p.child;case 9:return k=p.type._context,S=p.pendingProps.children,Go(p),k=ji(k),S=S(k),p.flags|=1,$i(u,p,S,b),p.child;case 14:return O0(u,p,p.type,p.pendingProps,b);case 15:return k0(u,p,p.type,p.pendingProps,b);case 19:return z0(u,p,b);case 31:return L0(u,p,b);case 22:return D0(u,p,b,p.pendingProps);case 24:return Go(p),S=ji(Zn),u===null?(k=js(),k===null&&(k=In,z=Us(),k.pooledCache=z,z.refCount++,z!==null&&(k.pooledCacheLanes|=b),k=z),p.memoizedState={parent:S,cache:k},Qr(p),Wo(p,Zn,k)):((u.lanes&b)!==0&&(yp(u,p),Vs(p,null,null,b),$h()),k=u.memoizedState,z=p.memoizedState,k.parent!==S?(k={parent:S,cache:S},p.memoizedState=k,p.lanes===0&&(p.memoizedState=p.updateQueue.baseState=k),Wo(p,Zn,S)):(S=z.cache,Wo(p,Zn,S),S!==k.cache&&ia(p,[Zn],b,!0))),$i(u,p,p.pendingProps.children,b),p.child;case 29:throw p.pendingProps}throw Error(n(156,p.tag))}function Jl(u){u.flags|=4}function pm(u,p,b,S,k){if((p=(u.mode&32)!==0)&&(p=!1),p){if(u.flags|=16777216,(k&335544128)===k)if(u.stateNode.complete)u.flags|=8192;else if(Q0())u.flags|=8192;else throw Wl=Zo,Fh}else u.flags&=-16777217}function F0(u,p){if(p.type!=="stylesheet"||(p.state.loading&4)!==0)u.flags&=-16777217;else if(u.flags|=16777216,!le(p))if(Q0())u.flags|=8192;else throw Wl=Zo,Fh}function gm(u,p){p!==null&&(u.flags|=4),u.flags&16384&&(p=u.tag!==22?mn():536870912,u.lanes|=p,Zh|=p)}function Pp(u,p){if(!$r)switch(u.tailMode){case"hidden":p=u.tail;for(var b=null;p!==null;)p.alternate!==null&&(b=p),p=p.sibling;b===null?u.tail=null:b.sibling=null;break;case"collapsed":b=u.tail;for(var S=null;b!==null;)b.alternate!==null&&(S=b),b=b.sibling;S===null?p||u.tail===null?u.tail=null:u.tail.sibling=null:S.sibling=null}}function Pn(u){var p=u.alternate!==null&&u.alternate.child===u.child,b=0,S=0;if(p)for(var k=u.child;k!==null;)b|=k.lanes|k.childLanes,S|=k.subtreeFlags&65011712,S|=k.flags&65011712,k.return=u,k=k.sibling;else for(k=u.child;k!==null;)b|=k.lanes|k.childLanes,S|=k.subtreeFlags,S|=k.flags,k.return=u,k=k.sibling;return u.subtreeFlags|=S,u.childLanes=b,p}function u_(u,p,b){var S=p.pendingProps;switch(Hf(p),p.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Pn(p),null;case 1:return Pn(p),null;case 3:return b=p.stateNode,S=null,u!==null&&(S=u.memoizedState.cache),p.memoizedState.cache!==S&&(p.flags|=2048),yo(Zn),Et(),b.pendingContext&&(b.context=b.pendingContext,b.pendingContext=null),(u===null||u.child===null)&&(Vl(p)?Jl(p):u===null||u.memoizedState.isDehydrated&&(p.flags&256)===0||(p.flags|=1024,$o())),Pn(p),null;case 26:var k=p.type,z=p.memoizedState;return u===null?(Jl(p),z!==null?(Pn(p),F0(p,z)):(Pn(p),pm(p,k,null,S,b))):z?z!==u.memoizedState?(Jl(p),Pn(p),F0(p,z)):(Pn(p),p.flags&=-16777217):(u=u.memoizedProps,u!==S&&Jl(p),Pn(p),pm(p,k,u,S,b)),null;case 27:if(mr(p),b=$t.current,k=p.type,u!==null&&p.stateNode!=null)u.memoizedProps!==S&&Jl(p);else{if(!S){if(p.stateNode===null)throw Error(n(166));return Pn(p),null}u=vt.current,Vl(p)?Lh(p):(u=W_(k,S,b),p.stateNode=u,Jl(p))}return Pn(p),null;case 5:if(mr(p),k=p.type,u!==null&&p.stateNode!=null)u.memoizedProps!==S&&Jl(p);else{if(!S){if(p.stateNode===null)throw Error(n(166));return Pn(p),null}if(z=vt.current,Vl(p))Lh(p);else{var J=Gp($t.current);switch(z){case 1:z=J.createElementNS("http://www.w3.org/2000/svg",k);break;case 2:z=J.createElementNS("http://www.w3.org/1998/Math/MathML",k);break;default:switch(k){case"svg":z=J.createElementNS("http://www.w3.org/2000/svg",k);break;case"math":z=J.createElementNS("http://www.w3.org/1998/Math/MathML",k);break;case"script":z=J.createElement("div"),z.innerHTML="<script><\/script>",z=z.removeChild(z.firstChild);break;case"select":z=typeof S.is=="string"?J.createElement("select",{is:S.is}):J.createElement("select"),S.multiple?z.multiple=!0:S.size&&(z.size=S.size);break;default:z=typeof S.is=="string"?J.createElement(k,{is:S.is}):J.createElement(k)}}z[Pt]=p,z[lr]=S;e:for(J=p.child;J!==null;){if(J.tag===5||J.tag===6)z.appendChild(J.stateNode);else if(J.tag!==4&&J.tag!==27&&J.child!==null){J.child.return=J,J=J.child;continue}if(J===p)break e;for(;J.sibling===null;){if(J.return===null||J.return===p)break e;J=J.return}J.sibling.return=J.return,J=J.sibling}p.stateNode=z;e:switch(oi(z,k,S),k){case"button":case"input":case"select":case"textarea":S=!!S.autoFocus;break e;case"img":S=!0;break e;default:S=!1}S&&Jl(p)}}return Pn(p),pm(p,p.type,u===null?null:u.memoizedProps,p.pendingProps,b),null;case 6:if(u&&p.stateNode!=null)u.memoizedProps!==S&&Jl(p);else{if(typeof S!="string"&&p.stateNode===null)throw Error(n(166));if(u=$t.current,Vl(p)){if(u=p.stateNode,b=p.memoizedProps,S=null,k=vi,k!==null)switch(k.tag){case 27:case 5:S=k.memoizedProps}u[Pt]=p,u=!!(u.nodeValue===b||S!==null&&S.suppressHydrationWarning===!0||Aa(u.nodeValue,b)),u||bi(p,!0)}else u=Gp(u).createTextNode(S),u[Pt]=p,p.stateNode=u}return Pn(p),null;case 31:if(b=p.memoizedState,u===null||u.memoizedState!==null){if(S=Vl(p),b!==null){if(u===null){if(!S)throw Error(n(318));if(u=p.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(n(557));u[Pt]=p}else na(),(p.flags&128)===0&&(p.memoizedState=null),p.flags|=4;Pn(p),u=!1}else b=$o(),u!==null&&u.memoizedState!==null&&(u.memoizedState.hydrationErrors=b),u=!0;if(!u)return p.flags&256?(os(p),p):(os(p),null);if((p.flags&128)!==0)throw Error(n(558))}return Pn(p),null;case 13:if(S=p.memoizedState,u===null||u.memoizedState!==null&&u.memoizedState.dehydrated!==null){if(k=Vl(p),S!==null&&S.dehydrated!==null){if(u===null){if(!k)throw Error(n(318));if(k=p.memoizedState,k=k!==null?k.dehydrated:null,!k)throw Error(n(317));k[Pt]=p}else na(),(p.flags&128)===0&&(p.memoizedState=null),p.flags|=4;Pn(p),k=!1}else k=$o(),u!==null&&u.memoizedState!==null&&(u.memoizedState.hydrationErrors=k),k=!0;if(!k)return p.flags&256?(os(p),p):(os(p),null)}return os(p),(p.flags&128)!==0?(p.lanes=b,p):(b=S!==null,u=u!==null&&u.memoizedState!==null,b&&(S=p.child,k=null,S.alternate!==null&&S.alternate.memoizedState!==null&&S.alternate.memoizedState.cachePool!==null&&(k=S.alternate.memoizedState.cachePool.pool),z=null,S.memoizedState!==null&&S.memoizedState.cachePool!==null&&(z=S.memoizedState.cachePool.pool),z!==k&&(S.flags|=2048)),b!==u&&b&&(p.child.flags|=8192),gm(p,p.updateQueue),Pn(p),null);case 4:return Et(),u===null&&Dm(p.stateNode.containerInfo),Pn(p),null;case 10:return yo(p.type),Pn(p),null;case 19:if(Pe(Dn),S=p.memoizedState,S===null)return Pn(p),null;if(k=(p.flags&128)!==0,z=S.rendering,z===null)if(k)Pp(S,!1);else{if(Ti!==0||u!==null&&(u.flags&128)!==0)for(u=p.child;u!==null;){if(z=bo(u),z!==null){for(p.flags|=128,Pp(S,!1),u=z.updateQueue,p.updateQueue=u,gm(p,u),p.subtreeFlags=0,u=b,b=p.child;b!==null;)rm(b,u),b=b.sibling;return rt(Dn,Dn.current&1|2),$r&&ra(p,S.treeForkCount),p.child}u=u.sibling}S.tail!==null&&Ei()>Tm&&(p.flags|=128,k=!0,Pp(S,!1),p.lanes=4194304)}else{if(!k)if(u=bo(z),u!==null){if(p.flags|=128,k=!0,u=u.updateQueue,p.updateQueue=u,gm(p,u),Pp(S,!0),S.tail===null&&S.tailMode==="hidden"&&!z.alternate&&!$r)return Pn(p),null}else 2*Ei()-S.renderingStartTime>Tm&&b!==536870912&&(p.flags|=128,k=!0,Pp(S,!1),p.lanes=4194304);S.isBackwards?(z.sibling=p.child,p.child=z):(u=S.last,u!==null?u.sibling=z:p.child=z,S.last=z)}return S.tail!==null?(u=S.tail,S.rendering=u,S.tail=u.sibling,S.renderingStartTime=Ei(),u.sibling=null,b=Dn.current,rt(Dn,k?b&1|2:b&1),$r&&ra(p,S.treeForkCount),u):(Pn(p),null);case 22:case 23:return os(p),Vi(),S=p.memoizedState!==null,u!==null?u.memoizedState!==null!==S&&(p.flags|=8192):S&&(p.flags|=8192),S?(b&536870912)!==0&&(p.flags&128)===0&&(Pn(p),p.subtreeFlags&6&&(p.flags|=8192)):Pn(p),b=p.updateQueue,b!==null&&gm(p,b.retryQueue),b=null,u!==null&&u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(b=u.memoizedState.cachePool.pool),S=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(S=p.memoizedState.cachePool.pool),S!==b&&(p.flags|=2048),u!==null&&Pe(aa),null;case 24:return b=null,u!==null&&(b=u.memoizedState.cache),p.memoizedState.cache!==b&&(p.flags|=2048),yo(Zn),Pn(p),null;case 25:return null;case 30:return null}throw Error(n(156,p.tag))}function U0(u,p){switch(Hf(p),p.tag){case 1:return u=p.flags,u&65536?(p.flags=u&-65537|128,p):null;case 3:return yo(Zn),Et(),u=p.flags,(u&65536)!==0&&(u&128)===0?(p.flags=u&-65537|128,p):null;case 26:case 27:case 5:return mr(p),null;case 31:if(p.memoizedState!==null){if(os(p),p.alternate===null)throw Error(n(340));na()}return u=p.flags,u&65536?(p.flags=u&-65537|128,p):null;case 13:if(os(p),u=p.memoizedState,u!==null&&u.dehydrated!==null){if(p.alternate===null)throw Error(n(340));na()}return u=p.flags,u&65536?(p.flags=u&-65537|128,p):null;case 19:return Pe(Dn),null;case 4:return Et(),null;case 10:return yo(p.type),null;case 22:case 23:return os(p),Vi(),u!==null&&Pe(aa),u=p.flags,u&65536?(p.flags=u&-65537|128,p):null;case 24:return yo(Zn),null;case 25:return null;default:return null}}function Nu(u,p){switch(Hf(p),p.tag){case 3:yo(Zn),Et();break;case 26:case 27:case 5:mr(p);break;case 4:Et();break;case 31:p.memoizedState!==null&&os(p);break;case 13:os(p);break;case 19:Pe(Dn);break;case 10:yo(p.type);break;case 22:case 23:os(p),Vi(),u!==null&&Pe(aa);break;case 24:yo(Zn)}}function $c(u,p){try{var b=p.updateQueue,S=b!==null?b.lastEffect:null;if(S!==null){var k=S.next;b=k;do{if((b.tag&u)===u){S=void 0;var z=b.create,J=b.inst;S=z(),J.destroy=S}b=b.next}while(b!==k)}}catch(he){Sn(p,p.return,he)}}function zu(u,p,b){try{var S=p.updateQueue,k=S!==null?S.lastEffect:null;if(k!==null){var z=k.next;S=z;do{if((S.tag&u)===u){var J=S.inst,he=J.destroy;if(he!==void 0){J.destroy=void 0,k=p;var Be=b,ut=he;try{ut()}catch(xt){Sn(k,Be,xt)}}}S=S.next}while(S!==z)}}catch(xt){Sn(p,p.return,xt)}}function j0(u){var p=u.updateQueue;if(p!==null){var b=u.stateNode;try{Qt(p,b)}catch(S){Sn(u,u.return,S)}}}function V0(u,p,b){b.props=Bu(u.type,u.memoizedProps),b.state=u.memoizedState;try{b.componentWillUnmount()}catch(S){Sn(u,p,S)}}function Mp(u,p){try{var b=u.ref;if(b!==null){switch(u.tag){case 26:case 27:case 5:var S=u.stateNode;break;case 30:S=u.stateNode;break;default:S=u.stateNode}typeof b=="function"?u.refCleanup=b(S):b.current=S}}catch(k){Sn(u,p,k)}}function ec(u,p){var b=u.ref,S=u.refCleanup;if(b!==null)if(typeof S=="function")try{S()}catch(k){Sn(u,p,k)}finally{u.refCleanup=null,u=u.alternate,u!=null&&(u.refCleanup=null)}else if(typeof b=="function")try{b(null)}catch(k){Sn(u,p,k)}else b.current=null}function $0(u){var p=u.type,b=u.memoizedProps,S=u.stateNode;try{e:switch(p){case"button":case"input":case"select":case"textarea":b.autoFocus&&S.focus();break e;case"img":b.src?S.src=b.src:b.srcSet&&(S.srcset=b.srcSet)}}catch(k){Sn(u,u.return,k)}}function h_(u,p,b){try{var S=u.stateNode;lb(S,u.type,b,p),S[lr]=p}catch(k){Sn(u,u.return,k)}}function mm(u){return u.tag===5||u.tag===3||u.tag===26||u.tag===27&&Yc(u.type)||u.tag===4}function f_(u){e:for(;;){for(;u.sibling===null;){if(u.return===null||mm(u.return))return null;u=u.return}for(u.sibling.return=u.return,u=u.sibling;u.tag!==5&&u.tag!==6&&u.tag!==18;){if(u.tag===27&&Yc(u.type)||u.flags&2||u.child===null||u.tag===4)continue e;u.child.return=u,u=u.child}if(!(u.flags&2))return u.stateNode}}function ym(u,p,b){var S=u.tag;if(S===5||S===6)u=u.stateNode,p?(b.nodeType===9?b.body:b.nodeName==="HTML"?b.ownerDocument.body:b).insertBefore(u,p):(p=b.nodeType===9?b.body:b.nodeName==="HTML"?b.ownerDocument.body:b,p.appendChild(u),b=b._reactRootContainer,b!=null||p.onclick!==null||(p.onclick=ga));else if(S!==4&&(S===27&&Yc(u.type)&&(b=u.stateNode,p=null),u=u.child,u!==null))for(ym(u,p,b),u=u.sibling;u!==null;)ym(u,p,b),u=u.sibling}function Fu(u,p,b){var S=u.tag;if(S===5||S===6)u=u.stateNode,p?b.insertBefore(u,p):b.appendChild(u);else if(S!==4&&(S===27&&Yc(u.type)&&(b=u.stateNode),u=u.child,u!==null))for(Fu(u,p,b),u=u.sibling;u!==null;)Fu(u,p,b),u=u.sibling}function H0(u){var p=u.stateNode,b=u.memoizedProps;try{for(var S=u.type,k=p.attributes;k.length;)p.removeAttributeNode(k[0]);oi(p,S,b),p[Pt]=u,p[lr]=b}catch(z){Sn(u,u.return,z)}}var fn=!1,Kn=!1,_m=!1,Ip=typeof WeakSet=="function"?WeakSet:Set,ki=null;function Rp(u,p){if(u=u.containerInfo,Bm=pr,u=lp(u),Th(u)){if("selectionStart"in u)var b={start:u.selectionStart,end:u.selectionEnd};else e:{b=(b=u.ownerDocument)&&b.defaultView||window;var S=b.getSelection&&b.getSelection();if(S&&S.rangeCount!==0){b=S.anchorNode;var k=S.anchorOffset,z=S.focusNode;S=S.focusOffset;try{b.nodeType,z.nodeType}catch{b=null;break e}var J=0,he=-1,Be=-1,ut=0,xt=0,It=u,ht=null;t:for(;;){for(var pt;It!==b||k!==0&&It.nodeType!==3||(he=J+k),It!==z||S!==0&&It.nodeType!==3||(Be=J+S),It.nodeType===3&&(J+=It.nodeValue.length),(pt=It.firstChild)!==null;)ht=It,It=pt;for(;;){if(It===u)break t;if(ht===b&&++ut===k&&(he=J),ht===z&&++xt===S&&(Be=J),(pt=It.nextSibling)!==null)break;It=ht,ht=It.parentNode}It=pt}b=he===-1||Be===-1?null:{start:he,end:Be}}else b=null}b=b||{start:0,end:0}}else b=null;for(j_={focusedElem:u,selectionRange:b},pr=!1,ki=p;ki!==null;)if(p=ki,u=p.child,(p.subtreeFlags&1028)!==0&&u!==null)u.return=p,ki=u;else for(;ki!==null;){switch(p=ki,z=p.alternate,u=p.flags,p.tag){case 0:if((u&4)!==0&&(u=p.updateQueue,u=u!==null?u.events:null,u!==null))for(b=0;b<u.length;b++)k=u[b],k.ref.impl=k.nextImpl;break;case 11:case 15:break;case 1:if((u&1024)!==0&&z!==null){u=void 0,b=p,k=z.memoizedProps,z=z.memoizedState,S=b.stateNode;try{var ir=Bu(b.type,k);u=S.getSnapshotBeforeUpdate(ir,z),S.__reactInternalSnapshotBeforeUpdate=u}catch(vr){Sn(b,b.return,vr)}}break;case 3:if((u&1024)!==0){if(u=p.stateNode.containerInfo,b=u.nodeType,b===9)yd(u);else if(b===1)switch(u.nodeName){case"HEAD":case"HTML":case"BODY":yd(u);break;default:u.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((u&1024)!==0)throw Error(n(163))}if(u=p.sibling,u!==null){u.return=p.return,ki=u;break}ki=p.return}}function d_(u,p,b){var S=b.flags;switch(b.tag){case 0:case 11:case 15:tc(u,b),S&4&&$c(5,b);break;case 1:if(tc(u,b),S&4)if(u=b.stateNode,p===null)try{u.componentDidMount()}catch(J){Sn(b,b.return,J)}else{var k=Bu(b.type,p.memoizedProps);p=p.memoizedState;try{u.componentDidUpdate(k,p,u.__reactInternalSnapshotBeforeUpdate)}catch(J){Sn(b,b.return,J)}}S&64&&j0(b),S&512&&Mp(b,b.return);break;case 3:if(tc(u,b),S&64&&(u=b.updateQueue,u!==null)){if(p=null,b.child!==null)switch(b.child.tag){case 27:case 5:p=b.child.stateNode;break;case 1:p=b.child.stateNode}try{Qt(u,p)}catch(J){Sn(b,b.return,J)}}break;case 27:p===null&&S&4&&H0(b);case 26:case 5:tc(u,b),p===null&&S&4&&$0(b),S&512&&Mp(b,b.return);break;case 12:tc(u,b);break;case 31:tc(u,b),S&4&&Gh(u,b);break;case 13:tc(u,b),S&4&&ad(u,b),S&64&&(u=b.memoizedState,u!==null&&(u=u.dehydrated,u!==null&&(b=Mw.bind(null,b),H_(u,b))));break;case 22:if(S=b.memoizedState!==null||fn,!S){p=p!==null&&p.memoizedState!==null||Kn,k=fn;var z=Kn;fn=S,(Kn=p)&&!z?Hc(u,b,(b.subtreeFlags&8772)!==0):tc(u,b),fn=k,Kn=z}break;case 30:break;default:tc(u,b)}}function p_(u){var p=u.alternate;p!==null&&(u.alternate=null,p_(p)),u.child=null,u.deletions=null,u.sibling=null,u.tag===5&&(p=u.stateNode,p!==null&&Ka(p)),u.stateNode=null,u.return=null,u.dependencies=null,u.memoizedProps=null,u.memoizedState=null,u.pendingProps=null,u.stateNode=null,u.updateQueue=null}var Mn=null,Gs=!1;function ba(u,p,b){for(b=b.child;b!==null;)Op(u,p,b),b=b.sibling}function Op(u,p,b){if(ke&&typeof ke.onCommitFiberUnmount=="function")try{ke.onCommitFiberUnmount(Me,b)}catch{}switch(b.tag){case 26:Kn||ec(b,p),ba(u,p,b),b.memoizedState?b.memoizedState.count--:b.stateNode&&(b=b.stateNode,b.parentNode.removeChild(b));break;case 27:Kn||ec(b,p);var S=Mn,k=Gs;Yc(b.type)&&(Mn=b.stateNode,Gs=!1),ba(u,p,b),_d(b.stateNode),Mn=S,Gs=k;break;case 5:Kn||ec(b,p);case 6:if(S=Mn,k=Gs,Mn=null,ba(u,p,b),Mn=S,Gs=k,Mn!==null)if(Gs)try{(Mn.nodeType===9?Mn.body:Mn.nodeName==="HTML"?Mn.ownerDocument.body:Mn).removeChild(b.stateNode)}catch(z){Sn(b,p,z)}else try{Mn.removeChild(b.stateNode)}catch(z){Sn(b,p,z)}break;case 18:Mn!==null&&(Gs?(u=Mn,Xp(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,b.stateNode),bd(u)):Xp(Mn,b.stateNode));break;case 4:S=Mn,k=Gs,Mn=b.stateNode.containerInfo,Gs=!0,ba(u,p,b),Mn=S,Gs=k;break;case 0:case 11:case 14:case 15:zu(2,b,p),Kn||zu(4,b,p),ba(u,p,b);break;case 1:Kn||(ec(b,p),S=b.stateNode,typeof S.componentWillUnmount=="function"&&V0(b,p,S)),ba(u,p,b);break;case 21:ba(u,p,b);break;case 22:Kn=(S=Kn)||b.memoizedState!==null,ba(u,p,b),Kn=S;break;default:ba(u,p,b)}}function Gh(u,p){if(p.memoizedState===null&&(u=p.alternate,u!==null&&(u=u.memoizedState,u!==null))){u=u.dehydrated;try{bd(u)}catch(b){Sn(p,p.return,b)}}}function ad(u,p){if(p.memoizedState===null&&(u=p.alternate,u!==null&&(u=u.memoizedState,u!==null&&(u=u.dehydrated,u!==null))))try{bd(u)}catch(b){Sn(p,p.return,b)}}function Sw(u){switch(u.tag){case 31:case 13:case 19:var p=u.stateNode;return p===null&&(p=u.stateNode=new Ip),p;case 22:return u=u.stateNode,p=u._retryCache,p===null&&(p=u._retryCache=new Ip),p;default:throw Error(n(435,u.tag))}}function kp(u,p){var b=Sw(u);p.forEach(function(S){if(!b.has(S)){b.add(S);var k=nb.bind(null,u,S);S.then(k,k)}})}function Hi(u,p){var b=p.deletions;if(b!==null)for(var S=0;S<b.length;S++){var k=b[S],z=u,J=p,he=J;e:for(;he!==null;){switch(he.tag){case 27:if(Yc(he.type)){Mn=he.stateNode,Gs=!1;break e}break;case 5:Mn=he.stateNode,Gs=!1;break e;case 3:case 4:Mn=he.stateNode.containerInfo,Gs=!0;break e}he=he.return}if(Mn===null)throw Error(n(160));Op(z,J,k),Mn=null,Gs=!1,z=k.alternate,z!==null&&(z.return=null),k.return=null}if(p.subtreeFlags&13886)for(p=p.child;p!==null;)g_(p,u),p=p.sibling}var el=null;function g_(u,p){var b=u.alternate,S=u.flags;switch(u.tag){case 0:case 11:case 14:case 15:Hi(p,u),cs(u),S&4&&(zu(3,u,u.return),$c(3,u),zu(5,u,u.return));break;case 1:Hi(p,u),cs(u),S&512&&(Kn||b===null||ec(b,b.return)),S&64&&fn&&(u=u.updateQueue,u!==null&&(S=u.callbacks,S!==null&&(b=u.shared.hiddenCallbacks,u.shared.hiddenCallbacks=b===null?S:b.concat(S))));break;case 26:var k=el;if(Hi(p,u),cs(u),S&512&&(Kn||b===null||ec(b,b.return)),S&4){var z=b!==null?b.memoizedState:null;if(S=u.memoizedState,b===null)if(S===null)if(u.stateNode===null){e:{S=u.type,b=u.memoizedProps,k=k.ownerDocument||k;t:switch(S){case"title":z=k.getElementsByTagName("title")[0],(!z||z[Ml]||z[Pt]||z.namespaceURI==="http://www.w3.org/2000/svg"||z.hasAttribute("itemprop"))&&(z=k.createElement(S),k.head.insertBefore(z,k.querySelector("head > title"))),oi(z,S,b),z[Pt]=u,ni(z),S=z;break e;case"link":var J=ee("link","href",k).get(S+(b.href||""));if(J){for(var he=0;he<J.length;he++)if(z=J[he],z.getAttribute("href")===(b.href==null||b.href===""?null:b.href)&&z.getAttribute("rel")===(b.rel==null?null:b.rel)&&z.getAttribute("title")===(b.title==null?null:b.title)&&z.getAttribute("crossorigin")===(b.crossOrigin==null?null:b.crossOrigin)){J.splice(he,1);break t}}z=k.createElement(S),oi(z,S,b),k.head.appendChild(z);break;case"meta":if(J=ee("meta","content",k).get(S+(b.content||""))){for(he=0;he<J.length;he++)if(z=J[he],z.getAttribute("content")===(b.content==null?null:""+b.content)&&z.getAttribute("name")===(b.name==null?null:b.name)&&z.getAttribute("property")===(b.property==null?null:b.property)&&z.getAttribute("http-equiv")===(b.httpEquiv==null?null:b.httpEquiv)&&z.getAttribute("charset")===(b.charSet==null?null:b.charSet)){J.splice(he,1);break t}}z=k.createElement(S),oi(z,S,b),k.head.appendChild(z);break;default:throw Error(n(468,S))}z[Pt]=u,ni(z),S=z}u.stateNode=S}else re(k,u.type,u.stateNode);else u.stateNode=R(k,S,u.memoizedProps);else z!==S?(z===null?b.stateNode!==null&&(b=b.stateNode,b.parentNode.removeChild(b)):z.count--,S===null?re(k,u.type,u.stateNode):R(k,S,u.memoizedProps)):S===null&&u.stateNode!==null&&h_(u,u.memoizedProps,b.memoizedProps)}break;case 27:Hi(p,u),cs(u),S&512&&(Kn||b===null||ec(b,b.return)),b!==null&&S&4&&h_(u,u.memoizedProps,b.memoizedProps);break;case 5:if(Hi(p,u),cs(u),S&512&&(Kn||b===null||ec(b,b.return)),u.flags&32){k=u.stateNode;try{ts(k,"")}catch(ir){Sn(u,u.return,ir)}}S&4&&u.stateNode!=null&&(k=u.memoizedProps,h_(u,k,b!==null?b.memoizedProps:k)),S&1024&&(_m=!0);break;case 6:if(Hi(p,u),cs(u),S&4){if(u.stateNode===null)throw Error(n(162));S=u.memoizedProps,b=u.stateNode;try{b.nodeValue=S}catch(ir){Sn(u,u.return,ir)}}break;case 3:if(G=null,k=el,el=vd(p.containerInfo),Hi(p,u),el=k,cs(u),S&4&&b!==null&&b.memoizedState.isDehydrated)try{bd(p.containerInfo)}catch(ir){Sn(u,u.return,ir)}_m&&(_m=!1,vm(u));break;case 4:S=el,el=vd(u.stateNode.containerInfo),Hi(p,u),cs(u),el=S;break;case 12:Hi(p,u),cs(u);break;case 31:Hi(p,u),cs(u),S&4&&(S=u.updateQueue,S!==null&&(u.updateQueue=null,kp(u,S)));break;case 13:Hi(p,u),cs(u),u.child.flags&8192&&u.memoizedState!==null!=(b!==null&&b.memoizedState!==null)&&(zp=Ei()),S&4&&(S=u.updateQueue,S!==null&&(u.updateQueue=null,kp(u,S)));break;case 22:k=u.memoizedState!==null;var Be=b!==null&&b.memoizedState!==null,ut=fn,xt=Kn;if(fn=ut||k,Kn=xt||Be,Hi(p,u),Kn=xt,fn=ut,cs(u),S&8192)e:for(p=u.stateNode,p._visibility=k?p._visibility&-2:p._visibility|1,k&&(b===null||Be||fn||Kn||Uu(u)),b=null,p=u;;){if(p.tag===5||p.tag===26){if(b===null){Be=b=p;try{if(z=Be.stateNode,k)J=z.style,typeof J.setProperty=="function"?J.setProperty("display","none","important"):J.display="none";else{he=Be.stateNode;var It=Be.memoizedProps.style,ht=It!=null&&It.hasOwnProperty("display")?It.display:null;he.style.display=ht==null||typeof ht=="boolean"?"":(""+ht).trim()}}catch(ir){Sn(Be,Be.return,ir)}}}else if(p.tag===6){if(b===null){Be=p;try{Be.stateNode.nodeValue=k?"":Be.memoizedProps}catch(ir){Sn(Be,Be.return,ir)}}}else if(p.tag===18){if(b===null){Be=p;try{var pt=Be.stateNode;k?Zp(pt,!0):Zp(Be.stateNode,!1)}catch(ir){Sn(Be,Be.return,ir)}}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===u)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===u)break e;for(;p.sibling===null;){if(p.return===null||p.return===u)break e;b===p&&(b=null),p=p.return}b===p&&(b=null),p.sibling.return=p.return,p=p.sibling}S&4&&(S=u.updateQueue,S!==null&&(b=S.retryQueue,b!==null&&(S.retryQueue=null,kp(u,b))));break;case 19:Hi(p,u),cs(u),S&4&&(S=u.updateQueue,S!==null&&(u.updateQueue=null,kp(u,S)));break;case 30:break;case 21:break;default:Hi(p,u),cs(u)}}function cs(u){var p=u.flags;if(p&2){try{for(var b,S=u.return;S!==null;){if(mm(S)){b=S;break}S=S.return}if(b==null)throw Error(n(160));switch(b.tag){case 27:var k=b.stateNode,z=f_(u);Fu(u,z,k);break;case 5:var J=b.stateNode;b.flags&32&&(ts(J,""),b.flags&=-33);var he=f_(u);Fu(u,he,J);break;case 3:case 4:var Be=b.stateNode.containerInfo,ut=f_(u);ym(u,ut,Be);break;default:throw Error(n(161))}}catch(xt){Sn(u,u.return,xt)}u.flags&=-3}p&4096&&(u.flags&=-4097)}function vm(u){if(u.subtreeFlags&1024)for(u=u.child;u!==null;){var p=u;vm(p),p.tag===5&&p.flags&1024&&p.stateNode.reset(),u=u.sibling}}function tc(u,p){if(p.subtreeFlags&8772)for(p=p.child;p!==null;)d_(u,p.alternate,p),p=p.sibling}function Uu(u){for(u=u.child;u!==null;){var p=u;switch(p.tag){case 0:case 11:case 14:case 15:zu(4,p,p.return),Uu(p);break;case 1:ec(p,p.return);var b=p.stateNode;typeof b.componentWillUnmount=="function"&&V0(p,p.return,b),Uu(p);break;case 27:_d(p.stateNode);case 26:case 5:ec(p,p.return),Uu(p);break;case 22:p.memoizedState===null&&Uu(p);break;case 30:Uu(p);break;default:Uu(p)}u=u.sibling}}function Hc(u,p,b){for(b=b&&(p.subtreeFlags&8772)!==0,p=p.child;p!==null;){var S=p.alternate,k=u,z=p,J=z.flags;switch(z.tag){case 0:case 11:case 15:Hc(k,z,b),$c(4,z);break;case 1:if(Hc(k,z,b),S=z,k=S.stateNode,typeof k.componentDidMount=="function")try{k.componentDidMount()}catch(ut){Sn(S,S.return,ut)}if(S=z,k=S.updateQueue,k!==null){var he=S.stateNode;try{var Be=k.shared.hiddenCallbacks;if(Be!==null)for(k.shared.hiddenCallbacks=null,k=0;k<Be.length;k++)Hh(Be[k],he)}catch(ut){Sn(S,S.return,ut)}}b&&J&64&&j0(z),Mp(z,z.return);break;case 27:H0(z);case 26:case 5:Hc(k,z,b),b&&S===null&&J&4&&$0(z),Mp(z,z.return);break;case 12:Hc(k,z,b);break;case 31:Hc(k,z,b),b&&J&4&&Gh(k,z);break;case 13:Hc(k,z,b),b&&J&4&&ad(k,z);break;case 22:z.memoizedState===null&&Hc(k,z,b),Mp(z,z.return);break;case 30:break;default:Hc(k,z,b)}p=p.sibling}}function m_(u,p){var b=null;u!==null&&u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(b=u.memoizedState.cachePool.pool),u=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(u=p.memoizedState.cachePool.pool),u!==b&&(u!=null&&u.refCount++,b!=null&&Oi(b))}function y_(u,p){u=null,p.alternate!==null&&(u=p.alternate.memoizedState.cache),p=p.memoizedState.cache,p!==u&&(p.refCount++,u!=null&&Oi(u))}function tl(u,p,b,S){if(p.subtreeFlags&10256)for(p=p.child;p!==null;)W0(u,p,b,S),p=p.sibling}function W0(u,p,b,S){var k=p.flags;switch(p.tag){case 0:case 11:case 15:tl(u,p,b,S),k&2048&&$c(9,p);break;case 1:tl(u,p,b,S);break;case 3:tl(u,p,b,S),k&2048&&(u=null,p.alternate!==null&&(u=p.alternate.memoizedState.cache),p=p.memoizedState.cache,p!==u&&(p.refCount++,u!=null&&Oi(u)));break;case 12:if(k&2048){tl(u,p,b,S),u=p.stateNode;try{var z=p.memoizedProps,J=z.id,he=z.onPostCommit;typeof he=="function"&&he(J,p.alternate===null?"mount":"update",u.passiveEffectDuration,-0)}catch(Be){Sn(p,p.return,Be)}}else tl(u,p,b,S);break;case 31:tl(u,p,b,S);break;case 13:tl(u,p,b,S);break;case 23:break;case 22:z=p.stateNode,J=p.alternate,p.memoizedState!==null?z._visibility&2?tl(u,p,b,S):Dp(u,p):z._visibility&2?tl(u,p,b,S):(z._visibility|=2,rl(u,p,b,S,(p.subtreeFlags&10256)!==0||!1)),k&2048&&m_(J,p);break;case 24:tl(u,p,b,S),k&2048&&y_(p.alternate,p);break;default:tl(u,p,b,S)}}function rl(u,p,b,S,k){for(k=k&&((p.subtreeFlags&10256)!==0||!1),p=p.child;p!==null;){var z=u,J=p,he=b,Be=S,ut=J.flags;switch(J.tag){case 0:case 11:case 15:rl(z,J,he,Be,k),$c(8,J);break;case 23:break;case 22:var xt=J.stateNode;J.memoizedState!==null?xt._visibility&2?rl(z,J,he,Be,k):Dp(z,J):(xt._visibility|=2,rl(z,J,he,Be,k)),k&&ut&2048&&m_(J.alternate,J);break;case 24:rl(z,J,he,Be,k),k&&ut&2048&&y_(J.alternate,J);break;default:rl(z,J,he,Be,k)}p=p.sibling}}function Dp(u,p){if(p.subtreeFlags&10256)for(p=p.child;p!==null;){var b=u,S=p,k=S.flags;switch(S.tag){case 22:Dp(b,S),k&2048&&m_(S.alternate,S);break;case 24:Dp(b,S),k&2048&&y_(S.alternate,S);break;default:Dp(b,S)}p=p.sibling}}var Lp=8192;function Xh(u,p,b){if(u.subtreeFlags&Lp)for(u=u.child;u!==null;)q0(u,p,b),u=u.sibling}function q0(u,p,b){switch(u.tag){case 26:Xh(u,p,b),u.flags&Lp&&u.memoizedState!==null&&de(b,el,u.memoizedState,u.memoizedProps);break;case 5:Xh(u,p,b);break;case 3:case 4:var S=el;el=vd(u.stateNode.containerInfo),Xh(u,p,b),el=S;break;case 22:u.memoizedState===null&&(S=u.alternate,S!==null&&S.memoizedState!==null?(S=Lp,Lp=16777216,Xh(u,p,b),Lp=S):Xh(u,p,b));break;default:Xh(u,p,b)}}function __(u){var p=u.alternate;if(p!==null&&(u=p.child,u!==null)){p.child=null;do p=u.sibling,u.sibling=null,u=p;while(u!==null)}}function Bp(u){var p=u.deletions;if((u.flags&16)!==0){if(p!==null)for(var b=0;b<p.length;b++){var S=p[b];ki=S,xm(S,u)}__(u)}if(u.subtreeFlags&10256)for(u=u.child;u!==null;)bm(u),u=u.sibling}function bm(u){switch(u.tag){case 0:case 11:case 15:Bp(u),u.flags&2048&&zu(9,u,u.return);break;case 3:Bp(u);break;case 12:Bp(u);break;case 22:var p=u.stateNode;u.memoizedState!==null&&p._visibility&2&&(u.return===null||u.return.tag!==13)?(p._visibility&=-3,ju(u)):Bp(u);break;default:Bp(u)}}function ju(u){var p=u.deletions;if((u.flags&16)!==0){if(p!==null)for(var b=0;b<p.length;b++){var S=p[b];ki=S,xm(S,u)}__(u)}for(u=u.child;u!==null;){switch(p=u,p.tag){case 0:case 11:case 15:zu(8,p,p.return),ju(p);break;case 22:b=p.stateNode,b._visibility&2&&(b._visibility&=-3,ju(p));break;default:ju(p)}u=u.sibling}}function xm(u,p){for(;ki!==null;){var b=ki;switch(b.tag){case 0:case 11:case 15:zu(8,b,p);break;case 23:case 22:if(b.memoizedState!==null&&b.memoizedState.cachePool!==null){var S=b.memoizedState.cachePool.pool;S!=null&&S.refCount++}break;case 24:Oi(b.memoizedState.cache)}if(S=b.child,S!==null)S.return=b,ki=S;else e:for(b=u;ki!==null;){S=ki;var k=S.sibling,z=S.return;if(p_(S),S===b){ki=null;break e}if(k!==null){k.return=z,ki=k;break e}ki=z}}}var Aw={getCacheForType:function(u){var p=ji(Zn),b=p.data.get(u);return b===void 0&&(b=u(),p.data.set(u,b)),b},cacheSignal:function(){return ji(Zn).controller.signal}},Ew=typeof WeakMap=="function"?WeakMap:Map,ln=0,In=null,Xr=null,Zr=0,en=0,xa=null,Vu=!1,od=!1,v_=!1,Wc=0,Ti=0,qc=0,Gc=0,wm=0,wa=0,Zh=0,Np=null,ws=null,b_=!1,zp=0,G0=0,Tm=1/0,Sm=null,Xc=null,Qi=0,$u=null,rc=null,Rn=0,Fp=0,Am=null,x_=null,Yh=0,Hu=null;function Ta(){return(ln&2)!==0&&Zr!==0?Zr&-Zr:ce.T!==null?Om():ks()}function X0(){if(wa===0)if((Zr&536870912)===0||$r){var u=Xt;Xt<<=1,(Xt&3932160)===0&&(Xt=262144),wa=u}else wa=536870912;return u=$s.current,u!==null&&(u.flags|=32),wa}function Sa(u,p,b){(u===In&&(en===2||en===9)||u.cancelPendingCommit!==null)&&(ld(u,0),Wu(u,Zr,wa,!1)),Hn(u,b),((ln&2)===0||u!==In)&&(u===In&&((ln&2)===0&&(Gc|=b),Ti===4&&Wu(u,Zr,wa,!1)),Eo(u))}function Z0(u,p,b){if((ln&6)!==0)throw Error(n(327));var S=!b&&(p&127)===0&&(p&u.expiredLanes)===0||er(u,p),k=S?Up(u,p):Cm(u,p,!0),z=S;do{if(k===0){od&&!S&&Wu(u,p,0,!1);break}else{if(b=u.current.alternate,z&&!Cw(b)){k=Cm(u,p,!1),z=!1;continue}if(k===2){if(z=p,u.errorRecoveryDisabledLanes&z)var J=0;else J=u.pendingLanes&-536870913,J=J!==0?J:J&536870912?536870912:0;if(J!==0){p=J;e:{var he=u;k=Np;var Be=he.current.memoizedState.isDehydrated;if(Be&&(ld(he,J).flags|=256),J=Cm(he,J,!1),J!==2){if(v_&&!Be){he.errorRecoveryDisabledLanes|=z,Gc|=z,k=4;break e}z=ws,ws=k,z!==null&&(ws===null?ws=z:ws.push.apply(ws,z))}k=J}if(z=!1,k!==2)continue}}if(k===1){ld(u,0),Wu(u,p,0,!0);break}e:{switch(S=u,z=k,z){case 0:case 1:throw Error(n(345));case 4:if((p&4194048)!==p)break;case 6:Wu(S,p,wa,!Vu);break e;case 2:ws=null;break;case 3:case 5:break;default:throw Error(n(329))}if((p&62914560)===p&&(k=zp+300-Ei(),10<k)){if(Wu(S,p,wa,!Vu),Ir(S,0,!0)!==0)break e;Rn=p,S.timeoutHandle=hb(Y0.bind(null,S,b,ws,Sm,b_,p,wa,Gc,Zh,Vu,z,"Throttled",-0,0),k);break e}Y0(S,b,ws,Sm,b_,p,wa,Gc,Zh,Vu,z,null,-0,0)}}break}while(!0);Eo(u)}function Y0(u,p,b,S,k,z,J,he,Be,ut,xt,It,ht,pt){if(u.timeoutHandle=-1,It=p.subtreeFlags,It&8192||(It&16785408)===16785408){It={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:ga},q0(p,z,It);var ir=(z&62914560)===z?zp-Ei():(z&4194048)===z?G0-Ei():0;if(ir=$e(It,ir),ir!==null){Rn=z,u.cancelPendingCommit=ir(A_.bind(null,u,p,z,b,S,k,J,he,Be,xt,It,null,ht,pt)),Wu(u,z,J,!ut);return}}A_(u,p,z,b,S,k,J,he,Be)}function Cw(u){for(var p=u;;){var b=p.tag;if((b===0||b===11||b===15)&&p.flags&16384&&(b=p.updateQueue,b!==null&&(b=b.stores,b!==null)))for(var S=0;S<b.length;S++){var k=b[S],z=k.getSnapshot;k=k.value;try{if(!is(z(),k))return!1}catch{return!1}}if(b=p.child,p.subtreeFlags&16384&&b!==null)b.return=p,p=b;else{if(p===u)break;for(;p.sibling===null;){if(p.return===null||p.return===u)return!0;p=p.return}p.sibling.return=p.return,p=p.sibling}}return!0}function Wu(u,p,b,S){p&=~wm,p&=~Gc,u.suspendedLanes|=p,u.pingedLanes&=~p,S&&(u.warmLanes|=p),S=u.expirationTimes;for(var k=p;0<k;){var z=31-Qe(k),J=1<<z;S[z]=-1,k&=~J}b!==0&&yi(u,b,p)}function Em(){return(ln&6)===0?($p(0),!1):!0}function w_(){if(Xr!==null){if(en===0)var u=Xr.return;else u=Xr,mo=$l=null,K(u),Bc=null,Cu=0,u=Xr;for(;u!==null;)Nu(u.alternate,u),u=u.return;Xr=null}}function ld(u,p){var b=u.timeoutHandle;b!==-1&&(u.timeoutHandle=-1,Dw(b)),b=u.cancelPendingCommit,b!==null&&(u.cancelPendingCommit=null,b()),Rn=0,w_(),In=u,Xr=b=ho(u.current,null),Zr=p,en=0,xa=null,Vu=!1,od=er(u,p),v_=!1,Zh=wa=wm=Gc=qc=Ti=0,ws=Np=null,b_=!1,(p&8)!==0&&(p|=p&32);var S=u.entangledLanes;if(S!==0)for(u=u.entanglements,S&=p;0<S;){var k=31-Qe(S),z=1<<k;p|=u[k],S&=~z}return Wc=p,Mh(),b}function K0(u,p){Pr=null,ce.H=td,p===Xo||p===vo?(p=Yf(),en=3):p===Fh?(p=Yf(),en=4):en=p===i_?8:p!==null&&typeof p=="object"&&typeof p.then=="function"?6:1,xa=p,Xr===null&&(Ti=1,rd(u,Fs(p,u.current)))}function Q0(){var u=$s.current;return u===null?!0:(Zr&4194048)===Zr?ei===null:(Zr&62914560)===Zr||(Zr&536870912)!==0?u===ei:!1}function J0(){var u=ce.H;return ce.H=td,u===null?td:u}function T_(){var u=ce.A;return ce.A=Aw,u}function cd(){Ti=4,Vu||(Zr&4194048)!==Zr&&$s.current!==null||(od=!0),(qc&134217727)===0&&(Gc&134217727)===0||In===null||Wu(In,Zr,wa,!1)}function Cm(u,p,b){var S=ln;ln|=2;var k=J0(),z=T_();(In!==u||Zr!==p)&&(Sm=null,ld(u,p)),p=!1;var J=Ti;e:do try{if(en!==0&&Xr!==null){var he=Xr,Be=xa;switch(en){case 8:w_(),J=6;break e;case 3:case 2:case 9:case 6:$s.current===null&&(p=!0);var ut=en;if(en=0,xa=null,hd(u,he,Be,ut),b&&od){J=0;break e}break;default:ut=en,en=0,xa=null,hd(u,he,Be,ut)}}qu(),J=Ti;break}catch(xt){K0(u,xt)}while(!0);return p&&u.shellSuspendCounter++,mo=$l=null,ln=S,ce.H=k,ce.A=z,Xr===null&&(In=null,Zr=0,Mh()),J}function qu(){for(;Xr!==null;)jp(Xr)}function Up(u,p){var b=ln;ln|=2;var S=J0(),k=T_();In!==u||Zr!==p?(Sm=null,Tm=Ei()+500,ld(u,p)):od=er(u,p);e:do try{if(en!==0&&Xr!==null){p=Xr;var z=xa;t:switch(en){case 1:en=0,xa=null,hd(u,p,z,1);break;case 2:case 9:if(Zf(z)){en=0,xa=null,Vp(p);break}p=function(){en!==2&&en!==9||In!==u||(en=7),Eo(u)},z.then(p,p);break e;case 3:en=7;break e;case 4:en=5;break e;case 7:Zf(z)?(en=0,xa=null,Vp(p)):(en=0,xa=null,hd(u,p,z,7));break;case 5:var J=null;switch(Xr.tag){case 26:J=Xr.memoizedState;case 5:case 27:var he=Xr;if(J?le(J):he.stateNode.complete){en=0,xa=null;var Be=he.sibling;if(Be!==null)Xr=Be;else{var ut=he.return;ut!==null?(Xr=ut,Pm(ut)):Xr=null}break t}}en=0,xa=null,hd(u,p,z,5);break;case 6:en=0,xa=null,hd(u,p,z,6);break;case 8:w_(),Ti=6;break e;default:throw Error(n(462))}}ud();break}catch(xt){K0(u,xt)}while(!0);return mo=$l=null,ce.H=S,ce.A=k,ln=b,Xr!==null?0:(In=null,Zr=0,Mh(),Ti)}function ud(){for(;Xr!==null&&!Sl();)jp(Xr)}function jp(u){var p=dm(u.alternate,u,Wc);u.memoizedProps=u.pendingProps,p===null?Pm(u):Xr=p}function Vp(u){var p=u,b=p.alternate;switch(p.tag){case 15:case 0:p=l_(b,p,p.pendingProps,p.type,void 0,Zr);break;case 11:p=l_(b,p,p.pendingProps,p.type.render,p.ref,Zr);break;case 5:K(p);default:Nu(b,p),p=Xr=rm(p,Wc),p=dm(b,p,Wc)}u.memoizedProps=u.pendingProps,p===null?Pm(u):Xr=p}function hd(u,p,b,S){mo=$l=null,K(p),Bc=null,Cu=0;var k=p.return;try{if(nd(u,k,p,b,Zr)){Ti=1,rd(u,Fs(b,u.current)),Xr=null;return}}catch(z){if(k!==null)throw Xr=k,z;Ti=1,rd(u,Fs(b,u.current)),Xr=null;return}p.flags&32768?($r||S===1?u=!0:od||(Zr&536870912)!==0?u=!1:(Vu=u=!0,(S===2||S===9||S===3||S===6)&&(S=$s.current,S!==null&&S.tag===13&&(S.flags|=16384))),S_(p,u)):Pm(p)}function Pm(u){var p=u;do{if((p.flags&32768)!==0){S_(p,Vu);return}u=p.return;var b=u_(p.alternate,p,Wc);if(b!==null){Xr=b;return}if(p=p.sibling,p!==null){Xr=p;return}Xr=p=u}while(p!==null);Ti===0&&(Ti=5)}function S_(u,p){do{var b=U0(u.alternate,u);if(b!==null){b.flags&=32767,Xr=b;return}if(b=u.return,b!==null&&(b.flags|=32768,b.subtreeFlags=0,b.deletions=null),!p&&(u=u.sibling,u!==null)){Xr=u;return}Xr=u=b}while(u!==null);Ti=6,Xr=null}function A_(u,p,b,S,k,z,J,he,Be){u.cancelPendingCommit=null;do fd();while(Qi!==0);if((ln&6)!==0)throw Error(n(327));if(p!==null){if(p===u.current)throw Error(n(177));if(z=p.lanes|p.childLanes,z|=Su,Ci(u,b,z,J,he,Be),u===In&&(Xr=In=null,Zr=0),rc=p,$u=u,Rn=b,Fp=z,Am=k,x_=S,(p.subtreeFlags&10256)!==0||(p.flags&10256)!==0?(u.callbackNode=null,u.callbackPriority=0,ib(Do,function(){return tb(),null})):(u.callbackNode=null,u.callbackPriority=0),S=(p.flags&13878)!==0,(p.subtreeFlags&13878)!==0||S){S=ce.T,ce.T=null,k=we.p,we.p=2,J=ln,ln|=4;try{Rp(u,p,b)}finally{ln=J,we.p=k,ce.T=S}}Qi=1,eb(),E_(),C_()}}function eb(){if(Qi===1){Qi=0;var u=$u,p=rc,b=(p.flags&13878)!==0;if((p.subtreeFlags&13878)!==0||b){b=ce.T,ce.T=null;var S=we.p;we.p=2;var k=ln;ln|=4;try{g_(p,u);var z=j_,J=lp(u.containerInfo),he=z.focusedElem,Be=z.selectionRange;if(J!==he&&he&&he.ownerDocument&&Uf(he.ownerDocument.documentElement,he)){if(Be!==null&&Th(he)){var ut=Be.start,xt=Be.end;if(xt===void 0&&(xt=ut),"selectionStart"in he)he.selectionStart=ut,he.selectionEnd=Math.min(xt,he.value.length);else{var It=he.ownerDocument||document,ht=It&&It.defaultView||window;if(ht.getSelection){var pt=ht.getSelection(),ir=he.textContent.length,vr=Math.min(Be.start,ir),Wr=Be.end===void 0?vr:Math.min(Be.end,ir);!pt.extend&&vr>Wr&&(J=Wr,Wr=vr,vr=J);var Ke=Ff(he,vr),Ve=Ff(he,Wr);if(Ke&&Ve&&(pt.rangeCount!==1||pt.anchorNode!==Ke.node||pt.anchorOffset!==Ke.offset||pt.focusNode!==Ve.node||pt.focusOffset!==Ve.offset)){var ct=It.createRange();ct.setStart(Ke.node,Ke.offset),pt.removeAllRanges(),vr>Wr?(pt.addRange(ct),pt.extend(Ve.node,Ve.offset)):(ct.setEnd(Ve.node,Ve.offset),pt.addRange(ct))}}}}for(It=[],pt=he;pt=pt.parentNode;)pt.nodeType===1&&It.push({element:pt,left:pt.scrollLeft,top:pt.scrollTop});for(typeof he.focus=="function"&&he.focus(),he=0;he<It.length;he++){var Ct=It[he];Ct.element.scrollLeft=Ct.left,Ct.element.scrollTop=Ct.top}}pr=!!Bm,j_=Bm=null}finally{ln=k,we.p=S,ce.T=b}}u.current=p,Qi=2}}function E_(){if(Qi===2){Qi=0;var u=$u,p=rc,b=(p.flags&8772)!==0;if((p.subtreeFlags&8772)!==0||b){b=ce.T,ce.T=null;var S=we.p;we.p=2;var k=ln;ln|=4;try{d_(u,p.alternate,p)}finally{ln=k,we.p=S,ce.T=b}}Qi=3}}function C_(){if(Qi===4||Qi===3){Qi=0,Al();var u=$u,p=rc,b=Rn,S=x_;(p.subtreeFlags&10256)!==0||(p.flags&10256)!==0?Qi=5:(Qi=0,rc=$u=null,Mm(u,u.pendingLanes));var k=u.pendingLanes;if(k===0&&(Xc=null),Wn(b),p=p.stateNode,ke&&typeof ke.onCommitFiberRoot=="function")try{ke.onCommitFiberRoot(Me,p,void 0,(p.current.flags&128)===128)}catch{}if(S!==null){p=ce.T,k=we.p,we.p=2,ce.T=null;try{for(var z=u.onRecoverableError,J=0;J<S.length;J++){var he=S[J];z(he.value,{componentStack:he.stack})}}finally{ce.T=p,we.p=k}}(Rn&3)!==0&&fd(),Eo(u),k=u.pendingLanes,(b&261930)!==0&&(k&42)!==0?u===Hu?Yh++:(Yh=0,Hu=u):Yh=0,$p(0)}}function Mm(u,p){(u.pooledCacheLanes&=p)===0&&(p=u.pooledCache,p!=null&&(u.pooledCache=null,Oi(p)))}function fd(){return eb(),E_(),C_(),tb()}function tb(){if(Qi!==5)return!1;var u=$u,p=Fp;Fp=0;var b=Wn(Rn),S=ce.T,k=we.p;try{we.p=32>b?32:b,ce.T=null,b=Am,Am=null;var z=$u,J=Rn;if(Qi=0,rc=$u=null,Rn=0,(ln&6)!==0)throw Error(n(331));var he=ln;if(ln|=4,bm(z.current),W0(z,z.current,J,b),ln=he,$p(0,!1),ke&&typeof ke.onPostCommitFiberRoot=="function")try{ke.onPostCommitFiberRoot(Me,z)}catch{}return!0}finally{we.p=k,ce.T=S,Mm(u,p)}}function P_(u,p,b){p=Fs(b,p),p=xp(u.stateNode,p,2),u=Ua(u,p,2),u!==null&&(Hn(u,2),Eo(u))}function Sn(u,p,b){if(u.tag===3)P_(u,u,b);else for(;p!==null;){if(p.tag===3){P_(p,u,b);break}else if(p.tag===1){var S=p.stateNode;if(typeof p.type.getDerivedStateFromError=="function"||typeof S.componentDidCatch=="function"&&(Xc===null||!Xc.has(S))){u=Fs(b,u),b=r_(2),S=Ua(p,b,2),S!==null&&(n_(b,S,p,u),Hn(S,2),Eo(S));break}}p=p.return}}function M_(u,p,b){var S=u.pingCache;if(S===null){S=u.pingCache=new Ew;var k=new Set;S.set(p,k)}else k=S.get(p),k===void 0&&(k=new Set,S.set(p,k));k.has(b)||(v_=!0,k.add(b),u=Pw.bind(null,u,p,b),p.then(u,u))}function Pw(u,p,b){var S=u.pingCache;S!==null&&S.delete(p),u.pingedLanes|=u.suspendedLanes&b,u.warmLanes&=~b,In===u&&(Zr&b)===b&&(Ti===4||Ti===3&&(Zr&62914560)===Zr&&300>Ei()-zp?(ln&2)===0&&ld(u,0):wm|=b,Zh===Zr&&(Zh=0)),Eo(u)}function rb(u,p){p===0&&(p=mn()),u=Ul(u,p),u!==null&&(Hn(u,p),Eo(u))}function Mw(u){var p=u.memoizedState,b=0;p!==null&&(b=p.retryLane),rb(u,b)}function nb(u,p){var b=0;switch(u.tag){case 31:case 13:var S=u.stateNode,k=u.memoizedState;k!==null&&(b=k.retryLane);break;case 19:S=u.stateNode;break;case 22:S=u.stateNode._retryCache;break;default:throw Error(n(314))}S!==null&&S.delete(p),rb(u,b)}function ib(u,p){return Tl(u,p)}var Ao=null,Va=null,Im=!1,dd=!1,I_=!1,nl=0;function Eo(u){u!==Va&&u.next===null&&(Va===null?Ao=Va=u:Va=Va.next=u),dd=!0,Im||(Im=!0,D_())}function $p(u,p){if(!I_&&dd){I_=!0;do for(var b=!1,S=Ao;S!==null;){if(u!==0){var k=S.pendingLanes;if(k===0)var z=0;else{var J=S.suspendedLanes,he=S.pingedLanes;z=(1<<31-Qe(42|u)+1)-1,z&=k&~(J&~he),z=z&201326741?z&201326741|1:z?z|2:0}z!==0&&(b=!0,k_(S,z))}else z=Zr,z=Ir(S,S===In?z:0,S.cancelPendingCommit!==null||S.timeoutHandle!==-1),(z&3)===0||er(S,z)||(b=!0,k_(S,z));S=S.next}while(b);I_=!1}}function R_(){Rm()}function Rm(){dd=Im=!1;var u=0;nl!==0&&ub()&&(u=nl);for(var p=Ei(),b=null,S=Ao;S!==null;){var k=S.next,z=Kh(S,p);z===0?(S.next=null,b===null?Ao=k:b.next=k,k===null&&(Va=b)):(b=S,(u!==0||(z&3)!==0)&&(dd=!0)),S=k}Qi!==0&&Qi!==5||$p(u),nl!==0&&(nl=0)}function Kh(u,p){for(var b=u.suspendedLanes,S=u.pingedLanes,k=u.expirationTimes,z=u.pendingLanes&-62914561;0<z;){var J=31-Qe(z),he=1<<J,Be=k[J];Be===-1?((he&b)===0||(he&S)!==0)&&(k[J]=Ar(he,p)):Be<=p&&(u.expiredLanes|=he),z&=~he}if(p=In,b=Zr,b=Ir(u,u===p?b:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),S=u.callbackNode,b===0||u===p&&(en===2||en===9)||u.cancelPendingCommit!==null)return S!==null&&S!==null&&Ya(S),u.callbackNode=null,u.callbackPriority=0;if((b&3)===0||er(u,b)){if(p=b&-b,p===u.callbackPriority)return p;switch(S!==null&&Ya(S),Wn(b)){case 2:case 8:b=ko;break;case 32:b=Do;break;case 268435456:b=ie;break;default:b=Do}return S=O_.bind(null,u),b=Tl(b,S),u.callbackPriority=p,u.callbackNode=b,p}return S!==null&&S!==null&&Ya(S),u.callbackPriority=2,u.callbackNode=null,2}function O_(u,p){if(Qi!==0&&Qi!==5)return u.callbackNode=null,u.callbackPriority=0,null;var b=u.callbackNode;if(fd()&&u.callbackNode!==b)return null;var S=Zr;return S=Ir(u,u===In?S:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),S===0?null:(Z0(u,S,p),Kh(u,Ei()),u.callbackNode!=null&&u.callbackNode===b?O_.bind(null,u):null)}function k_(u,p){if(fd())return null;Z0(u,p,!0)}function D_(){fb(function(){(ln&6)!==0?Tl(Oo,R_):Rm()})}function Om(){if(nl===0){var u=za;u===0&&(u=mt,mt<<=1,(mt&261888)===0&&(mt=256)),nl=u}return nl}function Hp(u){return u==null||typeof u=="symbol"||typeof u=="boolean"?null:typeof u=="function"?u:eo(""+u)}function L_(u,p){var b=p.ownerDocument.createElement("input");return b.name=p.name,b.value=p.value,u.id&&b.setAttribute("form",u.id),p.parentNode.insertBefore(b,p),u=new FormData(u),b.parentNode.removeChild(b),u}function Iw(u,p,b,S,k){if(p==="submit"&&b&&b.stateNode===k){var z=Hp((k[lr]||null).action),J=S.submitter;J&&(p=(p=J[lr]||null)?Hp(p.formAction):J.getAttribute("formAction"),p!==null&&(z=p,J=null));var he=new pu("action","action",null,S,k);u.push({event:he,listeners:[{instance:null,listener:function(){if(S.defaultPrevented){if(nl!==0){var Be=J?L_(k,J):new FormData(k);ed(b,{pending:!0,data:Be,method:k.method,action:z},null,Be)}}else typeof z=="function"&&(he.preventDefault(),Be=J?L_(k,J):new FormData(k),ed(b,{pending:!0,data:Be,method:k.method,action:z},z,Be))},currentTarget:k}]})}}for(var B_=0;B_<Ph.length;B_++){var km=Ph[B_],Rw=km.toLowerCase(),Ow=km[0].toUpperCase()+km.slice(1);Ki(Rw,"on"+Ow)}Ki(Eh,"onAnimationEnd"),Ki(Vf,"onAnimationIteration"),Ki(Fl,"onAnimationStart"),Ki("dblclick","onDoubleClick"),Ki("focusin","onFocus"),Ki("focusout","onBlur"),Ki(Ch,"onTransitionRun"),Ki(Tu,"onTransitionStart"),Ki(ma,"onTransitionCancel"),Ki(hp,"onTransitionEnd"),Ja("onMouseEnter",["mouseout","mouseover"]),Ja("onMouseLeave",["mouseout","mouseover"]),Ja("onPointerEnter",["pointerout","pointerover"]),Ja("onPointerLeave",["pointerout","pointerover"]),Il("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Il("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Il("onBeforeInput",["compositionend","keypress","textInput","paste"]),Il("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Il("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Il("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Wp="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),kw=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Wp));function sb(u,p){p=(p&4)!==0;for(var b=0;b<u.length;b++){var S=u[b],k=S.event;S=S.listeners;e:{var z=void 0;if(p)for(var J=S.length-1;0<=J;J--){var he=S[J],Be=he.instance,ut=he.currentTarget;if(he=he.listener,Be!==z&&k.isPropagationStopped())break e;z=he,k.currentTarget=ut;try{z(k)}catch(xt){Rc(xt)}k.currentTarget=null,z=Be}else for(J=0;J<S.length;J++){if(he=S[J],Be=he.instance,ut=he.currentTarget,he=he.listener,Be!==z&&k.isPropagationStopped())break e;z=he,k.currentTarget=ut;try{z(k)}catch(xt){Rc(xt)}k.currentTarget=null,z=Be}}}}function jr(u,p){var b=p[Pi];b===void 0&&(b=p[Pi]=new Set);var S=u+"__bubble";b.has(S)||(N_(p,u,2,!1),b.add(S))}function nc(u,p,b){var S=0;p&&(S|=4),N_(b,u,S,p)}var qp="_reactListening"+Math.random().toString(36).slice(2);function Dm(u){if(!u[qp]){u[qp]=!0,ys.forEach(function(b){b!=="selectionchange"&&(kw.has(b)||nc(b,!1,u),nc(b,!0,u))});var p=u.nodeType===9?u:u.ownerDocument;p===null||p[qp]||(p[qp]=!0,nc("selectionchange",!1,p))}}function N_(u,p,b,S){switch(Ea(p)){case 2:var k=ar;break;case 8:k=Jt;break;default:k=Nr}b=k.bind(null,p,b,u),k=void 0,!zi||p!=="touchstart"&&p!=="touchmove"&&p!=="wheel"||(k=!0),S?k!==void 0?u.addEventListener(p,b,{capture:!0,passive:k}):u.addEventListener(p,b,!0):k!==void 0?u.addEventListener(p,b,{passive:k}):u.addEventListener(p,b,!1)}function Lm(u,p,b,S,k){var z=S;if((p&1)===0&&(p&2)===0&&S!==null)e:for(;;){if(S===null)return;var J=S.tag;if(J===3||J===4){var he=S.stateNode.containerInfo;if(he===k)break;if(J===4)for(J=S.return;J!==null;){var Be=J.tag;if((Be===3||Be===4)&&J.stateNode.containerInfo===k)return;J=J.return}for(;he!==null;){if(J=Lo(he),J===null)return;if(Be=J.tag,Be===5||Be===6||Be===26||Be===27){S=z=J;continue e}he=he.parentNode}}S=S.return}Yd(function(){var ut=z,xt=Yi(b),It=[];e:{var ht=fp.get(u);if(ht!==void 0){var pt=pu,ir=u;switch(u){case"keypress":if(zr(b)===0)break e;case"keydown":case"keyup":pt=Wg;break;case"focusin":ir="focus",pt=zn;break;case"focusout":ir="blur",pt=zn;break;case"beforeblur":case"afterblur":pt=zn;break;case"click":if(b.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":pt=Ii;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":pt=mh;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":pt=Yy;break;case Eh:case Vf:case Fl:pt=yh;break;case hp:pt=Df;break;case"scroll":case"scrollend":pt=gh;break;case"wheel":pt=Cc;break;case"copy":case"cut":case"paste":pt=Zy;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":pt=qg;break;case"toggle":case"beforetoggle":pt=Lf}var vr=(p&4)!==0,Wr=!vr&&(u==="scroll"||u==="scrollend"),Ke=vr?ht!==null?ht+"Capture":null:ht;vr=[];for(var Ve=ut,ct;Ve!==null;){var Ct=Ve;if(ct=Ct.stateNode,Ct=Ct.tag,Ct!==5&&Ct!==26&&Ct!==27||ct===null||Ke===null||(Ct=Mi(Ve,Ke),Ct!=null&&vr.push(pd(Ve,Ct,ct))),Wr)break;Ve=Ve.return}0<vr.length&&(ht=new pt(ht,ir,null,b,xt),It.push({event:ht,listeners:vr}))}}if((p&7)===0){e:{if(ht=u==="mouseover"||u==="pointerover",pt=u==="mouseout"||u==="pointerout",ht&&b!==du&&(ir=b.relatedTarget||b.fromElement)&&(Lo(ir)||ir[_r]))break e;if((pt||ht)&&(ht=xt.window===xt?xt:(ht=xt.ownerDocument)?ht.defaultView||ht.parentWindow:window,pt?(ir=b.relatedTarget||b.toElement,pt=ut,ir=ir?Lo(ir):null,ir!==null&&(Wr=a(ir),vr=ir.tag,ir!==Wr||vr!==5&&vr!==27&&vr!==6)&&(ir=null)):(pt=null,ir=ut),pt!==ir)){if(vr=Ii,Ct="onMouseLeave",Ke="onMouseEnter",Ve="mouse",(u==="pointerout"||u==="pointerover")&&(vr=qg,Ct="onPointerLeave",Ke="onPointerEnter",Ve="pointer"),Wr=pt==null?ht:Qa(pt),ct=ir==null?ht:Qa(ir),ht=new vr(Ct,Ve+"leave",pt,b,xt),ht.target=Wr,ht.relatedTarget=ct,Ct=null,Lo(xt)===ut&&(vr=new vr(Ke,Ve+"enter",ir,b,xt),vr.target=ct,vr.relatedTarget=Wr,Ct=vr),Wr=Ct,pt&&ir)t:{for(vr=ab,Ke=pt,Ve=ir,ct=0,Ct=Ke;Ct;Ct=vr(Ct))ct++;Ct=0;for(var gr=Ve;gr;gr=vr(gr))Ct++;for(;0<ct-Ct;)Ke=vr(Ke),ct--;for(;0<Ct-ct;)Ve=vr(Ve),Ct--;for(;ct--;){if(Ke===Ve||Ve!==null&&Ke===Ve.alternate){vr=Ke;break t}Ke=vr(Ke),Ve=vr(Ve)}vr=null}else vr=null;pt!==null&&md(It,ht,pt,vr,!1),ir!==null&&Wr!==null&&md(It,Wr,ir,vr,!0)}}e:{if(ht=ut?Qa(ut):window,pt=ht.nodeName&&ht.nodeName.toLowerCase(),pt==="select"||pt==="input"&&ht.type==="file")var Tr=Nf;else if(Bf(ht))if(zf)Tr=op;else{Tr=Jg;var Kt=Qg}else pt=ht.nodeName,!pt||pt.toLowerCase()!=="input"||ht.type!=="checkbox"&&ht.type!=="radio"?ut&&La(ut.elementType)&&(Tr=Nf):Tr=ap;if(Tr&&(Tr=Tr(u,ut))){np(It,Tr,b,xt);break e}Kt&&Kt(u,ht,ut),u==="focusout"&&ut&&ht.type==="number"&&ut.memoizedProps.value!=null&&ph(ht,"number",ht.value)}switch(Kt=ut?Qa(ut):window,u){case"focusin":(Bf(Kt)||Kt.contentEditable==="true")&&(Nl=Kt,cp=ut,Sh=null);break;case"focusout":Sh=cp=Nl=null;break;case"mousedown":up=!0;break;case"contextmenu":case"mouseup":case"dragend":up=!1,tm(It,b,xt);break;case"selectionchange":if(Ic)break;case"keydown":case"keyup":tm(It,b,xt)}var Er;if(tp)e:{switch(u){case"compositionstart":var Mr="onCompositionStart";break e;case"compositionend":Mr="onCompositionEnd";break e;case"compositionupdate":Mr="onCompositionUpdate";break e}Mr=void 0}else Pc?Xg(u,b)&&(Mr="onCompositionEnd"):u==="keydown"&&b.keyCode===229&&(Mr="onCompositionStart");Mr&&(vu&&b.locale!=="ko"&&(Pc||Mr!=="onCompositionStart"?Mr==="onCompositionEnd"&&Pc&&(Er=to()):(Bs=xt,hr="value"in Bs?Bs.value:Bs.textContent,Pc=!0)),Kt=gd(ut,Mr),0<Kt.length&&(Mr=new Fi(Mr,u,null,b,xt),It.push({event:Mr,listeners:Kt}),Er?Mr.data=Er:(Er=Ll(b),Er!==null&&(Mr.data=Er)))),(Er=xh?rp(u,b):Qy(u,b))&&(Mr=gd(ut,"onBeforeInput"),0<Mr.length&&(Kt=new Fi("onBeforeInput","beforeinput",null,b,xt),It.push({event:Kt,listeners:Mr}),Kt.data=Er)),Iw(It,u,ut,b,xt)}sb(It,p)})}function pd(u,p,b){return{instance:u,listener:p,currentTarget:b}}function gd(u,p){for(var b=p+"Capture",S=[];u!==null;){var k=u,z=k.stateNode;if(k=k.tag,k!==5&&k!==26&&k!==27||z===null||(k=Mi(u,b),k!=null&&S.unshift(pd(u,k,z)),k=Mi(u,p),k!=null&&S.push(pd(u,k,z))),u.tag===3)return S;u=u.return}return[]}function ab(u){if(u===null)return null;do u=u.return;while(u&&u.tag!==5&&u.tag!==27);return u||null}function md(u,p,b,S,k){for(var z=p._reactName,J=[];b!==null&&b!==S;){var he=b,Be=he.alternate,ut=he.stateNode;if(he=he.tag,Be!==null&&Be===S)break;he!==5&&he!==26&&he!==27||ut===null||(Be=ut,k?(ut=Mi(b,z),ut!=null&&J.unshift(pd(b,ut,Be))):k||(ut=Mi(b,z),ut!=null&&J.push(pd(b,ut,Be)))),b=b.return}J.length!==0&&u.push({event:p,listeners:J})}var ob=/\r\n?/g,z_=/\u0000|\uFFFD/g;function F_(u){return(typeof u=="string"?u:""+u).replace(ob,`
`).replace(z_,"")}function Aa(u,p){return p=F_(p),F_(u)===p}function tn(u,p,b,S,k,z){switch(b){case"children":typeof S=="string"?p==="body"||p==="textarea"&&S===""||ts(u,S):(typeof S=="number"||typeof S=="bigint")&&p!=="body"&&ts(u,""+S);break;case"className":dh(u,"class",S);break;case"tabIndex":dh(u,"tabindex",S);break;case"dir":case"role":case"viewBox":case"width":case"height":dh(u,b,S);break;case"style":Fo(u,S,z);break;case"data":if(p!=="object"){dh(u,"data",S);break}case"src":case"href":if(S===""&&(p!=="a"||b!=="href")){u.removeAttribute(b);break}if(S==null||typeof S=="function"||typeof S=="symbol"||typeof S=="boolean"){u.removeAttribute(b);break}S=eo(""+S),u.setAttribute(b,S);break;case"action":case"formAction":if(typeof S=="function"){u.setAttribute(b,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof z=="function"&&(b==="formAction"?(p!=="input"&&tn(u,p,"name",k.name,k,null),tn(u,p,"formEncType",k.formEncType,k,null),tn(u,p,"formMethod",k.formMethod,k,null),tn(u,p,"formTarget",k.formTarget,k,null)):(tn(u,p,"encType",k.encType,k,null),tn(u,p,"method",k.method,k,null),tn(u,p,"target",k.target,k,null)));if(S==null||typeof S=="symbol"||typeof S=="boolean"){u.removeAttribute(b);break}S=eo(""+S),u.setAttribute(b,S);break;case"onClick":S!=null&&(u.onclick=ga);break;case"onScroll":S!=null&&jr("scroll",u);break;case"onScrollEnd":S!=null&&jr("scrollend",u);break;case"dangerouslySetInnerHTML":if(S!=null){if(typeof S!="object"||!("__html"in S))throw Error(n(61));if(b=S.__html,b!=null){if(k.children!=null)throw Error(n(60));u.innerHTML=b}}break;case"multiple":u.multiple=S&&typeof S!="function"&&typeof S!="symbol";break;case"muted":u.muted=S&&typeof S!="function"&&typeof S!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(S==null||typeof S=="function"||typeof S=="boolean"||typeof S=="symbol"){u.removeAttribute("xlink:href");break}b=eo(""+S),u.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",b);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":S!=null&&typeof S!="function"&&typeof S!="symbol"?u.setAttribute(b,""+S):u.removeAttribute(b);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":S&&typeof S!="function"&&typeof S!="symbol"?u.setAttribute(b,""):u.removeAttribute(b);break;case"capture":case"download":S===!0?u.setAttribute(b,""):S!==!1&&S!=null&&typeof S!="function"&&typeof S!="symbol"?u.setAttribute(b,S):u.removeAttribute(b);break;case"cols":case"rows":case"size":case"span":S!=null&&typeof S!="function"&&typeof S!="symbol"&&!isNaN(S)&&1<=S?u.setAttribute(b,S):u.removeAttribute(b);break;case"rowSpan":case"start":S==null||typeof S=="function"||typeof S=="symbol"||isNaN(S)?u.removeAttribute(b):u.setAttribute(b,S);break;case"popover":jr("beforetoggle",u),jr("toggle",u),fh(u,"popover",S);break;case"xlinkActuate":Ds(u,"http://www.w3.org/1999/xlink","xlink:actuate",S);break;case"xlinkArcrole":Ds(u,"http://www.w3.org/1999/xlink","xlink:arcrole",S);break;case"xlinkRole":Ds(u,"http://www.w3.org/1999/xlink","xlink:role",S);break;case"xlinkShow":Ds(u,"http://www.w3.org/1999/xlink","xlink:show",S);break;case"xlinkTitle":Ds(u,"http://www.w3.org/1999/xlink","xlink:title",S);break;case"xlinkType":Ds(u,"http://www.w3.org/1999/xlink","xlink:type",S);break;case"xmlBase":Ds(u,"http://www.w3.org/XML/1998/namespace","xml:base",S);break;case"xmlLang":Ds(u,"http://www.w3.org/XML/1998/namespace","xml:lang",S);break;case"xmlSpace":Ds(u,"http://www.w3.org/XML/1998/namespace","xml:space",S);break;case"is":fh(u,"is",S);break;case"innerText":case"textContent":break;default:(!(2<b.length)||b[0]!=="o"&&b[0]!=="O"||b[1]!=="n"&&b[1]!=="N")&&(b=Sc.get(b)||b,fh(u,b,S))}}function Qh(u,p,b,S,k,z){switch(b){case"style":Fo(u,S,z);break;case"dangerouslySetInnerHTML":if(S!=null){if(typeof S!="object"||!("__html"in S))throw Error(n(61));if(b=S.__html,b!=null){if(k.children!=null)throw Error(n(60));u.innerHTML=b}}break;case"children":typeof S=="string"?ts(u,S):(typeof S=="number"||typeof S=="bigint")&&ts(u,""+S);break;case"onScroll":S!=null&&jr("scroll",u);break;case"onScrollEnd":S!=null&&jr("scrollend",u);break;case"onClick":S!=null&&(u.onclick=ga);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!un.hasOwnProperty(b))e:{if(b[0]==="o"&&b[1]==="n"&&(k=b.endsWith("Capture"),p=b.slice(2,k?b.length-7:void 0),z=u[lr]||null,z=z!=null?z[b]:null,typeof z=="function"&&u.removeEventListener(p,z,k),typeof S=="function")){typeof z!="function"&&z!==null&&(b in u?u[b]=null:u.hasAttribute(b)&&u.removeAttribute(b)),u.addEventListener(p,S,k);break e}b in u?u[b]=S:S===!0?u.setAttribute(b,""):fh(u,b,S)}}}function oi(u,p,b){switch(p){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":jr("error",u),jr("load",u);var S=!1,k=!1,z;for(z in b)if(b.hasOwnProperty(z)){var J=b[z];if(J!=null)switch(z){case"src":S=!0;break;case"srcSet":k=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,p));default:tn(u,p,z,J,b,null)}}k&&tn(u,p,"srcSet",b.srcSet,b,null),S&&tn(u,p,"src",b.src,b,null);return;case"input":jr("invalid",u);var he=z=J=k=null,Be=null,ut=null;for(S in b)if(b.hasOwnProperty(S)){var xt=b[S];if(xt!=null)switch(S){case"name":k=xt;break;case"type":J=xt;break;case"checked":Be=xt;break;case"defaultChecked":ut=xt;break;case"value":z=xt;break;case"defaultValue":he=xt;break;case"children":case"dangerouslySetInnerHTML":if(xt!=null)throw Error(n(137,p));break;default:tn(u,p,S,xt,b,null)}}Of(u,z,he,Be,ut,J,k,!1);return;case"select":jr("invalid",u),S=J=z=null;for(k in b)if(b.hasOwnProperty(k)&&(he=b[k],he!=null))switch(k){case"value":z=he;break;case"defaultValue":J=he;break;case"multiple":S=he;default:tn(u,p,k,he,b,null)}p=z,b=J,u.multiple=!!S,p!=null?hu(u,!!S,p,!1):b!=null&&hu(u,!!S,b,!0);return;case"textarea":jr("invalid",u),z=k=S=null;for(J in b)if(b.hasOwnProperty(J)&&(he=b[J],he!=null))switch(J){case"value":S=he;break;case"defaultValue":k=he;break;case"children":z=he;break;case"dangerouslySetInnerHTML":if(he!=null)throw Error(n(91));break;default:tn(u,p,J,he,b,null)}fu(u,S,k,z);return;case"option":for(Be in b)if(b.hasOwnProperty(Be)&&(S=b[Be],S!=null))switch(Be){case"selected":u.selected=S&&typeof S!="function"&&typeof S!="symbol";break;default:tn(u,p,Be,S,b,null)}return;case"dialog":jr("beforetoggle",u),jr("toggle",u),jr("cancel",u),jr("close",u);break;case"iframe":case"object":jr("load",u);break;case"video":case"audio":for(S=0;S<Wp.length;S++)jr(Wp[S],u);break;case"image":jr("error",u),jr("load",u);break;case"details":jr("toggle",u);break;case"embed":case"source":case"link":jr("error",u),jr("load",u);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ut in b)if(b.hasOwnProperty(ut)&&(S=b[ut],S!=null))switch(ut){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,p));default:tn(u,p,ut,S,b,null)}return;default:if(La(p)){for(xt in b)b.hasOwnProperty(xt)&&(S=b[xt],S!==void 0&&Qh(u,p,xt,S,b,void 0));return}}for(he in b)b.hasOwnProperty(he)&&(S=b[he],S!=null&&tn(u,p,he,S,b,null))}function lb(u,p,b,S){switch(p){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var k=null,z=null,J=null,he=null,Be=null,ut=null,xt=null;for(pt in b){var It=b[pt];if(b.hasOwnProperty(pt)&&It!=null)switch(pt){case"checked":break;case"value":break;case"defaultValue":Be=It;default:S.hasOwnProperty(pt)||tn(u,p,pt,null,S,It)}}for(var ht in S){var pt=S[ht];if(It=b[ht],S.hasOwnProperty(ht)&&(pt!=null||It!=null))switch(ht){case"type":z=pt;break;case"name":k=pt;break;case"checked":ut=pt;break;case"defaultChecked":xt=pt;break;case"value":J=pt;break;case"defaultValue":he=pt;break;case"children":case"dangerouslySetInnerHTML":if(pt!=null)throw Error(n(137,p));break;default:pt!==It&&tn(u,p,ht,pt,S,It)}}Rl(u,J,he,Be,ut,xt,z,k);return;case"select":pt=J=he=ht=null;for(z in b)if(Be=b[z],b.hasOwnProperty(z)&&Be!=null)switch(z){case"value":break;case"multiple":pt=Be;default:S.hasOwnProperty(z)||tn(u,p,z,null,S,Be)}for(k in S)if(z=S[k],Be=b[k],S.hasOwnProperty(k)&&(z!=null||Be!=null))switch(k){case"value":ht=z;break;case"defaultValue":he=z;break;case"multiple":J=z;default:z!==Be&&tn(u,p,k,z,S,Be)}p=he,b=J,S=pt,ht!=null?hu(u,!!b,ht,!1):!!S!=!!b&&(p!=null?hu(u,!!b,p,!0):hu(u,!!b,b?[]:"",!1));return;case"textarea":pt=ht=null;for(he in b)if(k=b[he],b.hasOwnProperty(he)&&k!=null&&!S.hasOwnProperty(he))switch(he){case"value":break;case"children":break;default:tn(u,p,he,null,S,k)}for(J in S)if(k=S[J],z=b[J],S.hasOwnProperty(J)&&(k!=null||z!=null))switch(J){case"value":ht=k;break;case"defaultValue":pt=k;break;case"children":break;case"dangerouslySetInnerHTML":if(k!=null)throw Error(n(91));break;default:k!==z&&tn(u,p,J,k,S,z)}Tc(u,ht,pt);return;case"option":for(var ir in b)if(ht=b[ir],b.hasOwnProperty(ir)&&ht!=null&&!S.hasOwnProperty(ir))switch(ir){case"selected":u.selected=!1;break;default:tn(u,p,ir,null,S,ht)}for(Be in S)if(ht=S[Be],pt=b[Be],S.hasOwnProperty(Be)&&ht!==pt&&(ht!=null||pt!=null))switch(Be){case"selected":u.selected=ht&&typeof ht!="function"&&typeof ht!="symbol";break;default:tn(u,p,Be,ht,S,pt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var vr in b)ht=b[vr],b.hasOwnProperty(vr)&&ht!=null&&!S.hasOwnProperty(vr)&&tn(u,p,vr,null,S,ht);for(ut in S)if(ht=S[ut],pt=b[ut],S.hasOwnProperty(ut)&&ht!==pt&&(ht!=null||pt!=null))switch(ut){case"children":case"dangerouslySetInnerHTML":if(ht!=null)throw Error(n(137,p));break;default:tn(u,p,ut,ht,S,pt)}return;default:if(La(p)){for(var Wr in b)ht=b[Wr],b.hasOwnProperty(Wr)&&ht!==void 0&&!S.hasOwnProperty(Wr)&&Qh(u,p,Wr,void 0,S,ht);for(xt in S)ht=S[xt],pt=b[xt],!S.hasOwnProperty(xt)||ht===pt||ht===void 0&&pt===void 0||Qh(u,p,xt,ht,S,pt);return}}for(var Ke in b)ht=b[Ke],b.hasOwnProperty(Ke)&&ht!=null&&!S.hasOwnProperty(Ke)&&tn(u,p,Ke,null,S,ht);for(It in S)ht=S[It],pt=b[It],!S.hasOwnProperty(It)||ht===pt||ht==null&&pt==null||tn(u,p,It,ht,S,pt)}function U_(u){switch(u){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function cb(){if(typeof performance.getEntriesByType=="function"){for(var u=0,p=0,b=performance.getEntriesByType("resource"),S=0;S<b.length;S++){var k=b[S],z=k.transferSize,J=k.initiatorType,he=k.duration;if(z&&he&&U_(J)){for(J=0,he=k.responseEnd,S+=1;S<b.length;S++){var Be=b[S],ut=Be.startTime;if(ut>he)break;var xt=Be.transferSize,It=Be.initiatorType;xt&&U_(It)&&(Be=Be.responseEnd,J+=xt*(Be<he?1:(he-ut)/(Be-ut)))}if(--S,p+=8*(z+J)/(k.duration/1e3),u++,10<u)break}}if(0<u)return p/u/1e6}return navigator.connection&&(u=navigator.connection.downlink,typeof u=="number")?u:5}var Bm=null,j_=null;function Gp(u){return u.nodeType===9?u:u.ownerDocument}function Zc(u){switch(u){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function V_(u,p){if(u===0)switch(p){case"svg":return 1;case"math":return 2;default:return 0}return u===1&&p==="foreignObject"?0:u}function Nm(u,p){return u==="textarea"||u==="noscript"||typeof p.children=="string"||typeof p.children=="number"||typeof p.children=="bigint"||typeof p.dangerouslySetInnerHTML=="object"&&p.dangerouslySetInnerHTML!==null&&p.dangerouslySetInnerHTML.__html!=null}var zm=null;function ub(){var u=window.event;return u&&u.type==="popstate"?u===zm?!1:(zm=u,!0):(zm=null,!1)}var hb=typeof setTimeout=="function"?setTimeout:void 0,Dw=typeof clearTimeout=="function"?clearTimeout:void 0,$_=typeof Promise=="function"?Promise:void 0,fb=typeof queueMicrotask=="function"?queueMicrotask:typeof $_<"u"?function(u){return $_.resolve(null).then(u).catch(Fm)}:hb;function Fm(u){setTimeout(function(){throw u})}function Yc(u){return u==="head"}function Xp(u,p){var b=p,S=0;do{var k=b.nextSibling;if(u.removeChild(b),k&&k.nodeType===8)if(b=k.data,b==="/$"||b==="/&"){if(S===0){u.removeChild(k),bd(p);return}S--}else if(b==="$"||b==="$?"||b==="$~"||b==="$!"||b==="&")S++;else if(b==="html")_d(u.ownerDocument.documentElement);else if(b==="head"){b=u.ownerDocument.head,_d(b);for(var z=b.firstChild;z;){var J=z.nextSibling,he=z.nodeName;z[Ml]||he==="SCRIPT"||he==="STYLE"||he==="LINK"&&z.rel.toLowerCase()==="stylesheet"||b.removeChild(z),z=J}}else b==="body"&&_d(u.ownerDocument.body);b=k}while(b);bd(p)}function Zp(u,p){var b=u;u=0;do{var S=b.nextSibling;if(b.nodeType===1?p?(b._stashedDisplay=b.style.display,b.style.display="none"):(b.style.display=b._stashedDisplay||"",b.getAttribute("style")===""&&b.removeAttribute("style")):b.nodeType===3&&(p?(b._stashedText=b.nodeValue,b.nodeValue=""):b.nodeValue=b._stashedText||""),S&&S.nodeType===8)if(b=S.data,b==="/$"){if(u===0)break;u--}else b!=="$"&&b!=="$?"&&b!=="$~"&&b!=="$!"||u++;b=S}while(b)}function yd(u){var p=u.firstChild;for(p&&p.nodeType===10&&(p=p.nextSibling);p;){var b=p;switch(p=p.nextSibling,b.nodeName){case"HTML":case"HEAD":case"BODY":yd(b),Ka(b);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(b.rel.toLowerCase()==="stylesheet")continue}u.removeChild(b)}}function Lw(u,p,b,S){for(;u.nodeType===1;){var k=b;if(u.nodeName.toLowerCase()!==p.toLowerCase()){if(!S&&(u.nodeName!=="INPUT"||u.type!=="hidden"))break}else if(S){if(!u[Ml])switch(p){case"meta":if(!u.hasAttribute("itemprop"))break;return u;case"link":if(z=u.getAttribute("rel"),z==="stylesheet"&&u.hasAttribute("data-precedence"))break;if(z!==k.rel||u.getAttribute("href")!==(k.href==null||k.href===""?null:k.href)||u.getAttribute("crossorigin")!==(k.crossOrigin==null?null:k.crossOrigin)||u.getAttribute("title")!==(k.title==null?null:k.title))break;return u;case"style":if(u.hasAttribute("data-precedence"))break;return u;case"script":if(z=u.getAttribute("src"),(z!==(k.src==null?null:k.src)||u.getAttribute("type")!==(k.type==null?null:k.type)||u.getAttribute("crossorigin")!==(k.crossOrigin==null?null:k.crossOrigin))&&z&&u.hasAttribute("async")&&!u.hasAttribute("itemprop"))break;return u;default:return u}}else if(p==="input"&&u.type==="hidden"){var z=k.name==null?null:""+k.name;if(k.type==="hidden"&&u.getAttribute("name")===z)return u}else return u;if(u=$a(u.nextSibling),u===null)break}return null}function Bw(u,p,b){if(p==="")return null;for(;u.nodeType!==3;)if((u.nodeType!==1||u.nodeName!=="INPUT"||u.type!=="hidden")&&!b||(u=$a(u.nextSibling),u===null))return null;return u}function db(u,p){for(;u.nodeType!==8;)if((u.nodeType!==1||u.nodeName!=="INPUT"||u.type!=="hidden")&&!p||(u=$a(u.nextSibling),u===null))return null;return u}function Gu(u){return u.data==="$?"||u.data==="$~"}function Wi(u){return u.data==="$!"||u.data==="$?"&&u.ownerDocument.readyState!=="loading"}function H_(u,p){var b=u.ownerDocument;if(u.data==="$~")u._reactRetry=p;else if(u.data!=="$?"||b.readyState!=="loading")p();else{var S=function(){p(),b.removeEventListener("DOMContentLoaded",S)};b.addEventListener("DOMContentLoaded",S),u._reactRetry=S}}function $a(u){for(;u!=null;u=u.nextSibling){var p=u.nodeType;if(p===1||p===3)break;if(p===8){if(p=u.data,p==="$"||p==="$!"||p==="$?"||p==="$~"||p==="&"||p==="F!"||p==="F")break;if(p==="/$"||p==="/&")return null}}return u}var Um=null;function jm(u){u=u.nextSibling;for(var p=0;u;){if(u.nodeType===8){var b=u.data;if(b==="/$"||b==="/&"){if(p===0)return $a(u.nextSibling);p--}else b!=="$"&&b!=="$!"&&b!=="$?"&&b!=="$~"&&b!=="&"||p++}u=u.nextSibling}return null}function pb(u){u=u.previousSibling;for(var p=0;u;){if(u.nodeType===8){var b=u.data;if(b==="$"||b==="$!"||b==="$?"||b==="$~"||b==="&"){if(p===0)return u;p--}else b!=="/$"&&b!=="/&"||p++}u=u.previousSibling}return null}function W_(u,p,b){switch(p=Gp(b),u){case"html":if(u=p.documentElement,!u)throw Error(n(452));return u;case"head":if(u=p.head,!u)throw Error(n(453));return u;case"body":if(u=p.body,!u)throw Error(n(454));return u;default:throw Error(n(451))}}function _d(u){for(var p=u.attributes;p.length;)u.removeAttributeNode(p[0]);Ka(u)}var Co=new Map,q_=new Set;function vd(u){return typeof u.getRootNode=="function"?u.getRootNode():u.nodeType===9?u:u.ownerDocument}var il=we.d;we.d={f:gb,r:Yp,D:X_,C:Vm,L:Kp,m:Z_,X:K_,S:Y_,M:Nw};function gb(){var u=il.f(),p=Em();return u||p}function Yp(u){var p=ms(u);p!==null&&p.tag===5&&p.type==="form"?im(p):il.r(u)}var Xu=typeof document>"u"?null:document;function G_(u,p,b){var S=Xu;if(S&&typeof p=="string"&&p){var k=Ls(p);k='link[rel="'+u+'"][href="'+k+'"]',typeof b=="string"&&(k+='[crossorigin="'+b+'"]'),q_.has(k)||(q_.add(k),u={rel:u,crossOrigin:b,href:p},S.querySelector(k)===null&&(p=S.createElement("link"),oi(p,"link",u),ni(p),S.head.appendChild(p)))}}function X_(u){il.D(u),G_("dns-prefetch",u,null)}function Vm(u,p){il.C(u,p),G_("preconnect",u,p)}function Kp(u,p,b){il.L(u,p,b);var S=Xu;if(S&&u&&p){var k='link[rel="preload"][as="'+Ls(p)+'"]';p==="image"&&b&&b.imageSrcSet?(k+='[imagesrcset="'+Ls(b.imageSrcSet)+'"]',typeof b.imageSizes=="string"&&(k+='[imagesizes="'+Ls(b.imageSizes)+'"]')):k+='[href="'+Ls(u)+'"]';var z=k;switch(p){case"style":z=l(u);break;case"script":z=A(u)}Co.has(z)||(u=T({rel:"preload",href:p==="image"&&b&&b.imageSrcSet?void 0:u,as:p},b),Co.set(z,u),S.querySelector(k)!==null||p==="style"&&S.querySelector(h(z))||p==="script"&&S.querySelector(P(z))||(p=S.createElement("link"),oi(p,"link",u),ni(p),S.head.appendChild(p)))}}function Z_(u,p){il.m(u,p);var b=Xu;if(b&&u){var S=p&&typeof p.as=="string"?p.as:"script",k='link[rel="modulepreload"][as="'+Ls(S)+'"][href="'+Ls(u)+'"]',z=k;switch(S){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":z=A(u)}if(!Co.has(z)&&(u=T({rel:"modulepreload",href:u},p),Co.set(z,u),b.querySelector(k)===null)){switch(S){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(b.querySelector(P(z)))return}S=b.createElement("link"),oi(S,"link",u),ni(S),b.head.appendChild(S)}}}function Y_(u,p,b){il.S(u,p,b);var S=Xu;if(S&&u){var k=_n(S).hoistableStyles,z=l(u);p=p||"default";var J=k.get(z);if(!J){var he={loading:0,preload:null};if(J=S.querySelector(h(z)))he.loading=5;else{u=T({rel:"stylesheet",href:u,"data-precedence":p},b),(b=Co.get(z))&&U(u,b);var Be=J=S.createElement("link");ni(Be),oi(Be,"link",u),Be._p=new Promise(function(ut,xt){Be.onload=ut,Be.onerror=xt}),Be.addEventListener("load",function(){he.loading|=1}),Be.addEventListener("error",function(){he.loading|=2}),he.loading|=4,D(J,p,S)}J={type:"stylesheet",instance:J,count:1,state:he},k.set(z,J)}}}function K_(u,p){il.X(u,p);var b=Xu;if(b&&u){var S=_n(b).hoistableScripts,k=A(u),z=S.get(k);z||(z=b.querySelector(P(k)),z||(u=T({src:u,async:!0},p),(p=Co.get(k))&&$(u,p),z=b.createElement("script"),ni(z),oi(z,"link",u),b.head.appendChild(z)),z={type:"script",instance:z,count:1,state:null},S.set(k,z))}}function Nw(u,p){il.M(u,p);var b=Xu;if(b&&u){var S=_n(b).hoistableScripts,k=A(u),z=S.get(k);z||(z=b.querySelector(P(k)),z||(u=T({src:u,async:!0,type:"module"},p),(p=Co.get(k))&&$(u,p),z=b.createElement("script"),ni(z),oi(z,"link",u),b.head.appendChild(z)),z={type:"script",instance:z,count:1,state:null},S.set(k,z))}}function f(u,p,b,S){var k=(k=$t.current)?vd(k):null;if(!k)throw Error(n(446));switch(u){case"meta":case"title":return null;case"style":return typeof b.precedence=="string"&&typeof b.href=="string"?(p=l(b.href),b=_n(k).hoistableStyles,S=b.get(p),S||(S={type:"style",instance:null,count:0,state:null},b.set(p,S)),S):{type:"void",instance:null,count:0,state:null};case"link":if(b.rel==="stylesheet"&&typeof b.href=="string"&&typeof b.precedence=="string"){u=l(b.href);var z=_n(k).hoistableStyles,J=z.get(u);if(J||(k=k.ownerDocument||k,J={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},z.set(u,J),(z=k.querySelector(h(u)))&&!z._p&&(J.instance=z,J.state.loading=5),Co.has(u)||(b={rel:"preload",as:"style",href:b.href,crossOrigin:b.crossOrigin,integrity:b.integrity,media:b.media,hrefLang:b.hrefLang,referrerPolicy:b.referrerPolicy},Co.set(u,b),z||x(k,u,b,J.state))),p&&S===null)throw Error(n(528,""));return J}if(p&&S!==null)throw Error(n(529,""));return null;case"script":return p=b.async,b=b.src,typeof b=="string"&&p&&typeof p!="function"&&typeof p!="symbol"?(p=A(b),b=_n(k).hoistableScripts,S=b.get(p),S||(S={type:"script",instance:null,count:0,state:null},b.set(p,S)),S):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,u))}}function l(u){return'href="'+Ls(u)+'"'}function h(u){return'link[rel="stylesheet"]['+u+"]"}function m(u){return T({},u,{"data-precedence":u.precedence,precedence:null})}function x(u,p,b,S){u.querySelector('link[rel="preload"][as="style"]['+p+"]")?S.loading=1:(p=u.createElement("link"),S.preload=p,p.addEventListener("load",function(){return S.loading|=1}),p.addEventListener("error",function(){return S.loading|=2}),oi(p,"link",b),ni(p),u.head.appendChild(p))}function A(u){return'[src="'+Ls(u)+'"]'}function P(u){return"script[async]"+u}function R(u,p,b){if(p.count++,p.instance===null)switch(p.type){case"style":var S=u.querySelector('style[data-href~="'+Ls(b.href)+'"]');if(S)return p.instance=S,ni(S),S;var k=T({},b,{"data-href":b.href,"data-precedence":b.precedence,href:null,precedence:null});return S=(u.ownerDocument||u).createElement("style"),ni(S),oi(S,"style",k),D(S,b.precedence,u),p.instance=S;case"stylesheet":k=l(b.href);var z=u.querySelector(h(k));if(z)return p.state.loading|=4,p.instance=z,ni(z),z;S=m(b),(k=Co.get(k))&&U(S,k),z=(u.ownerDocument||u).createElement("link"),ni(z);var J=z;return J._p=new Promise(function(he,Be){J.onload=he,J.onerror=Be}),oi(z,"link",S),p.state.loading|=4,D(z,b.precedence,u),p.instance=z;case"script":return z=A(b.src),(k=u.querySelector(P(z)))?(p.instance=k,ni(k),k):(S=b,(k=Co.get(z))&&(S=T({},b),$(S,k)),u=u.ownerDocument||u,k=u.createElement("script"),ni(k),oi(k,"link",S),u.head.appendChild(k),p.instance=k);case"void":return null;default:throw Error(n(443,p.type))}else p.type==="stylesheet"&&(p.state.loading&4)===0&&(S=p.instance,p.state.loading|=4,D(S,b.precedence,u));return p.instance}function D(u,p,b){for(var S=b.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),k=S.length?S[S.length-1]:null,z=k,J=0;J<S.length;J++){var he=S[J];if(he.dataset.precedence===p)z=he;else if(z!==k)break}z?z.parentNode.insertBefore(u,z.nextSibling):(p=b.nodeType===9?b.head:b,p.insertBefore(u,p.firstChild))}function U(u,p){u.crossOrigin==null&&(u.crossOrigin=p.crossOrigin),u.referrerPolicy==null&&(u.referrerPolicy=p.referrerPolicy),u.title==null&&(u.title=p.title)}function $(u,p){u.crossOrigin==null&&(u.crossOrigin=p.crossOrigin),u.referrerPolicy==null&&(u.referrerPolicy=p.referrerPolicy),u.integrity==null&&(u.integrity=p.integrity)}var G=null;function ee(u,p,b){if(G===null){var S=new Map,k=G=new Map;k.set(b,S)}else k=G,S=k.get(b),S||(S=new Map,k.set(b,S));if(S.has(u))return S;for(S.set(u,null),b=b.getElementsByTagName(u),k=0;k<b.length;k++){var z=b[k];if(!(z[Ml]||z[Pt]||u==="link"&&z.getAttribute("rel")==="stylesheet")&&z.namespaceURI!=="http://www.w3.org/2000/svg"){var J=z.getAttribute(p)||"";J=u+J;var he=S.get(J);he?he.push(z):S.set(J,[z])}}return S}function re(u,p,b){u=u.ownerDocument||u,u.head.insertBefore(b,p==="title"?u.querySelector("head > title"):null)}function ne(u,p,b){if(b===1||p.itemProp!=null)return!1;switch(u){case"meta":case"title":return!0;case"style":if(typeof p.precedence!="string"||typeof p.href!="string"||p.href==="")break;return!0;case"link":if(typeof p.rel!="string"||typeof p.href!="string"||p.href===""||p.onLoad||p.onError)break;switch(p.rel){case"stylesheet":return u=p.disabled,typeof p.precedence=="string"&&u==null;default:return!0}case"script":if(p.async&&typeof p.async!="function"&&typeof p.async!="symbol"&&!p.onLoad&&!p.onError&&p.src&&typeof p.src=="string")return!0}return!1}function le(u){return!(u.type==="stylesheet"&&(u.state.loading&3)===0)}function de(u,p,b,S){if(b.type==="stylesheet"&&(typeof S.media!="string"||matchMedia(S.media).matches!==!1)&&(b.state.loading&4)===0){if(b.instance===null){var k=l(S.href),z=p.querySelector(h(k));if(z){p=z._p,p!==null&&typeof p=="object"&&typeof p.then=="function"&&(u.count++,u=Ie.bind(u),p.then(u,u)),b.state.loading|=4,b.instance=z,ni(z);return}z=p.ownerDocument||p,S=m(S),(k=Co.get(k))&&U(S,k),z=z.createElement("link"),ni(z);var J=z;J._p=new Promise(function(he,Be){J.onload=he,J.onerror=Be}),oi(z,"link",S),b.instance=z}u.stylesheets===null&&(u.stylesheets=new Map),u.stylesheets.set(b,p),(p=b.state.preload)&&(b.state.loading&3)===0&&(u.count++,b=Ie.bind(u),p.addEventListener("load",b),p.addEventListener("error",b))}}var xe=0;function $e(u,p){return u.stylesheets&&u.count===0&&et(u,u.stylesheets),0<u.count||0<u.imgCount?function(b){var S=setTimeout(function(){if(u.stylesheets&&et(u,u.stylesheets),u.unsuspend){var z=u.unsuspend;u.unsuspend=null,z()}},6e4+p);0<u.imgBytes&&xe===0&&(xe=62500*cb());var k=setTimeout(function(){if(u.waitingForImages=!1,u.count===0&&(u.stylesheets&&et(u,u.stylesheets),u.unsuspend)){var z=u.unsuspend;u.unsuspend=null,z()}},(u.imgBytes>xe?50:800)+p);return u.unsuspend=b,function(){u.unsuspend=null,clearTimeout(S),clearTimeout(k)}}:null}function Ie(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)et(this,this.stylesheets);else if(this.unsuspend){var u=this.unsuspend;this.unsuspend=null,u()}}}var De=null;function et(u,p){u.stylesheets=null,u.unsuspend!==null&&(u.count++,De=new Map,p.forEach(ft,u),De=null,Ie.call(u))}function ft(u,p){if(!(p.state.loading&4)){var b=De.get(u);if(b)var S=b.get(null);else{b=new Map,De.set(u,b);for(var k=u.querySelectorAll("link[data-precedence],style[data-precedence]"),z=0;z<k.length;z++){var J=k[z];(J.nodeName==="LINK"||J.getAttribute("media")!=="not all")&&(b.set(J.dataset.precedence,J),S=J)}S&&b.set(null,S)}k=p.instance,J=k.getAttribute("data-precedence"),z=b.get(J)||S,z===S&&b.set(null,k),b.set(J,k),this.count++,S=Ie.bind(this),k.addEventListener("load",S),k.addEventListener("error",S),z?z.parentNode.insertBefore(k,z.nextSibling):(u=u.nodeType===9?u.head:u,u.insertBefore(k,u.firstChild)),p.state.loading|=4}}var St={$$typeof:X,Provider:null,Consumer:null,_currentValue:Re,_currentValue2:Re,_threadCount:0};function Vt(u,p,b,S,k,z,J,he,Be){this.tag=1,this.containerInfo=u,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=$n(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=$n(0),this.hiddenUpdates=$n(null),this.identifierPrefix=S,this.onUncaughtError=k,this.onCaughtError=z,this.onRecoverableError=J,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Be,this.incompleteTransitions=new Map}function zt(u,p,b,S,k,z,J,he,Be,ut,xt,It){return u=new Vt(u,p,b,J,Be,ut,xt,It,he),p=1,z===!0&&(p|=24),z=zs(3,null,null,p),u.current=z,z.stateNode=u,p=Us(),p.refCount++,u.pooledCache=p,p.refCount++,z.memoizedState={element:S,isDehydrated:b,cache:p},Qr(z),u}function jt(u){return u?(u=co,u):co}function rr(u,p,b,S,k,z){k=jt(k),S.context===null?S.context=k:S.pendingContext=k,S=Fa(p),S.payload={element:b},z=z===void 0?null:z,z!==null&&(S.callback=z),b=Ua(u,S,p),b!==null&&(Sa(b,u,p),zc(b,u,p))}function Ft(u,p){if(u=u.memoizedState,u!==null&&u.dehydrated!==null){var b=u.retryLane;u.retryLane=b!==0&&b<p?b:p}}function Ut(u,p){Ft(u,p),(u=u.alternate)&&Ft(u,p)}function yt(u){if(u.tag===13||u.tag===31){var p=Ul(u,67108864);p!==null&&Sa(p,u,67108864),Ut(u,67108864)}}function dr(u){if(u.tag===13||u.tag===31){var p=Ta();p=bt(p);var b=Ul(u,p);b!==null&&Sa(b,u,p),Ut(u,p)}}var pr=!0;function ar(u,p,b,S){var k=ce.T;ce.T=null;var z=we.p;try{we.p=2,Nr(u,p,b,S)}finally{we.p=z,ce.T=k}}function Jt(u,p,b,S){var k=ce.T;ce.T=null;var z=we.p;try{we.p=8,Nr(u,p,b,S)}finally{we.p=z,ce.T=k}}function Nr(u,p,b,S){if(pr){var k=Ln(S);if(k===null)Lm(u,p,S,ri,b),Di(u,S);else if(Li(k,u,p,b,S))S.stopPropagation();else if(Di(u,S),p&4&&-1<Ha.indexOf(u)){for(;k!==null;){var z=ms(k);if(z!==null)switch(z.tag){case 3:if(z=z.stateNode,z.current.memoizedState.isDehydrated){var J=fr(z.pendingLanes);if(J!==0){var he=z;for(he.pendingLanes|=2,he.entangledLanes|=2;J;){var Be=1<<31-Qe(J);he.entanglements[1]|=Be,J&=~Be}Eo(z),(ln&6)===0&&(Tm=Ei()+500,$p(0))}}break;case 31:case 13:he=Ul(z,2),he!==null&&Sa(he,z,2),Em(),Ut(z,2)}if(z=Ln(S),z===null&&Lm(u,p,S,ri,b),z===k)break;k=z}k!==null&&S.stopPropagation()}else Lm(u,p,S,null,b)}}function Ln(u){return u=Yi(u),qi(u)}var ri=null;function qi(u){if(ri=null,u=Lo(u),u!==null){var p=a(u);if(p===null)u=null;else{var b=p.tag;if(b===13){if(u=c(p),u!==null)return u;u=null}else if(b===31){if(u=s(p),u!==null)return u;u=null}else if(b===3){if(p.stateNode.current.memoizedState.isDehydrated)return p.tag===3?p.stateNode.containerInfo:null;u=null}else p!==u&&(u=null)}}return ri=u,null}function Ea(u){switch(u){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(El()){case Oo:return 2;case ko:return 8;case Do:case je:return 32;case ie:return 268435456;default:return 32}default:return 32}}var Ts=!1,Fn=null,rn=null,Bn=null,li=new Map,ci=new Map,ui=[],Ha="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Di(u,p){switch(u){case"focusin":case"focusout":Fn=null;break;case"dragenter":case"dragleave":rn=null;break;case"mouseover":case"mouseout":Bn=null;break;case"pointerover":case"pointerout":li.delete(p.pointerId);break;case"gotpointercapture":case"lostpointercapture":ci.delete(p.pointerId)}}function Ji(u,p,b,S,k,z){return u===null||u.nativeEvent!==z?(u={blockedOn:p,domEventName:b,eventSystemFlags:S,nativeEvent:z,targetContainers:[k]},p!==null&&(p=ms(p),p!==null&&yt(p)),u):(u.eventSystemFlags|=S,p=u.targetContainers,k!==null&&p.indexOf(k)===-1&&p.push(k),u)}function Li(u,p,b,S,k){switch(p){case"focusin":return Fn=Ji(Fn,u,p,b,S,k),!0;case"dragenter":return rn=Ji(rn,u,p,b,S,k),!0;case"mouseover":return Bn=Ji(Bn,u,p,b,S,k),!0;case"pointerover":var z=k.pointerId;return li.set(z,Ji(li.get(z)||null,u,p,b,S,k)),!0;case"gotpointercapture":return z=k.pointerId,ci.set(z,Ji(ci.get(z)||null,u,p,b,S,k)),!0}return!1}function Bi(u){var p=Lo(u.target);if(p!==null){var b=a(p);if(b!==null){if(p=b.tag,p===13){if(p=c(b),p!==null){u.blockedOn=p,Cl(u.priority,function(){dr(b)});return}}else if(p===31){if(p=s(b),p!==null){u.blockedOn=p,Cl(u.priority,function(){dr(b)});return}}else if(p===3&&b.stateNode.current.memoizedState.isDehydrated){u.blockedOn=b.tag===3?b.stateNode.containerInfo:null;return}}}u.blockedOn=null}function hi(u){if(u.blockedOn!==null)return!1;for(var p=u.targetContainers;0<p.length;){var b=Ln(u.nativeEvent);if(b===null){b=u.nativeEvent;var S=new b.constructor(b.type,b);du=S,b.target.dispatchEvent(S),du=null}else return p=ms(b),p!==null&&yt(p),u.blockedOn=b,!1;p.shift()}return!0}function fi(u,p,b){hi(u)&&b.delete(p)}function On(){Ts=!1,Fn!==null&&hi(Fn)&&(Fn=null),rn!==null&&hi(rn)&&(rn=null),Bn!==null&&hi(Bn)&&(Bn=null),li.forEach(fi),ci.forEach(fi)}function Ca(u,p){u.blockedOn===p&&(u.blockedOn=null,Ts||(Ts=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,On)))}var Kc=null;function Po(u){Kc!==u&&(Kc=u,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Kc===u&&(Kc=null);for(var p=0;p<u.length;p+=3){var b=u[p],S=u[p+1],k=u[p+2];if(typeof S!="function"){if(qi(S||b)===null)continue;break}var z=ms(b);z!==null&&(u.splice(p,3),p-=3,ed(z,{pending:!0,data:k,method:b.method,action:S},S,k))}}))}function bd(u){function p(Be){return Ca(Be,u)}Fn!==null&&Ca(Fn,u),rn!==null&&Ca(rn,u),Bn!==null&&Ca(Bn,u),li.forEach(p),ci.forEach(p);for(var b=0;b<ui.length;b++){var S=ui[b];S.blockedOn===u&&(S.blockedOn=null)}for(;0<ui.length&&(b=ui[0],b.blockedOn===null);)Bi(b),b.blockedOn===null&&ui.shift();if(b=(u.ownerDocument||u).$$reactFormReplay,b!=null)for(S=0;S<b.length;S+=3){var k=b[S],z=b[S+1],J=k[lr]||null;if(typeof z=="function")J||Po(b);else if(J){var he=null;if(z&&z.hasAttribute("formAction")){if(k=z,J=z[lr]||null)he=J.formAction;else if(qi(k)!==null)continue}else he=J.action;typeof he=="function"?b[S+1]=he:(b.splice(S,3),S-=3),Po(b)}}}function Jh(){function u(z){z.canIntercept&&z.info==="react-transition"&&z.intercept({handler:function(){return new Promise(function(J){return k=J})},focusReset:"manual",scroll:"manual"})}function p(){k!==null&&(k(),k=null),S||setTimeout(b,20)}function b(){if(!S&&!navigation.transition){var z=navigation.currentEntry;z&&z.url!=null&&navigation.navigate(z.url,{state:z.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var S=!1,k=null;return navigation.addEventListener("navigate",u),navigation.addEventListener("navigatesuccess",p),navigation.addEventListener("navigateerror",p),setTimeout(b,100),function(){S=!0,navigation.removeEventListener("navigate",u),navigation.removeEventListener("navigatesuccess",p),navigation.removeEventListener("navigateerror",p),k!==null&&(k(),k=null)}}}function Qc(u){this._internalRoot=u}Jc.prototype.render=Qc.prototype.render=function(u){var p=this._internalRoot;if(p===null)throw Error(n(409));var b=p.current,S=Ta();rr(b,S,u,p,null,null)},Jc.prototype.unmount=Qc.prototype.unmount=function(){var u=this._internalRoot;if(u!==null){this._internalRoot=null;var p=u.containerInfo;rr(u.current,2,null,u,null,null),Em(),p[_r]=null}};function Jc(u){this._internalRoot=u}Jc.prototype.unstable_scheduleHydration=function(u){if(u){var p=ks();u={blockedOn:null,target:u,priority:p};for(var b=0;b<ui.length&&p!==0&&p<ui[b].priority;b++);ui.splice(b,0,u),b===0&&Bi(u)}};var ef=e.version;if(ef!=="19.2.0")throw Error(n(527,ef,"19.2.0"));we.findDOMNode=function(u){var p=u._reactInternals;if(p===void 0)throw typeof u.render=="function"?Error(n(188)):(u=Object.keys(u).join(","),Error(n(268,u)));return u=_(p),u=u!==null?v(u):null,u=u===null?null:u.stateNode,u};var xd={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:ce,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Qp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Qp.isDisabled&&Qp.supportsFiber)try{Me=Qp.inject(xd),ke=Qp}catch{}}return J_.createRoot=function(u,p){if(!i(u))throw Error(n(299));var b=!1,S="",k=bp,z=t_,J=I0;return p!=null&&(p.unstable_strictMode===!0&&(b=!0),p.identifierPrefix!==void 0&&(S=p.identifierPrefix),p.onUncaughtError!==void 0&&(k=p.onUncaughtError),p.onCaughtError!==void 0&&(z=p.onCaughtError),p.onRecoverableError!==void 0&&(J=p.onRecoverableError)),p=zt(u,1,!1,null,null,b,S,null,k,z,J,Jh),u[_r]=p.current,Dm(u),new Qc(p)},J_.hydrateRoot=function(u,p,b){if(!i(u))throw Error(n(299));var S=!1,k="",z=bp,J=t_,he=I0,Be=null;return b!=null&&(b.unstable_strictMode===!0&&(S=!0),b.identifierPrefix!==void 0&&(k=b.identifierPrefix),b.onUncaughtError!==void 0&&(z=b.onUncaughtError),b.onCaughtError!==void 0&&(J=b.onCaughtError),b.onRecoverableError!==void 0&&(he=b.onRecoverableError),b.formState!==void 0&&(Be=b.formState)),p=zt(u,1,!0,p,b??null,S,k,Be,z,J,he,Jh),p.context=jt(null),b=p.current,S=Ta(),S=bt(S),k=Fa(S),k.callback=null,Ua(b,k,S),b=S,p.current.lanes=b,Hn(p,b),Eo(p),u[_r]=p.current,Dm(u),new Jc(p)},J_.version="19.2.0",J_}var KC;function WF(){if(KC)return Uw.exports;KC=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Uw.exports=HF(),Uw.exports}var qF=WF();const GF="/assets/banner-BJOJDr4G.jpg",XF="/assets/icon-jxXsqLzz.svg",ZF=()=>Se.jsxs("div",{className:"relative w-full h-96 md:h-[600px]",children:[Se.jsx("div",{className:"absolute inset-0 bg-cover bg-center",style:{backgroundImage:`linear-gradient(to top, rgba(0, 0, 0, 0.3), transparent), linear-gradient(to bottom, rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url(${GF})`},children:Se.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-70 bg-gradient-to-t from-[rgba(250,250,248,1)] to-transparent"})}),Se.jsxs("div",{className:"absolute top-0 left-0 right-0 flex justify-between items-center p-4 md:p-6",children:[Se.jsx("span",{className:"text-xl font-bold text-white",children:"UNFPA"}),Se.jsx("img",{src:XF,alt:"Icon",className:"w-30  md:w-30"})]}),Se.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:Se.jsxs("div",{className:"text-center text-white px-4",children:[Se.jsx("h1",{className:"text-4xl md:text-6xl font-bold mb-4",children:"Anugul from Space"}),Se.jsx("p",{className:"text-xl md:text-2xl opacity-90",children:"A Data-Driven Story of Growth and Change"})]})})]});var sx={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.8.0/LICENSE.txt
 */var YF=sx.exports,QC;function KF(){return QC||(QC=1,(function(t,e){(function(r,n){t.exports=n()})(YF,(function(){var r={},n={};function i(c,s,g){if(n[c]=g,c==="index"){var _="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",v={};return n.shared(v),n.index(r,v),typeof window<"u"&&r.setWorkerUrl(window.URL.createObjectURL(new Blob([_],{type:"text/javascript"}))),r}}i("shared",["exports"],(function(c){function s(f,l,h,m){return new(h||(h=Promise))((function(x,A){function P(U){try{D(m.next(U))}catch($){A($)}}function R(U){try{D(m.throw(U))}catch($){A($)}}function D(U){var $;U.done?x(U.value):($=U.value,$ instanceof h?$:new h((function(G){G($)}))).then(P,R)}D((m=m.apply(f,l||[])).next())}))}function g(f,l){this.x=f,this.y=l}function _(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var v,T;typeof SuppressedError=="function"&&SuppressedError,g.prototype={clone(){return new g(this.x,this.y)},add(f){return this.clone()._add(f)},sub(f){return this.clone()._sub(f)},multByPoint(f){return this.clone()._multByPoint(f)},divByPoint(f){return this.clone()._divByPoint(f)},mult(f){return this.clone()._mult(f)},div(f){return this.clone()._div(f)},rotate(f){return this.clone()._rotate(f)},rotateAround(f,l){return this.clone()._rotateAround(f,l)},matMult(f){return this.clone()._matMult(f)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(f){return this.x===f.x&&this.y===f.y},dist(f){return Math.sqrt(this.distSqr(f))},distSqr(f){const l=f.x-this.x,h=f.y-this.y;return l*l+h*h},angle(){return Math.atan2(this.y,this.x)},angleTo(f){return Math.atan2(this.y-f.y,this.x-f.x)},angleWith(f){return this.angleWithSep(f.x,f.y)},angleWithSep(f,l){return Math.atan2(this.x*l-this.y*f,this.x*f+this.y*l)},_matMult(f){const l=f[2]*this.x+f[3]*this.y;return this.x=f[0]*this.x+f[1]*this.y,this.y=l,this},_add(f){return this.x+=f.x,this.y+=f.y,this},_sub(f){return this.x-=f.x,this.y-=f.y,this},_mult(f){return this.x*=f,this.y*=f,this},_div(f){return this.x/=f,this.y/=f,this},_multByPoint(f){return this.x*=f.x,this.y*=f.y,this},_divByPoint(f){return this.x/=f.x,this.y/=f.y,this},_unit(){return this._div(this.mag()),this},_perp(){const f=this.y;return this.y=this.x,this.x=-f,this},_rotate(f){const l=Math.cos(f),h=Math.sin(f),m=h*this.x+l*this.y;return this.x=l*this.x-h*this.y,this.y=m,this},_rotateAround(f,l){const h=Math.cos(f),m=Math.sin(f),x=l.y+m*(this.x-l.x)+h*(this.y-l.y);return this.x=l.x+h*(this.x-l.x)-m*(this.y-l.y),this.y=x,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:g},g.convert=function(f){if(f instanceof g)return f;if(Array.isArray(f))return new g(+f[0],+f[1]);if(f.x!==void 0&&f.y!==void 0)return new g(+f.x,+f.y);throw new Error("Expected [x, y] or {x, y} point format")};var M=(function(){if(T)return v;function f(l,h,m,x){this.cx=3*l,this.bx=3*(m-l)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*h,this.by=3*(x-h)-this.cy,this.ay=1-this.cy-this.by,this.p1x=l,this.p1y=h,this.p2x=m,this.p2y=x}return T=1,v=f,f.prototype={sampleCurveX:function(l){return((this.ax*l+this.bx)*l+this.cx)*l},sampleCurveY:function(l){return((this.ay*l+this.by)*l+this.cy)*l},sampleCurveDerivativeX:function(l){return(3*this.ax*l+2*this.bx)*l+this.cx},solveCurveX:function(l,h){if(h===void 0&&(h=1e-6),l<0)return 0;if(l>1)return 1;for(var m=l,x=0;x<8;x++){var A=this.sampleCurveX(m)-l;if(Math.abs(A)<h)return m;var P=this.sampleCurveDerivativeX(m);if(Math.abs(P)<1e-6)break;m-=A/P}var R=0,D=1;for(m=l,x=0;x<20&&(A=this.sampleCurveX(m),!(Math.abs(A-l)<h));x++)l>A?R=m:D=m,m=.5*(D-R)+R;return m},solve:function(l,h){return this.sampleCurveY(this.solveCurveX(l,h))}},v})(),O=_(M);let F,j;function V(){return F==null&&(F=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),F}function q(){if(j==null&&(j=!1,V())){const l=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(l){for(let m=0;m<25;m++){const x=4*m;l.fillStyle=`rgb(${x},${x+1},${x+2})`,l.fillRect(m%5,Math.floor(m/5),1,1)}const h=l.getImageData(0,0,5,5).data;for(let m=0;m<100;m++)if(m%4!=3&&h[m]!==m){j=!0;break}}}return j||!1}var Y=1e-6,X=typeof Float32Array<"u"?Float32Array:Array;function ae(){var f=new X(9);return X!=Float32Array&&(f[1]=0,f[2]=0,f[3]=0,f[5]=0,f[6]=0,f[7]=0),f[0]=1,f[4]=1,f[8]=1,f}function ue(f){return f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=1,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=1,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f}function ge(){var f=new X(3);return X!=Float32Array&&(f[0]=0,f[1]=0,f[2]=0),f}function Le(f){var l=f[0],h=f[1],m=f[2];return Math.sqrt(l*l+h*h+m*m)}function qe(f,l,h){var m=new X(3);return m[0]=f,m[1]=l,m[2]=h,m}function Ze(f,l,h){return f[0]=l[0]+h[0],f[1]=l[1]+h[1],f[2]=l[2]+h[2],f}function _t(f,l,h){return f[0]=l[0]*h,f[1]=l[1]*h,f[2]=l[2]*h,f}function it(f,l,h){var m=l[0],x=l[1],A=l[2],P=h[0],R=h[1],D=h[2];return f[0]=x*D-A*R,f[1]=A*P-m*D,f[2]=m*R-x*P,f}var gt,Lt=Le;function Ot(f,l,h){var m=l[0],x=l[1],A=l[2],P=l[3];return f[0]=h[0]*m+h[4]*x+h[8]*A+h[12]*P,f[1]=h[1]*m+h[5]*x+h[9]*A+h[13]*P,f[2]=h[2]*m+h[6]*x+h[10]*A+h[14]*P,f[3]=h[3]*m+h[7]*x+h[11]*A+h[15]*P,f}function Yt(){var f=new X(4);return X!=Float32Array&&(f[0]=0,f[1]=0,f[2]=0),f[3]=1,f}function ce(f,l,h,m){var x=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",A=Math.PI/360;l*=A,m*=A,h*=A;var P=Math.sin(l),R=Math.cos(l),D=Math.sin(h),U=Math.cos(h),$=Math.sin(m),G=Math.cos(m);switch(x){case"xyz":f[0]=P*U*G+R*D*$,f[1]=R*D*G-P*U*$,f[2]=R*U*$+P*D*G,f[3]=R*U*G-P*D*$;break;case"xzy":f[0]=P*U*G-R*D*$,f[1]=R*D*G-P*U*$,f[2]=R*U*$+P*D*G,f[3]=R*U*G+P*D*$;break;case"yxz":f[0]=P*U*G+R*D*$,f[1]=R*D*G-P*U*$,f[2]=R*U*$-P*D*G,f[3]=R*U*G+P*D*$;break;case"yzx":f[0]=P*U*G+R*D*$,f[1]=R*D*G+P*U*$,f[2]=R*U*$-P*D*G,f[3]=R*U*G-P*D*$;break;case"zxy":f[0]=P*U*G-R*D*$,f[1]=R*D*G+P*U*$,f[2]=R*U*$+P*D*G,f[3]=R*U*G-P*D*$;break;case"zyx":f[0]=P*U*G-R*D*$,f[1]=R*D*G+P*U*$,f[2]=R*U*$-P*D*G,f[3]=R*U*G+P*D*$;break;default:throw new Error("Unknown angle order "+x)}return f}function we(){var f=new X(2);return X!=Float32Array&&(f[0]=0,f[1]=0),f}function Re(f,l){var h=new X(2);return h[0]=f,h[1]=l,h}ge(),gt=new X(4),X!=Float32Array&&(gt[0]=0,gt[1]=0,gt[2]=0,gt[3]=0),ge(),qe(1,0,0),qe(0,1,0),Yt(),Yt(),ae(),we();const Ue=8192;function at(f,l,h){return l*(Ue/(f.tileSize*Math.pow(2,h-f.tileID.overscaledZ)))}function pe(f,l){return(f%l+l)%l}function Pe(f,l,h){return f*(1-h)+l*h}function rt(f){if(f<=0)return 0;if(f>=1)return 1;const l=f*f,h=l*f;return 4*(f<.5?h:3*(f-l)+h-.75)}function vt(f,l,h,m){const x=new O(f,l,h,m);return A=>x.solve(A)}const At=vt(.25,.1,.25,1);function $t(f,l,h){return Math.min(h,Math.max(l,f))}function Gt(f,l,h){const m=h-l,x=((f-l)%m+m)%m+l;return x===l?h:x}function nr(f,...l){for(const h of l)for(const m in h)f[m]=h[m];return f}let Et=1;function Wt(f,l,h){const m={};for(const x in f)m[x]=l.call(this,f[x],x,f);return m}function mr(f,l,h){const m={};for(const x in f)l.call(this,f[x],x,f)&&(m[x]=f[x]);return m}function Mt(f){return Array.isArray(f)?f.map(Mt):typeof f=="object"&&f?Wt(f,Mt):f}const Cr={};function cr(f){Cr[f]||(typeof console<"u"&&console.warn(f),Cr[f]=!0)}function or(f,l,h){return(h.y-f.y)*(l.x-f.x)>(l.y-f.y)*(h.x-f.x)}function ur(f){return typeof WorkerGlobalScope<"u"&&f!==void 0&&f instanceof WorkerGlobalScope}let gs=null;function Os(f){return typeof ImageBitmap<"u"&&f instanceof ImageBitmap}const pa="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Tl(f,l,h,m,x){return s(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const A=new VideoFrame(f,{timestamp:0});try{const P=A?.format;if(!P||!P.startsWith("BGR")&&!P.startsWith("RGB"))throw new Error(`Unrecognized format ${P}`);const R=P.startsWith("BGR"),D=new Uint8ClampedArray(m*x*4);if(yield A.copyTo(D,(function(U,$,G,ee,re){const ne=4*Math.max(-$,0),le=(Math.max(0,G)-G)*ee*4+ne,de=4*ee,xe=Math.max(0,$),$e=Math.max(0,G);return{rect:{x:xe,y:$e,width:Math.min(U.width,$+ee)-xe,height:Math.min(U.height,G+re)-$e},layout:[{offset:le,stride:de}]}})(f,l,h,m,x)),R)for(let U=0;U<D.length;U+=4){const $=D[U];D[U]=D[U+2],D[U+2]=$}return D}finally{A.close()}}))}let Ya,Sl;function Al(f,l,h,m){return f.addEventListener(l,h,m),{unsubscribe:()=>{f.removeEventListener(l,h,m)}}}function Ei(f){return f*Math.PI/180}function El(f){return f/Math.PI*180}const Oo={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},ko={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Do="AbortError";function je(){return new Error(Do)}const ie={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function se(f){return ie.REGISTERED_PROTOCOLS[f.substring(0,f.indexOf("://"))]}const fe="global-dispatcher";class Me extends Error{constructor(l,h,m,x){super(`AJAXError: ${h} (${l}): ${m}`),this.status=l,this.statusText=h,this.url=m,this.body=x}}const ke=()=>ur(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Fe=function(f,l){if(/:\/\//.test(f.url)&&!/^https?:|^file:/.test(f.url)){const m=se(f.url);if(m)return m(f,l);if(ur(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:f,targetMapId:fe},l)}if(!(/^file:/.test(h=f.url)||/^file:/.test(ke())&&!/^\w+:/.test(h))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(m,x){return s(this,void 0,void 0,(function*(){const A=new Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,cache:m.cache,referrer:ke(),signal:x.signal});let P,R;m.type!=="json"||A.headers.has("Accept")||A.headers.set("Accept","application/json");try{P=yield fetch(A)}catch(U){throw new Me(0,U.message,m.url,new Blob)}if(!P.ok){const U=yield P.blob();throw new Me(P.status,P.statusText,m.url,U)}R=m.type==="arrayBuffer"||m.type==="image"?P.arrayBuffer():m.type==="json"?P.json():P.text();const D=yield R;if(x.signal.aborted)throw je();return{data:D,cacheControl:P.headers.get("Cache-Control"),expires:P.headers.get("Expires")}}))})(f,l);if(ur(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:f,mustQueue:!0,targetMapId:fe},l)}var h;return(function(m,x){return new Promise(((A,P)=>{var R;const D=new XMLHttpRequest;D.open(m.method||"GET",m.url,!0),m.type!=="arrayBuffer"&&m.type!=="image"||(D.responseType="arraybuffer");for(const U in m.headers)D.setRequestHeader(U,m.headers[U]);m.type==="json"&&(D.responseType="text",!((R=m.headers)===null||R===void 0)&&R.Accept||D.setRequestHeader("Accept","application/json")),D.withCredentials=m.credentials==="include",D.onerror=()=>{P(new Error(D.statusText))},D.onload=()=>{if(!x.signal.aborted)if((D.status>=200&&D.status<300||D.status===0)&&D.response!==null){let U=D.response;if(m.type==="json")try{U=JSON.parse(D.response)}catch($){return void P($)}A({data:U,cacheControl:D.getResponseHeader("Cache-Control"),expires:D.getResponseHeader("Expires")})}else{const U=new Blob([D.response],{type:D.getResponseHeader("Content-Type")});P(new Me(D.status,D.statusText,m.url,U))}},x.signal.addEventListener("abort",(()=>{D.abort(),P(je())})),D.send(m.body)}))})(f,l)};function Qe(f){if(!f||f.indexOf("://")<=0||f.indexOf("data:image/")===0||f.indexOf("blob:")===0)return!0;const l=new URL(f),h=window.location;return l.protocol===h.protocol&&l.host===h.host}function We(f,l,h){h[f]&&h[f].indexOf(l)!==-1||(h[f]=h[f]||[],h[f].push(l))}function dt(f,l,h){if(h&&h[f]){const m=h[f].indexOf(l);m!==-1&&h[f].splice(m,1)}}class kt{constructor(l,h={}){nr(this,h),this.type=l}}class mt extends kt{constructor(l,h={}){super("error",nr({error:l},h))}}class Xt{on(l,h){return this._listeners=this._listeners||{},We(l,h,this._listeners),{unsubscribe:()=>{this.off(l,h)}}}off(l,h){return dt(l,h,this._listeners),dt(l,h,this._oneTimeListeners),this}once(l,h){return h?(this._oneTimeListeners=this._oneTimeListeners||{},We(l,h,this._oneTimeListeners),this):new Promise((m=>this.once(l,m)))}fire(l,h){typeof l=="string"&&(l=new kt(l,h||{}));const m=l.type;if(this.listens(m)){l.target=this;const x=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const R of x)R.call(this,l);const A=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const R of A)dt(m,R,this._oneTimeListeners),R.call(this,l);const P=this._eventedParent;P&&(nr(l,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),P.fire(l))}else l instanceof mt&&console.error(l.error);return this}listens(l){return this._listeners&&this._listeners[l]&&this._listeners[l].length>0||this._oneTimeListeners&&this._oneTimeListeners[l]&&this._oneTimeListeners[l].length>0||this._eventedParent&&this._eventedParent.listens(l)}setEventedParent(l,h){return this._eventedParent=l,this._eventedParentData=h,this}}var He={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const fr=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ir(f,l){const h={};for(const m in f)m!=="ref"&&(h[m]=f[m]);return fr.forEach((m=>{m in l&&(h[m]=l[m])})),h}function er(f,l){if(Array.isArray(f)){if(!Array.isArray(l)||f.length!==l.length)return!1;for(let h=0;h<f.length;h++)if(!er(f[h],l[h]))return!1;return!0}if(typeof f=="object"&&f!==null&&l!==null){if(typeof l!="object"||Object.keys(f).length!==Object.keys(l).length)return!1;for(const h in f)if(!er(f[h],l[h]))return!1;return!0}return f===l}function Ar(f,l){f.push(l)}function mn(f,l,h){Ar(h,{command:"addSource",args:[f,l[f]]})}function $n(f,l,h){Ar(l,{command:"removeSource",args:[f]}),h[f]=!0}function Hn(f,l,h,m){$n(f,h,m),mn(f,l,h)}function Ci(f,l,h){let m;for(m in f[h])if(Object.prototype.hasOwnProperty.call(f[h],m)&&m!=="data"&&!er(f[h][m],l[h][m]))return!1;for(m in l[h])if(Object.prototype.hasOwnProperty.call(l[h],m)&&m!=="data"&&!er(f[h][m],l[h][m]))return!1;return!0}function yi(f,l,h,m,x,A){f=f||{},l=l||{};for(const P in f)Object.prototype.hasOwnProperty.call(f,P)&&(er(f[P],l[P])||h.push({command:A,args:[m,P,l[P],x]}));for(const P in l)Object.prototype.hasOwnProperty.call(l,P)&&!Object.prototype.hasOwnProperty.call(f,P)&&(er(f[P],l[P])||h.push({command:A,args:[m,P,l[P],x]}))}function yn(f){return f.id}function Jn(f,l){return f[l.id]=l,f}class bt{constructor(l,h,m,x){this.message=(l?`${l}: `:"")+m,x&&(this.identifier=x),h!=null&&h.__line__&&(this.line=h.__line__)}}function Wn(f,...l){for(const h of l)for(const m in h)f[m]=h[m];return f}class ks extends Error{constructor(l,h){super(h),this.message=h,this.key=l}}class Cl{constructor(l,h=[]){this.parent=l,this.bindings={};for(const[m,x]of h)this.bindings[m]=x}concat(l){return new Cl(this,l)}get(l){if(this.bindings[l])return this.bindings[l];if(this.parent)return this.parent.get(l);throw new Error(`${l} not found in scope.`)}has(l){return!!this.bindings[l]||!!this.parent&&this.parent.has(l)}}const qn={kind:"null"},Pt={kind:"number"},lr={kind:"string"},_r={kind:"boolean"},Pi={kind:"color"},wc={kind:"projectionDefinition"},Pl={kind:"object"},xr={kind:"value"},Ml={kind:"collator"},Ka={kind:"formatted"},Lo={kind:"padding"},ms={kind:"colorArray"},Qa={kind:"numberArray"},_n={kind:"resolvedImage"},ni={kind:"variableAnchorOffsetCollection"};function ys(f,l){return{kind:"array",itemType:f,N:l}}function un(f){if(f.kind==="array"){const l=un(f.itemType);return typeof f.N=="number"?`array<${l}, ${f.N}>`:f.itemType.kind==="value"?"array":`array<${l}>`}return f.kind}const Il=[qn,Pt,lr,_r,Pi,wc,Ka,Pl,ys(xr),Lo,Qa,ms,_n,ni];function Ja(f,l){if(l.kind==="error")return null;if(f.kind==="array"){if(l.kind==="array"&&(l.N===0&&l.itemType.kind==="value"||!Ja(f.itemType,l.itemType))&&(typeof f.N!="number"||f.N===l.N))return null}else{if(f.kind===l.kind)return null;if(f.kind==="value"){for(const h of Il)if(!Ja(h,l))return null}}return`Expected ${un(f)} but found ${un(l)} instead.`}function qd(f,l){return l.some((h=>h.kind===f.kind))}function Bo(f,l){return l.some((h=>h==="null"?f===null:h==="array"?Array.isArray(f):h==="object"?f&&!Array.isArray(f)&&typeof f=="object":h===typeof f))}function No(f,l){return f.kind==="array"&&l.kind==="array"?f.itemType.kind===l.itemType.kind&&typeof f.N=="number":f.kind===l.kind}const Gd=.96422,fh=.82521,dh=4/29,Ds=6/29,ea=3*Ds*Ds,$g=Ds*Ds*Ds,Xy=Math.PI/180,Xd=180/Math.PI;function Rf(f){return(f%=360)<0&&(f+=360),f}function zo([f,l,h,m]){let x,A;const P=Ls((.2225045*(f=Zd(f))+.7168786*(l=Zd(l))+.0606169*(h=Zd(h)))/1);f===l&&l===h?x=A=P:(x=Ls((.4360747*f+.3850649*l+.1430804*h)/Gd),A=Ls((.0139322*f+.0971045*l+.7141733*h)/fh));const R=116*P-16;return[R<0?0:R,500*(x-P),200*(P-A),m]}function Zd(f){return f<=.04045?f/12.92:Math.pow((f+.055)/1.055,2.4)}function Ls(f){return f>$g?Math.pow(f,1/3):f/ea+dh}function Rl([f,l,h,m]){let x=(f+16)/116,A=isNaN(l)?x:x+l/500,P=isNaN(h)?x:x-h/200;return x=1*ph(x),A=Gd*ph(A),P=fh*ph(P),[Of(3.1338561*A-1.6168667*x-.4906146*P),Of(-.9787684*A+1.9161415*x+.033454*P),Of(.0719453*A-.2289914*x+1.4052427*P),m]}function Of(f){return(f=f<=.00304?12.92*f:1.055*Math.pow(f,1/2.4)-.055)<0?0:f>1?1:f}function ph(f){return f>Ds?f*f*f:ea*(f-dh)}const hu=Object.hasOwn||function(f,l){return Object.prototype.hasOwnProperty.call(f,l)};function Tc(f,l){return hu(f,l)?f[l]:void 0}function fu(f){return parseInt(f.padEnd(2,f),16)/255}function ts(f,l){return Dr(l?f/100:f,0,1)}function Dr(f,l,h){return Math.min(Math.max(l,f),h)}function Ol(f){return!f.some(Number.isNaN)}const Fo={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function La(f,l,h){return f+h*(l-f)}function Sc(f,l,h){return f.map(((m,x)=>La(m,l[x],h)))}class Lr{constructor(l,h,m,x=1,A=!0){this.r=l,this.g=h,this.b=m,this.a=x,A||(this.r*=x,this.g*=x,this.b*=x,x||this.overwriteGetter("rgb",[l,h,m,x]))}static parse(l){if(l instanceof Lr)return l;if(typeof l!="string")return;const h=(function(m){if((m=m.toLowerCase().trim())==="transparent")return[0,0,0,0];const x=Tc(Fo,m);if(x){const[P,R,D]=x;return[P/255,R/255,D/255,1]}if(m.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(m)){const P=m.length<6?1:2;let R=1;return[fu(m.slice(R,R+=P)),fu(m.slice(R,R+=P)),fu(m.slice(R,R+=P)),fu(m.slice(R,R+P)||"ff")]}if(m.startsWith("rgb")){const P=m.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(P){const[R,D,U,$,G,ee,re,ne,le,de,xe,$e]=P,Ie=[$||" ",re||" ",de].join("");if(Ie==="  "||Ie==="  /"||Ie===",,"||Ie===",,,"){const De=[U,ee,le].join(""),et=De==="%%%"?100:De===""?255:0;if(et){const ft=[Dr(+D/et,0,1),Dr(+G/et,0,1),Dr(+ne/et,0,1),xe?ts(+xe,$e):1];if(Ol(ft))return ft}}return}}const A=m.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(A){const[P,R,D,U,$,G,ee,re,ne]=A,le=[D||" ",$||" ",ee].join("");if(le==="  "||le==="  /"||le===",,"||le===",,,"){const de=[+R,Dr(+U,0,100),Dr(+G,0,100),re?ts(+re,ne):1];if(Ol(de))return(function([xe,$e,Ie,De]){function et(ft){const St=(ft+xe/30)%12,Vt=$e*Math.min(Ie,1-Ie);return Ie-Vt*Math.max(-1,Math.min(St-3,9-St,1))}return xe=Rf(xe),$e/=100,Ie/=100,[et(0),et(8),et(4),De]})(de)}}})(l);return h?new Lr(...h,!1):void 0}get rgb(){const{r:l,g:h,b:m,a:x}=this,A=x||1/0;return this.overwriteGetter("rgb",[l/A,h/A,m/A,x])}get hcl(){return this.overwriteGetter("hcl",(function(l){const[h,m,x,A]=zo(l),P=Math.sqrt(m*m+x*x);return[Math.round(1e4*P)?Rf(Math.atan2(x,m)*Xd):NaN,P,h,A]})(this.rgb))}get lab(){return this.overwriteGetter("lab",zo(this.rgb))}overwriteGetter(l,h){return Object.defineProperty(this,l,{value:h}),h}toString(){const[l,h,m,x]=this.rgb;return`rgba(${[l,h,m].map((A=>Math.round(255*A))).join(",")},${x})`}static interpolate(l,h,m,x="rgb"){switch(x){case"rgb":{const[A,P,R,D]=Sc(l.rgb,h.rgb,m);return new Lr(A,P,R,D,!1)}case"hcl":{const[A,P,R,D]=l.hcl,[U,$,G,ee]=h.hcl;let re,ne;if(isNaN(A)||isNaN(U))isNaN(A)?isNaN(U)?re=NaN:(re=U,R!==1&&R!==0||(ne=$)):(re=A,G!==1&&G!==0||(ne=P));else{let Ie=U-A;U>A&&Ie>180?Ie-=360:U<A&&A-U>180&&(Ie+=360),re=A+m*Ie}const[le,de,xe,$e]=(function([Ie,De,et,ft]){return Ie=isNaN(Ie)?0:Ie*Xy,Rl([et,Math.cos(Ie)*De,Math.sin(Ie)*De,ft])})([re,ne??La(P,$,m),La(R,G,m),La(D,ee,m)]);return new Lr(le,de,xe,$e,!1)}case"lab":{const[A,P,R,D]=Rl(Sc(l.lab,h.lab,m));return new Lr(A,P,R,D,!1)}}}}Lr.black=new Lr(0,0,0,1),Lr.white=new Lr(1,1,1,1),Lr.transparent=new Lr(0,0,0,0),Lr.red=new Lr(1,0,0,1);class eo{constructor(l,h,m){this.sensitivity=l?h?"variant":"case":h?"accent":"base",this.locale=m,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(l,h){return this.collator.compare(l,h)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const ga=["bottom","center","top"];class du{constructor(l,h,m,x,A,P){this.text=l,this.image=h,this.scale=m,this.fontStack=x,this.textColor=A,this.verticalAlign=P}}class Yi{constructor(l){this.sections=l}static fromString(l){return new Yi([new du(l,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((l=>l.text.length!==0||l.image&&l.image.name.length!==0))}static factory(l){return l instanceof Yi?l:Yi.fromString(l)}toString(){return this.sections.length===0?"":this.sections.map((l=>l.text)).join("")}}class Gn{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof Gn)return l;if(typeof l=="number")return new Gn([l,l,l,l]);if(Array.isArray(l)&&!(l.length<1||l.length>4)){for(const h of l)if(typeof h!="number")return;switch(l.length){case 1:l=[l[0],l[0],l[0],l[0]];break;case 2:l=[l[0],l[1],l[0],l[1]];break;case 3:l=[l[0],l[1],l[2],l[1]]}return new Gn(l)}}toString(){return JSON.stringify(this.values)}static interpolate(l,h,m){return new Gn(Sc(l.values,h.values,m))}}class _i{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof _i)return l;if(typeof l=="number")return new _i([l]);if(Array.isArray(l)){for(const h of l)if(typeof h!="number")return;return new _i(l)}}toString(){return JSON.stringify(this.values)}static interpolate(l,h,m){return new _i(Sc(l.values,h.values,m))}}class ii{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof ii)return l;if(typeof l=="string"){const m=Lr.parse(l);return m?new ii([m]):void 0}if(!Array.isArray(l))return;const h=[];for(const m of l){if(typeof m!="string")return;const x=Lr.parse(m);if(!x)return;h.push(x)}return new ii(h)}toString(){return JSON.stringify(this.values)}static interpolate(l,h,m,x="rgb"){const A=[];if(l.values.length!=h.values.length)throw new Error(`colorArray: Arrays have mismatched length (${l.values.length} vs. ${h.values.length}), cannot interpolate.`);for(let P=0;P<l.values.length;P++)A.push(Lr.interpolate(l.values[P],h.values[P],m,x));return new ii(A)}}class nn extends Error{constructor(l){super(l),this.name="RuntimeError"}toJSON(){return this.message}}const Yd=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Mi{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof Mi)return l;if(Array.isArray(l)&&!(l.length<1)&&l.length%2==0){for(let h=0;h<l.length;h+=2){const m=l[h],x=l[h+1];if(typeof m!="string"||!Yd.has(m)||!Array.isArray(x)||x.length!==2||typeof x[0]!="number"||typeof x[1]!="number")return}return new Mi(l)}}toString(){return JSON.stringify(this.values)}static interpolate(l,h,m){const x=l.values,A=h.values;if(x.length!==A.length)throw new nn(`Cannot interpolate values of different length. from: ${l.toString()}, to: ${h.toString()}`);const P=[];for(let R=0;R<x.length;R+=2){if(x[R]!==A[R])throw new nn(`Cannot interpolate values containing mismatched anchors. from[${R}]: ${x[R]}, to[${R}]: ${A[R]}`);P.push(x[R]);const[D,U]=x[R+1],[$,G]=A[R+1];P.push([La(D,$,m),La(U,G,m)])}return new Mi(P)}}class si{constructor(l){this.name=l.name,this.available=l.available}toString(){return this.name}static fromString(l){return l?new si({name:l,available:!1}):null}}class zi{constructor(l,h,m){this.from=l,this.to=h,this.transition=m}static interpolate(l,h,m){return new zi(l,h,m)}static parse(l){return l instanceof zi?l:Array.isArray(l)&&l.length===3&&typeof l[0]=="string"&&typeof l[1]=="string"&&typeof l[2]=="number"?new zi(l[0],l[1],l[2]):typeof l=="object"&&typeof l.from=="string"&&typeof l.to=="string"&&typeof l.transition=="number"?new zi(l.from,l.to,l.transition):typeof l=="string"?new zi(l,l,1):void 0}}function sn(f,l,h,m){return typeof f=="number"&&f>=0&&f<=255&&typeof l=="number"&&l>=0&&l<=255&&typeof h=="number"&&h>=0&&h<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:`Invalid rgba value [${[f,l,h,m].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof m=="number"?[f,l,h,m]:[f,l,h]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Bs(f){if(f===null||typeof f=="string"||typeof f=="boolean"||typeof f=="number"||f instanceof zi||f instanceof Lr||f instanceof eo||f instanceof Yi||f instanceof Gn||f instanceof _i||f instanceof ii||f instanceof Mi||f instanceof si)return!0;if(Array.isArray(f)){for(const l of f)if(!Bs(l))return!1;return!0}if(typeof f=="object"){for(const l in f)if(!Bs(f[l]))return!1;return!0}return!1}function hr(f){if(f===null)return qn;if(typeof f=="string")return lr;if(typeof f=="boolean")return _r;if(typeof f=="number")return Pt;if(f instanceof Lr)return Pi;if(f instanceof zi)return wc;if(f instanceof eo)return Ml;if(f instanceof Yi)return Ka;if(f instanceof Gn)return Lo;if(f instanceof _i)return Qa;if(f instanceof ii)return ms;if(f instanceof Mi)return ni;if(f instanceof si)return _n;if(Array.isArray(f)){const l=f.length;let h;for(const m of f){const x=hr(m);if(h){if(h===x)continue;h=xr;break}h=x}return ys(h||xr,l)}return Pl}function yr(f){const l=typeof f;return f===null?"":l==="string"||l==="number"||l==="boolean"?String(f):f instanceof Lr||f instanceof zi||f instanceof Yi||f instanceof Gn||f instanceof _i||f instanceof ii||f instanceof Mi||f instanceof si?f.toString():JSON.stringify(f)}class to{constructor(l,h){this.type=l,this.value=h}static parse(l,h){if(l.length!==2)return h.error(`'literal' expression requires exactly one argument, but found ${l.length-1} instead.`);if(!Bs(l[1]))return h.error("invalid value");const m=l[1];let x=hr(m);const A=h.expectedType;return x.kind!=="array"||x.N!==0||!A||A.kind!=="array"||typeof A.N=="number"&&A.N!==0||(x=A),new to(x,m)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const zr={string:lr,number:Pt,boolean:_r,object:Pl};class rs{constructor(l,h){this.type=l,this.args=h}static parse(l,h){if(l.length<2)return h.error("Expected at least one argument.");let m,x=1;const A=l[0];if(A==="array"){let R,D;if(l.length>2){const U=l[1];if(typeof U!="string"||!(U in zr)||U==="object")return h.error('The item type argument of "array" must be one of string, number, boolean',1);R=zr[U],x++}else R=xr;if(l.length>3){if(l[2]!==null&&(typeof l[2]!="number"||l[2]<0||l[2]!==Math.floor(l[2])))return h.error('The length argument to "array" must be a positive integer literal',2);D=l[2],x++}m=ys(R,D)}else{if(!zr[A])throw new Error(`Types doesn't contain name = ${A}`);m=zr[A]}const P=[];for(;x<l.length;x++){const R=h.parse(l[x],x,xr);if(!R)return null;P.push(R)}return new rs(m,P)}evaluate(l){for(let h=0;h<this.args.length;h++){const m=this.args[h].evaluate(l);if(!Ja(this.type,hr(m)))return m;if(h===this.args.length-1)throw new nn(`Expected value to be of type ${un(this.type)}, but found ${un(hr(m))} instead.`)}throw new Error}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every((l=>l.outputDefined()))}}const Ba={"to-boolean":_r,"to-color":Pi,"to-number":Pt,"to-string":lr};class Xn{constructor(l,h){this.type=l,this.args=h}static parse(l,h){if(l.length<2)return h.error("Expected at least one argument.");const m=l[0];if(!Ba[m])throw new Error(`Can't parse ${m} as it is not part of the known types`);if((m==="to-boolean"||m==="to-string")&&l.length!==2)return h.error("Expected one argument.");const x=Ba[m],A=[];for(let P=1;P<l.length;P++){const R=h.parse(l[P],P,xr);if(!R)return null;A.push(R)}return new Xn(x,A)}evaluate(l){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(l);case"color":{let h,m;for(const x of this.args){if(h=x.evaluate(l),m=null,h instanceof Lr)return h;if(typeof h=="string"){const A=l.parseColor(h);if(A)return A}else if(Array.isArray(h)&&(m=h.length<3||h.length>4?`Invalid rgba value ${JSON.stringify(h)}: expected an array containing either three or four numeric values.`:sn(h[0],h[1],h[2],h[3]),!m))return new Lr(h[0]/255,h[1]/255,h[2]/255,h[3])}throw new nn(m||`Could not parse color from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"padding":{let h;for(const m of this.args){h=m.evaluate(l);const x=Gn.parse(h);if(x)return x}throw new nn(`Could not parse padding from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"numberArray":{let h;for(const m of this.args){h=m.evaluate(l);const x=_i.parse(h);if(x)return x}throw new nn(`Could not parse numberArray from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"colorArray":{let h;for(const m of this.args){h=m.evaluate(l);const x=ii.parse(h);if(x)return x}throw new nn(`Could not parse colorArray from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"variableAnchorOffsetCollection":{let h;for(const m of this.args){h=m.evaluate(l);const x=Mi.parse(h);if(x)return x}throw new nn(`Could not parse variableAnchorOffsetCollection from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"number":{let h=null;for(const m of this.args){if(h=m.evaluate(l),h===null)return 0;const x=Number(h);if(!isNaN(x))return x}throw new nn(`Could not convert ${JSON.stringify(h)} to number.`)}case"formatted":return Yi.fromString(yr(this.args[0].evaluate(l)));case"resolvedImage":return si.fromString(yr(this.args[0].evaluate(l)));case"projectionDefinition":return this.args[0].evaluate(l);default:return yr(this.args[0].evaluate(l))}}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every((l=>l.outputDefined()))}}const ro=["Unknown","Point","LineString","Polygon"];class pu{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ro[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(l){let h=this._parseColorCache.get(l);return h||(h=Lr.parse(l),this._parseColorCache.set(l,h)),h}}class no{constructor(l,h,m=[],x,A=new Cl,P=[]){this.registry=l,this.path=m,this.key=m.map((R=>`[${R}]`)).join(""),this.scope=A,this.errors=P,this.expectedType=x,this._isConstant=h}parse(l,h,m,x,A={}){return h?this.concat(h,m,x)._parse(l,A):this._parse(l,A)}_parse(l,h){function m(x,A,P){return P==="assert"?new rs(A,[x]):P==="coerce"?new Xn(A,[x]):x}if(l!==null&&typeof l!="string"&&typeof l!="boolean"&&typeof l!="number"||(l=["literal",l]),Array.isArray(l)){if(l.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const x=l[0];if(typeof x!="string")return this.error(`Expression name must be a string, but found ${typeof x} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const A=this.registry[x];if(A){let P=A.parse(l,this);if(!P)return null;if(this.expectedType){const R=this.expectedType,D=P.type;if(R.kind!=="string"&&R.kind!=="number"&&R.kind!=="boolean"&&R.kind!=="object"&&R.kind!=="array"||D.kind!=="value"){if(R.kind==="projectionDefinition"&&["string","array"].includes(D.kind)||["color","formatted","resolvedImage"].includes(R.kind)&&["value","string"].includes(D.kind)||["padding","numberArray"].includes(R.kind)&&["value","number","array"].includes(D.kind)||R.kind==="colorArray"&&["value","string","array"].includes(D.kind)||R.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(D.kind))P=m(P,R,h.typeAnnotation||"coerce");else if(this.checkSubtype(R,D))return null}else P=m(P,R,h.typeAnnotation||"assert")}if(!(P instanceof to)&&P.type.kind!=="resolvedImage"&&this._isConstant(P)){const R=new pu;try{P=new to(P.type,P.evaluate(R))}catch(D){return this.error(D.message),null}}return P}return this.error(`Unknown expression "${x}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(l===void 0?"'undefined' value invalid. Use null instead.":typeof l=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof l} instead.`)}concat(l,h,m){const x=typeof l=="number"?this.path.concat(l):this.path,A=m?this.scope.concat(m):this.scope;return new no(this.registry,this._isConstant,x,h||null,A,this.errors)}error(l,...h){const m=`${this.key}${h.map((x=>`[${x}]`)).join("")}`;this.errors.push(new ks(m,l))}checkSubtype(l,h){const m=Ja(l,h);return m&&this.error(m),m}}class gh{constructor(l,h){this.type=h.type,this.bindings=[].concat(l),this.result=h}evaluate(l){return this.result.evaluate(l)}eachChild(l){for(const h of this.bindings)l(h[1]);l(this.result)}static parse(l,h){if(l.length<4)return h.error(`Expected at least 3 arguments, but found ${l.length-1} instead.`);const m=[];for(let A=1;A<l.length-1;A+=2){const P=l[A];if(typeof P!="string")return h.error(`Expected string, but found ${typeof P} instead.`,A);if(/[^a-zA-Z0-9_]/.test(P))return h.error("Variable names must contain only alphanumeric characters or '_'.",A);const R=h.parse(l[A+1],A+1);if(!R)return null;m.push([P,R])}const x=h.parse(l[l.length-1],l.length-1,h.expectedType,m);return x?new gh(m,x):null}outputDefined(){return this.result.outputDefined()}}class gu{constructor(l,h){this.type=h.type,this.name=l,this.boundExpression=h}static parse(l,h){if(l.length!==2||typeof l[1]!="string")return h.error("'var' expression requires exactly one string literal argument.");const m=l[1];return h.scope.has(m)?new gu(m,h.scope.get(m)):h.error(`Unknown variable "${m}". Make sure "${m}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(l){return this.boundExpression.evaluate(l)}eachChild(){}outputDefined(){return!1}}class mu{constructor(l,h,m){this.type=l,this.index=h,this.input=m}static parse(l,h){if(l.length!==3)return h.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const m=h.parse(l[1],1,Pt),x=h.parse(l[2],2,ys(h.expectedType||xr));return m&&x?new mu(x.type.itemType,m,x):null}evaluate(l){const h=this.index.evaluate(l),m=this.input.evaluate(l);if(h<0)throw new nn(`Array index out of bounds: ${h} < 0.`);if(h>=m.length)throw new nn(`Array index out of bounds: ${h} > ${m.length-1}.`);if(h!==Math.floor(h))throw new nn(`Array index must be an integer, but found ${h} instead.`);return m[h]}eachChild(l){l(this.index),l(this.input)}outputDefined(){return!1}}class kl{constructor(l,h){this.type=_r,this.needle=l,this.haystack=h}static parse(l,h){if(l.length!==3)return h.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const m=h.parse(l[1],1,xr),x=h.parse(l[2],2,xr);return m&&x?qd(m.type,[_r,lr,Pt,qn,xr])?new kl(m,x):h.error(`Expected first argument to be of type boolean, string, number or null, but found ${un(m.type)} instead`):null}evaluate(l){const h=this.needle.evaluate(l),m=this.haystack.evaluate(l);if(!m)return!1;if(!Bo(h,["boolean","string","number","null"]))throw new nn(`Expected first argument to be of type boolean, string, number or null, but found ${un(hr(h))} instead.`);if(!Bo(m,["string","array"]))throw new nn(`Expected second argument to be of type array or string, but found ${un(hr(m))} instead.`);return m.indexOf(h)>=0}eachChild(l){l(this.needle),l(this.haystack)}outputDefined(){return!0}}class Ns{constructor(l,h,m){this.type=Pt,this.needle=l,this.haystack=h,this.fromIndex=m}static parse(l,h){if(l.length<=2||l.length>=5)return h.error(`Expected 2 or 3 arguments, but found ${l.length-1} instead.`);const m=h.parse(l[1],1,xr),x=h.parse(l[2],2,xr);if(!m||!x)return null;if(!qd(m.type,[_r,lr,Pt,qn,xr]))return h.error(`Expected first argument to be of type boolean, string, number or null, but found ${un(m.type)} instead`);if(l.length===4){const A=h.parse(l[3],3,Pt);return A?new Ns(m,x,A):null}return new Ns(m,x)}evaluate(l){const h=this.needle.evaluate(l),m=this.haystack.evaluate(l);if(!Bo(h,["boolean","string","number","null"]))throw new nn(`Expected first argument to be of type boolean, string, number or null, but found ${un(hr(h))} instead.`);let x;if(this.fromIndex&&(x=this.fromIndex.evaluate(l)),Bo(m,["string"])){const A=m.indexOf(h,x);return A===-1?-1:[...m.slice(0,A)].length}if(Bo(m,["array"]))return m.indexOf(h,x);throw new nn(`Expected second argument to be of type array or string, but found ${un(hr(m))} instead.`)}eachChild(l){l(this.needle),l(this.haystack),this.fromIndex&&l(this.fromIndex)}outputDefined(){return!1}}class Ii{constructor(l,h,m,x,A,P){this.inputType=l,this.type=h,this.input=m,this.cases=x,this.outputs=A,this.otherwise=P}static parse(l,h){if(l.length<5)return h.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if(l.length%2!=1)return h.error("Expected an even number of arguments.");let m,x;h.expectedType&&h.expectedType.kind!=="value"&&(x=h.expectedType);const A={},P=[];for(let U=2;U<l.length-1;U+=2){let $=l[U];const G=l[U+1];Array.isArray($)||($=[$]);const ee=h.concat(U);if($.length===0)return ee.error("Expected at least one branch label.");for(const ne of $){if(typeof ne!="number"&&typeof ne!="string")return ee.error("Branch labels must be numbers or strings.");if(typeof ne=="number"&&Math.abs(ne)>Number.MAX_SAFE_INTEGER)return ee.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ne=="number"&&Math.floor(ne)!==ne)return ee.error("Numeric branch labels must be integer values.");if(m){if(ee.checkSubtype(m,hr(ne)))return null}else m=hr(ne);if(A[String(ne)]!==void 0)return ee.error("Branch labels must be unique.");A[String(ne)]=P.length}const re=h.parse(G,U,x);if(!re)return null;x=x||re.type,P.push(re)}const R=h.parse(l[1],1,xr);if(!R)return null;const D=h.parse(l[l.length-1],l.length-1,x);return D?R.type.kind!=="value"&&h.concat(1).checkSubtype(m,R.type)?null:new Ii(m,x,R,A,P,D):null}evaluate(l){const h=this.input.evaluate(l);return(hr(h)===this.inputType&&this.outputs[this.cases[h]]||this.otherwise).evaluate(l)}eachChild(l){l(this.input),this.outputs.forEach(l),l(this.otherwise)}outputDefined(){return this.outputs.every((l=>l.outputDefined()))&&this.otherwise.outputDefined()}}class yu{constructor(l,h,m){this.type=l,this.branches=h,this.otherwise=m}static parse(l,h){if(l.length<4)return h.error(`Expected at least 3 arguments, but found only ${l.length-1}.`);if(l.length%2!=0)return h.error("Expected an odd number of arguments.");let m;h.expectedType&&h.expectedType.kind!=="value"&&(m=h.expectedType);const x=[];for(let P=1;P<l.length-1;P+=2){const R=h.parse(l[P],P,_r);if(!R)return null;const D=h.parse(l[P+1],P+1,m);if(!D)return null;x.push([R,D]),m=m||D.type}const A=h.parse(l[l.length-1],l.length-1,m);if(!A)return null;if(!m)throw new Error("Can't infer output type");return new yu(m,x,A)}evaluate(l){for(const[h,m]of this.branches)if(h.evaluate(l))return m.evaluate(l);return this.otherwise.evaluate(l)}eachChild(l){for(const[h,m]of this.branches)l(h),l(m);l(this.otherwise)}outputDefined(){return this.branches.every((([l,h])=>h.outputDefined()))&&this.otherwise.outputDefined()}}class mh{constructor(l,h,m,x){this.type=l,this.input=h,this.beginIndex=m,this.endIndex=x}static parse(l,h){if(l.length<=2||l.length>=5)return h.error(`Expected 2 or 3 arguments, but found ${l.length-1} instead.`);const m=h.parse(l[1],1,xr),x=h.parse(l[2],2,Pt);if(!m||!x)return null;if(!qd(m.type,[ys(xr),lr,xr]))return h.error(`Expected first argument to be of type array or string, but found ${un(m.type)} instead`);if(l.length===4){const A=h.parse(l[3],3,Pt);return A?new mh(m.type,m,x,A):null}return new mh(m.type,m,x)}evaluate(l){const h=this.input.evaluate(l),m=this.beginIndex.evaluate(l);let x;if(this.endIndex&&(x=this.endIndex.evaluate(l)),Bo(h,["string"]))return[...h].slice(m,x).join("");if(Bo(h,["array"]))return h.slice(m,x);throw new nn(`Expected first argument to be of type array or string, but found ${un(hr(h))} instead.`)}eachChild(l){l(this.input),l(this.beginIndex),this.endIndex&&l(this.endIndex)}outputDefined(){return!1}}function Ac(f,l){const h=f.length-1;let m,x,A=0,P=h,R=0;for(;A<=P;)if(R=Math.floor((A+P)/2),m=f[R],x=f[R+1],m<=l){if(R===h||l<x)return R;A=R+1}else{if(!(m>l))throw new nn("Input is not a number.");P=R-1}return 0}class zn{constructor(l,h,m){this.type=l,this.input=h,this.labels=[],this.outputs=[];for(const[x,A]of m)this.labels.push(x),this.outputs.push(A)}static parse(l,h){if(l.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return h.error("Expected an even number of arguments.");const m=h.parse(l[1],1,Pt);if(!m)return null;const x=[];let A=null;h.expectedType&&h.expectedType.kind!=="value"&&(A=h.expectedType);for(let P=1;P<l.length;P+=2){const R=P===1?-1/0:l[P],D=l[P+1],U=P,$=P+1;if(typeof R!="number")return h.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(x.length&&x[x.length-1][0]>=R)return h.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',U);const G=h.parse(D,$,A);if(!G)return null;A=A||G.type,x.push([R,G])}return new zn(A,m,x)}evaluate(l){const h=this.labels,m=this.outputs;if(h.length===1)return m[0].evaluate(l);const x=this.input.evaluate(l);if(x<=h[0])return m[0].evaluate(l);const A=h.length;return x>=h[A-1]?m[A-1].evaluate(l):m[Ac(h,x)].evaluate(l)}eachChild(l){l(this.input);for(const h of this.outputs)l(h)}outputDefined(){return this.outputs.every((l=>l.outputDefined()))}}function Hg(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var yh,Kd,Zy=(function(){if(Kd)return yh;function f(l,h,m,x){this.cx=3*l,this.bx=3*(m-l)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*h,this.by=3*(x-h)-this.cy,this.ay=1-this.cy-this.by,this.p1x=l,this.p1y=h,this.p2x=m,this.p2y=x}return Kd=1,yh=f,f.prototype={sampleCurveX:function(l){return((this.ax*l+this.bx)*l+this.cx)*l},sampleCurveY:function(l){return((this.ay*l+this.by)*l+this.cy)*l},sampleCurveDerivativeX:function(l){return(3*this.ax*l+2*this.bx)*l+this.cx},solveCurveX:function(l,h){if(h===void 0&&(h=1e-6),l<0)return 0;if(l>1)return 1;for(var m=l,x=0;x<8;x++){var A=this.sampleCurveX(m)-l;if(Math.abs(A)<h)return m;var P=this.sampleCurveDerivativeX(m);if(Math.abs(P)<1e-6)break;m-=A/P}var R=0,D=1;for(m=l,x=0;x<20&&(A=this.sampleCurveX(m),!(Math.abs(A-l)<h));x++)l>A?R=m:D=m,m=.5*(D-R)+R;return m},solve:function(l,h){return this.sampleCurveY(this.solveCurveX(l,h))}},yh})(),_u=Hg(Zy);class Fi{constructor(l,h,m,x,A){this.type=l,this.operator=h,this.interpolation=m,this.input=x,this.labels=[],this.outputs=[];for(const[P,R]of A)this.labels.push(P),this.outputs.push(R)}static interpolationFactor(l,h,m,x){let A=0;if(l.name==="exponential")A=_h(h,l.base,m,x);else if(l.name==="linear")A=_h(h,1,m,x);else if(l.name==="cubic-bezier"){const P=l.controlPoints;A=new _u(P[0],P[1],P[2],P[3]).solve(_h(h,1,m,x))}return A}static parse(l,h){let[m,x,A,...P]=l;if(!Array.isArray(x)||x.length===0)return h.error("Expected an interpolation type expression.",1);if(x[0]==="linear")x={name:"linear"};else if(x[0]==="exponential"){const U=x[1];if(typeof U!="number")return h.error("Exponential interpolation requires a numeric base.",1,1);x={name:"exponential",base:U}}else{if(x[0]!=="cubic-bezier")return h.error(`Unknown interpolation type ${String(x[0])}`,1,0);{const U=x.slice(1);if(U.length!==4||U.some(($=>typeof $!="number"||$<0||$>1)))return h.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);x={name:"cubic-bezier",controlPoints:U}}}if(l.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return h.error("Expected an even number of arguments.");if(A=h.parse(A,2,Pt),!A)return null;const R=[];let D=null;m!=="interpolate-hcl"&&m!=="interpolate-lab"||h.expectedType==ms?h.expectedType&&h.expectedType.kind!=="value"&&(D=h.expectedType):D=Pi;for(let U=0;U<P.length;U+=2){const $=P[U],G=P[U+1],ee=U+3,re=U+4;if(typeof $!="number")return h.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ee);if(R.length&&R[R.length-1][0]>=$)return h.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ee);const ne=h.parse(G,re,D);if(!ne)return null;D=D||ne.type,R.push([$,ne])}return No(D,Pt)||No(D,wc)||No(D,Pi)||No(D,Lo)||No(D,Qa)||No(D,ms)||No(D,ni)||No(D,ys(Pt))?new Fi(D,m,x,A,R):h.error(`Type ${un(D)} is not interpolatable.`)}evaluate(l){const h=this.labels,m=this.outputs;if(h.length===1)return m[0].evaluate(l);const x=this.input.evaluate(l);if(x<=h[0])return m[0].evaluate(l);const A=h.length;if(x>=h[A-1])return m[A-1].evaluate(l);const P=Ac(h,x),R=Fi.interpolationFactor(this.interpolation,x,h[P],h[P+1]),D=m[P].evaluate(l),U=m[P+1].evaluate(l);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return La(D,U,R);case"color":return Lr.interpolate(D,U,R);case"padding":return Gn.interpolate(D,U,R);case"colorArray":return ii.interpolate(D,U,R);case"numberArray":return _i.interpolate(D,U,R);case"variableAnchorOffsetCollection":return Mi.interpolate(D,U,R);case"array":return Sc(D,U,R);case"projectionDefinition":return zi.interpolate(D,U,R)}case"interpolate-hcl":switch(this.type.kind){case"color":return Lr.interpolate(D,U,R,"hcl");case"colorArray":return ii.interpolate(D,U,R,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Lr.interpolate(D,U,R,"lab");case"colorArray":return ii.interpolate(D,U,R,"lab")}}}eachChild(l){l(this.input);for(const h of this.outputs)l(h)}outputDefined(){return this.outputs.every((l=>l.outputDefined()))}}function _h(f,l,h,m){const x=m-h,A=f-h;return x===0?0:l===1?A/x:(Math.pow(l,A)-1)/(Math.pow(l,x)-1)}const io={color:Lr.interpolate,number:La,padding:Gn.interpolate,numberArray:_i.interpolate,colorArray:ii.interpolate,variableAnchorOffsetCollection:Mi.interpolate,array:Sc};class vh{constructor(l,h){this.type=l,this.args=h}static parse(l,h){if(l.length<2)return h.error("Expected at least one argument.");let m=null;const x=h.expectedType;x&&x.kind!=="value"&&(m=x);const A=[];for(const R of l.slice(1)){const D=h.parse(R,1+A.length,m,void 0,{typeAnnotation:"omit"});if(!D)return null;m=m||D.type,A.push(D)}if(!m)throw new Error("No output type");const P=x&&A.some((R=>Ja(x,R.type)));return new vh(P?xr:m,A)}evaluate(l){let h,m=null,x=0;for(const A of this.args)if(x++,m=A.evaluate(l),m&&m instanceof si&&!m.available&&(h||(h=m.name),m=null,x===this.args.length&&(m=h)),m!==null)break;return m}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every((l=>l.outputDefined()))}}function bh(f,l){return f==="=="||f==="!="?l.kind==="boolean"||l.kind==="string"||l.kind==="number"||l.kind==="null"||l.kind==="value":l.kind==="string"||l.kind==="number"||l.kind==="value"}function Ec(f,l,h,m){return m.compare(l,h)===0}function ns(f,l,h){const m=f!=="=="&&f!=="!=";return class FD{constructor(A,P,R){this.type=_r,this.lhs=A,this.rhs=P,this.collator=R,this.hasUntypedArgument=A.type.kind==="value"||P.type.kind==="value"}static parse(A,P){if(A.length!==3&&A.length!==4)return P.error("Expected two or three arguments.");const R=A[0];let D=P.parse(A[1],1,xr);if(!D)return null;if(!bh(R,D.type))return P.concat(1).error(`"${R}" comparisons are not supported for type '${un(D.type)}'.`);let U=P.parse(A[2],2,xr);if(!U)return null;if(!bh(R,U.type))return P.concat(2).error(`"${R}" comparisons are not supported for type '${un(U.type)}'.`);if(D.type.kind!==U.type.kind&&D.type.kind!=="value"&&U.type.kind!=="value")return P.error(`Cannot compare types '${un(D.type)}' and '${un(U.type)}'.`);m&&(D.type.kind==="value"&&U.type.kind!=="value"?D=new rs(U.type,[D]):D.type.kind!=="value"&&U.type.kind==="value"&&(U=new rs(D.type,[U])));let $=null;if(A.length===4){if(D.type.kind!=="string"&&U.type.kind!=="string"&&D.type.kind!=="value"&&U.type.kind!=="value")return P.error("Cannot use collator to compare non-string types.");if($=P.parse(A[3],3,Ml),!$)return null}return new FD(D,U,$)}evaluate(A){const P=this.lhs.evaluate(A),R=this.rhs.evaluate(A);if(m&&this.hasUntypedArgument){const D=hr(P),U=hr(R);if(D.kind!==U.kind||D.kind!=="string"&&D.kind!=="number")throw new nn(`Expected arguments for "${f}" to be (string, string) or (number, number), but found (${D.kind}, ${U.kind}) instead.`)}if(this.collator&&!m&&this.hasUntypedArgument){const D=hr(P),U=hr(R);if(D.kind!=="string"||U.kind!=="string")return l(A,P,R)}return this.collator?h(A,P,R,this.collator.evaluate(A)):l(A,P,R)}eachChild(A){A(this.lhs),A(this.rhs),this.collator&&A(this.collator)}outputDefined(){return!0}}}const Wg=ns("==",(function(f,l,h){return l===h}),Ec),kf=ns("!=",(function(f,l,h){return l!==h}),(function(f,l,h,m){return!Ec(0,l,h,m)})),qg=ns("<",(function(f,l,h){return l<h}),(function(f,l,h,m){return m.compare(l,h)<0})),Qd=ns(">",(function(f,l,h){return l>h}),(function(f,l,h,m){return m.compare(l,h)>0})),Yy=ns("<=",(function(f,l,h){return l<=h}),(function(f,l,h,m){return m.compare(l,h)<=0})),Ky=ns(">=",(function(f,l,h){return l>=h}),(function(f,l,h,m){return m.compare(l,h)>=0}));class Df{constructor(l,h,m){this.type=Ml,this.locale=m,this.caseSensitive=l,this.diacriticSensitive=h}static parse(l,h){if(l.length!==2)return h.error("Expected one argument.");const m=l[1];if(typeof m!="object"||Array.isArray(m))return h.error("Collator options argument must be an object.");const x=h.parse(m["case-sensitive"]!==void 0&&m["case-sensitive"],1,_r);if(!x)return null;const A=h.parse(m["diacritic-sensitive"]!==void 0&&m["diacritic-sensitive"],1,_r);if(!A)return null;let P=null;return m.locale&&(P=h.parse(m.locale,1,lr),!P)?null:new Df(x,A,P)}evaluate(l){return new eo(this.caseSensitive.evaluate(l),this.diacriticSensitive.evaluate(l),this.locale?this.locale.evaluate(l):null)}eachChild(l){l(this.caseSensitive),l(this.diacriticSensitive),this.locale&&l(this.locale)}outputDefined(){return!1}}class Jd{constructor(l,h,m,x,A){this.type=lr,this.number=l,this.locale=h,this.currency=m,this.minFractionDigits=x,this.maxFractionDigits=A}static parse(l,h){if(l.length!==3)return h.error("Expected two arguments.");const m=h.parse(l[1],1,Pt);if(!m)return null;const x=l[2];if(typeof x!="object"||Array.isArray(x))return h.error("NumberFormat options argument must be an object.");let A=null;if(x.locale&&(A=h.parse(x.locale,1,lr),!A))return null;let P=null;if(x.currency&&(P=h.parse(x.currency,1,lr),!P))return null;let R=null;if(x["min-fraction-digits"]&&(R=h.parse(x["min-fraction-digits"],1,Pt),!R))return null;let D=null;return x["max-fraction-digits"]&&(D=h.parse(x["max-fraction-digits"],1,Pt),!D)?null:new Jd(m,A,P,R,D)}evaluate(l){return new Intl.NumberFormat(this.locale?this.locale.evaluate(l):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(l):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(l):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(l):void 0}).format(this.number.evaluate(l))}eachChild(l){l(this.number),this.locale&&l(this.locale),this.currency&&l(this.currency),this.minFractionDigits&&l(this.minFractionDigits),this.maxFractionDigits&&l(this.maxFractionDigits)}outputDefined(){return!1}}class Cc{constructor(l){this.type=Ka,this.sections=l}static parse(l,h){if(l.length<2)return h.error("Expected at least one argument.");const m=l[1];if(!Array.isArray(m)&&typeof m=="object")return h.error("First argument must be an image or text section.");const x=[];let A=!1;for(let P=1;P<=l.length-1;++P){const R=l[P];if(A&&typeof R=="object"&&!Array.isArray(R)){A=!1;let D=null;if(R["font-scale"]&&(D=h.parse(R["font-scale"],1,Pt),!D))return null;let U=null;if(R["text-font"]&&(U=h.parse(R["text-font"],1,ys(lr)),!U))return null;let $=null;if(R["text-color"]&&($=h.parse(R["text-color"],1,Pi),!$))return null;let G=null;if(R["vertical-align"]){if(typeof R["vertical-align"]=="string"&&!ga.includes(R["vertical-align"]))return h.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${R["vertical-align"]}' instead.`);if(G=h.parse(R["vertical-align"],1,lr),!G)return null}const ee=x[x.length-1];ee.scale=D,ee.font=U,ee.textColor=$,ee.verticalAlign=G}else{const D=h.parse(l[P],1,xr);if(!D)return null;const U=D.type.kind;if(U!=="string"&&U!=="value"&&U!=="null"&&U!=="resolvedImage")return h.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");A=!0,x.push({content:D,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Cc(x)}evaluate(l){return new Yi(this.sections.map((h=>{const m=h.content.evaluate(l);return hr(m)===_n?new du("",m,null,null,null,h.verticalAlign?h.verticalAlign.evaluate(l):null):new du(yr(m),null,h.scale?h.scale.evaluate(l):null,h.font?h.font.evaluate(l).join(","):null,h.textColor?h.textColor.evaluate(l):null,h.verticalAlign?h.verticalAlign.evaluate(l):null)})))}eachChild(l){for(const h of this.sections)l(h.content),h.scale&&l(h.scale),h.font&&l(h.font),h.textColor&&l(h.textColor),h.verticalAlign&&l(h.verticalAlign)}outputDefined(){return!1}}class ep{constructor(l){this.type=_n,this.input=l}static parse(l,h){if(l.length!==2)return h.error("Expected two arguments.");const m=h.parse(l[1],1,lr);return m?new ep(m):h.error("No image name provided.")}evaluate(l){const h=this.input.evaluate(l),m=si.fromString(h);return m&&l.availableImages&&(m.available=l.availableImages.indexOf(h)>-1),m}eachChild(l){l(this.input)}outputDefined(){return!1}}class Lf{constructor(l){this.type=Pt,this.input=l}static parse(l,h){if(l.length!==2)return h.error(`Expected 1 argument, but found ${l.length-1} instead.`);const m=h.parse(l[1],1);return m?m.type.kind!=="array"&&m.type.kind!=="string"&&m.type.kind!=="value"?h.error(`Expected argument of type string or array, but found ${un(m.type)} instead.`):new Lf(m):null}evaluate(l){const h=this.input.evaluate(l);if(typeof h=="string")return[...h].length;if(Array.isArray(h))return h.length;throw new nn(`Expected value to be of type string or array, but found ${un(hr(h))} instead.`)}eachChild(l){l(this.input)}outputDefined(){return!1}}const Na=8192;function tp(f,l){const h=(180+f[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+f[1]*Math.PI/360)))/360,x=Math.pow(2,l.z);return[Math.round(h*x*Na),Math.round(m*x*Na)]}function Dl(f,l){const h=Math.pow(2,l.z);return[(x=(f[0]/Na+l.x)/h,360*x-180),(m=(f[1]/Na+l.y)/h,360/Math.PI*Math.atan(Math.exp((180-360*m)*Math.PI/180))-90)];var m,x}function xh(f,l){f[0]=Math.min(f[0],l[0]),f[1]=Math.min(f[1],l[1]),f[2]=Math.max(f[2],l[0]),f[3]=Math.max(f[3],l[1])}function vu(f,l){return!(f[0]<=l[0]||f[2]>=l[2]||f[1]<=l[1]||f[3]>=l[3])}function Gg(f,l,h){const m=f[0]-l[0],x=f[1]-l[1],A=f[0]-h[0],P=f[1]-h[1];return m*P-A*x==0&&m*A<=0&&x*P<=0}function wh(f,l,h,m){return(x=[m[0]-h[0],m[1]-h[1]])[0]*(A=[l[0]-f[0],l[1]-f[1]])[1]-x[1]*A[0]!=0&&!(!Zg(f,l,h,m)||!Zg(h,m,f,l));var x,A}function Xg(f,l,h){for(const m of h)for(let x=0;x<m.length-1;++x)if(wh(f,l,m[x],m[x+1]))return!0;return!1}function Ll(f,l,h=!1){let m=!1;for(const R of l)for(let D=0;D<R.length-1;D++){if(Gg(f,R[D],R[D+1]))return h;(A=R[D])[1]>(x=f)[1]!=(P=R[D+1])[1]>x[1]&&x[0]<(P[0]-A[0])*(x[1]-A[1])/(P[1]-A[1])+A[0]&&(m=!m)}var x,A,P;return m}function Pc(f,l){for(const h of l)if(Ll(f,h))return!0;return!1}function rp(f,l){for(const h of f)if(!Ll(h,l))return!1;for(let h=0;h<f.length-1;++h)if(Xg(f[h],f[h+1],l))return!1;return!0}function Qy(f,l){for(const h of l)if(rp(f,h))return!0;return!1}function Zg(f,l,h,m){const x=m[0]-h[0],A=m[1]-h[1],P=(f[0]-h[0])*A-x*(f[1]-h[1]),R=(l[0]-h[0])*A-x*(l[1]-h[1]);return P>0&&R<0||P<0&&R>0}function Bf(f,l,h){const m=[];for(let x=0;x<f.length;x++){const A=[];for(let P=0;P<f[x].length;P++){const R=tp(f[x][P],h);xh(l,R),A.push(R)}m.push(A)}return m}function np(f,l,h){const m=[];for(let x=0;x<f.length;x++){const A=Bf(f[x],l,h);m.push(A)}return m}function Bl(f,l,h,m){if(f[0]<h[0]||f[0]>h[2]){const x=.5*m;let A=f[0]-h[0]>x?-m:h[0]-f[0]>x?m:0;A===0&&(A=f[0]-h[2]>x?-m:h[2]-f[0]>x?m:0),f[0]+=A}xh(l,f)}function bu(f,l,h,m){const x=Math.pow(2,m.z)*Na,A=[m.x*Na,m.y*Na],P=[];for(const R of f)for(const D of R){const U=[D.x+A[0],D.y+A[1]];Bl(U,l,h,x),P.push(U)}return P}function Yg(f,l,h,m){const x=Math.pow(2,m.z)*Na,A=[m.x*Na,m.y*Na],P=[];for(const D of f){const U=[];for(const $ of D){const G=[$.x+A[0],$.y+A[1]];xh(l,G),U.push(G)}P.push(U)}if(l[2]-l[0]<=x/2){(R=l)[0]=R[1]=1/0,R[2]=R[3]=-1/0;for(const D of P)for(const U of D)Bl(U,l,h,x)}var R;return P}class so{constructor(l,h){this.type=_r,this.geojson=l,this.geometries=h}static parse(l,h){if(l.length!==2)return h.error(`'within' expression requires exactly one argument, but found ${l.length-1} instead.`);if(Bs(l[1])){const m=l[1];if(m.type==="FeatureCollection"){const x=[];for(const A of m.features){const{type:P,coordinates:R}=A.geometry;P==="Polygon"&&x.push(R),P==="MultiPolygon"&&x.push(...R)}if(x.length)return new so(m,{type:"MultiPolygon",coordinates:x})}else if(m.type==="Feature"){const x=m.geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new so(m,m.geometry)}else if(m.type==="Polygon"||m.type==="MultiPolygon")return new so(m,m)}return h.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return(function(h,m){const x=[1/0,1/0,-1/0,-1/0],A=[1/0,1/0,-1/0,-1/0],P=h.canonicalID();if(m.type==="Polygon"){const R=Bf(m.coordinates,A,P),D=bu(h.geometry(),x,A,P);if(!vu(x,A))return!1;for(const U of D)if(!Ll(U,R))return!1}if(m.type==="MultiPolygon"){const R=np(m.coordinates,A,P),D=bu(h.geometry(),x,A,P);if(!vu(x,A))return!1;for(const U of D)if(!Pc(U,R))return!1}return!0})(l,this.geometries);if(l.geometryType()==="LineString")return(function(h,m){const x=[1/0,1/0,-1/0,-1/0],A=[1/0,1/0,-1/0,-1/0],P=h.canonicalID();if(m.type==="Polygon"){const R=Bf(m.coordinates,A,P),D=Yg(h.geometry(),x,A,P);if(!vu(x,A))return!1;for(const U of D)if(!rp(U,R))return!1}if(m.type==="MultiPolygon"){const R=np(m.coordinates,A,P),D=Yg(h.geometry(),x,A,P);if(!vu(x,A))return!1;for(const U of D)if(!Qy(U,R))return!1}return!0})(l,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Nf=class{constructor(f=[],l=(h,m)=>h<m?-1:h>m?1:0){if(this.data=f,this.length=this.data.length,this.compare=l,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(f){this.data.push(f),this._up(this.length++)}pop(){if(this.length===0)return;const f=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),f}peek(){return this.data[0]}_up(f){const{data:l,compare:h}=this,m=l[f];for(;f>0;){const x=f-1>>1,A=l[x];if(h(m,A)>=0)break;l[f]=A,f=x}l[f]=m}_down(f){const{data:l,compare:h}=this,m=this.length>>1,x=l[f];for(;f<m;){let A=1+(f<<1);const P=A+1;if(P<this.length&&h(l[P],l[A])<0&&(A=P),h(l[A],x)>=0)break;l[f]=l[A],f=A}l[f]=x}};function zf(f,l,h=0,m=f.length-1,x=ip){for(;m>h;){if(m-h>600){const D=m-h+1,U=l-h+1,$=Math.log(D),G=.5*Math.exp(2*$/3),ee=.5*Math.sqrt($*G*(D-G)/D)*(U-D/2<0?-1:1);zf(f,l,Math.max(h,Math.floor(l-U*G/D+ee)),Math.min(m,Math.floor(l+(D-U)*G/D+ee)),x)}const A=f[l];let P=h,R=m;for(Mc(f,h,l),x(f[m],A)>0&&Mc(f,h,m);P<R;){for(Mc(f,P,R),P++,R--;x(f[P],A)<0;)P++;for(;x(f[R],A)>0;)R--}x(f[h],A)===0?Mc(f,h,R):(R++,Mc(f,R,m)),R<=l&&(h=R+1),l<=R&&(m=R-1)}}function Mc(f,l,h){const m=f[l];f[l]=f[h],f[h]=m}function ip(f,l){return f<l?-1:f>l?1:0}function xu(f,l){if(f.length<=1)return[f];const h=[];let m,x;for(const A of f){const P=Kg(A);P!==0&&(A.area=Math.abs(P),x===void 0&&(x=P<0),x===P<0?(m&&h.push(m),m=[A]):m.push(A))}if(m&&h.push(m),l>1)for(let A=0;A<h.length;A++)h[A].length<=l||(zf(h[A],l,1,h[A].length-1,sp),h[A]=h[A].slice(0,l));return h}function sp(f,l){return l.area-f.area}function Kg(f){let l=0;for(let h,m,x=0,A=f.length,P=A-1;x<A;P=x++)h=f[x],m=f[P],l+=(m.x-h.x)*(h.y+m.y);return l}const Qg=1/298.257223563,Jg=Qg*(2-Qg),ap=Math.PI/180;class op{constructor(l){const h=6378.137*ap*1e3,m=Math.cos(l*ap),x=1/(1-Jg*(1-m*m)),A=Math.sqrt(x);this.kx=h*A*m,this.ky=h*A*x*(1-Jg)}distance(l,h){const m=this.wrap(l[0]-h[0])*this.kx,x=(l[1]-h[1])*this.ky;return Math.sqrt(m*m+x*x)}pointOnLine(l,h){let m,x,A,P,R=1/0;for(let D=0;D<l.length-1;D++){let U=l[D][0],$=l[D][1],G=this.wrap(l[D+1][0]-U)*this.kx,ee=(l[D+1][1]-$)*this.ky,re=0;G===0&&ee===0||(re=(this.wrap(h[0]-U)*this.kx*G+(h[1]-$)*this.ky*ee)/(G*G+ee*ee),re>1?(U=l[D+1][0],$=l[D+1][1]):re>0&&(U+=G/this.kx*re,$+=ee/this.ky*re)),G=this.wrap(h[0]-U)*this.kx,ee=(h[1]-$)*this.ky;const ne=G*G+ee*ee;ne<R&&(R=ne,m=U,x=$,A=D,P=re)}return{point:[m,x],index:A,t:Math.max(0,Math.min(1,P))}}wrap(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}}function em(f,l){return l[0]-f[0]}function is(f){return f[1]-f[0]+1}function ta(f,l){return f[1]>=f[0]&&f[1]<l}function Gr(f,l){if(f[0]>f[1])return[null,null];const h=is(f);if(l){if(h===2)return[f,null];const x=Math.floor(h/2);return[[f[0],f[0]+x],[f[0]+x,f[1]]]}if(h===1)return[f,null];const m=Math.floor(h/2)-1;return[[f[0],f[0]+m],[f[0]+m+1,f[1]]]}function Ff(f,l){if(!ta(l,f.length))return[1/0,1/0,-1/0,-1/0];const h=[1/0,1/0,-1/0,-1/0];for(let m=l[0];m<=l[1];++m)xh(h,f[m]);return h}function Uf(f){const l=[1/0,1/0,-1/0,-1/0];for(const h of f)for(const m of h)xh(l,m);return l}function lp(f){return f[0]!==-1/0&&f[1]!==-1/0&&f[2]!==1/0&&f[3]!==1/0}function Th(f,l,h){if(!lp(f)||!lp(l))return NaN;let m=0,x=0;return f[2]<l[0]&&(m=l[0]-f[2]),f[0]>l[2]&&(m=f[0]-l[2]),f[1]>l[3]&&(x=f[1]-l[3]),f[3]<l[1]&&(x=l[1]-f[3]),h.distance([0,0],[m,x])}function Ic(f,l,h){const m=h.pointOnLine(l,f);return h.distance(f,m.point)}function Nl(f,l,h,m,x){const A=Math.min(Ic(f,[h,m],x),Ic(l,[h,m],x)),P=Math.min(Ic(h,[f,l],x),Ic(m,[f,l],x));return Math.min(A,P)}function cp(f,l,h,m,x){if(!ta(l,f.length)||!ta(m,h.length))return 1/0;let A=1/0;for(let P=l[0];P<l[1];++P){const R=f[P],D=f[P+1];for(let U=m[0];U<m[1];++U){const $=h[U],G=h[U+1];if(wh(R,D,$,G))return 0;A=Math.min(A,Nl(R,D,$,G,x))}}return A}function Sh(f,l,h,m,x){if(!ta(l,f.length)||!ta(m,h.length))return NaN;let A=1/0;for(let P=l[0];P<=l[1];++P)for(let R=m[0];R<=m[1];++R)if(A=Math.min(A,x.distance(f[P],h[R])),A===0)return A;return A}function up(f,l,h){if(Ll(f,l,!0))return 0;let m=1/0;for(const x of l){const A=x[0],P=x[x.length-1];if(A!==P&&(m=Math.min(m,Ic(f,[P,A],h)),m===0))return m;const R=h.pointOnLine(x,f);if(m=Math.min(m,h.distance(f,R.point)),m===0)return m}return m}function tm(f,l,h,m){if(!ta(l,f.length))return NaN;for(let A=l[0];A<=l[1];++A)if(Ll(f[A],h,!0))return 0;let x=1/0;for(let A=l[0];A<l[1];++A){const P=f[A],R=f[A+1];for(const D of h)for(let U=0,$=D.length,G=$-1;U<$;G=U++){const ee=D[G],re=D[U];if(wh(P,R,ee,re))return 0;x=Math.min(x,Nl(P,R,ee,re,m))}}return x}function zl(f,l){for(const h of f)for(const m of h)if(Ll(m,l,!0))return!0;return!1}function wu(f,l,h,m=1/0){const x=Uf(f),A=Uf(l);if(m!==1/0&&Th(x,A,h)>=m)return m;if(vu(x,A)){if(zl(f,l))return 0}else if(zl(l,f))return 0;let P=1/0;for(const R of f)for(let D=0,U=R.length,$=U-1;D<U;$=D++){const G=R[$],ee=R[D];for(const re of l)for(let ne=0,le=re.length,de=le-1;ne<le;de=ne++){const xe=re[de],$e=re[ne];if(wh(G,ee,xe,$e))return 0;P=Math.min(P,Nl(G,ee,xe,$e,h))}}return P}function jf(f,l,h,m,x,A){if(!A)return;const P=Th(Ff(m,A),x,h);P<l&&f.push([P,A,[0,0]])}function Ah(f,l,h,m,x,A,P){if(!A||!P)return;const R=Th(Ff(m,A),Ff(x,P),h);R<l&&f.push([R,A,P])}function ao(f,l,h,m,x=1/0){let A=Math.min(m.distance(f[0],h[0][0]),x);if(A===0)return A;const P=new Nf([[0,[0,f.length-1],[0,0]]],em),R=Uf(h);for(;P.length>0;){const D=P.pop();if(D[0]>=A)continue;const U=D[1],$=l?50:100;if(is(U)<=$){if(!ta(U,f.length))return NaN;if(l){const G=tm(f,U,h,m);if(isNaN(G)||G===0)return G;A=Math.min(A,G)}else for(let G=U[0];G<=U[1];++G){const ee=up(f[G],h,m);if(A=Math.min(A,ee),A===0)return 0}}else{const G=Gr(U,l);jf(P,A,m,f,R,G[0]),jf(P,A,m,f,R,G[1])}}return A}function Eh(f,l,h,m,x,A=1/0){let P=Math.min(A,x.distance(f[0],h[0]));if(P===0)return P;const R=new Nf([[0,[0,f.length-1],[0,h.length-1]]],em);for(;R.length>0;){const D=R.pop();if(D[0]>=P)continue;const U=D[1],$=D[2],G=l?50:100,ee=m?50:100;if(is(U)<=G&&is($)<=ee){if(!ta(U,f.length)&&ta($,h.length))return NaN;let re;if(l&&m)re=cp(f,U,h,$,x),P=Math.min(P,re);else if(l&&!m){const ne=f.slice(U[0],U[1]+1);for(let le=$[0];le<=$[1];++le)if(re=Ic(h[le],ne,x),P=Math.min(P,re),P===0)return P}else if(!l&&m){const ne=h.slice($[0],$[1]+1);for(let le=U[0];le<=U[1];++le)if(re=Ic(f[le],ne,x),P=Math.min(P,re),P===0)return P}else re=Sh(f,U,h,$,x),P=Math.min(P,re)}else{const re=Gr(U,l),ne=Gr($,m);Ah(R,P,x,f,h,re[0],ne[0]),Ah(R,P,x,f,h,re[0],ne[1]),Ah(R,P,x,f,h,re[1],ne[0]),Ah(R,P,x,f,h,re[1],ne[1])}}return P}function Vf(f){return f.type==="MultiPolygon"?f.coordinates.map((l=>({type:"Polygon",coordinates:l}))):f.type==="MultiLineString"?f.coordinates.map((l=>({type:"LineString",coordinates:l}))):f.type==="MultiPoint"?f.coordinates.map((l=>({type:"Point",coordinates:l}))):[f]}class Fl{constructor(l,h){this.type=Pt,this.geojson=l,this.geometries=h}static parse(l,h){if(l.length!==2)return h.error(`'distance' expression requires exactly one argument, but found ${l.length-1} instead.`);if(Bs(l[1])){const m=l[1];if(m.type==="FeatureCollection")return new Fl(m,m.features.map((x=>Vf(x.geometry))).flat());if(m.type==="Feature")return new Fl(m,Vf(m.geometry));if("type"in m&&"coordinates"in m)return new Fl(m,Vf(m))}return h.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return(function(h,m){const x=h.geometry(),A=x.flat().map((D=>Dl([D.x,D.y],h.canonical)));if(x.length===0)return NaN;const P=new op(A[0][1]);let R=1/0;for(const D of m){switch(D.type){case"Point":R=Math.min(R,Eh(A,!1,[D.coordinates],!1,P,R));break;case"LineString":R=Math.min(R,Eh(A,!1,D.coordinates,!0,P,R));break;case"Polygon":R=Math.min(R,ao(A,!1,D.coordinates,P,R))}if(R===0)return R}return R})(l,this.geometries);if(l.geometryType()==="LineString")return(function(h,m){const x=h.geometry(),A=x.flat().map((D=>Dl([D.x,D.y],h.canonical)));if(x.length===0)return NaN;const P=new op(A[0][1]);let R=1/0;for(const D of m){switch(D.type){case"Point":R=Math.min(R,Eh(A,!0,[D.coordinates],!1,P,R));break;case"LineString":R=Math.min(R,Eh(A,!0,D.coordinates,!0,P,R));break;case"Polygon":R=Math.min(R,ao(A,!0,D.coordinates,P,R))}if(R===0)return R}return R})(l,this.geometries);if(l.geometryType()==="Polygon")return(function(h,m){const x=h.geometry();if(x.length===0||x[0].length===0)return NaN;const A=xu(x,0).map((D=>D.map((U=>U.map(($=>Dl([$.x,$.y],h.canonical))))))),P=new op(A[0][0][0][1]);let R=1/0;for(const D of m)for(const U of A){switch(D.type){case"Point":R=Math.min(R,ao([D.coordinates],!1,U,P,R));break;case"LineString":R=Math.min(R,ao(D.coordinates,!0,U,P,R));break;case"Polygon":R=Math.min(R,wu(U,D.coordinates,P,R))}if(R===0)return R}return R})(l,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Ch{constructor(l){this.type=xr,this.key=l}static parse(l,h){if(l.length!==2)return h.error(`Expected 1 argument, but found ${l.length-1} instead.`);const m=l[1];return m==null?h.error("Global state property must be defined."):typeof m!="string"?h.error(`Global state property must be string, but found ${typeof l[1]} instead.`):new Ch(m)}evaluate(l){var h;const m=(h=l.globals)===null||h===void 0?void 0:h.globalState;return m&&Object.keys(m).length!==0?Tc(m,this.key):null}eachChild(){}outputDefined(){return!1}}const Tu={"==":Wg,"!=":kf,">":Qd,"<":qg,">=":Ky,"<=":Yy,array:rs,at:mu,boolean:rs,case:yu,coalesce:vh,collator:Df,format:Cc,image:ep,in:kl,"index-of":Ns,interpolate:Fi,"interpolate-hcl":Fi,"interpolate-lab":Fi,length:Lf,let:gh,literal:to,match:Ii,number:rs,"number-format":Jd,object:rs,slice:mh,step:zn,string:rs,"to-boolean":Xn,"to-color":Xn,"to-number":Xn,"to-string":Xn,var:gu,within:so,distance:Fl,"global-state":Ch};class ma{constructor(l,h,m,x){this.name=l,this.type=h,this._evaluate=m,this.args=x}evaluate(l){return this._evaluate(l,this.args)}eachChild(l){this.args.forEach(l)}outputDefined(){return!1}static parse(l,h){const m=l[0],x=ma.definitions[m];if(!x)return h.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0);const A=Array.isArray(x)?x[0]:x.type,P=Array.isArray(x)?[[x[1],x[2]]]:x.overloads,R=P.filter((([U])=>!Array.isArray(U)||U.length===l.length-1));let D=null;for(const[U,$]of R){D=new no(h.registry,Rc,h.path,null,h.scope);const G=[];let ee=!1;for(let re=1;re<l.length;re++){const ne=l[re],le=Array.isArray(U)?U[re-1]:U.type,de=D.parse(ne,1+G.length,le);if(!de){ee=!0;break}G.push(de)}if(!ee)if(Array.isArray(U)&&U.length!==G.length)D.error(`Expected ${U.length} arguments, but found ${G.length} instead.`);else{for(let re=0;re<G.length;re++){const ne=Array.isArray(U)?U[re]:U.type,le=G[re];D.concat(re+1).checkSubtype(ne,le.type)}if(D.errors.length===0)return new ma(m,A,$,G)}}if(R.length===1)h.errors.push(...D.errors);else{const U=(R.length?R:P).map((([G])=>{return ee=G,Array.isArray(ee)?`(${ee.map(un).join(", ")})`:`(${un(ee.type)}...)`;var ee})).join(" | "),$=[];for(let G=1;G<l.length;G++){const ee=h.parse(l[G],1+$.length);if(!ee)return null;$.push(un(ee.type))}h.error(`Expected arguments of type ${U}, but found (${$.join(", ")}) instead.`)}return null}static register(l,h){ma.definitions=h;for(const m in h)l[m]=ma}}function hp(f,[l,h,m,x]){l=l.evaluate(f),h=h.evaluate(f),m=m.evaluate(f);const A=x?x.evaluate(f):1,P=sn(l,h,m,A);if(P)throw new nn(P);return new Lr(l/255,h/255,m/255,A,!1)}function fp(f,l){return f in l}function Ph(f,l){const h=l[f];return h===void 0?null:h}function Ki(f){return{type:f}}function Rc(f){if(f instanceof gu)return Rc(f.boundExpression);if(f instanceof ma&&f.name==="error"||f instanceof Df||f instanceof so||f instanceof Fl||f instanceof Ch)return!1;const l=f instanceof Xn||f instanceof rs;let h=!0;return f.eachChild((m=>{h=l?h&&Rc(m):h&&m instanceof to})),!!h&&_s(f)&&Su(f,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function _s(f){if(f instanceof ma&&(f.name==="get"&&f.args.length===1||f.name==="feature-state"||f.name==="has"&&f.args.length===1||f.name==="properties"||f.name==="geometry-type"||f.name==="id"||/^filter-/.test(f.name))||f instanceof so||f instanceof Fl)return!1;let l=!0;return f.eachChild((h=>{l&&!_s(h)&&(l=!1)})),l}function oo(f){if(f instanceof ma&&f.name==="feature-state")return!1;let l=!0;return f.eachChild((h=>{l&&!oo(h)&&(l=!1)})),l}function Su(f,l){if(f instanceof ma&&l.indexOf(f.name)>=0)return!1;let h=!0;return f.eachChild((m=>{h&&!Su(m,l)&&(h=!1)})),h}function Mh(f){return{result:"success",value:f}}function Uo(f){return{result:"error",value:f}}function lo(f){return f["property-type"]==="data-driven"||f["property-type"]==="cross-faded-data-driven"}function Ul(f){return!!f.expression&&f.expression.parameters.indexOf("zoom")>-1}function $f(f){return!!f.expression&&f.expression.interpolated}function Rr(f){return f instanceof Number?"number":f instanceof String?"string":f instanceof Boolean?"boolean":Array.isArray(f)?"array":f===null?"null":typeof f}function co(f){return typeof f=="object"&&f!==null&&!Array.isArray(f)&&hr(f)===Pl}function Jy(f){return f}function zs(f,l){const h=f.stops&&typeof f.stops[0][0]=="object",m=h||!(h||f.property!==void 0),x=f.type||($f(l)?"exponential":"interval"),A=(function($){switch($.type){case"color":return Lr.parse;case"padding":return Gn.parse;case"numberArray":return _i.parse;case"colorArray":return ii.parse;default:return null}})(l);if(A&&((f=Wn({},f)).stops&&(f.stops=f.stops.map(($=>[$[0],A($[1])]))),f.default=A(f.default?f.default:l.default)),f.colorSpace&&(P=f.colorSpace)!=="rgb"&&P!=="hcl"&&P!=="lab")throw new Error(`Unknown color space: "${f.colorSpace}"`);var P;const R=(function($){switch($){case"exponential":return Ih;case"interval":return rm;case"categorical":return ho;case"identity":return Oc;default:throw new Error(`Unknown function type "${$}"`)}})(x);let D,U;if(x==="categorical"){D=Object.create(null);for(const $ of f.stops)D[$[0]]=$[1];U=typeof f.stops[0][0]}if(h){const $={},G=[];for(let ne=0;ne<f.stops.length;ne++){const le=f.stops[ne],de=le[0].zoom;$[de]===void 0&&($[de]={zoom:de,type:f.type,property:f.property,default:f.default,stops:[]},G.push(de)),$[de].stops.push([le[0].value,le[1]])}const ee=[];for(const ne of G)ee.push([$[ne].zoom,zs($[ne],l)]);const re={name:"linear"};return{kind:"composite",interpolationType:re,interpolationFactor:Fi.interpolationFactor.bind(void 0,re),zoomStops:ee.map((ne=>ne[0])),evaluate:({zoom:ne},le)=>Ih({stops:ee,base:f.base},l,ne).evaluate(ne,le)}}if(m){const $=x==="exponential"?{name:"exponential",base:f.base!==void 0?f.base:1}:null;return{kind:"camera",interpolationType:$,interpolationFactor:Fi.interpolationFactor.bind(void 0,$),zoomStops:f.stops.map((G=>G[0])),evaluate:({zoom:G})=>R(f,l,G,D,U)}}return{kind:"source",evaluate($,G){const ee=G&&G.properties?G.properties[f.property]:void 0;return ee===void 0?uo(f.default,l.default):R(f,l,ee,D,U)}}}function uo(f,l,h){return f!==void 0?f:l!==void 0?l:h!==void 0?h:void 0}function ho(f,l,h,m,x){return uo(typeof h===x?m[h]:void 0,f.default,l.default)}function rm(f,l,h){if(Rr(h)!=="number")return uo(f.default,l.default);const m=f.stops.length;if(m===1||h<=f.stops[0][0])return f.stops[0][1];if(h>=f.stops[m-1][0])return f.stops[m-1][1];const x=Ac(f.stops.map((A=>A[0])),h);return f.stops[x][1]}function Ih(f,l,h){const m=f.base!==void 0?f.base:1;if(Rr(h)!=="number")return uo(f.default,l.default);const x=f.stops.length;if(x===1||h<=f.stops[0][0])return f.stops[0][1];if(h>=f.stops[x-1][0])return f.stops[x-1][1];const A=Ac(f.stops.map(($=>$[0])),h),P=(function($,G,ee,re){const ne=re-ee,le=$-ee;return ne===0?0:G===1?le/ne:(Math.pow(G,le)-1)/(Math.pow(G,ne)-1)})(h,m,f.stops[A][0],f.stops[A+1][0]),R=f.stops[A][1],D=f.stops[A+1][1],U=io[l.type]||Jy;return typeof R.evaluate=="function"?{evaluate(...$){const G=R.evaluate.apply(void 0,$),ee=D.evaluate.apply(void 0,$);if(G!==void 0&&ee!==void 0)return U(G,ee,P,f.colorSpace)}}:U(R,D,P,f.colorSpace)}function Oc(f,l,h){switch(l.type){case"color":h=Lr.parse(h);break;case"formatted":h=Yi.fromString(h.toString());break;case"resolvedImage":h=si.fromString(h.toString());break;case"padding":h=Gn.parse(h);break;case"colorArray":h=ii.parse(h);break;case"numberArray":h=_i.parse(h);break;default:Rr(h)===l.type||l.type==="enum"&&l.values[h]||(h=void 0)}return uo(h,f.default,l.default)}ma.register(Tu,{error:[{kind:"error"},[lr],(f,[l])=>{throw new nn(l.evaluate(f))}],typeof:[lr,[xr],(f,[l])=>un(hr(l.evaluate(f)))],"to-rgba":[ys(Pt,4),[Pi],(f,[l])=>{const[h,m,x,A]=l.evaluate(f).rgb;return[255*h,255*m,255*x,A]}],rgb:[Pi,[Pt,Pt,Pt],hp],rgba:[Pi,[Pt,Pt,Pt,Pt],hp],has:{type:_r,overloads:[[[lr],(f,[l])=>fp(l.evaluate(f),f.properties())],[[lr,Pl],(f,[l,h])=>fp(l.evaluate(f),h.evaluate(f))]]},get:{type:xr,overloads:[[[lr],(f,[l])=>Ph(l.evaluate(f),f.properties())],[[lr,Pl],(f,[l,h])=>Ph(l.evaluate(f),h.evaluate(f))]]},"feature-state":[xr,[lr],(f,[l])=>Ph(l.evaluate(f),f.featureState||{})],properties:[Pl,[],f=>f.properties()],"geometry-type":[lr,[],f=>f.geometryType()],id:[xr,[],f=>f.id()],zoom:[Pt,[],f=>f.globals.zoom],"heatmap-density":[Pt,[],f=>f.globals.heatmapDensity||0],elevation:[Pt,[],f=>f.globals.elevation||0],"line-progress":[Pt,[],f=>f.globals.lineProgress||0],accumulated:[xr,[],f=>f.globals.accumulated===void 0?null:f.globals.accumulated],"+":[Pt,Ki(Pt),(f,l)=>{let h=0;for(const m of l)h+=m.evaluate(f);return h}],"*":[Pt,Ki(Pt),(f,l)=>{let h=1;for(const m of l)h*=m.evaluate(f);return h}],"-":{type:Pt,overloads:[[[Pt,Pt],(f,[l,h])=>l.evaluate(f)-h.evaluate(f)],[[Pt],(f,[l])=>-l.evaluate(f)]]},"/":[Pt,[Pt,Pt],(f,[l,h])=>l.evaluate(f)/h.evaluate(f)],"%":[Pt,[Pt,Pt],(f,[l,h])=>l.evaluate(f)%h.evaluate(f)],ln2:[Pt,[],()=>Math.LN2],pi:[Pt,[],()=>Math.PI],e:[Pt,[],()=>Math.E],"^":[Pt,[Pt,Pt],(f,[l,h])=>Math.pow(l.evaluate(f),h.evaluate(f))],sqrt:[Pt,[Pt],(f,[l])=>Math.sqrt(l.evaluate(f))],log10:[Pt,[Pt],(f,[l])=>Math.log(l.evaluate(f))/Math.LN10],ln:[Pt,[Pt],(f,[l])=>Math.log(l.evaluate(f))],log2:[Pt,[Pt],(f,[l])=>Math.log(l.evaluate(f))/Math.LN2],sin:[Pt,[Pt],(f,[l])=>Math.sin(l.evaluate(f))],cos:[Pt,[Pt],(f,[l])=>Math.cos(l.evaluate(f))],tan:[Pt,[Pt],(f,[l])=>Math.tan(l.evaluate(f))],asin:[Pt,[Pt],(f,[l])=>Math.asin(l.evaluate(f))],acos:[Pt,[Pt],(f,[l])=>Math.acos(l.evaluate(f))],atan:[Pt,[Pt],(f,[l])=>Math.atan(l.evaluate(f))],min:[Pt,Ki(Pt),(f,l)=>Math.min(...l.map((h=>h.evaluate(f))))],max:[Pt,Ki(Pt),(f,l)=>Math.max(...l.map((h=>h.evaluate(f))))],abs:[Pt,[Pt],(f,[l])=>Math.abs(l.evaluate(f))],round:[Pt,[Pt],(f,[l])=>{const h=l.evaluate(f);return h<0?-Math.round(-h):Math.round(h)}],floor:[Pt,[Pt],(f,[l])=>Math.floor(l.evaluate(f))],ceil:[Pt,[Pt],(f,[l])=>Math.ceil(l.evaluate(f))],"filter-==":[_r,[lr,xr],(f,[l,h])=>f.properties()[l.value]===h.value],"filter-id-==":[_r,[xr],(f,[l])=>f.id()===l.value],"filter-type-==":[_r,[lr],(f,[l])=>f.geometryType()===l.value],"filter-<":[_r,[lr,xr],(f,[l,h])=>{const m=f.properties()[l.value],x=h.value;return typeof m==typeof x&&m<x}],"filter-id-<":[_r,[xr],(f,[l])=>{const h=f.id(),m=l.value;return typeof h==typeof m&&h<m}],"filter->":[_r,[lr,xr],(f,[l,h])=>{const m=f.properties()[l.value],x=h.value;return typeof m==typeof x&&m>x}],"filter-id->":[_r,[xr],(f,[l])=>{const h=f.id(),m=l.value;return typeof h==typeof m&&h>m}],"filter-<=":[_r,[lr,xr],(f,[l,h])=>{const m=f.properties()[l.value],x=h.value;return typeof m==typeof x&&m<=x}],"filter-id-<=":[_r,[xr],(f,[l])=>{const h=f.id(),m=l.value;return typeof h==typeof m&&h<=m}],"filter->=":[_r,[lr,xr],(f,[l,h])=>{const m=f.properties()[l.value],x=h.value;return typeof m==typeof x&&m>=x}],"filter-id->=":[_r,[xr],(f,[l])=>{const h=f.id(),m=l.value;return typeof h==typeof m&&h>=m}],"filter-has":[_r,[xr],(f,[l])=>l.value in f.properties()],"filter-has-id":[_r,[],f=>f.id()!==null&&f.id()!==void 0],"filter-type-in":[_r,[ys(lr)],(f,[l])=>l.value.indexOf(f.geometryType())>=0],"filter-id-in":[_r,[ys(xr)],(f,[l])=>l.value.indexOf(f.id())>=0],"filter-in-small":[_r,[lr,ys(xr)],(f,[l,h])=>h.value.indexOf(f.properties()[l.value])>=0],"filter-in-large":[_r,[lr,ys(xr)],(f,[l,h])=>(function(m,x,A,P){for(;A<=P;){const R=A+P>>1;if(x[R]===m)return!0;x[R]>m?P=R-1:A=R+1}return!1})(f.properties()[l.value],h.value,0,h.value.length-1)],all:{type:_r,overloads:[[[_r,_r],(f,[l,h])=>l.evaluate(f)&&h.evaluate(f)],[Ki(_r),(f,l)=>{for(const h of l)if(!h.evaluate(f))return!1;return!0}]]},any:{type:_r,overloads:[[[_r,_r],(f,[l,h])=>l.evaluate(f)||h.evaluate(f)],[Ki(_r),(f,l)=>{for(const h of l)if(h.evaluate(f))return!0;return!1}]]},"!":[_r,[_r],(f,[l])=>!l.evaluate(f)],"is-supported-script":[_r,[lr],(f,[l])=>{const h=f.globals&&f.globals.isSupportedScript;return!h||h(l.evaluate(f))}],upcase:[lr,[lr],(f,[l])=>l.evaluate(f).toUpperCase()],downcase:[lr,[lr],(f,[l])=>l.evaluate(f).toLowerCase()],concat:[lr,Ki(xr),(f,l)=>l.map((h=>yr(h.evaluate(f)))).join("")],"resolved-locale":[lr,[Ml],(f,[l])=>l.evaluate(f).resolvedLocale()]});class Rh{constructor(l,h,m){this.expression=l,this._warningHistory={},this._evaluator=new pu,this._defaultValue=h?(function(x){if(x.type==="color"&&co(x.default))return new Lr(0,0,0,0);switch(x.type){case"color":return Lr.parse(x.default)||null;case"padding":return Gn.parse(x.default)||null;case"numberArray":return _i.parse(x.default)||null;case"colorArray":return ii.parse(x.default)||null;case"variableAnchorOffsetCollection":return Mi.parse(x.default)||null;case"projectionDefinition":return zi.parse(x.default)||null;default:return x.default===void 0?null:x.default}})(h):null,this._enumValues=h&&h.type==="enum"?h.values:null,this._globalState=m}evaluateWithoutErrorHandling(l,h,m,x,A,P){return this._globalState&&(l=Ui(l,this._globalState)),this._evaluator.globals=l,this._evaluator.feature=h,this._evaluator.featureState=m,this._evaluator.canonical=x,this._evaluator.availableImages=A||null,this._evaluator.formattedSection=P,this.expression.evaluate(this._evaluator)}evaluate(l,h,m,x,A,P){this._globalState&&(l=Ui(l,this._globalState)),this._evaluator.globals=l,this._evaluator.feature=h||null,this._evaluator.featureState=m||null,this._evaluator.canonical=x,this._evaluator.availableImages=A||null,this._evaluator.formattedSection=P||null;try{const R=this.expression.evaluate(this._evaluator);if(R==null||typeof R=="number"&&R!=R)return this._defaultValue;if(this._enumValues&&!(R in this._enumValues))throw new nn(`Expected value to be one of ${Object.keys(this._enumValues).map((D=>JSON.stringify(D))).join(", ")}, but found ${JSON.stringify(R)} instead.`);return R}catch(R){return this._warningHistory[R.message]||(this._warningHistory[R.message]=!0,typeof console<"u"&&console.warn(R.message)),this._defaultValue}}}function Oh(f){return Array.isArray(f)&&f.length>0&&typeof f[0]=="string"&&f[0]in Tu}function kc(f,l,h){const m=new no(Tu,Rc,[],l?(function(A){const P={color:Pi,string:lr,number:Pt,enum:lr,boolean:_r,formatted:Ka,padding:Lo,numberArray:Qa,colorArray:ms,projectionDefinition:wc,resolvedImage:_n,variableAnchorOffsetCollection:ni};return A.type==="array"?ys(P[A.value]||xr,A.length):P[A.type]})(l):void 0),x=m.parse(f,void 0,void 0,void 0,l&&l.type==="string"?{typeAnnotation:"coerce"}:void 0);return x?Mh(new Rh(x,l,h)):Uo(m.errors)}class Au{constructor(l,h,m){this.kind=l,this._styleExpression=h,this.isStateDependent=l!=="constant"&&!oo(h.expression),this.globalStateRefs=jo(h.expression),this._globalState=m}evaluateWithoutErrorHandling(l,h,m,x,A,P){return this._globalState&&(l=Ui(l,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(l,h,m,x,A,P)}evaluate(l,h,m,x,A,P){return this._globalState&&(l=Ui(l,this._globalState)),this._styleExpression.evaluate(l,h,m,x,A,P)}}class Fs{constructor(l,h,m,x,A){this.kind=l,this.zoomStops=m,this._styleExpression=h,this.isStateDependent=l!=="camera"&&!oo(h.expression),this.globalStateRefs=jo(h.expression),this.interpolationType=x,this._globalState=A}evaluateWithoutErrorHandling(l,h,m,x,A,P){return this._globalState&&(l=Ui(l,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(l,h,m,x,A,P)}evaluate(l,h,m,x,A,P){return this._globalState&&(l=Ui(l,this._globalState)),this._styleExpression.evaluate(l,h,m,x,A,P)}interpolationFactor(l,h,m){return this.interpolationType?Fi.interpolationFactor(this.interpolationType,l,h,m):0}}function Dc(f,l,h){const m=kc(f,l,h);if(m.result==="error")return m;const x=m.value.expression,A=_s(x);if(!A&&!lo(l))return Uo([new ks("","data expressions not supported")]);const P=Su(x,["zoom"]);if(!P&&!Ul(l))return Uo([new ks("","zoom expressions not supported")]);const R=jl(x);return R||P?R instanceof ks?Uo([R]):R instanceof Fi&&!$f(l)?Uo([new ks("",'"interpolate" expressions cannot be used with this property')]):Mh(R?new Fs(A?"camera":"composite",m.value,R.labels,R instanceof Fi?R.interpolation:void 0,h):new Au(A?"constant":"source",m.value,h)):Uo([new ks("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class fo{constructor(l,h){this._parameters=l,this._specification=h,Wn(this,zs(this._parameters,this._specification))}static deserialize(l){return new fo(l._parameters,l._specification)}static serialize(l){return{_parameters:l._parameters,_specification:l._specification}}}function jl(f){let l=null;if(f instanceof gh)l=jl(f.result);else if(f instanceof vh){for(const h of f.args)if(l=jl(h),l)break}else(f instanceof zn||f instanceof Fi)&&f.input instanceof ma&&f.input.name==="zoom"&&(l=f);return l instanceof ks||f.eachChild((h=>{const m=jl(h);m instanceof ks?l=m:!l&&m?l=new ks("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):l&&m&&l!==m&&(l=new ks("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),l}function jo(f,l=new Set){return f instanceof Ch&&l.add(f.key),f.eachChild((h=>{jo(h,l)})),l}function Ui(f,l){const{zoom:h,heatmapDensity:m,elevation:x,lineProgress:A,isSupportedScript:P,accumulated:R}=f??{};return{zoom:h,heatmapDensity:m,elevation:x,lineProgress:A,isSupportedScript:P,accumulated:R,globalState:l}}function ss(f){if(f===!0||f===!1)return!0;if(!Array.isArray(f)||f.length===0)return!1;switch(f[0]){case"has":return f.length>=2&&f[1]!=="$id"&&f[1]!=="$type";case"in":return f.length>=3&&(typeof f[1]!="string"||Array.isArray(f[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return f.length!==3||Array.isArray(f[1])||Array.isArray(f[2]);case"any":case"all":for(const l of f.slice(1))if(!ss(l)&&typeof l!="boolean")return!1;return!0;default:return!0}}const po={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function as(f,l){if(f==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};ss(f)||(f=kh(f));const h=kc(f,po,l);if(h.result==="error")throw new Error(h.value.map((m=>`${m.key}: ${m.message}`)).join(", "));return{filter:(m,x,A)=>h.value.evaluate(m,x,{},A),needGeometry:ra(f),getGlobalStateRefs:()=>jo(h.value.expression)}}function ya(f,l){return f<l?-1:f>l?1:0}function ra(f){if(!Array.isArray(f))return!1;if(f[0]==="within"||f[0]==="distance")return!0;for(let l=1;l<f.length;l++)if(ra(f[l]))return!0;return!1}function kh(f){if(!f)return!0;const l=f[0];return f.length<=1?l!=="any":l==="=="?Dh(f[1],f[2],"=="):l==="!="?vi(Dh(f[1],f[2],"==")):l==="<"||l===">"||l==="<="||l===">="?Dh(f[1],f[2],l):l==="any"?(h=f.slice(1),["any"].concat(h.map(kh))):l==="all"?["all"].concat(f.slice(1).map(kh)):l==="none"?["all"].concat(f.slice(1).map(kh).map(vi)):l==="in"?Hf(f[1],f.slice(2)):l==="!in"?vi(Hf(f[1],f.slice(2))):l==="has"?dp(f[1]):l!=="!has"||vi(dp(f[1]));var h}function Dh(f,l,h){switch(f){case"$type":return[`filter-type-${h}`,l];case"$id":return[`filter-id-${h}`,l];default:return[`filter-${h}`,f,l]}}function Hf(f,l){if(l.length===0)return!1;switch(f){case"$type":return["filter-type-in",["literal",l]];case"$id":return["filter-id-in",["literal",l]];default:return l.length>200&&!l.some((h=>typeof h!=typeof l[0]))?["filter-in-large",f,["literal",l.sort(ya)]]:["filter-in-small",f,["literal",l]]}}function dp(f){switch(f){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",f]}}function vi(f){return["!",f]}function vn(f){const l=typeof f;if(l==="number"||l==="boolean"||l==="string"||f==null)return JSON.stringify(f);if(Array.isArray(f)){let x="[";for(const A of f)x+=`${vn(A)},`;return`${x}]`}const h=Object.keys(f).sort();let m="{";for(let x=0;x<h.length;x++)m+=`${JSON.stringify(h[x])}:${vn(f[h[x]])},`;return`${m}}`}function $r(f){let l="";for(const h of fr)l+=`/${vn(f[h])}`;return l}function go(f){const l=f.value;return l?[new bt(f.key,l,"constants have been deprecated as of v8")]:[]}function Hr(f){return f instanceof Number||f instanceof String||f instanceof Boolean?f.valueOf():f}function Vo(f){if(Array.isArray(f))return f.map(Vo);if(f instanceof Object&&!(f instanceof Number||f instanceof String||f instanceof Boolean)){const l={};for(const h in f)l[h]=Vo(f[h]);return l}return Hr(f)}function bi(f){const l=f.key,h=f.value,m=f.valueSpec||{},x=f.objectElementValidators||{},A=f.style,P=f.styleSpec,R=f.validateSpec;let D=[];const U=Rr(h);if(U!=="object")return[new bt(l,h,`object expected, ${U} found`)];for(const $ in h){const G=$.split(".")[0],ee=Tc(m,G)||m["*"];let re;if(Tc(x,G))re=x[G];else if(Tc(m,G))re=R;else if(x["*"])re=x["*"];else{if(!m["*"]){D.push(new bt(l,h[$],`unknown property "${$}"`));continue}re=R}D=D.concat(re({key:(l&&`${l}.`)+$,value:h[$],valueSpec:ee,style:A,styleSpec:P,object:h,objectKey:$,validateSpec:R},h))}for(const $ in m)x[$]||m[$].required&&m[$].default===void 0&&h[$]===void 0&&D.push(new bt(l,h,`missing required property "${$}"`));return D}function Lh(f){const l=f.value,h=f.valueSpec,m=f.style,x=f.styleSpec,A=f.key,P=f.arrayElementValidator||f.validateSpec;if(Rr(l)!=="array")return[new bt(A,l,`array expected, ${Rr(l)} found`)];if(h.length&&l.length!==h.length)return[new bt(A,l,`array length ${h.length} expected, length ${l.length} found`)];if(h["min-length"]&&l.length<h["min-length"])return[new bt(A,l,`array length at least ${h["min-length"]} expected, length ${l.length} found`)];let R={type:h.value,values:h.values};x.$version<7&&(R.function=h.function),Rr(h.value)==="object"&&(R=h.value);let D=[];for(let U=0;U<l.length;U++)D=D.concat(P({array:l,arrayIndex:U,value:l[U],valueSpec:R,validateSpec:f.validateSpec,style:m,styleSpec:x,key:`${A}[${U}]`}));return D}function Bh(f){const l=f.key,h=f.value,m=f.valueSpec;let x=Rr(h);return x==="number"&&h!=h&&(x="NaN"),x!=="number"?[new bt(l,h,`number expected, ${x} found`)]:"minimum"in m&&h<m.minimum?[new bt(l,h,`${h} is less than the minimum value ${m.minimum}`)]:"maximum"in m&&h>m.maximum?[new bt(l,h,`${h} is greater than the maximum value ${m.maximum}`)]:[]}function Vl(f){const l=f.valueSpec,h=Hr(f.value.type);let m,x,A,P={};const R=h!=="categorical"&&f.value.property===void 0,D=!R,U=Rr(f.value.stops)==="array"&&Rr(f.value.stops[0])==="array"&&Rr(f.value.stops[0][0])==="object",$=bi({key:f.key,value:f.value,valueSpec:f.styleSpec.function,validateSpec:f.validateSpec,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(re){if(h==="identity")return[new bt(re.key,re.value,'identity function may not have a "stops" property')];let ne=[];const le=re.value;return ne=ne.concat(Lh({key:re.key,value:le,valueSpec:re.valueSpec,validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec,arrayElementValidator:G})),Rr(le)==="array"&&le.length===0&&ne.push(new bt(re.key,le,"array must have at least one stop")),ne},default:function(re){return re.validateSpec({key:re.key,value:re.value,valueSpec:l,validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec})}}});return h==="identity"&&R&&$.push(new bt(f.key,f.value,'missing required property "property"')),h==="identity"||f.value.stops||$.push(new bt(f.key,f.value,'missing required property "stops"')),h==="exponential"&&f.valueSpec.expression&&!$f(f.valueSpec)&&$.push(new bt(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(D&&!lo(f.valueSpec)?$.push(new bt(f.key,f.value,"property functions not supported")):R&&!Ul(f.valueSpec)&&$.push(new bt(f.key,f.value,"zoom functions not supported"))),h!=="categorical"&&!U||f.value.property!==void 0||$.push(new bt(f.key,f.value,'"property" property is required')),$;function G(re){let ne=[];const le=re.value,de=re.key;if(Rr(le)!=="array")return[new bt(de,le,`array expected, ${Rr(le)} found`)];if(le.length!==2)return[new bt(de,le,`array length 2 expected, length ${le.length} found`)];if(U){if(Rr(le[0])!=="object")return[new bt(de,le,`object expected, ${Rr(le[0])} found`)];if(le[0].zoom===void 0)return[new bt(de,le,"object stop key must have zoom")];if(le[0].value===void 0)return[new bt(de,le,"object stop key must have value")];if(A&&A>Hr(le[0].zoom))return[new bt(de,le[0].zoom,"stop zoom values must appear in ascending order")];Hr(le[0].zoom)!==A&&(A=Hr(le[0].zoom),x=void 0,P={}),ne=ne.concat(bi({key:`${de}[0]`,value:le[0],valueSpec:{zoom:{}},validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec,objectElementValidators:{zoom:Bh,value:ee}}))}else ne=ne.concat(ee({key:`${de}[0]`,value:le[0],validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec},le));return Oh(Vo(le[1]))?ne.concat([new bt(`${de}[1]`,le[1],"expressions are not allowed in function stops.")]):ne.concat(re.validateSpec({key:`${de}[1]`,value:le[1],valueSpec:l,validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec}))}function ee(re,ne){const le=Rr(re.value),de=Hr(re.value),xe=re.value!==null?re.value:ne;if(m){if(le!==m)return[new bt(re.key,xe,`${le} stop domain type must match previous stop domain type ${m}`)]}else m=le;if(le!=="number"&&le!=="string"&&le!=="boolean")return[new bt(re.key,xe,"stop domain value must be a number, string, or boolean")];if(le!=="number"&&h!=="categorical"){let $e=`number expected, ${le} found`;return lo(l)&&h===void 0&&($e+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new bt(re.key,xe,$e)]}return h!=="categorical"||le!=="number"||isFinite(de)&&Math.floor(de)===de?h!=="categorical"&&le==="number"&&x!==void 0&&de<x?[new bt(re.key,xe,"stop domain values must appear in ascending order")]:(x=de,h==="categorical"&&de in P?[new bt(re.key,xe,"stop domain values must be unique")]:(P[de]=!0,[])):[new bt(re.key,xe,`integer expected, found ${de}`)]}}function na(f){const l=(f.expressionContext==="property"?Dc:kc)(Vo(f.value),f.valueSpec);if(l.result==="error")return l.value.map((m=>new bt(`${f.key}${m.key}`,f.value,m.message)));const h=l.value.expression||l.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!h.outputDefined())return[new bt(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!oo(h))return[new bt(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter"&&!oo(h))return[new bt(f.key,f.value,'"feature-state" data expressions are not supported with filters.')];if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!Su(h,["zoom","feature-state"]))return[new bt(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!_s(h))return[new bt(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function $o(f){const l=f.key,h=f.value,m=Rr(h);return m!=="string"?[new bt(l,h,`color expected, ${m} found`)]:Lr.parse(String(h))?[]:[new bt(l,h,`color expected, "${h}" found`)]}function Ho(f){const l=f.key,h=f.value,m=f.valueSpec,x=[];return Array.isArray(m.values)?m.values.indexOf(Hr(h))===-1&&x.push(new bt(l,h,`expected one of [${m.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(m.values).indexOf(Hr(h))===-1&&x.push(new bt(l,h,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(h)} found`)),x}function Nh(f){return ss(Vo(f.value))?na(Wn({},f,{expressionContext:"filter",valueSpec:{value:"boolean"}})):$l(f)}function $l(f){const l=f.value,h=f.key;if(Rr(l)!=="array")return[new bt(h,l,`array expected, ${Rr(l)} found`)];const m=f.styleSpec;let x,A=[];if(l.length<1)return[new bt(h,l,"filter array must have at least 1 element")];switch(A=A.concat(Ho({key:`${h}[0]`,value:l[0],valueSpec:m.filter_operator,style:f.style,styleSpec:f.styleSpec})),Hr(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&Hr(l[1])==="$type"&&A.push(new bt(h,l,`"$type" cannot be use with operator "${l[0]}"`));case"==":case"!=":l.length!==3&&A.push(new bt(h,l,`filter array for operator "${l[0]}" must have 3 elements`));case"in":case"!in":l.length>=2&&(x=Rr(l[1]),x!=="string"&&A.push(new bt(`${h}[1]`,l[1],`string expected, ${x} found`)));for(let P=2;P<l.length;P++)x=Rr(l[P]),Hr(l[1])==="$type"?A=A.concat(Ho({key:`${h}[${P}]`,value:l[P],valueSpec:m.geometry_type,style:f.style,styleSpec:f.styleSpec})):x!=="string"&&x!=="number"&&x!=="boolean"&&A.push(new bt(`${h}[${P}]`,l[P],`string, number, or boolean expected, ${x} found`));break;case"any":case"all":case"none":for(let P=1;P<l.length;P++)A=A.concat($l({key:`${h}[${P}]`,value:l[P],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":x=Rr(l[1]),l.length!==2?A.push(new bt(h,l,`filter array for "${l[0]}" operator must have 2 elements`)):x!=="string"&&A.push(new bt(`${h}[1]`,l[1],`string expected, ${x} found`))}return A}function mo(f,l){const h=f.key,m=f.validateSpec,x=f.style,A=f.styleSpec,P=f.value,R=f.objectKey,D=A[`${l}_${f.layerType}`];if(!D)return[];const U=R.match(/^(.*)-transition$/);if(l==="paint"&&U&&D[U[1]]&&D[U[1]].transition)return m({key:h,value:P,valueSpec:A.transition,style:x,styleSpec:A});const $=f.valueSpec||D[R];if(!$)return[new bt(h,P,`unknown property "${R}"`)];let G;if(Rr(P)==="string"&&lo($)&&!$.tokens&&(G=/^{([^}]+)}$/.exec(P)))return[new bt(h,P,`"${R}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(G[1])} }\`.`)];const ee=[];return f.layerType==="symbol"&&(R==="text-field"&&x&&!x.glyphs&&ee.push(new bt(h,P,'use of "text-field" requires a style "glyphs" property')),R==="text-font"&&co(Vo(P))&&Hr(P.type)==="identity"&&ee.push(new bt(h,P,'"text-font" does not support identity functions'))),ee.concat(m({key:f.key,value:P,valueSpec:$,style:x,styleSpec:A,expressionContext:"property",propertyType:l,propertyKey:R}))}function Wo(f){return mo(f,"paint")}function yo(f){return mo(f,"layout")}function Hl(f){let l=[];const h=f.value,m=f.key,x=f.style,A=f.styleSpec;if(Rr(h)!=="object")return[new bt(m,h,`object expected, ${Rr(h)} found`)];h.type||h.ref||l.push(new bt(m,h,'either "type" or "ref" is required'));let P=Hr(h.type);const R=Hr(h.ref);if(h.id){const D=Hr(h.id);for(let U=0;U<f.arrayIndex;U++){const $=x.layers[U];Hr($.id)===D&&l.push(new bt(m,h.id,`duplicate layer id "${h.id}", previously used at line ${$.id.__line__}`))}}if("ref"in h){let D;["type","source","source-layer","filter","layout"].forEach((U=>{U in h&&l.push(new bt(m,h[U],`"${U}" is prohibited for ref layers`))})),x.layers.forEach((U=>{Hr(U.id)===R&&(D=U)})),D?D.ref?l.push(new bt(m,h.ref,"ref cannot reference another ref layer")):P=Hr(D.type):l.push(new bt(m,h.ref,`ref layer "${R}" not found`))}else if(P!=="background")if(h.source){const D=x.sources&&x.sources[h.source],U=D&&Hr(D.type);D?U==="vector"&&P==="raster"?l.push(new bt(m,h.source,`layer "${h.id}" requires a raster source`)):U!=="raster-dem"&&P==="hillshade"||U!=="raster-dem"&&P==="color-relief"?l.push(new bt(m,h.source,`layer "${h.id}" requires a raster-dem source`)):U==="raster"&&P!=="raster"?l.push(new bt(m,h.source,`layer "${h.id}" requires a vector source`)):U!=="vector"||h["source-layer"]?U==="raster-dem"&&P!=="hillshade"&&P!=="color-relief"?l.push(new bt(m,h.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):P!=="line"||!h.paint||!h.paint["line-gradient"]||U==="geojson"&&D.lineMetrics||l.push(new bt(m,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):l.push(new bt(m,h,`layer "${h.id}" must specify a "source-layer"`)):l.push(new bt(m,h.source,`source "${h.source}" not found`))}else l.push(new bt(m,h,'missing required property "source"'));return l=l.concat(bi({key:m,value:h,valueSpec:A.layer,style:f.style,styleSpec:f.styleSpec,validateSpec:f.validateSpec,objectElementValidators:{"*":()=>[],type:()=>f.validateSpec({key:`${m}.type`,value:h.type,valueSpec:A.layer.type,style:f.style,styleSpec:f.styleSpec,validateSpec:f.validateSpec,object:h,objectKey:"type"}),filter:Nh,layout:D=>bi({layer:h,key:D.key,value:D.value,style:D.style,styleSpec:D.styleSpec,validateSpec:D.validateSpec,objectElementValidators:{"*":U=>yo(Wn({layerType:P},U))}}),paint:D=>bi({layer:h,key:D.key,value:D.value,style:D.style,styleSpec:D.styleSpec,validateSpec:D.validateSpec,objectElementValidators:{"*":U=>Wo(Wn({layerType:P},U))}})}})),l}function ia(f){const l=f.value,h=f.key,m=Rr(l);return m!=="string"?[new bt(h,l,`string expected, ${m} found`)]:[]}const Ri={promoteId:function({key:f,value:l}){if(Rr(l)==="string")return ia({key:f,value:l});{const h=[];for(const m in l)h.push(...ia({key:`${f}.${m}`,value:l[m]}));return h}}};function qo(f){const l=f.value,h=f.key,m=f.styleSpec,x=f.style,A=f.validateSpec;if(!l.type)return[new bt(h,l,'"type" is required')];const P=Hr(l.type);let R;switch(P){case"vector":case"raster":return R=bi({key:h,value:l,valueSpec:m[`source_${P.replace("-","_")}`],style:f.style,styleSpec:m,objectElementValidators:Ri,validateSpec:A}),R;case"raster-dem":return R=(function(D){var U;const $=(U=D.sourceName)!==null&&U!==void 0?U:"",G=D.value,ee=D.styleSpec,re=ee.source_raster_dem,ne=D.style;let le=[];const de=Rr(G);if(G===void 0)return le;if(de!=="object")return le.push(new bt("source_raster_dem",G,`object expected, ${de} found`)),le;const xe=Hr(G.encoding)==="custom",$e=["redFactor","greenFactor","blueFactor","baseShift"],Ie=D.value.encoding?`"${D.value.encoding}"`:"Default";for(const De in G)!xe&&$e.includes(De)?le.push(new bt(De,G[De],`In "${$}": "${De}" is only valid when "encoding" is set to "custom". ${Ie} encoding found`)):re[De]?le=le.concat(D.validateSpec({key:De,value:G[De],valueSpec:re[De],validateSpec:D.validateSpec,style:ne,styleSpec:ee})):le.push(new bt(De,G[De],`unknown property "${De}"`));return le})({sourceName:h,value:l,style:f.style,styleSpec:m,validateSpec:A}),R;case"geojson":if(R=bi({key:h,value:l,valueSpec:m.source_geojson,style:x,styleSpec:m,validateSpec:A,objectElementValidators:Ri}),l.cluster)for(const D in l.clusterProperties){const[U,$]=l.clusterProperties[D],G=typeof U=="string"?[U,["accumulated"],["get",D]]:U;R.push(...na({key:`${h}.${D}.map`,value:$,expressionContext:"cluster-map"})),R.push(...na({key:`${h}.${D}.reduce`,value:G,expressionContext:"cluster-reduce"}))}return R;case"video":return bi({key:h,value:l,valueSpec:m.source_video,style:x,validateSpec:A,styleSpec:m});case"image":return bi({key:h,value:l,valueSpec:m.source_image,style:x,validateSpec:A,styleSpec:m});case"canvas":return[new bt(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ho({key:`${h}.type`,value:l.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Go(f){const l=f.value,h=f.styleSpec,m=h.light,x=f.style;let A=[];const P=Rr(l);if(l===void 0)return A;if(P!=="object")return A=A.concat([new bt("light",l,`object expected, ${P} found`)]),A;for(const R in l){const D=R.match(/^(.*)-transition$/);A=A.concat(D&&m[D[1]]&&m[D[1]].transition?f.validateSpec({key:R,value:l[R],valueSpec:h.transition,validateSpec:f.validateSpec,style:x,styleSpec:h}):m[R]?f.validateSpec({key:R,value:l[R],valueSpec:m[R],validateSpec:f.validateSpec,style:x,styleSpec:h}):[new bt(R,l[R],`unknown property "${R}"`)])}return A}function ji(f){const l=f.value,h=f.styleSpec,m=h.sky,x=f.style,A=Rr(l);if(l===void 0)return[];if(A!=="object")return[new bt("sky",l,`object expected, ${A} found`)];let P=[];for(const R in l)P=P.concat(m[R]?f.validateSpec({key:R,value:l[R],valueSpec:m[R],style:x,styleSpec:h}):[new bt(R,l[R],`unknown property "${R}"`)]);return P}function zh(f){const l=f.value,h=f.styleSpec,m=h.terrain,x=f.style;let A=[];const P=Rr(l);if(l===void 0)return A;if(P!=="object")return A=A.concat([new bt("terrain",l,`object expected, ${P} found`)]),A;for(const R in l)A=A.concat(m[R]?f.validateSpec({key:R,value:l[R],valueSpec:m[R],validateSpec:f.validateSpec,style:x,styleSpec:h}):[new bt(R,l[R],`unknown property "${R}"`)]);return A}function Lc(f){let l=[];const h=f.value,m=f.key;if(Array.isArray(h)){const x=[],A=[];for(const P in h)h[P].id&&x.includes(h[P].id)&&l.push(new bt(m,h,`all the sprites' ids must be unique, but ${h[P].id} is duplicated`)),x.push(h[P].id),h[P].url&&A.includes(h[P].url)&&l.push(new bt(m,h,`all the sprites' URLs must be unique, but ${h[P].url} is duplicated`)),A.push(h[P].url),l=l.concat(bi({key:`${m}[${P}]`,value:h[P],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:f.validateSpec}));return l}return ia({key:m,value:h})}function pp(f){return l=f.value,l&&l.constructor===Object?[]:[new bt(f.key,f.value,`object expected, ${Rr(f.value)} found`)];var l}const Wf={"*":()=>[],array:Lh,boolean:function(f){const l=f.value,h=f.key,m=Rr(l);return m!=="boolean"?[new bt(h,l,`boolean expected, ${m} found`)]:[]},number:Bh,color:$o,constants:go,enum:Ho,filter:Nh,function:Vl,layer:Hl,object:bi,source:qo,light:Go,sky:ji,terrain:zh,projection:function(f){const l=f.value,h=f.styleSpec,m=h.projection,x=f.style,A=Rr(l);if(l===void 0)return[];if(A!=="object")return[new bt("projection",l,`object expected, ${A} found`)];let P=[];for(const R in l)P=P.concat(m[R]?f.validateSpec({key:R,value:l[R],valueSpec:m[R],style:x,styleSpec:h}):[new bt(R,l[R],`unknown property "${R}"`)]);return P},projectionDefinition:function(f){const l=f.key;let h=f.value;h=h instanceof String?h.valueOf():h;const m=Rr(h);return m!=="array"||(function(x){return Array.isArray(x)&&x.length===3&&typeof x[0]=="string"&&typeof x[1]=="string"&&typeof x[2]=="number"})(h)||(function(x){return!!["interpolate","step","literal"].includes(x[0])})(h)?["array","string"].includes(m)?[]:[new bt(l,h,`projection expected, invalid type "${m}" found`)]:[new bt(l,h,`projection expected, invalid array ${JSON.stringify(h)} found`)]},string:ia,formatted:function(f){return ia(f).length===0?[]:na(f)},resolvedImage:function(f){return ia(f).length===0?[]:na(f)},padding:function(f){const l=f.key,h=f.value;if(Rr(h)==="array"){if(h.length<1||h.length>4)return[new bt(l,h,`padding requires 1 to 4 values; ${h.length} values found`)];const m={type:"number"};let x=[];for(let A=0;A<h.length;A++)x=x.concat(f.validateSpec({key:`${l}[${A}]`,value:h[A],validateSpec:f.validateSpec,valueSpec:m}));return x}return Bh({key:l,value:h,valueSpec:{}})},numberArray:function(f){const l=f.key,h=f.value;if(Rr(h)==="array"){const m={type:"number"};if(h.length<1)return[new bt(l,h,"array length at least 1 expected, length 0 found")];let x=[];for(let A=0;A<h.length;A++)x=x.concat(f.validateSpec({key:`${l}[${A}]`,value:h[A],validateSpec:f.validateSpec,valueSpec:m}));return x}return Bh({key:l,value:h,valueSpec:{}})},colorArray:function(f){const l=f.key,h=f.value;if(Rr(h)==="array"){if(h.length<1)return[new bt(l,h,"array length at least 1 expected, length 0 found")];let m=[];for(let x=0;x<h.length;x++)m=m.concat($o({key:`${l}[${x}]`,value:h[x]}));return m}return $o({key:l,value:h})},variableAnchorOffsetCollection:function(f){const l=f.key,h=f.value,m=Rr(h),x=f.styleSpec;if(m!=="array"||h.length<1||h.length%2!=0)return[new bt(l,h,"variableAnchorOffsetCollection requires a non-empty array of even length")];let A=[];for(let P=0;P<h.length;P+=2)A=A.concat(Ho({key:`${l}[${P}]`,value:h[P],valueSpec:x.layout_symbol["text-anchor"]})),A=A.concat(Lh({key:`${l}[${P+1}]`,value:h[P+1],valueSpec:{length:2,value:"number"},validateSpec:f.validateSpec,style:f.style,styleSpec:x}));return A},sprite:Lc,state:pp};function qf(f){const l=f.value,h=f.valueSpec,m=f.styleSpec;return f.validateSpec=qf,h.expression&&co(Hr(l))?Vl(f):h.expression&&Oh(Vo(l))?na(f):h.type&&Wf[h.type]?Wf[h.type](f):bi(Wn({},f,{valueSpec:h.type?m[h.type]:h}))}function Zn(f){const l=f.value,h=f.key,m=ia(f);return m.length||(l.indexOf("{fontstack}")===-1&&m.push(new bt(h,l,'"glyphs" url must include a "{fontstack}" token')),l.indexOf("{range}")===-1&&m.push(new bt(h,l,'"glyphs" url must include a "{range}" token'))),m}function Us(f,l=He){let h=[];return h=h.concat(qf({key:"",value:f,valueSpec:l.$root,styleSpec:l,style:f,validateSpec:qf,objectElementValidators:{glyphs:Zn,"*":()=>[]}})),f.constants&&(h=h.concat(go({key:"constants",value:f.constants}))),Eu(h)}function Oi(f){return function(l){return f(Object.assign({},l,{validateSpec:qf}))}}function Eu(f){return[].concat(f).sort(((l,h)=>l.line-h.line))}function sa(f){return function(...l){return Eu(f.apply(this,l))}}Us.source=sa(Oi(qo)),Us.sprite=sa(Oi(Lc)),Us.glyphs=sa(Oi(Zn)),Us.light=sa(Oi(Go)),Us.sky=sa(Oi(ji)),Us.terrain=sa(Oi(zh)),Us.state=sa(Oi(pp)),Us.layer=sa(Oi(Hl)),Us.filter=sa(Oi(Nh)),Us.paintProperty=sa(Oi(Wo)),Us.layoutProperty=sa(Oi(yo));const za=Us,_o=za.light,e_=za.sky,nm=za.paintProperty,Gf=za.layoutProperty;function gp(f,l){let h=!1;if(l&&l.length)for(const m of l)f.fire(new mt(new Error(m.message))),h=!0;return h}class aa{constructor(l,h,m){const x=this.cells=[];if(l instanceof ArrayBuffer){this.arrayBuffer=l;const P=new Int32Array(this.arrayBuffer);l=P[0],this.d=(h=P[1])+2*(m=P[2]);for(let D=0;D<this.d*this.d;D++){const U=P[3+D],$=P[3+D+1];x.push(U===$?null:P.subarray(U,$))}const R=P[3+x.length+1];this.keys=P.subarray(P[3+x.length],R),this.bboxes=P.subarray(R),this.insert=this._insertReadonly}else{this.d=h+2*m;for(let P=0;P<this.d*this.d;P++)x.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=l,this.padding=m,this.scale=h/l,this.uid=0;const A=m/h*l;this.min=-A,this.max=l+A}insert(l,h,m,x,A){this._forEachCell(h,m,x,A,this._insertCell,this.uid++,void 0,void 0),this.keys.push(l),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(x),this.bboxes.push(A)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(l,h,m,x,A,P){this.cells[A].push(P)}query(l,h,m,x,A){const P=this.min,R=this.max;if(l<=P&&h<=P&&R<=m&&R<=x&&!A)return Array.prototype.slice.call(this.keys);{const D=[];return this._forEachCell(l,h,m,x,this._queryCell,D,{},A),D}}_queryCell(l,h,m,x,A,P,R,D){const U=this.cells[A];if(U!==null){const $=this.keys,G=this.bboxes;for(let ee=0;ee<U.length;ee++){const re=U[ee];if(R[re]===void 0){const ne=4*re;(D?D(G[ne+0],G[ne+1],G[ne+2],G[ne+3]):l<=G[ne+2]&&h<=G[ne+3]&&m>=G[ne+0]&&x>=G[ne+1])?(R[re]=!0,P.push($[re])):R[re]=!1}}}}_forEachCell(l,h,m,x,A,P,R,D){const U=this._convertToCellCoord(l),$=this._convertToCellCoord(h),G=this._convertToCellCoord(m),ee=this._convertToCellCoord(x);for(let re=U;re<=G;re++)for(let ne=$;ne<=ee;ne++){const le=this.d*ne+re;if((!D||D(this._convertFromCellCoord(re),this._convertFromCellCoord(ne),this._convertFromCellCoord(re+1),this._convertFromCellCoord(ne+1)))&&A.call(this,l,h,m,x,le,P,R,D))return}}_convertFromCellCoord(l){return(l-this.padding)/this.scale}_convertToCellCoord(l){return Math.max(0,Math.min(this.d-1,Math.floor(l*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const l=this.cells,h=3+this.cells.length+1+1;let m=0;for(let P=0;P<this.cells.length;P++)m+=this.cells[P].length;const x=new Int32Array(h+m+this.keys.length+this.bboxes.length);x[0]=this.extent,x[1]=this.n,x[2]=this.padding;let A=h;for(let P=0;P<l.length;P++){const R=l[P];x[3+P]=A,x.set(R,A),A+=R.length}return x[3+l.length]=A,x.set(this.keys,A),A+=this.keys.length,x[3+l.length+1]=A,x.set(this.bboxes,A),A+=this.bboxes.length,x.buffer}static serialize(l,h){const m=l.toArrayBuffer();return h&&h.push(m),{buffer:m}}static deserialize(l){return new aa(l.buffer)}}const js={};function Ht(f,l,h={}){if(js[f])throw new Error(`${f} is already registered.`);Object.defineProperty(l,"_classRegistryKey",{value:f,writeable:!1}),js[f]={klass:l,omit:h.omit||[],shallow:h.shallow||[]}}Ht("Object",Object),Ht("Set",Set),Ht("TransferableGridIndex",aa),Ht("Color",Lr),Ht("Error",Error),Ht("AJAXError",Me),Ht("ResolvedImage",si),Ht("StylePropertyFunction",fo),Ht("StyleExpression",Rh,{omit:["_evaluator"]}),Ht("ZoomDependentExpression",Fs),Ht("ZoomConstantExpression",Au),Ht("CompoundExpression",ma,{omit:["_evaluate"]});for(const f in Tu)Tu[f]._classRegistryKey||Ht(`Expression_${f}`,Tu[f]);function Xf(f){return f&&typeof ArrayBuffer<"u"&&(f instanceof ArrayBuffer||f.constructor&&f.constructor.name==="ArrayBuffer")}function Xo(f){return f.$name||f.constructor._classRegistryKey}function Fh(f){return!(function(l){if(l===null||typeof l!="object")return!1;const h=Xo(l);return!(!h||h==="Object")})(f)&&(f==null||typeof f=="boolean"||typeof f=="number"||typeof f=="string"||f instanceof Boolean||f instanceof Number||f instanceof String||f instanceof Date||f instanceof RegExp||f instanceof Blob||f instanceof Error||Xf(f)||Os(f)||ArrayBuffer.isView(f)||f instanceof ImageData)}function vo(f,l){if(Fh(f))return(Xf(f)||Os(f))&&l&&l.push(f),ArrayBuffer.isView(f)&&l&&l.push(f.buffer),f instanceof ImageData&&l&&l.push(f.data.buffer),f;if(Array.isArray(f)){const A=[];for(const P of f)A.push(vo(P,l));return A}if(typeof f!="object")throw new Error("can't serialize object of type "+typeof f);const h=Xo(f);if(!h)throw new Error(`can't serialize object of unregistered class ${f.constructor.name}`);if(!js[h])throw new Error(`${h} is not registered.`);const{klass:m}=js[h],x=m.serialize?m.serialize(f,l):{};if(m.serialize){if(l&&x===l[l.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const A in f){if(!f.hasOwnProperty(A)||js[h].omit.indexOf(A)>=0)continue;const P=f[A];x[A]=js[h].shallow.indexOf(A)>=0?P:vo(P,l)}f instanceof Error&&(x.message=f.message)}if(x.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(x.$name=h),x}function Zo(f){if(Fh(f))return f;if(Array.isArray(f))return f.map(Zo);if(typeof f!="object")throw new Error("can't deserialize object of type "+typeof f);const l=Xo(f)||"Object";if(!js[l])throw new Error(`can't deserialize unregistered class ${l}`);const{klass:h}=js[l];if(!h)throw new Error(`can't deserialize unregistered class ${l}`);if(h.deserialize)return h.deserialize(f);const m=Object.create(h.prototype);for(const x of Object.keys(f)){if(x==="$name")continue;const A=f[x];m[x]=js[l].shallow.indexOf(x)>=0?A:Zo(A)}return m}class Zf{constructor(){this.first=!0}update(l,h){const m=Math.floor(l);return this.first?(this.first=!1,this.lastIntegerZoom=m,this.lastIntegerZoomTime=0,this.lastZoom=l,this.lastFloorZoom=m,!0):(this.lastFloorZoom>m?(this.lastIntegerZoom=m+1,this.lastIntegerZoomTime=h):this.lastFloorZoom<m&&(this.lastIntegerZoom=m,this.lastIntegerZoomTime=h),l!==this.lastZoom&&(this.lastZoom=l,this.lastFloorZoom=m,!0))}}const Br={"Latin-1 Supplement":f=>f>=128&&f<=255,"Hangul Jamo":f=>f>=4352&&f<=4607,Khmer:f=>f>=6016&&f<=6143,"General Punctuation":f=>f>=8192&&f<=8303,"Letterlike Symbols":f=>f>=8448&&f<=8527,"Number Forms":f=>f>=8528&&f<=8591,"Miscellaneous Technical":f=>f>=8960&&f<=9215,"Control Pictures":f=>f>=9216&&f<=9279,"Optical Character Recognition":f=>f>=9280&&f<=9311,"Enclosed Alphanumerics":f=>f>=9312&&f<=9471,"Geometric Shapes":f=>f>=9632&&f<=9727,"Miscellaneous Symbols":f=>f>=9728&&f<=9983,"Miscellaneous Symbols and Arrows":f=>f>=11008&&f<=11263,"Ideographic Description Characters":f=>f>=12272&&f<=12287,"CJK Symbols and Punctuation":f=>f>=12288&&f<=12351,Hiragana:f=>f>=12352&&f<=12447,Katakana:f=>f>=12448&&f<=12543,Kanbun:f=>f>=12688&&f<=12703,"CJK Strokes":f=>f>=12736&&f<=12783,"Enclosed CJK Letters and Months":f=>f>=12800&&f<=13055,"CJK Compatibility":f=>f>=13056&&f<=13311,"Yijing Hexagram Symbols":f=>f>=19904&&f<=19967,"CJK Unified Ideographs":f=>f>=19968&&f<=40959,"Hangul Syllables":f=>f>=44032&&f<=55215,"Private Use Area":f=>f>=57344&&f<=63743,"Vertical Forms":f=>f>=65040&&f<=65055,"CJK Compatibility Forms":f=>f>=65072&&f<=65103,"Small Form Variants":f=>f>=65104&&f<=65135,"Halfwidth and Fullwidth Forms":f=>f>=65280&&f<=65519};function Yo(f){for(const l of f)if(Pu(l.charCodeAt(0)))return!0;return!1}function Wl(f){for(const l of f)if(!Bc(l.charCodeAt(0)))return!1;return!0}function Yf(f){const l=f.map((h=>{try{return new RegExp(`\\p{sc=${h}}`,"u").source}catch{return null}})).filter((h=>h));return new RegExp(l.join("|"),"u")}const mp=Yf(["Arab","Dupl","Mong","Ougr","Syrc"]);function Bc(f){return!mp.test(String.fromCodePoint(f))}const Cu=Yf(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Pu(f){return!(f!==746&&f!==747&&(f<4352||!(Br["CJK Compatibility Forms"](f)&&!(f>=65097&&f<=65103)||Br["CJK Compatibility"](f)||Br["CJK Strokes"](f)||!(!Br["CJK Symbols and Punctuation"](f)||f>=12296&&f<=12305||f>=12308&&f<=12319||f===12336)||Br["Enclosed CJK Letters and Months"](f)||Br["Ideographic Description Characters"](f)||Br.Kanbun(f)||Br.Katakana(f)&&f!==12540||!(!Br["Halfwidth and Fullwidth Forms"](f)||f===65288||f===65289||f===65293||f>=65306&&f<=65310||f===65339||f===65341||f===65343||f>=65371&&f<=65503||f===65507||f>=65512&&f<=65519)||!(!Br["Small Form Variants"](f)||f>=65112&&f<=65118||f>=65123&&f<=65126)||Br["Vertical Forms"](f)||Br["Yijing Hexagram Symbols"](f)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(f))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(f))||Cu.test(String.fromCodePoint(f)))))}function Nc(f){return!(Pu(f)||(function(l){return!!(Br["Latin-1 Supplement"](l)&&(l===167||l===169||l===174||l===177||l===188||l===189||l===190||l===215||l===247)||Br["General Punctuation"](l)&&(l===8214||l===8224||l===8225||l===8240||l===8241||l===8251||l===8252||l===8258||l===8263||l===8264||l===8265||l===8273)||Br["Letterlike Symbols"](l)||Br["Number Forms"](l)||Br["Miscellaneous Technical"](l)&&(l>=8960&&l<=8967||l>=8972&&l<=8991||l>=8996&&l<=9e3||l===9003||l>=9085&&l<=9114||l>=9150&&l<=9165||l===9167||l>=9169&&l<=9179||l>=9186&&l<=9215)||Br["Control Pictures"](l)&&l!==9251||Br["Optical Character Recognition"](l)||Br["Enclosed Alphanumerics"](l)||Br["Geometric Shapes"](l)||Br["Miscellaneous Symbols"](l)&&!(l>=9754&&l<=9759)||Br["Miscellaneous Symbols and Arrows"](l)&&(l>=11026&&l<=11055||l>=11088&&l<=11097||l>=11192&&l<=11243)||Br["CJK Symbols and Punctuation"](l)||Br.Katakana(l)||Br["Private Use Area"](l)||Br["CJK Compatibility Forms"](l)||Br["Small Form Variants"](l)||Br["Halfwidth and Fullwidth Forms"](l)||l===8734||l===8756||l===8757||l>=9984&&l<=10087||l>=10102&&l<=10131||l===65532||l===65533)})(f))}const Uh=Yf(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Kf(f){return Uh.test(String.fromCodePoint(f))}function ql(f,l){return!(!l&&Kf(f)||f>=2304&&f<=3583||f>=3840&&f<=4255||Br.Khmer(f))}function jh(f){for(const l of f)if(Kf(l.charCodeAt(0)))return!0;return!1}const vs=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(f){this.pluginStatus=f.pluginStatus,this.pluginURL=f.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(f){if(vs.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=f.applyArabicShaping,this.processBidirectionalText=f.processBidirectionalText,this.processStyledBidirectionalText=f.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(f,l){return s(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(f.pluginStatus!=="loading")return this.setState(f),f;const h=f.pluginURL,m=new Promise((A=>{this.loadScriptResolve=A}));l(h);const x=new Promise((A=>setTimeout((()=>A()),this.TIMEOUT)));if(yield Promise.race([m,x]),this.isParsed()){const A={pluginStatus:"loaded",pluginURL:h};return this.setState(A),A}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${h}`)}))}};class Qr{constructor(l,h){this.isSupportedScript=yp,this.zoom=l,h?(this.now=h.now||0,this.fadeDuration=h.fadeDuration||0,this.zoomHistory=h.zoomHistory||new Zf,this.transition=h.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Zf,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const l=this.zoom,h=l-Math.floor(l),m=this.crossFadingFactor();return l>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:h+(1-h)*m}:{fromScale:.5,toScale:1,t:1-(1-m)*h}}}function yp(f){return(function(l,h){for(const m of l)if(!ql(m.charCodeAt(0),h))return!1;return!0})(f,vs.getRTLTextPluginStatus()==="loaded")}class Fa{constructor(l,h,m){this.property=l,this.value=h,this.expression=(function(x,A,P){if(co(x))return new fo(x,A);if(Oh(x)){const R=Dc(x,A,P);if(R.result==="error")throw new Error(R.value.map((D=>`${D.key}: ${D.message}`)).join(", "));return R.value}{let R=x;return A.type==="color"&&typeof x=="string"?R=Lr.parse(x):A.type!=="padding"||typeof x!="number"&&!Array.isArray(x)?A.type!=="numberArray"||typeof x!="number"&&!Array.isArray(x)?A.type!=="colorArray"||typeof x!="string"&&!Array.isArray(x)?A.type==="variableAnchorOffsetCollection"&&Array.isArray(x)?R=Mi.parse(x):A.type==="projectionDefinition"&&typeof x=="string"&&(R=zi.parse(x)):R=ii.parse(x):R=_i.parse(x):R=Gn.parse(x),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>R}}})(h===void 0?l.specification.default:h,l.specification,m)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(l,h,m){return this.property.possiblyEvaluate(this,l,h,m)}}class Ua{constructor(l,h){this.property=l,this.value=new Fa(l,void 0,h)}transitioned(l,h){return new Vh(this.property,this.value,h,nr({},l.transition,this.transition),l.now)}untransitioned(){return new Vh(this.property,this.value,null,{},0)}}class zc{constructor(l,h){this._properties=l,this._values=Object.create(l.defaultTransitionablePropertyValues),this._globalState=h}getValue(l){return Mt(this._values[l].value.value)}setValue(l,h){Object.prototype.hasOwnProperty.call(this._values,l)||(this._values[l]=new Ua(this._values[l].property,this._globalState)),this._values[l].value=new Fa(this._values[l].property,h===null?void 0:Mt(h),this._globalState)}getTransition(l){return Mt(this._values[l].transition)}setTransition(l,h){Object.prototype.hasOwnProperty.call(this._values,l)||(this._values[l]=new Ua(this._values[l].property,this._globalState)),this._values[l].transition=Mt(h)||void 0}serialize(){const l={};for(const h of Object.keys(this._values)){const m=this.getValue(h);m!==void 0&&(l[h]=m);const x=this.getTransition(h);x!==void 0&&(l[`${h}-transition`]=x)}return l}transitioned(l,h){const m=new Qf(this._properties);for(const x of Object.keys(this._values))m._values[x]=this._values[x].transitioned(l,h._values[x]);return m}untransitioned(){const l=new Qf(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].untransitioned();return l}}class Vh{constructor(l,h,m,x,A){this.property=l,this.value=h,this.begin=A+x.delay||0,this.end=this.begin+x.duration||0,l.specification.transition&&(x.delay||x.duration)&&(this.prior=m)}possiblyEvaluate(l,h,m){const x=l.now||0,A=this.value.possiblyEvaluate(l,h,m),P=this.prior;if(P){if(x>this.end)return this.prior=null,A;if(this.value.isDataDriven())return this.prior=null,A;if(x<this.begin)return P.possiblyEvaluate(l,h,m);{const R=(x-this.begin)/(this.end-this.begin);return this.property.interpolate(P.possiblyEvaluate(l,h,m),A,rt(R))}}return A}}class Qf{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitioningPropertyValues)}possiblyEvaluate(l,h,m){const x=new Hh(this._properties);for(const A of Object.keys(this._values))x._values[A]=this._values[A].possiblyEvaluate(l,h,m);return x}hasTransition(){for(const l of Object.keys(this._values))if(this._values[l].prior)return!0;return!1}}class $h{constructor(l,h){this._properties=l,this._values=Object.create(l.defaultPropertyValues),this._globalState=h}hasValue(l){return this._values[l].value!==void 0}getValue(l){return Mt(this._values[l].value)}setValue(l,h){this._values[l]=new Fa(this._values[l].property,h===null?void 0:Mt(h),this._globalState)}serialize(){const l={};for(const h of Object.keys(this._values)){const m=this.getValue(h);m!==void 0&&(l[h]=m)}return l}possiblyEvaluate(l,h,m){const x=new Hh(this._properties);for(const A of Object.keys(this._values))x._values[A]=this._values[A].possiblyEvaluate(l,h,m);return x}}class Vs{constructor(l,h,m){this.property=l,this.value=h,this.parameters=m}isConstant(){return this.value.kind==="constant"}constantOr(l){return this.value.kind==="constant"?this.value.value:l}evaluate(l,h,m,x){return this.property.evaluate(this.value,this.parameters,l,h,m,x)}}class Hh{constructor(l){this._properties=l,this._values=Object.create(l.defaultPossiblyEvaluatedValues)}get(l){return this._values[l]}}class Qt{constructor(l){this.specification=l}possiblyEvaluate(l,h){if(l.isDataDriven())throw new Error("Value should not be data driven");return l.expression.evaluate(h)}interpolate(l,h,m){const x=io[this.specification.type];return x?x(l,h,m):l}}class tr{constructor(l,h){this.specification=l,this.overrides=h}possiblyEvaluate(l,h,m,x){return new Vs(this,l.expression.kind==="constant"||l.expression.kind==="camera"?{kind:"constant",value:l.expression.evaluate(h,null,{},m,x)}:l.expression,h)}interpolate(l,h,m){if(l.value.kind!=="constant"||h.value.kind!=="constant")return l;if(l.value.value===void 0||h.value.value===void 0)return new Vs(this,{kind:"constant",value:void 0},l.parameters);const x=io[this.specification.type];if(x){const A=x(l.value.value,h.value.value,m);return new Vs(this,{kind:"constant",value:A},l.parameters)}return l}evaluate(l,h,m,x,A,P){return l.kind==="constant"?l.value:l.evaluate(h,m,x,A,P)}}class Gl extends tr{possiblyEvaluate(l,h,m,x){if(l.value===void 0)return new Vs(this,{kind:"constant",value:void 0},h);if(l.expression.kind==="constant"){const A=l.expression.evaluate(h,null,{},m,x),P=l.property.specification.type==="resolvedImage"&&typeof A!="string"?A.name:A,R=this._calculate(P,P,P,h);return new Vs(this,{kind:"constant",value:R},h)}if(l.expression.kind==="camera"){const A=this._calculate(l.expression.evaluate({zoom:h.zoom-1}),l.expression.evaluate({zoom:h.zoom}),l.expression.evaluate({zoom:h.zoom+1}),h);return new Vs(this,{kind:"constant",value:A},h)}return new Vs(this,l.expression,h)}evaluate(l,h,m,x,A,P){if(l.kind==="source"){const R=l.evaluate(h,m,x,A,P);return this._calculate(R,R,R,h)}return l.kind==="composite"?this._calculate(l.evaluate({zoom:Math.floor(h.zoom)-1},m,x),l.evaluate({zoom:Math.floor(h.zoom)},m,x),l.evaluate({zoom:Math.floor(h.zoom)+1},m,x),h):l.value}_calculate(l,h,m,x){return x.zoom>x.zoomHistory.lastIntegerZoom?{from:l,to:h}:{from:m,to:h}}interpolate(l){return l}}class _p{constructor(l){this.specification=l}possiblyEvaluate(l,h,m,x){if(l.value!==void 0){if(l.expression.kind==="constant"){const A=l.expression.evaluate(h,null,{},m,x);return this._calculate(A,A,A,h)}return this._calculate(l.expression.evaluate(new Qr(Math.floor(h.zoom-1),h)),l.expression.evaluate(new Qr(Math.floor(h.zoom),h)),l.expression.evaluate(new Qr(Math.floor(h.zoom+1),h)),h)}}_calculate(l,h,m,x){return x.zoom>x.zoomHistory.lastIntegerZoom?{from:l,to:h}:{from:m,to:h}}interpolate(l){return l}}class Mu{constructor(l){this.specification=l}possiblyEvaluate(l,h,m,x){return!!l.expression.evaluate(h,null,{},m,x)}interpolate(){return!1}}class Vi{constructor(l){this.properties=l,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const h in l){const m=l[h];m.specification.overridable&&this.overridableProperties.push(h);const x=this.defaultPropertyValues[h]=new Fa(m,void 0,void 0),A=this.defaultTransitionablePropertyValues[h]=new Ua(m,void 0);this.defaultTransitioningPropertyValues[h]=A.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=x.possiblyEvaluate({})}}}Ht("DataDrivenProperty",tr),Ht("DataConstantProperty",Qt),Ht("CrossFadedDataDrivenProperty",Gl),Ht("CrossFadedProperty",_p),Ht("ColorRampProperty",Mu);const $s="-transition";class ei extends Xt{constructor(l,h,m){if(super(),this.id=l.id,this.type=l.type,this._globalState=m,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},l.type!=="custom"&&(this.metadata=l.metadata,this.minzoom=l.minzoom,this.maxzoom=l.maxzoom,l.type!=="background"&&(this.source=l.source,this.sourceLayer=l["source-layer"],this.filter=l.filter,this._featureFilter=as(l.filter,m)),h.layout&&(this._unevaluatedLayout=new $h(h.layout,m)),h.paint)){this._transitionablePaint=new zc(h.paint,m);for(const x in l.paint)this.setPaintProperty(x,l.paint[x],{validate:!1});for(const x in l.layout)this.setLayoutProperty(x,l.layout[x],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Hh(h.paint)}}setFilter(l){this.filter=l,this._featureFilter=as(l,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(l){return l==="visibility"?this.visibility:this._unevaluatedLayout.getValue(l)}getLayoutAffectingGlobalStateRefs(){const l=new Set;if(this._unevaluatedLayout)for(const h in this._unevaluatedLayout._values){const m=this._unevaluatedLayout._values[h];for(const x of m.getGlobalStateRefs())l.add(x)}for(const h of this._featureFilter.getGlobalStateRefs())l.add(h);return l}getPaintAffectingGlobalStateRefs(){var l;const h=new globalThis.Map;if(this._transitionablePaint)for(const m in this._transitionablePaint._values){const x=this._transitionablePaint._values[m].value;for(const A of x.getGlobalStateRefs()){const P=(l=h.get(A))!==null&&l!==void 0?l:[];P.push({name:m,value:x.value}),h.set(A,P)}}return h}setLayoutProperty(l,h,m={}){h!=null&&this._validate(Gf,`layers.${this.id}.layout.${l}`,l,h,m)||(l!=="visibility"?this._unevaluatedLayout.setValue(l,h):this.visibility=h)}getPaintProperty(l){return l.endsWith($s)?this._transitionablePaint.getTransition(l.slice(0,-11)):this._transitionablePaint.getValue(l)}setPaintProperty(l,h,m={}){if(h!=null&&this._validate(nm,`layers.${this.id}.paint.${l}`,l,h,m))return!1;if(l.endsWith($s))return this._transitionablePaint.setTransition(l.slice(0,-11),h||void 0),!1;{const x=this._transitionablePaint._values[l],A=x.property.specification["property-type"]==="cross-faded-data-driven",P=x.value.isDataDriven(),R=x.value;this._transitionablePaint.setValue(l,h),this._handleSpecialPaintPropertyUpdate(l);const D=this._transitionablePaint._values[l].value;return D.isDataDriven()||P||A||this._handleOverridablePaintPropertyUpdate(l,R,D)}}_handleSpecialPaintPropertyUpdate(l){}_handleOverridablePaintPropertyUpdate(l,h,m){return!1}isHidden(l){return!!(this.minzoom&&l<this.minzoom)||!!(this.maxzoom&&l>=this.maxzoom)||this.visibility==="none"}updateTransitions(l){this._transitioningPaint=this._transitionablePaint.transitioned(l,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(l,h){l.getCrossfadeParameters&&(this._crossfadeParameters=l.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(l,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(l,void 0,h)}serialize(){const l={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(l.layout=l.layout||{},l.layout.visibility=this.visibility),mr(l,((h,m)=>!(h===void 0||m==="layout"&&!Object.keys(h).length||m==="paint"&&!Object.keys(h).length)))}_validate(l,h,m,x,A={}){return(!A||A.validate!==!1)&&gp(this,l.call(za,{key:h,layerType:this.type,objectKey:m,value:x,styleSpec:He,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const l in this.paint._values){const h=this.paint.get(l);if(h instanceof Vs&&lo(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1}}const Hs={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Xl{constructor(l,h){this._structArray=l,this._pos1=h*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class bn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(l,h){return l._trim(),h&&(l.isTransferred=!0,h.push(l.arrayBuffer)),{length:l.length,arrayBuffer:l.arrayBuffer}}static deserialize(l){const h=Object.create(this.prototype);return h.arrayBuffer=l.arrayBuffer,h.length=l.length,h.capacity=l.arrayBuffer.byteLength/h.bytesPerElement,h._refreshViews(),h}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(l){this.reserve(l),this.length=l}reserve(l){if(l>this.capacity){this.capacity=Math.max(l,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const h=this.uint8;this._refreshViews(),h&&this.uint8.set(h)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function an(f,l=1){let h=0,m=0;return{members:f.map((x=>{const A=Hs[x.type].BYTES_PER_ELEMENT,P=h=os(h,Math.max(l,A)),R=x.components||1;return m=Math.max(m,A),h+=A*R,{name:x.name,type:x.type,components:R,offset:P}})),size:os(h,Math.max(m,l)),alignment:l}}function os(f,l){return Math.ceil(f/l)*l}class Dn extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h){const m=this.length;return this.resize(m+1),this.emplace(m,l,h)}emplace(l,h,m){const x=2*l;return this.int16[x+0]=h,this.int16[x+1]=m,l}}Dn.prototype.bytesPerElement=4,Ht("StructArrayLayout2i4",Dn);class bo extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m){const x=this.length;return this.resize(x+1),this.emplace(x,l,h,m)}emplace(l,h,m,x){const A=3*l;return this.int16[A+0]=h,this.int16[A+1]=m,this.int16[A+2]=x,l}}bo.prototype.bytesPerElement=6,Ht("StructArrayLayout3i6",bo);class bs extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m,x){const A=this.length;return this.resize(A+1),this.emplace(A,l,h,m,x)}emplace(l,h,m,x,A){const P=4*l;return this.int16[P+0]=h,this.int16[P+1]=m,this.int16[P+2]=x,this.int16[P+3]=A,l}}bs.prototype.bytesPerElement=8,Ht("StructArrayLayout4i8",bs);class Pr extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m,x,A,P){const R=this.length;return this.resize(R+1),this.emplace(R,l,h,m,x,A,P)}emplace(l,h,m,x,A,P,R){const D=6*l;return this.int16[D+0]=h,this.int16[D+1]=m,this.int16[D+2]=x,this.int16[D+3]=A,this.int16[D+4]=P,this.int16[D+5]=R,l}}Pr.prototype.bytesPerElement=12,Ht("StructArrayLayout2i4i12",Pr);class Jr extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m,x,A,P){const R=this.length;return this.resize(R+1),this.emplace(R,l,h,m,x,A,P)}emplace(l,h,m,x,A,P,R){const D=4*l,U=8*l;return this.int16[D+0]=h,this.int16[D+1]=m,this.uint8[U+4]=x,this.uint8[U+5]=A,this.uint8[U+6]=P,this.uint8[U+7]=R,l}}Jr.prototype.bytesPerElement=8,Ht("StructArrayLayout2i4ub8",Jr);class dn extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h){const m=this.length;return this.resize(m+1),this.emplace(m,l,h)}emplace(l,h,m){const x=2*l;return this.float32[x+0]=h,this.float32[x+1]=m,l}}dn.prototype.bytesPerElement=8,Ht("StructArrayLayout2f8",dn);class Iu extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h,m,x,A,P,R,D,U,$){const G=this.length;return this.resize(G+1),this.emplace(G,l,h,m,x,A,P,R,D,U,$)}emplace(l,h,m,x,A,P,R,D,U,$,G){const ee=10*l;return this.uint16[ee+0]=h,this.uint16[ee+1]=m,this.uint16[ee+2]=x,this.uint16[ee+3]=A,this.uint16[ee+4]=P,this.uint16[ee+5]=R,this.uint16[ee+6]=D,this.uint16[ee+7]=U,this.uint16[ee+8]=$,this.uint16[ee+9]=G,l}}Iu.prototype.bytesPerElement=20,Ht("StructArrayLayout10ui20",Iu);class Zl extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h,m,x,A,P,R,D){const U=this.length;return this.resize(U+1),this.emplace(U,l,h,m,x,A,P,R,D)}emplace(l,h,m,x,A,P,R,D,U){const $=8*l;return this.uint16[$+0]=h,this.uint16[$+1]=m,this.uint16[$+2]=x,this.uint16[$+3]=A,this.uint16[$+4]=P,this.uint16[$+5]=R,this.uint16[$+6]=D,this.uint16[$+7]=U,l}}Zl.prototype.bytesPerElement=16,Ht("StructArrayLayout8ui16",Zl);class xo extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h,m,x,A,P,R,D,U,$,G,ee){const re=this.length;return this.resize(re+1),this.emplace(re,l,h,m,x,A,P,R,D,U,$,G,ee)}emplace(l,h,m,x,A,P,R,D,U,$,G,ee,re){const ne=12*l;return this.int16[ne+0]=h,this.int16[ne+1]=m,this.int16[ne+2]=x,this.int16[ne+3]=A,this.uint16[ne+4]=P,this.uint16[ne+5]=R,this.uint16[ne+6]=D,this.uint16[ne+7]=U,this.int16[ne+8]=$,this.int16[ne+9]=G,this.int16[ne+10]=ee,this.int16[ne+11]=re,l}}xo.prototype.bytesPerElement=24,Ht("StructArrayLayout4i4ui4i24",xo);class Ru extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m){const x=this.length;return this.resize(x+1),this.emplace(x,l,h,m)}emplace(l,h,m,x){const A=3*l;return this.float32[A+0]=h,this.float32[A+1]=m,this.float32[A+2]=x,l}}Ru.prototype.bytesPerElement=12,Ht("StructArrayLayout3f12",Ru);class E extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l){const h=this.length;return this.resize(h+1),this.emplace(h,l)}emplace(l,h){return this.uint32[1*l+0]=h,l}}E.prototype.bytesPerElement=4,Ht("StructArrayLayout1ul4",E);class o extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h,m,x,A,P,R,D,U){const $=this.length;return this.resize($+1),this.emplace($,l,h,m,x,A,P,R,D,U)}emplace(l,h,m,x,A,P,R,D,U,$){const G=10*l,ee=5*l;return this.int16[G+0]=h,this.int16[G+1]=m,this.int16[G+2]=x,this.int16[G+3]=A,this.int16[G+4]=P,this.int16[G+5]=R,this.uint32[ee+3]=D,this.uint16[G+8]=U,this.uint16[G+9]=$,l}}o.prototype.bytesPerElement=20,Ht("StructArrayLayout6i1ul2ui20",o);class d extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m,x,A,P){const R=this.length;return this.resize(R+1),this.emplace(R,l,h,m,x,A,P)}emplace(l,h,m,x,A,P,R){const D=6*l;return this.int16[D+0]=h,this.int16[D+1]=m,this.int16[D+2]=x,this.int16[D+3]=A,this.int16[D+4]=P,this.int16[D+5]=R,l}}d.prototype.bytesPerElement=12,Ht("StructArrayLayout2i2i2i12",d);class y extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m,x,A){const P=this.length;return this.resize(P+1),this.emplace(P,l,h,m,x,A)}emplace(l,h,m,x,A,P){const R=4*l,D=8*l;return this.float32[R+0]=h,this.float32[R+1]=m,this.float32[R+2]=x,this.int16[D+6]=A,this.int16[D+7]=P,l}}y.prototype.bytesPerElement=16,Ht("StructArrayLayout2f1f2i16",y);class w extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m,x,A,P){const R=this.length;return this.resize(R+1),this.emplace(R,l,h,m,x,A,P)}emplace(l,h,m,x,A,P,R){const D=16*l,U=4*l,$=8*l;return this.uint8[D+0]=h,this.uint8[D+1]=m,this.float32[U+1]=x,this.float32[U+2]=A,this.int16[$+6]=P,this.int16[$+7]=R,l}}w.prototype.bytesPerElement=16,Ht("StructArrayLayout2ub2f2i16",w);class C extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h,m){const x=this.length;return this.resize(x+1),this.emplace(x,l,h,m)}emplace(l,h,m,x){const A=3*l;return this.uint16[A+0]=h,this.uint16[A+1]=m,this.uint16[A+2]=x,l}}C.prototype.bytesPerElement=6,Ht("StructArrayLayout3ui6",C);class I extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,x,A,P,R,D,U,$,G,ee,re,ne,le,de,xe){const $e=this.length;return this.resize($e+1),this.emplace($e,l,h,m,x,A,P,R,D,U,$,G,ee,re,ne,le,de,xe)}emplace(l,h,m,x,A,P,R,D,U,$,G,ee,re,ne,le,de,xe,$e){const Ie=24*l,De=12*l,et=48*l;return this.int16[Ie+0]=h,this.int16[Ie+1]=m,this.uint16[Ie+2]=x,this.uint16[Ie+3]=A,this.uint32[De+2]=P,this.uint32[De+3]=R,this.uint32[De+4]=D,this.uint16[Ie+10]=U,this.uint16[Ie+11]=$,this.uint16[Ie+12]=G,this.float32[De+7]=ee,this.float32[De+8]=re,this.uint8[et+36]=ne,this.uint8[et+37]=le,this.uint8[et+38]=de,this.uint32[De+10]=xe,this.int16[Ie+22]=$e,l}}I.prototype.bytesPerElement=48,Ht("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",I);class B extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,x,A,P,R,D,U,$,G,ee,re,ne,le,de,xe,$e,Ie,De,et,ft,St,Vt,zt,jt,rr,Ft){const Ut=this.length;return this.resize(Ut+1),this.emplace(Ut,l,h,m,x,A,P,R,D,U,$,G,ee,re,ne,le,de,xe,$e,Ie,De,et,ft,St,Vt,zt,jt,rr,Ft)}emplace(l,h,m,x,A,P,R,D,U,$,G,ee,re,ne,le,de,xe,$e,Ie,De,et,ft,St,Vt,zt,jt,rr,Ft,Ut){const yt=32*l,dr=16*l;return this.int16[yt+0]=h,this.int16[yt+1]=m,this.int16[yt+2]=x,this.int16[yt+3]=A,this.int16[yt+4]=P,this.int16[yt+5]=R,this.int16[yt+6]=D,this.int16[yt+7]=U,this.uint16[yt+8]=$,this.uint16[yt+9]=G,this.uint16[yt+10]=ee,this.uint16[yt+11]=re,this.uint16[yt+12]=ne,this.uint16[yt+13]=le,this.uint16[yt+14]=de,this.uint16[yt+15]=xe,this.uint16[yt+16]=$e,this.uint16[yt+17]=Ie,this.uint16[yt+18]=De,this.uint16[yt+19]=et,this.uint16[yt+20]=ft,this.uint16[yt+21]=St,this.uint16[yt+22]=Vt,this.uint32[dr+12]=zt,this.float32[dr+13]=jt,this.float32[dr+14]=rr,this.uint16[yt+30]=Ft,this.uint16[yt+31]=Ut,l}}B.prototype.bytesPerElement=64,Ht("StructArrayLayout8i15ui1ul2f2ui64",B);class N extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l){const h=this.length;return this.resize(h+1),this.emplace(h,l)}emplace(l,h){return this.float32[1*l+0]=h,l}}N.prototype.bytesPerElement=4,Ht("StructArrayLayout1f4",N);class H extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m){const x=this.length;return this.resize(x+1),this.emplace(x,l,h,m)}emplace(l,h,m,x){const A=3*l;return this.uint16[6*l+0]=h,this.float32[A+1]=m,this.float32[A+2]=x,l}}H.prototype.bytesPerElement=12,Ht("StructArrayLayout1ui2f12",H);class W extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h,m){const x=this.length;return this.resize(x+1),this.emplace(x,l,h,m)}emplace(l,h,m,x){const A=4*l;return this.uint32[2*l+0]=h,this.uint16[A+2]=m,this.uint16[A+3]=x,l}}W.prototype.bytesPerElement=8,Ht("StructArrayLayout1ul2ui8",W);class K extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h){const m=this.length;return this.resize(m+1),this.emplace(m,l,h)}emplace(l,h,m){const x=2*l;return this.uint16[x+0]=h,this.uint16[x+1]=m,l}}K.prototype.bytesPerElement=4,Ht("StructArrayLayout2ui4",K);class Z extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l){const h=this.length;return this.resize(h+1),this.emplace(h,l)}emplace(l,h){return this.uint16[1*l+0]=h,l}}Z.prototype.bytesPerElement=2,Ht("StructArrayLayout1ui2",Z);class te extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,x){const A=this.length;return this.resize(A+1),this.emplace(A,l,h,m,x)}emplace(l,h,m,x,A){const P=4*l;return this.float32[P+0]=h,this.float32[P+1]=m,this.float32[P+2]=x,this.float32[P+3]=A,l}}te.prototype.bytesPerElement=16,Ht("StructArrayLayout4f16",te);class oe extends Xl{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new g(this.anchorPointX,this.anchorPointY)}}oe.prototype.size=20;class me extends o{get(l){return new oe(this,l)}}Ht("CollisionBoxArray",me);class ye extends Xl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(l){this._structArray.uint8[this._pos1+37]=l}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(l){this._structArray.uint8[this._pos1+38]=l}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(l){this._structArray.uint32[this._pos4+10]=l}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ye.prototype.size=48;class _e extends I{get(l){return new ye(this,l)}}Ht("PlacedSymbolArray",_e);class be extends Xl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(l){this._structArray.uint32[this._pos4+12]=l}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}be.prototype.size=64;class Ee extends B{get(l){return new be(this,l)}}Ht("SymbolInstanceArray",Ee);class Te extends N{getoffsetX(l){return this.float32[1*l+0]}}Ht("GlyphOffsetArray",Te);class Oe extends bo{getx(l){return this.int16[3*l+0]}gety(l){return this.int16[3*l+1]}gettileUnitDistanceFromAnchor(l){return this.int16[3*l+2]}}Ht("SymbolLineVertexArray",Oe);class Ne extends Xl{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Ne.prototype.size=12;class Ce extends H{get(l){return new Ne(this,l)}}Ht("TextAnchorOffsetArray",Ce);class ze extends Xl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ze.prototype.size=8;class ot extends W{get(l){return new ze(this,l)}}Ht("FeatureIndexArray",ot);class tt extends Dn{}class nt extends Dn{}class lt extends Dn{}class Nt extends Pr{}class Bt extends Jr{}class Tt extends dn{}class qt extends Iu{}class wr extends Zl{}class Yr extends xo{}class xn extends Ru{}class pn extends E{}class En extends d{}class wn extends w{}class xi extends C{}class Cn extends K{}const on=an([{name:"a_pos",components:2,type:"Int16"}],4),{members:hn}=on;class Or{constructor(l=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=l}prepareSegment(l,h,m,x){const A=this.segments[this.segments.length-1];return l>Or.MAX_VERTEX_ARRAY_LENGTH&&cr(`Max vertices per segment is ${Or.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${l}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Or.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!A||A.vertexLength+l>Or.MAX_VERTEX_ARRAY_LENGTH||A.sortKey!==x?this.createNewSegment(h,m,x):A}createNewSegment(l,h,m){const x={vertexOffset:l.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0,vaos:{}};return m!==void 0&&(x.sortKey=m),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(x),x}getOrCreateLatestSegment(l,h,m){return this.prepareSegment(0,l,h,m)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const l of this.segments)for(const h in l.vaos)l.vaos[h].destroy()}static simpleSegment(l,h,m,x){return new Or([{vertexOffset:l,primitiveOffset:h,vertexLength:m,primitiveLength:x,vaos:{},sortKey:0}])}}function wi(f,l){return 256*(f=$t(Math.floor(f),0,255))+$t(Math.floor(l),0,255)}Or.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ht("SegmentVector",Or);const _a=an([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Yl=an([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var wo,Fc,Ou,Ko={exports:{}},Kl={exports:{}},Ws={exports:{}},Qo=(function(){if(Ou)return Ko.exports;Ou=1;var f=(wo||(wo=1,Kl.exports=function(h,m){var x,A,P,R,D,U,$,G;for(A=h.length-(x=3&h.length),P=m,D=3432918353,U=461845907,G=0;G<A;)$=255&h.charCodeAt(G)|(255&h.charCodeAt(++G))<<8|(255&h.charCodeAt(++G))<<16|(255&h.charCodeAt(++G))<<24,++G,P=27492+(65535&(R=5*(65535&(P=(P^=$=(65535&($=($=(65535&$)*D+((($>>>16)*D&65535)<<16)&4294967295)<<15|$>>>17))*U+((($>>>16)*U&65535)<<16)&4294967295)<<13|P>>>19))+((5*(P>>>16)&65535)<<16)&4294967295))+((58964+(R>>>16)&65535)<<16);switch($=0,x){case 3:$^=(255&h.charCodeAt(G+2))<<16;case 2:$^=(255&h.charCodeAt(G+1))<<8;case 1:P^=$=(65535&($=($=(65535&($^=255&h.charCodeAt(G)))*D+((($>>>16)*D&65535)<<16)&4294967295)<<15|$>>>17))*U+((($>>>16)*U&65535)<<16)&4294967295}return P^=h.length,P=2246822507*(65535&(P^=P>>>16))+((2246822507*(P>>>16)&65535)<<16)&4294967295,P=3266489909*(65535&(P^=P>>>13))+((3266489909*(P>>>16)&65535)<<16)&4294967295,(P^=P>>>16)>>>0}),Kl.exports),l=(Fc||(Fc=1,Ws.exports=function(h,m){for(var x,A=h.length,P=m^A,R=0;A>=4;)x=1540483477*(65535&(x=255&h.charCodeAt(R)|(255&h.charCodeAt(++R))<<8|(255&h.charCodeAt(++R))<<16|(255&h.charCodeAt(++R))<<24))+((1540483477*(x>>>16)&65535)<<16),P=1540483477*(65535&P)+((1540483477*(P>>>16)&65535)<<16)^(x=1540483477*(65535&(x^=x>>>24))+((1540483477*(x>>>16)&65535)<<16)),A-=4,++R;switch(A){case 3:P^=(255&h.charCodeAt(R+2))<<16;case 2:P^=(255&h.charCodeAt(R+1))<<8;case 1:P=1540483477*(65535&(P^=255&h.charCodeAt(R)))+((1540483477*(P>>>16)&65535)<<16)}return P=1540483477*(65535&(P^=P>>>13))+((1540483477*(P>>>16)&65535)<<16),(P^=P>>>15)>>>0}),Ws.exports);return Ko.exports=f,Ko.exports.murmur3=f,Ko.exports.murmur2=l,Ko.exports})(),ja=_(Qo);class Jo{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(l,h,m,x){this.ids.push(ai(l)),this.positions.push(h,m,x)}getPositions(l){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const h=ai(l);let m=0,x=this.ids.length-1;for(;m<x;){const P=m+x>>1;this.ids[P]>=h?x=P:m=P+1}const A=[];for(;this.ids[m]===h;)A.push({index:this.positions[3*m],start:this.positions[3*m+1],end:this.positions[3*m+2]}),m++;return A}static serialize(l,h){const m=new Float64Array(l.ids),x=new Uint32Array(l.positions);return ti(m,x,0,m.length-1),h&&h.push(m.buffer,x.buffer),{ids:m,positions:x}}static deserialize(l){const h=new Jo;return h.ids=l.ids,h.positions=l.positions,h.indexed=!0,h}}function ai(f){const l=+f;return!isNaN(l)&&l<=Number.MAX_SAFE_INTEGER?l:ja(String(f))}function ti(f,l,h,m){for(;h<m;){const x=f[h+m>>1];let A=h-1,P=m+1;for(;;){do A++;while(f[A]<x);do P--;while(f[P]>x);if(A>=P)break;ls(f,A,P),ls(l,3*A,3*P),ls(l,3*A+1,3*P+1),ls(l,3*A+2,3*P+2)}P-h<m-P?(ti(f,l,h,P),h=P+1):(ti(f,l,P+1,m),m=P)}}function ls(f,l,h){const m=f[l];f[l]=f[h],f[h]=m}Ht("FeaturePositionMap",Jo);class Tn{constructor(l,h){this.gl=l.gl,this.location=h}}class Jf extends Tn{constructor(l,h){super(l,h),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class ed extends Tn{constructor(l,h){super(l,h),this.current=[0,0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3]))}}class vp extends Tn{constructor(l,h){super(l,h),this.current=Lr.transparent}set(l){l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a))}}const im=new Float32Array(16);function Wh(f){return[wi(255*f.r,255*f.g),wi(255*f.b,255*f.a)]}class ku{constructor(l,h,m){this.value=l,this.uniformNames=h.map((x=>`u_${x}`)),this.type=m}setUniform(l,h,m){l.set(m.constantOr(this.value))}getBinding(l,h,m){return this.type==="color"?new vp(l,h):new Jf(l,h)}}class qs{constructor(l,h){this.uniformNames=h.map((m=>`u_${m}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(l,h){this.pixelRatioFrom=h.pixelRatio,this.pixelRatioTo=l.pixelRatio,this.patternFrom=h.tlbr,this.patternTo=l.tlbr}setConstantDashPositions(l,h){this.dashTo=[0,l.y,l.height,l.width],this.dashFrom=[0,h.y,h.height,h.width]}setUniform(l,h,m,x){let A=null;x==="u_pattern_to"?A=this.patternTo:x==="u_pattern_from"?A=this.patternFrom:x==="u_dasharray_to"?A=this.dashTo:x==="u_dasharray_from"?A=this.dashFrom:x==="u_pixel_ratio_to"?A=this.pixelRatioTo:x==="u_pixel_ratio_from"&&(A=this.pixelRatioFrom),A!==null&&l.set(A)}getBinding(l,h,m){return m.substr(0,9)==="u_pattern"||m.substr(0,12)==="u_dasharray_"?new ed(l,h):new Jf(l,h)}}class To{constructor(l,h,m,x){this.expression=l,this.type=m,this.maxValue=0,this.paintVertexAttributes=h.map((A=>({name:`a_${A}`,type:"Float32",components:m==="color"?2:1,offset:0}))),this.paintVertexArray=new x}populatePaintArray(l,h,m){const x=this.paintVertexArray.length,A=this.expression.evaluate(new Qr(0,m),h,{},m.canonical,[],m.formattedSection);this.paintVertexArray.resize(l),this._setPaintValue(x,l,A)}updatePaintArray(l,h,m,x,A){const P=this.expression.evaluate(new Qr(0,A),m,x);this._setPaintValue(l,h,P)}_setPaintValue(l,h,m){if(this.type==="color"){const x=Wh(m);for(let A=l;A<h;A++)this.paintVertexArray.emplace(A,x[0],x[1])}else{for(let x=l;x<h;x++)this.paintVertexArray.emplace(x,m);this.maxValue=Math.max(this.maxValue,Math.abs(m))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class va{constructor(l,h,m,x,A,P){this.expression=l,this.uniformNames=h.map((R=>`u_${R}_t`)),this.type=m,this.useIntegerZoom=x,this.zoom=A,this.maxValue=0,this.paintVertexAttributes=h.map((R=>({name:`a_${R}`,type:"Float32",components:m==="color"?4:2,offset:0}))),this.paintVertexArray=new P}populatePaintArray(l,h,m){const x=this.expression.evaluate(new Qr(this.zoom,m),h,{},m.canonical,[],m.formattedSection),A=this.expression.evaluate(new Qr(this.zoom+1,m),h,{},m.canonical,[],m.formattedSection),P=this.paintVertexArray.length;this.paintVertexArray.resize(l),this._setPaintValue(P,l,x,A)}updatePaintArray(l,h,m,x,A){const P=this.expression.evaluate(new Qr(this.zoom,A),m,x),R=this.expression.evaluate(new Qr(this.zoom+1,A),m,x);this._setPaintValue(l,h,P,R)}_setPaintValue(l,h,m,x){if(this.type==="color"){const A=Wh(m),P=Wh(x);for(let R=l;R<h;R++)this.paintVertexArray.emplace(R,A[0],A[1],P[0],P[1])}else{for(let A=l;A<h;A++)this.paintVertexArray.emplace(A,m,x);this.maxValue=Math.max(this.maxValue,Math.abs(m),Math.abs(x))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(l,h){const m=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,x=$t(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);l.set(x)}getBinding(l,h,m){return new Jf(l,h)}}class So{constructor(l,h,m,x,A,P){this.expression=l,this.type=h,this.useIntegerZoom=m,this.zoom=x,this.layerId=P,this.zoomInPaintVertexArray=new A,this.zoomOutPaintVertexArray=new A}populatePaintArray(l,h,m){const x=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(l),this.zoomOutPaintVertexArray.resize(l),this._setPaintValues(x,l,this.getPositionIds(h),m)}updatePaintArray(l,h,m,x,A){this._setPaintValues(l,h,this.getPositionIds(m),A)}_setPaintValues(l,h,m,x){const A=this.getPositions(x);if(!A||!m)return;const P=A[m.min],R=A[m.mid],D=A[m.max];if(P&&R&&D)for(let U=l;U<h;U++)this.emplace(this.zoomInPaintVertexArray,U,R,P),this.emplace(this.zoomOutPaintVertexArray,U,R,D)}upload(l){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const h=this.getVertexAttributes();this.zoomInPaintVertexBuffer=l.createVertexBuffer(this.zoomInPaintVertexArray,h,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=l.createVertexBuffer(this.zoomOutPaintVertexArray,h,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ql extends So{getPositions(l){return l.imagePositions}getPositionIds(l){return l.patterns&&l.patterns[this.layerId]}getVertexAttributes(){return _a.members}emplace(l,h,m,x){l.emplace(h,m.tlbr[0],m.tlbr[1],m.tlbr[2],m.tlbr[3],x.tlbr[0],x.tlbr[1],x.tlbr[2],x.tlbr[3],m.pixelRatio,x.pixelRatio)}}class qh extends So{getPositions(l){return l.dashPositions}getPositionIds(l){return l.dashes&&l.dashes[this.layerId]}getVertexAttributes(){return Yl.members}emplace(l,h,m,x){l.emplace(h,0,m.y,m.height,m.width,0,x.y,x.height,x.width)}}class Uc{constructor(l,h,m){this.binders={},this._buffers=[];const x=[];for(const A in l.paint._values){if(!m(A))continue;const P=l.paint.get(A);if(!(P instanceof Vs&&lo(P.property.specification)))continue;const R=P0(A,l.type),D=P.value,U=P.property.specification.type,$=P.property.useIntegerZoom,G=P.property.specification["property-type"],ee=G==="cross-faded"||G==="cross-faded-data-driven";if(D.kind==="constant")this.binders[A]=ee?new qs(D.value,R):new ku(D.value,R,U),x.push(`/u_${A}`);else if(D.kind==="source"||ee){const re=td(A,U,"source");this.binders[A]=ee?A==="line-dasharray"?new qh(D,U,$,h,re,l.id):new Ql(D,U,$,h,re,l.id):new To(D,R,U,re),x.push(`/a_${A}`)}else{const re=td(A,U,"composite");this.binders[A]=new va(D,R,U,$,h,re),x.push(`/z_${A}`)}}this.cacheKey=x.sort().join("")}getMaxValue(l){const h=this.binders[l];return h instanceof To||h instanceof va?h.maxValue:0}populatePaintArrays(l,h,m){for(const x in this.binders){const A=this.binders[x];(A instanceof To||A instanceof va||A instanceof So)&&A.populatePaintArray(l,h,m)}}setConstantPatternPositions(l,h){for(const m in this.binders){const x=this.binders[m];x instanceof qs&&x.setConstantPatternPositions(l,h)}}setConstantDashPositions(l,h){for(const m in this.binders){const x=this.binders[m];x instanceof qs&&x.setConstantDashPositions(l,h)}}updatePaintArrays(l,h,m,x,A){let P=!1;for(const R in l){const D=h.getPositions(R);for(const U of D){const $=m.feature(U.index);for(const G in this.binders){const ee=this.binders[G];if((ee instanceof To||ee instanceof va||ee instanceof So)&&ee.expression.isStateDependent===!0){const re=x.paint.get(G);ee.expression=re.value,ee.updatePaintArray(U.start,U.end,$,l[R],A),P=!0}}}}return P}defines(){const l=[];for(const h in this.binders){const m=this.binders[h];(m instanceof ku||m instanceof qs)&&l.push(...m.uniformNames.map((x=>`#define HAS_UNIFORM_${x}`)))}return l}getBinderAttributes(){const l=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof To||m instanceof va)for(let x=0;x<m.paintVertexAttributes.length;x++)l.push(m.paintVertexAttributes[x].name);else if(m instanceof So){const x=m.getVertexAttributes();for(const A of x)l.push(A.name)}}return l}getBinderUniforms(){const l=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof ku||m instanceof qs||m instanceof va)for(const x of m.uniformNames)l.push(x)}return l}getPaintVertexBuffers(){return this._buffers}getUniforms(l,h){const m=[];for(const x in this.binders){const A=this.binders[x];if(A instanceof ku||A instanceof qs||A instanceof va){for(const P of A.uniformNames)if(h[P]){const R=A.getBinding(l,h[P],P);m.push({name:P,property:x,binding:R})}}}return m}setUniforms(l,h,m,x){for(const{name:A,property:P,binding:R}of h)this.binders[P].setUniform(R,x,m.get(P),A)}updatePaintBuffers(l){this._buffers=[];for(const h in this.binders){const m=this.binders[h];if(l&&m instanceof So){const x=l.fromScale===2?m.zoomInPaintVertexBuffer:m.zoomOutPaintVertexBuffer;x&&this._buffers.push(x)}else(m instanceof To||m instanceof va)&&m.paintVertexBuffer&&this._buffers.push(m.paintVertexBuffer)}}upload(l){for(const h in this.binders){const m=this.binders[h];(m instanceof To||m instanceof va||m instanceof So)&&m.upload(l)}this.updatePaintBuffers()}destroy(){for(const l in this.binders){const h=this.binders[l];(h instanceof To||h instanceof va||h instanceof So)&&h.destroy()}}}class Du{constructor(l,h,m=()=>!0){this.programConfigurations={};for(const x of l)this.programConfigurations[x.id]=new Uc(x,h,m);this.needsUpload=!1,this._featureMap=new Jo,this._bufferOffset=0}populatePaintArrays(l,h,m,x){for(const A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(l,h,x);h.id!==void 0&&this._featureMap.add(h.id,m,this._bufferOffset,l),this._bufferOffset=l,this.needsUpload=!0}updatePaintArrays(l,h,m,x){for(const A of m)this.needsUpload=this.programConfigurations[A.id].updatePaintArrays(l,this._featureMap,h,A,x)||this.needsUpload}get(l){return this.programConfigurations[l]}upload(l){if(this.needsUpload){for(const h in this.programConfigurations)this.programConfigurations[h].upload(l);this.needsUpload=!1}}destroy(){for(const l in this.programConfigurations)this.programConfigurations[l].destroy()}}function P0(f,l){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[f]||[f.replace(`${l}-`,"").replace(/-/g,"_")]}function td(f,l,h){const m={color:{source:dn,composite:te},number:{source:N,composite:dn}},x=(function(A){return{"line-pattern":{source:qt,composite:qt},"fill-pattern":{source:qt,composite:qt},"fill-extrusion-pattern":{source:qt,composite:qt},"line-dasharray":{source:wr,composite:wr}}[A]})(f);return x&&x[h]||m[l][h]}Ht("ConstantBinder",ku),Ht("CrossFadedConstantBinder",qs),Ht("SourceExpressionBinder",To),Ht("CrossFadedPatternBinder",Ql),Ht("CrossFadedDasharrayBinder",qh),Ht("CompositeExpressionBinder",va),Ht("ProgramConfiguration",Uc,{omit:["_buffers"]}),Ht("ProgramConfigurationSet",Du);const sm=Math.pow(2,14)-1,am=-sm-1;function Lu(f){const l=Ue/f.extent,h=f.loadGeometry();for(let m=0;m<h.length;m++){const x=h[m];for(let A=0;A<x.length;A++){const P=x[A],R=Math.round(P.x*l),D=Math.round(P.y*l);P.x=$t(R,am,sm),P.y=$t(D,am,sm),(R<P.x||R>P.x+1||D<P.y||D>P.y+1)&&cr("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return h}function jc(f,l){return{type:f.type,id:f.id,properties:f.properties,geometry:l?Lu(f):[]}}const om=-32768;function M0(f,l,h,m,x){f.emplaceBack(om+8*l+m,om+8*h+x)}class lm{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map((h=>h.id)),this.index=l.index,this.hasDependencies=!1,this.layoutVertexArray=new nt,this.indexArray=new xi,this.segments=new Or,this.programConfigurations=new Du(l.layers,l.zoom),this.stateDependentLayerIds=this.layers.filter((h=>h.isStateDependent())).map((h=>h.id))}populate(l,h,m){const x=this.layers[0],A=[];let P=null,R=!1,D=x.type==="heatmap";if(x.type==="circle"){const $=x;P=$.layout.get("circle-sort-key"),R=!P.isConstant(),D=D||$.paint.get("circle-pitch-alignment")==="map"}const U=D?h.subdivisionGranularity.circle:1;for(const{feature:$,id:G,index:ee,sourceLayerIndex:re}of l){const ne=this.layers[0]._featureFilter.needGeometry,le=jc($,ne);if(!this.layers[0]._featureFilter.filter(new Qr(this.zoom),le,m))continue;const de=R?P.evaluate(le,{},m):void 0,xe={id:G,properties:$.properties,type:$.type,sourceLayerIndex:re,index:ee,geometry:ne?le.geometry:Lu($),patterns:{},sortKey:de};A.push(xe)}R&&A.sort((($,G)=>$.sortKey-G.sortKey));for(const $ of A){const{geometry:G,index:ee,sourceLayerIndex:re}=$,ne=l[ee].feature;this.addFeature($,G,ee,m,U),h.featureIndex.insert(ne,G,ee,re,this.index)}}update(l,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,h,this.stateDependentLayers,{imagePositions:m})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,hn),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(l,h,m,x,A=1){let P;switch(A){case 1:P=[0,7];break;case 3:P=[0,2,5,7];break;case 5:P=[0,1,3,4,6,7];break;case 7:P=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${A}; valid values are 1, 3, 5, 7.`)}const R=P.length;for(const D of h)for(const U of D){const $=U.x,G=U.y;if($<0||$>=Ue||G<0||G>=Ue)continue;const ee=this.segments.prepareSegment(R*R,this.layoutVertexArray,this.indexArray,l.sortKey),re=ee.vertexLength;for(let ne=0;ne<R;ne++)for(let le=0;le<R;le++)M0(this.layoutVertexArray,$,G,P[le],P[ne]);for(let ne=0;ne<R-1;ne++)for(let le=0;le<R-1;le++){const de=re+ne*R+le,xe=re+(ne+1)*R+le;this.indexArray.emplaceBack(de,xe+1,de+1),this.indexArray.emplaceBack(de,xe,xe+1)}ee.vertexLength+=R*R,ee.primitiveLength+=(R-1)*(R-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,m,{imagePositions:{},canonical:x})}}function Bu(f,l){for(let h=0;h<f.length;h++)if(nd(l,f[h]))return!0;for(let h=0;h<l.length;h++)if(nd(f,l[h]))return!0;return!!rd(f,l)}function bp(f,l,h){return!!nd(f,l)||!!xp(l,f,h)}function t_(f,l){if(f.length===1)return n_(l,f[0]);for(let h=0;h<l.length;h++){const m=l[h];for(let x=0;x<m.length;x++)if(nd(f,m[x]))return!0}for(let h=0;h<f.length;h++)if(n_(l,f[h]))return!0;for(let h=0;h<l.length;h++)if(rd(f,l[h]))return!0;return!1}function I0(f,l,h){if(f.length>1){if(rd(f,l))return!0;for(let m=0;m<l.length;m++)if(xp(l[m],f,h))return!0}for(let m=0;m<f.length;m++)if(xp(f[m],l,h))return!0;return!1}function rd(f,l){if(f.length===0||l.length===0)return!1;for(let h=0;h<f.length-1;h++){const m=f[h],x=f[h+1];for(let A=0;A<l.length-1;A++)if(R0(m,x,l[A],l[A+1]))return!0}return!1}function R0(f,l,h,m){return or(f,h,m)!==or(l,h,m)&&or(f,l,h)!==or(f,l,m)}function xp(f,l,h){const m=h*h;if(l.length===1)return f.distSqr(l[0])<m;for(let x=1;x<l.length;x++)if(r_(f,l[x-1],l[x])<m)return!0;return!1}function r_(f,l,h){const m=l.distSqr(h);if(m===0)return f.distSqr(l);const x=((f.x-l.x)*(h.x-l.x)+(f.y-l.y)*(h.y-l.y))/m;return f.distSqr(x<0?l:x>1?h:h.sub(l)._mult(x)._add(l))}function n_(f,l){let h,m,x,A=!1;for(let P=0;P<f.length;P++){h=f[P];for(let R=0,D=h.length-1;R<h.length;D=R++)m=h[R],x=h[D],m.y>l.y!=x.y>l.y&&l.x<(x.x-m.x)*(l.y-m.y)/(x.y-m.y)+m.x&&(A=!A)}return A}function nd(f,l){let h=!1;for(let m=0,x=f.length-1;m<f.length;x=m++){const A=f[m],P=f[x];A.y>l.y!=P.y>l.y&&l.x<(P.x-A.x)*(l.y-A.y)/(P.y-A.y)+A.x&&(h=!h)}return h}function i_(f,l,h){const m=h[0],x=h[2];if(f.x<m.x&&l.x<m.x||f.x>x.x&&l.x>x.x||f.y<m.y&&l.y<m.y||f.y>x.y&&l.y>x.y)return!1;const A=or(f,l,h[0]);return A!==or(f,l,h[1])||A!==or(f,l,h[2])||A!==or(f,l,h[3])}function Yn(f,l,h){const m=l.paint.get(f).value;return m.kind==="constant"?m.value:h.programConfigurations.get(l.id).getMaxValue(f)}function $i(f){return Math.sqrt(f[0]*f[0]+f[1]*f[1])}function wp(f,l,h,m,x){if(!l[0]&&!l[1])return f;const A=g.convert(l)._mult(x);h==="viewport"&&A._rotate(-m);const P=[];for(let R=0;R<f.length;R++)P.push(f[R].sub(A));return P}function O0({queryGeometry:f,size:l},h){return bp(f,h,l)}function k0({queryGeometry:f,size:l,transform:h,unwrappedTileID:m,getElevation:x},A){return bp(f,A,l*(h.projectTileCoordinates(A.x,A.y,m,x).signedDistanceFromCamera/h.cameraToCenterDistance))}function D0({queryGeometry:f,size:l,transform:h,unwrappedTileID:m,getElevation:x},A){const P=h.projectTileCoordinates(A.x,A.y,m,x).signedDistanceFromCamera,R=l*(h.cameraToCenterDistance/P);return bp(f,id(A,h,m,x),R)}function Tp({queryGeometry:f,size:l,transform:h,unwrappedTileID:m,getElevation:x},A){return bp(f,id(A,h,m,x),l)}function s_({queryGeometry:f,size:l,transform:h,unwrappedTileID:m,getElevation:x,pitchAlignment:A="map",pitchScale:P="map"},R){const D=A==="map"?P==="map"?O0:k0:P==="map"?D0:Tp,U={queryGeometry:f,size:l,transform:h,unwrappedTileID:m,getElevation:x};for(const $ of R)for(const G of $)if(D(U,G))return!0;return!1}function id(f,l,h,m){const x=l.projectTileCoordinates(f.x,f.y,h,m).point;return new g((.5*x.x+.5)*l.width,(.5*-x.y+.5)*l.height)}let a_,L0;Ht("CircleBucket",lm,{omit:["layers"]});var cm={get paint(){return L0=L0||new Vi({"circle-radius":new tr(He.paint_circle["circle-radius"]),"circle-color":new tr(He.paint_circle["circle-color"]),"circle-blur":new tr(He.paint_circle["circle-blur"]),"circle-opacity":new tr(He.paint_circle["circle-opacity"]),"circle-translate":new Qt(He.paint_circle["circle-translate"]),"circle-translate-anchor":new Qt(He.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Qt(He.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Qt(He.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new tr(He.paint_circle["circle-stroke-width"]),"circle-stroke-color":new tr(He.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new tr(He.paint_circle["circle-stroke-opacity"])})},get layout(){return a_=a_||new Vi({"circle-sort-key":new tr(He.layout_circle["circle-sort-key"])})}};class o_ extends ei{constructor(l,h){super(l,cm,h)}createBucket(l){return new lm(l)}queryRadius(l){const h=l;return Yn("circle-radius",this,h)+Yn("circle-stroke-width",this,h)+$i(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:l,feature:h,featureState:m,geometry:x,transform:A,pixelsToTileUnits:P,unwrappedTileID:R,getElevation:D}){const U=wp(l,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-A.bearingInRadians,P),$=this.paint.get("circle-radius").evaluate(h,m)+this.paint.get("circle-stroke-width").evaluate(h,m),G=this.paint.get("circle-pitch-scale"),ee=this.paint.get("circle-pitch-alignment");let re,ne;return ee==="map"?(re=U,ne=$*P):(re=(function(le,de,xe,$e){return le.map((Ie=>id(Ie,de,xe,$e)))})(U,A,R,D),ne=$),s_({queryGeometry:re,size:ne,transform:A,unwrappedTileID:R,getElevation:D,pitchAlignment:ee,pitchScale:G},x)}}class l_ extends lm{}let c_;Ht("HeatmapBucket",l_,{omit:["layers"]});var B0={get paint(){return c_=c_||new Vi({"heatmap-radius":new tr(He.paint_heatmap["heatmap-radius"]),"heatmap-weight":new tr(He.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Qt(He.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Mu(He.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Qt(He.paint_heatmap["heatmap-opacity"])})}};function Sp(f,{width:l,height:h},m,x){if(x){if(x instanceof Uint8ClampedArray)x=new Uint8Array(x.buffer);else if(x.length!==l*h*m)throw new RangeError(`mismatched image size. expected: ${x.length} but got: ${l*h*m}`)}else x=new Uint8Array(l*h*m);return f.width=l,f.height=h,f.data=x,f}function um(f,{width:l,height:h},m){if(l===f.width&&h===f.height)return;const x=Sp({},{width:l,height:h},m);Ap(f,x,{x:0,y:0},{x:0,y:0},{width:Math.min(f.width,l),height:Math.min(f.height,h)},m),f.width=l,f.height=h,f.data=x.data}function Ap(f,l,h,m,x,A){if(x.width===0||x.height===0)return l;if(x.width>f.width||x.height>f.height||h.x>f.width-x.width||h.y>f.height-x.height)throw new RangeError("out of range source coordinates for image copy");if(x.width>l.width||x.height>l.height||m.x>l.width-x.width||m.y>l.height-x.height)throw new RangeError("out of range destination coordinates for image copy");const P=f.data,R=l.data;if(P===R)throw new Error("srcData equals dstData, so image is already copied");for(let D=0;D<x.height;D++){const U=((h.y+D)*f.width+h.x)*A,$=((m.y+D)*l.width+m.x)*A;for(let G=0;G<x.width*A;G++)R[$+G]=P[U+G]}return l}class sd{constructor(l,h){Sp(this,l,1,h)}resize(l){um(this,l,1)}clone(){return new sd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,h,m,x,A){Ap(l,h,m,x,A,1)}}class xs{constructor(l,h){Sp(this,l,4,h)}resize(l){um(this,l,4)}replace(l,h){h?this.data.set(l):this.data=l instanceof Uint8ClampedArray?new Uint8Array(l.buffer):l}clone(){return new xs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,h,m,x,A){Ap(l,h,m,x,A,4)}setPixel(l,h,m){const x=4*(l*this.width+h);this.data[x+0]=Math.round(255*m.r/m.a),this.data[x+1]=Math.round(255*m.g/m.a),this.data[x+2]=Math.round(255*m.b/m.a),this.data[x+3]=Math.round(255*m.a)}}function Ep(f){const l={},h=f.resolution||256,m=f.clips?f.clips.length:1,x=f.image||new xs({width:h,height:m});if(Math.log(h)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${h}`);const A=(P,R,D)=>{l[f.evaluationKey]=D;const U=f.expression.evaluate(l);x.setPixel(P/4/h,R/4,U)};if(f.clips)for(let P=0,R=0;P<m;++P,R+=4*h)for(let D=0,U=0;D<h;D++,U+=4){const $=D/(h-1),{start:G,end:ee}=f.clips[P];A(R,U,G*(1-$)+ee*$)}else for(let P=0,R=0;P<h;P++,R+=4)A(0,R,P/(h-1));return x}Ht("AlphaImage",sd),Ht("RGBAImage",xs);const Cp="big-fb";class N0 extends ei{createBucket(l){return new l_(l)}constructor(l,h){super(l,B0,h),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ep({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Cp)&&this.heatmapFbos.delete(Cp)}queryRadius(l){return Yn("heatmap-radius",this,l)}queryIntersectsFeature({queryGeometry:l,feature:h,featureState:m,geometry:x,transform:A,pixelsToTileUnits:P,unwrappedTileID:R,getElevation:D}){return s_({queryGeometry:l,size:this.paint.get("heatmap-radius").evaluate(h,m)*P,transform:A,unwrappedTileID:R,getElevation:D},x)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let hm;var z0={get paint(){return hm=hm||new Vi({"hillshade-illumination-direction":new Qt(He.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Qt(He.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Qt(He.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Qt(He.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Qt(He.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Qt(He.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Qt(He.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Qt(He.paint_hillshade["hillshade-method"])})}};class Vc extends ei{constructor(l,h){super(l,z0,h),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let l=this.paint.get("hillshade-illumination-direction").values,h=this.paint.get("hillshade-illumination-altitude").values,m=this.paint.get("hillshade-highlight-color").values,x=this.paint.get("hillshade-shadow-color").values;const A=Math.max(l.length,h.length,m.length,x.length);l=l.concat(Array(A-l.length).fill(l.at(-1))),h=h.concat(Array(A-h.length).fill(h.at(-1))),m=m.concat(Array(A-m.length).fill(m.at(-1))),x=x.concat(Array(A-x.length).fill(x.at(-1)));const P=h.map(Ei);return{directionRadians:l.map(Ei),altitudeRadians:P,shadowColor:x,highlightColor:m}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let fm;var Tw={get paint(){return fm=fm||new Vi({"color-relief-opacity":new Qt(He["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Mu(He["paint_color-relief"]["color-relief-color"])})}};class dm{constructor(l,h,m,x){this.context=l,this.format=m,this.texture=l.gl.createTexture(),this.update(h,x)}update(l,h,m){const{width:x,height:A}=l,P=!(this.size&&this.size[0]===x&&this.size[1]===A||m),{context:R}=this,{gl:D}=R;if(this.useMipmap=!!(h&&h.useMipmap),D.bindTexture(D.TEXTURE_2D,this.texture),R.pixelStoreUnpackFlipY.set(!1),R.pixelStoreUnpack.set(1),R.pixelStoreUnpackPremultiplyAlpha.set(this.format===D.RGBA&&(!h||h.premultiply!==!1)),P)this.size=[x,A],l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||Os(l)?D.texImage2D(D.TEXTURE_2D,0,this.format,this.format,D.UNSIGNED_BYTE,l):D.texImage2D(D.TEXTURE_2D,0,this.format,x,A,0,this.format,D.UNSIGNED_BYTE,l.data);else{const{x:U,y:$}=m||{x:0,y:0};l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||Os(l)?D.texSubImage2D(D.TEXTURE_2D,0,U,$,D.RGBA,D.UNSIGNED_BYTE,l):D.texSubImage2D(D.TEXTURE_2D,0,U,$,x,A,D.RGBA,D.UNSIGNED_BYTE,l.data)}this.useMipmap&&this.isSizePowerOfTwo()&&D.generateMipmap(D.TEXTURE_2D),R.pixelStoreUnpackFlipY.setDefault(),R.pixelStoreUnpack.setDefault(),R.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(l,h,m){const{context:x}=this,{gl:A}=x;A.bindTexture(A.TEXTURE_2D,this.texture),m!==A.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(m=A.LINEAR),l!==this.filter&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,l),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,m||l),this.filter=l),h!==this.wrap&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,h),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}}class Jl{constructor(l,h,m,x=1,A=1,P=1,R=0){if(this.uid=l,h.height!==h.width)throw new RangeError("DEM tiles must be square");if(m&&!["mapbox","terrarium","custom"].includes(m))return void cr(`"${m}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=h.height;const D=this.dim=h.height-2;switch(this.data=new Uint32Array(h.data.buffer),m){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=x,this.greenFactor=A,this.blueFactor=P,this.baseShift=R;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let U=0;U<D;U++)this.data[this._idx(-1,U)]=this.data[this._idx(0,U)],this.data[this._idx(D,U)]=this.data[this._idx(D-1,U)],this.data[this._idx(U,-1)]=this.data[this._idx(U,0)],this.data[this._idx(U,D)]=this.data[this._idx(U,D-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(D,-1)]=this.data[this._idx(D-1,0)],this.data[this._idx(-1,D)]=this.data[this._idx(0,D-1)],this.data[this._idx(D,D)]=this.data[this._idx(D-1,D-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let U=0;U<D;U++)for(let $=0;$<D;$++){const G=this.get(U,$);G>this.max&&(this.max=G),G<this.min&&(this.min=G)}}get(l,h){const m=new Uint8Array(this.data.buffer),x=4*this._idx(l,h);return this.unpack(m[x],m[x+1],m[x+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(l,h){if(l<-1||l>=this.dim+1||h<-1||h>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(h+1)*this.stride+(l+1)}unpack(l,h,m){return l*this.redFactor+h*this.greenFactor+m*this.blueFactor-this.baseShift}pack(l){return pm(l,this.getUnpackVector())}getPixels(){return new xs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(l,h,m){if(this.dim!==l.dim)throw new Error("dem dimension mismatch");let x=h*this.dim,A=h*this.dim+this.dim,P=m*this.dim,R=m*this.dim+this.dim;switch(h){case-1:x=A-1;break;case 1:A=x+1}switch(m){case-1:P=R-1;break;case 1:R=P+1}const D=-h*this.dim,U=-m*this.dim;for(let $=P;$<R;$++)for(let G=x;G<A;G++)this.data[this._idx(G,$)]=l.data[this._idx(G+D,$+U)]}}function pm(f,l){const h=l[0],m=l[1],x=l[2],A=l[3],P=Math.min(h,m,x),R=Math.round((f+A)/P);return{r:Math.floor(R*P/h)%256,g:Math.floor(R*P/m)%256,b:Math.floor(R*P/x)%256}}Ht("DEMData",Jl);class F0 extends ei{constructor(l,h){super(l,Tw,h)}_createColorRamp(l){const h={elevationStops:[],colorStops:[]},m=this._transitionablePaint._values["color-relief-color"].value.expression;if(m instanceof Au&&m._styleExpression.expression instanceof Fi){this.colorRampExpression=m;const P=m._styleExpression.expression;h.elevationStops=P.labels,h.colorStops=[];for(const R of h.elevationStops)h.colorStops.push(P.evaluate({globals:{elevation:R}}))}if(h.elevationStops.length<1&&(h.elevationStops=[0],h.colorStops=[Lr.transparent]),h.elevationStops.length<2&&(h.elevationStops.push(h.elevationStops[0]+1),h.colorStops.push(h.colorStops[0])),h.elevationStops.length<=l)return h;const x={elevationStops:[],colorStops:[]},A=(h.elevationStops.length-1)/(l-1);for(let P=0;P<h.elevationStops.length-.5;P+=A)x.elevationStops.push(h.elevationStops[Math.round(P)]),x.colorStops.push(h.colorStops[Math.round(P)]);return cr(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),x}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(l,h,m){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const x=this._createColorRamp(h),A=new xs({width:x.colorStops.length,height:1}),P=new xs({width:x.colorStops.length,height:1});for(let R=0;R<x.elevationStops.length;R++){const D=pm(x.elevationStops[R],m);P.setPixel(0,R,new Lr(D.r/255,D.g/255,D.b/255,1)),A.setPixel(0,R,x.colorStops[R])}return this.colorRampTextures={elevationTexture:new dm(l,P,l.gl.RGBA),colorTexture:new dm(l,A,l.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const gm=an([{name:"a_pos",components:2,type:"Int16"}],4),{members:Pp}=gm;function Pn(f,l,h){const m=h.patternDependencies;let x=!1;for(const A of l){const P=A.paint.get(`${f}-pattern`);P.isConstant()||(x=!0);const R=P.constantOr(null);R&&(x=!0,m[R.to]=!0,m[R.from]=!0)}return x}function u_(f,l,h,m,x){const{zoom:A}=m,P=x.patternDependencies;for(const R of l){const D=R.paint.get(`${f}-pattern`).value;if(D.kind!=="constant"){let U=D.evaluate({zoom:A-1},h,{},x.availableImages),$=D.evaluate({zoom:A},h,{},x.availableImages),G=D.evaluate({zoom:A+1},h,{},x.availableImages);U=U&&U.name?U.name:U,$=$&&$.name?$.name:$,G=G&&G.name?G.name:G,P[U]=!0,P[$]=!0,P[G]=!0,h.patterns[R.id]={min:U,mid:$,max:G}}}return h}function U0(f,l,h,m,x){let A;if(x===(function(P,R,D,U){let $=0;for(let G=R,ee=D-U;G<D;G+=U)$+=(P[ee]-P[G])*(P[G+1]+P[ee+1]),ee=G;return $})(f,l,h,m)>0)for(let P=l;P<h;P+=m)A=p_(P/m|0,f[P],f[P+1],A);else for(let P=h-m;P>=l;P-=m)A=p_(P/m|0,f[P],f[P+1],A);return A&&Kn(A,A.next)&&(Mn(A),A=A.next),A}function Nu(f,l){if(!f)return f;l||(l=f);let h,m=f;do if(h=!1,m.steiner||!Kn(m,m.next)&&fn(m.prev,m,m.next)!==0)m=m.next;else{if(Mn(m),m=l=m.prev,m===m.next)break;h=!0}while(h||m!==l);return l}function $c(f,l,h,m,x,A,P){if(!f)return;!P&&A&&(function(D,U,$,G){let ee=D;do ee.z===0&&(ee.z=mm(ee.x,ee.y,U,$,G)),ee.prevZ=ee.prev,ee.nextZ=ee.next,ee=ee.next;while(ee!==D);ee.prevZ.nextZ=null,ee.prevZ=null,(function(re){let ne,le=1;do{let de,xe=re;re=null;let $e=null;for(ne=0;xe;){ne++;let Ie=xe,De=0;for(let ft=0;ft<le&&(De++,Ie=Ie.nextZ,Ie);ft++);let et=le;for(;De>0||et>0&&Ie;)De!==0&&(et===0||!Ie||xe.z<=Ie.z)?(de=xe,xe=xe.nextZ,De--):(de=Ie,Ie=Ie.nextZ,et--),$e?$e.nextZ=de:re=de,de.prevZ=$e,$e=de;xe=Ie}$e.nextZ=null,le*=2}while(ne>1)})(ee)})(f,m,x,A);let R=f;for(;f.prev!==f.next;){const D=f.prev,U=f.next;if(A?j0(f,m,x,A):zu(f))l.push(D.i,f.i,U.i),Mn(f),f=U.next,R=U.next;else if((f=U)===R){P?P===1?$c(f=V0(Nu(f),l),l,h,m,x,A,2):P===2&&Mp(f,l,h,m,x,A):$c(Nu(f),l,h,m,x,A,1);break}}}function zu(f){const l=f.prev,h=f,m=f.next;if(fn(l,h,m)>=0)return!1;const x=l.x,A=h.x,P=m.x,R=l.y,D=h.y,U=m.y,$=Math.min(x,A,P),G=Math.min(R,D,U),ee=Math.max(x,A,P),re=Math.max(R,D,U);let ne=m.next;for(;ne!==l;){if(ne.x>=$&&ne.x<=ee&&ne.y>=G&&ne.y<=re&&Fu(x,R,A,D,P,U,ne.x,ne.y)&&fn(ne.prev,ne,ne.next)>=0)return!1;ne=ne.next}return!0}function j0(f,l,h,m){const x=f.prev,A=f,P=f.next;if(fn(x,A,P)>=0)return!1;const R=x.x,D=A.x,U=P.x,$=x.y,G=A.y,ee=P.y,re=Math.min(R,D,U),ne=Math.min($,G,ee),le=Math.max(R,D,U),de=Math.max($,G,ee),xe=mm(re,ne,l,h,m),$e=mm(le,de,l,h,m);let Ie=f.prevZ,De=f.nextZ;for(;Ie&&Ie.z>=xe&&De&&De.z<=$e;){if(Ie.x>=re&&Ie.x<=le&&Ie.y>=ne&&Ie.y<=de&&Ie!==x&&Ie!==P&&Fu(R,$,D,G,U,ee,Ie.x,Ie.y)&&fn(Ie.prev,Ie,Ie.next)>=0||(Ie=Ie.prevZ,De.x>=re&&De.x<=le&&De.y>=ne&&De.y<=de&&De!==x&&De!==P&&Fu(R,$,D,G,U,ee,De.x,De.y)&&fn(De.prev,De,De.next)>=0))return!1;De=De.nextZ}for(;Ie&&Ie.z>=xe;){if(Ie.x>=re&&Ie.x<=le&&Ie.y>=ne&&Ie.y<=de&&Ie!==x&&Ie!==P&&Fu(R,$,D,G,U,ee,Ie.x,Ie.y)&&fn(Ie.prev,Ie,Ie.next)>=0)return!1;Ie=Ie.prevZ}for(;De&&De.z<=$e;){if(De.x>=re&&De.x<=le&&De.y>=ne&&De.y<=de&&De!==x&&De!==P&&Fu(R,$,D,G,U,ee,De.x,De.y)&&fn(De.prev,De,De.next)>=0)return!1;De=De.nextZ}return!0}function V0(f,l){let h=f;do{const m=h.prev,x=h.next.next;!Kn(m,x)&&_m(m,h,h.next,x)&&Rp(m,x)&&Rp(x,m)&&(l.push(m.i,h.i,x.i),Mn(h),Mn(h.next),h=f=x),h=h.next}while(h!==f);return Nu(h)}function Mp(f,l,h,m,x,A){let P=f;do{let R=P.next.next;for(;R!==P.prev;){if(P.i!==R.i&&H0(P,R)){let D=d_(P,R);return P=Nu(P,P.next),D=Nu(D,D.next),$c(P,l,h,m,x,A,0),void $c(D,l,h,m,x,A,0)}R=R.next}P=P.next}while(P!==f)}function ec(f,l){let h=f.x-l.x;return h===0&&(h=f.y-l.y,h===0)&&(h=(f.next.y-f.y)/(f.next.x-f.x)-(l.next.y-l.y)/(l.next.x-l.x)),h}function $0(f,l){const h=(function(x,A){let P=A;const R=x.x,D=x.y;let U,$=-1/0;if(Kn(x,P))return P;do{if(Kn(x,P.next))return P.next;if(D<=P.y&&D>=P.next.y&&P.next.y!==P.y){const le=P.x+(D-P.y)*(P.next.x-P.x)/(P.next.y-P.y);if(le<=R&&le>$&&($=le,U=P.x<P.next.x?P:P.next,le===R))return U}P=P.next}while(P!==A);if(!U)return null;const G=U,ee=U.x,re=U.y;let ne=1/0;P=U;do{if(R>=P.x&&P.x>=ee&&R!==P.x&&ym(D<re?R:$,D,ee,re,D<re?$:R,D,P.x,P.y)){const le=Math.abs(D-P.y)/(R-P.x);Rp(P,x)&&(le<ne||le===ne&&(P.x>U.x||P.x===U.x&&h_(U,P)))&&(U=P,ne=le)}P=P.next}while(P!==G);return U})(f,l);if(!h)return l;const m=d_(h,f);return Nu(m,m.next),Nu(h,h.next)}function h_(f,l){return fn(f.prev,f,l.prev)<0&&fn(l.next,f,f.next)<0}function mm(f,l,h,m,x){return(f=1431655765&((f=858993459&((f=252645135&((f=16711935&((f=(f-h)*x|0)|f<<8))|f<<4))|f<<2))|f<<1))|(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-m)*x|0)|l<<8))|l<<4))|l<<2))|l<<1))<<1}function f_(f){let l=f,h=f;do(l.x<h.x||l.x===h.x&&l.y<h.y)&&(h=l),l=l.next;while(l!==f);return h}function ym(f,l,h,m,x,A,P,R){return(x-P)*(l-R)>=(f-P)*(A-R)&&(f-P)*(m-R)>=(h-P)*(l-R)&&(h-P)*(A-R)>=(x-P)*(m-R)}function Fu(f,l,h,m,x,A,P,R){return!(f===P&&l===R)&&ym(f,l,h,m,x,A,P,R)}function H0(f,l){return f.next.i!==l.i&&f.prev.i!==l.i&&!(function(h,m){let x=h;do{if(x.i!==h.i&&x.next.i!==h.i&&x.i!==m.i&&x.next.i!==m.i&&_m(x,x.next,h,m))return!0;x=x.next}while(x!==h);return!1})(f,l)&&(Rp(f,l)&&Rp(l,f)&&(function(h,m){let x=h,A=!1;const P=(h.x+m.x)/2,R=(h.y+m.y)/2;do x.y>R!=x.next.y>R&&x.next.y!==x.y&&P<(x.next.x-x.x)*(R-x.y)/(x.next.y-x.y)+x.x&&(A=!A),x=x.next;while(x!==h);return A})(f,l)&&(fn(f.prev,f,l.prev)||fn(f,l.prev,l))||Kn(f,l)&&fn(f.prev,f,f.next)>0&&fn(l.prev,l,l.next)>0)}function fn(f,l,h){return(l.y-f.y)*(h.x-l.x)-(l.x-f.x)*(h.y-l.y)}function Kn(f,l){return f.x===l.x&&f.y===l.y}function _m(f,l,h,m){const x=ki(fn(f,l,h)),A=ki(fn(f,l,m)),P=ki(fn(h,m,f)),R=ki(fn(h,m,l));return x!==A&&P!==R||!(x!==0||!Ip(f,h,l))||!(A!==0||!Ip(f,m,l))||!(P!==0||!Ip(h,f,m))||!(R!==0||!Ip(h,l,m))}function Ip(f,l,h){return l.x<=Math.max(f.x,h.x)&&l.x>=Math.min(f.x,h.x)&&l.y<=Math.max(f.y,h.y)&&l.y>=Math.min(f.y,h.y)}function ki(f){return f>0?1:f<0?-1:0}function Rp(f,l){return fn(f.prev,f,f.next)<0?fn(f,l,f.next)>=0&&fn(f,f.prev,l)>=0:fn(f,l,f.prev)<0||fn(f,f.next,l)<0}function d_(f,l){const h=Gs(f.i,f.x,f.y),m=Gs(l.i,l.x,l.y),x=f.next,A=l.prev;return f.next=l,l.prev=f,h.next=x,x.prev=h,m.next=h,h.prev=m,A.next=m,m.prev=A,m}function p_(f,l,h,m){const x=Gs(f,l,h);return m?(x.next=m.next,x.prev=m,m.next.prev=x,m.next=x):(x.prev=x,x.next=x),x}function Mn(f){f.next.prev=f.prev,f.prev.next=f.next,f.prevZ&&(f.prevZ.nextZ=f.nextZ),f.nextZ&&(f.nextZ.prevZ=f.prevZ)}function Gs(f,l,h){return{i:f,x:l,y:h,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class ba{constructor(l,h){if(h>l)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=l,this._minGranularity=h}getGranularityForZoomLevel(l){return Math.max(Math.floor(this._baseZoomGranularity/(1<<l)),this._minGranularity,1)}}class Op{constructor(l){this.fill=l.fill,this.line=l.line,this.tile=l.tile,this.stencil=l.stencil,this.circle=l.circle}}Op.noSubdivision=new Op({fill:new ba(0,0),line:new ba(0,0),tile:new ba(0,0),stencil:new ba(0,0),circle:1}),Ht("SubdivisionGranularityExpression",ba),Ht("SubdivisionGranularitySetting",Op);const Gh=-32768,ad=32767;class Sw{constructor(l,h){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=l,this._granularityCellSize=Ue/l,this._canonical=h}_getKey(l,h){return(l+=32768)<<16|h+32768}_vertexToIndex(l,h){if(l<-32768||h<-32768||l>32767||h>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const m=0|Math.round(l),x=0|Math.round(h),A=this._getKey(m,x);if(this._vertexDictionary.has(A))return this._vertexDictionary.get(A);const P=this._vertexBuffer.length/2;return this._vertexDictionary.set(A,P),this._vertexBuffer.push(m,x),P}_subdivideTrianglesScanline(l){if(this._granularity<2)return(function(x,A){const P=[];for(let R=0;R<A.length;R+=3){const D=A[R],U=A[R+1],$=A[R+2],G=x[2*D],ee=x[2*D+1];(x[2*U]-G)*(x[2*$+1]-ee)-(x[2*U+1]-ee)*(x[2*$]-G)>0?(P.push(D),P.push($),P.push(U)):(P.push(D),P.push(U),P.push($))}return P})(this._vertexBuffer,l);const h=[],m=l.length;for(let x=0;x<m;x+=3){const A=[l[x+0],l[x+1],l[x+2]],P=[this._vertexBuffer[2*l[x+0]+0],this._vertexBuffer[2*l[x+0]+1],this._vertexBuffer[2*l[x+1]+0],this._vertexBuffer[2*l[x+1]+1],this._vertexBuffer[2*l[x+2]+0],this._vertexBuffer[2*l[x+2]+1]];let R=1/0,D=1/0,U=-1/0,$=-1/0;for(let le=0;le<3;le++){const de=P[2*le],xe=P[2*le+1];R=Math.min(R,de),U=Math.max(U,de),D=Math.min(D,xe),$=Math.max($,xe)}if(R===U||D===$)continue;const G=Math.floor(R/this._granularityCellSize),ee=Math.ceil(U/this._granularityCellSize),re=Math.floor(D/this._granularityCellSize),ne=Math.ceil($/this._granularityCellSize);if(G!==ee||re!==ne)for(let le=re;le<ne;le++){const de=this._scanlineGenerateVertexRingForCellRow(le,P,A);el(this._vertexBuffer,de,h)}else h.push(...A)}return h}_scanlineGenerateVertexRingForCellRow(l,h,m){const x=l*this._granularityCellSize,A=x+this._granularityCellSize,P=[];for(let R=0;R<3;R++){const D=h[2*R],U=h[2*R+1],$=h[2*(R+1)%6],G=h[(2*(R+1)+1)%6],ee=h[2*(R+2)%6],re=h[(2*(R+2)+1)%6],ne=$-D,le=G-U,de=ne===0,xe=le===0,$e=(x-U)/le,Ie=(A-U)/le,De=Math.min($e,Ie),et=Math.max($e,Ie);if(!xe&&(De>=1||et<=0)||xe&&(U<x||U>A)){G>=x&&G<=A&&P.push(m[(R+1)%3]);continue}!xe&&De>0&&P.push(this._vertexToIndex(D+ne*De,U+le*De));const ft=D+ne*Math.max(De,0),St=D+ne*Math.min(et,1);de||this._generateIntraEdgeVertices(P,D,U,$,G,ft,St),!xe&&et<1&&P.push(this._vertexToIndex(D+ne*et,U+le*et)),(xe||G>=x&&G<=A)&&P.push(m[(R+1)%3]),!xe&&(G<=x||G>=A)&&this._generateInterEdgeVertices(P,D,U,$,G,ee,re,St,x,A)}return P}_generateIntraEdgeVertices(l,h,m,x,A,P,R){const D=x-h,U=A-m,$=U===0,G=$?Math.min(h,x):Math.min(P,R),ee=$?Math.max(h,x):Math.max(P,R),re=Math.floor(G/this._granularityCellSize)+1,ne=Math.ceil(ee/this._granularityCellSize)-1;if($?h<x:P<R)for(let le=re;le<=ne;le++){const de=le*this._granularityCellSize;l.push(this._vertexToIndex(de,m+U*(de-h)/D))}else for(let le=ne;le>=re;le--){const de=le*this._granularityCellSize;l.push(this._vertexToIndex(de,m+U*(de-h)/D))}}_generateInterEdgeVertices(l,h,m,x,A,P,R,D,U,$){const G=A-m,ee=P-x,re=R-A,ne=(U-A)/re,le=($-A)/re,de=Math.min(ne,le),xe=Math.max(ne,le),$e=x+ee*de;let Ie=Math.floor(Math.min($e,D)/this._granularityCellSize)+1,De=Math.ceil(Math.max($e,D)/this._granularityCellSize)-1,et=D<$e;const ft=re===0;if(ft&&(R===U||R===$))return;if(ft||de>=1||xe<=0){const Vt=m-R,zt=P+(h-P)*Math.min((U-R)/Vt,($-R)/Vt);Ie=Math.floor(Math.min(zt,D)/this._granularityCellSize)+1,De=Math.ceil(Math.max(zt,D)/this._granularityCellSize)-1,et=D<zt}const St=G>0?$:U;if(et)for(let Vt=Ie;Vt<=De;Vt++)l.push(this._vertexToIndex(Vt*this._granularityCellSize,St));else for(let Vt=De;Vt>=Ie;Vt--)l.push(this._vertexToIndex(Vt*this._granularityCellSize,St))}_generateOutline(l){const h=[];for(const m of l){const x=Hi(m,this._granularity,!0),A=this._pointArrayToIndices(x),P=[];for(let R=1;R<A.length;R++)P.push(A[R-1]),P.push(A[R]);h.push(P)}return h}_handlePoles(l){let h=!1,m=!1;this._canonical&&(this._canonical.y===0&&(h=!0),this._canonical.y===(1<<this._canonical.z)-1&&(m=!0)),(h||m)&&this._fillPoles(l,h,m)}_ensureNoPoleVertices(){const l=this._vertexBuffer;for(let h=0;h<l.length;h+=2){const m=l[h+1];m===Gh&&(l[h+1]=-32767),m===ad&&(l[h+1]=32766)}}_generatePoleQuad(l,h,m,x,A,P){x>A!=(P===Gh)?(l.push(h),l.push(m),l.push(this._vertexToIndex(x,P)),l.push(m),l.push(this._vertexToIndex(A,P)),l.push(this._vertexToIndex(x,P))):(l.push(m),l.push(h),l.push(this._vertexToIndex(x,P)),l.push(this._vertexToIndex(A,P)),l.push(m),l.push(this._vertexToIndex(x,P)))}_fillPoles(l,h,m){const x=this._vertexBuffer,A=Ue,P=l.length;for(let R=2;R<P;R+=3){const D=l[R-2],U=l[R-1],$=l[R],G=x[2*D],ee=x[2*D+1],re=x[2*U],ne=x[2*U+1],le=x[2*$],de=x[2*$+1];h&&(ee===0&&ne===0&&this._generatePoleQuad(l,D,U,G,re,Gh),ne===0&&de===0&&this._generatePoleQuad(l,U,$,re,le,Gh),de===0&&ee===0&&this._generatePoleQuad(l,$,D,le,G,Gh)),m&&(ee===A&&ne===A&&this._generatePoleQuad(l,D,U,G,re,ad),ne===A&&de===A&&this._generatePoleQuad(l,U,$,re,le,ad),de===A&&ee===A&&this._generatePoleQuad(l,$,D,le,G,ad))}}_initializeVertices(l){for(let h=0;h<l.length;h+=2)this._vertexToIndex(l[h],l[h+1])}subdividePolygonInternal(l,h){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:m,holeIndices:x}=(function(R){const D=[],U=[];for(const $ of R)if($.length!==0){$!==R[0]&&D.push(U.length/2);for(let G=0;G<$.length;G++)U.push($[G].x),U.push($[G].y)}return{flattened:U,holeIndices:D}})(l);let A;this._initializeVertices(m);try{const R=(function(U,$,G=2){const ee=$&&$.length,re=ee?$[0]*G:U.length;let ne=U0(U,0,re,G,!0);const le=[];if(!ne||ne.next===ne.prev)return le;let de,xe,$e;if(ee&&(ne=(function(Ie,De,et,ft){const St=[];for(let Vt=0,zt=De.length;Vt<zt;Vt++){const jt=U0(Ie,De[Vt]*ft,Vt<zt-1?De[Vt+1]*ft:Ie.length,ft,!1);jt===jt.next&&(jt.steiner=!0),St.push(f_(jt))}St.sort(ec);for(let Vt=0;Vt<St.length;Vt++)et=$0(St[Vt],et);return et})(U,$,ne,G)),U.length>80*G){de=U[0],xe=U[1];let Ie=de,De=xe;for(let et=G;et<re;et+=G){const ft=U[et],St=U[et+1];ft<de&&(de=ft),St<xe&&(xe=St),ft>Ie&&(Ie=ft),St>De&&(De=St)}$e=Math.max(Ie-de,De-xe),$e=$e!==0?32767/$e:0}return $c(ne,le,G,de,xe,$e,0),le})(m,x),D=this._convertIndices(m,R);A=this._subdivideTrianglesScanline(D)}catch(R){console.error(R)}let P=[];return h&&(P=this._generateOutline(l)),this._ensureNoPoleVertices(),this._handlePoles(A),{verticesFlattened:this._vertexBuffer,indicesTriangles:A,indicesLineList:P}}_convertIndices(l,h){const m=[];for(let x=0;x<h.length;x++)m.push(this._vertexToIndex(l[2*h[x]],l[2*h[x]+1]));return m}_pointArrayToIndices(l){const h=[];for(let m=0;m<l.length;m++){const x=l[m];h.push(this._vertexToIndex(x.x,x.y))}return h}}function kp(f,l,h,m=!0){return new Sw(h,l).subdividePolygonInternal(f,m)}function Hi(f,l,h=!1){if(!f||f.length<1)return[];if(f.length<2)return[];const m=f[0],x=f[f.length-1],A=h&&(m.x!==x.x||m.y!==x.y);if(l<2)return A?[...f,f[0]]:[...f];const P=Math.floor(Ue/l),R=[];R.push(new g(f[0].x,f[0].y));const D=f.length,U=A?D:D-1;for(let $=0;$<U;$++){const G=f[$],ee=$<D-1?f[$+1]:f[0],re=G.x,ne=G.y,le=ee.x,de=ee.y,xe=re!==le,$e=ne!==de;if(!xe&&!$e)continue;const Ie=le-re,De=de-ne,et=Math.abs(Ie),ft=Math.abs(De);let St=re,Vt=ne;for(;;){const jt=Ie>0?(Math.floor(St/P)+1)*P:(Math.ceil(St/P)-1)*P,rr=De>0?(Math.floor(Vt/P)+1)*P:(Math.ceil(Vt/P)-1)*P,Ft=Math.abs(St-jt),Ut=Math.abs(Vt-rr),yt=Math.abs(St-le),dr=Math.abs(Vt-de),pr=xe?Ft/et:Number.POSITIVE_INFINITY,ar=$e?Ut/ft:Number.POSITIVE_INFINITY;if((yt<=Ft||!xe)&&(dr<=Ut||!$e))break;if(pr<ar&&xe||!$e){St=jt,Vt+=De*pr;const Jt=new g(St,Math.round(Vt));R[R.length-1].x===Jt.x&&R[R.length-1].y===Jt.y||R.push(Jt)}else{St+=Ie*ar,Vt=rr;const Jt=new g(Math.round(St),Vt);R[R.length-1].x===Jt.x&&R[R.length-1].y===Jt.y||R.push(Jt)}}const zt=new g(le,de);R[R.length-1].x===zt.x&&R[R.length-1].y===zt.y||R.push(zt)}return R}function el(f,l,h){if(l.length===0)throw new Error("Subdivision vertex ring is empty.");let m=0,x=f[2*l[0]];for(let D=1;D<l.length;D++){const U=f[2*l[D]];U<x&&(x=U,m=D)}const A=l.length;let P=m,R=(P+1)%A;for(;;){const D=P-1>=0?P-1:A-1,U=(R+1)%A,$=f[2*l[D]],G=f[2*l[U]],ee=f[2*l[P]],re=f[2*l[P]+1],ne=f[2*l[R]+1];let le=!1;if($<G)le=!0;else if($>G)le=!1;else{const de=ne-re,xe=-(f[2*l[R]]-ee),$e=re<ne?1:-1;(($-ee)*de+(f[2*l[D]+1]-re)*xe)*$e>((G-ee)*de+(f[2*l[U]+1]-re)*xe)*$e&&(le=!0)}if(le){const de=l[D],xe=l[P],$e=l[R];de!==xe&&de!==$e&&xe!==$e&&h.push($e,xe,de),P--,P<0&&(P=A-1)}else{const de=l[U],xe=l[P],$e=l[R];de!==xe&&de!==$e&&xe!==$e&&h.push($e,xe,de),R++,R>=A&&(R=0)}if(D===U)break}}function g_(f,l,h,m,x,A,P,R,D){const U=x.length/2,$=P&&R&&D;if(U<Or.MAX_VERTEX_ARRAY_LENGTH){const G=l.prepareSegment(U,h,m),ee=G.vertexLength;for(let le=0;le<A.length;le+=3)m.emplaceBack(ee+A[le],ee+A[le+1],ee+A[le+2]);let re,ne;G.vertexLength+=U,G.primitiveLength+=A.length/3,$&&(ne=P.prepareSegment(U,h,R),re=ne.vertexLength,ne.vertexLength+=U);for(let le=0;le<x.length;le+=2)f(x[le],x[le+1]);if($)for(let le=0;le<D.length;le++){const de=D[le];for(let xe=1;xe<de.length;xe+=2)R.emplaceBack(re+de[xe-1],re+de[xe]);ne.primitiveLength+=de.length/2}}else(function(G,ee,re,ne,le,de){const xe=[];for(let ft=0;ft<ne.length/2;ft++)xe.push(-1);const $e={count:0};let Ie=0,De=G.getOrCreateLatestSegment(ee,re),et=De.vertexLength;for(let ft=2;ft<le.length;ft+=3){const St=le[ft-2],Vt=le[ft-1],zt=le[ft];let jt=xe[St]<Ie,rr=xe[Vt]<Ie,Ft=xe[zt]<Ie;De.vertexLength+((jt?1:0)+(rr?1:0)+(Ft?1:0))>Or.MAX_VERTEX_ARRAY_LENGTH&&(De=G.createNewSegment(ee,re),Ie=$e.count,jt=!0,rr=!0,Ft=!0,et=0);const Ut=cs(xe,ne,de,$e,St,jt,De),yt=cs(xe,ne,de,$e,Vt,rr,De),dr=cs(xe,ne,de,$e,zt,Ft,De);re.emplaceBack(et+Ut-Ie,et+yt-Ie,et+dr-Ie),De.primitiveLength++}})(l,h,m,x,A,f),$&&(function(G,ee,re,ne,le,de){const xe=[];for(let ft=0;ft<ne.length/2;ft++)xe.push(-1);const $e={count:0};let Ie=0,De=G.getOrCreateLatestSegment(ee,re),et=De.vertexLength;for(let ft=0;ft<le.length;ft++){const St=le[ft];for(let Vt=1;Vt<le[ft].length;Vt+=2){const zt=St[Vt-1],jt=St[Vt];let rr=xe[zt]<Ie,Ft=xe[jt]<Ie;De.vertexLength+((rr?1:0)+(Ft?1:0))>Or.MAX_VERTEX_ARRAY_LENGTH&&(De=G.createNewSegment(ee,re),Ie=$e.count,rr=!0,Ft=!0,et=0);const Ut=cs(xe,ne,de,$e,zt,rr,De),yt=cs(xe,ne,de,$e,jt,Ft,De);re.emplaceBack(et+Ut-Ie,et+yt-Ie),De.primitiveLength++}}})(P,h,R,x,D,f),l.forceNewSegmentOnNextPrepare(),P?.forceNewSegmentOnNextPrepare()}function cs(f,l,h,m,x,A,P){if(A){const R=m.count;return h(l[2*x],l[2*x+1]),f[x]=m.count,m.count++,P.vertexLength++,R}return f[x]}class vm{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map((h=>h.id)),this.index=l.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new lt,this.indexArray=new xi,this.indexArray2=new Cn,this.programConfigurations=new Du(l.layers,l.zoom),this.segments=new Or,this.segments2=new Or,this.stateDependentLayerIds=this.layers.filter((h=>h.isStateDependent())).map((h=>h.id))}populate(l,h,m){this.hasDependencies=Pn("fill",this.layers,h);const x=this.layers[0].layout.get("fill-sort-key"),A=!x.isConstant(),P=[];for(const{feature:R,id:D,index:U,sourceLayerIndex:$}of l){const G=this.layers[0]._featureFilter.needGeometry,ee=jc(R,G);if(!this.layers[0]._featureFilter.filter(new Qr(this.zoom),ee,m))continue;const re=A?x.evaluate(ee,{},m,h.availableImages):void 0,ne={id:D,properties:R.properties,type:R.type,sourceLayerIndex:$,index:U,geometry:G?ee.geometry:Lu(R),patterns:{},sortKey:re};P.push(ne)}A&&P.sort(((R,D)=>R.sortKey-D.sortKey));for(const R of P){const{geometry:D,index:U,sourceLayerIndex:$}=R;if(this.hasDependencies){const G=u_("fill",this.layers,R,{zoom:this.zoom},h);this.patternFeatures.push(G)}else this.addFeature(R,D,U,m,{},h.subdivisionGranularity);h.featureIndex.insert(l[U].feature,D,U,$,this.index)}}update(l,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,h,this.stateDependentLayers,{imagePositions:m})}addFeatures(l,h,m){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,h,m,l.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,Pp),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.indexBuffer2=l.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(l,h,m,x,A,P){for(const R of xu(h,500)){const D=kp(R,x,P.fill.getGranularityForZoomLevel(x.z)),U=this.layoutVertexArray;g_((($,G)=>{U.emplaceBack($,G)}),this.segments,this.layoutVertexArray,this.indexArray,D.verticesFlattened,D.indicesTriangles,this.segments2,this.indexArray2,D.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,m,{imagePositions:A,canonical:x})}}let tc,Uu;Ht("FillBucket",vm,{omit:["layers","patternFeatures"]});var Hc={get paint(){return Uu=Uu||new Vi({"fill-antialias":new Qt(He.paint_fill["fill-antialias"]),"fill-opacity":new tr(He.paint_fill["fill-opacity"]),"fill-color":new tr(He.paint_fill["fill-color"]),"fill-outline-color":new tr(He.paint_fill["fill-outline-color"]),"fill-translate":new Qt(He.paint_fill["fill-translate"]),"fill-translate-anchor":new Qt(He.paint_fill["fill-translate-anchor"]),"fill-pattern":new Gl(He.paint_fill["fill-pattern"])})},get layout(){return tc=tc||new Vi({"fill-sort-key":new tr(He.layout_fill["fill-sort-key"])})}};class m_ extends ei{constructor(l,h){super(l,Hc,h)}recalculate(l,h){super.recalculate(l,h);const m=this.paint._values["fill-outline-color"];m.value.kind==="constant"&&m.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new vm(l)}queryRadius(){return $i(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:l,geometry:h,transform:m,pixelsToTileUnits:x}){return t_(wp(l,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-m.bearingInRadians,x),h)}isTileClipped(){return!0}}const y_=an([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),tl=an([{name:"a_centroid",components:2,type:"Int16"}],4),{members:W0}=y_;class rl{constructor(l,h,m,x,A){this.properties={},this.extent=m,this.type=0,this.id=void 0,this._pbf=l,this._geometry=-1,this._keys=x,this._values=A,l.readFields(Dp,this,h)}loadGeometry(){const l=this._pbf;l.pos=this._geometry;const h=l.readVarint()+l.pos,m=[];let x,A=1,P=0,R=0,D=0;for(;l.pos<h;){if(P<=0){const U=l.readVarint();A=7&U,P=U>>3}if(P--,A===1||A===2)R+=l.readSVarint(),D+=l.readSVarint(),A===1&&(x&&m.push(x),x=[]),x&&x.push(new g(R,D));else{if(A!==7)throw new Error(`unknown command ${A}`);x&&x.push(x[0].clone())}}return x&&m.push(x),m}bbox(){const l=this._pbf;l.pos=this._geometry;const h=l.readVarint()+l.pos;let m=1,x=0,A=0,P=0,R=1/0,D=-1/0,U=1/0,$=-1/0;for(;l.pos<h;){if(x<=0){const G=l.readVarint();m=7&G,x=G>>3}if(x--,m===1||m===2)A+=l.readSVarint(),P+=l.readSVarint(),A<R&&(R=A),A>D&&(D=A),P<U&&(U=P),P>$&&($=P);else if(m!==7)throw new Error(`unknown command ${m}`)}return[R,U,D,$]}toGeoJSON(l,h,m){const x=this.extent*Math.pow(2,m),A=this.extent*l,P=this.extent*h,R=this.loadGeometry();function D(ee){return[360*(ee.x+A)/x-180,360/Math.PI*Math.atan(Math.exp((1-2*(ee.y+P)/x)*Math.PI))-90]}function U(ee){return ee.map(D)}let $;if(this.type===1){const ee=[];for(const ne of R)ee.push(ne[0]);const re=U(ee);$=ee.length===1?{type:"Point",coordinates:re[0]}:{type:"MultiPoint",coordinates:re}}else if(this.type===2){const ee=R.map(U);$=ee.length===1?{type:"LineString",coordinates:ee[0]}:{type:"MultiLineString",coordinates:ee}}else{if(this.type!==3)throw new Error("unknown feature type");{const ee=(function(ne){const le=ne.length;if(le<=1)return[ne];const de=[];let xe,$e;for(let Ie=0;Ie<le;Ie++){const De=Lp(ne[Ie]);De!==0&&($e===void 0&&($e=De<0),$e===De<0?(xe&&de.push(xe),xe=[ne[Ie]]):xe&&xe.push(ne[Ie]))}return xe&&de.push(xe),de})(R),re=[];for(const ne of ee)re.push(ne.map(U));$=re.length===1?{type:"Polygon",coordinates:re[0]}:{type:"MultiPolygon",coordinates:re}}}const G={type:"Feature",geometry:$,properties:this.properties};return this.id!=null&&(G.id=this.id),G}}function Dp(f,l,h){f===1?l.id=h.readVarint():f===2?(function(m,x){const A=m.readVarint()+m.pos;for(;m.pos<A;){const P=x._keys[m.readVarint()],R=x._values[m.readVarint()];x.properties[P]=R}})(h,l):f===3?l.type=h.readVarint():f===4&&(l._geometry=h.pos)}function Lp(f){let l=0;for(let h,m,x=0,A=f.length,P=A-1;x<A;P=x++)h=f[x],m=f[P],l+=(m.x-h.x)*(h.y+m.y);return l}rl.types=["Unknown","Point","LineString","Polygon"];class Xh{constructor(l,h){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=l,this._keys=[],this._values=[],this._features=[],l.readFields(q0,this,h),this.length=this._features.length}feature(l){if(l<0||l>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[l];const h=this._pbf.readVarint()+this._pbf.pos;return new rl(this._pbf,h,this.extent,this._keys,this._values)}}function q0(f,l,h){f===15?l.version=h.readVarint():f===1?l.name=h.readString():f===5?l.extent=h.readVarint():f===2?l._features.push(h.pos):f===3?l._keys.push(h.readString()):f===4&&l._values.push((function(m){let x=null;const A=m.readVarint()+m.pos;for(;m.pos<A;){const P=m.readVarint()>>3;x=P===1?m.readString():P===2?m.readFloat():P===3?m.readDouble():P===4?m.readVarint64():P===5?m.readVarint():P===6?m.readSVarint():P===7?m.readBoolean():null}if(x==null)throw new Error("unknown feature value");return x})(h))}class __{constructor(l,h){this.layers=l.readFields(Bp,{},h)}}function Bp(f,l,h){if(f===3){const m=new Xh(h,h.readVarint()+h.pos);m.length&&(l[m.name]=m)}}const bm=Math.pow(2,13);function ju(f,l,h,m,x,A,P,R){f.emplaceBack(l,h,2*Math.floor(m*bm)+P,x*bm*2,A*bm*2,Math.round(R))}class xm{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map((h=>h.id)),this.index=l.index,this.hasDependencies=!1,this.layoutVertexArray=new Nt,this.centroidVertexArray=new tt,this.indexArray=new xi,this.programConfigurations=new Du(l.layers,l.zoom),this.segments=new Or,this.stateDependentLayerIds=this.layers.filter((h=>h.isStateDependent())).map((h=>h.id))}populate(l,h,m){this.features=[],this.hasDependencies=Pn("fill-extrusion",this.layers,h);for(const{feature:x,id:A,index:P,sourceLayerIndex:R}of l){const D=this.layers[0]._featureFilter.needGeometry,U=jc(x,D);if(!this.layers[0]._featureFilter.filter(new Qr(this.zoom),U,m))continue;const $={id:A,sourceLayerIndex:R,index:P,geometry:D?U.geometry:Lu(x),properties:x.properties,type:x.type,patterns:{}};this.hasDependencies?this.features.push(u_("fill-extrusion",this.layers,$,{zoom:this.zoom},h)):this.addFeature($,$.geometry,P,m,{},h.subdivisionGranularity),h.featureIndex.insert(x,$.geometry,P,R,this.index,!0)}}addFeatures(l,h,m){for(const x of this.features){const{geometry:A}=x;this.addFeature(x,A,x.index,h,m,l.subdivisionGranularity)}}update(l,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,h,this.stateDependentLayers,{imagePositions:m})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,W0),this.centroidVertexBuffer=l.createVertexBuffer(this.centroidVertexArray,tl.members,!0),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(l,h,m,x,A,P){for(const R of xu(h,500)){const D={x:0,y:0,sampleCount:0},U=this.layoutVertexArray.length;this.processPolygon(D,x,l,R,P);const $=this.layoutVertexArray.length-U,G=Math.floor(D.x/D.sampleCount),ee=Math.floor(D.y/D.sampleCount);for(let re=0;re<$;re++)this.centroidVertexArray.emplaceBack(G,ee)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,m,{imagePositions:A,canonical:x})}processPolygon(l,h,m,x,A){if(x.length<1||ln(x[0]))return;for(const G of x)G.length!==0&&Aw(l,G);const P={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},R=A.fill.getGranularityForZoomLevel(h.z),D=rl.types[m.type]==="Polygon";for(const G of x){if(G.length===0||ln(G))continue;const ee=Hi(G,R,D);this._generateSideFaces(ee,P)}if(!D)return;const U=kp(x,h,R,!1),$=this.layoutVertexArray;g_(((G,ee)=>{ju($,G,ee,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,U.verticesFlattened,U.indicesTriangles)}_generateSideFaces(l,h){let m=0;for(let x=1;x<l.length;x++){const A=l[x],P=l[x-1];if(Ew(A,P))continue;h.segment.vertexLength+4>Or.MAX_VERTEX_ARRAY_LENGTH&&(h.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const R=A.sub(P)._perp()._unit(),D=P.dist(A);m+D>32768&&(m=0),ju(this.layoutVertexArray,A.x,A.y,R.x,R.y,0,0,m),ju(this.layoutVertexArray,A.x,A.y,R.x,R.y,0,1,m),m+=D,ju(this.layoutVertexArray,P.x,P.y,R.x,R.y,0,0,m),ju(this.layoutVertexArray,P.x,P.y,R.x,R.y,0,1,m);const U=h.segment.vertexLength;this.indexArray.emplaceBack(U,U+2,U+1),this.indexArray.emplaceBack(U+1,U+2,U+3),h.segment.vertexLength+=4,h.segment.primitiveLength+=2}}}function Aw(f,l){for(let h=0;h<l.length;h++){const m=l[h];h===l.length-1&&l[0].x===m.x&&l[0].y===m.y||(f.x+=m.x,f.y+=m.y,f.sampleCount++)}}function Ew(f,l){return f.x===l.x&&(f.x<0||f.x>Ue)||f.y===l.y&&(f.y<0||f.y>Ue)}function ln(f){return f.every((l=>l.x<0))||f.every((l=>l.x>Ue))||f.every((l=>l.y<0))||f.every((l=>l.y>Ue))}let In;Ht("FillExtrusionBucket",xm,{omit:["layers","features"]});var Xr={get paint(){return In=In||new Vi({"fill-extrusion-opacity":new Qt(He["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new tr(He["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Qt(He["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Qt(He["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Gl(He["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new tr(He["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new tr(He["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Qt(He["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Zr extends ei{constructor(l,h){super(l,Xr,h)}createBucket(l){return new xm(l)}queryRadius(){return $i(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:l,feature:h,featureState:m,geometry:x,transform:A,pixelsToTileUnits:P,pixelPosMatrix:R}){const D=wp(l,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-A.bearingInRadians,P),U=this.paint.get("fill-extrusion-height").evaluate(h,m),$=this.paint.get("fill-extrusion-base").evaluate(h,m),G=(function(re,ne){const le=[];for(const de of re){const xe=[de.x,de.y,0,1];Ot(xe,xe,ne),le.push(new g(xe[0]/xe[3],xe[1]/xe[3]))}return le})(D,R),ee=(function(re,ne,le,de){const xe=[],$e=[],Ie=de[8]*ne,De=de[9]*ne,et=de[10]*ne,ft=de[11]*ne,St=de[8]*le,Vt=de[9]*le,zt=de[10]*le,jt=de[11]*le;for(const rr of re){const Ft=[],Ut=[];for(const yt of rr){const dr=yt.x,pr=yt.y,ar=de[0]*dr+de[4]*pr+de[12],Jt=de[1]*dr+de[5]*pr+de[13],Nr=de[2]*dr+de[6]*pr+de[14],Ln=de[3]*dr+de[7]*pr+de[15],ri=Nr+et,qi=Ln+ft,Ea=ar+St,Ts=Jt+Vt,Fn=Nr+zt,rn=Ln+jt,Bn=new g((ar+Ie)/qi,(Jt+De)/qi);Bn.z=ri/qi,Ft.push(Bn);const li=new g(Ea/rn,Ts/rn);li.z=Fn/rn,Ut.push(li)}xe.push(Ft),$e.push(Ut)}return[xe,$e]})(x,$,U,R);return(function(re,ne,le){let de=1/0;t_(le,ne)&&(de=xa(le,ne[0]));for(let xe=0;xe<ne.length;xe++){const $e=ne[xe],Ie=re[xe];for(let De=0;De<$e.length-1;De++){const et=$e[De],ft=[et,$e[De+1],Ie[De+1],Ie[De],et];Bu(le,ft)&&(de=Math.min(de,xa(le,ft)))}}return de!==1/0&&de})(ee[0],ee[1],G)}}function en(f,l){return f.x*l.x+f.y*l.y}function xa(f,l){if(f.length===1){let h=0;const m=l[h++];let x;for(;!x||m.equals(x);)if(x=l[h++],!x)return 1/0;for(;h<l.length;h++){const A=l[h],P=f[0],R=x.sub(m),D=A.sub(m),U=P.sub(m),$=en(R,R),G=en(R,D),ee=en(D,D),re=en(U,R),ne=en(U,D),le=$*ee-G*G,de=(ee*re-G*ne)/le,xe=($*ne-G*re)/le,$e=m.z*(1-de-xe)+x.z*de+A.z*xe;if(isFinite($e))return $e}return 1/0}{let h=1/0;for(const m of l)h=Math.min(h,m.z);return h}}const Vu=an([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:od}=Vu,v_=an([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Wc}=v_,Ti=Math.cos(Math.PI/180*37.5),qc=Math.pow(2,14)/.5;class Gc{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map((h=>h.id)),this.index=l.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((h=>{this.gradients[h.id]={}})),this.layoutVertexArray=new Bt,this.layoutVertexArray2=new Tt,this.indexArray=new xi,this.programConfigurations=new Du(l.layers,l.zoom),this.segments=new Or,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((h=>h.isStateDependent())).map((h=>h.id))}populate(l,h,m){this.hasDependencies=Pn("line",this.layers,h)||this.hasLineDasharray(this.layers);const x=this.layers[0].layout.get("line-sort-key"),A=!x.isConstant(),P=[];for(const{feature:R,id:D,index:U,sourceLayerIndex:$}of l){const G=this.layers[0]._featureFilter.needGeometry,ee=jc(R,G);if(!this.layers[0]._featureFilter.filter(new Qr(this.zoom),ee,m))continue;const re=A?x.evaluate(ee,{},m):void 0,ne={id:D,properties:R.properties,type:R.type,sourceLayerIndex:$,index:U,geometry:G?ee.geometry:Lu(R),patterns:{},dashes:{},sortKey:re};P.push(ne)}A&&P.sort(((R,D)=>R.sortKey-D.sortKey));for(const R of P){const{geometry:D,index:U,sourceLayerIndex:$}=R;this.hasDependencies?(Pn("line",this.layers,h)?u_("line",this.layers,R,{zoom:this.zoom},h):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,R,this.zoom,h),this.patternFeatures.push(R)):this.addFeature(R,D,U,m,{},{},h.subdivisionGranularity),h.featureIndex.insert(l[U].feature,D,U,$,this.index)}}update(l,h,m,x){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,h,this.stateDependentLayers,{imagePositions:m,dashPositions:x})}addFeatures(l,h,m,x){for(const A of this.patternFeatures)this.addFeature(A,A.geometry,A.index,h,m,x,l.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=l.createVertexBuffer(this.layoutVertexArray2,Wc)),this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,od),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(l){if(l.properties&&Object.prototype.hasOwnProperty.call(l.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(l.properties,"mapbox_clip_end"))return{start:+l.properties.mapbox_clip_start,end:+l.properties.mapbox_clip_end}}addFeature(l,h,m,x,A,P,R){const D=this.layers[0].layout,U=D.get("line-join").evaluate(l,{}),$=D.get("line-cap"),G=D.get("line-miter-limit"),ee=D.get("line-round-limit");this.lineClips=this.lineFeatureClips(l);for(const re of h)this.addLine(re,l,U,$,G,ee,x,R);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,m,{imagePositions:A,dashPositions:P,canonical:x})}addLine(l,h,m,x,A,P,R,D){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,l=Hi(l,R?D.line.getGranularityForZoomLevel(R.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ie=0;Ie<l.length-1;Ie++)this.totalDistance+=l[Ie].dist(l[Ie+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const U=rl.types[h.type]==="Polygon";let $=l.length;for(;$>=2&&l[$-1].equals(l[$-2]);)$--;let G=0;for(;G<$-1&&l[G].equals(l[G+1]);)G++;if($<(U?3:2))return;m==="bevel"&&(A=1.05);const ee=this.overscaling<=16?122880/(512*this.overscaling):0,re=this.segments.prepareSegment(10*$,this.layoutVertexArray,this.indexArray);let ne,le,de,xe,$e;this.e1=this.e2=-1,U&&(ne=l[$-2],$e=l[G].sub(ne)._unit()._perp());for(let Ie=G;Ie<$;Ie++){if(de=Ie===$-1?U?l[G+1]:void 0:l[Ie+1],de&&l[Ie].equals(de))continue;$e&&(xe=$e),ne&&(le=ne),ne=l[Ie],$e=de?de.sub(ne)._unit()._perp():xe,xe=xe||$e;let De=xe.add($e);De.x===0&&De.y===0||De._unit();const et=xe.x*$e.x+xe.y*$e.y,ft=De.x*$e.x+De.y*$e.y,St=ft!==0?1/ft:1/0,Vt=2*Math.sqrt(2-2*ft),zt=ft<Ti&&le&&de,jt=xe.x*$e.y-xe.y*$e.x>0;if(zt&&Ie>G){const Ut=ne.dist(le);if(Ut>2*ee){const yt=ne.sub(ne.sub(le)._mult(ee/Ut)._round());this.updateDistance(le,yt),this.addCurrentVertex(yt,xe,0,0,re),le=yt}}const rr=le&&de;let Ft=rr?m:U?"butt":x;if(rr&&Ft==="round"&&(St<P?Ft="miter":St<=2&&(Ft="fakeround")),Ft==="miter"&&St>A&&(Ft="bevel"),Ft==="bevel"&&(St>2&&(Ft="flipbevel"),St<A&&(Ft="miter")),le&&this.updateDistance(le,ne),Ft==="miter")De._mult(St),this.addCurrentVertex(ne,De,0,0,re);else if(Ft==="flipbevel"){if(St>100)De=$e.mult(-1);else{const Ut=St*xe.add($e).mag()/xe.sub($e).mag();De._perp()._mult(Ut*(jt?-1:1))}this.addCurrentVertex(ne,De,0,0,re),this.addCurrentVertex(ne,De.mult(-1),0,0,re)}else if(Ft==="bevel"||Ft==="fakeround"){const Ut=-Math.sqrt(St*St-1),yt=jt?Ut:0,dr=jt?0:Ut;if(le&&this.addCurrentVertex(ne,xe,yt,dr,re),Ft==="fakeround"){const pr=Math.round(180*Vt/Math.PI/20);for(let ar=1;ar<pr;ar++){let Jt=ar/pr;if(Jt!==.5){const Ln=Jt-.5;Jt+=Jt*Ln*(Jt-1)*((1.0904+et*(et*(3.55645-1.43519*et)-3.2452))*Ln*Ln+(.848013+et*(.215638*et-1.06021)))}const Nr=$e.sub(xe)._mult(Jt)._add(xe)._unit()._mult(jt?-1:1);this.addHalfVertex(ne,Nr.x,Nr.y,!1,jt,0,re)}}de&&this.addCurrentVertex(ne,$e,-yt,-dr,re)}else if(Ft==="butt")this.addCurrentVertex(ne,De,0,0,re);else if(Ft==="square"){const Ut=le?1:-1;this.addCurrentVertex(ne,De,Ut,Ut,re)}else Ft==="round"&&(le&&(this.addCurrentVertex(ne,xe,0,0,re),this.addCurrentVertex(ne,xe,1,1,re,!0)),de&&(this.addCurrentVertex(ne,$e,-1,-1,re,!0),this.addCurrentVertex(ne,$e,0,0,re)));if(zt&&Ie<$-1){const Ut=ne.dist(de);if(Ut>2*ee){const yt=ne.add(de.sub(ne)._mult(ee/Ut)._round());this.updateDistance(ne,yt),this.addCurrentVertex(yt,$e,0,0,re),ne=yt}}}}addCurrentVertex(l,h,m,x,A,P=!1){const R=h.y*x-h.x,D=-h.y-h.x*x;this.addHalfVertex(l,h.x+h.y*m,h.y-h.x*m,P,!1,m,A),this.addHalfVertex(l,R,D,P,!0,-x,A),this.distance>qc/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(l,h,m,x,A,P))}addHalfVertex({x:l,y:h},m,x,A,P,R,D){const U=.5*(this.lineClips?this.scaledDistance*(qc-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((l<<1)+(A?1:0),(h<<1)+(P?1:0),Math.round(63*m)+128,Math.round(63*x)+128,1+(R===0?0:R<0?-1:1)|(63&U)<<2,U>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const $=D.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,$,this.e2),D.primitiveLength++),P?this.e2=$:this.e1=$}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(l,h){this.distance+=l.dist(h),this.updateScaledDistance()}hasLineDasharray(l){for(const h of l){const m=h.paint.get("line-dasharray");if(m&&!m.isConstant())return!0}return!1}addLineDashDependencies(l,h,m,x){for(const A of l){const P=A.paint.get("line-dasharray");if(!P||P.value.kind==="constant")continue;const R=A.layout.get("line-cap")==="round",D={dasharray:P.value.evaluate({zoom:m-1},h,{}),round:R},U={dasharray:P.value.evaluate({zoom:m},h,{}),round:R},$={dasharray:P.value.evaluate({zoom:m+1},h,{}),round:R},G=`${D.dasharray.join(",")},${D.round}`,ee=`${U.dasharray.join(",")},${U.round}`,re=`${$.dasharray.join(",")},${$.round}`;x.dashDependencies[G]=D,x.dashDependencies[ee]=U,x.dashDependencies[re]=$,h.dashes[A.id]={min:G,mid:ee,max:re}}}}let wm,wa;Ht("LineBucket",Gc,{omit:["layers","patternFeatures"]});var Zh={get paint(){return wa=wa||new Vi({"line-opacity":new tr(He.paint_line["line-opacity"]),"line-color":new tr(He.paint_line["line-color"]),"line-translate":new Qt(He.paint_line["line-translate"]),"line-translate-anchor":new Qt(He.paint_line["line-translate-anchor"]),"line-width":new tr(He.paint_line["line-width"]),"line-gap-width":new tr(He.paint_line["line-gap-width"]),"line-offset":new tr(He.paint_line["line-offset"]),"line-blur":new tr(He.paint_line["line-blur"]),"line-dasharray":new Gl(He.paint_line["line-dasharray"]),"line-pattern":new Gl(He.paint_line["line-pattern"]),"line-gradient":new Mu(He.paint_line["line-gradient"])})},get layout(){return wm=wm||new Vi({"line-cap":new Qt(He.layout_line["line-cap"]),"line-join":new tr(He.layout_line["line-join"]),"line-miter-limit":new Qt(He.layout_line["line-miter-limit"]),"line-round-limit":new Qt(He.layout_line["line-round-limit"]),"line-sort-key":new tr(He.layout_line["line-sort-key"])})}};class Np extends tr{possiblyEvaluate(l,h){return h=new Qr(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),super.possiblyEvaluate(l,h)}evaluate(l,h,m,x){return h=nr({},h,{zoom:Math.floor(h.zoom)}),super.evaluate(l,h,m,x)}}let ws;class b_ extends ei{constructor(l,h){super(l,Zh,h),this.gradientVersion=0,ws||(ws=new Np(Zh.paint.properties["line-width"].specification),ws.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){const h=this.gradientExpression();this.stepInterpolant=!!(function(m){return m._styleExpression!==void 0})(h)&&h._styleExpression.expression instanceof zn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(l,h){super.recalculate(l,h),this.paint._values["line-floorwidth"]=ws.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new Gc(l)}queryRadius(l){const h=l,m=zp(Yn("line-width",this,h),Yn("line-gap-width",this,h)),x=Yn("line-offset",this,h);return m/2+Math.abs(x)+$i(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:l,feature:h,featureState:m,geometry:x,transform:A,pixelsToTileUnits:P}){const R=wp(l,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-A.bearingInRadians,P),D=P/2*zp(this.paint.get("line-width").evaluate(h,m),this.paint.get("line-gap-width").evaluate(h,m)),U=this.paint.get("line-offset").evaluate(h,m);return U&&(x=(function($,G){const ee=[];for(let re=0;re<$.length;re++){const ne=$[re],le=[];for(let de=0;de<ne.length;de++){const xe=ne[de-1],$e=ne[de],Ie=ne[de+1],De=de===0?new g(0,0):$e.sub(xe)._unit()._perp(),et=de===ne.length-1?new g(0,0):Ie.sub($e)._unit()._perp(),ft=De._add(et)._unit(),St=ft.x*et.x+ft.y*et.y;St!==0&&ft._mult(1/St),le.push(ft._mult(G)._add($e))}ee.push(le)}return ee})(x,U*P)),(function($,G,ee){for(let re=0;re<G.length;re++){const ne=G[re];if($.length>=3){for(let le=0;le<ne.length;le++)if(nd($,ne[le]))return!0}if(I0($,ne,ee))return!0}return!1})(R,x,D)}isTileClipped(){return!0}}function zp(f,l){return l>0?l+2*f:f}const G0=an([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Tm=an([{name:"a_projected_pos",components:3,type:"Float32"}],4);an([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Sm=an([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);an([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Xc=an([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Qi=an([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function $u(f,l,h){return f.sections.forEach((m=>{m.text=(function(x,A,P){const R=A.layout.get("text-transform").evaluate(P,{});return R==="uppercase"?x=x.toLocaleUpperCase():R==="lowercase"&&(x=x.toLocaleLowerCase()),vs.applyArabicShaping&&(x=vs.applyArabicShaping(x)),x})(m.text,l,h)})),f}an([{name:"triangle",components:3,type:"Uint16"}]),an([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),an([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),an([{type:"Float32",name:"offsetX"}]),an([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),an([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const rc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Rn=24;const Fp=4294967296,Am=1/Fp,x_=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Yh{constructor(l=new Uint8Array(16)){this.buf=ArrayBuffer.isView(l)?l:new Uint8Array(l),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(l,h,m=this.length){for(;this.pos<m;){const x=this.readVarint(),A=x>>3,P=this.pos;this.type=7&x,l(A,h,this),this.pos===P&&this.skip(x)}return h}readMessage(l,h){return this.readFields(l,h,this.readVarint()+this.pos)}readFixed32(){const l=this.dataView.getUint32(this.pos,!0);return this.pos+=4,l}readSFixed32(){const l=this.dataView.getInt32(this.pos,!0);return this.pos+=4,l}readFixed64(){const l=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Fp;return this.pos+=8,l}readSFixed64(){const l=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Fp;return this.pos+=8,l}readFloat(){const l=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,l}readDouble(){const l=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,l}readVarint(l){const h=this.buf;let m,x;return x=h[this.pos++],m=127&x,x<128?m:(x=h[this.pos++],m|=(127&x)<<7,x<128?m:(x=h[this.pos++],m|=(127&x)<<14,x<128?m:(x=h[this.pos++],m|=(127&x)<<21,x<128?m:(x=h[this.pos],m|=(15&x)<<28,(function(A,P,R){const D=R.buf;let U,$;if($=D[R.pos++],U=(112&$)>>4,$<128||($=D[R.pos++],U|=(127&$)<<3,$<128)||($=D[R.pos++],U|=(127&$)<<10,$<128)||($=D[R.pos++],U|=(127&$)<<17,$<128)||($=D[R.pos++],U|=(127&$)<<24,$<128)||($=D[R.pos++],U|=(1&$)<<31,$<128))return Hu(A,U,P);throw new Error("Expected varint not more than 10 bytes")})(m,l,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const l=this.readVarint();return l%2==1?(l+1)/-2:l/2}readBoolean(){return!!this.readVarint()}readString(){const l=this.readVarint()+this.pos,h=this.pos;return this.pos=l,l-h>=12&&x_?x_.decode(this.buf.subarray(h,l)):(function(m,x,A){let P="",R=x;for(;R<A;){const D=m[R];let U,$,G,ee=null,re=D>239?4:D>223?3:D>191?2:1;if(R+re>A)break;re===1?D<128&&(ee=D):re===2?(U=m[R+1],(192&U)==128&&(ee=(31&D)<<6|63&U,ee<=127&&(ee=null))):re===3?(U=m[R+1],$=m[R+2],(192&U)==128&&(192&$)==128&&(ee=(15&D)<<12|(63&U)<<6|63&$,(ee<=2047||ee>=55296&&ee<=57343)&&(ee=null))):re===4&&(U=m[R+1],$=m[R+2],G=m[R+3],(192&U)==128&&(192&$)==128&&(192&G)==128&&(ee=(15&D)<<18|(63&U)<<12|(63&$)<<6|63&G,(ee<=65535||ee>=1114112)&&(ee=null))),ee===null?(ee=65533,re=1):ee>65535&&(ee-=65536,P+=String.fromCharCode(ee>>>10&1023|55296),ee=56320|1023&ee),P+=String.fromCharCode(ee),R+=re}return P})(this.buf,h,l)}readBytes(){const l=this.readVarint()+this.pos,h=this.buf.subarray(this.pos,l);return this.pos=l,h}readPackedVarint(l=[],h){const m=this.readPackedEnd();for(;this.pos<m;)l.push(this.readVarint(h));return l}readPackedSVarint(l=[]){const h=this.readPackedEnd();for(;this.pos<h;)l.push(this.readSVarint());return l}readPackedBoolean(l=[]){const h=this.readPackedEnd();for(;this.pos<h;)l.push(this.readBoolean());return l}readPackedFloat(l=[]){const h=this.readPackedEnd();for(;this.pos<h;)l.push(this.readFloat());return l}readPackedDouble(l=[]){const h=this.readPackedEnd();for(;this.pos<h;)l.push(this.readDouble());return l}readPackedFixed32(l=[]){const h=this.readPackedEnd();for(;this.pos<h;)l.push(this.readFixed32());return l}readPackedSFixed32(l=[]){const h=this.readPackedEnd();for(;this.pos<h;)l.push(this.readSFixed32());return l}readPackedFixed64(l=[]){const h=this.readPackedEnd();for(;this.pos<h;)l.push(this.readFixed64());return l}readPackedSFixed64(l=[]){const h=this.readPackedEnd();for(;this.pos<h;)l.push(this.readSFixed64());return l}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(l){const h=7&l;if(h===0)for(;this.buf[this.pos++]>127;);else if(h===2)this.pos=this.readVarint()+this.pos;else if(h===5)this.pos+=4;else{if(h!==1)throw new Error(`Unimplemented type: ${h}`);this.pos+=8}}writeTag(l,h){this.writeVarint(l<<3|h)}realloc(l){let h=this.length||16;for(;h<this.pos+l;)h*=2;if(h!==this.length){const m=new Uint8Array(h);m.set(this.buf),this.buf=m,this.dataView=new DataView(m.buffer),this.length=h}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(l){this.realloc(4),this.dataView.setInt32(this.pos,l,!0),this.pos+=4}writeSFixed32(l){this.realloc(4),this.dataView.setInt32(this.pos,l,!0),this.pos+=4}writeFixed64(l){this.realloc(8),this.dataView.setInt32(this.pos,-1&l,!0),this.dataView.setInt32(this.pos+4,Math.floor(l*Am),!0),this.pos+=8}writeSFixed64(l){this.realloc(8),this.dataView.setInt32(this.pos,-1&l,!0),this.dataView.setInt32(this.pos+4,Math.floor(l*Am),!0),this.pos+=8}writeVarint(l){(l=+l||0)>268435455||l<0?(function(h,m){let x,A;if(h>=0?(x=h%4294967296|0,A=h/4294967296|0):(x=~(-h%4294967296),A=~(-h/4294967296),4294967295^x?x=x+1|0:(x=0,A=A+1|0)),h>=18446744073709552e3||h<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");m.realloc(10),(function(P,R,D){D.buf[D.pos++]=127&P|128,P>>>=7,D.buf[D.pos++]=127&P|128,P>>>=7,D.buf[D.pos++]=127&P|128,P>>>=7,D.buf[D.pos++]=127&P|128,D.buf[D.pos]=127&(P>>>=7)})(x,0,m),(function(P,R){const D=(7&P)<<4;R.buf[R.pos++]|=D|((P>>>=3)?128:0),P&&(R.buf[R.pos++]=127&P|((P>>>=7)?128:0),P&&(R.buf[R.pos++]=127&P|((P>>>=7)?128:0),P&&(R.buf[R.pos++]=127&P|((P>>>=7)?128:0),P&&(R.buf[R.pos++]=127&P|((P>>>=7)?128:0),P&&(R.buf[R.pos++]=127&P)))))})(A,m)})(l,this):(this.realloc(4),this.buf[this.pos++]=127&l|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=l>>>7&127))))}writeSVarint(l){this.writeVarint(l<0?2*-l-1:2*l)}writeBoolean(l){this.writeVarint(+l)}writeString(l){l=String(l),this.realloc(4*l.length),this.pos++;const h=this.pos;this.pos=(function(x,A,P){for(let R,D,U=0;U<A.length;U++){if(R=A.charCodeAt(U),R>55295&&R<57344){if(!D){R>56319||U+1===A.length?(x[P++]=239,x[P++]=191,x[P++]=189):D=R;continue}if(R<56320){x[P++]=239,x[P++]=191,x[P++]=189,D=R;continue}R=D-55296<<10|R-56320|65536,D=null}else D&&(x[P++]=239,x[P++]=191,x[P++]=189,D=null);R<128?x[P++]=R:(R<2048?x[P++]=R>>6|192:(R<65536?x[P++]=R>>12|224:(x[P++]=R>>18|240,x[P++]=R>>12&63|128),x[P++]=R>>6&63|128),x[P++]=63&R|128)}return P})(this.buf,l,this.pos);const m=this.pos-h;m>=128&&Ta(h,m,this),this.pos=h-1,this.writeVarint(m),this.pos+=m}writeFloat(l){this.realloc(4),this.dataView.setFloat32(this.pos,l,!0),this.pos+=4}writeDouble(l){this.realloc(8),this.dataView.setFloat64(this.pos,l,!0),this.pos+=8}writeBytes(l){const h=l.length;this.writeVarint(h),this.realloc(h);for(let m=0;m<h;m++)this.buf[this.pos++]=l[m]}writeRawMessage(l,h){this.pos++;const m=this.pos;l(h,this);const x=this.pos-m;x>=128&&Ta(m,x,this),this.pos=m-1,this.writeVarint(x),this.pos+=x}writeMessage(l,h,m){this.writeTag(l,2),this.writeRawMessage(h,m)}writePackedVarint(l,h){h.length&&this.writeMessage(l,X0,h)}writePackedSVarint(l,h){h.length&&this.writeMessage(l,Sa,h)}writePackedBoolean(l,h){h.length&&this.writeMessage(l,Cw,h)}writePackedFloat(l,h){h.length&&this.writeMessage(l,Z0,h)}writePackedDouble(l,h){h.length&&this.writeMessage(l,Y0,h)}writePackedFixed32(l,h){h.length&&this.writeMessage(l,Wu,h)}writePackedSFixed32(l,h){h.length&&this.writeMessage(l,Em,h)}writePackedFixed64(l,h){h.length&&this.writeMessage(l,w_,h)}writePackedSFixed64(l,h){h.length&&this.writeMessage(l,ld,h)}writeBytesField(l,h){this.writeTag(l,2),this.writeBytes(h)}writeFixed32Field(l,h){this.writeTag(l,5),this.writeFixed32(h)}writeSFixed32Field(l,h){this.writeTag(l,5),this.writeSFixed32(h)}writeFixed64Field(l,h){this.writeTag(l,1),this.writeFixed64(h)}writeSFixed64Field(l,h){this.writeTag(l,1),this.writeSFixed64(h)}writeVarintField(l,h){this.writeTag(l,0),this.writeVarint(h)}writeSVarintField(l,h){this.writeTag(l,0),this.writeSVarint(h)}writeStringField(l,h){this.writeTag(l,2),this.writeString(h)}writeFloatField(l,h){this.writeTag(l,5),this.writeFloat(h)}writeDoubleField(l,h){this.writeTag(l,1),this.writeDouble(h)}writeBooleanField(l,h){this.writeVarintField(l,+h)}}function Hu(f,l,h){return h?4294967296*l+(f>>>0):4294967296*(l>>>0)+(f>>>0)}function Ta(f,l,h){const m=l<=16383?1:l<=2097151?2:l<=268435455?3:Math.floor(Math.log(l)/(7*Math.LN2));h.realloc(m);for(let x=h.pos-1;x>=f;x--)h.buf[x+m]=h.buf[x]}function X0(f,l){for(let h=0;h<f.length;h++)l.writeVarint(f[h])}function Sa(f,l){for(let h=0;h<f.length;h++)l.writeSVarint(f[h])}function Z0(f,l){for(let h=0;h<f.length;h++)l.writeFloat(f[h])}function Y0(f,l){for(let h=0;h<f.length;h++)l.writeDouble(f[h])}function Cw(f,l){for(let h=0;h<f.length;h++)l.writeBoolean(f[h])}function Wu(f,l){for(let h=0;h<f.length;h++)l.writeFixed32(f[h])}function Em(f,l){for(let h=0;h<f.length;h++)l.writeSFixed32(f[h])}function w_(f,l){for(let h=0;h<f.length;h++)l.writeFixed64(f[h])}function ld(f,l){for(let h=0;h<f.length;h++)l.writeSFixed64(f[h])}function K0(f,l,h){f===1&&h.readMessage(Q0,l)}function Q0(f,l,h){if(f===3){const{id:m,bitmap:x,width:A,height:P,left:R,top:D,advance:U}=h.readMessage(J0,{});l.push({id:m,bitmap:new sd({width:A+6,height:P+6},x),metrics:{width:A,height:P,left:R,top:D,advance:U}})}}function J0(f,l,h){f===1?l.id=h.readVarint():f===2?l.bitmap=h.readBytes():f===3?l.width=h.readVarint():f===4?l.height=h.readVarint():f===5?l.left=h.readSVarint():f===6?l.top=h.readSVarint():f===7&&(l.advance=h.readVarint())}function T_(f){let l=0,h=0;for(const P of f)l+=P.w*P.h,h=Math.max(h,P.w);f.sort(((P,R)=>R.h-P.h));const m=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(l/.95)),h),h:1/0}];let x=0,A=0;for(const P of f)for(let R=m.length-1;R>=0;R--){const D=m[R];if(!(P.w>D.w||P.h>D.h)){if(P.x=D.x,P.y=D.y,A=Math.max(A,P.y+P.h),x=Math.max(x,P.x+P.w),P.w===D.w&&P.h===D.h){const U=m.pop();U&&R<m.length&&(m[R]=U)}else P.h===D.h?(D.x+=P.w,D.w-=P.w):P.w===D.w?(D.y+=P.h,D.h-=P.h):(m.push({x:D.x+P.w,y:D.y,w:D.w-P.w,h:P.h}),D.y+=P.h,D.h-=P.h);break}}return{w:x,h:A,fill:l/(x*A)||0}}class cd{constructor(l,{pixelRatio:h,version:m,stretchX:x,stretchY:A,content:P,textFitWidth:R,textFitHeight:D}){this.paddedRect=l,this.pixelRatio=h,this.stretchX=x,this.stretchY=A,this.content=P,this.version=m,this.textFitWidth=R,this.textFitHeight=D}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Cm{constructor(l,h){const m={},x={};this.haveRenderCallbacks=[];const A=[];this.addImages(l,m,A),this.addImages(h,x,A);const{w:P,h:R}=T_(A),D=new xs({width:P||1,height:R||1});for(const U in l){const $=l[U],G=m[U].paddedRect;xs.copy($.data,D,{x:0,y:0},{x:G.x+1,y:G.y+1},$.data)}for(const U in h){const $=h[U],G=x[U].paddedRect,ee=G.x+1,re=G.y+1,ne=$.data.width,le=$.data.height;xs.copy($.data,D,{x:0,y:0},{x:ee,y:re},$.data),xs.copy($.data,D,{x:0,y:le-1},{x:ee,y:re-1},{width:ne,height:1}),xs.copy($.data,D,{x:0,y:0},{x:ee,y:re+le},{width:ne,height:1}),xs.copy($.data,D,{x:ne-1,y:0},{x:ee-1,y:re},{width:1,height:le}),xs.copy($.data,D,{x:0,y:0},{x:ee+ne,y:re},{width:1,height:le})}this.image=D,this.iconPositions=m,this.patternPositions=x}addImages(l,h,m){for(const x in l){const A=l[x],P={x:0,y:0,w:A.data.width+2,h:A.data.height+2};m.push(P),h[x]=new cd(P,A),A.hasRenderCallback&&this.haveRenderCallbacks.push(x)}}patchUpdatedImages(l,h){l.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const m in l.updatedImages)this.patchUpdatedImage(this.iconPositions[m],l.getImage(m),h),this.patchUpdatedImage(this.patternPositions[m],l.getImage(m),h)}patchUpdatedImage(l,h,m){if(!l||!h||l.version===h.version)return;l.version=h.version;const[x,A]=l.tl;m.update(h.data,void 0,{x,y:A})}}var qu;Ht("ImagePosition",cd),Ht("ImageAtlas",Cm),c.ao=void 0,(qu=c.ao||(c.ao={}))[qu.none=0]="none",qu[qu.horizontal=1]="horizontal",qu[qu.vertical=2]="vertical",qu[qu.horizontalOnly=3]="horizontalOnly";class Up{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(l,h,m){const x=new Up;return x.scale=l||1,x.fontStack=h,x.verticalAlign=m||"bottom",x}static forImage(l,h){const m=new Up;return m.imageName=l,m.verticalAlign=h||"bottom",m}}class ud{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(l,h){const m=new ud;for(let x=0;x<l.sections.length;x++){const A=l.sections[x];A.image?m.addImageSection(A):m.addTextSection(A,h)}return m}length(){return this.text.length}getSection(l){return this.sections[this.sectionIndex[l]]}getSectionIndex(l){return this.sectionIndex[l]}getCharCode(l){return this.text.charCodeAt(l)}verticalizePunctuation(){this.text=(function(l){let h="";for(let m=0;m<l.length;m++){const x=l.charCodeAt(m+1)||null,A=l.charCodeAt(m-1)||null;h+=x&&Nc(x)&&!rc[l[m+1]]||A&&Nc(A)&&!rc[l[m-1]]||!rc[l[m]]?l[m]:rc[l[m]]}return h})(this.text)}trim(){let l=0;for(let m=0;m<this.text.length&&Vp[this.text.charCodeAt(m)];m++)l++;let h=this.text.length;for(let m=this.text.length-1;m>=0&&m>=l&&Vp[this.text.charCodeAt(m)];m--)h--;this.text=this.text.substring(l,h),this.sectionIndex=this.sectionIndex.slice(l,h)}substring(l,h){const m=new ud;return m.text=this.text.substring(l,h),m.sectionIndex=this.sectionIndex.slice(l,h),m.sections=this.sections,m}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((l,h)=>Math.max(l,this.sections[h].scale)),0)}getMaxImageSize(l){let h=0,m=0;for(let x=0;x<this.length();x++){const A=this.getSection(x);if(A.imageName){const P=l[A.imageName];if(!P)continue;const R=P.displaySize;h=Math.max(h,R[0]),m=Math.max(m,R[1])}}return{maxImageWidth:h,maxImageHeight:m}}addTextSection(l,h){this.text+=l.text,this.sections.push(Up.forText(l.scale,l.fontStack||h,l.verticalAlign));const m=this.sections.length-1;for(let x=0;x<l.text.length;++x)this.sectionIndex.push(m)}addImageSection(l){const h=l.image?l.image.name:"";if(h.length===0)return void cr("Can't add FormattedSection with an empty image.");const m=this.getNextImageSectionCharCode();m?(this.text+=String.fromCharCode(m),this.sections.push(Up.forImage(h,l.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):cr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function jp(f,l,h,m,x,A,P,R,D,U,$,G,ee,re,ne){const le=ud.fromFeature(f,x);let de;G===c.ao.vertical&&le.verticalizePunctuation();const{processBidirectionalText:xe,processStyledBidirectionalText:$e}=vs;if(xe&&le.sections.length===1){de=[];const et=xe(le.toString(),Mm(le,U,A,l,m,re));for(const ft of et){const St=new ud;St.text=ft,St.sections=le.sections;for(let Vt=0;Vt<ft.length;Vt++)St.sectionIndex.push(0);de.push(St)}}else if($e){de=[];const et=$e(le.text,le.sectionIndex,Mm(le,U,A,l,m,re));for(const ft of et){const St=new ud;St.text=ft[0],St.sectionIndex=ft[1],St.sections=le.sections,de.push(St)}}else de=(function(et,ft){const St=[],Vt=et.text;let zt=0;for(const jt of ft)St.push(et.substring(zt,jt)),zt=jt;return zt<Vt.length&&St.push(et.substring(zt,Vt.length)),St})(le,Mm(le,U,A,l,m,re));const Ie=[],De={positionedLines:Ie,text:le.toString(),top:$[1],bottom:$[1],left:$[0],right:$[0],writingMode:G,iconsInText:!1,verticalizable:!1};return(function(et,ft,St,Vt,zt,jt,rr,Ft,Ut,yt,dr,pr){let ar=0,Jt=0,Nr=0,Ln=0;const ri=Ft==="right"?1:Ft==="left"?0:.5,qi=Rn/pr;let Ea=0;for(const rn of zt){rn.trim();const Bn=rn.getMaxScale(),li={positionedGlyphs:[],lineOffset:0};et.positionedLines[Ea]=li;const ci=li.positionedGlyphs;let ui=0;if(!rn.length()){Jt+=jt,++Ea;continue}const Ha=tb(Vt,rn,qi);for(let Ji=0;Ji<rn.length();Ji++){const Li=rn.getSection(Ji),Bi=rn.getSectionIndex(Ji),hi=rn.getCharCode(Ji),fi=Sn(Ut,dr,hi);let On;if(Li.imageName){if(et.iconsInText=!0,Li.scale=Li.scale*qi,On=Pw(Li,fi,Bn,Ha,Vt),!On)continue;ui=Math.max(ui,On.imageOffset)}else if(On=M_(Li,hi,fi,Ha,ft,St),!On)continue;const{rect:Ca,metrics:Kc,baselineOffset:Po}=On;ci.push({glyph:hi,imageName:Li.imageName,x:ar,y:Jt+Po+-17,vertical:fi,scale:Li.scale,fontStack:Li.fontStack,sectionIndex:Bi,metrics:Kc,rect:Ca}),fi?(et.verticalizable=!0,ar+=(Li.imageName?Kc.advance:Rn)*Li.scale+yt):ar+=Kc.advance*Li.scale+yt}ci.length!==0&&(Nr=Math.max(ar-yt,Nr),rb(ci,0,ci.length-1,ri)),ar=0,li.lineOffset=Math.max(ui,(Bn-1)*Rn);const Di=jt*Bn+ui;Jt+=Di,Ln=Math.max(Di,Ln),++Ea}const{horizontalAlign:Ts,verticalAlign:Fn}=fd(rr);(function(rn,Bn,li,ci,ui,Ha,Di,Ji,Li){const Bi=(Bn-li)*ui;let hi=0;hi=Ha!==Di?-Ji*ci- -17:-ci*Li*Di+.5*Di;for(const fi of rn)for(const On of fi.positionedGlyphs)On.x+=Bi,On.y+=hi})(et.positionedLines,ri,Ts,Fn,Nr,Ln,jt,Jt,zt.length),et.top+=-Fn*Jt,et.bottom=et.top+Jt,et.left+=-Ts*Nr,et.right=et.left+Nr})(De,l,h,m,de,P,R,D,G,U,ee,ne),!(function(et){for(const ft of et)if(ft.positionedGlyphs.length!==0)return!1;return!0})(Ie)&&De}const Vp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},hd={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Pm={40:!0};function S_(f,l,h,m,x,A){if(l.imageName){const P=m[l.imageName];return P?P.displaySize[0]*l.scale*Rn/A+x:0}{const P=h[l.fontStack],R=P&&P[f];return R?R.metrics.advance*l.scale+x:0}}function A_(f,l,h,m){const x=Math.pow(f-l,2);return m?f<l?x/2:2*x:x+Math.abs(h)*h}function eb(f,l,h){let m=0;return f===10&&(m-=1e4),h&&(m+=150),f!==40&&f!==65288||(m+=50),l!==41&&l!==65289||(m+=50),m}function E_(f,l,h,m,x,A){let P=null,R=A_(l,h,x,A);for(const D of m){const U=A_(l-D.x,h,x,A)+D.badness;U<=R&&(P=D,R=U)}return{index:f,x:l,priorBreak:P,badness:R}}function C_(f){return f?C_(f.priorBreak).concat(f.index):[]}function Mm(f,l,h,m,x,A){if(!f)return[];const P=[],R=(function(G,ee,re,ne,le,de){let xe=0;for(let $e=0;$e<G.length();$e++){const Ie=G.getSection($e);xe+=S_(G.getCharCode($e),Ie,ne,le,ee,de)}return xe/Math.max(1,Math.ceil(xe/re))})(f,l,h,m,x,A),D=f.text.indexOf("")>=0;let U=0;for(let G=0;G<f.length();G++){const ee=f.getSection(G),re=f.getCharCode(G);if(Vp[re]||(U+=S_(re,ee,m,x,l,A)),G<f.length()-1){const ne=!(($=re)<11904)&&(!!Br["CJK Compatibility Forms"]($)||!!Br["CJK Compatibility"]($)||!!Br["CJK Strokes"]($)||!!Br["CJK Symbols and Punctuation"]($)||!!Br["Enclosed CJK Letters and Months"]($)||!!Br["Halfwidth and Fullwidth Forms"]($)||!!Br["Ideographic Description Characters"]($)||!!Br["Vertical Forms"]($)||Cu.test(String.fromCodePoint($)));(hd[re]||ne||ee.imageName||G!==f.length()-2&&Pm[f.getCharCode(G+1)])&&P.push(E_(G+1,U,R,P,eb(re,f.getCharCode(G+1),ne&&D),!1))}}var $;return C_(E_(f.length(),U,R,P,0,!0))}function fd(f){let l=.5,h=.5;switch(f){case"right":case"top-right":case"bottom-right":l=1;break;case"left":case"top-left":case"bottom-left":l=0}switch(f){case"bottom":case"bottom-right":case"bottom-left":h=1;break;case"top":case"top-right":case"top-left":h=0}return{horizontalAlign:l,verticalAlign:h}}function tb(f,l,h){const m=l.getMaxScale()*Rn,{maxImageWidth:x,maxImageHeight:A}=l.getMaxImageSize(f),P=Math.max(m,A*h);return{verticalLineContentWidth:Math.max(m,x*h),horizontalLineContentHeight:P}}function P_(f){switch(f){case"top":return 0;case"center":return .5;default:return 1}}function Sn(f,l,h){return!(f===c.ao.horizontal||!l&&!Pu(h)||l&&(Vp[h]||(m=h,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(m)))));var m}function M_(f,l,h,m,x,A){const P=A[f.fontStack],R=(function(U,$,G,ee){if(U&&U.rect)return U;const re=$[G.fontStack],ne=re&&re[ee];return ne?{rect:null,metrics:ne.metrics}:null})(P&&P[l],x,f,l);if(R===null)return null;let D;if(h)D=m.verticalLineContentWidth-f.scale*Rn;else{const U=P_(f.verticalAlign);D=(m.horizontalLineContentHeight-f.scale*Rn)*U}return{rect:R.rect,metrics:R.metrics,baselineOffset:D}}function Pw(f,l,h,m,x){const A=x[f.imageName];if(!A)return null;const P=A.paddedRect,R=A.displaySize,D={width:R[0],height:R[1],left:1,top:-3,advance:l?R[1]:R[0]};let U;if(l)U=m.verticalLineContentWidth-R[1]*f.scale;else{const $=P_(f.verticalAlign);U=(m.horizontalLineContentHeight-R[1]*f.scale)*$}return{rect:P,metrics:D,baselineOffset:U,imageOffset:(l?R[0]:R[1])*f.scale-Rn*h}}function rb(f,l,h,m){if(m===0)return;const x=f[h],A=(f[h].x+x.metrics.advance*x.scale)*m;for(let P=l;P<=h;P++)f[P].x-=A}function Mw(f,l,h){const{horizontalAlign:m,verticalAlign:x}=fd(h),A=l[0]-f.displaySize[0]*m,P=l[1]-f.displaySize[1]*x;return{image:f,top:P,bottom:P+f.displaySize[1],left:A,right:A+f.displaySize[0]}}function nb(f){var l,h;let m=f.left,x=f.top,A=f.right-m,P=f.bottom-x;const R=(l=f.image.textFitWidth)!==null&&l!==void 0?l:"stretchOrShrink",D=(h=f.image.textFitHeight)!==null&&h!==void 0?h:"stretchOrShrink",U=(f.image.content[2]-f.image.content[0])/(f.image.content[3]-f.image.content[1]);if(D==="proportional"){if(R==="stretchOnly"&&A/P<U||R==="proportional"){const $=Math.ceil(P*U);m*=$/A,A=$}}else if(R==="proportional"&&D==="stretchOnly"&&U!==0&&A/P>U){const $=Math.ceil(A/U);x*=$/P,P=$}return{x1:m,y1:x,x2:m+A,y2:x+P}}function ib(f,l,h,m,x,A){const P=f.image;let R;if(P.content){const de=P.content,xe=P.pixelRatio||1;R=[de[0]/xe,de[1]/xe,P.displaySize[0]-de[2]/xe,P.displaySize[1]-de[3]/xe]}const D=l.left*A,U=l.right*A;let $,G,ee,re;h==="width"||h==="both"?(re=x[0]+D-m[3],G=x[0]+U+m[1]):(re=x[0]+(D+U-P.displaySize[0])/2,G=re+P.displaySize[0]);const ne=l.top*A,le=l.bottom*A;return h==="height"||h==="both"?($=x[1]+ne-m[0],ee=x[1]+le+m[2]):($=x[1]+(ne+le-P.displaySize[1])/2,ee=$+P.displaySize[1]),{image:P,top:$,right:G,bottom:ee,left:re,collisionPadding:R}}const Ao=128,Va=32640;function Im(f,l){const{expression:h}=l;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new Qr(f+1))};if(h.kind==="source")return{kind:"source"};{const{zoomStops:m,interpolationType:x}=h;let A=0;for(;A<m.length&&m[A]<=f;)A++;A=Math.max(0,A-1);let P=A;for(;P<m.length&&m[P]<f+1;)P++;P=Math.min(m.length-1,P);const R=m[A],D=m[P];return h.kind==="composite"?{kind:"composite",minZoom:R,maxZoom:D,interpolationType:x}:{kind:"camera",minZoom:R,maxZoom:D,minSize:h.evaluate(new Qr(R)),maxSize:h.evaluate(new Qr(D)),interpolationType:x}}}function dd(f,l,h){let m="never";const x=f.get(l);return x?m=x:f.get(h)&&(m="always"),m}const I_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function nl(f,l,h,m,x,A,P,R,D,U,$,G,ee){const re=R?Math.min(Va,Math.round(R[0])):0,ne=R?Math.min(Va,Math.round(R[1])):0;f.emplaceBack(l,h,Math.round(32*m),Math.round(32*x),A,P,(re<<1)+(D?1:0),ne,16*U,16*$,256*G,256*ee)}function Eo(f,l,h){f.emplaceBack(l.x,l.y,h),f.emplaceBack(l.x,l.y,h),f.emplaceBack(l.x,l.y,h),f.emplaceBack(l.x,l.y,h)}function $p(f){for(const l of f.sections)if(jh(l.text))return!0;return!1}class R_{constructor(l){this.layoutVertexArray=new Yr,this.indexArray=new xi,this.programConfigurations=l,this.segments=new Or,this.dynamicLayoutVertexArray=new xn,this.opacityVertexArray=new pn,this.hasVisibleVertices=!1,this.placedSymbolArray=new _e}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(l,h,m,x){this.isEmpty()||(m&&(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,G0.members),this.indexBuffer=l.createIndexBuffer(this.indexArray,h),this.dynamicLayoutVertexBuffer=l.createVertexBuffer(this.dynamicLayoutVertexArray,Tm.members,!0),this.opacityVertexBuffer=l.createVertexBuffer(this.opacityVertexArray,I_,!0),this.opacityVertexBuffer.itemSize=1),(m||x)&&this.programConfigurations.upload(l))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ht("SymbolBuffers",R_);class Rm{constructor(l,h,m){this.layoutVertexArray=new l,this.layoutAttributes=h,this.indexArray=new m,this.segments=new Or,this.collisionVertexArray=new wn}upload(l){this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=l.createVertexBuffer(this.collisionVertexArray,Sm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ht("CollisionBuffers",Rm);class Kh{constructor(l){this.collisionBoxArray=l.collisionBoxArray,this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map((P=>P.id)),this.index=l.index,this.pixelRatio=l.pixelRatio,this.sourceLayerIndex=l.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const h=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Im(this.zoom,h["text-size"]),this.iconSizeData=Im(this.zoom,h["icon-size"]);const m=this.layers[0].layout,x=m.get("symbol-sort-key"),A=m.get("symbol-z-order");this.canOverlap=dd(m,"text-overlap","text-allow-overlap")!=="never"||dd(m,"icon-overlap","icon-allow-overlap")!=="never"||m.get("text-ignore-placement")||m.get("icon-ignore-placement"),this.sortFeaturesByKey=A!=="viewport-y"&&!x.isConstant(),this.sortFeaturesByY=(A==="viewport-y"||A==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,m.get("symbol-placement")==="point"&&(this.writingModes=m.get("text-writing-mode").map((P=>c.ao[P]))),this.stateDependentLayerIds=this.layers.filter((P=>P.isStateDependent())).map((P=>P.id)),this.sourceID=l.sourceID}createArrays(){this.text=new R_(new Du(this.layers,this.zoom,(l=>/^text/.test(l)))),this.icon=new R_(new Du(this.layers,this.zoom,(l=>/^icon/.test(l)))),this.glyphOffsetArray=new Te,this.lineVertexArray=new Oe,this.symbolInstances=new Ee,this.textAnchorOffsets=new Ce}calculateGlyphDependencies(l,h,m,x,A){for(let P=0;P<l.length;P++)if(h[l.charCodeAt(P)]=!0,(m||x)&&A){const R=rc[l.charAt(P)];R&&(h[R.charCodeAt(0)]=!0)}}populate(l,h,m){const x=this.layers[0],A=x.layout,P=A.get("text-font"),R=A.get("text-field"),D=A.get("icon-image"),U=(R.value.kind!=="constant"||R.value.value instanceof Yi&&!R.value.value.isEmpty()||R.value.value.toString().length>0)&&(P.value.kind!=="constant"||P.value.value.length>0),$=D.value.kind!=="constant"||!!D.value.value||Object.keys(D.parameters).length>0,G=A.get("symbol-sort-key");if(this.features=[],!U&&!$)return;const ee=h.iconDependencies,re=h.glyphDependencies,ne=h.availableImages,le=new Qr(this.zoom);for(const{feature:de,id:xe,index:$e,sourceLayerIndex:Ie}of l){const De=x._featureFilter.needGeometry,et=jc(de,De);if(!x._featureFilter.filter(le,et,m))continue;let ft,St;if(De||(et.geometry=Lu(de)),U){const zt=x.getValueAndResolveTokens("text-field",et,m,ne),jt=Yi.factory(zt),rr=this.hasRTLText=this.hasRTLText||$p(jt);(!rr||vs.getRTLTextPluginStatus()==="unavailable"||rr&&vs.isParsed())&&(ft=$u(jt,x,et))}if($){const zt=x.getValueAndResolveTokens("icon-image",et,m,ne);St=zt instanceof si?zt:si.fromString(zt)}if(!ft&&!St)continue;const Vt=this.sortFeaturesByKey?G.evaluate(et,{},m):void 0;if(this.features.push({id:xe,text:ft,icon:St,index:$e,sourceLayerIndex:Ie,geometry:et.geometry,properties:de.properties,type:rl.types[de.type],sortKey:Vt}),St&&(ee[St.name]=!0),ft){const zt=P.evaluate(et,{},m).join(","),jt=A.get("text-rotation-alignment")!=="viewport"&&A.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(c.ao.vertical)>=0;for(const rr of ft.sections)if(rr.image)ee[rr.image.name]=!0;else{const Ft=Yo(ft.toString()),Ut=rr.fontStack||zt,yt=re[Ut]=re[Ut]||{};this.calculateGlyphDependencies(rr.text,yt,jt,this.allowVerticalPlacement,Ft)}}}A.get("symbol-placement")==="line"&&(this.features=(function(de){const xe={},$e={},Ie=[];let De=0;function et(zt){Ie.push(de[zt]),De++}function ft(zt,jt,rr){const Ft=$e[zt];return delete $e[zt],$e[jt]=Ft,Ie[Ft].geometry[0].pop(),Ie[Ft].geometry[0]=Ie[Ft].geometry[0].concat(rr[0]),Ft}function St(zt,jt,rr){const Ft=xe[jt];return delete xe[jt],xe[zt]=Ft,Ie[Ft].geometry[0].shift(),Ie[Ft].geometry[0]=rr[0].concat(Ie[Ft].geometry[0]),Ft}function Vt(zt,jt,rr){const Ft=rr?jt[0][jt[0].length-1]:jt[0][0];return`${zt}:${Ft.x}:${Ft.y}`}for(let zt=0;zt<de.length;zt++){const jt=de[zt],rr=jt.geometry,Ft=jt.text?jt.text.toString():null;if(!Ft){et(zt);continue}const Ut=Vt(Ft,rr),yt=Vt(Ft,rr,!0);if(Ut in $e&&yt in xe&&$e[Ut]!==xe[yt]){const dr=St(Ut,yt,rr),pr=ft(Ut,yt,Ie[dr].geometry);delete xe[Ut],delete $e[yt],$e[Vt(Ft,Ie[pr].geometry,!0)]=pr,Ie[dr].geometry=null}else Ut in $e?ft(Ut,yt,rr):yt in xe?St(Ut,yt,rr):(et(zt),xe[Ut]=De-1,$e[yt]=De-1)}return Ie.filter((zt=>zt.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((de,xe)=>de.sortKey-xe.sortKey))}update(l,h,m){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(l,h,this.layers,{imagePositions:m}),this.icon.programConfigurations.updatePaintArrays(l,h,this.layers,{imagePositions:m}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(l){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(l),this.iconCollisionBox.upload(l)),this.text.upload(l,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(l,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(l,h){const m=this.lineVertexArray.length;if(l.segment!==void 0){let x=l.dist(h[l.segment+1]),A=l.dist(h[l.segment]);const P={};for(let R=l.segment+1;R<h.length;R++)P[R]={x:h[R].x,y:h[R].y,tileUnitDistanceFromAnchor:x},R<h.length-1&&(x+=h[R+1].dist(h[R]));for(let R=l.segment||0;R>=0;R--)P[R]={x:h[R].x,y:h[R].y,tileUnitDistanceFromAnchor:A},R>0&&(A+=h[R-1].dist(h[R]));for(let R=0;R<h.length;R++){const D=P[R];this.lineVertexArray.emplaceBack(D.x,D.y,D.tileUnitDistanceFromAnchor)}}return{lineStartIndex:m,lineLength:this.lineVertexArray.length-m}}addSymbols(l,h,m,x,A,P,R,D,U,$,G,ee){const re=l.indexArray,ne=l.layoutVertexArray,le=l.segments.prepareSegment(4*h.length,ne,re,this.canOverlap?P.sortKey:void 0),de=this.glyphOffsetArray.length,xe=le.vertexLength,$e=this.allowVerticalPlacement&&R===c.ao.vertical?Math.PI/2:0,Ie=P.text&&P.text.sections;for(let De=0;De<h.length;De++){const{tl:et,tr:ft,bl:St,br:Vt,tex:zt,pixelOffsetTL:jt,pixelOffsetBR:rr,minFontScaleX:Ft,minFontScaleY:Ut,glyphOffset:yt,isSDF:dr,sectionIndex:pr}=h[De],ar=le.vertexLength,Jt=yt[1];nl(ne,D.x,D.y,et.x,Jt+et.y,zt.x,zt.y,m,dr,jt.x,jt.y,Ft,Ut),nl(ne,D.x,D.y,ft.x,Jt+ft.y,zt.x+zt.w,zt.y,m,dr,rr.x,jt.y,Ft,Ut),nl(ne,D.x,D.y,St.x,Jt+St.y,zt.x,zt.y+zt.h,m,dr,jt.x,rr.y,Ft,Ut),nl(ne,D.x,D.y,Vt.x,Jt+Vt.y,zt.x+zt.w,zt.y+zt.h,m,dr,rr.x,rr.y,Ft,Ut),Eo(l.dynamicLayoutVertexArray,D,$e),re.emplaceBack(ar,ar+2,ar+1),re.emplaceBack(ar+1,ar+2,ar+3),le.vertexLength+=4,le.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(yt[0]),De!==h.length-1&&pr===h[De+1].sectionIndex||l.programConfigurations.populatePaintArrays(ne.length,P,P.index,{imagePositions:{},canonical:ee,formattedSection:Ie&&Ie[pr]})}l.placedSymbolArray.emplaceBack(D.x,D.y,de,this.glyphOffsetArray.length-de,xe,U,$,D.segment,m?m[0]:0,m?m[1]:0,x[0],x[1],R,0,!1,0,G)}_addCollisionDebugVertex(l,h,m,x,A,P){return h.emplaceBack(0,0),l.emplaceBack(m.x,m.y,x,A,Math.round(P.x),Math.round(P.y))}addCollisionDebugVertices(l,h,m,x,A,P,R){const D=A.segments.prepareSegment(4,A.layoutVertexArray,A.indexArray),U=D.vertexLength,$=A.layoutVertexArray,G=A.collisionVertexArray,ee=R.anchorX,re=R.anchorY;this._addCollisionDebugVertex($,G,P,ee,re,new g(l,h)),this._addCollisionDebugVertex($,G,P,ee,re,new g(m,h)),this._addCollisionDebugVertex($,G,P,ee,re,new g(m,x)),this._addCollisionDebugVertex($,G,P,ee,re,new g(l,x)),D.vertexLength+=4;const ne=A.indexArray;ne.emplaceBack(U,U+1),ne.emplaceBack(U+1,U+2),ne.emplaceBack(U+2,U+3),ne.emplaceBack(U+3,U),D.primitiveLength+=4}addDebugCollisionBoxes(l,h,m,x){for(let A=l;A<h;A++){const P=this.collisionBoxArray.get(A);this.addCollisionDebugVertices(P.x1,P.y1,P.x2,P.y2,x?this.textCollisionBox:this.iconCollisionBox,P.anchorPoint,m)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Rm(En,Xc.members,Cn),this.iconCollisionBox=new Rm(En,Xc.members,Cn);for(let l=0;l<this.symbolInstances.length;l++){const h=this.symbolInstances.get(l);this.addDebugCollisionBoxes(h.textBoxStartIndex,h.textBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.iconBoxStartIndex,h.iconBoxEndIndex,h,!1),this.addDebugCollisionBoxes(h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h,!1)}}_deserializeCollisionBoxesForSymbol(l,h,m,x,A,P,R,D,U){const $={};for(let G=h;G<m;G++){const ee=l.get(G);$.textBox={x1:ee.x1,y1:ee.y1,x2:ee.x2,y2:ee.y2,anchorPointX:ee.anchorPointX,anchorPointY:ee.anchorPointY},$.textFeatureIndex=ee.featureIndex;break}for(let G=x;G<A;G++){const ee=l.get(G);$.verticalTextBox={x1:ee.x1,y1:ee.y1,x2:ee.x2,y2:ee.y2,anchorPointX:ee.anchorPointX,anchorPointY:ee.anchorPointY},$.verticalTextFeatureIndex=ee.featureIndex;break}for(let G=P;G<R;G++){const ee=l.get(G);$.iconBox={x1:ee.x1,y1:ee.y1,x2:ee.x2,y2:ee.y2,anchorPointX:ee.anchorPointX,anchorPointY:ee.anchorPointY},$.iconFeatureIndex=ee.featureIndex;break}for(let G=D;G<U;G++){const ee=l.get(G);$.verticalIconBox={x1:ee.x1,y1:ee.y1,x2:ee.x2,y2:ee.y2,anchorPointX:ee.anchorPointX,anchorPointY:ee.anchorPointY},$.verticalIconFeatureIndex=ee.featureIndex;break}return $}deserializeCollisionBoxes(l){this.collisionArrays=[];for(let h=0;h<this.symbolInstances.length;h++){const m=this.symbolInstances.get(h);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(l,m.textBoxStartIndex,m.textBoxEndIndex,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m.iconBoxStartIndex,m.iconBoxEndIndex,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(l,h){const m=l.placedSymbolArray.get(h),x=m.vertexStartIndex+4*m.numGlyphs;for(let A=m.vertexStartIndex;A<x;A+=4)l.indexArray.emplaceBack(A,A+2,A+1),l.indexArray.emplaceBack(A+1,A+2,A+3)}getSortedSymbolIndexes(l){if(this.sortedAngle===l&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const h=Math.sin(l),m=Math.cos(l),x=[],A=[],P=[];for(let R=0;R<this.symbolInstances.length;++R){P.push(R);const D=this.symbolInstances.get(R);x.push(0|Math.round(h*D.anchorX+m*D.anchorY)),A.push(D.featureIndex)}return P.sort(((R,D)=>x[R]-x[D]||A[D]-A[R])),P}addToSortKeyRanges(l,h){const m=this.sortKeyRanges[this.sortKeyRanges.length-1];m&&m.sortKey===h?m.symbolInstanceEnd=l+1:this.sortKeyRanges.push({sortKey:h,symbolInstanceStart:l,symbolInstanceEnd:l+1})}sortFeatures(l){if(this.sortFeaturesByY&&this.sortedAngle!==l&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(l),this.sortedAngle=l,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const h of this.symbolInstanceIndexes){const m=this.symbolInstances.get(h);this.featureSortOrder.push(m.featureIndex),[m.rightJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.leftJustifiedTextSymbolIndex].forEach(((x,A,P)=>{x>=0&&P.indexOf(x)===A&&this.addIndicesForPlacedSymbol(this.text,x)})),m.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,m.verticalPlacedTextSymbolIndex),m.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.placedIconSymbolIndex),m.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let O_,k_;Ht("SymbolBucket",Kh,{omit:["layers","collisionBoxArray","features","compareText"]}),Kh.MAX_GLYPHS=65535,Kh.addDynamicAttributes=Eo;var D_={get paint(){return k_=k_||new Vi({"icon-opacity":new tr(He.paint_symbol["icon-opacity"]),"icon-color":new tr(He.paint_symbol["icon-color"]),"icon-halo-color":new tr(He.paint_symbol["icon-halo-color"]),"icon-halo-width":new tr(He.paint_symbol["icon-halo-width"]),"icon-halo-blur":new tr(He.paint_symbol["icon-halo-blur"]),"icon-translate":new Qt(He.paint_symbol["icon-translate"]),"icon-translate-anchor":new Qt(He.paint_symbol["icon-translate-anchor"]),"text-opacity":new tr(He.paint_symbol["text-opacity"]),"text-color":new tr(He.paint_symbol["text-color"],{runtimeType:Pi,getOverride:f=>f.textColor,hasOverride:f=>!!f.textColor}),"text-halo-color":new tr(He.paint_symbol["text-halo-color"]),"text-halo-width":new tr(He.paint_symbol["text-halo-width"]),"text-halo-blur":new tr(He.paint_symbol["text-halo-blur"]),"text-translate":new Qt(He.paint_symbol["text-translate"]),"text-translate-anchor":new Qt(He.paint_symbol["text-translate-anchor"])})},get layout(){return O_=O_||new Vi({"symbol-placement":new Qt(He.layout_symbol["symbol-placement"]),"symbol-spacing":new Qt(He.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Qt(He.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new tr(He.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Qt(He.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Qt(He.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Qt(He.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Qt(He.layout_symbol["icon-ignore-placement"]),"icon-optional":new Qt(He.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Qt(He.layout_symbol["icon-rotation-alignment"]),"icon-size":new tr(He.layout_symbol["icon-size"]),"icon-text-fit":new Qt(He.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Qt(He.layout_symbol["icon-text-fit-padding"]),"icon-image":new tr(He.layout_symbol["icon-image"]),"icon-rotate":new tr(He.layout_symbol["icon-rotate"]),"icon-padding":new tr(He.layout_symbol["icon-padding"]),"icon-keep-upright":new Qt(He.layout_symbol["icon-keep-upright"]),"icon-offset":new tr(He.layout_symbol["icon-offset"]),"icon-anchor":new tr(He.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Qt(He.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Qt(He.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Qt(He.layout_symbol["text-rotation-alignment"]),"text-field":new tr(He.layout_symbol["text-field"]),"text-font":new tr(He.layout_symbol["text-font"]),"text-size":new tr(He.layout_symbol["text-size"]),"text-max-width":new tr(He.layout_symbol["text-max-width"]),"text-line-height":new Qt(He.layout_symbol["text-line-height"]),"text-letter-spacing":new tr(He.layout_symbol["text-letter-spacing"]),"text-justify":new tr(He.layout_symbol["text-justify"]),"text-radial-offset":new tr(He.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Qt(He.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new tr(He.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new tr(He.layout_symbol["text-anchor"]),"text-max-angle":new Qt(He.layout_symbol["text-max-angle"]),"text-writing-mode":new Qt(He.layout_symbol["text-writing-mode"]),"text-rotate":new tr(He.layout_symbol["text-rotate"]),"text-padding":new Qt(He.layout_symbol["text-padding"]),"text-keep-upright":new Qt(He.layout_symbol["text-keep-upright"]),"text-transform":new tr(He.layout_symbol["text-transform"]),"text-offset":new tr(He.layout_symbol["text-offset"]),"text-allow-overlap":new Qt(He.layout_symbol["text-allow-overlap"]),"text-overlap":new Qt(He.layout_symbol["text-overlap"]),"text-ignore-placement":new Qt(He.layout_symbol["text-ignore-placement"]),"text-optional":new Qt(He.layout_symbol["text-optional"])})}};class Om{constructor(l){if(l.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=l.property.overrides?l.property.overrides.runtimeType:qn,this.defaultValue=l}evaluate(l){if(l.formattedSection){const h=this.defaultValue.property.overrides;if(h&&h.hasOverride(l.formattedSection))return h.getOverride(l.formattedSection)}return l.feature&&l.featureState?this.defaultValue.evaluate(l.feature,l.featureState):this.defaultValue.property.specification.default}eachChild(l){this.defaultValue.isConstant()||l(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ht("FormatSectionOverride",Om,{omit:["defaultValue"]});class Hp extends ei{constructor(l,h){super(l,D_,h)}recalculate(l,h){if(super.recalculate(l,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const m=this.layout.get("text-writing-mode");if(m){const x=[];for(const A of m)x.indexOf(A)<0&&x.push(A);this.layout._values["text-writing-mode"]=x}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(l,h,m,x){const A=this.layout.get(l).evaluate(h,{},m,x),P=this._unevaluatedLayout._values[l];return P.isDataDriven()||Oh(P.value)||!A?A:(function(R,D){return D.replace(/{([^{}]+)}/g,((U,$)=>R&&$ in R?String(R[$]):""))})(h.properties,A)}createBucket(l){return new Kh(l)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const l of D_.paint.overridableProperties){if(!Hp.hasPaintOverride(this.layout,l))continue;const h=this.paint.get(l),m=new Om(h),x=new Rh(m,h.property.specification);let A=null;A=h.value.kind==="constant"||h.value.kind==="source"?new Au("source",x):new Fs("composite",x,h.value.zoomStops),this.paint._values[l]=new Vs(h.property,A,h.parameters)}}_handleOverridablePaintPropertyUpdate(l,h,m){return!(!this.layout||h.isDataDriven()||m.isDataDriven())&&Hp.hasPaintOverride(this.layout,l)}static hasPaintOverride(l,h){const m=l.get("text-field"),x=D_.paint.properties[h];let A=!1;const P=R=>{for(const D of R)if(x.overrides&&x.overrides.hasOverride(D))return void(A=!0)};if(m.value.kind==="constant"&&m.value.value instanceof Yi)P(m.value.value.sections);else if(m.value.kind==="source"||m.value.kind==="composite"){const R=U=>{A||(U instanceof to&&hr(U.value)===Ka?P(U.value.sections):U instanceof Cc?P(U.sections):U.eachChild(R))},D=m.value;D._styleExpression&&R(D._styleExpression.expression)}return A}}let L_;var Iw={get paint(){return L_=L_||new Vi({"background-color":new Qt(He.paint_background["background-color"]),"background-pattern":new _p(He.paint_background["background-pattern"]),"background-opacity":new Qt(He.paint_background["background-opacity"])})}};class B_ extends ei{constructor(l,h){super(l,Iw,h)}}let km;var Rw={get paint(){return km=km||new Vi({"raster-opacity":new Qt(He.paint_raster["raster-opacity"]),"raster-hue-rotate":new Qt(He.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Qt(He.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Qt(He.paint_raster["raster-brightness-max"]),"raster-saturation":new Qt(He.paint_raster["raster-saturation"]),"raster-contrast":new Qt(He.paint_raster["raster-contrast"]),"raster-resampling":new Qt(He.paint_raster["raster-resampling"]),"raster-fade-duration":new Qt(He.paint_raster["raster-fade-duration"])})}};class Ow extends ei{constructor(l,h){super(l,Rw,h)}}class Wp extends ei{constructor(l,h){super(l,{},h),this.onAdd=m=>{this.implementation.onAdd&&this.implementation.onAdd(m,m.painter.context.gl)},this.onRemove=m=>{this.implementation.onRemove&&this.implementation.onRemove(m,m.painter.context.gl)},this.implementation=l}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class kw{constructor(l){this._methodToThrottle=l,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const sb={once:!0},jr=63710088e-1;class nc{constructor(l,h){if(isNaN(l)||isNaN(h))throw new Error(`Invalid LngLat object: (${l}, ${h})`);if(this.lng=+l,this.lat=+h,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new nc(Gt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(l){const h=Math.PI/180,m=this.lat*h,x=l.lat*h,A=Math.sin(m)*Math.sin(x)+Math.cos(m)*Math.cos(x)*Math.cos((l.lng-this.lng)*h);return jr*Math.acos(Math.min(A,1))}static convert(l){if(l instanceof nc)return l;if(Array.isArray(l)&&(l.length===2||l.length===3))return new nc(Number(l[0]),Number(l[1]));if(!Array.isArray(l)&&typeof l=="object"&&l!==null)return new nc(Number("lng"in l?l.lng:l.lon),Number(l.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const qp=2*Math.PI*jr;function Dm(f){return qp*Math.cos(f*Math.PI/180)}function N_(f){return(180+f)/360}function Lm(f){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+f*Math.PI/360)))/360}function pd(f,l){return f/Dm(l)}function gd(f){return 360/Math.PI*Math.atan(Math.exp((180-360*f)*Math.PI/180))-90}function ab(f,l){return f*Dm(gd(l))}class md{constructor(l,h,m=0){this.x=+l,this.y=+h,this.z=+m}static fromLngLat(l,h=0){const m=nc.convert(l);return new md(N_(m.lng),Lm(m.lat),pd(h,m.lat))}toLngLat(){return new nc(360*this.x-180,gd(this.y))}toAltitude(){return ab(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/qp*(l=gd(this.y),1/Math.cos(l*Math.PI/180));var l}}function ob(f,l,h){var m=2*Math.PI*6378137/256/Math.pow(2,h);return[f*m-2*Math.PI*6378137/2,l*m-2*Math.PI*6378137/2]}class z_{constructor(l,h,m){if(!(function(x,A,P){return!(x<0||x>25||P<0||P>=Math.pow(2,x)||A<0||A>=Math.pow(2,x))})(l,h,m))throw new Error(`x=${h}, y=${m}, z=${l} outside of bounds. 0<=x<${Math.pow(2,l)}, 0<=y<${Math.pow(2,l)} 0<=z<=25 `);this.z=l,this.x=h,this.y=m,this.key=tn(0,l,l,h,m)}equals(l){return this.z===l.z&&this.x===l.x&&this.y===l.y}url(l,h,m){const x=(P=this.y,R=this.z,D=ob(256*(A=this.x),256*(P=Math.pow(2,R)-P-1),R),U=ob(256*(A+1),256*(P+1),R),D[0]+","+D[1]+","+U[0]+","+U[1]);var A,P,R,D,U;const $=(function(G,ee,re){let ne,le="";for(let de=G;de>0;de--)ne=1<<de-1,le+=(ee&ne?1:0)+(re&ne?2:0);return le})(this.z,this.x,this.y);return l[(this.x+this.y)%l.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(m==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,h>1?"@2x":"").replace(/{quadkey}/g,$).replace(/{bbox-epsg-3857}/g,x)}isChildOf(l){const h=this.z-l.z;return h>0&&l.x===this.x>>h&&l.y===this.y>>h}getTilePoint(l){const h=Math.pow(2,this.z);return new g((l.x*h-this.x)*Ue,(l.y*h-this.y)*Ue)}toString(){return`${this.z}/${this.x}/${this.y}`}}class F_{constructor(l,h){this.wrap=l,this.canonical=h,this.key=tn(l,h.z,h.z,h.x,h.y)}}class Aa{constructor(l,h,m,x,A){if(this.terrainRttPosMatrix32f=null,l<m)throw new Error(`overscaledZ should be >= z; overscaledZ = ${l}; z = ${m}`);this.overscaledZ=l,this.wrap=h,this.canonical=new z_(m,+x,+A),this.key=tn(h,l,m,x,A)}clone(){return new Aa(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(l){return this.overscaledZ===l.overscaledZ&&this.wrap===l.wrap&&this.canonical.equals(l.canonical)}scaledTo(l){if(l>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${l}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-l;return l>this.canonical.z?new Aa(l,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Aa(l,this.wrap,l,this.canonical.x>>h,this.canonical.y>>h)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(l,h){if(l>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${l}; overscaledZ = ${this.overscaledZ}`);const m=this.canonical.z-l;return l>this.canonical.z?tn(this.wrap*+h,l,this.canonical.z,this.canonical.x,this.canonical.y):tn(this.wrap*+h,l,l,this.canonical.x>>m,this.canonical.y>>m)}isChildOf(l){if(l.wrap!==this.wrap||this.overscaledZ-l.overscaledZ<=0)return!1;if(l.overscaledZ===0)return this.overscaledZ>0;const h=this.canonical.z-l.canonical.z;return!(h<0)&&l.canonical.x===this.canonical.x>>h&&l.canonical.y===this.canonical.y>>h}children(l){if(this.overscaledZ>=l)return[new Aa(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const h=this.canonical.z+1,m=2*this.canonical.x,x=2*this.canonical.y;return[new Aa(h,this.wrap,h,m,x),new Aa(h,this.wrap,h,m+1,x),new Aa(h,this.wrap,h,m,x+1),new Aa(h,this.wrap,h,m+1,x+1)]}isLessThan(l){return this.wrap<l.wrap||!(this.wrap>l.wrap)&&(this.overscaledZ<l.overscaledZ||!(this.overscaledZ>l.overscaledZ)&&(this.canonical.x<l.canonical.x||!(this.canonical.x>l.canonical.x)&&this.canonical.y<l.canonical.y))}wrapped(){return new Aa(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(l){return new Aa(this.overscaledZ,l,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new F_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(l){return this.canonical.getTilePoint(new md(l.x-this.wrap,l.y))}}function tn(f,l,h,m,x){(f*=2)<0&&(f=-1*f-1);const A=1<<h;return(A*A*f+A*x+m).toString(36)+h.toString(36)+l.toString(36)}function Qh(f,l){return l?f.properties[l]:f.id}Ht("CanonicalTileID",z_),Ht("OverscaledTileID",Aa,{omit:["terrainRttPosMatrix32f"]});class oi{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(l){return this.minX=Math.min(this.minX,l.x),this.minY=Math.min(this.minY,l.y),this.maxX=Math.max(this.maxX,l.x),this.maxY=Math.max(this.maxY,l.y),this}expandBy(l){return this.minX-=l,this.minY-=l,this.maxX+=l,this.maxY+=l,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(l){return this.expandBy(-l)}map(l){const h=new oi;return h.extend(l(new g(this.minX,this.minY))),h.extend(l(new g(this.maxX,this.minY))),h.extend(l(new g(this.minX,this.maxY))),h.extend(l(new g(this.maxX,this.maxY))),h}static fromPoints(l){const h=new oi;for(const m of l)h.extend(m);return h}contains(l){return l.x>=this.minX&&l.x<=this.maxX&&l.y>=this.minY&&l.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(l){return!this.empty()&&!l.empty()&&l.minX>=this.minX&&l.maxX<=this.maxX&&l.minY>=this.minY&&l.maxY<=this.maxY}intersects(l){return!this.empty()&&!l.empty()&&l.minX<=this.maxX&&l.maxX>=this.minX&&l.minY<=this.maxY&&l.maxY>=this.minY}}class lb{constructor(l){this._stringToNumber={},this._numberToString=[];for(let h=0;h<l.length;h++){const m=l[h];this._stringToNumber[m]=h,this._numberToString[h]=m}}encode(l){return this._stringToNumber[l]}decode(l){if(l>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${l} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[l]}}class U_{constructor(l,h,m,x,A){this.type="Feature",this._vectorTileFeature=l,l._z=h,l._x=m,l._y=x,this.properties=l.properties,this.id=A}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(l){this._geometry=l}toJSON(){const l={geometry:this.geometry};for(const h in this)h!=="_geometry"&&h!=="_vectorTileFeature"&&(l[h]=this[h]);return l}}class cb{constructor(l,h){this.tileID=l,this.x=l.canonical.x,this.y=l.canonical.y,this.z=l.canonical.z,this.grid=new aa(Ue,16,0),this.grid3D=new aa(Ue,16,0),this.featureIndexArray=new ot,this.promoteId=h}insert(l,h,m,x,A,P){const R=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(m,x,A);const D=P?this.grid3D:this.grid;for(let U=0;U<h.length;U++){const $=h[U],G=[1/0,1/0,-1/0,-1/0];for(let ee=0;ee<$.length;ee++){const re=$[ee];G[0]=Math.min(G[0],re.x),G[1]=Math.min(G[1],re.y),G[2]=Math.max(G[2],re.x),G[3]=Math.max(G[3],re.y)}G[0]<Ue&&G[1]<Ue&&G[2]>=0&&G[3]>=0&&D.insert(R,G[0],G[1],G[2],G[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new __(new Yh(this.rawTileData)).layers,this.sourceLayerCoder=new lb(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(l,h,m,x){this.loadVTLayers();const A=l.params,P=Ue/l.tileSize/l.scale,R=as(A.filter,A.globalState),D=l.queryGeometry,U=l.queryPadding*P,$=oi.fromPoints(D),G=this.grid.query($.minX-U,$.minY-U,$.maxX+U,$.maxY+U),ee=oi.fromPoints(l.cameraQueryGeometry).expandBy(U),re=this.grid3D.query(ee.minX,ee.minY,ee.maxX,ee.maxY,((de,xe,$e,Ie)=>(function(De,et,ft,St,Vt){for(const jt of De)if(et<=jt.x&&ft<=jt.y&&St>=jt.x&&Vt>=jt.y)return!0;const zt=[new g(et,ft),new g(et,Vt),new g(St,Vt),new g(St,ft)];if(De.length>2){for(const jt of zt)if(nd(De,jt))return!0}for(let jt=0;jt<De.length-1;jt++)if(i_(De[jt],De[jt+1],zt))return!0;return!1})(l.cameraQueryGeometry,de-U,xe-U,$e+U,Ie+U)));for(const de of re)G.push(de);G.sort(j_);const ne={};let le;for(let de=0;de<G.length;de++){const xe=G[de];if(xe===le)continue;le=xe;const $e=this.featureIndexArray.get(xe);let Ie=null;this.loadMatchingFeature(ne,$e.bucketIndex,$e.sourceLayerIndex,$e.featureIndex,R,A.layers,A.availableImages,h,m,x,((De,et,ft)=>(Ie||(Ie=Lu(De)),et.queryIntersectsFeature({queryGeometry:D,feature:De,featureState:ft,geometry:Ie,zoom:this.z,transform:l.transform,pixelsToTileUnits:P,pixelPosMatrix:l.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:l.getElevation}))))}return ne}loadMatchingFeature(l,h,m,x,A,P,R,D,U,$,G){const ee=this.bucketLayerIDs[h];if(P&&!ee.some((de=>P.has(de))))return;const re=this.sourceLayerCoder.decode(m),ne=this.vtLayers[re].feature(x);if(A.needGeometry){const de=jc(ne,!0);if(!A.filter(new Qr(this.tileID.overscaledZ),de,this.tileID.canonical))return}else if(!A.filter(new Qr(this.tileID.overscaledZ),ne))return;const le=this.getId(ne,re);for(let de=0;de<ee.length;de++){const xe=ee[de];if(P&&!P.has(xe))continue;const $e=D[xe];if(!$e)continue;let Ie={};le&&$&&(Ie=$.getState($e.sourceLayer||"_geojsonTileLayer",le));const De=nr({},U[xe]);De.paint=Bm(De.paint,$e.paint,ne,Ie,R),De.layout=Bm(De.layout,$e.layout,ne,Ie,R);const et=!G||G(ne,$e,Ie);if(!et)continue;const ft=new U_(ne,this.z,this.x,this.y,le);ft.layer=De;let St=l[xe];St===void 0&&(St=l[xe]=[]),St.push({featureIndex:x,feature:ft,intersectionZ:et})}}lookupSymbolFeatures(l,h,m,x,A,P,R,D){const U={};this.loadVTLayers();const $=as(A.filterSpec,A.globalState);for(const G of l)this.loadMatchingFeature(U,m,x,G,$,P,R,D,h);return U}hasLayer(l){for(const h of this.bucketLayerIDs)for(const m of h)if(l===m)return!0;return!1}getId(l,h){var m;let x=l.id;return this.promoteId&&(x=l.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[h]],typeof x=="boolean"&&(x=Number(x)),x===void 0&&(!((m=l.properties)===null||m===void 0)&&m.cluster)&&this.promoteId&&(x=Number(l.properties.cluster_id))),x}}function Bm(f,l,h,m,x){return Wt(f,((A,P)=>{const R=l instanceof Hh?l.get(P):null;return R&&R.evaluate?R.evaluate(h,m,x):R}))}function j_(f,l){return l-f}function Gp(f,l,h,m,x){const A=[];for(let P=0;P<f.length;P++){const R=f[P];let D;for(let U=0;U<R.length-1;U++){let $=R[U],G=R[U+1];$.x<l&&G.x<l||($.x<l?$=new g(l,$.y+(l-$.x)/(G.x-$.x)*(G.y-$.y))._round():G.x<l&&(G=new g(l,$.y+(l-$.x)/(G.x-$.x)*(G.y-$.y))._round()),$.y<h&&G.y<h||($.y<h?$=new g($.x+(h-$.y)/(G.y-$.y)*(G.x-$.x),h)._round():G.y<h&&(G=new g($.x+(h-$.y)/(G.y-$.y)*(G.x-$.x),h)._round()),$.x>=m&&G.x>=m||($.x>=m?$=new g(m,$.y+(m-$.x)/(G.x-$.x)*(G.y-$.y))._round():G.x>=m&&(G=new g(m,$.y+(m-$.x)/(G.x-$.x)*(G.y-$.y))._round()),$.y>=x&&G.y>=x||($.y>=x?$=new g($.x+(x-$.y)/(G.y-$.y)*(G.x-$.x),x)._round():G.y>=x&&(G=new g($.x+(x-$.y)/(G.y-$.y)*(G.x-$.x),x)._round()),D&&$.equals(D[D.length-1])||(D=[$],A.push(D)),D.push(G)))))}}return A}Ht("FeatureIndex",cb,{omit:["rawTileData","sourceLayerCoder"]});class Zc extends g{constructor(l,h,m,x){super(l,h),this.angle=m,x!==void 0&&(this.segment=x)}clone(){return new Zc(this.x,this.y,this.angle,this.segment)}}function V_(f,l,h,m,x){if(l.segment===void 0||h===0)return!0;let A=l,P=l.segment+1,R=0;for(;R>-h/2;){if(P--,P<0)return!1;R-=f[P].dist(A),A=f[P]}R+=f[P].dist(f[P+1]),P++;const D=[];let U=0;for(;R<h/2;){const $=f[P],G=f[P+1];if(!G)return!1;let ee=f[P-1].angleTo($)-$.angleTo(G);for(ee=Math.abs((ee+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:R,angleDelta:ee}),U+=ee;R-D[0].distance>m;)U-=D.shift().angleDelta;if(U>x)return!1;P++,R+=$.dist(G)}return!0}function Nm(f){let l=0;for(let h=0;h<f.length-1;h++)l+=f[h].dist(f[h+1]);return l}function zm(f,l,h){return f?.6*l*h:0}function ub(f,l){return Math.max(f?f.right-f.left:0,l?l.right-l.left:0)}function hb(f,l,h,m,x,A){const P=zm(h,x,A),R=ub(h,m)*A;let D=0;const U=Nm(f)/2;for(let $=0;$<f.length-1;$++){const G=f[$],ee=f[$+1],re=G.dist(ee);if(D+re>U){const ne=(U-D)/re,le=io.number(G.x,ee.x,ne),de=io.number(G.y,ee.y,ne),xe=new Zc(le,de,ee.angleTo(G),$);return xe._round(),!P||V_(f,xe,R,P,l)?xe:void 0}D+=re}}function Dw(f,l,h,m,x,A,P,R,D){const U=zm(m,A,P),$=ub(m,x),G=$*P,ee=f[0].x===0||f[0].x===D||f[0].y===0||f[0].y===D;return l-G<l/4&&(l=G+l/4),$_(f,ee?l/2*R%l:($/2+2*A)*P*R%l,l,U,h,G,ee,!1,D)}function $_(f,l,h,m,x,A,P,R,D){const U=A/2,$=Nm(f);let G=0,ee=l-h,re=[];for(let ne=0;ne<f.length-1;ne++){const le=f[ne],de=f[ne+1],xe=le.dist(de),$e=de.angleTo(le);for(;ee+h<G+xe;){ee+=h;const Ie=(ee-G)/xe,De=io.number(le.x,de.x,Ie),et=io.number(le.y,de.y,Ie);if(De>=0&&De<D&&et>=0&&et<D&&ee-U>=0&&ee+U<=$){const ft=new Zc(De,et,$e,ne);ft._round(),m&&!V_(f,ft,A,m,x)||re.push(ft)}}G+=xe}return R||re.length||P||(re=$_(f,G/2,h,m,x,A,P,!0,D)),re}function fb(f,l,h,m){const x=[],A=f.image,P=A.pixelRatio,R=A.paddedRect.w-2,D=A.paddedRect.h-2;let U={x1:f.left,y1:f.top,x2:f.right,y2:f.bottom};const $=A.stretchX||[[0,R]],G=A.stretchY||[[0,D]],ee=(yt,dr)=>yt+dr[1]-dr[0],re=$.reduce(ee,0),ne=G.reduce(ee,0),le=R-re,de=D-ne;let xe=0,$e=re,Ie=0,De=ne,et=0,ft=le,St=0,Vt=de;if(A.content&&m){const yt=A.content,dr=yt[2]-yt[0],pr=yt[3]-yt[1];(A.textFitWidth||A.textFitHeight)&&(U=nb(f)),xe=Fm($,0,yt[0]),Ie=Fm(G,0,yt[1]),$e=Fm($,yt[0],yt[2]),De=Fm(G,yt[1],yt[3]),et=yt[0]-xe,St=yt[1]-Ie,ft=dr-$e,Vt=pr-De}const zt=U.x1,jt=U.y1,rr=U.x2-zt,Ft=U.y2-jt,Ut=(yt,dr,pr,ar)=>{const Jt=Xp(yt.stretch-xe,$e,rr,zt),Nr=Zp(yt.fixed-et,ft,yt.stretch,re),Ln=Xp(dr.stretch-Ie,De,Ft,jt),ri=Zp(dr.fixed-St,Vt,dr.stretch,ne),qi=Xp(pr.stretch-xe,$e,rr,zt),Ea=Zp(pr.fixed-et,ft,pr.stretch,re),Ts=Xp(ar.stretch-Ie,De,Ft,jt),Fn=Zp(ar.fixed-St,Vt,ar.stretch,ne),rn=new g(Jt,Ln),Bn=new g(qi,Ln),li=new g(qi,Ts),ci=new g(Jt,Ts),ui=new g(Nr/P,ri/P),Ha=new g(Ea/P,Fn/P),Di=l*Math.PI/180;if(Di){const Bi=Math.sin(Di),hi=Math.cos(Di),fi=[hi,-Bi,Bi,hi];rn._matMult(fi),Bn._matMult(fi),ci._matMult(fi),li._matMult(fi)}const Ji=yt.stretch+yt.fixed,Li=dr.stretch+dr.fixed;return{tl:rn,tr:Bn,bl:ci,br:li,tex:{x:A.paddedRect.x+1+Ji,y:A.paddedRect.y+1+Li,w:pr.stretch+pr.fixed-Ji,h:ar.stretch+ar.fixed-Li},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ui,pixelOffsetBR:Ha,minFontScaleX:ft/P/rr,minFontScaleY:Vt/P/Ft,isSDF:h}};if(m&&(A.stretchX||A.stretchY)){const yt=Yc($,le,re),dr=Yc(G,de,ne);for(let pr=0;pr<yt.length-1;pr++){const ar=yt[pr],Jt=yt[pr+1];for(let Nr=0;Nr<dr.length-1;Nr++)x.push(Ut(ar,dr[Nr],Jt,dr[Nr+1]))}}else x.push(Ut({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:R+1},{fixed:0,stretch:D+1}));return x}function Fm(f,l,h){let m=0;for(const x of f)m+=Math.max(l,Math.min(h,x[1]))-Math.max(l,Math.min(h,x[0]));return m}function Yc(f,l,h){const m=[{fixed:-1,stretch:0}];for(const[x,A]of f){const P=m[m.length-1];m.push({fixed:x-P.stretch,stretch:P.stretch}),m.push({fixed:x-P.stretch,stretch:P.stretch+(A-x)})}return m.push({fixed:l+1,stretch:h}),m}function Xp(f,l,h,m){return f/l*h+m}function Zp(f,l,h,m){return f-l*h/m}Ht("Anchor",Zc);class yd{constructor(l,h,m,x,A,P,R,D,U,$){var G;if(this.boxStartIndex=l.length,U){let ee=P.top,re=P.bottom;const ne=P.collisionPadding;ne&&(ee-=ne[1],re+=ne[3]);let le=re-ee;le>0&&(le=Math.max(10,le),this.circleDiameter=le)}else{const ee=!((G=P.image)===null||G===void 0)&&G.content&&(P.image.textFitWidth||P.image.textFitHeight)?nb(P):{x1:P.left,y1:P.top,x2:P.right,y2:P.bottom};ee.y1=ee.y1*R-D[0],ee.y2=ee.y2*R+D[2],ee.x1=ee.x1*R-D[3],ee.x2=ee.x2*R+D[1];const re=P.collisionPadding;if(re&&(ee.x1-=re[0]*R,ee.y1-=re[1]*R,ee.x2+=re[2]*R,ee.y2+=re[3]*R),$){const ne=new g(ee.x1,ee.y1),le=new g(ee.x2,ee.y1),de=new g(ee.x1,ee.y2),xe=new g(ee.x2,ee.y2),$e=$*Math.PI/180;ne._rotate($e),le._rotate($e),de._rotate($e),xe._rotate($e),ee.x1=Math.min(ne.x,le.x,de.x,xe.x),ee.x2=Math.max(ne.x,le.x,de.x,xe.x),ee.y1=Math.min(ne.y,le.y,de.y,xe.y),ee.y2=Math.max(ne.y,le.y,de.y,xe.y)}l.emplaceBack(h.x,h.y,ee.x1,ee.y1,ee.x2,ee.y2,m,x,A)}this.boxEndIndex=l.length}}class Lw{constructor(l=[],h=(m,x)=>m<x?-1:m>x?1:0){if(this.data=l,this.length=this.data.length,this.compare=h,this.length>0)for(let m=(this.length>>1)-1;m>=0;m--)this._down(m)}push(l){this.data.push(l),this._up(this.length++)}pop(){if(this.length===0)return;const l=this.data[0],h=this.data.pop();return--this.length>0&&(this.data[0]=h,this._down(0)),l}peek(){return this.data[0]}_up(l){const{data:h,compare:m}=this,x=h[l];for(;l>0;){const A=l-1>>1,P=h[A];if(m(x,P)>=0)break;h[l]=P,l=A}h[l]=x}_down(l){const{data:h,compare:m}=this,x=this.length>>1,A=h[l];for(;l<x;){let P=1+(l<<1);const R=P+1;if(R<this.length&&m(h[R],h[P])<0&&(P=R),m(h[P],A)>=0)break;h[l]=h[P],l=P}h[l]=A}}function Bw(f,l=1,h=!1){const m=oi.fromPoints(f[0]),x=Math.min(m.width(),m.height());let A=x/2;const P=new Lw([],db),{minX:R,minY:D,maxX:U,maxY:$}=m;if(x===0)return new g(R,D);for(let re=R;re<U;re+=x)for(let ne=D;ne<$;ne+=x)P.push(new Gu(re+A,ne+A,A,f));let G=(function(re){let ne=0,le=0,de=0;const xe=re[0];for(let $e=0,Ie=xe.length,De=Ie-1;$e<Ie;De=$e++){const et=xe[$e],ft=xe[De],St=et.x*ft.y-ft.x*et.y;le+=(et.x+ft.x)*St,de+=(et.y+ft.y)*St,ne+=3*St}return new Gu(le/ne,de/ne,0,re)})(f),ee=P.length;for(;P.length;){const re=P.pop();(re.d>G.d||!G.d)&&(G=re,h&&console.log("found best %d after %d probes",Math.round(1e4*re.d)/1e4,ee)),re.max-G.d<=l||(A=re.h/2,P.push(new Gu(re.p.x-A,re.p.y-A,A,f)),P.push(new Gu(re.p.x+A,re.p.y-A,A,f)),P.push(new Gu(re.p.x-A,re.p.y+A,A,f)),P.push(new Gu(re.p.x+A,re.p.y+A,A,f)),ee+=4)}return h&&(console.log(`num probes: ${ee}`),console.log(`best distance: ${G.d}`)),G.p}function db(f,l){return l.max-f.max}function Gu(f,l,h,m){this.p=new g(f,l),this.h=h,this.d=(function(x,A){let P=!1,R=1/0;for(let D=0;D<A.length;D++){const U=A[D];for(let $=0,G=U.length,ee=G-1;$<G;ee=$++){const re=U[$],ne=U[ee];re.y>x.y!=ne.y>x.y&&x.x<(ne.x-re.x)*(x.y-re.y)/(ne.y-re.y)+re.x&&(P=!P),R=Math.min(R,r_(x,re,ne))}}return(P?1:-1)*Math.sqrt(R)})(this.p,m),this.max=this.d+this.h*Math.SQRT2}var Wi;c.aE=void 0,(Wi=c.aE||(c.aE={}))[Wi.center=1]="center",Wi[Wi.left=2]="left",Wi[Wi.right=3]="right",Wi[Wi.top=4]="top",Wi[Wi.bottom=5]="bottom",Wi[Wi["top-left"]=6]="top-left",Wi[Wi["top-right"]=7]="top-right",Wi[Wi["bottom-left"]=8]="bottom-left",Wi[Wi["bottom-right"]=9]="bottom-right";const H_=Number.POSITIVE_INFINITY;function $a(f,l){return l[1]!==H_?(function(h,m,x){let A=0,P=0;switch(m=Math.abs(m),x=Math.abs(x),h){case"top-right":case"top-left":case"top":P=x-7;break;case"bottom-right":case"bottom-left":case"bottom":P=7-x}switch(h){case"top-right":case"bottom-right":case"right":A=-m;break;case"top-left":case"bottom-left":case"left":A=m}return[A,P]})(f,l[0],l[1]):(function(h,m){let x=0,A=0;m<0&&(m=0);const P=m/Math.SQRT2;switch(h){case"top-right":case"top-left":A=P-7;break;case"bottom-right":case"bottom-left":A=7-P;break;case"bottom":A=7-m;break;case"top":A=m-7}switch(h){case"top-right":case"bottom-right":x=-P;break;case"top-left":case"bottom-left":x=P;break;case"left":x=m;break;case"right":x=-m}return[x,A]})(f,l[0])}function Um(f,l,h){var m;const x=f.layout,A=(m=x.get("text-variable-anchor-offset"))===null||m===void 0?void 0:m.evaluate(l,{},h);if(A){const R=A.values,D=[];for(let U=0;U<R.length;U+=2){const $=D[U]=R[U],G=R[U+1].map((ee=>ee*Rn));$.startsWith("top")?G[1]-=7:$.startsWith("bottom")&&(G[1]+=7),D[U+1]=G}return new Mi(D)}const P=x.get("text-variable-anchor");if(P){let R;R=f._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[x.get("text-radial-offset").evaluate(l,{},h)*Rn,H_]:x.get("text-offset").evaluate(l,{},h).map((U=>U*Rn));const D=[];for(const U of P)D.push(U,$a(U,R));return new Mi(D)}return null}function jm(f){switch(f){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function pb(f,l,h,m,x,A,P,R,D,U,$,G){let ee=A.textMaxSize.evaluate(l,{});ee===void 0&&(ee=P);const re=f.layers[0].layout,ne=re.get("icon-offset").evaluate(l,{},$),le=_d(h.horizontal),de=P/24,xe=f.tilePixelRatio*de,$e=f.tilePixelRatio*ee/24,Ie=f.tilePixelRatio*R,De=f.tilePixelRatio*re.get("symbol-spacing"),et=re.get("text-padding")*f.tilePixelRatio,ft=(function(pr,ar,Jt,Nr=1){const Ln=pr.get("icon-padding").evaluate(ar,{},Jt),ri=Ln&&Ln.values;return[ri[0]*Nr,ri[1]*Nr,ri[2]*Nr,ri[3]*Nr]})(re,l,$,f.tilePixelRatio),St=re.get("text-max-angle")/180*Math.PI,Vt=re.get("text-rotation-alignment")!=="viewport"&&re.get("symbol-placement")!=="point",zt=re.get("icon-rotation-alignment")==="map"&&re.get("symbol-placement")!=="point",jt=re.get("symbol-placement"),rr=De/2,Ft=re.get("icon-text-fit");let Ut;m&&Ft!=="none"&&(f.allowVerticalPlacement&&h.vertical&&(Ut=ib(m,h.vertical,Ft,re.get("icon-text-fit-padding"),ne,de)),le&&(m=ib(m,le,Ft,re.get("icon-text-fit-padding"),ne,de)));const yt=$?G.line.getGranularityForZoomLevel($.z):1,dr=(pr,ar)=>{ar.x<0||ar.x>=Ue||ar.y<0||ar.y>=Ue||(function(Jt,Nr,Ln,ri,qi,Ea,Ts,Fn,rn,Bn,li,ci,ui,Ha,Di,Ji,Li,Bi,hi,fi,On,Ca,Kc,Po,bd){const Jh=Jt.addToLineVertexArray(Nr,Ln);let Qc,Jc,ef,xd,Qp=0,u=0,p=0,b=0,S=-1,k=-1;const z={};let J=ja("");if(Jt.allowVerticalPlacement&&ri.vertical){const Tr=Fn.layout.get("text-rotate").evaluate(On,{},Po)+90;ef=new yd(rn,Nr,Bn,li,ci,ri.vertical,ui,Ha,Di,Tr),Ts&&(xd=new yd(rn,Nr,Bn,li,ci,Ts,Li,Bi,Di,Tr))}if(qi){const Tr=Fn.layout.get("icon-rotate").evaluate(On,{}),Kt=Fn.layout.get("icon-text-fit")!=="none",Er=fb(qi,Tr,Kc,Kt),Mr=Ts?fb(Ts,Tr,Kc,Kt):void 0;Jc=new yd(rn,Nr,Bn,li,ci,qi,Li,Bi,!1,Tr),Qp=4*Er.length;const qr=Jt.iconSizeData;let Ss=null;qr.kind==="source"?(Ss=[Ao*Fn.layout.get("icon-size").evaluate(On,{})],Ss[0]>Va&&cr(`${Jt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):qr.kind==="composite"&&(Ss=[Ao*Ca.compositeIconSizes[0].evaluate(On,{},Po),Ao*Ca.compositeIconSizes[1].evaluate(On,{},Po)],(Ss[0]>Va||Ss[1]>Va)&&cr(`${Jt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Jt.addSymbols(Jt.icon,Er,Ss,fi,hi,On,c.ao.none,Nr,Jh.lineStartIndex,Jh.lineLength,-1,Po),S=Jt.icon.placedSymbolArray.length-1,Mr&&(u=4*Mr.length,Jt.addSymbols(Jt.icon,Mr,Ss,fi,hi,On,c.ao.vertical,Nr,Jh.lineStartIndex,Jh.lineLength,-1,Po),k=Jt.icon.placedSymbolArray.length-1)}const he=Object.keys(ri.horizontal);for(const Tr of he){const Kt=ri.horizontal[Tr];if(!Qc){J=ja(Kt.text);const Mr=Fn.layout.get("text-rotate").evaluate(On,{},Po);Qc=new yd(rn,Nr,Bn,li,ci,Kt,ui,Ha,Di,Mr)}const Er=Kt.positionedLines.length===1;if(p+=W_(Jt,Nr,Kt,Ea,Fn,Di,On,Ji,Jh,ri.vertical?c.ao.horizontal:c.ao.horizontalOnly,Er?he:[Tr],z,S,Ca,Po),Er)break}ri.vertical&&(b+=W_(Jt,Nr,ri.vertical,Ea,Fn,Di,On,Ji,Jh,c.ao.vertical,["vertical"],z,k,Ca,Po));const Be=Qc?Qc.boxStartIndex:Jt.collisionBoxArray.length,ut=Qc?Qc.boxEndIndex:Jt.collisionBoxArray.length,xt=ef?ef.boxStartIndex:Jt.collisionBoxArray.length,It=ef?ef.boxEndIndex:Jt.collisionBoxArray.length,ht=Jc?Jc.boxStartIndex:Jt.collisionBoxArray.length,pt=Jc?Jc.boxEndIndex:Jt.collisionBoxArray.length,ir=xd?xd.boxStartIndex:Jt.collisionBoxArray.length,vr=xd?xd.boxEndIndex:Jt.collisionBoxArray.length;let Wr=-1;const Ke=(Tr,Kt)=>Tr&&Tr.circleDiameter?Math.max(Tr.circleDiameter,Kt):Kt;Wr=Ke(Qc,Wr),Wr=Ke(ef,Wr),Wr=Ke(Jc,Wr),Wr=Ke(xd,Wr);const Ve=Wr>-1?1:0;Ve&&(Wr*=bd/Rn),Jt.glyphOffsetArray.length>=Kh.MAX_GLYPHS&&cr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),On.sortKey!==void 0&&Jt.addToSortKeyRanges(Jt.symbolInstances.length,On.sortKey);const ct=Um(Fn,On,Po),[Ct,gr]=(function(Tr,Kt){const Er=Tr.length,Mr=Kt?.values;if(Mr?.length>0)for(let qr=0;qr<Mr.length;qr+=2){const Ss=Mr[qr+1];Tr.emplaceBack(c.aE[Mr[qr]],Ss[0],Ss[1])}return[Er,Tr.length]})(Jt.textAnchorOffsets,ct);Jt.symbolInstances.emplaceBack(Nr.x,Nr.y,z.right>=0?z.right:-1,z.center>=0?z.center:-1,z.left>=0?z.left:-1,z.vertical||-1,S,k,J,Be,ut,xt,It,ht,pt,ir,vr,Bn,p,b,Qp,u,Ve,0,ui,Wr,Ct,gr)})(f,ar,pr,h,m,x,Ut,f.layers[0],f.collisionBoxArray,l.index,l.sourceLayerIndex,f.index,xe,[et,et,et,et],Vt,D,Ie,ft,zt,ne,l,A,U,$,P)};if(jt==="line")for(const pr of Gp(l.geometry,0,0,Ue,Ue)){const ar=Hi(pr,yt),Jt=Dw(ar,De,St,h.vertical||le,m,24,$e,f.overscaling,Ue);for(const Nr of Jt)le&&Co(f,le.text,rr,Nr)||dr(ar,Nr)}else if(jt==="line-center"){for(const pr of l.geometry)if(pr.length>1){const ar=Hi(pr,yt),Jt=hb(ar,St,h.vertical||le,m,24,$e);Jt&&dr(ar,Jt)}}else if(l.type==="Polygon")for(const pr of xu(l.geometry,0)){const ar=Bw(pr,16);dr(Hi(pr[0],yt,!0),new Zc(ar.x,ar.y,0))}else if(l.type==="LineString")for(const pr of l.geometry){const ar=Hi(pr,yt);dr(ar,new Zc(ar[0].x,ar[0].y,0))}else if(l.type==="Point")for(const pr of l.geometry)for(const ar of pr)dr([ar],new Zc(ar.x,ar.y,0))}function W_(f,l,h,m,x,A,P,R,D,U,$,G,ee,re,ne){const le=(function($e,Ie,De,et,ft,St,Vt,zt){const jt=et.layout.get("text-rotate").evaluate(St,{})*Math.PI/180,rr=[];for(const Ft of Ie.positionedLines)for(const Ut of Ft.positionedGlyphs){if(!Ut.rect)continue;const yt=Ut.rect||{};let dr=4,pr=!0,ar=1,Jt=0;const Nr=(ft||zt)&&Ut.vertical,Ln=Ut.metrics.advance*Ut.scale/2;if(zt&&Ie.verticalizable&&(Jt=Ft.lineOffset/2-(Ut.imageName?-(Rn-Ut.metrics.width*Ut.scale)/2:(Ut.scale-1)*Rn)),Ut.imageName){const Bi=Vt[Ut.imageName];pr=Bi.sdf,ar=Bi.pixelRatio,dr=1/ar}const ri=ft?[Ut.x+Ln,Ut.y]:[0,0];let qi=ft?[0,0]:[Ut.x+Ln+De[0],Ut.y+De[1]-Jt],Ea=[0,0];Nr&&(Ea=qi,qi=[0,0]);const Ts=Ut.metrics.isDoubleResolution?2:1,Fn=(Ut.metrics.left-dr)*Ut.scale-Ln+qi[0],rn=(-Ut.metrics.top-dr)*Ut.scale+qi[1],Bn=Fn+yt.w/Ts*Ut.scale/ar,li=rn+yt.h/Ts*Ut.scale/ar,ci=new g(Fn,rn),ui=new g(Bn,rn),Ha=new g(Fn,li),Di=new g(Bn,li);if(Nr){const Bi=new g(-Ln,Ln- -17),hi=-Math.PI/2,fi=12-Ln,On=new g(22-fi,-(Ut.imageName?fi:0)),Ca=new g(...Ea);ci._rotateAround(hi,Bi)._add(On)._add(Ca),ui._rotateAround(hi,Bi)._add(On)._add(Ca),Ha._rotateAround(hi,Bi)._add(On)._add(Ca),Di._rotateAround(hi,Bi)._add(On)._add(Ca)}if(jt){const Bi=Math.sin(jt),hi=Math.cos(jt),fi=[hi,-Bi,Bi,hi];ci._matMult(fi),ui._matMult(fi),Ha._matMult(fi),Di._matMult(fi)}const Ji=new g(0,0),Li=new g(0,0);rr.push({tl:ci,tr:ui,bl:Ha,br:Di,tex:yt,writingMode:Ie.writingMode,glyphOffset:ri,sectionIndex:Ut.sectionIndex,isSDF:pr,pixelOffsetTL:Ji,pixelOffsetBR:Li,minFontScaleX:0,minFontScaleY:0})}return rr})(0,h,R,x,A,P,m,f.allowVerticalPlacement),de=f.textSizeData;let xe=null;de.kind==="source"?(xe=[Ao*x.layout.get("text-size").evaluate(P,{})],xe[0]>Va&&cr(`${f.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):de.kind==="composite"&&(xe=[Ao*re.compositeTextSizes[0].evaluate(P,{},ne),Ao*re.compositeTextSizes[1].evaluate(P,{},ne)],(xe[0]>Va||xe[1]>Va)&&cr(`${f.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),f.addSymbols(f.text,le,xe,R,A,P,U,l,D.lineStartIndex,D.lineLength,ee,ne);for(const $e of $)G[$e]=f.text.placedSymbolArray.length-1;return 4*le.length}function _d(f){for(const l in f)return f[l];return null}function Co(f,l,h,m){const x=f.compareText;if(l in x){const A=x[l];for(let P=A.length-1;P>=0;P--)if(m.dist(A[P])<h)return!0}else x[l]=[];return x[l].push(m),!1}const q_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class vd{static from(l){if(!(l instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[h,m]=new Uint8Array(l,0,2);if(h!==219)throw new Error("Data does not appear to be in a KDBush format.");const x=m>>4;if(x!==1)throw new Error(`Got v${x} data when expected v1.`);const A=q_[15&m];if(!A)throw new Error("Unrecognized array type.");const[P]=new Uint16Array(l,2,1),[R]=new Uint32Array(l,4,1);return new vd(R,P,A,l)}constructor(l,h=64,m=Float64Array,x){if(isNaN(l)||l<0)throw new Error(`Unpexpected numItems value: ${l}.`);this.numItems=+l,this.nodeSize=Math.min(Math.max(+h,2),65535),this.ArrayType=m,this.IndexArrayType=l<65536?Uint16Array:Uint32Array;const A=q_.indexOf(this.ArrayType),P=2*l*this.ArrayType.BYTES_PER_ELEMENT,R=l*this.IndexArrayType.BYTES_PER_ELEMENT,D=(8-R%8)%8;if(A<0)throw new Error(`Unexpected typed array class: ${m}.`);x&&x instanceof ArrayBuffer?(this.data=x,this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+R+D,2*l),this._pos=2*l,this._finished=!0):(this.data=new ArrayBuffer(8+P+R+D),this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+R+D,2*l),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+A]),new Uint16Array(this.data,2,1)[0]=h,new Uint32Array(this.data,4,1)[0]=l)}add(l,h){const m=this._pos>>1;return this.ids[m]=m,this.coords[this._pos++]=l,this.coords[this._pos++]=h,m}finish(){const l=this._pos>>1;if(l!==this.numItems)throw new Error(`Added ${l} items when expected ${this.numItems}.`);return il(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(l,h,m,x){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:A,coords:P,nodeSize:R}=this,D=[0,A.length-1,0],U=[];for(;D.length;){const $=D.pop()||0,G=D.pop()||0,ee=D.pop()||0;if(G-ee<=R){for(let de=ee;de<=G;de++){const xe=P[2*de],$e=P[2*de+1];xe>=l&&xe<=m&&$e>=h&&$e<=x&&U.push(A[de])}continue}const re=ee+G>>1,ne=P[2*re],le=P[2*re+1];ne>=l&&ne<=m&&le>=h&&le<=x&&U.push(A[re]),($===0?l<=ne:h<=le)&&(D.push(ee),D.push(re-1),D.push(1-$)),($===0?m>=ne:x>=le)&&(D.push(re+1),D.push(G),D.push(1-$))}return U}within(l,h,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:x,coords:A,nodeSize:P}=this,R=[0,x.length-1,0],D=[],U=m*m;for(;R.length;){const $=R.pop()||0,G=R.pop()||0,ee=R.pop()||0;if(G-ee<=P){for(let de=ee;de<=G;de++)G_(A[2*de],A[2*de+1],l,h)<=U&&D.push(x[de]);continue}const re=ee+G>>1,ne=A[2*re],le=A[2*re+1];G_(ne,le,l,h)<=U&&D.push(x[re]),($===0?l-m<=ne:h-m<=le)&&(R.push(ee),R.push(re-1),R.push(1-$)),($===0?l+m>=ne:h+m>=le)&&(R.push(re+1),R.push(G),R.push(1-$))}return D}}function il(f,l,h,m,x,A){if(x-m<=h)return;const P=m+x>>1;gb(f,l,P,m,x,A),il(f,l,h,m,P-1,1-A),il(f,l,h,P+1,x,1-A)}function gb(f,l,h,m,x,A){for(;x>m;){if(x-m>600){const U=x-m+1,$=h-m+1,G=Math.log(U),ee=.5*Math.exp(2*G/3),re=.5*Math.sqrt(G*ee*(U-ee)/U)*($-U/2<0?-1:1);gb(f,l,h,Math.max(m,Math.floor(h-$*ee/U+re)),Math.min(x,Math.floor(h+(U-$)*ee/U+re)),A)}const P=l[2*h+A];let R=m,D=x;for(Yp(f,l,m,h),l[2*x+A]>P&&Yp(f,l,m,x);R<D;){for(Yp(f,l,R,D),R++,D--;l[2*R+A]<P;)R++;for(;l[2*D+A]>P;)D--}l[2*m+A]===P?Yp(f,l,m,D):(D++,Yp(f,l,D,x)),D<=h&&(m=D+1),h<=D&&(x=D-1)}}function Yp(f,l,h,m){Xu(f,h,m),Xu(l,2*h,2*m),Xu(l,2*h+1,2*m+1)}function Xu(f,l,h){const m=f[l];f[l]=f[h],f[h]=m}function G_(f,l,h,m){const x=f-h,A=l-m;return x*x+A*A}var X_;c.cx=void 0,(X_=c.cx||(c.cx={})).create="create",X_.load="load",X_.fullLoad="fullLoad";let Vm=null,Kp=[];const Z_=1e3/60,Y_="loadTime",K_="fullLoadTime",Nw={mark(f){performance.mark(f)},frame(f){const l=f;Vm!=null&&Kp.push(l-Vm),Vm=l},clearMetrics(){Vm=null,Kp=[],performance.clearMeasures(Y_),performance.clearMeasures(K_);for(const f in c.cx)performance.clearMarks(c.cx[f])},getPerformanceMetrics(){performance.measure(Y_,c.cx.create,c.cx.load),performance.measure(K_,c.cx.create,c.cx.fullLoad);const f=performance.getEntriesByName(Y_)[0].duration,l=performance.getEntriesByName(K_)[0].duration,h=Kp.length,m=1/(Kp.reduce(((A,P)=>A+P),0)/h/1e3),x=Kp.filter((A=>A>Z_)).reduce(((A,P)=>A+(P-Z_)/Z_),0);return{loadTime:f,fullLoadTime:l,fps:m,percentDroppedFrames:x/(h+x)*100,totalFrames:h}}};c.$=Ue,c.A=X,c.B=function([f,l,h]){return l+=90,l*=Math.PI/180,h*=Math.PI/180,{x:f*Math.cos(l)*Math.sin(h),y:f*Math.sin(l)*Math.sin(h),z:f*Math.cos(h)}},c.C=io,c.D=Qt,c.E=Xt,c.F=Qr,c.G=e_,c.H=function(f){if(gs==null){const l=f.navigator?f.navigator.userAgent:null;gs=!!f.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return gs},c.I=cd,c.J=class{constructor(f,l){this.target=f,this.mapId=l,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new kw((()=>this.process())),this.subscription=Al(this.target,"message",(h=>this.receive(h)),!1),this.globalScope=ur(self)?f:window}registerMessageHandler(f,l){this.messageHandlers[f]=l}sendAsync(f,l){return new Promise(((h,m)=>{const x=Math.round(1e18*Math.random()).toString(36).substring(0,10),A=l?Al(l.signal,"abort",(()=>{A?.unsubscribe(),delete this.resolveRejects[x];const D={id:x,type:"<cancel>",origin:location.origin,targetMapId:f.targetMapId,sourceMapId:this.mapId};this.target.postMessage(D)}),sb):null;this.resolveRejects[x]={resolve:D=>{A?.unsubscribe(),h(D)},reject:D=>{A?.unsubscribe(),m(D)}};const P=[],R=Object.assign(Object.assign({},f),{id:x,sourceMapId:this.mapId,origin:location.origin,data:vo(f.data,P)});this.target.postMessage(R,{transfer:P})}))}receive(f){const l=f.data,h=l.id;if(!(l.origin!=="file://"&&location.origin!=="file://"&&l.origin!=="resource://android"&&location.origin!=="resource://android"&&l.origin!==location.origin||l.targetMapId&&this.mapId!==l.targetMapId)){if(l.type==="<cancel>"){delete this.tasks[h];const m=this.abortControllers[h];return delete this.abortControllers[h],void(m&&m.abort())}if(ur(self)||l.mustQueue)return this.tasks[h]=l,this.taskQueue.push(h),void this.invoker.trigger();this.processTask(h,l)}}process(){if(this.taskQueue.length===0)return;const f=this.taskQueue.shift(),l=this.tasks[f];delete this.tasks[f],this.taskQueue.length>0&&this.invoker.trigger(),l&&this.processTask(f,l)}processTask(f,l){return s(this,void 0,void 0,(function*(){if(l.type==="<response>"){const x=this.resolveRejects[f];return delete this.resolveRejects[f],x?void(l.error?x.reject(Zo(l.error)):x.resolve(Zo(l.data))):void 0}if(!this.messageHandlers[l.type])return void this.completeTask(f,new Error(`Could not find a registered handler for ${l.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const h=Zo(l.data),m=new AbortController;this.abortControllers[f]=m;try{const x=yield this.messageHandlers[l.type](l.sourceMapId,h,m);this.completeTask(f,null,x)}catch(x){this.completeTask(f,x)}}))}completeTask(f,l,h){const m=[];delete this.abortControllers[f];const x={id:f,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:l?vo(l):null,data:vo(h,m)};this.target.postMessage(x,{transfer:m})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},c.K=fe,c.L=function(){var f=new X(16);return X!=Float32Array&&(f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[11]=0,f[12]=0,f[13]=0,f[14]=0),f[0]=1,f[5]=1,f[10]=1,f[15]=1,f},c.M=function(f,l,h){var m,x,A,P,R,D,U,$,G,ee,re,ne,le=h[0],de=h[1],xe=h[2];return l===f?(f[12]=l[0]*le+l[4]*de+l[8]*xe+l[12],f[13]=l[1]*le+l[5]*de+l[9]*xe+l[13],f[14]=l[2]*le+l[6]*de+l[10]*xe+l[14],f[15]=l[3]*le+l[7]*de+l[11]*xe+l[15]):(x=l[1],A=l[2],P=l[3],R=l[4],D=l[5],U=l[6],$=l[7],G=l[8],ee=l[9],re=l[10],ne=l[11],f[0]=m=l[0],f[1]=x,f[2]=A,f[3]=P,f[4]=R,f[5]=D,f[6]=U,f[7]=$,f[8]=G,f[9]=ee,f[10]=re,f[11]=ne,f[12]=m*le+R*de+G*xe+l[12],f[13]=x*le+D*de+ee*xe+l[13],f[14]=A*le+U*de+re*xe+l[14],f[15]=P*le+$*de+ne*xe+l[15]),f},c.N=function(f,l,h){var m=h[0],x=h[1],A=h[2];return f[0]=l[0]*m,f[1]=l[1]*m,f[2]=l[2]*m,f[3]=l[3]*m,f[4]=l[4]*x,f[5]=l[5]*x,f[6]=l[6]*x,f[7]=l[7]*x,f[8]=l[8]*A,f[9]=l[9]*A,f[10]=l[10]*A,f[11]=l[11]*A,f[12]=l[12],f[13]=l[13],f[14]=l[14],f[15]=l[15],f},c.O=function(f,l,h){var m=l[0],x=l[1],A=l[2],P=l[3],R=l[4],D=l[5],U=l[6],$=l[7],G=l[8],ee=l[9],re=l[10],ne=l[11],le=l[12],de=l[13],xe=l[14],$e=l[15],Ie=h[0],De=h[1],et=h[2],ft=h[3];return f[0]=Ie*m+De*R+et*G+ft*le,f[1]=Ie*x+De*D+et*ee+ft*de,f[2]=Ie*A+De*U+et*re+ft*xe,f[3]=Ie*P+De*$+et*ne+ft*$e,f[4]=(Ie=h[4])*m+(De=h[5])*R+(et=h[6])*G+(ft=h[7])*le,f[5]=Ie*x+De*D+et*ee+ft*de,f[6]=Ie*A+De*U+et*re+ft*xe,f[7]=Ie*P+De*$+et*ne+ft*$e,f[8]=(Ie=h[8])*m+(De=h[9])*R+(et=h[10])*G+(ft=h[11])*le,f[9]=Ie*x+De*D+et*ee+ft*de,f[10]=Ie*A+De*U+et*re+ft*xe,f[11]=Ie*P+De*$+et*ne+ft*$e,f[12]=(Ie=h[12])*m+(De=h[13])*R+(et=h[14])*G+(ft=h[15])*le,f[13]=Ie*x+De*D+et*ee+ft*de,f[14]=Ie*A+De*U+et*re+ft*xe,f[15]=Ie*P+De*$+et*ne+ft*$e,f},c.P=g,c.Q=function(f,l){const h={};for(let m=0;m<l.length;m++){const x=l[m];x in f&&(h[x]=f[x])}return h},c.R=xs,c.S=nc,c.T=dm,c.U=Lm,c.V=N_,c.W=V,c.X=q,c.Y=Tl,c.Z=Aa,c._=s,c.a=ie,c.a$=Lt,c.a0=function(f,l){var h,m,x,A,P;if(!f)return l??{};if(!l)return f;let R=Object.assign({},f);if(l.removeAll&&(R={removeAll:!0}),l.remove){const D=new Set(l.remove);R.add&&(R.add=R.add.filter(($=>!D.has($.id)))),R.update&&(R.update=R.update.filter(($=>!D.has($.id))));const U=new Set(((h=f.add)!==null&&h!==void 0?h:[]).map(($=>$.id)));l.remove=l.remove.filter(($=>!U.has($)))}if(l.remove){const D=new Set(R.remove?R.remove.concat(l.remove):l.remove);R.remove=Array.from(D.values())}if(l.add){const D=R.add?R.add.concat(l.add):l.add,U=new Map(D.map(($=>[$.id,$])));R.add=Array.from(U.values())}if(l.update){const D=new Map((m=R.update)===null||m===void 0?void 0:m.map((U=>[U.id,U])));for(const U of l.update){const $=(x=D.get(U.id))!==null&&x!==void 0?x:{id:U.id};U.newGeometry&&($.newGeometry=U.newGeometry),U.addOrUpdateProperties&&($.addOrUpdateProperties=((A=$.addOrUpdateProperties)!==null&&A!==void 0?A:[]).concat(U.addOrUpdateProperties)),U.removeProperties&&($.removeProperties=((P=$.removeProperties)!==null&&P!==void 0?P:[]).concat(U.removeProperties)),U.removeAllProperties&&($.removeAllProperties=!0),D.set(U.id,$)}R.update=Array.from(D.values())}return R.remove&&R.add&&(R.remove=R.remove.filter((D=>R.add.findIndex((U=>U.id===D))===-1))),R},c.a1=md,c.a2=oi,c.a3=25,c.a4=z_,c.a5=f=>{const l=window.document.createElement("video");return l.muted=!0,new Promise((h=>{l.onloadstart=()=>{h(l)};for(const m of f){const x=window.document.createElement("source");Qe(m)||(l.crossOrigin="Anonymous"),x.src=m,l.appendChild(x)}}))},c.a6=bt,c.a7=function(){return Et++},c.a8=me,c.a9=Kh,c.aA=function(f){let l=1/0,h=1/0,m=-1/0,x=-1/0;for(const A of f)l=Math.min(l,A.x),h=Math.min(h,A.y),m=Math.max(m,A.x),x=Math.max(x,A.y);return[l,h,m,x]},c.aB=Rn,c.aC=at,c.aD=function(f,l,h,m,x=!1){if(!h[0]&&!h[1])return[0,0];const A=x?m==="map"?-f.bearingInRadians:0:m==="viewport"?f.bearingInRadians:0;if(A){const P=Math.sin(A),R=Math.cos(A);h=[h[0]*R-h[1]*P,h[0]*P+h[1]*R]}return[x?h[0]:at(l,h[0],f.zoom),x?h[1]:at(l,h[1],f.zoom)]},c.aF=dd,c.aG=jm,c.aH=fd,c.aI=vd,c.aJ=an,c.aK=Op,c.aL=tt,c.aM=Or,c.aN=xi,c.aO=Gt,c.aP=El,c.aQ=ab,c.aR=_t,c.aS=Ze,c.aT=function(f){var l=new X(3);return l[0]=f[0],l[1]=f[1],l[2]=f[2],l},c.aU=function(f,l,h){return f[0]=l[0]-h[0],f[1]=l[1]-h[1],f[2]=l[2]-h[2],f},c.aV=function(f,l){var h=l[0],m=l[1],x=l[2],A=h*h+m*m+x*x;return A>0&&(A=1/Math.sqrt(A)),f[0]=l[0]*A,f[1]=l[1]*A,f[2]=l[2]*A,f},c.aW=it,c.aX=function(f,l){return f[0]*l[0]+f[1]*l[1]+f[2]*l[2]},c.aY=function(f,l,h){return f[0]=l[0]*h[0],f[1]=l[1]*h[1],f[2]=l[2]*h[2],f[3]=l[3]*h[3],f},c.aZ=Le,c.a_=function(f,l,h){const m=l[0]*h[0]+l[1]*h[1]+l[2]*h[2];return m===0?null:(-(f[0]*h[0]+f[1]*h[1]+f[2]*h[2])-h[3])/m},c.aa=as,c.ab=jc,c.ac=U_,c.ad=function(f){const l={};if(f.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((h,m,x,A)=>{const P=x||A;return l[m]=!P||P.toLowerCase(),""})),l["max-age"]){const h=parseInt(l["max-age"],10);isNaN(h)?delete l["max-age"]:l["max-age"]=h}return l},c.ae=Ei,c.af=function(f){return Math.pow(2,f)},c.ag=ue,c.ah=$t,c.ai=85.051129,c.aj=pd,c.ak=function(f){return Math.log(f)/Math.LN2},c.al=function(f){var l=f[0],h=f[1];return l*l+h*h},c.am=function(f,l){const h=[];for(const m in f)m in l||h.push(m);return h},c.an=function(f,l){let h=0,m=0;if(f.kind==="constant")m=f.layoutSize;else if(f.kind!=="source"){const{interpolationType:x,minZoom:A,maxZoom:P}=f,R=x?$t(Fi.interpolationFactor(x,l,A,P),0,1):0;f.kind==="camera"?m=io.number(f.minSize,f.maxSize,R):h=R}return{uSizeT:h,uSize:m}},c.ap=function(f,{uSize:l,uSizeT:h},{lowerSize:m,upperSize:x}){return f.kind==="source"?m/Ao:f.kind==="composite"?io.number(m/Ao,x/Ao,h):l},c.aq=function(f,l){var h=l[0],m=l[1],x=l[2],A=l[3],P=l[4],R=l[5],D=l[6],U=l[7],$=l[8],G=l[9],ee=l[10],re=l[11],ne=l[12],le=l[13],de=l[14],xe=l[15],$e=h*R-m*P,Ie=h*D-x*P,De=h*U-A*P,et=m*D-x*R,ft=m*U-A*R,St=x*U-A*D,Vt=$*le-G*ne,zt=$*de-ee*ne,jt=$*xe-re*ne,rr=G*de-ee*le,Ft=G*xe-re*le,Ut=ee*xe-re*de,yt=$e*Ut-Ie*Ft+De*rr+et*jt-ft*zt+St*Vt;return yt?(f[0]=(R*Ut-D*Ft+U*rr)*(yt=1/yt),f[1]=(x*Ft-m*Ut-A*rr)*yt,f[2]=(le*St-de*ft+xe*et)*yt,f[3]=(ee*ft-G*St-re*et)*yt,f[4]=(D*jt-P*Ut-U*zt)*yt,f[5]=(h*Ut-x*jt+A*zt)*yt,f[6]=(de*De-ne*St-xe*Ie)*yt,f[7]=($*St-ee*De+re*Ie)*yt,f[8]=(P*Ft-R*jt+U*Vt)*yt,f[9]=(m*jt-h*Ft-A*Vt)*yt,f[10]=(ne*ft-le*De+xe*$e)*yt,f[11]=(G*De-$*ft-re*$e)*yt,f[12]=(R*zt-P*rr-D*Vt)*yt,f[13]=(h*rr-m*zt+x*Vt)*yt,f[14]=(le*Ie-ne*et-de*$e)*yt,f[15]=($*et-G*Ie+ee*$e)*yt,f):null},c.ar=we,c.as=function(f){var l=f[0],h=f[1];return Math.sqrt(l*l+h*h)},c.at=function(f){return f[0]=0,f[1]=0,f},c.au=function(f,l,h){return f[0]=l[0]*h,f[1]=l[1]*h,f},c.av=Eo,c.aw=Ot,c.ax=function(f,l,h,m){const x=l.y-f.y,A=l.x-f.x,P=m.y-h.y,R=m.x-h.x,D=P*A-R*x;if(D===0)return null;const U=(R*(f.y-h.y)-P*(f.x-h.x))/D;return new g(f.x+U*A,f.y+U*x)},c.ay=Gp,c.az=Bu,c.b=Os,c.b$=class extends y{},c.b0=function(f,l,h){return f[0]=l[0]*h,f[1]=l[1]*h,f[2]=l[2]*h,f[3]=l[3]*h,f},c.b1=function(f,l){return f[0]*l[0]+f[1]*l[1]+f[2]*l[2]+f[3]},c.b2=F_,c.b3=tn,c.b4=function(f,l,h,m,x){var A=1/Math.tan(l/2);if(f[0]=A/h,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=A,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[11]=-1,f[12]=0,f[13]=0,f[15]=0,x!=null&&x!==1/0){var P=1/(m-x);f[10]=(x+m)*P,f[14]=2*x*m*P}else f[10]=-1,f[14]=-2*m;return f},c.b5=function(f){var l=new X(16);return l[0]=f[0],l[1]=f[1],l[2]=f[2],l[3]=f[3],l[4]=f[4],l[5]=f[5],l[6]=f[6],l[7]=f[7],l[8]=f[8],l[9]=f[9],l[10]=f[10],l[11]=f[11],l[12]=f[12],l[13]=f[13],l[14]=f[14],l[15]=f[15],l},c.b6=function(f,l,h){var m=Math.sin(h),x=Math.cos(h),A=l[0],P=l[1],R=l[2],D=l[3],U=l[4],$=l[5],G=l[6],ee=l[7];return l!==f&&(f[8]=l[8],f[9]=l[9],f[10]=l[10],f[11]=l[11],f[12]=l[12],f[13]=l[13],f[14]=l[14],f[15]=l[15]),f[0]=A*x+U*m,f[1]=P*x+$*m,f[2]=R*x+G*m,f[3]=D*x+ee*m,f[4]=U*x-A*m,f[5]=$*x-P*m,f[6]=G*x-R*m,f[7]=ee*x-D*m,f},c.b7=function(f,l,h){var m=Math.sin(h),x=Math.cos(h),A=l[4],P=l[5],R=l[6],D=l[7],U=l[8],$=l[9],G=l[10],ee=l[11];return l!==f&&(f[0]=l[0],f[1]=l[1],f[2]=l[2],f[3]=l[3],f[12]=l[12],f[13]=l[13],f[14]=l[14],f[15]=l[15]),f[4]=A*x+U*m,f[5]=P*x+$*m,f[6]=R*x+G*m,f[7]=D*x+ee*m,f[8]=U*x-A*m,f[9]=$*x-P*m,f[10]=G*x-R*m,f[11]=ee*x-D*m,f},c.b8=function(){const f=new Float32Array(16);return ue(f),f},c.b9=function(){const f=new Float64Array(16);return ue(f),f},c.bA=function(f,l){const h=pe(f,360),m=pe(l,360),x=m-h,A=m>h?x-360:x+360;return Math.abs(x)<Math.abs(A)?x:A},c.bB=function(f){return f[0]=0,f[1]=0,f[2]=0,f},c.bC=function(f,l,h,m){const x=Math.sqrt(f*f+l*l),A=Math.sqrt(h*h+m*m);f/=x,l/=x,h/=A,m/=A;const P=Math.acos(f*h+l*m);return-l*h+f*m>0?P:-P},c.bD=function(f,l){const h=pe(f,2*Math.PI),m=pe(l,2*Math.PI);return Math.min(Math.abs(h-m),Math.abs(h-m+2*Math.PI),Math.abs(h-m-2*Math.PI))},c.bE=function(){const f={},l=He.$version;for(const h in He.$root){const m=He.$root[h];if(m.required){let x=null;x=h==="version"?l:m.type==="array"?[]:{},x!=null&&(f[h]=x)}}return f},c.bF=Zf,c.bG=ke,c.bH=function f(l,h){if(Array.isArray(l)){if(!Array.isArray(h)||l.length!==h.length)return!1;for(let m=0;m<l.length;m++)if(!f(l[m],h[m]))return!1;return!0}if(typeof l=="object"&&l!==null&&h!==null){if(typeof h!="object"||Object.keys(l).length!==Object.keys(h).length)return!1;for(const m in l)if(!f(l[m],h[m]))return!1;return!0}return l===h},c.bI=function(f){f=f.slice();const l=Object.create(null);for(let h=0;h<f.length;h++)l[f[h].id]=f[h];for(let h=0;h<f.length;h++)"ref"in f[h]&&(f[h]=Ir(f[h],l[f[h].ref]));return f},c.bJ=function(f,l){if(f.type==="custom")return new Wp(f,l);switch(f.type){case"background":return new B_(f,l);case"circle":return new o_(f,l);case"color-relief":return new F0(f,l);case"fill":return new m_(f,l);case"fill-extrusion":return new Zr(f,l);case"heatmap":return new N0(f,l);case"hillshade":return new Vc(f,l);case"line":return new b_(f,l);case"raster":return new Ow(f,l);case"symbol":return new Hp(f,l)}},c.bK=Mt,c.bL=function(f,l){if(!f)return[{command:"setStyle",args:[l]}];let h=[];try{if(!er(f.version,l.version))return[{command:"setStyle",args:[l]}];er(f.center,l.center)||h.push({command:"setCenter",args:[l.center]}),er(f.state,l.state)||h.push({command:"setGlobalState",args:[l.state]}),er(f.centerAltitude,l.centerAltitude)||h.push({command:"setCenterAltitude",args:[l.centerAltitude]}),er(f.zoom,l.zoom)||h.push({command:"setZoom",args:[l.zoom]}),er(f.bearing,l.bearing)||h.push({command:"setBearing",args:[l.bearing]}),er(f.pitch,l.pitch)||h.push({command:"setPitch",args:[l.pitch]}),er(f.roll,l.roll)||h.push({command:"setRoll",args:[l.roll]}),er(f.sprite,l.sprite)||h.push({command:"setSprite",args:[l.sprite]}),er(f.glyphs,l.glyphs)||h.push({command:"setGlyphs",args:[l.glyphs]}),er(f.transition,l.transition)||h.push({command:"setTransition",args:[l.transition]}),er(f.light,l.light)||h.push({command:"setLight",args:[l.light]}),er(f.terrain,l.terrain)||h.push({command:"setTerrain",args:[l.terrain]}),er(f.sky,l.sky)||h.push({command:"setSky",args:[l.sky]}),er(f.projection,l.projection)||h.push({command:"setProjection",args:[l.projection]});const m={},x=[];(function(P,R,D,U){let $;for($ in R=R||{},P=P||{})Object.prototype.hasOwnProperty.call(P,$)&&(Object.prototype.hasOwnProperty.call(R,$)||$n($,D,U));for($ in R)Object.prototype.hasOwnProperty.call(R,$)&&(Object.prototype.hasOwnProperty.call(P,$)?er(P[$],R[$])||(P[$].type==="geojson"&&R[$].type==="geojson"&&Ci(P,R,$)?Ar(D,{command:"setGeoJSONSourceData",args:[$,R[$].data]}):Hn($,R,D,U)):mn($,R,D))})(f.sources,l.sources,x,m);const A=[];f.layers&&f.layers.forEach((P=>{"source"in P&&m[P.source]?h.push({command:"removeLayer",args:[P.id]}):A.push(P)})),h=h.concat(x),(function(P,R,D){R=R||[];const U=(P=P||[]).map(yn),$=R.map(yn),G=P.reduce(Jn,{}),ee=R.reduce(Jn,{}),re=U.slice(),ne=Object.create(null);let le,de,xe,$e,Ie;for(let De=0,et=0;De<U.length;De++)le=U[De],Object.prototype.hasOwnProperty.call(ee,le)?et++:(Ar(D,{command:"removeLayer",args:[le]}),re.splice(re.indexOf(le,et),1));for(let De=0,et=0;De<$.length;De++)le=$[$.length-1-De],re[re.length-1-De]!==le&&(Object.prototype.hasOwnProperty.call(G,le)?(Ar(D,{command:"removeLayer",args:[le]}),re.splice(re.lastIndexOf(le,re.length-et),1)):et++,$e=re[re.length-De],Ar(D,{command:"addLayer",args:[ee[le],$e]}),re.splice(re.length-De,0,le),ne[le]=!0);for(let De=0;De<$.length;De++)if(le=$[De],de=G[le],xe=ee[le],!ne[le]&&!er(de,xe))if(er(de.source,xe.source)&&er(de["source-layer"],xe["source-layer"])&&er(de.type,xe.type)){for(Ie in yi(de.layout,xe.layout,D,le,null,"setLayoutProperty"),yi(de.paint,xe.paint,D,le,null,"setPaintProperty"),er(de.filter,xe.filter)||Ar(D,{command:"setFilter",args:[le,xe.filter]}),er(de.minzoom,xe.minzoom)&&er(de.maxzoom,xe.maxzoom)||Ar(D,{command:"setLayerZoomRange",args:[le,xe.minzoom,xe.maxzoom]}),de)Object.prototype.hasOwnProperty.call(de,Ie)&&Ie!=="layout"&&Ie!=="paint"&&Ie!=="filter"&&Ie!=="metadata"&&Ie!=="minzoom"&&Ie!=="maxzoom"&&(Ie.indexOf("paint.")===0?yi(de[Ie],xe[Ie],D,le,Ie.slice(6),"setPaintProperty"):er(de[Ie],xe[Ie])||Ar(D,{command:"setLayerProperty",args:[le,Ie,xe[Ie]]}));for(Ie in xe)Object.prototype.hasOwnProperty.call(xe,Ie)&&!Object.prototype.hasOwnProperty.call(de,Ie)&&Ie!=="layout"&&Ie!=="paint"&&Ie!=="filter"&&Ie!=="metadata"&&Ie!=="minzoom"&&Ie!=="maxzoom"&&(Ie.indexOf("paint.")===0?yi(de[Ie],xe[Ie],D,le,Ie.slice(6),"setPaintProperty"):er(de[Ie],xe[Ie])||Ar(D,{command:"setLayerProperty",args:[le,Ie,xe[Ie]]}))}else Ar(D,{command:"removeLayer",args:[le]}),$e=re[re.lastIndexOf(le)+1],Ar(D,{command:"addLayer",args:[xe,$e]})})(A,l.layers,h)}catch(m){console.warn("Unable to compute style diff:",m),h=[{command:"setStyle",args:[l]}]}return h},c.bM=function(f){const l=[],h=f.id;return h===void 0&&l.push({message:`layers.${h}: missing required property "id"`}),f.render===void 0&&l.push({message:`layers.${h}: missing required method "render"`}),f.renderingMode&&f.renderingMode!=="2d"&&f.renderingMode!=="3d"&&l.push({message:`layers.${h}: property "renderingMode" must be either "2d" or "3d"`}),l},c.bN=Wt,c.bO=mr,c.bP=class extends Tn{constructor(f,l){super(f,l),this.current=0}set(f){this.current!==f&&(this.current=f,this.gl.uniform1i(this.location,f))}},c.bQ=vp,c.bR=class extends Tn{constructor(f,l){super(f,l),this.current=im}set(f){if(f[12]!==this.current[12]||f[0]!==this.current[0])return this.current=f,void this.gl.uniformMatrix4fv(this.location,!1,f);for(let l=1;l<16;l++)if(f[l]!==this.current[l]){this.current=f,this.gl.uniformMatrix4fv(this.location,!1,f);break}}},c.bS=ed,c.bT=class extends Tn{constructor(f,l){super(f,l),this.current=[0,0,0]}set(f){f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]||(this.current=f,this.gl.uniform3f(this.location,f[0],f[1],f[2]))}},c.bU=class extends Tn{constructor(f,l){super(f,l),this.current=[0,0]}set(f){f[0]===this.current[0]&&f[1]===this.current[1]||(this.current=f,this.gl.uniform2f(this.location,f[0],f[1]))}},c.bV=ae,c.bW=function(f,l){var h=Math.sin(l),m=Math.cos(l);return f[0]=m,f[1]=h,f[2]=0,f[3]=-h,f[4]=m,f[5]=0,f[6]=0,f[7]=0,f[8]=1,f},c.bX=function(f,l,h){var m=l[0],x=l[1],A=l[2];return f[0]=m*h[0]+x*h[3]+A*h[6],f[1]=m*h[1]+x*h[4]+A*h[7],f[2]=m*h[2]+x*h[5]+A*h[8],f},c.bY=function(f,l,h,m,x,A,P){var R=1/(l-h),D=1/(m-x),U=1/(A-P);return f[0]=-2*R,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=-2*D,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=2*U,f[11]=0,f[12]=(l+h)*R,f[13]=(x+m)*D,f[14]=(P+A)*U,f[15]=1,f},c.bZ=class extends Tn{constructor(f,l){super(f,l),this.current=new Array}set(f){if(f!=this.current){this.current=f;const l=new Float32Array(4*f.length);for(let h=0;h<f.length;h++)l[4*h]=f[h].r,l[4*h+1]=f[h].g,l[4*h+2]=f[h].b,l[4*h+3]=f[h].a;this.gl.uniform4fv(this.location,l)}}},c.b_=class extends Tn{constructor(f,l){super(f,l),this.current=new Array}set(f){if(f!=this.current){this.current=f;const l=new Float32Array(f);this.gl.uniform1fv(this.location,l)}}},c.ba=function(){return new Float64Array(16)},c.bb=function(f,l,h){const m=new Float64Array(4);return ce(m,f,l-90,h),m},c.bc=function(f,l,h,m){var x,A,P,R,D,U=l[0],$=l[1],G=l[2],ee=l[3],re=h[0],ne=h[1],le=h[2],de=h[3];return(A=U*re+$*ne+G*le+ee*de)<0&&(A=-A,re=-re,ne=-ne,le=-le,de=-de),1-A>Y?(x=Math.acos(A),P=Math.sin(x),R=Math.sin((1-m)*x)/P,D=Math.sin(m*x)/P):(R=1-m,D=m),f[0]=R*U+D*re,f[1]=R*$+D*ne,f[2]=R*G+D*le,f[3]=R*ee+D*de,f},c.bd=function(f){const l=new Float64Array(9);var h,m,x,A,P,R,D,U,$,G,ee,re,ne,le,de,xe,$e,Ie;G=(x=(m=f)[0])*(D=x+x),ee=(A=m[1])*D,ne=(P=m[2])*D,le=P*(U=A+A),xe=(R=m[3])*D,$e=R*U,Ie=R*($=P+P),(h=l)[0]=1-(re=A*U)-(de=P*$),h[3]=ee-Ie,h[6]=ne+$e,h[1]=ee+Ie,h[4]=1-G-de,h[7]=le-xe,h[2]=ne-$e,h[5]=le+xe,h[8]=1-G-re;const De=El(-Math.asin($t(l[2],-1,1)));let et,ft;return Math.hypot(l[5],l[8])<.001?(et=0,ft=-El(Math.atan2(l[3],l[4]))):(et=El(l[5]===0&&l[8]===0?0:Math.atan2(l[5],l[8])),ft=El(l[1]===0&&l[0]===0?0:Math.atan2(l[1],l[0]))),{roll:et,pitch:De+90,bearing:ft}},c.be=function(f,l){return f.roll==l.roll&&f.pitch==l.pitch&&f.bearing==l.bearing},c.bf=Lr,c.bg=Jf,c.bh=Gh,c.bi=ad,c.bj=ba,c.bk=Pe,c.bl=rt,c.bm=zi,c.bn=function(f,l,h,m,x){return Pe(m,x,$t((f-l)/(h-l),0,1))},c.bo=pe,c.bp=function(){return new Float64Array(3)},c.bq=function(f,l,h,m){return f[0]=l[0]+h[0]*m,f[1]=l[1]+h[1]*m,f[2]=l[2]+h[2]*m,f},c.br=ce,c.bs=function(f,l,h){var m=h[0],x=h[1],A=h[2],P=h[3],R=l[0],D=l[1],U=l[2],$=x*U-A*D,G=A*R-m*U,ee=m*D-x*R;return f[0]=R+P*($+=$)+x*(ee+=ee)-A*(G+=G),f[1]=D+P*G+A*$-m*ee,f[2]=U+P*ee+m*G-x*$,f},c.bt=function(f,l,h){const m=(x=[f[0],f[1],f[2],l[0],l[1],l[2],h[0],h[1],h[2]])[0]*(($=x[8])*(P=x[4])-(R=x[5])*(U=x[7]))+x[1]*(-$*(A=x[3])+R*(D=x[6]))+x[2]*(U*A-P*D);var x,A,P,R,D,U,$;if(m===0)return null;const G=it([],[l[0],l[1],l[2]],[h[0],h[1],h[2]]),ee=it([],[h[0],h[1],h[2]],[f[0],f[1],f[2]]),re=it([],[f[0],f[1],f[2]],[l[0],l[1],l[2]]),ne=_t([],G,-f[3]);return Ze(ne,ne,_t([],ee,-l[3])),Ze(ne,ne,_t([],re,-h[3])),_t(ne,ne,1/m),ne},c.bu=jr,c.bv=function(){return new Float64Array(4)},c.bw=function(f,l,h,m){var x=[],A=[];return x[0]=l[0]-h[0],x[1]=l[1]-h[1],x[2]=l[2]-h[2],A[0]=x[0]*Math.cos(m)-x[1]*Math.sin(m),A[1]=x[0]*Math.sin(m)+x[1]*Math.cos(m),A[2]=x[2],f[0]=A[0]+h[0],f[1]=A[1]+h[1],f[2]=A[2]+h[2],f},c.bx=function(f,l,h,m){var x=[],A=[];return x[0]=l[0]-h[0],x[1]=l[1]-h[1],x[2]=l[2]-h[2],A[0]=x[0],A[1]=x[1]*Math.cos(m)-x[2]*Math.sin(m),A[2]=x[1]*Math.sin(m)+x[2]*Math.cos(m),f[0]=A[0]+h[0],f[1]=A[1]+h[1],f[2]=A[2]+h[2],f},c.by=function(f,l,h,m){var x=[],A=[];return x[0]=l[0]-h[0],x[1]=l[1]-h[1],x[2]=l[2]-h[2],A[0]=x[2]*Math.sin(m)+x[0]*Math.cos(m),A[1]=x[1],A[2]=x[2]*Math.cos(m)-x[0]*Math.sin(m),f[0]=A[0]+h[0],f[1]=A[1]+h[1],f[2]=A[2]+h[2],f},c.bz=function(f,l,h){var m=Math.sin(h),x=Math.cos(h),A=l[0],P=l[1],R=l[2],D=l[3],U=l[8],$=l[9],G=l[10],ee=l[11];return l!==f&&(f[4]=l[4],f[5]=l[5],f[6]=l[6],f[7]=l[7],f[12]=l[12],f[13]=l[13],f[14]=l[14],f[15]=l[15]),f[0]=A*x-U*m,f[1]=P*x-$*m,f[2]=R*x-G*m,f[3]=D*x-ee*m,f[8]=A*m+U*x,f[9]=P*m+$*x,f[10]=R*m+G*x,f[11]=D*m+ee*x,f},c.c=je,c.c0=Qi,c.c1=class extends C{},c.c2=Cp,c.c3=function(f){return f<=1?1:Math.pow(2,Math.ceil(Math.log(f)/Math.LN2))},c.c4=Ep,c.c5=function(f,l,h){var m=l[0],x=l[1],A=l[2],P=h[3]*m+h[7]*x+h[11]*A+h[15];return f[0]=(h[0]*m+h[4]*x+h[8]*A+h[12])/(P=P||1),f[1]=(h[1]*m+h[5]*x+h[9]*A+h[13])/P,f[2]=(h[2]*m+h[6]*x+h[10]*A+h[14])/P,f},c.c6=class extends bs{},c.c7=class extends Z{},c.c8=function(f,l){return f[0]===l[0]&&f[1]===l[1]&&f[2]===l[2]&&f[3]===l[3]&&f[4]===l[4]&&f[5]===l[5]&&f[6]===l[6]&&f[7]===l[7]&&f[8]===l[8]&&f[9]===l[9]&&f[10]===l[10]&&f[11]===l[11]&&f[12]===l[12]&&f[13]===l[13]&&f[14]===l[14]&&f[15]===l[15]},c.c9=function(f,l){var h=f[0],m=f[1],x=f[2],A=f[3],P=f[4],R=f[5],D=f[6],U=f[7],$=f[8],G=f[9],ee=f[10],re=f[11],ne=f[12],le=f[13],de=f[14],xe=f[15],$e=l[0],Ie=l[1],De=l[2],et=l[3],ft=l[4],St=l[5],Vt=l[6],zt=l[7],jt=l[8],rr=l[9],Ft=l[10],Ut=l[11],yt=l[12],dr=l[13],pr=l[14],ar=l[15];return Math.abs(h-$e)<=Y*Math.max(1,Math.abs(h),Math.abs($e))&&Math.abs(m-Ie)<=Y*Math.max(1,Math.abs(m),Math.abs(Ie))&&Math.abs(x-De)<=Y*Math.max(1,Math.abs(x),Math.abs(De))&&Math.abs(A-et)<=Y*Math.max(1,Math.abs(A),Math.abs(et))&&Math.abs(P-ft)<=Y*Math.max(1,Math.abs(P),Math.abs(ft))&&Math.abs(R-St)<=Y*Math.max(1,Math.abs(R),Math.abs(St))&&Math.abs(D-Vt)<=Y*Math.max(1,Math.abs(D),Math.abs(Vt))&&Math.abs(U-zt)<=Y*Math.max(1,Math.abs(U),Math.abs(zt))&&Math.abs($-jt)<=Y*Math.max(1,Math.abs($),Math.abs(jt))&&Math.abs(G-rr)<=Y*Math.max(1,Math.abs(G),Math.abs(rr))&&Math.abs(ee-Ft)<=Y*Math.max(1,Math.abs(ee),Math.abs(Ft))&&Math.abs(re-Ut)<=Y*Math.max(1,Math.abs(re),Math.abs(Ut))&&Math.abs(ne-yt)<=Y*Math.max(1,Math.abs(ne),Math.abs(yt))&&Math.abs(le-dr)<=Y*Math.max(1,Math.abs(le),Math.abs(dr))&&Math.abs(de-pr)<=Y*Math.max(1,Math.abs(de),Math.abs(pr))&&Math.abs(xe-ar)<=Y*Math.max(1,Math.abs(xe),Math.abs(ar))},c.cA=function(f,l){ie.REGISTERED_PROTOCOLS[f]=l},c.cB=function(f){delete ie.REGISTERED_PROTOCOLS[f]},c.cC=function(f,l){const h={};for(let x=0;x<f.length;x++){const A=l&&l[f[x].id]||$r(f[x]);l&&(l[f[x].id]=A);let P=h[A];P||(P=h[A]=[]),P.push(f[x])}const m=[];for(const x in h)m.push(h[x]);return m},c.cD=Ht,c.cE=lb,c.cF=cb,c.cG=Cm,c.cH=function(f){f.bucket.createArrays(),f.bucket.tilePixelRatio=Ue/(512*f.bucket.overscaling),f.bucket.compareText={},f.bucket.iconsNeedLinear=!1;const l=f.bucket.layers[0],h=l.layout,m=l._unevaluatedLayout._values,x={layoutIconSize:m["icon-size"].possiblyEvaluate(new Qr(f.bucket.zoom+1),f.canonical),layoutTextSize:m["text-size"].possiblyEvaluate(new Qr(f.bucket.zoom+1),f.canonical),textMaxSize:m["text-size"].possiblyEvaluate(new Qr(18))};if(f.bucket.textSizeData.kind==="composite"){const{minZoom:U,maxZoom:$}=f.bucket.textSizeData;x.compositeTextSizes=[m["text-size"].possiblyEvaluate(new Qr(U),f.canonical),m["text-size"].possiblyEvaluate(new Qr($),f.canonical)]}if(f.bucket.iconSizeData.kind==="composite"){const{minZoom:U,maxZoom:$}=f.bucket.iconSizeData;x.compositeIconSizes=[m["icon-size"].possiblyEvaluate(new Qr(U),f.canonical),m["icon-size"].possiblyEvaluate(new Qr($),f.canonical)]}const A=h.get("text-line-height")*Rn,P=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point",R=h.get("text-keep-upright"),D=h.get("text-size");for(const U of f.bucket.features){const $=h.get("text-font").evaluate(U,{},f.canonical).join(","),G=D.evaluate(U,{},f.canonical),ee=x.layoutTextSize.evaluate(U,{},f.canonical),re=x.layoutIconSize.evaluate(U,{},f.canonical),ne={horizontal:{},vertical:void 0},le=U.text;let de,xe=[0,0];if(le){const De=le.toString(),et=h.get("text-letter-spacing").evaluate(U,{},f.canonical)*Rn,ft=Wl(De)?et:0,St=h.get("text-anchor").evaluate(U,{},f.canonical),Vt=Um(l,U,f.canonical);if(!Vt){const Ft=h.get("text-radial-offset").evaluate(U,{},f.canonical);xe=Ft?$a(St,[Ft*Rn,H_]):h.get("text-offset").evaluate(U,{},f.canonical).map((Ut=>Ut*Rn))}let zt=P?"center":h.get("text-justify").evaluate(U,{},f.canonical);const jt=h.get("symbol-placement")==="point"?h.get("text-max-width").evaluate(U,{},f.canonical)*Rn:1/0,rr=()=>{f.bucket.allowVerticalPlacement&&Yo(De)&&(ne.vertical=jp(le,f.glyphMap,f.glyphPositions,f.imagePositions,$,jt,A,St,"left",ft,xe,c.ao.vertical,!0,ee,G))};if(!P&&Vt){const Ft=new Set;if(zt==="auto")for(let yt=0;yt<Vt.values.length;yt+=2)Ft.add(jm(Vt.values[yt]));else Ft.add(zt);let Ut=!1;for(const yt of Ft)if(!ne.horizontal[yt])if(Ut)ne.horizontal[yt]=ne.horizontal[0];else{const dr=jp(le,f.glyphMap,f.glyphPositions,f.imagePositions,$,jt,A,"center",yt,ft,xe,c.ao.horizontal,!1,ee,G);dr&&(ne.horizontal[yt]=dr,Ut=dr.positionedLines.length===1)}rr()}else{zt==="auto"&&(zt=jm(St));const Ft=jp(le,f.glyphMap,f.glyphPositions,f.imagePositions,$,jt,A,St,zt,ft,xe,c.ao.horizontal,!1,ee,G);Ft&&(ne.horizontal[zt]=Ft),rr(),Yo(De)&&P&&R&&(ne.vertical=jp(le,f.glyphMap,f.glyphPositions,f.imagePositions,$,jt,A,St,zt,ft,xe,c.ao.vertical,!1,ee,G))}}let $e=!1;if(U.icon&&U.icon.name){const De=f.imageMap[U.icon.name];De&&(de=Mw(f.imagePositions[U.icon.name],h.get("icon-offset").evaluate(U,{},f.canonical),h.get("icon-anchor").evaluate(U,{},f.canonical)),$e=!!De.sdf,f.bucket.sdfIcons===void 0?f.bucket.sdfIcons=$e:f.bucket.sdfIcons!==$e&&cr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(De.pixelRatio!==f.bucket.pixelRatio||h.get("icon-rotate").constantOr(1)!==0)&&(f.bucket.iconsNeedLinear=!0))}const Ie=_d(ne.horizontal)||ne.vertical;f.bucket.iconsInText=!!Ie&&Ie.iconsInText,(Ie||de)&&pb(f.bucket,U,ne,de,f.imageMap,x,ee,re,xe,$e,f.canonical,f.subdivisionGranularity)}f.showCollisionBoxes&&f.bucket.generateCollisionDebugBuffers()},c.cI=vm,c.cJ=xm,c.cK=Gc,c.cL=__,c.cM=Yh,c.cN=class{constructor(f){this._marks={start:[f.url,"start"].join("#"),end:[f.url,"end"].join("#"),measure:f.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let f=performance.getEntriesByName(this._marks.measure);return f.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),f=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),f}},c.cO=function(f,l,h,m,x){return s(this,void 0,void 0,(function*(){if(q())try{return yield Tl(f,l,h,m,x)}catch{}return(function(A,P,R,D,U){const $=A.width,G=A.height;Ya&&Sl||(Ya=new OffscreenCanvas($,G),Sl=Ya.getContext("2d",{willReadFrequently:!0})),Ya.width=$,Ya.height=G,Sl.drawImage(A,0,0,$,G);const ee=Sl.getImageData(P,R,D,U);return Sl.clearRect(0,0,$,G),ee.data})(f,l,h,m,x)}))},c.cP=Jl,c.cQ=_,c.cR=Xh,c.cS=rl,c.cT=kc,c.cU=function(f,l){const h=new Map;if(f!=null)if(f.type==="Feature")h.set(Qh(f,l),f);else for(const m of f.features)h.set(Qh(m,l),m);return h},c.cV=function(f,l){if(f==null)return!0;if(f.type==="Feature")return Qh(f,l)!=null;if(f.type==="FeatureCollection"){const h=new Set;for(const m of f.features){const x=Qh(m,l);if(x==null||h.has(x))return!1;h.add(x)}return!0}return!1},c.cW=function(f,l,h){var m,x,A,P;if(l.removeAll&&f.clear(),l.remove)for(const R of l.remove)f.delete(R);if(l.add)for(const R of l.add){const D=Qh(R,h);D!=null&&f.set(D,R)}if(l.update)for(const R of l.update){let D=f.get(R.id);if(D==null)continue;const U=!R.removeAllProperties&&(((m=R.removeProperties)===null||m===void 0?void 0:m.length)>0||((x=R.addOrUpdateProperties)===null||x===void 0?void 0:x.length)>0);if((R.newGeometry||R.removeAllProperties||U)&&(D=Object.assign({},D),f.set(R.id,D),U&&(D.properties=Object.assign({},D.properties))),R.newGeometry&&(D.geometry=R.newGeometry),R.removeAllProperties)D.properties={};else if(((A=R.removeProperties)===null||A===void 0?void 0:A.length)>0)for(const $ of R.removeProperties)Object.prototype.hasOwnProperty.call(D.properties,$)&&delete D.properties[$];if(((P=R.addOrUpdateProperties)===null||P===void 0?void 0:P.length)>0)for(const{key:$,value:G}of R.addOrUpdateProperties)D.properties[$]=G}},c.cX=vs,c.ca=function(f,l){return f[0]=l[0],f[1]=l[1],f[2]=l[2],f[3]=l[3],f[4]=l[4],f[5]=l[5],f[6]=l[6],f[7]=l[7],f[8]=l[8],f[9]=l[9],f[10]=l[10],f[11]=l[11],f[12]=l[12],f[13]=l[13],f[14]=l[14],f[15]=l[15],f},c.cb=f=>f.type==="symbol",c.cc=f=>f.type==="circle",c.cd=f=>f.type==="heatmap",c.ce=f=>f.type==="line",c.cf=f=>f.type==="fill",c.cg=f=>f.type==="fill-extrusion",c.ch=f=>f.type==="hillshade",c.ci=f=>f.type==="color-relief",c.cj=f=>f.type==="raster",c.ck=f=>f.type==="background",c.cl=f=>f.type==="custom",c.cm=vt,c.cn=function(f,l,h){const m=Re(l.x-h.x,l.y-h.y),x=Re(f.x-h.x,f.y-h.y);var A,P;return El(Math.atan2(m[0]*x[1]-m[1]*x[0],(A=m)[0]*(P=x)[0]+A[1]*P[1]))},c.co=At,c.cp=function(f,l){return ko[l]&&(f instanceof MouseEvent||f instanceof WheelEvent)},c.cq=function(f,l){return Oo[l]&&"touches"in f},c.cr=function(f){return Oo[f]||ko[f]},c.cs=function(f,l,h){var m=l[0],x=l[1];return f[0]=h[0]*m+h[4]*x+h[12],f[1]=h[1]*m+h[5]*x+h[13],f},c.ct=function(f,l){const{x:h,y:m}=md.fromLngLat(l);return!(f<0||f>25||m<0||m>=1||h<0||h>=1)},c.cu=function(f,l){return f[0]=l[0],f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=l[1],f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=l[2],f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f},c.cv=class extends bo{},c.cw=Nw,c.cy=function(f){return f.message===Do},c.cz=Me,c.d=Qe,c.e=nr,c.f=f=>s(void 0,void 0,void 0,(function*(){if(f.byteLength===0)return createImageBitmap(new ImageData(1,1));const l=new Blob([new Uint8Array(f)],{type:"image/png"});try{return createImageBitmap(l)}catch(h){throw new Error(`Could not load image because of ${h.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),c.g=se,c.h=f=>new Promise(((l,h)=>{const m=new Image;m.onload=()=>{l(m),URL.revokeObjectURL(m.src),m.onload=null,window.requestAnimationFrame((()=>{m.src=pa}))},m.onerror=()=>h(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const x=new Blob([new Uint8Array(f)],{type:"image/png"});m.src=f.byteLength?URL.createObjectURL(x):pa})),c.i=ur,c.j=(f,l)=>Fe(nr(f,{type:"json"}),l),c.k=mt,c.l=kt,c.m=Fe,c.n=(f,l)=>Fe(nr(f,{type:"arrayBuffer"}),l),c.o=function(f){return new Yh(f).readFields(K0,[])},c.p=T_,c.q=sd,c.r=Vi,c.s=Al,c.t=zc,c.u=Br,c.v=He,c.w=cr,c.x=_o,c.y=gp,c.z=za})),i("worker",["./shared"],(function(c){class s{constructor(ie,se){this.keyCache={},ie&&this.replace(ie,se)}replace(ie,se){this._layerConfigs={},this._layers={},this.update(ie,[],se)}update(ie,se,fe){for(const ke of ie){this._layerConfigs[ke.id]=ke;const Fe=this._layers[ke.id]=c.bJ(ke,fe);Fe._featureFilter=c.aa(Fe.filter,fe),this.keyCache[ke.id]&&delete this.keyCache[ke.id]}for(const ke of se)delete this.keyCache[ke],delete this._layerConfigs[ke],delete this._layers[ke];this.familiesBySource={};const Me=c.cC(Object.values(this._layerConfigs),this.keyCache);for(const ke of Me){const Fe=ke.map((Xt=>this._layers[Xt.id])),Qe=Fe[0];if(Qe.visibility==="none")continue;const We=Qe.source||"";let dt=this.familiesBySource[We];dt||(dt=this.familiesBySource[We]={});const kt=Qe.sourceLayer||"_geojsonTileLayer";let mt=dt[kt];mt||(mt=dt[kt]=[]),mt.push(Fe)}}}class g{constructor(ie){const se={},fe=[];for(const Qe in ie){const We=ie[Qe],dt=se[Qe]={};for(const kt in We){const mt=We[+kt];if(!mt||mt.bitmap.width===0||mt.bitmap.height===0)continue;const Xt={x:0,y:0,w:mt.bitmap.width+2,h:mt.bitmap.height+2};fe.push(Xt),dt[kt]={rect:Xt,metrics:mt.metrics}}}const{w:Me,h:ke}=c.p(fe),Fe=new c.q({width:Me||1,height:ke||1});for(const Qe in ie){const We=ie[Qe];for(const dt in We){const kt=We[+dt];if(!kt||kt.bitmap.width===0||kt.bitmap.height===0)continue;const mt=se[Qe][dt].rect;c.q.copy(kt.bitmap,Fe,{x:0,y:0},{x:mt.x+1,y:mt.y+1},kt.bitmap)}}this.image=Fe,this.positions=se}}c.cD("GlyphAtlas",g);class _{constructor(ie){this.tileID=new c.Z(ie.tileID.overscaledZ,ie.tileID.wrap,ie.tileID.canonical.z,ie.tileID.canonical.x,ie.tileID.canonical.y),this.uid=ie.uid,this.zoom=ie.zoom,this.pixelRatio=ie.pixelRatio,this.tileSize=ie.tileSize,this.source=ie.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ie.showCollisionBoxes,this.collectResourceTiming=!!ie.collectResourceTiming,this.returnDependencies=!!ie.returnDependencies,this.promoteId=ie.promoteId,this.inFlightDependencies=[]}parse(ie,se,fe,Me,ke){return c._(this,void 0,void 0,(function*(){this.status="parsing",this.data=ie,this.collisionBoxArray=new c.a8;const Fe=new c.cE(Object.keys(ie.layers).sort()),Qe=new c.cF(this.tileID,this.promoteId);Qe.bucketLayerIDs=[];const We={},dt={featureIndex:Qe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:fe,subdivisionGranularity:ke},kt=se.familiesBySource[this.source];for(const bt in kt){const Wn=ie.layers[bt];if(!Wn)continue;Wn.version===1&&c.w(`Vector tile source "${this.source}" layer "${bt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ks=Fe.encode(bt),Cl=[];for(let qn=0;qn<Wn.length;qn++){const Pt=Wn.feature(qn),lr=Qe.getId(Pt,bt);Cl.push({feature:Pt,id:lr,index:qn,sourceLayerIndex:ks})}for(const qn of kt[bt]){const Pt=qn[0];Pt.source!==this.source&&c.w(`layer.source = ${Pt.source} does not equal this.source = ${this.source}`),Pt.minzoom&&this.zoom<Math.floor(Pt.minzoom)||Pt.maxzoom&&this.zoom>=Pt.maxzoom||Pt.visibility!=="none"&&(v(qn,this.zoom,fe),(We[Pt.id]=Pt.createBucket({index:Qe.bucketLayerIDs.length,layers:qn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ks,sourceID:this.source})).populate(Cl,dt,this.tileID.canonical),Qe.bucketLayerIDs.push(qn.map((lr=>lr.id))))}}const mt=c.bN(dt.glyphDependencies,(bt=>Object.keys(bt).map(Number)));this.inFlightDependencies.forEach((bt=>bt?.abort())),this.inFlightDependencies=[];let Xt=Promise.resolve({});if(Object.keys(mt).length){const bt=new AbortController;this.inFlightDependencies.push(bt),Xt=Me.sendAsync({type:"GG",data:{stacks:mt,source:this.source,tileID:this.tileID,type:"glyphs"}},bt)}const He=Object.keys(dt.iconDependencies);let fr=Promise.resolve({});if(He.length){const bt=new AbortController;this.inFlightDependencies.push(bt),fr=Me.sendAsync({type:"GI",data:{icons:He,source:this.source,tileID:this.tileID,type:"icons"}},bt)}const Ir=Object.keys(dt.patternDependencies);let er=Promise.resolve({});if(Ir.length){const bt=new AbortController;this.inFlightDependencies.push(bt),er=Me.sendAsync({type:"GI",data:{icons:Ir,source:this.source,tileID:this.tileID,type:"patterns"}},bt)}const Ar=dt.dashDependencies;let mn=Promise.resolve({});if(Object.keys(Ar).length){const bt=new AbortController;this.inFlightDependencies.push(bt),mn=Me.sendAsync({type:"GDA",data:{dashes:Ar}},bt)}const[$n,Hn,Ci,yi]=yield Promise.all([Xt,fr,er,mn]),yn=new g($n),Jn=new c.cG(Hn,Ci);for(const bt in We){const Wn=We[bt];Wn instanceof c.a9?(v(Wn.layers,this.zoom,fe),c.cH({bucket:Wn,glyphMap:$n,glyphPositions:yn.positions,imageMap:Hn,imagePositions:Jn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:dt.subdivisionGranularity})):Wn.hasDependencies&&(Wn instanceof c.cI||Wn instanceof c.cJ||Wn instanceof c.cK)&&(v(Wn.layers,this.zoom,fe),Wn.addFeatures(dt,this.tileID.canonical,Jn.patternPositions,yi))}return this.status="done",{buckets:Object.values(We).filter((bt=>!bt.isEmpty())),featureIndex:Qe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:yn.image,imageAtlas:Jn,dashPositions:yi,glyphMap:this.returnDependencies?$n:null,iconMap:this.returnDependencies?Hn:null,glyphPositions:this.returnDependencies?yn.positions:null}}))}}function v(je,ie,se){const fe=new c.F(ie);for(const Me of je)Me.recalculate(fe,se)}class T{constructor(ie,se,fe){this.actor=ie,this.layerIndex=se,this.availableImages=fe,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(ie,se){return c._(this,void 0,void 0,(function*(){const fe=yield c.n(ie.request,se);try{return{vectorTile:new c.cL(new c.cM(fe.data)),rawData:fe.data,cacheControl:fe.cacheControl,expires:fe.expires}}catch(Me){const ke=new Uint8Array(fe.data);let Fe=`Unable to parse the tile at ${ie.request.url}, `;throw Fe+=ke[0]===31&&ke[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Me.message}`,new Error(Fe)}}))}loadTile(ie){return c._(this,void 0,void 0,(function*(){const se=ie.uid,fe=!!(ie&&ie.request&&ie.request.collectResourceTiming)&&new c.cN(ie.request),Me=new _(ie);this.loading[se]=Me;const ke=new AbortController;Me.abort=ke;try{const Fe=yield this.loadVectorTile(ie,ke);if(delete this.loading[se],!Fe)return null;const Qe=Fe.rawData,We={};Fe.expires&&(We.expires=Fe.expires),Fe.cacheControl&&(We.cacheControl=Fe.cacheControl);const dt={};if(fe){const mt=fe.finish();mt&&(dt.resourceTiming=JSON.parse(JSON.stringify(mt)))}Me.vectorTile=Fe.vectorTile;const kt=Me.parse(Fe.vectorTile,this.layerIndex,this.availableImages,this.actor,ie.subdivisionGranularity);this.loaded[se]=Me,this.fetching[se]={rawTileData:Qe,cacheControl:We,resourceTiming:dt};try{const mt=yield kt;return c.e({rawTileData:Qe.slice(0)},mt,We,dt)}finally{delete this.fetching[se]}}catch(Fe){throw delete this.loading[se],Me.status="done",this.loaded[se]=Me,Fe}}))}reloadTile(ie){return c._(this,void 0,void 0,(function*(){const se=ie.uid;if(!this.loaded||!this.loaded[se])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const fe=this.loaded[se];if(fe.showCollisionBoxes=ie.showCollisionBoxes,fe.status==="parsing"){const Me=yield fe.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.actor,ie.subdivisionGranularity);let ke;if(this.fetching[se]){const{rawTileData:Fe,cacheControl:Qe,resourceTiming:We}=this.fetching[se];delete this.fetching[se],ke=c.e({rawTileData:Fe.slice(0)},Me,Qe,We)}else ke=Me;return ke}if(fe.status==="done"&&fe.vectorTile)return fe.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.actor,ie.subdivisionGranularity)}))}abortTile(ie){return c._(this,void 0,void 0,(function*(){const se=this.loading,fe=ie.uid;se&&se[fe]&&se[fe].abort&&(se[fe].abort.abort(),delete se[fe])}))}removeTile(ie){return c._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[ie.uid]&&delete this.loaded[ie.uid]}))}}class M{constructor(){this.loaded={}}loadTile(ie){return c._(this,void 0,void 0,(function*(){const{uid:se,encoding:fe,rawImageData:Me,redFactor:ke,greenFactor:Fe,blueFactor:Qe,baseShift:We}=ie,dt=Me.width+2,kt=Me.height+2,mt=c.b(Me)?new c.R({width:dt,height:kt},yield c.cO(Me,-1,-1,dt,kt)):Me,Xt=new c.cP(se,mt,fe,ke,Fe,Qe,We);return this.loaded=this.loaded||{},this.loaded[se]=Xt,Xt}))}removeTile(ie){const se=this.loaded,fe=ie.uid;se&&se[fe]&&delete se[fe]}}var O,F,j=(function(){if(F)return O;function je(se,fe){if(se.length!==0){ie(se[0],fe);for(var Me=1;Me<se.length;Me++)ie(se[Me],!fe)}}function ie(se,fe){for(var Me=0,ke=0,Fe=0,Qe=se.length,We=Qe-1;Fe<Qe;We=Fe++){var dt=(se[Fe][0]-se[We][0])*(se[We][1]+se[Fe][1]),kt=Me+dt;ke+=Math.abs(Me)>=Math.abs(dt)?Me-kt+dt:dt-kt+Me,Me=kt}Me+ke>=0!=!!fe&&se.reverse()}return F=1,O=function se(fe,Me){var ke,Fe=fe&&fe.type;if(Fe==="FeatureCollection")for(ke=0;ke<fe.features.length;ke++)se(fe.features[ke],Me);else if(Fe==="GeometryCollection")for(ke=0;ke<fe.geometries.length;ke++)se(fe.geometries[ke],Me);else if(Fe==="Feature")se(fe.geometry,Me);else if(Fe==="Polygon")je(fe.coordinates,Me);else if(Fe==="MultiPolygon")for(ke=0;ke<fe.coordinates.length;ke++)je(fe.coordinates[ke],Me);return fe}})(),V=c.cQ(j);class q extends c.cS{constructor(ie,se){super(new c.cM,0,se,[],[]),this.feature=ie,this.type=ie.type,this.properties=ie.tags?ie.tags:{},"id"in ie&&(typeof ie.id=="string"?this.id=parseInt(ie.id,10):typeof ie.id!="number"||isNaN(ie.id)||(this.id=ie.id))}loadGeometry(){const ie=[],se=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const fe of se){const Me=[];for(const ke of fe)Me.push(new c.P(ke[0],ke[1]));ie.push(Me)}return ie}}class Y extends c.cR{constructor(ie,se){super(new c.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=se?se.version:1,this.extent=se?se.extent:4096,this.length=ie.length,this.features=ie}feature(ie){return new q(this.features[ie],this.extent)}}function X(je,ie){ie.writeVarintField(15,je.version||1),ie.writeStringField(1,je.name||""),ie.writeVarintField(5,je.extent||4096);const se={keys:[],values:[],keycache:{},valuecache:{}};for(let ke=0;ke<je.length;ke++)se.feature=je.feature(ke),ie.writeMessage(2,ae,se);const fe=se.keys;for(const ke of fe)ie.writeStringField(3,ke);const Me=se.values;for(const ke of Me)ie.writeMessage(4,Ze,ke)}function ae(je,ie){if(!je.feature)return;const se=je.feature;se.id!==void 0&&ie.writeVarintField(1,se.id),ie.writeMessage(2,ue,je),ie.writeVarintField(3,se.type),ie.writeMessage(4,qe,se)}function ue(je,ie){for(const se in je.feature?.properties){let fe=je.feature.properties[se],Me=je.keycache[se];if(fe===null)continue;Me===void 0&&(je.keys.push(se),Me=je.keys.length-1,je.keycache[se]=Me),ie.writeVarint(Me),typeof fe!="string"&&typeof fe!="boolean"&&typeof fe!="number"&&(fe=JSON.stringify(fe));const ke=typeof fe+":"+fe;let Fe=je.valuecache[ke];Fe===void 0&&(je.values.push(fe),Fe=je.values.length-1,je.valuecache[ke]=Fe),ie.writeVarint(Fe)}}function ge(je,ie){return(ie<<3)+(7&je)}function Le(je){return je<<1^je>>31}function qe(je,ie){const se=je.loadGeometry(),fe=je.type;let Me=0,ke=0;for(const Fe of se){let Qe=1;fe===1&&(Qe=Fe.length),ie.writeVarint(ge(1,Qe));const We=fe===3?Fe.length-1:Fe.length;for(let dt=0;dt<We;dt++){dt===1&&fe!==1&&ie.writeVarint(ge(2,We-1));const kt=Fe[dt].x-Me,mt=Fe[dt].y-ke;ie.writeVarint(Le(kt)),ie.writeVarint(Le(mt)),Me+=kt,ke+=mt}je.type===3&&ie.writeVarint(ge(7,1))}}function Ze(je,ie){const se=typeof je;se==="string"?ie.writeStringField(1,je):se==="boolean"?ie.writeBooleanField(7,je):se==="number"&&(je%1!=0?ie.writeDoubleField(3,je):je<0?ie.writeSVarintField(6,je):ie.writeVarintField(5,je))}const _t={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:je=>je},it=Math.fround||(gt=new Float32Array(1),je=>(gt[0]=+je,gt[0]));var gt;class Lt{constructor(ie){this.options=Object.assign(Object.create(_t),ie),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ie){const{log:se,minZoom:fe,maxZoom:Me}=this.options;se&&console.time("total time");const ke=`prepare ${ie.length} points`;se&&console.time(ke),this.points=ie;const Fe=[];for(let We=0;We<ie.length;We++){const dt=ie[We];if(!dt.geometry)continue;const[kt,mt]=dt.geometry.coordinates,Xt=it(ce(kt)),He=it(we(mt));Fe.push(Xt,He,1/0,We,-1,1),this.options.reduce&&Fe.push(0)}let Qe=this.trees[Me+1]=this._createTree(Fe);se&&console.timeEnd(ke);for(let We=Me;We>=fe;We--){const dt=+Date.now();Qe=this.trees[We]=this._createTree(this._cluster(Qe,We)),se&&console.log("z%d: %d clusters in %dms",We,Qe.numItems,+Date.now()-dt)}return se&&console.timeEnd("total time"),this}getClusters(ie,se){let fe=((ie[0]+180)%360+360)%360-180;const Me=Math.max(-90,Math.min(90,ie[1]));let ke=ie[2]===180?180:((ie[2]+180)%360+360)%360-180;const Fe=Math.max(-90,Math.min(90,ie[3]));if(ie[2]-ie[0]>=360)fe=-180,ke=180;else if(fe>ke){const mt=this.getClusters([fe,Me,180,Fe],se),Xt=this.getClusters([-180,Me,ke,Fe],se);return mt.concat(Xt)}const Qe=this.trees[this._limitZoom(se)],We=Qe.range(ce(fe),we(Fe),ce(ke),we(Me)),dt=Qe.data,kt=[];for(const mt of We){const Xt=this.stride*mt;kt.push(dt[Xt+5]>1?Ot(dt,Xt,this.clusterProps):this.points[dt[Xt+3]])}return kt}getChildren(ie){const se=this._getOriginId(ie),fe=this._getOriginZoom(ie),Me="No cluster with the specified id.",ke=this.trees[fe];if(!ke)throw new Error(Me);const Fe=ke.data;if(se*this.stride>=Fe.length)throw new Error(Me);const Qe=this.options.radius/(this.options.extent*Math.pow(2,fe-1)),We=ke.within(Fe[se*this.stride],Fe[se*this.stride+1],Qe),dt=[];for(const kt of We){const mt=kt*this.stride;Fe[mt+4]===ie&&dt.push(Fe[mt+5]>1?Ot(Fe,mt,this.clusterProps):this.points[Fe[mt+3]])}if(dt.length===0)throw new Error(Me);return dt}getLeaves(ie,se,fe){const Me=[];return this._appendLeaves(Me,ie,se=se||10,fe=fe||0,0),Me}getTile(ie,se,fe){const Me=this.trees[this._limitZoom(ie)],ke=Math.pow(2,ie),{extent:Fe,radius:Qe}=this.options,We=Qe/Fe,dt=(fe-We)/ke,kt=(fe+1+We)/ke,mt={features:[]};return this._addTileFeatures(Me.range((se-We)/ke,dt,(se+1+We)/ke,kt),Me.data,se,fe,ke,mt),se===0&&this._addTileFeatures(Me.range(1-We/ke,dt,1,kt),Me.data,ke,fe,ke,mt),se===ke-1&&this._addTileFeatures(Me.range(0,dt,We/ke,kt),Me.data,-1,fe,ke,mt),mt.features.length?mt:null}getClusterExpansionZoom(ie){let se=this._getOriginZoom(ie)-1;for(;se<=this.options.maxZoom;){const fe=this.getChildren(ie);if(se++,fe.length!==1)break;ie=fe[0].properties.cluster_id}return se}_appendLeaves(ie,se,fe,Me,ke){const Fe=this.getChildren(se);for(const Qe of Fe){const We=Qe.properties;if(We&&We.cluster?ke+We.point_count<=Me?ke+=We.point_count:ke=this._appendLeaves(ie,We.cluster_id,fe,Me,ke):ke<Me?ke++:ie.push(Qe),ie.length===fe)break}return ke}_createTree(ie){const se=new c.aI(ie.length/this.stride|0,this.options.nodeSize,Float32Array);for(let fe=0;fe<ie.length;fe+=this.stride)se.add(ie[fe],ie[fe+1]);return se.finish(),se.data=ie,se}_addTileFeatures(ie,se,fe,Me,ke,Fe){for(const Qe of ie){const We=Qe*this.stride,dt=se[We+5]>1;let kt,mt,Xt;if(dt)kt=Yt(se,We,this.clusterProps),mt=se[We],Xt=se[We+1];else{const Ir=this.points[se[We+3]];kt=Ir.properties;const[er,Ar]=Ir.geometry.coordinates;mt=ce(er),Xt=we(Ar)}const He={type:1,geometry:[[Math.round(this.options.extent*(mt*ke-fe)),Math.round(this.options.extent*(Xt*ke-Me))]],tags:kt};let fr;fr=dt||this.options.generateId?se[We+3]:this.points[se[We+3]].id,fr!==void 0&&(He.id=fr),Fe.features.push(He)}}_limitZoom(ie){return Math.max(this.options.minZoom,Math.min(Math.floor(+ie),this.options.maxZoom+1))}_cluster(ie,se){const{radius:fe,extent:Me,reduce:ke,minPoints:Fe}=this.options,Qe=fe/(Me*Math.pow(2,se)),We=ie.data,dt=[],kt=this.stride;for(let mt=0;mt<We.length;mt+=kt){if(We[mt+2]<=se)continue;We[mt+2]=se;const Xt=We[mt],He=We[mt+1],fr=ie.within(We[mt],We[mt+1],Qe),Ir=We[mt+5];let er=Ir;for(const Ar of fr){const mn=Ar*kt;We[mn+2]>se&&(er+=We[mn+5])}if(er>Ir&&er>=Fe){let Ar,mn=Xt*Ir,$n=He*Ir,Hn=-1;const Ci=(mt/kt<<5)+(se+1)+this.points.length;for(const yi of fr){const yn=yi*kt;if(We[yn+2]<=se)continue;We[yn+2]=se;const Jn=We[yn+5];mn+=We[yn]*Jn,$n+=We[yn+1]*Jn,We[yn+4]=Ci,ke&&(Ar||(Ar=this._map(We,mt,!0),Hn=this.clusterProps.length,this.clusterProps.push(Ar)),ke(Ar,this._map(We,yn)))}We[mt+4]=Ci,dt.push(mn/er,$n/er,1/0,Ci,-1,er),ke&&dt.push(Hn)}else{for(let Ar=0;Ar<kt;Ar++)dt.push(We[mt+Ar]);if(er>1)for(const Ar of fr){const mn=Ar*kt;if(!(We[mn+2]<=se)){We[mn+2]=se;for(let $n=0;$n<kt;$n++)dt.push(We[mn+$n])}}}}return dt}_getOriginId(ie){return ie-this.points.length>>5}_getOriginZoom(ie){return(ie-this.points.length)%32}_map(ie,se,fe){if(ie[se+5]>1){const Fe=this.clusterProps[ie[se+6]];return fe?Object.assign({},Fe):Fe}const Me=this.points[ie[se+3]].properties,ke=this.options.map(Me);return fe&&ke===Me?Object.assign({},ke):ke}}function Ot(je,ie,se){return{type:"Feature",id:je[ie+3],properties:Yt(je,ie,se),geometry:{type:"Point",coordinates:[(fe=je[ie],360*(fe-.5)),Re(je[ie+1])]}};var fe}function Yt(je,ie,se){const fe=je[ie+5],Me=fe>=1e4?`${Math.round(fe/1e3)}k`:fe>=1e3?Math.round(fe/100)/10+"k":fe,ke=je[ie+6],Fe=ke===-1?{}:Object.assign({},se[ke]);return Object.assign(Fe,{cluster:!0,cluster_id:je[ie+3],point_count:fe,point_count_abbreviated:Me})}function ce(je){return je/360+.5}function we(je){const ie=Math.sin(je*Math.PI/180),se=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return se<0?0:se>1?1:se}function Re(je){const ie=(180-360*je)*Math.PI/180;return 360*Math.atan(Math.exp(ie))/Math.PI-90}function Ue(je,ie,se,fe){let Me=fe;const ke=ie+(se-ie>>1);let Fe,Qe=se-ie;const We=je[ie],dt=je[ie+1],kt=je[se],mt=je[se+1];for(let Xt=ie+3;Xt<se;Xt+=3){const He=at(je[Xt],je[Xt+1],We,dt,kt,mt);if(He>Me)Fe=Xt,Me=He;else if(He===Me){const fr=Math.abs(Xt-ke);fr<Qe&&(Fe=Xt,Qe=fr)}}Me>fe&&(Fe-ie>3&&Ue(je,ie,Fe,fe),je[Fe+2]=Me,se-Fe>3&&Ue(je,Fe,se,fe))}function at(je,ie,se,fe,Me,ke){let Fe=Me-se,Qe=ke-fe;if(Fe!==0||Qe!==0){const We=((je-se)*Fe+(ie-fe)*Qe)/(Fe*Fe+Qe*Qe);We>1?(se=Me,fe=ke):We>0&&(se+=Fe*We,fe+=Qe*We)}return Fe=je-se,Qe=ie-fe,Fe*Fe+Qe*Qe}function pe(je,ie,se,fe){const Me={id:je??null,type:ie,geometry:se,tags:fe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ie==="Point"||ie==="MultiPoint"||ie==="LineString")Pe(Me,se);else if(ie==="Polygon")Pe(Me,se[0]);else if(ie==="MultiLineString")for(const ke of se)Pe(Me,ke);else if(ie==="MultiPolygon")for(const ke of se)Pe(Me,ke[0]);return Me}function Pe(je,ie){for(let se=0;se<ie.length;se+=3)je.minX=Math.min(je.minX,ie[se]),je.minY=Math.min(je.minY,ie[se+1]),je.maxX=Math.max(je.maxX,ie[se]),je.maxY=Math.max(je.maxY,ie[se+1])}function rt(je,ie,se,fe){if(!ie.geometry)return;const Me=ie.geometry.coordinates;if(Me&&Me.length===0)return;const ke=ie.geometry.type,Fe=Math.pow(se.tolerance/((1<<se.maxZoom)*se.extent),2);let Qe=[],We=ie.id;if(se.promoteId?We=ie.properties[se.promoteId]:se.generateId&&(We=fe||0),ke==="Point")vt(Me,Qe);else if(ke==="MultiPoint")for(const dt of Me)vt(dt,Qe);else if(ke==="LineString")At(Me,Qe,Fe,!1);else if(ke==="MultiLineString"){if(se.lineMetrics){for(const dt of Me)Qe=[],At(dt,Qe,Fe,!1),je.push(pe(We,"LineString",Qe,ie.properties));return}$t(Me,Qe,Fe,!1)}else if(ke==="Polygon")$t(Me,Qe,Fe,!0);else{if(ke!=="MultiPolygon"){if(ke==="GeometryCollection"){for(const dt of ie.geometry.geometries)rt(je,{id:We,geometry:dt,properties:ie.properties},se,fe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const dt of Me){const kt=[];$t(dt,kt,Fe,!0),Qe.push(kt)}}je.push(pe(We,ke,Qe,ie.properties))}function vt(je,ie){ie.push(Gt(je[0]),nr(je[1]),0)}function At(je,ie,se,fe){let Me,ke,Fe=0;for(let We=0;We<je.length;We++){const dt=Gt(je[We][0]),kt=nr(je[We][1]);ie.push(dt,kt,0),We>0&&(Fe+=fe?(Me*kt-dt*ke)/2:Math.sqrt(Math.pow(dt-Me,2)+Math.pow(kt-ke,2))),Me=dt,ke=kt}const Qe=ie.length-3;ie[2]=1,Ue(ie,0,Qe,se),ie[Qe+2]=1,ie.size=Math.abs(Fe),ie.start=0,ie.end=ie.size}function $t(je,ie,se,fe){for(let Me=0;Me<je.length;Me++){const ke=[];At(je[Me],ke,se,fe),ie.push(ke)}}function Gt(je){return je/360+.5}function nr(je){const ie=Math.sin(je*Math.PI/180),se=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return se<0?0:se>1?1:se}function Et(je,ie,se,fe,Me,ke,Fe,Qe){if(fe/=ie,ke>=(se/=ie)&&Fe<fe)return je;if(Fe<se||ke>=fe)return null;const We=[];for(const dt of je){const kt=dt.geometry;let mt=dt.type;const Xt=Me===0?dt.minX:dt.minY,He=Me===0?dt.maxX:dt.maxY;if(Xt>=se&&He<fe){We.push(dt);continue}if(He<se||Xt>=fe)continue;let fr=[];if(mt==="Point"||mt==="MultiPoint")Wt(kt,fr,se,fe,Me);else if(mt==="LineString")mr(kt,fr,se,fe,Me,!1,Qe.lineMetrics);else if(mt==="MultiLineString")Cr(kt,fr,se,fe,Me,!1);else if(mt==="Polygon")Cr(kt,fr,se,fe,Me,!0);else if(mt==="MultiPolygon")for(const Ir of kt){const er=[];Cr(Ir,er,se,fe,Me,!0),er.length&&fr.push(er)}if(fr.length){if(Qe.lineMetrics&&mt==="LineString"){for(const Ir of fr)We.push(pe(dt.id,mt,Ir,dt.tags));continue}mt!=="LineString"&&mt!=="MultiLineString"||(fr.length===1?(mt="LineString",fr=fr[0]):mt="MultiLineString"),mt!=="Point"&&mt!=="MultiPoint"||(mt=fr.length===3?"Point":"MultiPoint"),We.push(pe(dt.id,mt,fr,dt.tags))}}return We.length?We:null}function Wt(je,ie,se,fe,Me){for(let ke=0;ke<je.length;ke+=3){const Fe=je[ke+Me];Fe>=se&&Fe<=fe&&cr(ie,je[ke],je[ke+1],je[ke+2])}}function mr(je,ie,se,fe,Me,ke,Fe){let Qe=Mt(je);const We=Me===0?or:ur;let dt,kt,mt=je.start;for(let er=0;er<je.length-3;er+=3){const Ar=je[er],mn=je[er+1],$n=je[er+2],Hn=je[er+3],Ci=je[er+4],yi=Me===0?Ar:mn,yn=Me===0?Hn:Ci;let Jn=!1;Fe&&(dt=Math.sqrt(Math.pow(Ar-Hn,2)+Math.pow(mn-Ci,2))),yi<se?yn>se&&(kt=We(Qe,Ar,mn,Hn,Ci,se),Fe&&(Qe.start=mt+dt*kt)):yi>fe?yn<fe&&(kt=We(Qe,Ar,mn,Hn,Ci,fe),Fe&&(Qe.start=mt+dt*kt)):cr(Qe,Ar,mn,$n),yn<se&&yi>=se&&(kt=We(Qe,Ar,mn,Hn,Ci,se),Jn=!0),yn>fe&&yi<=fe&&(kt=We(Qe,Ar,mn,Hn,Ci,fe),Jn=!0),!ke&&Jn&&(Fe&&(Qe.end=mt+dt*kt),ie.push(Qe),Qe=Mt(je)),Fe&&(mt+=dt)}let Xt=je.length-3;const He=je[Xt],fr=je[Xt+1],Ir=Me===0?He:fr;Ir>=se&&Ir<=fe&&cr(Qe,He,fr,je[Xt+2]),Xt=Qe.length-3,ke&&Xt>=3&&(Qe[Xt]!==Qe[0]||Qe[Xt+1]!==Qe[1])&&cr(Qe,Qe[0],Qe[1],Qe[2]),Qe.length&&ie.push(Qe)}function Mt(je){const ie=[];return ie.size=je.size,ie.start=je.start,ie.end=je.end,ie}function Cr(je,ie,se,fe,Me,ke){for(const Fe of je)mr(Fe,ie,se,fe,Me,ke,!1)}function cr(je,ie,se,fe){je.push(ie,se,fe)}function or(je,ie,se,fe,Me,ke){const Fe=(ke-ie)/(fe-ie);return cr(je,ke,se+(Me-se)*Fe,1),Fe}function ur(je,ie,se,fe,Me,ke){const Fe=(ke-se)/(Me-se);return cr(je,ie+(fe-ie)*Fe,ke,1),Fe}function gs(je,ie){const se=[];for(let fe=0;fe<je.length;fe++){const Me=je[fe],ke=Me.type;let Fe;if(ke==="Point"||ke==="MultiPoint"||ke==="LineString")Fe=Os(Me.geometry,ie);else if(ke==="MultiLineString"||ke==="Polygon"){Fe=[];for(const Qe of Me.geometry)Fe.push(Os(Qe,ie))}else if(ke==="MultiPolygon"){Fe=[];for(const Qe of Me.geometry){const We=[];for(const dt of Qe)We.push(Os(dt,ie));Fe.push(We)}}se.push(pe(Me.id,ke,Fe,Me.tags))}return se}function Os(je,ie){const se=[];se.size=je.size,je.start!==void 0&&(se.start=je.start,se.end=je.end);for(let fe=0;fe<je.length;fe+=3)se.push(je[fe]+ie,je[fe+1],je[fe+2]);return se}function pa(je,ie){if(je.transformed)return je;const se=1<<je.z,fe=je.x,Me=je.y;for(const ke of je.features){const Fe=ke.geometry,Qe=ke.type;if(ke.geometry=[],Qe===1)for(let We=0;We<Fe.length;We+=2)ke.geometry.push(Tl(Fe[We],Fe[We+1],ie,se,fe,Me));else for(let We=0;We<Fe.length;We++){const dt=[];for(let kt=0;kt<Fe[We].length;kt+=2)dt.push(Tl(Fe[We][kt],Fe[We][kt+1],ie,se,fe,Me));ke.geometry.push(dt)}}return je.transformed=!0,je}function Tl(je,ie,se,fe,Me,ke){return[Math.round(se*(je*fe-Me)),Math.round(se*(ie*fe-ke))]}function Ya(je,ie,se,fe,Me){const ke=ie===Me.maxZoom?0:Me.tolerance/((1<<ie)*Me.extent),Fe={features:[],numPoints:0,numSimplified:0,numFeatures:je.length,source:null,x:se,y:fe,z:ie,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Qe of je)Sl(Fe,Qe,ke,Me);return Fe}function Sl(je,ie,se,fe){const Me=ie.geometry,ke=ie.type,Fe=[];if(je.minX=Math.min(je.minX,ie.minX),je.minY=Math.min(je.minY,ie.minY),je.maxX=Math.max(je.maxX,ie.maxX),je.maxY=Math.max(je.maxY,ie.maxY),ke==="Point"||ke==="MultiPoint")for(let Qe=0;Qe<Me.length;Qe+=3)Fe.push(Me[Qe],Me[Qe+1]),je.numPoints++,je.numSimplified++;else if(ke==="LineString")Al(Fe,Me,je,se,!1,!1);else if(ke==="MultiLineString"||ke==="Polygon")for(let Qe=0;Qe<Me.length;Qe++)Al(Fe,Me[Qe],je,se,ke==="Polygon",Qe===0);else if(ke==="MultiPolygon")for(let Qe=0;Qe<Me.length;Qe++){const We=Me[Qe];for(let dt=0;dt<We.length;dt++)Al(Fe,We[dt],je,se,!0,dt===0)}if(Fe.length){let Qe=ie.tags||null;if(ke==="LineString"&&fe.lineMetrics){Qe={};for(const dt in ie.tags)Qe[dt]=ie.tags[dt];Qe.mapbox_clip_start=Me.start/Me.size,Qe.mapbox_clip_end=Me.end/Me.size}const We={geometry:Fe,type:ke==="Polygon"||ke==="MultiPolygon"?3:ke==="LineString"||ke==="MultiLineString"?2:1,tags:Qe};ie.id!==null&&(We.id=ie.id),je.features.push(We)}}function Al(je,ie,se,fe,Me,ke){const Fe=fe*fe;if(fe>0&&ie.size<(Me?Fe:fe))return void(se.numPoints+=ie.length/3);const Qe=[];for(let We=0;We<ie.length;We+=3)(fe===0||ie[We+2]>Fe)&&(se.numSimplified++,Qe.push(ie[We],ie[We+1])),se.numPoints++;Me&&(function(We,dt){let kt=0;for(let mt=0,Xt=We.length,He=Xt-2;mt<Xt;He=mt,mt+=2)kt+=(We[mt]-We[He])*(We[mt+1]+We[He+1]);if(kt>0===dt)for(let mt=0,Xt=We.length;mt<Xt/2;mt+=2){const He=We[mt],fr=We[mt+1];We[mt]=We[Xt-2-mt],We[mt+1]=We[Xt-1-mt],We[Xt-2-mt]=He,We[Xt-1-mt]=fr}})(Qe,ke),je.push(Qe)}const Ei={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class El{constructor(ie,se){const fe=(se=this.options=(function(ke,Fe){for(const Qe in Fe)ke[Qe]=Fe[Qe];return ke})(Object.create(Ei),se)).debug;if(fe&&console.time("preprocess data"),se.maxZoom<0||se.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(se.promoteId&&se.generateId)throw new Error("promoteId and generateId cannot be used together.");let Me=(function(ke,Fe){const Qe=[];if(ke.type==="FeatureCollection")for(let We=0;We<ke.features.length;We++)rt(Qe,ke.features[We],Fe,We);else rt(Qe,ke.type==="Feature"?ke:{geometry:ke},Fe);return Qe})(ie,se);this.tiles={},this.tileCoords=[],fe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",se.indexMaxZoom,se.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Me=(function(ke,Fe){const Qe=Fe.buffer/Fe.extent;let We=ke;const dt=Et(ke,1,-1-Qe,Qe,0,-1,2,Fe),kt=Et(ke,1,1-Qe,2+Qe,0,-1,2,Fe);return(dt||kt)&&(We=Et(ke,1,-Qe,1+Qe,0,-1,2,Fe)||[],dt&&(We=gs(dt,1).concat(We)),kt&&(We=We.concat(gs(kt,-1)))),We})(Me,se),Me.length&&this.splitTile(Me,0,0,0),fe&&(Me.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ie,se,fe,Me,ke,Fe,Qe){const We=[ie,se,fe,Me],dt=this.options,kt=dt.debug;for(;We.length;){Me=We.pop(),fe=We.pop(),se=We.pop(),ie=We.pop();const mt=1<<se,Xt=Oo(se,fe,Me);let He=this.tiles[Xt];if(!He&&(kt>1&&console.time("creation"),He=this.tiles[Xt]=Ya(ie,se,fe,Me,dt),this.tileCoords.push({z:se,x:fe,y:Me}),kt)){kt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",se,fe,Me,He.numFeatures,He.numPoints,He.numSimplified),console.timeEnd("creation"));const Jn=`z${se}`;this.stats[Jn]=(this.stats[Jn]||0)+1,this.total++}if(He.source=ie,ke==null){if(se===dt.indexMaxZoom||He.numPoints<=dt.indexMaxPoints)continue}else{if(se===dt.maxZoom||se===ke)continue;if(ke!=null){const Jn=ke-se;if(fe!==Fe>>Jn||Me!==Qe>>Jn)continue}}if(He.source=null,ie.length===0)continue;kt>1&&console.time("clipping");const fr=.5*dt.buffer/dt.extent,Ir=.5-fr,er=.5+fr,Ar=1+fr;let mn=null,$n=null,Hn=null,Ci=null,yi=Et(ie,mt,fe-fr,fe+er,0,He.minX,He.maxX,dt),yn=Et(ie,mt,fe+Ir,fe+Ar,0,He.minX,He.maxX,dt);ie=null,yi&&(mn=Et(yi,mt,Me-fr,Me+er,1,He.minY,He.maxY,dt),$n=Et(yi,mt,Me+Ir,Me+Ar,1,He.minY,He.maxY,dt),yi=null),yn&&(Hn=Et(yn,mt,Me-fr,Me+er,1,He.minY,He.maxY,dt),Ci=Et(yn,mt,Me+Ir,Me+Ar,1,He.minY,He.maxY,dt),yn=null),kt>1&&console.timeEnd("clipping"),We.push(mn||[],se+1,2*fe,2*Me),We.push($n||[],se+1,2*fe,2*Me+1),We.push(Hn||[],se+1,2*fe+1,2*Me),We.push(Ci||[],se+1,2*fe+1,2*Me+1)}}getTile(ie,se,fe){ie=+ie,se=+se,fe=+fe;const Me=this.options,{extent:ke,debug:Fe}=Me;if(ie<0||ie>24)return null;const Qe=1<<ie,We=Oo(ie,se=se+Qe&Qe-1,fe);if(this.tiles[We])return pa(this.tiles[We],ke);Fe>1&&console.log("drilling down to z%d-%d-%d",ie,se,fe);let dt,kt=ie,mt=se,Xt=fe;for(;!dt&&kt>0;)kt--,mt>>=1,Xt>>=1,dt=this.tiles[Oo(kt,mt,Xt)];return dt&&dt.source?(Fe>1&&(console.log("found parent tile z%d-%d-%d",kt,mt,Xt),console.time("drilling down")),this.splitTile(dt.source,kt,mt,Xt,ie,se,fe),Fe>1&&console.timeEnd("drilling down"),this.tiles[We]?pa(this.tiles[We],ke):null):null}}function Oo(je,ie,se){return 32*((1<<je)*se+ie)+je}class ko extends T{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(ie,se){return c._(this,void 0,void 0,(function*(){const fe=ie.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Me=this._geoJSONIndex.getTile(fe.z,fe.x,fe.y);if(!Me)return null;const ke=new Y(Me.features,{version:2,extent:c.$});let Fe=(function(Qe){const We=new c.cM;return(function(dt,kt){for(const mt in dt.layers)kt.writeMessage(3,X,dt.layers[mt])})(Qe,We),We.finish()})(ke);return Fe.byteOffset===0&&Fe.byteLength===Fe.buffer.byteLength||(Fe=new Uint8Array(Fe)),{vectorTile:ke,rawData:Fe.buffer}}))}loadData(ie){return c._(this,void 0,void 0,(function*(){var se;(se=this._pendingRequest)===null||se===void 0||se.abort();const fe=!!(ie&&ie.request&&ie.request.collectResourceTiming)&&new c.cN(ie.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(ie,this._pendingRequest);const Me=yield this._pendingData;this._geoJSONIndex=ie.cluster?new Lt((function({superclusterOptions:Fe,clusterProperties:Qe}){if(!Qe||!Fe)return Fe;const We={},dt={},kt={accumulated:null,zoom:0},mt={properties:null},Xt=Object.keys(Qe);for(const He of Xt){const[fr,Ir]=Qe[He],er=c.cT(Ir),Ar=c.cT(typeof fr=="string"?[fr,["accumulated"],["get",He]]:fr);We[He]=er.value,dt[He]=Ar.value}return Fe.map=He=>{mt.properties=He;const fr={};for(const Ir of Xt)fr[Ir]=We[Ir].evaluate(kt,mt);return fr},Fe.reduce=(He,fr)=>{mt.properties=fr;for(const Ir of Xt)kt.accumulated=He[Ir],He[Ir]=dt[Ir].evaluate(kt,mt)},Fe})(ie)).load(Me.features):(function(Fe,Qe){return new El(Fe,Qe)})(Me,ie.geojsonVtOptions),this.loaded={};const ke={data:Me};if(fe){const Fe=fe.finish();Fe&&(ke.resourceTiming={},ke.resourceTiming[ie.source]=JSON.parse(JSON.stringify(Fe)))}return ke}catch(Me){if(delete this._pendingRequest,c.cy(Me))return{abandoned:!0};throw Me}}))}getData(){return c._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(ie){const se=this.loaded;return se&&se[ie.uid]?super.reloadTile(ie):this.loadTile(ie)}loadAndProcessGeoJSON(ie,se){return c._(this,void 0,void 0,(function*(){let fe=yield this.loadGeoJSON(ie,se);if(delete this._pendingRequest,typeof fe!="object")throw new Error(`Input data given to '${ie.source}' is not a valid GeoJSON object.`);if(V(fe,!0),ie.filter){const Me=c.cT(ie.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Me.result==="error")throw new Error(Me.value.map((Fe=>`${Fe.key}: ${Fe.message}`)).join(", "));fe={type:"FeatureCollection",features:fe.features.filter((Fe=>Me.value.evaluate({zoom:0},Fe)))}}return fe}))}loadGeoJSON(ie,se){return c._(this,void 0,void 0,(function*(){const{promoteId:fe}=ie;if(ie.request){const Me=yield c.j(ie.request,se);return this._dataUpdateable=c.cV(Me.data,fe)?c.cU(Me.data,fe):void 0,Me.data}if(typeof ie.data=="string")try{const Me=JSON.parse(ie.data);return this._dataUpdateable=c.cV(Me,fe)?c.cU(Me,fe):void 0,Me}catch{throw new Error(`Input data given to '${ie.source}' is not a valid GeoJSON object.`)}if(!ie.dataDiff)throw new Error(`Input data given to '${ie.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${ie.source}`);return c.cW(this._dataUpdateable,ie.dataDiff,fe),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(ie){return c._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(ie){return this._geoJSONIndex.getClusterExpansionZoom(ie.clusterId)}getClusterChildren(ie){return this._geoJSONIndex.getChildren(ie.clusterId)}getClusterLeaves(ie){return this._geoJSONIndex.getLeaves(ie.clusterId,ie.limit,ie.offset)}}class Do{constructor(ie){this.self=ie,this.actor=new c.J(ie),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(se,fe)=>{if(this.externalWorkerSourceTypes[se])throw new Error(`Worker source with name "${se}" already registered.`);this.externalWorkerSourceTypes[se]=fe},this.self.addProtocol=c.cA,this.self.removeProtocol=c.cB,this.self.registerRTLTextPlugin=se=>{c.cX.setMethods(se)},this.actor.registerMessageHandler("LDT",((se,fe)=>this._getDEMWorkerSource(se,fe.source).loadTile(fe))),this.actor.registerMessageHandler("RDT",((se,fe)=>c._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(se,fe.source).removeTile(fe)})))),this.actor.registerMessageHandler("GCEZ",((se,fe)=>c._(this,void 0,void 0,(function*(){return this._getWorkerSource(se,fe.type,fe.source).getClusterExpansionZoom(fe)})))),this.actor.registerMessageHandler("GCC",((se,fe)=>c._(this,void 0,void 0,(function*(){return this._getWorkerSource(se,fe.type,fe.source).getClusterChildren(fe)})))),this.actor.registerMessageHandler("GCL",((se,fe)=>c._(this,void 0,void 0,(function*(){return this._getWorkerSource(se,fe.type,fe.source).getClusterLeaves(fe)})))),this.actor.registerMessageHandler("LD",((se,fe)=>this._getWorkerSource(se,fe.type,fe.source).loadData(fe))),this.actor.registerMessageHandler("GD",((se,fe)=>this._getWorkerSource(se,fe.type,fe.source).getData())),this.actor.registerMessageHandler("LT",((se,fe)=>this._getWorkerSource(se,fe.type,fe.source).loadTile(fe))),this.actor.registerMessageHandler("RT",((se,fe)=>this._getWorkerSource(se,fe.type,fe.source).reloadTile(fe))),this.actor.registerMessageHandler("AT",((se,fe)=>this._getWorkerSource(se,fe.type,fe.source).abortTile(fe))),this.actor.registerMessageHandler("RMT",((se,fe)=>this._getWorkerSource(se,fe.type,fe.source).removeTile(fe))),this.actor.registerMessageHandler("RS",((se,fe)=>c._(this,void 0,void 0,(function*(){if(!this.workerSources[se]||!this.workerSources[se][fe.type]||!this.workerSources[se][fe.type][fe.source])return;const Me=this.workerSources[se][fe.type][fe.source];delete this.workerSources[se][fe.type][fe.source],Me.removeSource!==void 0&&Me.removeSource(fe)})))),this.actor.registerMessageHandler("RM",(se=>c._(this,void 0,void 0,(function*(){delete this.layerIndexes[se],delete this.availableImages[se],delete this.workerSources[se],delete this.demWorkerSources[se],this.globalStates.delete(se)})))),this.actor.registerMessageHandler("SR",((se,fe)=>c._(this,void 0,void 0,(function*(){this.referrer=fe})))),this.actor.registerMessageHandler("SRPS",((se,fe)=>this._syncRTLPluginState(se,fe))),this.actor.registerMessageHandler("IS",((se,fe)=>c._(this,void 0,void 0,(function*(){this.self.importScripts(fe)})))),this.actor.registerMessageHandler("SI",((se,fe)=>this._setImages(se,fe))),this.actor.registerMessageHandler("UL",((se,fe)=>c._(this,void 0,void 0,(function*(){this._getLayerIndex(se).update(fe.layers,fe.removedIds,this._getGlobalState(se))})))),this.actor.registerMessageHandler("UGS",((se,fe)=>c._(this,void 0,void 0,(function*(){const Me=this._getGlobalState(se);for(const ke in fe)Me[ke]=fe[ke]})))),this.actor.registerMessageHandler("SL",((se,fe)=>c._(this,void 0,void 0,(function*(){this._getLayerIndex(se).replace(fe,this._getGlobalState(se))}))))}_getGlobalState(ie){let se=this.globalStates.get(ie);return se||(se={},this.globalStates.set(ie,se)),se}_setImages(ie,se){return c._(this,void 0,void 0,(function*(){this.availableImages[ie]=se;for(const fe in this.workerSources[ie]){const Me=this.workerSources[ie][fe];for(const ke in Me)Me[ke].availableImages=se}}))}_syncRTLPluginState(ie,se){return c._(this,void 0,void 0,(function*(){return yield c.cX.syncState(se,this.self.importScripts)}))}_getAvailableImages(ie){let se=this.availableImages[ie];return se||(se=[]),se}_getLayerIndex(ie){let se=this.layerIndexes[ie];return se||(se=this.layerIndexes[ie]=new s),se}_getWorkerSource(ie,se,fe){if(this.workerSources[ie]||(this.workerSources[ie]={}),this.workerSources[ie][se]||(this.workerSources[ie][se]={}),!this.workerSources[ie][se][fe]){const Me={sendAsync:(ke,Fe)=>(ke.targetMapId=ie,this.actor.sendAsync(ke,Fe))};switch(se){case"vector":this.workerSources[ie][se][fe]=new T(Me,this._getLayerIndex(ie),this._getAvailableImages(ie));break;case"geojson":this.workerSources[ie][se][fe]=new ko(Me,this._getLayerIndex(ie),this._getAvailableImages(ie));break;default:this.workerSources[ie][se][fe]=new this.externalWorkerSourceTypes[se](Me,this._getLayerIndex(ie),this._getAvailableImages(ie))}}return this.workerSources[ie][se][fe]}_getDEMWorkerSource(ie,se){return this.demWorkerSources[ie]||(this.demWorkerSources[ie]={}),this.demWorkerSources[ie][se]||(this.demWorkerSources[ie][se]=new M),this.demWorkerSources[ie][se]}}return c.i(self)&&(self.worker=new Do(self)),Do})),i("index",["exports","./shared"],(function(c,s){var g="5.8.0";function _(){var E=new s.A(4);return s.A!=Float32Array&&(E[1]=0,E[2]=0),E[0]=1,E[3]=1,E}let v,T;const M={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(E,o,d){const y=requestAnimationFrame((C=>{w(),o(C)})),{unsubscribe:w}=s.s(E.signal,"abort",(()=>{w(),cancelAnimationFrame(y),d(s.c())}),!1)},frameAsync(E){return new Promise(((o,d)=>{this.frame(E,o,d)}))},getImageData(E,o=0){return this.getImageCanvasContext(E).getImageData(-o,-o,E.width+2*o,E.height+2*o)},getImageCanvasContext(E){const o=window.document.createElement("canvas"),d=o.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return o.width=E.width,o.height=E.height,d.drawImage(E,0,0,E.width,E.height),d},resolveURL:E=>(v||(v=document.createElement("a")),v.href=E,v.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(T==null&&(T=matchMedia("(prefers-reduced-motion: reduce)")),T.matches)}};class O{static testProp(o){if(!O.docStyle)return o[0];for(let d=0;d<o.length;d++)if(o[d]in O.docStyle)return o[d];return o[0]}static create(o,d,y){const w=window.document.createElement(o);return d!==void 0&&(w.className=d),y&&y.appendChild(w),w}static createNS(o,d){return window.document.createElementNS(o,d)}static disableDrag(){O.docStyle&&O.selectProp&&(O.userSelect=O.docStyle[O.selectProp],O.docStyle[O.selectProp]="none")}static enableDrag(){O.docStyle&&O.selectProp&&(O.docStyle[O.selectProp]=O.userSelect)}static setTransform(o,d){o.style[O.transformProp]=d}static addEventListener(o,d,y,w={}){o.addEventListener(d,y,"passive"in w?w:w.capture)}static removeEventListener(o,d,y,w={}){o.removeEventListener(d,y,"passive"in w?w:w.capture)}static suppressClickInternal(o){o.preventDefault(),o.stopPropagation(),window.removeEventListener("click",O.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",O.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",O.suppressClickInternal,!0)}),0)}static getScale(o){const d=o.getBoundingClientRect();return{x:d.width/o.offsetWidth||1,y:d.height/o.offsetHeight||1,boundingClientRect:d}}static getPoint(o,d,y){const w=d.boundingClientRect;return new s.P((y.clientX-w.left)/d.x-o.clientLeft,(y.clientY-w.top)/d.y-o.clientTop)}static mousePos(o,d){const y=O.getScale(o);return O.getPoint(o,y,d)}static touchPos(o,d){const y=[],w=O.getScale(o);for(let C=0;C<d.length;C++)y.push(O.getPoint(o,w,d[C]));return y}static mouseButton(o){return o.button}static remove(o){o.parentNode&&o.parentNode.removeChild(o)}static sanitize(o){const d=new DOMParser().parseFromString(o,"text/html").body||document.createElement("body"),y=d.querySelectorAll("script");for(const w of y)w.remove();return O.clean(d),d.innerHTML}static isPossiblyDangerous(o,d){const y=d.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(o)||!y.includes("javascript:")&&!y.includes("data:"))||!!o.startsWith("on")||void 0}static clean(o){const d=o.children;for(const y of d)O.removeAttributes(y),O.clean(y)}static removeAttributes(o){for(const{name:d,value:y}of o.attributes)O.isPossiblyDangerous(d,y)&&o.removeAttribute(d)}}O.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,O.selectProp=O.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),O.transformProp=O.testProp(["transform","WebkitTransform"]);const F={supported:!1,testSupport:function(E){!q&&V&&(Y?X(E):j=E)}};let j,V,q=!1,Y=!1;function X(E){const o=E.createTexture();E.bindTexture(E.TEXTURE_2D,o);try{if(E.texImage2D(E.TEXTURE_2D,0,E.RGBA,E.RGBA,E.UNSIGNED_BYTE,V),E.isContextLost())return;F.supported=!0}catch{}E.deleteTexture(o),q=!0}var ae;typeof document<"u"&&(V=document.createElement("img"),V.onload=()=>{j&&X(j),j=null,Y=!0},V.onerror=()=>{q=!0,j=null},V.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(E){let o,d,y,w;E.resetRequestQueue=()=>{o=[],d=0,y=0,w={}},E.addThrottleControl=N=>{const H=y++;return w[H]=N,H},E.removeThrottleControl=N=>{delete w[N],I()},E.getImage=(N,H,W=!0)=>new Promise(((K,Z)=>{F.supported&&(N.headers||(N.headers={}),N.headers.accept="image/webp,*/*"),s.e(N,{type:"image"}),o.push({abortController:H,requestParameters:N,supportImageRefresh:W,state:"queued",onError:te=>{Z(te)},onSuccess:te=>{K(te)}}),I()}));const C=N=>s._(this,void 0,void 0,(function*(){N.state="running";const{requestParameters:H,supportImageRefresh:W,onError:K,onSuccess:Z,abortController:te}=N,oe=W===!1&&!s.i(self)&&!s.g(H.url)&&(!H.headers||Object.keys(H.headers).reduce(((_e,be)=>_e&&be==="accept"),!0));d++;const me=oe?B(H,te):s.m(H,te);try{const _e=yield me;delete N.abortController,N.state="completed",_e.data instanceof HTMLImageElement||s.b(_e.data)?Z(_e):_e.data&&Z({data:yield(ye=_e.data,typeof createImageBitmap=="function"?s.f(ye):s.h(ye)),cacheControl:_e.cacheControl,expires:_e.expires})}catch(_e){delete N.abortController,K(_e)}finally{d--,I()}var ye})),I=()=>{const N=(()=>{for(const H of Object.keys(w))if(w[H]())return!0;return!1})()?s.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let H=d;H<N&&o.length>0;H++){const W=o.shift();W.abortController.signal.aborted?H--:C(W)}},B=(N,H)=>new Promise(((W,K)=>{const Z=new Image,te=N.url,oe=N.credentials;oe&&oe==="include"?Z.crossOrigin="use-credentials":(oe&&oe==="same-origin"||!s.d(te))&&(Z.crossOrigin="anonymous"),H.signal.addEventListener("abort",(()=>{Z.src="",K(s.c())})),Z.fetchPriority="high",Z.onload=()=>{Z.onerror=Z.onload=null,W({data:Z})},Z.onerror=()=>{Z.onerror=Z.onload=null,H.signal.aborted||K(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},Z.src=te}))})(ae||(ae={})),ae.resetRequestQueue();class ue{constructor(o){this._transformRequestFn=o??null}transformRequest(o,d){return this._transformRequestFn&&this._transformRequestFn(o,d)||{url:o}}setTransformRequest(o){this._transformRequestFn=o}}function ge(E){const o=[];if(typeof E=="string")o.push({id:"default",url:E});else if(E&&E.length>0){const d=[];for(const{id:y,url:w}of E){const C=`${y}${w}`;d.indexOf(C)===-1&&(d.push(C),o.push({id:y,url:w}))}}return o}function Le(E,o,d){try{const y=new URL(E);return y.pathname+=`${o}${d}`,y.toString()}catch{throw new Error(`Invalid sprite URL "${E}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function qe(E){const{userImage:o}=E;return!!(o&&o.render&&o.render())&&(E.data.replace(new Uint8Array(o.data.buffer)),!0)}class Ze extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:d,promiseResolve:y}of this.requestors)y(this._getImagesForIds(d));this.requestors=[]}}getImage(o){const d=this.images[o];if(d&&!d.data&&d.spriteData){const y=d.spriteData;d.data=new s.R({width:y.width,height:y.height},y.context.getImageData(y.x,y.y,y.width,y.height).data),d.spriteData=null}return d}addImage(o,d){if(this.images[o])throw new Error(`Image id ${o} already exist, use updateImage instead`);this._validate(o,d)&&(this.images[o]=d)}_validate(o,d){let y=!0;const w=d.data||d.spriteData;return this._validateStretch(d.stretchX,w&&w.width)||(this.fire(new s.k(new Error(`Image "${o}" has invalid "stretchX" value`))),y=!1),this._validateStretch(d.stretchY,w&&w.height)||(this.fire(new s.k(new Error(`Image "${o}" has invalid "stretchY" value`))),y=!1),this._validateContent(d.content,d)||(this.fire(new s.k(new Error(`Image "${o}" has invalid "content" value`))),y=!1),y}_validateStretch(o,d){if(!o)return!0;let y=0;for(const w of o){if(w[0]<y||w[1]<w[0]||d<w[1])return!1;y=w[1]}return!0}_validateContent(o,d){if(!o)return!0;if(o.length!==4)return!1;const y=d.spriteData,w=y&&y.width||d.data.width,C=y&&y.height||d.data.height;return!(o[0]<0||w<o[0]||o[1]<0||C<o[1]||o[2]<0||w<o[2]||o[3]<0||C<o[3]||o[2]<o[0]||o[3]<o[1])}updateImage(o,d,y=!0){const w=this.getImage(o);if(y&&(w.data.width!==d.data.width||w.data.height!==d.data.height))throw new Error(`size mismatch between old image (${w.data.width}x${w.data.height}) and new image (${d.data.width}x${d.data.height}).`);d.version=w.version+1,this.images[o]=d,this.updatedImages[o]=!0}removeImage(o){const d=this.images[o];delete this.images[o],delete this.patterns[o],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o){return new Promise(((d,y)=>{let w=!0;if(!this.isLoaded())for(const C of o)this.images[C]||(w=!1);this.isLoaded()||w?d(this._getImagesForIds(o)):this.requestors.push({ids:o,promiseResolve:d})}))}_getImagesForIds(o){const d={};for(const y of o){let w=this.getImage(y);w||(this.fire(new s.l("styleimagemissing",{id:y})),w=this.getImage(y)),w?d[y]={data:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,textFitWidth:w.textFitWidth,textFitHeight:w.textFitHeight,hasRenderCallback:!!(w.userImage&&w.userImage.render)}:s.w(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return d}getPixelSize(){const{width:o,height:d}=this.atlasImage;return{width:o,height:d}}getPattern(o){const d=this.patterns[o],y=this.getImage(o);if(!y)return null;if(d&&d.position.version===y.version)return d.position;if(d)d.position.version=y.version;else{const w={w:y.data.width+2,h:y.data.height+2,x:0,y:0},C=new s.I(w,y);this.patterns[o]={bin:w,position:C}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const d=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.T(o,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const C in this.patterns)o.push(this.patterns[C].bin);const{w:d,h:y}=s.p(o),w=this.atlasImage;w.resize({width:d||1,height:y||1});for(const C in this.patterns){const{bin:I}=this.patterns[C],B=I.x+1,N=I.y+1,H=this.getImage(C).data,W=H.width,K=H.height;s.R.copy(H,w,{x:0,y:0},{x:B,y:N},{width:W,height:K}),s.R.copy(H,w,{x:0,y:K-1},{x:B,y:N-1},{width:W,height:1}),s.R.copy(H,w,{x:0,y:0},{x:B,y:N+K},{width:W,height:1}),s.R.copy(H,w,{x:W-1,y:0},{x:B-1,y:N},{width:1,height:K}),s.R.copy(H,w,{x:0,y:0},{x:B+W,y:N},{width:1,height:K})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const d of o){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const y=this.getImage(d);y||s.w(`Image with ID: "${d}" was not found`),qe(y)&&this.updateImage(d,y)}}}const _t=1e20;function it(E,o,d,y,w,C,I,B,N){for(let H=o;H<o+y;H++)gt(E,d*C+H,C,w,I,B,N);for(let H=d;H<d+w;H++)gt(E,H*C+o,1,y,I,B,N)}function gt(E,o,d,y,w,C,I){C[0]=0,I[0]=-_t,I[1]=_t,w[0]=E[o];for(let B=1,N=0,H=0;B<y;B++){w[B]=E[o+B*d];const W=B*B;do{const K=C[N];H=(w[B]-w[K]+W-K*K)/(B-K)/2}while(H<=I[N]&&--N>-1);N++,C[N]=B,I[N]=H,I[N+1]=_t}for(let B=0,N=0;B<y;B++){for(;I[N+1]<B;)N++;const H=C[N],W=B-H;E[o+B*d]=w[H]+W*W}}class Lt{constructor(o,d,y){this.requestManager=o,this.localIdeographFontFamily=d,this.entries={},this.lang=y}setURL(o){this.url=o}getGlyphs(o){return s._(this,void 0,void 0,(function*(){const d=[];for(const C in o)for(const I of o[C])d.push(this._getAndCacheGlyphsPromise(C,I));const y=yield Promise.all(d),w={};for(const{stack:C,id:I,glyph:B}of y)w[C]||(w[C]={}),w[C][I]=B&&{id:B.id,bitmap:B.bitmap.clone(),metrics:B.metrics};return w}))}_getAndCacheGlyphsPromise(o,d){return s._(this,void 0,void 0,(function*(){let y=this.entries[o];y||(y=this.entries[o]={glyphs:{},requests:{},ranges:{}});let w=y.glyphs[d];if(w!==void 0)return{stack:o,id:d,glyph:w};if(w=this._tinySDF(y,o,d),w)return y.glyphs[d]=w,{stack:o,id:d,glyph:w};const C=Math.floor(d/256);if(256*C>65535)throw new Error("glyphs > 65535 not supported");if(y.ranges[C])return{stack:o,id:d,glyph:w};if(!this.url)throw new Error("glyphsUrl is not set");if(!y.requests[C]){const B=Lt.loadGlyphRange(o,C,this.url,this.requestManager);y.requests[C]=B}const I=yield y.requests[C];for(const B in I)this._doesCharSupportLocalGlyph(+B)||(y.glyphs[+B]=I[+B]);return y.ranges[C]=!0,{stack:o,id:d,glyph:I[d]||null}}))}_doesCharSupportLocalGlyph(o){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(o))||s.u["CJK Unified Ideographs"](o)||s.u["Hangul Syllables"](o)||s.u.Hiragana(o)||s.u.Katakana(o)||s.u["CJK Symbols and Punctuation"](o)||s.u["Halfwidth and Fullwidth Forms"](o))}_tinySDF(o,d,y){const w=this.localIdeographFontFamily;if(!w||!this._doesCharSupportLocalGlyph(y))return;let C=o.tinySDF;if(!C){let B="400";/bold/i.test(d)?B="900":/medium/i.test(d)?B="500":/light/i.test(d)&&(B="200"),C=o.tinySDF=new Lt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,lang:this.lang,fontFamily:w,fontWeight:B})}const I=C.draw(String.fromCharCode(y));return{id:y,bitmap:new s.q({width:I.width||60,height:I.height||60},I.data),metrics:{width:I.glyphWidth/2||24,height:I.glyphHeight/2||24,left:I.glyphLeft/2+.5||0,top:I.glyphTop/2-27.5||-8,advance:I.glyphAdvance/2||24,isDoubleResolution:!0}}}}Lt.loadGlyphRange=function(E,o,d,y){return s._(this,void 0,void 0,(function*(){const w=256*o,C=w+255,I=y.transformRequest(d.replace("{fontstack}",E).replace("{range}",`${w}-${C}`),"Glyphs"),B=yield s.n(I,new AbortController);if(!B||!B.data)throw new Error(`Could not load glyph range. range: ${o}, ${w}-${C}`);const N={};for(const H of s.o(B.data))N[H.id]=H;return N}))},Lt.TinySDF=class{constructor({fontSize:E=24,buffer:o=3,radius:d=8,cutoff:y=.25,fontFamily:w="sans-serif",fontWeight:C="normal",fontStyle:I="normal",lang:B=null}={}){this.buffer=o,this.cutoff=y,this.radius=d,this.lang=B;const N=this.size=E+4*o,H=this._createCanvas(N),W=this.ctx=H.getContext("2d",{willReadFrequently:!0});W.font=`${I} ${C} ${E}px ${w}`,W.textBaseline="alphabetic",W.textAlign="left",W.fillStyle="black",this.gridOuter=new Float64Array(N*N),this.gridInner=new Float64Array(N*N),this.f=new Float64Array(N),this.z=new Float64Array(N+1),this.v=new Uint16Array(N)}_createCanvas(E){const o=document.createElement("canvas");return o.width=o.height=E,o}draw(E){const{width:o,actualBoundingBoxAscent:d,actualBoundingBoxDescent:y,actualBoundingBoxLeft:w,actualBoundingBoxRight:C}=this.ctx.measureText(E),I=Math.ceil(d),B=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(C-w))),N=Math.min(this.size-this.buffer,I+Math.ceil(y)),H=B+2*this.buffer,W=N+2*this.buffer,K=Math.max(H*W,0),Z=new Uint8ClampedArray(K),te={data:Z,width:H,height:W,glyphWidth:B,glyphHeight:N,glyphTop:I,glyphLeft:0,glyphAdvance:o};if(B===0||N===0)return te;const{ctx:oe,buffer:me,gridInner:ye,gridOuter:_e}=this;this.lang&&(oe.lang=this.lang),oe.clearRect(me,me,B,N),oe.fillText(E,me,me+I);const be=oe.getImageData(me,me,B,N);_e.fill(_t,0,K),ye.fill(0,0,K);for(let Ee=0;Ee<N;Ee++)for(let Te=0;Te<B;Te++){const Oe=be.data[4*(Ee*B+Te)+3]/255;if(Oe===0)continue;const Ne=(Ee+me)*H+Te+me;if(Oe===1)_e[Ne]=0,ye[Ne]=_t;else{const Ce=.5-Oe;_e[Ne]=Ce>0?Ce*Ce:0,ye[Ne]=Ce<0?Ce*Ce:0}}it(_e,0,0,H,W,H,this.f,this.v,this.z),it(ye,me,me,B,N,H,this.f,this.v,this.z);for(let Ee=0;Ee<K;Ee++){const Te=Math.sqrt(_e[Ee])-Math.sqrt(ye[Ee]);Z[Ee]=Math.round(255-255*(Te/this.radius+this.cutoff))}return te}};class Ot{constructor(){this.specification=s.v.light.position}possiblyEvaluate(o,d){return s.B(o.expression.evaluate(d))}interpolate(o,d,y){return{x:s.C.number(o.x,d.x,y),y:s.C.number(o.y,d.y,y),z:s.C.number(o.z,d.z,y)}}}let Yt;class ce extends s.E{constructor(o){super(),Yt=Yt||new s.r({anchor:new s.D(s.v.light.anchor),position:new Ot,color:new s.D(s.v.light.color),intensity:new s.D(s.v.light.intensity)}),this._transitionable=new s.t(Yt,void 0),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,d={}){if(!this._validate(s.x,o,d))for(const y in o){const w=o[y];y.endsWith("-transition")?this._transitionable.setTransition(y.slice(0,-11),w):this._transitionable.setValue(y,w)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,d,y){return(!y||y.validate!==!1)&&s.y(this,o.call(s.z,{value:d,style:{glyphs:!0,sprite:!0},styleSpec:s.v}))}}const we=new s.r({"sky-color":new s.D(s.v.sky["sky-color"]),"horizon-color":new s.D(s.v.sky["horizon-color"]),"fog-color":new s.D(s.v.sky["fog-color"]),"fog-ground-blend":new s.D(s.v.sky["fog-ground-blend"]),"horizon-fog-blend":new s.D(s.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new s.D(s.v.sky["sky-horizon-blend"]),"atmosphere-blend":new s.D(s.v.sky["atmosphere-blend"])});class Re extends s.E{constructor(o){super(),this._transitionable=new s.t(we,void 0),this.setSky(o),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.F(0))}setSky(o,d={}){if(!this._validate(s.G,o,d)){o||(o={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const y in o){const w=o[y];y.endsWith("-transition")?this._transitionable.setTransition(y.slice(0,-11),w):this._transitionable.setValue(y,w)}}}getSky(){return this._transitionable.serialize()}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,d,y={}){return y?.validate!==!1&&s.y(this,o.call(s.z,s.e({value:d,style:{glyphs:!0,sprite:!0},styleSpec:s.v})))}calculateFogBlendOpacity(o){return o<60?0:o<70?(o-60)/10:1}}class Ue{constructor(o,d){this.width=o,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(o,d){const y=o.join(",")+String(d);return this.dashEntry[y]||(this.dashEntry[y]=this.addDash(o,d)),this.dashEntry[y]}getDashRanges(o,d,y){const w=[];let C=o.length%2==1?-o[o.length-1]*y:0,I=o[0]*y,B=!0;w.push({left:C,right:I,isDash:B,zeroLength:o[0]===0});let N=o[0];for(let H=1;H<o.length;H++){B=!B;const W=o[H];C=N*y,N+=W,I=N*y,w.push({left:C,right:I,isDash:B,zeroLength:W===0})}return w}addRoundDash(o,d,y){const w=d/2;for(let C=-y;C<=y;C++){const I=this.width*(this.nextRow+y+C);let B=0,N=o[B];for(let H=0;H<this.width;H++){H/N.right>1&&(N=o[++B]);const W=Math.abs(H-N.left),K=Math.abs(H-N.right),Z=Math.min(W,K);let te;const oe=C/y*(w+1);if(N.isDash){const me=w-Math.abs(oe);te=Math.sqrt(Z*Z+me*me)}else te=w-Math.sqrt(Z*Z+oe*oe);this.data[I+H]=Math.max(0,Math.min(255,te+128))}}}addRegularDash(o){for(let B=o.length-1;B>=0;--B){const N=o[B],H=o[B+1];N.zeroLength?o.splice(B,1):H&&H.isDash===N.isDash&&(H.left=N.left,o.splice(B,1))}const d=o[0],y=o[o.length-1];d.isDash===y.isDash&&(d.left=y.left-this.width,y.right=d.right+this.width);const w=this.width*this.nextRow;let C=0,I=o[C];for(let B=0;B<this.width;B++){B/I.right>1&&(I=o[++C]);const N=Math.abs(B-I.left),H=Math.abs(B-I.right),W=Math.min(N,H);this.data[w+B]=Math.max(0,Math.min(255,(I.isDash?W:-W)+128))}}addDash(o,d){const y=d?7:0,w=2*y+1;if(this.nextRow+w>this.height)return s.w("LineAtlas out of space"),null;let C=0;for(let B=0;B<o.length;B++)C+=o[B];if(C!==0){const B=this.width/C,N=this.getDashRanges(o,this.width,B);d?this.addRoundDash(N,B,y):this.addRegularDash(N)}const I={y:this.nextRow+y,height:2*y,width:C};return this.nextRow+=w,this.dirty=!0,I}bind(o){const d=o.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))}}const at="maplibre_preloaded_worker_pool";class pe{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<pe.workerCount;)this.workers.push(new Worker(s.a.WORKER_URL));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach((d=>{d.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[at]}numActive(){return Object.keys(this.active).length}}const Pe=Math.floor(M.hardwareConcurrency/2);let rt,vt;function At(){return rt||(rt=new pe),rt}pe.workerCount=s.H(globalThis)?Math.max(Math.min(Pe,3),1):1;class $t{constructor(o,d){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=d;const y=this.workerPool.acquire(d);for(let w=0;w<y.length;w++){const C=new s.J(y[w],d);C.name=`Worker ${w}`,this.actors.push(C)}if(!this.actors.length)throw new Error("No actors found")}broadcast(o,d){const y=[];for(const w of this.actors)y.push(w.sendAsync({type:o,data:d}));return Promise.all(y)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(o=!0){this.actors.forEach((d=>{d.remove()})),this.actors=[],o&&this.workerPool.release(this.id)}registerMessageHandler(o,d){for(const y of this.actors)y.registerMessageHandler(o,d)}}function Gt(){return vt||(vt=new $t(At(),s.K),vt.registerMessageHandler("GR",((E,o,d)=>s.m(o,d)))),vt}function nr(E,o){const d=s.L();return s.M(d,d,[1,1,0]),s.N(d,d,[.5*E.width,.5*E.height,1]),E.calculatePosMatrix?s.O(d,d,E.calculatePosMatrix(o.toUnwrapped())):d}function Et(E,o,d,y,w,C,I){var B;const N=(function(Z,te,oe){if(Z)for(const me of Z){const ye=te[me];if(ye&&ye.source===oe&&ye.type==="fill-extrusion")return!0}else for(const me in te){const ye=te[me];if(ye.source===oe&&ye.type==="fill-extrusion")return!0}return!1})((B=w?.layers)!==null&&B!==void 0?B:null,o,E.id),H=C.maxPitchScaleFactor(),W=E.tilesIn(y,H,N);W.sort(Wt);const K=[];for(const Z of W)K.push({wrappedTileID:Z.tileID.wrapped().key,queryResults:Z.tile.queryRenderedFeatures(o,d,E._state,Z.queryGeometry,Z.cameraQueryGeometry,Z.scale,w,C,H,nr(E.transform,Z.tileID),I?(te,oe)=>I(Z.tileID,te,oe):void 0)});return(function(Z,te){for(const oe in Z)for(const me of Z[oe])mr(me,te);return Z})((function(Z){const te={},oe={};for(const me of Z){const ye=me.queryResults,_e=me.wrappedTileID,be=oe[_e]=oe[_e]||{};for(const Ee in ye){const Te=ye[Ee],Oe=be[Ee]=be[Ee]||{},Ne=te[Ee]=te[Ee]||[];for(const Ce of Te)Oe[Ce.featureIndex]||(Oe[Ce.featureIndex]=!0,Ne.push(Ce))}}return te})(K),E)}function Wt(E,o){const d=E.tileID,y=o.tileID;return d.overscaledZ-y.overscaledZ||d.canonical.y-y.canonical.y||d.wrap-y.wrap||d.canonical.x-y.canonical.x}function mr(E,o){const d=E.feature,y=o.getFeatureState(d.layer["source-layer"],d.id);d.source=d.layer.source,d.layer["source-layer"]&&(d.sourceLayer=d.layer["source-layer"]),d.state=y}function Mt(E,o,d){return s._(this,void 0,void 0,(function*(){let y=E;if(E.url?y=(yield s.j(o.transformRequest(E.url,"Source"),d)).data:yield M.frameAsync(d),!y)return null;const w=s.Q(s.e(y,E),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in y&&y.vector_layers&&(w.vectorLayerIds=y.vector_layers.map((C=>C.id))),w}))}class Cr{constructor(o,d){o&&(d?this.setSouthWest(o).setNorthEast(d):Array.isArray(o)&&(o.length===4?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1])))}setNorthEast(o){return this._ne=o instanceof s.S?new s.S(o.lng,o.lat):s.S.convert(o),this}setSouthWest(o){return this._sw=o instanceof s.S?new s.S(o.lng,o.lat):s.S.convert(o),this}extend(o){const d=this._sw,y=this._ne;let w,C;if(o instanceof s.S)w=o,C=o;else{if(!(o instanceof Cr))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend(Cr.convert(o)):this.extend(s.S.convert(o)):o&&("lng"in o||"lon"in o)&&"lat"in o?this.extend(s.S.convert(o)):this;if(w=o._sw,C=o._ne,!w||!C)return this}return d||y?(d.lng=Math.min(w.lng,d.lng),d.lat=Math.min(w.lat,d.lat),y.lng=Math.max(C.lng,y.lng),y.lat=Math.max(C.lat,y.lat)):(this._sw=new s.S(w.lng,w.lat),this._ne=new s.S(C.lng,C.lat)),this}getCenter(){return new s.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.S(this.getWest(),this.getNorth())}getSouthEast(){return new s.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:d,lat:y}=s.S.convert(o);let w=this._sw.lng<=d&&d<=this._ne.lng;return this._sw.lng>this._ne.lng&&(w=this._sw.lng>=d&&d>=this._ne.lng),this._sw.lat<=y&&y<=this._ne.lat&&w}static convert(o){return o instanceof Cr?o:o&&new Cr(o)}static fromLngLat(o,d=0){const y=360*d/40075017,w=y/Math.cos(Math.PI/180*o.lat);return new Cr(new s.S(o.lng-w,o.lat-y),new s.S(o.lng+w,o.lat+y))}adjustAntiMeridian(){const o=new s.S(this._sw.lng,this._sw.lat),d=new s.S(this._ne.lng,this._ne.lat);return new Cr(o,o.lng>d.lng?new s.S(d.lng+360,d.lat):d)}}class cr{constructor(o,d,y){this.bounds=Cr.convert(this.validateBounds(o)),this.minzoom=d||0,this.maxzoom=y||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const d=Math.pow(2,o.z),y=Math.floor(s.V(this.bounds.getWest())*d),w=Math.floor(s.U(this.bounds.getNorth())*d),C=Math.ceil(s.V(this.bounds.getEast())*d),I=Math.ceil(s.U(this.bounds.getSouth())*d);return o.x>=y&&o.x<C&&o.y>=w&&o.y<I}}class or extends s.E{constructor(o,d,y,w){if(super(),this.id=o,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.Q(d,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w)}load(){return s._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield Mt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),o&&(s.e(this,o),o.bounds&&(this.tileBounds=new cr(o.bounds,this.minzoom,this.maxzoom)),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.l("data",{dataType:"source",sourceDataType:"content"})))}catch(o){this._tileJSONRequest=null,this._loaded=!0,this.fire(new s.k(o))}}))}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.abort(),o(),this.load()}setTiles(o){return this.setSourceProperty((()=>{this._options.tiles=o})),this}setUrl(o){return this.setSourceProperty((()=>{this.url=o,this._options.url=o})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return s.e({},this._options)}loadTile(o){return s._(this,void 0,void 0,(function*(){const d=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),y={request:this.map._requestManager.transformRequest(d,"Tile"),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};y.request.collectResourceTiming=this._collectResourceTiming;let w="RT";if(o.actor&&o.state!=="expired"){if(o.state==="loading")return new Promise(((C,I)=>{o.reloadPromise={resolve:C,reject:I}}))}else o.actor=this.dispatcher.getActor(),w="LT";o.abortController=new AbortController;try{const C=yield o.actor.sendAsync({type:w,data:y},o.abortController);if(delete o.abortController,o.aborted)return;this._afterTileLoadWorkerResponse(o,C)}catch(C){if(delete o.abortController,o.aborted)return;if(C&&C.status!==404)throw C;this._afterTileLoadWorkerResponse(o,null)}}))}_afterTileLoadWorkerResponse(o,d){if(d&&d.resourceTiming&&(o.resourceTiming=d.resourceTiming),d&&this.map._refreshExpiredTiles&&o.setExpiryData(d),o.loadVectorData(d,this.map.painter),o.reloadPromise){const y=o.reloadPromise;o.reloadPromise=null,this.loadTile(o).then(y.resolve).catch(y.reject)}}abortTile(o){return s._(this,void 0,void 0,(function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.actor&&(yield o.actor.sendAsync({type:"AT",data:{uid:o.uid,type:this.type,source:this.id}}))}))}unloadTile(o){return s._(this,void 0,void 0,(function*(){o.unloadVectorData(),o.actor&&(yield o.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class ur extends s.E{constructor(o,d,y,w){super(),this.id=o,this.dispatcher=y,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},d),s.e(this,s.Q(d,["url","scheme","tileSize"]))}load(){return s._(this,arguments,void 0,(function*(o=!1){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const d=yield Mt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,d&&(s.e(this,d),d.bounds&&(this.tileBounds=new cr(d.bounds,this.minzoom,this.maxzoom)),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:o})))}catch(d){this._tileJSONRequest=null,this._loaded=!0,this.fire(new s.k(d))}}))}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(o){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),o(),this.load(!0)}setTiles(o){return this.setSourceProperty((()=>{this._options.tiles=o})),this}setUrl(o){return this.setSourceProperty((()=>{this.url=o,this._options.url=o})),this}serialize(){return s.e({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o){return s._(this,void 0,void 0,(function*(){const d=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);o.abortController=new AbortController;try{const y=yield ae.getImage(this.map._requestManager.transformRequest(d,"Tile"),o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(y&&y.data){this.map._refreshExpiredTiles&&(y.cacheControl||y.expires)&&o.setExpiryData({cacheControl:y.cacheControl,expires:y.expires});const w=this.map.painter.context,C=w.gl,I=y.data;o.texture=this.map.painter.getTileTexture(I.width),o.texture?o.texture.update(I,{useMipmap:!0}):(o.texture=new s.T(w,I,C.RGBA,{useMipmap:!0}),o.texture.bind(C.LINEAR,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST)),o.state="loaded"}}catch(y){if(delete o.abortController,o.aborted)o.state="unloaded";else if(y)throw o.state="errored",y}}))}abortTile(o){return s._(this,void 0,void 0,(function*(){o.abortController&&(o.abortController.abort(),delete o.abortController)}))}unloadTile(o){return s._(this,void 0,void 0,(function*(){o.texture&&this.map.painter.saveTileTexture(o.texture)}))}hasTransition(){return!1}}class gs extends ur{constructor(o,d,y,w){super(o,d,y,w),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox",this.redFactor=d.redFactor,this.greenFactor=d.greenFactor,this.blueFactor=d.blueFactor,this.baseShift=d.baseShift}loadTile(o){return s._(this,void 0,void 0,(function*(){const d=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),y=this.map._requestManager.transformRequest(d,"Tile");o.neighboringTiles=this._getNeighboringTiles(o.tileID),o.abortController=new AbortController;try{const w=yield ae.getImage(y,o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(w&&w.data){const C=w.data;this.map._refreshExpiredTiles&&(w.cacheControl||w.expires)&&o.setExpiryData({cacheControl:w.cacheControl,expires:w.expires});const I=s.b(C)&&s.W()?C:yield this.readImageNow(C),B={type:this.type,uid:o.uid,source:this.id,rawImageData:I,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!o.actor||o.state==="expired"){o.actor=this.dispatcher.getActor();const N=yield o.actor.sendAsync({type:"LDT",data:B});o.dem=N,o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0,o.state="loaded"}}}catch(w){if(delete o.abortController,o.aborted)o.state="unloaded";else if(w)throw o.state="errored",w}}))}readImageNow(o){return s._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&s.X()){const d=o.width+2,y=o.height+2;try{return new s.R({width:d,height:y},yield s.Y(o,-1,-1,d,y))}catch{}}return M.getImageData(o,1)}))}_getNeighboringTiles(o){const d=o.canonical,y=Math.pow(2,d.z),w=(d.x-1+y)%y,C=d.x===0?o.wrap-1:o.wrap,I=(d.x+1+y)%y,B=d.x+1===y?o.wrap+1:o.wrap,N={};return N[new s.Z(o.overscaledZ,C,d.z,w,d.y).key]={backfilled:!1},N[new s.Z(o.overscaledZ,B,d.z,I,d.y).key]={backfilled:!1},d.y>0&&(N[new s.Z(o.overscaledZ,C,d.z,w,d.y-1).key]={backfilled:!1},N[new s.Z(o.overscaledZ,o.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},N[new s.Z(o.overscaledZ,B,d.z,I,d.y-1).key]={backfilled:!1}),d.y+1<y&&(N[new s.Z(o.overscaledZ,C,d.z,w,d.y+1).key]={backfilled:!1},N[new s.Z(o.overscaledZ,o.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},N[new s.Z(o.overscaledZ,B,d.z,I,d.y+1).key]={backfilled:!1}),N}unloadTile(o){return s._(this,void 0,void 0,(function*(){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&(yield o.actor.sendAsync({type:"RDT",data:{type:this.type,uid:o.uid,source:this.id}}))}))}}class Os extends s.E{constructor(o,d,y,w){super(),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:d.data},this.actor=y.getActor(),this.setEventedParent(w),this._data=d.data,this._options=s.e({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId,d.clusterMaxZoom!==void 0&&this.maxzoom<=d.clusterMaxZoom&&s.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${d.clusterMaxZoom}".`),this.workerOptions=s.e({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(d.buffer!==void 0?d.buffer:128),tolerance:this._pixelsToTileUnits(d.tolerance!==void 0?d.tolerance:.375),extent:s.$,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(d.clusterMaxZoom),minPoints:Math.max(2,d.clusterMinPoints||2),extent:s.$,radius:this._pixelsToTileUnits(d.clusterRadius||50),log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(o){return o*(s.$/this.tileSize)}_getClusterMaxZoom(o){const d=o?Math.round(o):this.maxzoom-1;return Number.isInteger(o)||o===void 0||s.w(`Integer expected for option 'clusterMaxZoom': provided value "${o}" rounded to "${d}"`),d}load(){return s._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(o){this.map=o,this.load()}setData(o){return this._data=o,this._pendingWorkerUpdate={data:o},this._updateWorkerData(),this}updateData(o){return this._pendingWorkerUpdate.diff=s.a0(this._pendingWorkerUpdate.diff,o),this._updateWorkerData(),this}getData(){return s._(this,void 0,void 0,(function*(){const o=s.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:o})}))}getCoordinatesFromGeometry(o){return o.type==="GeometryCollection"?o.geometries.map((d=>d.coordinates)).flat(1/0):o.coordinates.flat(1/0)}getBounds(){return s._(this,void 0,void 0,(function*(){const o=new Cr,d=yield this.getData();let y;switch(d.type){case"FeatureCollection":y=d.features.map((w=>this.getCoordinatesFromGeometry(w.geometry))).flat(1/0);break;case"Feature":y=this.getCoordinatesFromGeometry(d.geometry);break;default:y=this.getCoordinatesFromGeometry(d)}if(y.length==0)return o;for(let w=0;w<y.length-1;w+=2)o.extend([y[w],y[w+1]]);return o}))}setClusterOptions(o){return this.workerOptions.cluster=o.cluster,o&&(o.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(o.clusterRadius)),o.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(o.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(o){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:o,source:this.id}})}getClusterChildren(o){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:o,source:this.id}})}getClusterLeaves(o,d,y){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:o,limit:d,offset:y}})}_updateWorkerData(){return s._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;const{data:o,diff:d}=this._pendingWorkerUpdate;if(!o&&!d)return void s.w(`No data or diff provided to GeoJSONSource ${this.id}.`);const y=s.e({type:this.type},this.workerOptions);o?(typeof o=="string"?(y.request=this.map._requestManager.transformRequest(M.resolveURL(o),"Source"),y.request.collectResourceTiming=this._collectResourceTiming):y.data=JSON.stringify(o),this._pendingWorkerUpdate.data=void 0):d&&(y.dataDiff=d,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new s.l("dataloading",{dataType:"source"}));try{const w=yield this.actor.sendAsync({type:"LD",data:y});if(this._isUpdatingWorker=!1,this._removed||w.abandoned)return void this.fire(new s.l("dataabort",{dataType:"source"}));this._data=w.data;let C=null;w.resourceTiming&&w.resourceTiming[this.id]&&(C=w.resourceTiming[this.id].slice(0));const I={dataType:"source"};this._collectResourceTiming&&C&&C.length>0&&s.e(I,{resourceTiming:C}),this.fire(new s.l("data",Object.assign(Object.assign({},I),{sourceDataType:"metadata"}))),this.fire(new s.l("data",Object.assign(Object.assign({},I),{sourceDataType:"content"})))}catch(w){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new s.l("dataabort",{dataType:"source"}));this.fire(new s.k(w))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}}))}loaded(){return!this._isUpdatingWorker&&this._pendingWorkerUpdate.data===void 0&&this._pendingWorkerUpdate.diff===void 0}loadTile(o){return s._(this,void 0,void 0,(function*(){const d=o.actor?"RT":"LT";o.actor=this.actor;const y={type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};o.abortController=new AbortController;const w=yield this.actor.sendAsync({type:d,data:y},o.abortController);delete o.abortController,o.unloadVectorData(),o.aborted||o.loadVectorData(w,this.map.painter,d==="RT")}))}abortTile(o){return s._(this,void 0,void 0,(function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.aborted=!0}))}unloadTile(o){return s._(this,void 0,void 0,(function*(){o.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return s.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class pa extends s.E{constructor(o,d,y,w){super(),this.flippedWindingOrder=!1,this.id=o,this.dispatcher=y,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=d}load(o){return s._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const d=yield ae.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,d&&d.data&&(this.image=d.data,o&&(this.coordinates=o),this._finishLoading())}catch(d){this._request=null,this._loaded=!0,this.fire(new s.k(d))}}))}loaded(){return this._loaded}updateImage(o){return o.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=o.url,this.load(o.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(o){this.coordinates=o;const d=o.map(s.a1.fromLngLat);var y;return this.tileID=(function(w){const C=s.a2.fromPoints(w),I=C.width(),B=C.height(),N=Math.max(I,B),H=Math.max(0,Math.floor(-Math.log(N)/Math.LN2)),W=Math.pow(2,H);return new s.a4(H,Math.floor((C.minX+C.maxX)/2*W),Math.floor((C.minY+C.maxY)/2*W))})(d),this.terrainTileRanges=this._getOverlappingTileRanges(d),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=d.map((w=>this.tileID.getTilePoint(w)._round())),this.flippedWindingOrder=((y=this.tileCoords)[1].x-y[0].x)*(y[2].y-y[0].y)-(y[1].y-y[0].y)*(y[2].x-y[0].x)<0,this.fire(new s.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const o=this.map.painter.context,d=o.gl;this.texture||(this.texture=new s.T(o,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let y=!1;for(const w in this.tiles){const C=this.tiles[w];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,y=!0)}y&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(o){return s._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={}):o.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(o){const{minX:d,minY:y,maxX:w,maxY:C}=s.a2.fromPoints(o),I={};for(let B=0;B<=s.a3;B++){const N=Math.pow(2,B),H=Math.floor(d*N),W=Math.floor(y*N),K=Math.floor(w*N),Z=Math.floor(C*N);I[B]={minTileX:H,minTileY:W,maxTileX:K,maxTileY:Z}}return I}}class Tl extends pa{constructor(o,d,y,w){super(o,d,y,w),this.roundZoom=!0,this.type="video",this.options=d}load(){return s._(this,void 0,void 0,(function*(){this._loaded=!1;const o=this.options;this.urls=[];for(const d of o.urls)this.urls.push(this.map._requestManager.transformRequest(d,"Source").url);try{const d=yield s.a5(this.urls);if(this._loaded=!0,!d)return;this.video=d,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(d){this.fire(new s.k(d))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(o){if(this.video){const d=this.video.seekable;o<d.start(0)||o>d.end(0)?this.fire(new s.k(new s.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=o}}getVideo(){return this.video}onAdd(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const o=this.map.painter.context,d=o.gl;this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(o,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let y=!1;for(const w in this.tiles){const C=this.tiles[w];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,y=!0)}y&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Ya extends pa{constructor(o,d,y,w){super(o,d,y,w),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some((C=>!Array.isArray(C)||C.length!==2||C.some((I=>typeof I!="number"))))||this.fire(new s.k(new s.a6(`sources.${o}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.k(new s.a6(`sources.${o}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new s.k(new s.a6(`sources.${o}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new s.k(new s.a6(`sources.${o}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.k(new s.a6(`sources.${o}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}load(){return s._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const d=this.map.painter.context,y=d.gl;this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(d,this.canvas,y.RGBA,{premultiply:!0});let w=!1;for(const C in this.tiles){const I=this.tiles[C];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture,w=!0)}w&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const o of[this.canvas.width,this.canvas.height])if(isNaN(o)||o<=0)return!0;return!1}}const Sl={},Al=E=>{switch(E){case"geojson":return Os;case"image":return pa;case"raster":return ur;case"raster-dem":return gs;case"vector":return or;case"video":return Tl;case"canvas":return Ya}return Sl[E]},Ei="RTLPluginLoaded";class El extends s.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Gt()}_syncState(o){return this.status=o,this.dispatcher.broadcast("SRPS",{pluginStatus:o,pluginURL:this.url}).catch((d=>{throw this.status="error",d}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(o){return s._(this,arguments,void 0,(function*(d,y=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=M.resolveURL(d),!this.url)throw new Error(`requested url ${d} is invalid`);if(this.status==="unavailable"){if(!y)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return s._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new s.l(Ei))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Oo=null;function ko(){return Oo||(Oo=new El),Oo}class Do{constructor(o,d){this.timeAdded=0,this.fadeEndTime=0,this.tileID=o,this.uid=s.a7(),this.uses=0,this.tileSize=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(o){const d=o+this.timeAdded;d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(o){this.demTexture&&o.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(o,d,y){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=(function(w,C){const I={};if(!C)return I;for(const B of w){const N=B.layerIds.map((H=>C.getLayer(H))).filter(Boolean);if(N.length!==0){B.layers=N,B.stateDependentLayerIds&&(B.stateDependentLayers=B.stateDependentLayerIds.map((H=>N.filter((W=>W.id===H))[0])));for(const H of N)I[H.id]=B}}return I})(o.buckets,d?.style),this.hasSymbolBuckets=!1;for(const w in this.buckets){const C=this.buckets[w];if(C instanceof s.a9){if(this.hasSymbolBuckets=!0,!y)break;C.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const w in this.buckets){const C=this.buckets[w];if(C instanceof s.a9&&C.hasRTLText){this.hasRTLText=!0,ko().lazyLoad();break}}this.queryPadding=0;for(const w in this.buckets){const C=this.buckets[w];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(w).queryRadius(C))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),this.dashPositions=o.dashPositions}else this.collisionBoxArray=new s.a8}unloadVectorData(){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(o){return this.buckets[o.id]}upload(o){for(const y in this.buckets){const w=this.buckets[y];w.uploadPending()&&w.upload(o)}const d=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new s.T(o,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(o,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,d,y,w,C,I,B,N,H,W,K){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:w,cameraQueryGeometry:C,scale:I,tileSize:this.tileSize,pixelPosMatrix:W,transform:N,params:B,queryPadding:this.queryPadding*H,getElevation:K},o,d,y):{}}querySourceFeatures(o,d){const y=this.latestFeatureIndex;if(!y||!y.rawTileData)return;const w=y.loadVTLayers(),C=d&&d.sourceLayer?d.sourceLayer:"",I=w._geojsonTileLayer||w[C];if(!I)return;const B=s.aa(d?.filter,d?.globalState),{z:N,x:H,y:W}=this.tileID.canonical,K={z:N,x:H,y:W};for(let Z=0;Z<I.length;Z++){const te=I.feature(Z);if(B.needGeometry){const ye=s.ab(te,!0);if(!B.filter(new s.F(this.tileID.overscaledZ),ye,this.tileID.canonical))continue}else if(!B.filter(new s.F(this.tileID.overscaledZ),te))continue;const oe=y.getId(te,C),me=new s.ac(te,N,H,W,oe);me.tile=K,o.push(me)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const d=this.expirationTime;if(o.cacheControl){const y=s.ad(o.cacheControl);y["max-age"]&&(this.expirationTime=Date.now()+1e3*y["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const y=Date.now();let w=!1;if(this.expirationTime>y)w=!1;else if(d)if(this.expirationTime<d)w=!0;else{const C=this.expirationTime-d;C?this.expirationTime=y+Math.max(C,3e4):w=!0}else w=!0;w?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(o,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(o).length===0)return;const y=this.latestFeatureIndex.loadVTLayers();for(const w in this.buckets){if(!d.style.hasLayer(w))continue;const C=this.buckets[w],I=C.layers[0].sourceLayer||"_geojsonTileLayer",B=y[I],N=o[I];if(!B||!N||Object.keys(N).length===0)continue;C.update(N,B,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const H=d&&d.style&&d.style.getLayer(w);H&&(this.queryPadding=Math.max(this.queryPadding,H.queryRadius(C)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<M.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=M.now()+o}setDependencies(o,d){const y={};for(const w of d)y[w]=!0;this.dependencies[o]=y}hasDependency(o,d){for(const y of o){const w=this.dependencies[y];if(w){for(const C of d)if(w[C])return!0}}return!1}}class je{constructor(o,d){this.max=o,this.onRemove=d,this.reset()}reset(){for(const o in this.data)for(const d of this.data[o])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(o,d,y){const w=o.wrapped().key;this.data[w]===void 0&&(this.data[w]=[]);const C={value:d,timeout:void 0};if(y!==void 0&&(C.timeout=setTimeout((()=>{this.remove(o,C)}),y)),this.data[w].push(C),this.order.push(w),this.order.length>this.max){const I=this._getAndRemoveByKey(this.order[0]);I&&this.onRemove(I)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const d=this.data[o].shift();return d.timeout&&clearTimeout(d.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),d.value}getByKey(o){const d=this.data[o];return d?d[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,d){if(!this.has(o))return this;const y=o.wrapped().key,w=d===void 0?0:this.data[y].indexOf(d),C=this.data[y][w];return this.data[y].splice(w,1),C.timeout&&clearTimeout(C.timeout),this.data[y].length===0&&delete this.data[y],this.onRemove(C.value),this.order.splice(this.order.indexOf(y),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(o){const d=[];for(const y in this.data)for(const w of this.data[y])o(w.value)||d.push(w);for(const y of d)this.remove(y.value.tileID,y)}}class ie{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,d,y){const w=String(d);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][w]=this.stateChanges[o][w]||{},s.e(this.stateChanges[o][w],y),this.deletedStates[o]===null){this.deletedStates[o]={};for(const C in this.state[o])C!==w&&(this.deletedStates[o][C]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][w]===null){this.deletedStates[o][w]={};for(const C in this.state[o][w])y[C]||(this.deletedStates[o][w][C]=null)}else for(const C in y)this.deletedStates[o]&&this.deletedStates[o][w]&&this.deletedStates[o][w][C]===null&&delete this.deletedStates[o][w][C]}removeFeatureState(o,d,y){if(this.deletedStates[o]===null)return;const w=String(d);if(this.deletedStates[o]=this.deletedStates[o]||{},y&&d!==void 0)this.deletedStates[o][w]!==null&&(this.deletedStates[o][w]=this.deletedStates[o][w]||{},this.deletedStates[o][w][y]=null);else if(d!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][w])for(y in this.deletedStates[o][w]={},this.stateChanges[o][w])this.deletedStates[o][w][y]=null;else this.deletedStates[o][w]=null;else this.deletedStates[o]=null}getState(o,d){const y=String(d),w=s.e({},(this.state[o]||{})[y],(this.stateChanges[o]||{})[y]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){const C=this.deletedStates[o][d];if(C===null)return{};for(const I in C)delete w[I]}return w}initializeTileState(o,d){o.setFeatureState(this.state,d)}coalesceChanges(o,d){const y={};for(const w in this.stateChanges){this.state[w]=this.state[w]||{};const C={};for(const I in this.stateChanges[w])this.state[w][I]||(this.state[w][I]={}),s.e(this.state[w][I],this.stateChanges[w][I]),C[I]=this.state[w][I];y[w]=C}for(const w in this.deletedStates){this.state[w]=this.state[w]||{};const C={};if(this.deletedStates[w]===null)for(const I in this.state[w])C[I]={},this.state[w][I]={};else for(const I in this.deletedStates[w]){if(this.deletedStates[w][I]===null)this.state[w][I]={};else for(const B of Object.keys(this.deletedStates[w][I]))delete this.state[w][I][B];C[I]=this.state[w][I]}y[w]=y[w]||{},s.e(y[w],C)}if(this.stateChanges={},this.deletedStates={},Object.keys(y).length!==0)for(const w in o)o[w].setFeatureState(y,d)}}const se=89.25;function fe(E,o){const d=s.ah(o.lat,-s.ai,s.ai);return new s.P(s.V(o.lng)*E,s.U(d)*E)}function Me(E,o){return new s.a1(o.x/E,o.y/E).toLngLat()}function ke(E){return E.cameraToCenterDistance*Math.min(.85*Math.tan(s.ae(90-E.pitch)),Math.tan(s.ae(se-E.pitch)))}function Fe(E,o){const d=E.canonical,y=o/s.af(d.z),w=d.x+Math.pow(2,d.z)*E.wrap,C=s.ag(new Float64Array(16));return s.M(C,C,[w*y,d.y*y,0]),s.N(C,C,[y/s.$,y/s.$,1]),C}function Qe(E,o,d,y,w){const C=s.a1.fromLngLat(E,o),I=w*s.aj(1,E.lat),B=I*Math.cos(s.ae(d)),N=Math.sqrt(I*I-B*B),H=N*Math.sin(s.ae(-y)),W=N*Math.cos(s.ae(-y));return new s.a1(C.x+H,C.y+W,C.z+B)}function We(E,o,d){const y=o.intersectsFrustum(E);if(!d||y===0)return y;const w=o.intersectsPlane(d);return w===0?0:y===2&&w===2?2:1}function dt(E,o,d){let y=0;const w=(d-o)/10;for(let C=0;C<10;C++)y+=w*Math.pow(Math.cos(o+(C+.5)/10*(d-o)),E);return y}function kt(E,o){return function(d,y,w,C,I){const B=2*((E-1)/s.ak(Math.cos(s.ae(se-I))/Math.cos(s.ae(se)))-1),N=Math.acos(w/C),H=2*dt(B-1,0,s.ae(I/2)),W=Math.min(s.ae(se),N+s.ae(I/2)),K=dt(B-1,Math.min(W,N-s.ae(I/2)),W),Z=Math.atan(y/w),te=Math.hypot(y,w);let oe=d;return oe+=s.ak(C/te/Math.max(.5,Math.cos(s.ae(I/2)))),oe+=B*s.ak(Math.cos(Z))/2,oe-=s.ak(Math.max(1,K/H/o))/2,oe}}const mt=kt(9.314,3);function Xt(E,o){const d=(o.roundZoom?Math.round:Math.floor)(E.zoom+s.ak(E.tileSize/o.tileSize));return Math.max(0,d)}function He(E,o){const d=E.getCameraFrustum(),y=E.getClippingPlane(),w=E.screenPointToMercatorCoordinate(E.getCameraPoint()),C=s.a1.fromLngLat(E.center,E.elevation);w.z=C.z+Math.cos(E.pitchInRadians)*E.cameraToCenterDistance/E.worldSize;const I=E.getCoveringTilesDetailsProvider(),B=I.allowVariableZoom(E,o),N=Xt(E,o),H=o.minzoom||0,W=o.maxzoom!==void 0?o.maxzoom:E.maxZoom,K=Math.min(Math.max(0,N),W),Z=Math.pow(2,K),te=[Z*w.x,Z*w.y,0],oe=[Z*C.x,Z*C.y,0],me=Math.hypot(C.x-w.x,C.y-w.y),ye=Math.abs(C.z-w.z),_e=Math.hypot(me,ye),be=Oe=>({zoom:0,x:0,y:0,wrap:Oe,fullyVisible:!1}),Ee=[],Te=[];if(E.renderWorldCopies&&I.allowWorldCopies())for(let Oe=1;Oe<=3;Oe++)Ee.push(be(-Oe)),Ee.push(be(Oe));for(Ee.push(be(0));Ee.length>0;){const Oe=Ee.pop(),Ne=Oe.x,Ce=Oe.y;let ze=Oe.fullyVisible;const ot={x:Ne,y:Ce,z:Oe.zoom},tt=I.getTileBoundingVolume(ot,Oe.wrap,E.elevation,o);if(!ze){const Bt=We(d,tt,y);if(Bt===0)continue;ze=Bt===2}const nt=I.distanceToTile2d(w.x,w.y,ot,tt);let lt=N;B&&(lt=(o.calculateTileZoom||mt)(E.zoom+s.ak(E.tileSize/o.tileSize),nt,ye,_e,E.fov)),lt=(o.roundZoom?Math.round:Math.floor)(lt),lt=Math.max(0,lt);const Nt=Math.min(lt,W);if(Oe.wrap=I.getWrap(C,ot,Oe.wrap),Oe.zoom>=Nt){if(Oe.zoom<H)continue;const Bt=K-Oe.zoom,Tt=te[0]-.5-(Ne<<Bt),qt=te[1]-.5-(Ce<<Bt),wr=o.reparseOverscaled?Math.max(Oe.zoom,lt):Oe.zoom;Te.push({tileID:new s.Z(Oe.zoom===W?wr:Oe.zoom,Oe.wrap,Oe.zoom,Ne,Ce),distanceSq:s.al([oe[0]-.5-Ne,oe[1]-.5-Ce]),tileDistanceToCamera:Math.sqrt(Tt*Tt+qt*qt)})}else for(let Bt=0;Bt<4;Bt++)Ee.push({zoom:Oe.zoom+1,x:(Ne<<1)+Bt%2,y:(Ce<<1)+(Bt>>1),wrap:Oe.wrap,fullyVisible:ze})}return Te.sort(((Oe,Ne)=>Oe.distanceSq-Ne.distanceSq)).map((Oe=>Oe.tileID))}const fr=s.a2.fromPoints([new s.P(0,0),new s.P(s.$,s.$)]);class Ir extends s.E{constructor(o,d,y){super(),this.id=o,this.dispatcher=y,this.on("data",(w=>this._dataHandler(w))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((w,C,I,B)=>{const N=new(Al(C.type))(w,C,I,B);if(N.id!==w)throw new Error(`Expected Source id to be ${w} instead of ${N.id}`);return N})(o,d,y,this),this._tiles={},this._cache=new je(0,(w=>this._unloadTile(w))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ie,this._didEmitContent=!1,this._updated=!1}onAdd(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._maxTileCacheZoomLevels=o?o._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(o)}onRemove(o){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(o)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const o in this._tiles){const d=this._tiles[o];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(o,d,y){return s._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(o),this._tileLoaded(o,d,y)}catch(w){o.state="errored",w.status!==404?this._source.fire(new s.k(w,{tile:o})):this.update(this.transform,this.terrain)}}))}_unloadTile(o){this._source.unloadTile&&this._source.unloadTile(o)}_abortTile(o){this._source.abortTile&&this._source.abortTile(o),this._source.fire(new s.l("dataabort",{tile:o,coord:o.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const y=this._tiles[d];y.upload(o),y.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((o=>o.tileID)).sort(er).map((o=>o.key))}getRenderableIds(o){const d=[];for(const y in this._tiles)this._isIdRenderable(y,o)&&d.push(this._tiles[y]);return o?d.sort(((y,w)=>{const C=y.tileID,I=w.tileID,B=new s.P(C.canonical.x,C.canonical.y)._rotate(-this.transform.bearingInRadians),N=new s.P(I.canonical.x,I.canonical.y)._rotate(-this.transform.bearingInRadians);return C.overscaledZ-I.overscaledZ||N.y-B.y||N.x-B.x})).map((y=>y.tileID.key)):d.map((y=>y.tileID)).sort(er).map((y=>y.key))}hasRenderableParent(o){const d=this.findLoadedParent(o,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(o,d){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(d||!this._tiles[o].holdingForFade())}reload(o){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const d in this._tiles)o?this._reloadTile(d,"expired"):this._tiles[d].state!=="errored"&&this._reloadTile(d,"reloading")}}_reloadTile(o,d){return s._(this,void 0,void 0,(function*(){const y=this._tiles[o];y&&(y.state!=="loading"&&(y.state=d),yield this._loadTile(y,o,d))}))}_tileLoaded(o,d,y){o.timeAdded=M.now(),y==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(d,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),o.aborted||this._source.fire(new s.l("data",{dataType:"source",tile:o,coord:o.tileID}))}_backfillDEM(o){const d=this.getRenderableIds();for(let w=0;w<d.length;w++){const C=d[w];if(o.neighboringTiles&&o.neighboringTiles[C]){const I=this.getTileByID(C);y(o,I),y(I,o)}}function y(w,C){w.needsHillshadePrepare=!0,w.needsTerrainPrepare=!0;let I=C.tileID.canonical.x-w.tileID.canonical.x;const B=C.tileID.canonical.y-w.tileID.canonical.y,N=Math.pow(2,w.tileID.canonical.z),H=C.tileID.key;I===0&&B===0||Math.abs(B)>1||(Math.abs(I)>1&&(Math.abs(I+N)===1?I+=N:Math.abs(I-N)===1&&(I-=N)),C.dem&&w.dem&&(w.dem.backfillBorder(C.dem,I,B),w.neighboringTiles&&w.neighboringTiles[H]&&(w.neighboringTiles[H].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,d){const y=Object.values(o),w=this._getLoadedDescendents(y),C={};for(const I of y){const B=w[I.key];if(!B?.length){C[I.key]=I;continue}const N=I.overscaledZ+Ir.maxUnderzooming,H=B.filter((Z=>Z.tileID.overscaledZ<=N));if(!H.length){C[I.key]=I;continue}const W=Math.min(...H.map((Z=>Z.tileID.overscaledZ))),K=H.filter((Z=>Z.tileID.overscaledZ===W)).map((Z=>Z.tileID));for(const Z of K)d[Z.key]=Z;this._areDescendentsComplete(K,W,I.overscaledZ)||(C[I.key]=I)}return C}_getLoadedDescendents(o){var d;const y={};for(const w in this._tiles){const C=this._tiles[w];if(C.hasData())for(const I of o)C.tileID.isChildOf(I)&&(y[d=I.key]||(y[d]=[])).push(C)}return y}_areDescendentsComplete(o,d,y){return o.length===1&&o[0].isOverscaled()?o[0].overscaledZ===d:Math.pow(4,d-y)===o.length}findLoadedParent(o,d){if(o.key in this._loadedParentTiles){const y=this._loadedParentTiles[o.key];return y&&y.tileID.overscaledZ>=d?y:null}for(let y=o.overscaledZ-1;y>=d;y--){const w=o.scaledTo(y),C=this._getLoadedTile(w);if(C)return C}}findLoadedSibling(o){return this._getLoadedTile(o)}_getLoadedTile(o){const d=this._tiles[o.key];return d&&d.hasData()?d:this._cache.getByKey(o.wrapped().key)}updateCacheSize(o){const d=Math.ceil(o.width/this._source.tileSize)+1,y=Math.ceil(o.height/this._source.tileSize)+1,w=Math.floor(d*y*(this._maxTileCacheZoomLevels===null?s.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),C=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(C)}handleWrapJump(o){const d=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,d){const y={};for(const w in this._tiles){const C=this._tiles[w];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+d),y[C.tileID.key]=C}this._tiles=y;for(const w in this._timers)clearTimeout(this._timers[w]),delete this._timers[w];for(const w in this._tiles)this._setTileReloadTimer(w,this._tiles[w])}}update(o,d){if(!this._sourceLoaded||this._paused)return;let y;this.transform=o,this.terrain=d,this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?y=o.getVisibleUnwrappedCoordinates(this._source.tileID).map((H=>new s.Z(H.canonical.z,H.wrap,H.canonical.z,H.canonical.x,H.canonical.y))):(y=He(o,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:d,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(y=y.filter((H=>this._source.hasTile(H))))):y=[],this.usedForTerrain&&(y=this._addTerrainIdealTiles(y));const w=Xt(o,this._source),C=Math.max(w-Ir.maxOverzooming,this._source.minzoom),I=y.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,I&&this.fire(new s.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const B=this._updateRetainedTiles(y,w);Ar(this._source.type)&&!d&&this._updateFadingTiles(B,C);for(const H in B)this._tiles[H].clearFadeHold();const N=s.am(this._tiles,B);for(const H of N){const W=this._tiles[H];W.hasSymbolBuckets&&!W.holdingForFade()?W.setHoldDuration(this.map._fadeDuration):W.hasSymbolBuckets&&!W.symbolFadeFinished()||this._removeTile(H)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}_addTerrainIdealTiles(o){const d=[];for(const y of o)if(y.canonical.z>this._source.minzoom){const w=y.scaledTo(y.canonical.z-1);d.push(w);const C=y.scaledTo(Math.max(this._source.minzoom,Math.min(y.canonical.z,5)));d.push(C)}return o.concat(d)}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)}_updateRetainedTiles(o,d){var y;const w={},C={},I=Math.max(d-Ir.maxOverzooming,this._source.minzoom);let B={};for(const N of o){const H=this._addTile(N);w[N.key]=N,H.hasData()||(B[N.key]=N)}B=this._retainLoadedChildren(B,w);for(const N in B){const H=B[N];let W=this._tiles[N],K=W?.wasRequested();for(let Z=H.overscaledZ-1;Z>=I;--Z){const te=H.scaledTo(Z);if(C[te.key])break;if(C[te.key]=!0,W=this.getTile(te),!W&&K&&(W=this._addTile(te)),W){const oe=W.hasData();if((oe||!(!((y=this.map)===null||y===void 0)&&y.cancelPendingTileRequestsWhileZooming)||K)&&(w[te.key]=te),K=W.wasRequested(),oe)break}}}return w}_updateFadingTiles(o,d){const y={},w={},C=Object.keys(o),I=M.now();for(const B of C){const N=o[B],H=this._tiles[B];if(!H||H.fadeEndTime!==0&&H.fadeEndTime<=I)continue;const W=this.findLoadedParent(N,d),K=this.findLoadedSibling(N),Z=W||K||null;Z&&(this._addTile(Z.tileID),y[Z.tileID.key]=Z.tileID),w[B]=N}this._retainLoadedChildren(w,o);for(const B in y)o[B]||(this._coveredTiles[B]=!0,o[B]=y[B])}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const d=[];let y,w=this._tiles[o].tileID;for(;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){y=this._loadedParentTiles[w.key];break}d.push(w.key);const C=w.scaledTo(w.overscaledZ-1);if(y=this._getLoadedTile(C),y)break;w=C}for(const C of d)this._loadedParentTiles[C]=y}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const o in this._tiles){const d=this._tiles[o].tileID,y=this._getLoadedTile(d);this._loadedSiblingTiles[d.key]=y}}_addTile(o){let d=this._tiles[o.key];if(d)return d;d=this._cache.getAndRemove(o),d&&(this._setTileReloadTimer(o.key,d),d.tileID=o,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,d)));const y=d;return d||(d=new Do(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(d,o.key,d.state)),d.uses++,this._tiles[o.key]=d,y||this._source.fire(new s.l("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(o,d){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const y=d.getExpiryTimeout();y&&(this._timers[o]=setTimeout((()=>{this._reloadTile(o,"expired"),delete this._timers[o]}),y))}refreshTiles(o){for(const d in this._tiles)(this._isIdRenderable(d)||this._tiles[d].state=="errored")&&o.some((y=>y.equals(this._tiles[d].tileID.canonical)))&&this._reloadTile(d,"expired")}_removeTile(o){const d=this._tiles[o];d&&(d.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}_dataHandler(o){const d=o.sourceDataType;o.dataType==="source"&&d==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&o.dataType==="source"&&d==="content"&&(this.reload(o.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(o);this._cache.reset()}tilesIn(o,d,y){const w=[],C=this.transform;if(!C)return w;const I=C.getCoveringTilesDetailsProvider().allowWorldCopies(),B=y?C.getCameraQueryGeometry(o):o,N=te=>C.screenPointToMercatorCoordinate(te,this.terrain),H=this.transformBbox(o,N,!I),W=this.transformBbox(B,N,!I),K=this.getIds(),Z=s.a2.fromPoints(W);for(let te=0;te<K.length;te++){const oe=this._tiles[K[te]];if(oe.holdingForFade())continue;const me=I?[oe.tileID]:[oe.tileID.unwrapTo(-1),oe.tileID.unwrapTo(0)],ye=Math.pow(2,C.zoom-oe.tileID.overscaledZ),_e=d*oe.queryPadding*s.$/oe.tileSize/ye;for(const be of me){const Ee=Z.map((Te=>be.getTilePoint(new s.a1(Te.x,Te.y))));if(Ee.expandBy(_e),Ee.intersects(fr)){const Te=H.map((Ne=>be.getTilePoint(Ne))),Oe=W.map((Ne=>be.getTilePoint(Ne)));w.push({tile:oe,tileID:I?be:be.unwrapTo(0),queryGeometry:Te,cameraQueryGeometry:Oe,scale:ye})}}}return w}transformBbox(o,d,y){let w=o.map(d);if(y){const C=s.a2.fromPoints(o);C.shrinkBy(.001*Math.min(C.width(),C.height()));const I=C.map(d);s.a2.fromPoints(w).covers(I)||(w=w.map((B=>B.x>.5?new s.a1(B.x-1,B.y,B.z):B)))}return w}getVisibleCoordinates(o){const d=this.getRenderableIds(o).map((y=>this._tiles[y].tileID));return this.transform&&this.transform.populateCache(d),d}hasTransition(){if(this._source.hasTransition())return!0;if(Ar(this._source.type)){const o=M.now();for(const d in this._tiles)if(this._tiles[d].fadeEndTime>=o)return!0}return!1}setFeatureState(o,d,y){this._state.updateState(o=o||"_geojsonTileLayer",d,y)}removeFeatureState(o,d,y){this._state.removeFeatureState(o=o||"_geojsonTileLayer",d,y)}getFeatureState(o,d){return this._state.getState(o=o||"_geojsonTileLayer",d)}setDependencies(o,d,y){const w=this._tiles[o];w&&w.setDependencies(d,y)}reloadTilesForDependencies(o,d){for(const y in this._tiles)this._tiles[y].hasDependency(o,d)&&this._reloadTile(y,"reloading");this._cache.filter((y=>!y.hasDependency(o,d)))}}function er(E,o){const d=Math.abs(2*E.wrap)-+(E.wrap<0),y=Math.abs(2*o.wrap)-+(o.wrap<0);return E.overscaledZ-o.overscaledZ||y-d||o.canonical.y-E.canonical.y||o.canonical.x-E.canonical.x}function Ar(E){return E==="raster"||E==="image"||E==="video"}Ir.maxOverzooming=10,Ir.maxUnderzooming=3;class mn{constructor(o,d){this.reset(o,d)}reset(o,d){this.points=o||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=s.ah(o,0,1);let d=1,y=this._distances[d];const w=o*this.paddedLength+this.padding;for(;y<w&&d<this._distances.length;)y=this._distances[++d];const C=d-1,I=this._distances[C],B=y-I,N=B>0?(w-I)/B:0;return this.points[C].mult(1-N).add(this.points[d].mult(N))}}function $n(E,o){let d=!0;return E==="always"||E!=="never"&&o!=="never"||(d=!1),d}class Hn{constructor(o,d,y){const w=this.boxCells=[],C=this.circleCells=[];this.xCellCount=Math.ceil(o/y),this.yCellCount=Math.ceil(d/y);for(let I=0;I<this.xCellCount*this.yCellCount;I++)w.push([]),C.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=d,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,d,y,w,C){this._forEachCell(d,y,w,C,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(d),this.bboxes.push(y),this.bboxes.push(w),this.bboxes.push(C)}insertCircle(o,d,y,w){this._forEachCell(d-w,y-w,d+w,y+w,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(d),this.circles.push(y),this.circles.push(w)}_insertBoxCell(o,d,y,w,C,I){this.boxCells[C].push(I)}_insertCircleCell(o,d,y,w,C,I){this.circleCells[C].push(I)}_query(o,d,y,w,C,I,B){if(y<0||o>this.width||w<0||d>this.height)return[];const N=[];if(o<=0&&d<=0&&this.width<=y&&this.height<=w){if(C)return[{key:null,x1:o,y1:d,x2:y,y2:w}];for(let H=0;H<this.boxKeys.length;H++)N.push({key:this.boxKeys[H],x1:this.bboxes[4*H],y1:this.bboxes[4*H+1],x2:this.bboxes[4*H+2],y2:this.bboxes[4*H+3]});for(let H=0;H<this.circleKeys.length;H++){const W=this.circles[3*H],K=this.circles[3*H+1],Z=this.circles[3*H+2];N.push({key:this.circleKeys[H],x1:W-Z,y1:K-Z,x2:W+Z,y2:K+Z})}}else this._forEachCell(o,d,y,w,this._queryCell,N,{hitTest:C,overlapMode:I,seenUids:{box:{},circle:{}}},B);return N}query(o,d,y,w){return this._query(o,d,y,w,!1,null)}hitTest(o,d,y,w,C,I){return this._query(o,d,y,w,!0,C,I).length>0}hitTestCircle(o,d,y,w,C){const I=o-y,B=o+y,N=d-y,H=d+y;if(B<0||I>this.width||H<0||N>this.height)return!1;const W=[];return this._forEachCell(I,N,B,H,this._queryCellCircle,W,{hitTest:!0,overlapMode:w,circle:{x:o,y:d,radius:y},seenUids:{box:{},circle:{}}},C),W.length>0}_queryCell(o,d,y,w,C,I,B,N){const{seenUids:H,hitTest:W,overlapMode:K}=B,Z=this.boxCells[C];if(Z!==null){const oe=this.bboxes;for(const me of Z)if(!H.box[me]){H.box[me]=!0;const ye=4*me,_e=this.boxKeys[me];if(o<=oe[ye+2]&&d<=oe[ye+3]&&y>=oe[ye+0]&&w>=oe[ye+1]&&(!N||N(_e))&&(!W||!$n(K,_e.overlapMode))&&(I.push({key:_e,x1:oe[ye],y1:oe[ye+1],x2:oe[ye+2],y2:oe[ye+3]}),W))return!0}}const te=this.circleCells[C];if(te!==null){const oe=this.circles;for(const me of te)if(!H.circle[me]){H.circle[me]=!0;const ye=3*me,_e=this.circleKeys[me];if(this._circleAndRectCollide(oe[ye],oe[ye+1],oe[ye+2],o,d,y,w)&&(!N||N(_e))&&(!W||!$n(K,_e.overlapMode))){const be=oe[ye],Ee=oe[ye+1],Te=oe[ye+2];if(I.push({key:_e,x1:be-Te,y1:Ee-Te,x2:be+Te,y2:Ee+Te}),W)return!0}}}return!1}_queryCellCircle(o,d,y,w,C,I,B,N){const{circle:H,seenUids:W,overlapMode:K}=B,Z=this.boxCells[C];if(Z!==null){const oe=this.bboxes;for(const me of Z)if(!W.box[me]){W.box[me]=!0;const ye=4*me,_e=this.boxKeys[me];if(this._circleAndRectCollide(H.x,H.y,H.radius,oe[ye+0],oe[ye+1],oe[ye+2],oe[ye+3])&&(!N||N(_e))&&!$n(K,_e.overlapMode))return I.push(!0),!0}}const te=this.circleCells[C];if(te!==null){const oe=this.circles;for(const me of te)if(!W.circle[me]){W.circle[me]=!0;const ye=3*me,_e=this.circleKeys[me];if(this._circlesCollide(oe[ye],oe[ye+1],oe[ye+2],H.x,H.y,H.radius)&&(!N||N(_e))&&!$n(K,_e.overlapMode))return I.push(!0),!0}}}_forEachCell(o,d,y,w,C,I,B,N){const H=this._convertToXCellCoord(o),W=this._convertToYCellCoord(d),K=this._convertToXCellCoord(y),Z=this._convertToYCellCoord(w);for(let te=H;te<=K;te++)for(let oe=W;oe<=Z;oe++)if(C.call(this,o,d,y,w,this.xCellCount*oe+te,I,B,N))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,d,y,w,C,I){const B=w-o,N=C-d,H=y+I;return H*H>B*B+N*N}_circleAndRectCollide(o,d,y,w,C,I,B){const N=(I-w)/2,H=Math.abs(o-(w+N));if(H>N+y)return!1;const W=(B-C)/2,K=Math.abs(d-(C+W));if(K>W+y)return!1;if(H<=N||K<=W)return!0;const Z=H-N,te=K-W;return Z*Z+te*te<=y*y}}function Ci(E,o,d){const y=s.L();if(!E){const{vecSouth:K,vecEast:Z}=yn(o),te=_();te[0]=Z[0],te[1]=Z[1],te[2]=K[0],te[3]=K[1],w=te,(W=(I=(C=te)[0])*(H=C[3])-(N=C[2])*(B=C[1]))&&(w[0]=H*(W=1/W),w[1]=-B*W,w[2]=-N*W,w[3]=I*W),y[0]=te[0],y[1]=te[1],y[4]=te[2],y[5]=te[3]}var w,C,I,B,N,H,W;return s.N(y,y,[1/d,1/d,1]),y}function yi(E,o,d,y){if(E){const w=s.L();if(!o){const{vecSouth:C,vecEast:I}=yn(d);w[0]=I[0],w[1]=I[1],w[4]=C[0],w[5]=C[1]}return s.N(w,w,[y,y,1]),w}return d.pixelsToClipSpaceMatrix}function yn(E){const o=Math.cos(E.rollInRadians),d=Math.sin(E.rollInRadians),y=Math.cos(E.pitchInRadians),w=Math.cos(E.bearingInRadians),C=Math.sin(E.bearingInRadians),I=s.ar();I[0]=-w*y*d-C*o,I[1]=-C*y*d+w*o;const B=s.as(I);B<1e-9?s.at(I):s.au(I,I,1/B);const N=s.ar();N[0]=w*y*o-C*d,N[1]=C*y*o+w*d;const H=s.as(N);return H<1e-9?s.at(N):s.au(N,N,1/H),{vecEast:N,vecSouth:I}}function Jn(E,o,d,y){let w;y?(w=[E,o,y(E,o),1],s.aw(w,w,d)):(w=[E,o,0,1],Qa(w,w,d));const C=w[3];return{point:new s.P(w[0]/C,w[1]/C),signedDistanceFromCamera:C,isOccluded:!1}}function bt(E,o){return .5+E/o*.5}function Wn(E,o){return E.x>=-o[0]&&E.x<=o[0]&&E.y>=-o[1]&&E.y<=o[1]}function ks(E,o,d,y,w,C,I,B,N,H,W,K,Z){const te=d?E.textSizeData:E.iconSizeData,oe=s.an(te,o.transform.zoom),me=[256/o.width*2+1,256/o.height*2+1],ye=d?E.text.dynamicLayoutVertexArray:E.icon.dynamicLayoutVertexArray;ye.clear();const _e=E.lineVertexArray,be=d?E.text.placedSymbolArray:E.icon.placedSymbolArray,Ee=o.transform.width/o.transform.height;let Te=!1;for(let Oe=0;Oe<be.length;Oe++){const Ne=be.get(Oe);if(Ne.hidden||Ne.writingMode===s.ao.vertical&&!Te){ms(Ne.numGlyphs,ye);continue}Te=!1;const Ce=new s.P(Ne.anchorX,Ne.anchorY),ze={getElevation:Z,pitchedLabelPlaneMatrix:y,lineVertexArray:_e,pitchWithMap:C,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:o.transform,tileAnchorPoint:Ce,unwrappedTileID:N,width:H,height:W,translation:K},ot=Pl(Ne.anchorX,Ne.anchorY,ze);if(!Wn(ot.point,me)){ms(Ne.numGlyphs,ye);continue}const tt=bt(o.transform.cameraToCenterDistance,ot.signedDistanceFromCamera),nt=s.ap(te,oe,Ne),lt=C?nt*o.transform.getPitchedTextCorrection(Ne.anchorX,Ne.anchorY,N)/tt:nt*tt,Nt=Pt({projectionContext:ze,pitchedLabelPlaneMatrixInverse:w,symbol:Ne,fontSize:lt,flip:!1,keepUpright:I,glyphOffsetArray:E.glyphOffsetArray,dynamicLayoutVertexArray:ye,aspectRatio:Ee,rotateToLine:B});Te=Nt.useVertical,(Nt.notEnoughRoom||Te||Nt.needsFlipping&&Pt({projectionContext:ze,pitchedLabelPlaneMatrixInverse:w,symbol:Ne,fontSize:lt,flip:!0,keepUpright:I,glyphOffsetArray:E.glyphOffsetArray,dynamicLayoutVertexArray:ye,aspectRatio:Ee,rotateToLine:B}).notEnoughRoom)&&ms(Ne.numGlyphs,ye)}d?E.text.dynamicLayoutVertexBuffer.updateData(ye):E.icon.dynamicLayoutVertexBuffer.updateData(ye)}function Cl(E,o,d,y,w,C,I,B){const N=C.glyphStartIndex+C.numGlyphs,H=C.lineStartIndex,W=C.lineStartIndex+C.lineLength,K=o.getoffsetX(C.glyphStartIndex),Z=o.getoffsetX(N-1),te=Ka(E*K,d,y,w,C.segment,H,W,B,I);if(!te)return null;const oe=Ka(E*Z,d,y,w,C.segment,H,W,B,I);return oe?B.projectionCache.anyProjectionOccluded?null:{first:te,last:oe}:null}function qn(E,o,d,y){return E===s.ao.horizontal&&Math.abs(d.y-o.y)>Math.abs(d.x-o.x)*y?{useVertical:!0}:(E===s.ao.vertical?o.y<d.y:o.x>d.x)?{needsFlipping:!0}:null}function Pt(E){const{projectionContext:o,pitchedLabelPlaneMatrixInverse:d,symbol:y,fontSize:w,flip:C,keepUpright:I,glyphOffsetArray:B,dynamicLayoutVertexArray:N,aspectRatio:H,rotateToLine:W}=E,K=w/24,Z=y.lineOffsetX*K,te=y.lineOffsetY*K;let oe;if(y.numGlyphs>1){const me=y.glyphStartIndex+y.numGlyphs,ye=y.lineStartIndex,_e=y.lineStartIndex+y.lineLength,be=Cl(K,B,Z,te,C,y,W,o);if(!be)return{notEnoughRoom:!0};const Ee=wc(be.first.point.x,be.first.point.y,o,d),Te=wc(be.last.point.x,be.last.point.y,o,d);if(I&&!C){const Oe=qn(y.writingMode,Ee,Te,H);if(Oe)return Oe}oe=[be.first];for(let Oe=y.glyphStartIndex+1;Oe<me-1;Oe++){const Ne=Ka(K*B.getoffsetX(Oe),Z,te,C,y.segment,ye,_e,o,W);if(!Ne)return{notEnoughRoom:!0};oe.push(Ne)}oe.push(be.last)}else{if(I&&!C){const ye=Pi(o.tileAnchorPoint.x,o.tileAnchorPoint.y,o).point,_e=y.lineStartIndex+y.segment+1,be=new s.P(o.lineVertexArray.getx(_e),o.lineVertexArray.gety(_e)),Ee=Pi(be.x,be.y,o),Te=Ee.signedDistanceFromCamera>0?Ee.point:lr(o.tileAnchorPoint,be,ye,1,o),Oe=wc(ye.x,ye.y,o,d),Ne=wc(Te.x,Te.y,o,d),Ce=qn(y.writingMode,Oe,Ne,H);if(Ce)return Ce}const me=Ka(K*B.getoffsetX(y.glyphStartIndex),Z,te,C,y.segment,y.lineStartIndex,y.lineStartIndex+y.lineLength,o,W);if(!me||o.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};oe=[me]}for(const me of oe)s.av(N,me.point,me.angle);return{}}function lr(E,o,d,y,w){const C=E.add(E.sub(o)._unit()),I=Pi(C.x,C.y,w).point,B=d.sub(I);return d.add(B._mult(y/B.mag()))}function _r(E,o,d){const y=o.projectionCache;if(y.projections[E])return y.projections[E];const w=new s.P(o.lineVertexArray.getx(E),o.lineVertexArray.gety(E)),C=Pi(w.x,w.y,o);if(C.signedDistanceFromCamera>0)return y.projections[E]=C.point,y.anyProjectionOccluded=y.anyProjectionOccluded||C.isOccluded,C.point;const I=E-d.direction;return lr(d.distanceFromAnchor===0?o.tileAnchorPoint:new s.P(o.lineVertexArray.getx(I),o.lineVertexArray.gety(I)),w,d.previousVertex,d.absOffsetX-d.distanceFromAnchor+1,o)}function Pi(E,o,d){const y=E+d.translation[0],w=o+d.translation[1];let C;return d.pitchWithMap?(C=Jn(y,w,d.pitchedLabelPlaneMatrix,d.getElevation),C.isOccluded=!1):(C=d.transform.projectTileCoordinates(y,w,d.unwrappedTileID,d.getElevation),C.point.x=(.5*C.point.x+.5)*d.width,C.point.y=(.5*-C.point.y+.5)*d.height),C}function wc(E,o,d,y){if(d.pitchWithMap){const w=[E,o,0,1];return s.aw(w,w,y),d.transform.projectTileCoordinates(w[0]/w[3],w[1]/w[3],d.unwrappedTileID,d.getElevation).point}return{x:E/d.width*2-1,y:1-o/d.height*2}}function Pl(E,o,d){return d.transform.projectTileCoordinates(E,o,d.unwrappedTileID,d.getElevation)}function xr(E,o,d){return E._unit()._perp()._mult(o*d)}function Ml(E,o,d,y,w,C,I,B,N){if(B.projectionCache.offsets[E])return B.projectionCache.offsets[E];const H=d.add(o);if(E+N.direction<y||E+N.direction>=w)return B.projectionCache.offsets[E]=H,H;const W=_r(E+N.direction,B,N),K=xr(W.sub(d),I,N.direction),Z=d.add(K),te=W.add(K);return B.projectionCache.offsets[E]=s.ax(C,H,Z,te)||H,B.projectionCache.offsets[E]}function Ka(E,o,d,y,w,C,I,B,N){const H=y?E-o:E+o;let W=H>0?1:-1,K=0;y&&(W*=-1,K=Math.PI),W<0&&(K+=Math.PI);let Z,te=W>0?C+w:C+w+1;B.projectionCache.cachedAnchorPoint?Z=B.projectionCache.cachedAnchorPoint:(Z=Pi(B.tileAnchorPoint.x,B.tileAnchorPoint.y,B).point,B.projectionCache.cachedAnchorPoint=Z);let oe,me,ye=Z,_e=Z,be=0,Ee=0;const Te=Math.abs(H),Oe=[];let Ne;for(;be+Ee<=Te;){if(te+=W,te<C||te>=I)return null;be+=Ee,_e=ye,me=oe;const ot={absOffsetX:Te,direction:W,distanceFromAnchor:be,previousVertex:_e};if(ye=_r(te,B,ot),d===0)Oe.push(_e),Ne=ye.sub(_e);else{let tt;const nt=ye.sub(_e);tt=nt.mag()===0?xr(_r(te+W,B,ot).sub(ye),d,W):xr(nt,d,W),me||(me=_e.add(tt)),oe=Ml(te,tt,ye,C,I,me,d,B,ot),Oe.push(me),Ne=oe.sub(me)}Ee=Ne.mag()}const Ce=Ne._mult((Te-be)/Ee)._add(me||_e),ze=K+Math.atan2(ye.y-_e.y,ye.x-_e.x);return Oe.push(Ce),{point:Ce,angle:N?ze:0,path:Oe}}const Lo=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ms(E,o){for(let d=0;d<E;d++){const y=o.length;o.resize(y+4),o.float32.set(Lo,3*y)}}function Qa(E,o,d){const y=o[0],w=o[1];return E[0]=d[0]*y+d[4]*w+d[12],E[1]=d[1]*y+d[5]*w+d[13],E[3]=d[3]*y+d[7]*w+d[15],E}const _n=100;class ni{constructor(o,d=new Hn(o.width+200,o.height+200,25),y=new Hn(o.width+200,o.height+200,25)){this.transform=o,this.grid=d,this.ignoredGrid=y,this.pitchFactor=Math.cos(o.pitch*Math.PI/180)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+_n,this.screenBottomBoundary=o.height+_n,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(o,d,y,w,C,I,B,N,H,W,K,Z){const te=this.projectAndGetPerspectiveRatio(o.anchorPointX+N[0],o.anchorPointY+N[1],C,W,Z),oe=y*te.perspectiveRatio;let me;if(I||B)me=this._projectCollisionBox(o,oe,w,C,I,B,N,te,W,K,Z);else{const Ne=te.x+(K?K.x*oe:0),Ce=te.y+(K?K.y*oe:0);me={allPointsOccluded:!1,box:[Ne+o.x1*oe,Ce+o.y1*oe,Ne+o.x2*oe,Ce+o.y2*oe]}}const[ye,_e,be,Ee]=me.box,Te=I?me.allPointsOccluded:te.isOccluded;let Oe=Te;return Oe||(Oe=te.perspectiveRatio<this.perspectiveRatioCutoff),Oe||(Oe=!this.isInsideGrid(ye,_e,be,Ee)),Oe||d!=="always"&&this.grid.hitTest(ye,_e,be,Ee,d,H)?{box:[ye,_e,be,Ee],placeable:!1,offscreen:!1,occluded:Te}:{box:[ye,_e,be,Ee],placeable:!0,offscreen:this.isOffscreen(ye,_e,be,Ee),occluded:Te}}placeCollisionCircles(o,d,y,w,C,I,B,N,H,W,K,Z,te,oe){const me=[],ye=new s.P(d.anchorX,d.anchorY),_e=this.getPerspectiveRatio(ye.x,ye.y,I,oe),be=(H?C*this.transform.getPitchedTextCorrection(d.anchorX,d.anchorY,I)/_e:C*_e)/s.aB,Ee={getElevation:oe,pitchedLabelPlaneMatrix:B,lineVertexArray:y,pitchWithMap:H,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:ye,unwrappedTileID:I,width:this.transform.width,height:this.transform.height,translation:te},Te=Cl(be,w,d.lineOffsetX*be,d.lineOffsetY*be,!1,d,!1,Ee);let Oe=!1,Ne=!1,Ce=!0;if(Te){const ze=.5*K*_e+Z,ot=new s.P(-100,-100),tt=new s.P(this.screenRightBoundary,this.screenBottomBoundary),nt=new mn,lt=Te.first,Nt=Te.last;let Bt=[];for(let wr=lt.path.length-1;wr>=1;wr--)Bt.push(lt.path[wr]);for(let wr=1;wr<Nt.path.length;wr++)Bt.push(Nt.path[wr]);const Tt=2.5*ze;if(H){const wr=this.projectPathToScreenSpace(Bt,Ee);Bt=wr.some((Yr=>Yr.signedDistanceFromCamera<=0))?[]:wr.map((Yr=>Yr.point))}let qt=[];if(Bt.length>0){const wr=Bt[0].clone(),Yr=Bt[0].clone();for(let xn=1;xn<Bt.length;xn++)wr.x=Math.min(wr.x,Bt[xn].x),wr.y=Math.min(wr.y,Bt[xn].y),Yr.x=Math.max(Yr.x,Bt[xn].x),Yr.y=Math.max(Yr.y,Bt[xn].y);qt=wr.x>=ot.x&&Yr.x<=tt.x&&wr.y>=ot.y&&Yr.y<=tt.y?[Bt]:Yr.x<ot.x||wr.x>tt.x||Yr.y<ot.y||wr.y>tt.y?[]:s.ay([Bt],ot.x,ot.y,tt.x,tt.y)}for(const wr of qt){nt.reset(wr,.25*ze);let Yr=0;Yr=nt.length<=.5*ze?1:Math.ceil(nt.paddedLength/Tt)+1;for(let xn=0;xn<Yr;xn++){const pn=xn/Math.max(Yr-1,1),En=nt.lerp(pn),wn=En.x+_n,xi=En.y+_n;me.push(wn,xi,ze,0);const Cn=wn-ze,on=xi-ze,hn=wn+ze,Or=xi+ze;if(Ce=Ce&&this.isOffscreen(Cn,on,hn,Or),Ne=Ne||this.isInsideGrid(Cn,on,hn,Or),o!=="always"&&this.grid.hitTestCircle(wn,xi,ze,o,W)&&(Oe=!0,!N))return{circles:[],offscreen:!1,collisionDetected:Oe}}}}return{circles:!N&&Oe||!Ne||_e<this.perspectiveRatioCutoff?[]:me,offscreen:Ce,collisionDetected:Oe}}projectPathToScreenSpace(o,d){const y=(function(w,C){const I=s.L();return s.aq(I,C.pitchedLabelPlaneMatrix),w.map((B=>{const N=Jn(B.x,B.y,I,C.getElevation),H=C.transform.projectTileCoordinates(N.point.x,N.point.y,C.unwrappedTileID,C.getElevation);return H.point.x=(.5*H.point.x+.5)*C.width,H.point.y=(.5*-H.point.y+.5)*C.height,H}))})(o,d);return(function(w){let C=0,I=0,B=0,N=0;for(let H=0;H<w.length;H++)w[H].isOccluded?(B=H+1,N=0):(N++,N>I&&(I=N,C=B));return w.slice(C,C+I)})(y)}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[],y=new s.a2;for(const K of o){const Z=new s.P(K.x+_n,K.y+_n);y.extend(Z),d.push(Z)}const{minX:w,minY:C,maxX:I,maxY:B}=y,N=this.grid.query(w,C,I,B).concat(this.ignoredGrid.query(w,C,I,B)),H={},W={};for(const K of N){const Z=K.key;if(H[Z.bucketInstanceId]===void 0&&(H[Z.bucketInstanceId]={}),H[Z.bucketInstanceId][Z.featureIndex])continue;const te=[new s.P(K.x1,K.y1),new s.P(K.x2,K.y1),new s.P(K.x2,K.y2),new s.P(K.x1,K.y2)];s.az(d,te)&&(H[Z.bucketInstanceId][Z.featureIndex]=!0,W[Z.bucketInstanceId]===void 0&&(W[Z.bucketInstanceId]=[]),W[Z.bucketInstanceId].push(Z.featureIndex))}return W}insertCollisionBox(o,d,y,w,C,I){(y?this.ignoredGrid:this.grid).insert({bucketInstanceId:w,featureIndex:C,collisionGroupID:I,overlapMode:d},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,d,y,w,C,I){const B=y?this.ignoredGrid:this.grid,N={bucketInstanceId:w,featureIndex:C,collisionGroupID:I,overlapMode:d};for(let H=0;H<o.length;H+=4)B.insertCircle(N,o[H],o[H+1],o[H+2])}projectAndGetPerspectiveRatio(o,d,y,w,C){if(C){let I;w?(I=[o,d,w(o,d),1],s.aw(I,I,C)):(I=[o,d,0,1],Qa(I,I,C));const B=I[3];return{x:(I[0]/B+1)/2*this.transform.width+_n,y:(-I[1]/B+1)/2*this.transform.height+_n,perspectiveRatio:.5+this.transform.cameraToCenterDistance/B*.5,isOccluded:!1,signedDistanceFromCamera:B}}{const I=this.transform.projectTileCoordinates(o,d,y,w);return{x:(I.point.x+1)/2*this.transform.width+_n,y:(1-I.point.y)/2*this.transform.height+_n,perspectiveRatio:.5+this.transform.cameraToCenterDistance/I.signedDistanceFromCamera*.5,isOccluded:I.isOccluded,signedDistanceFromCamera:I.signedDistanceFromCamera}}}getPerspectiveRatio(o,d,y,w){const C=this.transform.projectTileCoordinates(o,d,y,w);return .5+this.transform.cameraToCenterDistance/C.signedDistanceFromCamera*.5}isOffscreen(o,d,y,w){return y<_n||o>=this.screenRightBoundary||w<_n||d>this.screenBottomBoundary}isInsideGrid(o,d,y,w){return y>=0&&o<this.gridRightBoundary&&w>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const o=s.ag([]);return s.M(o,o,[-100,-100,0]),o}_projectCollisionBox(o,d,y,w,C,I,B,N,H,W,K){let Z=1,te=0,oe=0,me=1;const ye=o.anchorPointX+B[0],_e=o.anchorPointY+B[1];if(I&&!C){const Bt=this.projectAndGetPerspectiveRatio(ye+1,_e,w,H,K),Tt=Bt.x-N.x,qt=Math.atan((Bt.y-N.y)/Tt)+(Tt<0?Math.PI:0),wr=Math.sin(qt),Yr=Math.cos(qt);Z=Yr,te=wr,oe=-wr,me=Yr}else if(!I&&C){const Bt=yn(this.transform);Z=Bt.vecEast[0],te=Bt.vecEast[1],oe=Bt.vecSouth[0],me=Bt.vecSouth[1]}let be=N.x,Ee=N.y,Te=d;C&&(be=ye,Ee=_e,Te=Math.pow(2,-(this.transform.zoom-y.overscaledZ)),Te*=this.transform.getPitchedTextCorrection(ye,_e,w),W||(Te*=s.ah(.5+N.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),W&&(be+=Z*W.x*Te+oe*W.y*Te,Ee+=te*W.x*Te+me*W.y*Te);const Oe=o.x1*Te,Ne=o.x2*Te,Ce=(Oe+Ne)/2,ze=o.y1*Te,ot=o.y2*Te,tt=(ze+ot)/2,nt=[{offsetX:Oe,offsetY:ze},{offsetX:Ce,offsetY:ze},{offsetX:Ne,offsetY:ze},{offsetX:Ne,offsetY:tt},{offsetX:Ne,offsetY:ot},{offsetX:Ce,offsetY:ot},{offsetX:Oe,offsetY:ot},{offsetX:Oe,offsetY:tt}];let lt=[];for(const{offsetX:Bt,offsetY:Tt}of nt)lt.push(new s.P(be+Z*Bt+oe*Tt,Ee+te*Bt+me*Tt));let Nt=!1;if(C){const Bt=lt.map((Tt=>this.projectAndGetPerspectiveRatio(Tt.x,Tt.y,w,H,K)));Nt=Bt.some((Tt=>!Tt.isOccluded)),lt=Bt.map((Tt=>new s.P(Tt.x,Tt.y)))}else Nt=!0;return{box:s.aA(lt),allPointsOccluded:!Nt}}}class ys{constructor(o,d,y,w){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?d:-d))):w&&y?1:0,this.placed=y}isHidden(){return this.opacity===0&&!this.placed}}class un{constructor(o,d,y,w,C){this.text=new ys(o?o.text:null,d,y,C),this.icon=new ys(o?o.icon:null,d,w,C)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Il{constructor(o,d,y){this.text=o,this.icon=d,this.skipFade=y}}class Ja{constructor(o,d,y,w,C){this.bucketInstanceId=o,this.featureIndex=d,this.sourceLayerIndex=y,this.bucketIndex=w,this.tileID=C}}class qd{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const d=++this.maxGroupID;this.collisionGroups[o]={ID:d,predicate:y=>y.collisionGroupID===d}}return this.collisionGroups[o]}}function Bo(E,o,d,y,w){const{horizontalAlign:C,verticalAlign:I}=s.aH(E);return new s.P(-(C-.5)*o+y[0]*w,-(I-.5)*d+y[1]*w)}class No{constructor(o,d,y,w,C){this.transform=o.clone(),this.terrain=d,this.collisionIndex=new ni(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=y,this.retainedQueryData={},this.collisionGroups=new qd(w),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=C,C&&(C.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(o){const d=this.terrain;return d?(y,w)=>d.getElevation(o,y,w):null}getBucketParts(o,d,y,w){const C=y.getBucket(d),I=y.latestFeatureIndex;if(!C||!I||d.id!==C.layerIds[0])return;const B=y.collisionBoxArray,N=C.layers[0].layout,H=C.layers[0].paint,W=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),K=y.tileSize/s.$,Z=y.tileID.toUnwrapped(),te=N.get("text-rotation-alignment")==="map",oe=s.aC(y,1,this.transform.zoom),me=s.aD(this.collisionIndex.transform,y,H.get("text-translate"),H.get("text-translate-anchor")),ye=s.aD(this.collisionIndex.transform,y,H.get("icon-translate"),H.get("icon-translate-anchor")),_e=Ci(te,this.transform,oe);this.retainedQueryData[C.bucketInstanceId]=new Ja(C.bucketInstanceId,I,C.sourceLayerIndex,C.index,y.tileID);const be={bucket:C,layout:N,translationText:me,translationIcon:ye,unwrappedTileID:Z,pitchedLabelPlaneMatrix:_e,scale:W,textPixelRatio:K,holdingForFade:y.holdingForFade(),collisionBoxArray:B,partiallyEvaluatedTextSize:s.an(C.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(C.sourceID)};if(w)for(const Ee of C.sortKeyRanges){const{sortKey:Te,symbolInstanceStart:Oe,symbolInstanceEnd:Ne}=Ee;o.push({sortKey:Te,symbolInstanceStart:Oe,symbolInstanceEnd:Ne,parameters:be})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:C.symbolInstances.length,parameters:be})}attemptAnchorPlacement(o,d,y,w,C,I,B,N,H,W,K,Z,te,oe,me,ye,_e,be,Ee,Te){const Oe=s.aE[o.textAnchor],Ne=[o.textOffset0,o.textOffset1],Ce=Bo(Oe,y,w,Ne,C),ze=this.collisionIndex.placeCollisionBox(d,Z,N,H,W,B,I,ye,K.predicate,Ee,Ce,Te);if((!be||this.collisionIndex.placeCollisionBox(be,Z,N,H,W,B,I,_e,K.predicate,Ee,Ce,Te).placeable)&&ze.placeable){let ot;if(this.prevPlacement&&this.prevPlacement.variableOffsets[te.crossTileID]&&this.prevPlacement.placements[te.crossTileID]&&this.prevPlacement.placements[te.crossTileID].text&&(ot=this.prevPlacement.variableOffsets[te.crossTileID].anchor),te.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[te.crossTileID]={textOffset:Ne,width:y,height:w,anchor:Oe,textBoxScale:C,prevAnchor:ot},this.markUsedJustification(oe,Oe,te,me),oe.allowVerticalPlacement&&(this.markUsedOrientation(oe,me,te),this.placedOrientations[te.crossTileID]=me),{shift:Ce,placedGlyphBoxes:ze}}}placeLayerBucketPart(o,d,y){const{bucket:w,layout:C,translationText:I,translationIcon:B,unwrappedTileID:N,pitchedLabelPlaneMatrix:H,textPixelRatio:W,holdingForFade:K,collisionBoxArray:Z,partiallyEvaluatedTextSize:te,collisionGroup:oe}=o.parameters,me=C.get("text-optional"),ye=C.get("icon-optional"),_e=s.aF(C,"text-overlap","text-allow-overlap"),be=_e==="always",Ee=s.aF(C,"icon-overlap","icon-allow-overlap"),Te=Ee==="always",Oe=C.get("text-rotation-alignment")==="map",Ne=C.get("text-pitch-alignment")==="map",Ce=C.get("icon-text-fit")!=="none",ze=C.get("symbol-z-order")==="viewport-y",ot=be&&(Te||!w.hasIconData()||ye),tt=Te&&(be||!w.hasTextData()||me);!w.collisionArrays&&Z&&w.deserializeCollisionBoxes(Z);const nt=this.retainedQueryData[w.bucketInstanceId].tileID,lt=this._getTerrainElevationFunc(nt),Nt=this.transform.getFastPathSimpleProjectionMatrix(nt),Bt=(Tt,qt,wr)=>{var Yr,xn;if(d[Tt.crossTileID])return;if(K)return void(this.placements[Tt.crossTileID]=new Il(!1,!1,!1));let pn=!1,En=!1,wn=!0,xi=null,Cn={box:null,placeable:!1,offscreen:null,occluded:!1},on={placeable:!1},hn=null,Or=null,wi=null,_a=0,Yl=0,wo=0;qt.textFeatureIndex?_a=qt.textFeatureIndex:Tt.useRuntimeCollisionCircles&&(_a=Tt.featureIndex),qt.verticalTextFeatureIndex&&(Yl=qt.verticalTextFeatureIndex);const Fc=qt.textBox;if(Fc){const Ws=ai=>{let ti=s.ao.horizontal;if(w.allowVerticalPlacement&&!ai&&this.prevPlacement){const ls=this.prevPlacement.placedOrientations[Tt.crossTileID];ls&&(this.placedOrientations[Tt.crossTileID]=ls,ti=ls,this.markUsedOrientation(w,ti,Tt))}return ti},Qo=(ai,ti)=>{if(w.allowVerticalPlacement&&Tt.numVerticalGlyphVertices>0&&qt.verticalTextBox){for(const ls of w.writingModes)if(ls===s.ao.vertical?(Cn=ti(),on=Cn):Cn=ai(),Cn&&Cn.placeable)break}else Cn=ai()},ja=Tt.textAnchorOffsetStartIndex,Jo=Tt.textAnchorOffsetEndIndex;if(Jo===ja){const ai=(ti,ls)=>{const Tn=this.collisionIndex.placeCollisionBox(ti,_e,W,nt,N,Ne,Oe,I,oe.predicate,lt,void 0,Nt);return Tn&&Tn.placeable&&(this.markUsedOrientation(w,ls,Tt),this.placedOrientations[Tt.crossTileID]=ls),Tn};Qo((()=>ai(Fc,s.ao.horizontal)),(()=>{const ti=qt.verticalTextBox;return w.allowVerticalPlacement&&Tt.numVerticalGlyphVertices>0&&ti?ai(ti,s.ao.vertical):{box:null,offscreen:null}})),Ws(Cn&&Cn.placeable)}else{let ai=s.aE[(xn=(Yr=this.prevPlacement)===null||Yr===void 0?void 0:Yr.variableOffsets[Tt.crossTileID])===null||xn===void 0?void 0:xn.anchor];const ti=(Tn,Jf,ed)=>{const vp=Tn.x2-Tn.x1,im=Tn.y2-Tn.y1,Wh=Tt.textBoxScale,ku=Ce&&Ee==="never"?Jf:null;let qs=null,To=_e==="never"?1:2,va="never";ai&&To++;for(let So=0;So<To;So++){for(let Ql=ja;Ql<Jo;Ql++){const qh=w.textAnchorOffsets.get(Ql);if(ai&&qh.textAnchor!==ai)continue;const Uc=this.attemptAnchorPlacement(qh,Tn,vp,im,Wh,Oe,Ne,W,nt,N,oe,va,Tt,w,ed,I,B,ku,lt);if(Uc&&(qs=Uc.placedGlyphBoxes,qs&&qs.placeable))return pn=!0,xi=Uc.shift,qs}ai?ai=null:va=_e}return y&&!qs&&(qs={box:this.collisionIndex.placeCollisionBox(Fc,"always",W,nt,N,Ne,Oe,I,oe.predicate,lt,void 0,Nt).box,offscreen:!1,placeable:!1,occluded:!1}),qs};Qo((()=>ti(Fc,qt.iconBox,s.ao.horizontal)),(()=>{const Tn=qt.verticalTextBox;return w.allowVerticalPlacement&&(!Cn||!Cn.placeable)&&Tt.numVerticalGlyphVertices>0&&Tn?ti(Tn,qt.verticalIconBox,s.ao.vertical):{box:null,occluded:!0,offscreen:null}})),Cn&&(pn=Cn.placeable,wn=Cn.offscreen);const ls=Ws(Cn&&Cn.placeable);if(!pn&&this.prevPlacement){const Tn=this.prevPlacement.variableOffsets[Tt.crossTileID];Tn&&(this.variableOffsets[Tt.crossTileID]=Tn,this.markUsedJustification(w,Tn.anchor,Tt,ls))}}}if(hn=Cn,pn=hn&&hn.placeable,wn=hn&&hn.offscreen,Tt.useRuntimeCollisionCircles&&Tt.centerJustifiedTextSymbolIndex>=0){const Ws=w.text.placedSymbolArray.get(Tt.centerJustifiedTextSymbolIndex),Qo=s.ap(w.textSizeData,te,Ws),ja=C.get("text-padding");Or=this.collisionIndex.placeCollisionCircles(_e,Ws,w.lineVertexArray,w.glyphOffsetArray,Qo,N,H,y,Ne,oe.predicate,Tt.collisionCircleDiameter,ja,I,lt),Or.circles.length&&Or.collisionDetected&&!y&&s.w("Collisions detected, but collision boxes are not shown"),pn=be||Or.circles.length>0&&!Or.collisionDetected,wn=wn&&Or.offscreen}if(qt.iconFeatureIndex&&(wo=qt.iconFeatureIndex),qt.iconBox){const Ws=Qo=>this.collisionIndex.placeCollisionBox(Qo,Ee,W,nt,N,Ne,Oe,B,oe.predicate,lt,Ce&&xi?xi:void 0,Nt);on&&on.placeable&&qt.verticalIconBox?(wi=Ws(qt.verticalIconBox),En=wi.placeable):(wi=Ws(qt.iconBox),En=wi.placeable),wn=wn&&wi.offscreen}const Ou=me||Tt.numHorizontalGlyphVertices===0&&Tt.numVerticalGlyphVertices===0,Ko=ye||Tt.numIconVertices===0;Ou||Ko?Ko?Ou||(En=En&&pn):pn=En&&pn:En=pn=En&&pn;const Kl=En&&wi.placeable;if(pn&&hn.placeable&&this.collisionIndex.insertCollisionBox(hn.box,_e,C.get("text-ignore-placement"),w.bucketInstanceId,on&&on.placeable&&Yl?Yl:_a,oe.ID),Kl&&this.collisionIndex.insertCollisionBox(wi.box,Ee,C.get("icon-ignore-placement"),w.bucketInstanceId,wo,oe.ID),Or&&pn&&this.collisionIndex.insertCollisionCircles(Or.circles,_e,C.get("text-ignore-placement"),w.bucketInstanceId,_a,oe.ID),y&&this.storeCollisionData(w.bucketInstanceId,wr,qt,hn,wi,Or),Tt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(w.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Tt.crossTileID]=new Il((pn||ot)&&!hn?.occluded,(En||tt)&&!wi?.occluded,wn||w.justReloaded),d[Tt.crossTileID]=!0};if(ze){if(o.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Tt=w.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let qt=Tt.length-1;qt>=0;--qt){const wr=Tt[qt];Bt(w.symbolInstances.get(wr),w.collisionArrays[wr],wr)}}else for(let Tt=o.symbolInstanceStart;Tt<o.symbolInstanceEnd;Tt++)Bt(w.symbolInstances.get(Tt),w.collisionArrays[Tt],Tt);w.justReloaded=!1}storeCollisionData(o,d,y,w,C,I){if(y.textBox||y.iconBox){let B,N;this.collisionBoxArrays.has(o)?B=this.collisionBoxArrays.get(o):(B=new Map,this.collisionBoxArrays.set(o,B)),B.has(d)?N=B.get(d):(N={text:null,icon:null},B.set(d,N)),y.textBox&&(N.text=w.box),y.iconBox&&(N.icon=C.box)}if(I){let B=this.collisionCircleArrays[o];B===void 0&&(B=this.collisionCircleArrays[o]=[]);for(let N=0;N<I.circles.length;N+=4)B.push(I.circles[N+0]-_n),B.push(I.circles[N+1]-_n),B.push(I.circles[N+2]),B.push(I.collisionDetected?1:0)}}markUsedJustification(o,d,y,w){let C;C=w===s.ao.vertical?y.verticalPlacedTextSymbolIndex:{left:y.leftJustifiedTextSymbolIndex,center:y.centerJustifiedTextSymbolIndex,right:y.rightJustifiedTextSymbolIndex}[s.aG(d)];const I=[y.leftJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.rightJustifiedTextSymbolIndex,y.verticalPlacedTextSymbolIndex];for(const B of I)B>=0&&(o.text.placedSymbolArray.get(B).crossTileID=C>=0&&B!==C?0:y.crossTileID)}markUsedOrientation(o,d,y){const w=d===s.ao.horizontal||d===s.ao.horizontalOnly?d:0,C=d===s.ao.vertical?d:0,I=[y.leftJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.rightJustifiedTextSymbolIndex];for(const B of I)o.text.placedSymbolArray.get(B).placedOrientation=w;y.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(y.verticalPlacedTextSymbolIndex).placedOrientation=C)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let y=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const w=d?d.symbolFadeChange(o):1,C=d?d.opacities:{},I=d?d.variableOffsets:{},B=d?d.placedOrientations:{};for(const N in this.placements){const H=this.placements[N],W=C[N];W?(this.opacities[N]=new un(W,w,H.text,H.icon),y=y||H.text!==W.text.placed||H.icon!==W.icon.placed):(this.opacities[N]=new un(null,w,H.text,H.icon,H.skipFade),y=y||H.text||H.icon)}for(const N in C){const H=C[N];if(!this.opacities[N]){const W=new un(H,w,!1,!1);W.isHidden()||(this.opacities[N]=W,y=y||H.text.placed||H.icon.placed)}}for(const N in I)this.variableOffsets[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.variableOffsets[N]=I[N]);for(const N in B)this.placedOrientations[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.placedOrientations[N]=B[N]);if(d&&d.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");y?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:o)}updateLayerOpacities(o,d){const y={};for(const w of d){const C=w.getBucket(o);C&&w.latestFeatureIndex&&o.id===C.layerIds[0]&&this.updateBucketOpacities(C,w.tileID,y,w.collisionBoxArray)}}updateBucketOpacities(o,d,y,w){o.hasTextData()&&(o.text.opacityVertexArray.clear(),o.text.hasVisibleVertices=!1),o.hasIconData()&&(o.icon.opacityVertexArray.clear(),o.icon.hasVisibleVertices=!1),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const C=o.layers[0],I=C.layout,B=new un(null,0,!1,!1,!0),N=I.get("text-allow-overlap"),H=I.get("icon-allow-overlap"),W=C._unevaluatedLayout.hasValue("text-variable-anchor")||C._unevaluatedLayout.hasValue("text-variable-anchor-offset"),K=I.get("text-rotation-alignment")==="map",Z=I.get("text-pitch-alignment")==="map",te=I.get("icon-text-fit")!=="none",oe=new un(null,0,N&&(H||!o.hasIconData()||I.get("icon-optional")),H&&(N||!o.hasTextData()||I.get("text-optional")),!0);!o.collisionArrays&&w&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(w);const me=(_e,be,Ee)=>{for(let Te=0;Te<be/4;Te++)_e.opacityVertexArray.emplaceBack(Ee);_e.hasVisibleVertices=_e.hasVisibleVertices||Ee!==zo},ye=this.collisionBoxArrays.get(o.bucketInstanceId);for(let _e=0;_e<o.symbolInstances.length;_e++){const be=o.symbolInstances.get(_e),{numHorizontalGlyphVertices:Ee,numVerticalGlyphVertices:Te,crossTileID:Oe}=be;let Ne=this.opacities[Oe];y[Oe]?Ne=B:Ne||(Ne=oe,this.opacities[Oe]=Ne),y[Oe]=!0;const Ce=be.numIconVertices>0,ze=this.placedOrientations[be.crossTileID],ot=ze===s.ao.vertical,tt=ze===s.ao.horizontal||ze===s.ao.horizontalOnly;if(Ee>0||Te>0){const lt=Rf(Ne.text);me(o.text,Ee,ot?zo:lt),me(o.text,Te,tt?zo:lt);const Nt=Ne.text.isHidden();[be.rightJustifiedTextSymbolIndex,be.centerJustifiedTextSymbolIndex,be.leftJustifiedTextSymbolIndex].forEach((qt=>{qt>=0&&(o.text.placedSymbolArray.get(qt).hidden=Nt||ot?1:0)})),be.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(be.verticalPlacedTextSymbolIndex).hidden=Nt||tt?1:0);const Bt=this.variableOffsets[be.crossTileID];Bt&&this.markUsedJustification(o,Bt.anchor,be,ze);const Tt=this.placedOrientations[be.crossTileID];Tt&&(this.markUsedJustification(o,"left",be,Tt),this.markUsedOrientation(o,Tt,be))}if(Ce){const lt=Rf(Ne.icon),Nt=!(te&&be.verticalPlacedIconSymbolIndex&&ot);be.placedIconSymbolIndex>=0&&(me(o.icon,be.numIconVertices,Nt?lt:zo),o.icon.placedSymbolArray.get(be.placedIconSymbolIndex).hidden=Ne.icon.isHidden()),be.verticalPlacedIconSymbolIndex>=0&&(me(o.icon,be.numVerticalIconVertices,Nt?zo:lt),o.icon.placedSymbolArray.get(be.verticalPlacedIconSymbolIndex).hidden=Ne.icon.isHidden())}const nt=ye&&ye.has(_e)?ye.get(_e):{text:null,icon:null};if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const lt=o.collisionArrays[_e];if(lt){let Nt=new s.P(0,0);if(lt.textBox||lt.verticalTextBox){let Bt=!0;if(W){const Tt=this.variableOffsets[Oe];Tt?(Nt=Bo(Tt.anchor,Tt.width,Tt.height,Tt.textOffset,Tt.textBoxScale),K&&Nt._rotate(Z?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Bt=!1}if(lt.textBox||lt.verticalTextBox){let Tt;lt.textBox&&(Tt=ot),lt.verticalTextBox&&(Tt=tt),Gd(o.textCollisionBox.collisionVertexArray,Ne.text.placed,!Bt||Tt,nt.text,Nt.x,Nt.y)}}if(lt.iconBox||lt.verticalIconBox){const Bt=!!(!tt&&lt.verticalIconBox);let Tt;lt.iconBox&&(Tt=Bt),lt.verticalIconBox&&(Tt=!Bt),Gd(o.iconCollisionBox.collisionVertexArray,Ne.icon.placed,Tt,nt.icon,te?Nt.x:0,te?Nt.y:0)}}}}if(o.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.text.opacityVertexArray.length!==o.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${o.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${o.text.layoutVertexArray.length}) / 4`);if(o.icon.opacityVertexArray.length!==o.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${o.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${o.icon.layoutVertexArray.length}) / 4`);o.bucketInstanceId in this.collisionCircleArrays&&(o.collisionCircleArray=this.collisionCircleArrays[o.bucketInstanceId],delete this.collisionCircleArrays[o.bucketInstanceId])}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,d){const y=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*y>o}setStale(){this.stale=!0}}function Gd(E,o,d,y,w,C){y&&y.length!==0||(y=[0,0,0,0]);const I=y[0]-_n,B=y[1]-_n,N=y[2]-_n,H=y[3]-_n;E.emplaceBack(o?1:0,d?1:0,w||0,C||0,I,B),E.emplaceBack(o?1:0,d?1:0,w||0,C||0,N,B),E.emplaceBack(o?1:0,d?1:0,w||0,C||0,N,H),E.emplaceBack(o?1:0,d?1:0,w||0,C||0,I,H)}const fh=Math.pow(2,25),dh=Math.pow(2,24),Ds=Math.pow(2,17),ea=Math.pow(2,16),$g=Math.pow(2,9),Xy=Math.pow(2,8),Xd=Math.pow(2,1);function Rf(E){if(E.opacity===0&&!E.placed)return 0;if(E.opacity===1&&E.placed)return 4294967295;const o=E.placed?1:0,d=Math.floor(127*E.opacity);return d*fh+o*dh+d*Ds+o*ea+d*$g+o*Xy+d*Xd+o}const zo=0;class Zd{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&!o.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,d,y,w,C){const I=this._bucketParts;for(;this._currentTileIndex<o.length;)if(d.getBucketParts(I,w,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,C())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort(((B,N)=>B.sortKey-N.sortKey)));this._currentPartIndex<I.length;)if(d.placeLayerBucketPart(I[this._currentPartIndex],this._seenCrossTileIDs,y),this._currentPartIndex++,C())return!0;return!1}}class Ls{constructor(o,d,y,w,C,I,B,N){this.placement=new No(o,d,I,B,N),this._currentPlacementIndex=y.length-1,this._forceFullPlacement=w,this._showCollisionBoxes=C,this._done=!1}isDone(){return this._done}continuePlacement(o,d,y){const w=M.now(),C=()=>!this._forceFullPlacement&&M.now()-w>2;for(;this._currentPlacementIndex>=0;){const I=d[o[this._currentPlacementIndex]],B=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=B)&&(!I.maxzoom||I.maxzoom>B)){if(this._inProgressLayer||(this._inProgressLayer=new Zd(I)),this._inProgressLayer.continuePlacement(y[I.source],this.placement,this._showCollisionBoxes,I,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const Rl=512/s.$/2;class Of{constructor(o,d,y){this.tileID=o,this.bucketInstanceId=y,this._symbolsByKey={};const w=new Map;for(let C=0;C<d.length;C++){const I=d.get(C),B=I.key,N=w.get(B);N?N.push(I):w.set(B,[I])}for(const[C,I]of w){const B={positions:I.map((N=>({x:Math.floor(N.anchorX*Rl),y:Math.floor(N.anchorY*Rl)}))),crossTileIDs:I.map((N=>N.crossTileID))};if(B.positions.length>128){const N=new s.aI(B.positions.length,16,Uint16Array);for(const{x:H,y:W}of B.positions)N.add(H,W);N.finish(),delete B.positions,B.index=N}this._symbolsByKey[C]=B}}getScaledCoordinates(o,d){const{x:y,y:w,z:C}=this.tileID.canonical,{x:I,y:B,z:N}=d.canonical,H=Rl/Math.pow(2,N-C),W=(B*s.$+o.anchorY)*H,K=w*s.$*Rl;return{x:Math.floor((I*s.$+o.anchorX)*H-y*s.$*Rl),y:Math.floor(W-K)}}findMatches(o,d,y){const w=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let C=0;C<o.length;C++){const I=o.get(C);if(I.crossTileID)continue;const B=this._symbolsByKey[I.key];if(!B)continue;const N=this.getScaledCoordinates(I,d);if(B.index){const H=B.index.range(N.x-w,N.y-w,N.x+w,N.y+w).sort();for(const W of H){const K=B.crossTileIDs[W];if(!y[K]){y[K]=!0,I.crossTileID=K;break}}}else if(B.positions)for(let H=0;H<B.positions.length;H++){const W=B.positions[H],K=B.crossTileIDs[H];if(Math.abs(W.x-N.x)<=w&&Math.abs(W.y-N.y)<=w&&!y[K]){y[K]=!0,I.crossTileID=K;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:o})=>o))}}class ph{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class hu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const d=Math.round((o-this.lng)/360);if(d!==0)for(const y in this.indexes){const w=this.indexes[y],C={};for(const I in w){const B=w[I];B.tileID=B.tileID.unwrapTo(B.tileID.wrap+d),C[B.tileID.key]=B}this.indexes[y]=C}this.lng=o}addBucket(o,d,y){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let C=0;C<d.symbolInstances.length;C++)d.symbolInstances.get(C).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const w=this.usedCrossTileIDs[o.overscaledZ];for(const C in this.indexes){const I=this.indexes[C];if(Number(C)>o.overscaledZ)for(const B in I){const N=I[B];N.tileID.isChildOf(o)&&N.findMatches(d.symbolInstances,o,w)}else{const B=I[o.scaledTo(Number(C)).key];B&&B.findMatches(d.symbolInstances,o,w)}}for(let C=0;C<d.symbolInstances.length;C++){const I=d.symbolInstances.get(C);I.crossTileID||(I.crossTileID=y.generate(),w[I.crossTileID]=!0)}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Of(o,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(o,d){for(const y of d.getCrossTileIDsLists())for(const w of y)delete this.usedCrossTileIDs[o][w]}removeStaleBuckets(o){let d=!1;for(const y in this.indexes){const w=this.indexes[y];for(const C in w)o[w[C].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,w[C]),delete w[C],d=!0)}return d}}class Tc{constructor(){this.layerIndexes={},this.crossTileIDs=new ph,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,d,y){let w=this.layerIndexes[o.id];w===void 0&&(w=this.layerIndexes[o.id]=new hu);let C=!1;const I={};w.handleWrapJump(y);for(const B of d){const N=B.getBucket(o);N&&o.id===N.layerIds[0]&&(N.bucketInstanceId||(N.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(B.tileID,N,this.crossTileIDs)&&(C=!0),I[N.bucketInstanceId]=!0)}return w.removeStaleBuckets(I)&&(C=!0),C}pruneUnusedLayers(o){const d={};o.forEach((y=>{d[y]=!0}));for(const y in this.layerIndexes)d[y]||delete this.layerIndexes[y]}}var fu="void main() {fragColor=vec4(1.0);}";const ts={prelude:Dr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Dr("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Dr("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Dr(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Dr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Dr(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Dr(fu,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Dr(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Dr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Dr("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Dr("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Dr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Dr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Dr(fu,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Dr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Dr(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Dr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Dr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Dr(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Dr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Dr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Dr(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Dr(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Dr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Dr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Dr(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:Dr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Dr(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Dr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Dr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Dr("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Dr("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Dr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Dr("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Dr(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Dr("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Dr(E,o){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=o.match(/in ([\w]+) ([\w]+)/g),w=E.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),I=C?C.concat(w):w,B={};return{fragmentSource:E=E.replace(d,((N,H,W,K,Z)=>(B[Z]=!0,H==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
in ${W} ${K} ${Z};
#else
uniform ${W} ${K} u_${Z};
#endif
`:`
#ifdef HAS_UNIFORM_u_${Z}
    ${W} ${K} ${Z} = u_${Z};
#endif
`))),vertexSource:o=o.replace(d,((N,H,W,K,Z)=>{const te=K==="float"?"vec2":"vec4",oe=Z.match(/color/)?"color":te;return B[Z]?H==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
uniform lowp float u_${Z}_t;
in ${W} ${te} a_${Z};
out ${W} ${K} ${Z};
#else
uniform ${W} ${K} u_${Z};
#endif
`:oe==="vec4"?`
#ifndef HAS_UNIFORM_u_${Z}
    ${Z} = a_${Z};
#else
    ${W} ${K} ${Z} = u_${Z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Z}
    ${Z} = unpack_mix_${oe}(a_${Z}, u_${Z}_t);
#else
    ${W} ${K} ${Z} = u_${Z};
#endif
`:H==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
uniform lowp float u_${Z}_t;
in ${W} ${te} a_${Z};
#else
uniform ${W} ${K} u_${Z};
#endif
`:oe==="vec4"?`
#ifndef HAS_UNIFORM_u_${Z}
    ${W} ${K} ${Z} = a_${Z};
#else
    ${W} ${K} ${Z} = u_${Z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Z}
    ${W} ${K} ${Z} = unpack_mix_${oe}(a_${Z}, u_${Z}_t);
#else
    ${W} ${K} ${Z} = u_${Z};
#endif
`})),staticAttributes:y,staticUniforms:I}}class Ol{constructor(o,d,y){this.vertexBuffer=o,this.indexBuffer=d,this.segments=y}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Fo=s.aJ([{name:"a_pos",type:"Int16",components:2}]);const La="#define PROJECTION_MERCATOR",Sc="mercator";class Lr{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Sc}get shaderDefine(){return La}get shaderPreludeCode(){return ts.projectionMercator}get vertexShaderPreludeCode(){return ts.projectionMercator.vertexSource}get subdivisionGranularity(){return s.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(o){}getMeshFromTileID(o,d,y,w,C){if(this._cachedMesh)return this._cachedMesh;const I=new s.aL;I.emplaceBack(0,0),I.emplaceBack(s.$,0),I.emplaceBack(0,s.$),I.emplaceBack(s.$,s.$);const B=o.createVertexBuffer(I,Fo.members),N=s.aM.simpleSegment(0,0,4,2),H=new s.aN;H.emplaceBack(1,0,2),H.emplaceBack(1,2,3);const W=o.createIndexBuffer(H);return this._cachedMesh=new Ol(B,W,N),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(o){}}class eo{constructor(o=0,d=0,y=0,w=0){if(isNaN(o)||o<0||isNaN(d)||d<0||isNaN(y)||y<0||isNaN(w)||w<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=d,this.left=y,this.right=w}interpolate(o,d,y){return d.top!=null&&o.top!=null&&(this.top=s.C.number(o.top,d.top,y)),d.bottom!=null&&o.bottom!=null&&(this.bottom=s.C.number(o.bottom,d.bottom,y)),d.left!=null&&o.left!=null&&(this.left=s.C.number(o.left,d.left,y)),d.right!=null&&o.right!=null&&(this.right=s.C.number(o.right,d.right,y)),this}getCenter(o,d){const y=s.ah((this.left+o-this.right)/2,0,o),w=s.ah((this.top+d-this.bottom)/2,0,d);return new s.P(y,w)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new eo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ga(E,o){if(!E.renderWorldCopies||E.lngRange)return;const d=o.lng-E.center.lng;o.lng+=d>180?-360:d<-180?360:0}function du(E){return Math.max(0,Math.floor(E))}class Yi{constructor(o,d,y,w,C,I){this._callbacks=o,this._tileSize=512,this._renderWorldCopies=I===void 0||!!I,this._minZoom=d||0,this._maxZoom=y||22,this._minPitch=w??0,this._maxPitch=C??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new s.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=du(this._zoom),this._scale=s.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new eo,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(o,d,y){this._latRange=o.latRange,this._lngRange=o.lngRange,this._width=o.width,this._height=o.height,this._center=o.center,this._elevation=o.elevation,this._minElevationForCurrentTile=o.minElevationForCurrentTile,this._zoom=o.zoom,this._tileZoom=du(this._zoom),this._scale=s.af(this._zoom),this._bearingInRadians=o.bearingInRadians,this._fovInRadians=o.fovInRadians,this._pitchInRadians=o.pitchInRadians,this._rollInRadians=o.rollInRadians,this._unmodified=o.unmodified,this._edgeInsets=new eo(o.padding.top,o.padding.bottom,o.padding.left,o.padding.right),this._minZoom=o.minZoom,this._maxZoom=o.maxZoom,this._minPitch=o.minPitch,this._maxPitch=o.maxPitch,this._renderWorldCopies=o.renderWorldCopies,this._cameraToCenterDistance=o.cameraToCenterDistance,this._nearZ=o.nearZ,this._farZ=o.farZ,this._autoCalculateNearFarZ=!y&&o.autoCalculateNearFarZ,d&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(o){this._minElevationForCurrentTile=o}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(o){this._minZoom!==o&&(this._minZoom=o,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(o){this._minPitch!==o&&(this._minPitch=o,this.setPitch(Math.max(this.pitch,o)))}get maxPitch(){return this._maxPitch}setMaxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.setPitch(Math.min(this.pitch,o)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(o){const d=s.aO(o,-180,180)*Math.PI/180;var y,w,C,I,B,N,H,W,K;this._bearingInRadians!==d&&(this._unmodified=!1,this._bearingInRadians=d,this._calcMatrices(),this._rotationMatrix=_(),y=this._rotationMatrix,C=-this._bearingInRadians,I=(w=this._rotationMatrix)[0],B=w[1],N=w[2],H=w[3],W=Math.sin(C),K=Math.cos(C),y[0]=I*K+N*W,y[1]=B*K+H*W,y[2]=I*-W+N*K,y[3]=B*-W+H*K)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(o){const d=s.ah(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==d&&(this._unmodified=!1,this._pitchInRadians=d,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(o){const d=o/180*Math.PI;this._rollInRadians!==d&&(this._unmodified=!1,this._rollInRadians=d,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return s.aP(this._fovInRadians)}setFov(o){o=s.ah(o,.1,150),this.fov!==o&&(this._unmodified=!1,this._fovInRadians=s.ae(o),this._calcMatrices())}get zoom(){return this._zoom}setZoom(o){const d=this.getConstrained(this._center,o).zoom;this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this._tileZoom=Math.max(0,Math.floor(d)),this._scale=s.af(d),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(o){o!==this._elevation&&(this._elevation=o,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(o,d){this._autoCalculateNearFarZ=!1,this._nearZ=o,this._farZ=d,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,d,y){this._unmodified=!1,this._edgeInsets.interpolate(o,d,y),this._constrain(),this._calcMatrices()}resize(o,d,y=!0){this._width=o,this._height=d,y&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Cr([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(o){o?(this._lngRange=[o.getWest(),o.getEast()],this._latRange=[o.getSouth(),o.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-s.ai,s.ai])}getConstrained(o,d){return this._callbacks.getConstrained(o,d)}getCameraQueryGeometry(o,d){if(d.length===1)return[d[0],o];{const{minX:y,minY:w,maxX:C,maxY:I}=s.a2.fromPoints(d).extend(o);return[new s.P(y,w),new s.P(C,w),new s.P(C,I),new s.P(y,I),new s.P(y,w)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const o=this._unmodified,{center:d,zoom:y}=this.getConstrained(this.center,this.zoom);this.setCenter(d),this.setZoom(y),this._unmodified=o,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let o=s.ag(new Float64Array(16));s.N(o,o,[this._width/2,-this._height/2,1]),s.M(o,o,[1,-1,0]),this._clipSpaceToPixelsMatrix=o,o=s.ag(new Float64Array(16)),s.N(o,o,[1,-1,1]),s.M(o,o,[-1,-1,0]),s.N(o,o,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=o,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(o,d,y,w){const C=y!==void 0?y:this.bearing,I=w=w!==void 0?w:this.pitch,B=s.a1.fromLngLat(o,d),N=-Math.cos(s.ae(I)),H=Math.sin(s.ae(I)),W=H*Math.sin(s.ae(C)),K=-H*Math.cos(s.ae(C));let Z=this.elevation;const te=d-Z;let oe;N*te>=0||Math.abs(N)<.1?(oe=1e4,Z=d+oe*N):oe=-te/N;let me,ye,_e=s.aQ(1,B.y),be=0;do{if(be+=1,be>10)break;ye=oe/_e,me=new s.a1(B.x+W*ye,B.y+K*ye),_e=1/me.meterInMercatorCoordinateUnits()}while(Math.abs(oe-ye*_e)>1e-12);return{center:me.toLngLat(),elevation:Z,zoom:s.ak(this.height/2/Math.tan(this.fovInRadians/2)/ye/this.tileSize)}}recalculateZoomAndCenter(o){if(this.elevation-o==0)return;const d=s.aj(1,this.center.lat)*this.worldSize,y=this.cameraToCenterDistance/d,w=s.a1.fromLngLat(this.center,this.elevation),C=Qe(this.center,this.elevation,this.pitch,this.bearing,y);this._elevation=o;const I=this.calculateCenterFromCameraLngLatAlt(C.toLngLat(),s.aQ(C.z,w.y),this.bearing,this.pitch);this._elevation=I.elevation,this._center=I.center,this.setZoom(I.zoom)}getCameraPoint(){const o=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(o*Math.sin(this.rollInRadians),o*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const o=s.aj(1,this.center.lat)*this.worldSize;return Qe(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/o).toLngLat()}getMercatorTileCoordinates(o){if(!o)return[0,0,1,1];const d=o.canonical.z>=0?1<<o.canonical.z:Math.pow(2,o.canonical.z);return[o.canonical.x/d,o.canonical.y/d,1/d/s.$,1/d/s.$]}}class Gn{constructor(o,d){this.min=o,this.max=d,this.center=s.aR([],s.aS([],this.min,this.max),.5)}quadrant(o){const d=[o%2==0,o<2],y=s.aT(this.min),w=s.aT(this.max);for(let C=0;C<d.length;C++)y[C]=d[C]?this.min[C]:this.center[C],w[C]=d[C]?this.center[C]:this.max[C];return w[2]=this.max[2],new Gn(y,w)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}intersectsFrustum(o){let d=!0;for(let y=0;y<o.planes.length;y++){const w=this.intersectsPlane(o.planes[y]);if(w===0)return 0;w===1&&(d=!1)}return d?2:o.aabb.min[0]>this.max[0]||o.aabb.min[1]>this.max[1]||o.aabb.min[2]>this.max[2]||o.aabb.max[0]<this.min[0]||o.aabb.max[1]<this.min[1]||o.aabb.max[2]<this.min[2]?0:1}intersectsPlane(o){let d=o[3],y=o[3];for(let w=0;w<3;w++)o[w]>0?(d+=o[w]*this.min[w],y+=o[w]*this.max[w]):(y+=o[w]*this.min[w],d+=o[w]*this.max[w]);return d>=0?2:y<0?0:1}}class _i{distanceToTile2d(o,d,y,w){const C=w.distanceX([o,d]),I=w.distanceY([o,d]);return Math.hypot(C,I)}getWrap(o,d,y){return y}getTileBoundingVolume(o,d,y,w){var C,I;let B=0,N=0;if(w?.terrain){const W=new s.Z(o.z,d,o.z,o.x,o.y),K=w.terrain.getMinMaxElevation(W);B=(C=K.minElevation)!==null&&C!==void 0?C:Math.min(0,y),N=(I=K.maxElevation)!==null&&I!==void 0?I:Math.max(0,y)}const H=1<<o.z;return new Gn([d+o.x/H,o.y/H,B],[d+(o.x+1)/H,(o.y+1)/H,N])}allowVariableZoom(o,d){const y=o.fov*(Math.abs(Math.cos(o.rollInRadians))*o.height+Math.abs(Math.sin(o.rollInRadians))*o.width)/o.height,w=s.ah(78.5-y/2,0,60);return!!d.terrain||o.pitch>w}allowWorldCopies(){return!0}prepareNextFrame(){}}class ii{constructor(o,d,y){this.points=o,this.planes=d,this.aabb=y}static fromInvProjectionMatrix(o,d=1,y=0,w,C){const I=C?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],B=Math.pow(2,y),N=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((Z=>(function(te,oe,me,ye){const _e=s.aw([],te,oe),be=1/_e[3]/me*ye;return s.aY(_e,_e,[be,be,1/_e[3],be])})(Z,o,d,B)));w&&(function(Z,te,oe,me){const ye=me?4:0,_e=me?0:4;let be=0;const Ee=[],Te=[];for(let Ce=0;Ce<4;Ce++){const ze=s.aU([],Z[Ce+_e],Z[Ce+ye]),ot=s.aZ(ze);s.aR(ze,ze,1/ot),Ee.push(ot),Te.push(ze)}for(let Ce=0;Ce<4;Ce++){const ze=s.a_(Z[Ce+ye],Te[Ce],oe);be=ze!==null&&ze>=0?Math.max(be,ze):Math.max(be,Ee[Ce])}const Oe=(function(Ce,ze){const ot=s.aU([],Ce[ze[0]],Ce[ze[1]]),tt=s.aU([],Ce[ze[2]],Ce[ze[1]]),nt=[0,0,0,0];return s.aV(nt,s.aW([],ot,tt)),nt[3]=-s.aX(nt,Ce[ze[0]]),nt})(Z,te),Ne=(function(Ce,ze){const ot=s.a$(Ce),tt=s.b0([],Ce,1/ot),nt=s.aU([],ze,s.aR([],tt,s.aX(ze,tt))),lt=s.a$(nt);if(lt>0){const Nt=Math.sqrt(1-tt[3]*tt[3]),Bt=s.aR([],tt,-tt[3]),Tt=s.aS([],Bt,s.aR([],nt,Nt/lt));return s.b1(ze,Tt)}return null})(oe,Oe);if(Ne!==null){const Ce=Ne/s.aX(Te[0],Oe);be=Math.min(be,Ce)}for(let Ce=0;Ce<4;Ce++){const ze=Math.min(be,Ee[Ce]);Z[Ce+_e]=[Z[Ce+ye][0]+Te[Ce][0]*ze,Z[Ce+ye][1]+Te[Ce][1]*ze,Z[Ce+ye][2]+Te[Ce][2]*ze,1]}})(N,I[0],w,C);const H=I.map((Z=>{const te=s.aU([],N[Z[0]],N[Z[1]]),oe=s.aU([],N[Z[2]],N[Z[1]]),me=s.aV([],s.aW([],te,oe)),ye=-s.aX(me,N[Z[1]]);return me.concat(ye)})),W=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],K=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const Z of N)for(let te=0;te<3;te++)W[te]=Math.min(W[te],Z[te]),K[te]=Math.max(K[te],Z[te]);return new ii(N,H,new Gn(W,K))}}class nn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(o){this._helper.setMinZoom(o)}setMaxZoom(o){this._helper.setMaxZoom(o)}setMinPitch(o){this._helper.setMinPitch(o)}setMaxPitch(o){this._helper.setMaxPitch(o)}setRenderWorldCopies(o){this._helper.setRenderWorldCopies(o)}setBearing(o){this._helper.setBearing(o)}setPitch(o){this._helper.setPitch(o)}setRoll(o){this._helper.setRoll(o)}setFov(o){this._helper.setFov(o)}setZoom(o){this._helper.setZoom(o)}setCenter(o){this._helper.setCenter(o)}setElevation(o){this._helper.setElevation(o)}setMinElevationForCurrentTile(o){this._helper.setMinElevationForCurrentTile(o)}setPadding(o){this._helper.setPadding(o)}interpolatePadding(o,d,y){return this._helper.interpolatePadding(o,d,y)}isPaddingEqual(o){return this._helper.isPaddingEqual(o)}resize(o,d,y=!0){this._helper.resize(o,d,y)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(o){this._helper.setMaxBounds(o)}overrideNearFarZ(o,d){this._helper.overrideNearFarZ(o,d)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(o){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),o)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(o,d){}constructor(o,d,y,w,C){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Yi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(I,B)=>this.getConstrained(I,B)},o,d,y,w,C),this._coveringTilesDetailsProvider=new _i}clone(){const o=new nn;return o.apply(this),o}apply(o,d,y){this._helper.apply(o,d,y)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(o){const d=[new s.b2(0,o)];if(this._helper._renderWorldCopies){const y=this.screenPointToMercatorCoordinate(new s.P(0,0)),w=this.screenPointToMercatorCoordinate(new s.P(this._helper._width,0)),C=this.screenPointToMercatorCoordinate(new s.P(this._helper._width,this._helper._height)),I=this.screenPointToMercatorCoordinate(new s.P(0,this._helper._height)),B=Math.floor(Math.min(y.x,w.x,C.x,I.x)),N=Math.floor(Math.max(y.x,w.x,C.x,I.x)),H=1;for(let W=B-H;W<=N+H;W++)W!==0&&d.push(new s.b2(W,o))}return d}getCameraFrustum(){return ii.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(o){const d=this.screenPointToLocation(this.centerPoint,o),y=o?o.getElevationForLngLatZoom(d,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(y)}setLocationAtPoint(o,d){const y=s.aj(this.elevation,this.center.lat),w=this.screenPointToMercatorCoordinateAtZ(d,y),C=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,y),I=s.a1.fromLngLat(o),B=new s.a1(I.x-(w.x-C.x),I.y-(w.y-C.y));this.setCenter(B?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(o,d){return d?this.coordinatePoint(s.a1.fromLngLat(o),d.getElevationForLngLatZoom(o,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(s.a1.fromLngLat(o))}screenPointToLocation(o,d){var y;return(y=this.screenPointToMercatorCoordinate(o,d))===null||y===void 0?void 0:y.toLngLat()}screenPointToMercatorCoordinate(o,d){if(d){const y=d.pointCoordinate(o);if(y!=null)return y}return this.screenPointToMercatorCoordinateAtZ(o)}screenPointToMercatorCoordinateAtZ(o,d){const y=d||0,w=[o.x,o.y,0,1],C=[o.x,o.y,1,1];s.aw(w,w,this._pixelMatrixInverse),s.aw(C,C,this._pixelMatrixInverse);const I=w[3],B=C[3],N=w[1]/I,H=C[1]/B,W=w[2]/I,K=C[2]/B,Z=W===K?0:(y-W)/(K-W);return new s.a1(s.C.number(w[0]/I,C[0]/B,Z)/this.worldSize,s.C.number(N,H,Z)/this.worldSize,y)}coordinatePoint(o,d=0,y=this._pixelMatrix){const w=[o.x*this.worldSize,o.y*this.worldSize,d,1];return s.aw(w,w,y),new s.P(w[0]/w[3],w[1]/w[3])}getBounds(){const o=Math.max(0,this._helper._height/2-ke(this));return new Cr().extend(this.screenPointToLocation(new s.P(0,o))).extend(this.screenPointToLocation(new s.P(this._helper._width,o))).extend(this.screenPointToLocation(new s.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new s.P(0,this._helper._height)))}isPointOnMapSurface(o,d){return d?d.pointCoordinate(o)!=null:o.y>this.height/2-ke(this)}calculatePosMatrix(o,d=!1,y){var w;const C=(w=o.key)!==null&&w!==void 0?w:s.b3(o.wrap,o.canonical.z,o.canonical.z,o.canonical.x,o.canonical.y),I=d?this._alignedPosMatrixCache:this._posMatrixCache;if(I.has(C)){const H=I.get(C);return y?H.f32:H.f64}const B=Fe(o,this.worldSize);s.O(B,d?this._alignedProjMatrix:this._viewProjMatrix,B);const N={f64:B,f32:new Float32Array(B)};return I.set(C,N),y?N.f32:N.f64}calculateFogMatrix(o){const d=o.key,y=this._fogMatrixCacheF32;if(y.has(d))return y.get(d);const w=Fe(o,this.worldSize);return s.O(w,this._fogMatrix,w),y.set(d,new Float32Array(w)),y.get(d)}getConstrained(o,d){d=s.ah(+d,this.minZoom,this.maxZoom);const y={center:new s.S(o.lng,o.lat),zoom:d};let w=this._helper._lngRange;if(!this._helper._renderWorldCopies&&w===null){const Ee=179.9999999999;w=[-Ee,Ee]}const C=this.tileSize*s.af(y.zoom);let I=0,B=C,N=0,H=C,W=0,K=0;const{x:Z,y:te}=this.size;if(this._helper._latRange){const Ee=this._helper._latRange;I=s.U(Ee[1])*C,B=s.U(Ee[0])*C,B-I<te&&(W=te/(B-I))}w&&(N=s.aO(s.V(w[0])*C,0,C),H=s.aO(s.V(w[1])*C,0,C),H<N&&(H+=C),H-N<Z&&(K=Z/(H-N)));const{x:oe,y:me}=fe(C,o);let ye,_e;const be=Math.max(K||0,W||0);if(be){const Ee=new s.P(K?(H+N)/2:oe,W?(B+I)/2:me);return y.center=Me(C,Ee).wrap(),y.zoom+=s.ak(be),y}if(this._helper._latRange){const Ee=te/2;me-Ee<I&&(_e=I+Ee),me+Ee>B&&(_e=B-Ee)}if(w){const Ee=(N+H)/2;let Te=oe;this._helper._renderWorldCopies&&(Te=s.aO(oe,Ee-C/2,Ee+C/2));const Oe=Z/2;Te-Oe<N&&(ye=N+Oe),Te+Oe>H&&(ye=H-Oe)}if(ye!==void 0||_e!==void 0){const Ee=new s.P(ye??oe,_e??me);y.center=Me(C,Ee).wrap()}return y}calculateCenterFromCameraLngLatAlt(o,d,y,w){return this._helper.calculateCenterFromCameraLngLatAlt(o,d,y,w)}_calculateNearFarZIfNeeded(o,d,y){if(!this._helper.autoCalculateNearFarZ)return;const w=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),C=o-w*this._helper._pixelPerMeter/Math.cos(d),I=w<0?C:o,B=Math.PI/2+this.pitchInRadians,N=s.ae(this.fov)*(Math.abs(Math.cos(s.ae(this.roll)))*this.height+Math.abs(Math.sin(s.ae(this.roll)))*this.width)/this.height*(.5+y.y/this.height),H=Math.sin(N)*I/Math.sin(s.ah(Math.PI-B-N,.01,Math.PI-.01)),W=ke(this),K=Math.atan(W/this._helper.cameraToCenterDistance),Z=s.ae(.75),te=K>Z?2*K*(.5+y.y/(2*W)):Z,oe=Math.sin(te)*I/Math.sin(s.ah(Math.PI-B-te,.01,Math.PI-.01)),me=Math.min(H,oe);this._helper._farZ=1.01*(Math.cos(Math.PI/2-d)*me+I),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const o=this.centerOffset,d=fe(this.worldSize,this.center),y=d.x,w=d.y;this._helper._pixelPerMeter=s.aj(1,this.center.lat)*this.worldSize;const C=s.ae(Math.min(this.pitch,se)),I=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(C));let B;this._calculateNearFarZIfNeeded(I,C,o),B=new Float64Array(16),s.b4(B,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),s.aq(this._invProjMatrix,B),B[8]=2*-o.x/this._helper._width,B[9]=2*o.y/this._helper._height,this._projectionMatrix=s.b5(B),s.N(B,B,[1,-1,1]),s.M(B,B,[0,0,-this._helper.cameraToCenterDistance]),s.b6(B,B,-this.rollInRadians),s.b7(B,B,this.pitchInRadians),s.b6(B,B,-this.bearingInRadians),s.M(B,B,[-y,-w,0]),this._mercatorMatrix=s.N([],B,[this.worldSize,this.worldSize,this.worldSize]),s.N(B,B,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=s.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,B),s.M(B,B,[0,0,-this.elevation]),this._viewProjMatrix=B,this._invViewProjMatrix=s.aq([],B);const N=[0,0,-1,1];s.aw(N,N,this._invViewProjMatrix),this._cameraPosition=[N[0]/N[3],N[1]/N[3],N[2]/N[3]],this._fogMatrix=new Float64Array(16),s.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,I,this._helper._farZ),this._fogMatrix[8]=2*-o.x/this.width,this._fogMatrix[9]=2*o.y/this.height,s.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),s.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),s.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),s.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),s.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),s.M(this._fogMatrix,this._fogMatrix,[-y,-w,0]),s.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),s.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=s.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,B);const H=this._helper._width%2/2,W=this._helper._height%2/2,K=Math.cos(this.bearingInRadians),Z=Math.sin(-this.bearingInRadians),te=y-Math.round(y)+K*H+Z*W,oe=w-Math.round(w)+K*W+Z*H,me=new Float64Array(B);if(s.M(me,me,[te>.5?te-1:te,oe>.5?oe-1:oe,0]),this._alignedProjMatrix=me,B=s.aq(new Float64Array(16),this._pixelMatrix),!B)throw new Error("failed to invert matrix");this._pixelMatrixInverse=B,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const o=this.screenPointToMercatorCoordinate(new s.P(0,0)),d=[o.x*this.worldSize,o.y*this.worldSize,0,1];return s.aw(d,d,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const o=s.aj(1,this.center.lat)*this.worldSize;return Qe(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/o).toLngLat()}lngLatToCameraDepth(o,d){const y=s.a1.fromLngLat(o),w=[y.x*this.worldSize,y.y*this.worldSize,d,1];return s.aw(w,w,this._viewProjMatrix),w[2]/w[3]}getProjectionData(o){const{overscaledTileID:d,aligned:y,applyTerrainMatrix:w}=o,C=this._helper.getMercatorTileCoordinates(d),I=d?this.calculatePosMatrix(d,y,!0):null;let B;return B=d&&d.terrainRttPosMatrix32f&&w?d.terrainRttPosMatrix32f:I||s.b8(),{mainMatrix:B,tileMercatorCoords:C,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:B}}isLocationOccluded(o){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(o,d,y){return 1}transformLightDirection(o){return s.aT(o)}getRayDirectionFromPixel(o){throw new Error("Not implemented.")}projectTileCoordinates(o,d,y,w){const C=this.calculatePosMatrix(y);let I;w?(I=[o,d,w(o,d),1],s.aw(I,I,C)):(I=[o,d,0,1],Qa(I,I,C));const B=I[3];return{point:new s.P(I[0]/B,I[1]/B),signedDistanceFromCamera:B,isOccluded:!1}}populateCache(o){for(const d of o)this.calculatePosMatrix(d)}getMatrixForModel(o,d){const y=s.a1.fromLngLat(o,d),w=y.meterInMercatorCoordinateUnits(),C=s.b9();return s.M(C,C,[y.x,y.y,y.z]),s.b6(C,C,Math.PI),s.b7(C,C,Math.PI/2),s.N(C,C,[-w,w,w]),C}getProjectionDataForCustomLayer(o=!0){const d=new s.Z(0,0,0,0,0),y=this.getProjectionData({overscaledTileID:d,applyGlobeMatrix:o}),w=Fe(d,this.worldSize);s.O(w,this._viewProjMatrix,w),y.tileMercatorCoords=[0,0,1,1];const C=[s.$,s.$,this.worldSize/this._helper.pixelsPerMeter],I=s.ba();return s.N(I,w,C),y.fallbackMatrix=I,y.mainMatrix=I,y}getFastPathSimpleProjectionMatrix(o){return this.calculatePosMatrix(o)}}function Yd(){s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Mi(E){if(E.useSlerp)if(E.k<1){const o=s.bb(E.startEulerAngles.roll,E.startEulerAngles.pitch,E.startEulerAngles.bearing),d=s.bb(E.endEulerAngles.roll,E.endEulerAngles.pitch,E.endEulerAngles.bearing),y=new Float64Array(4);s.bc(y,o,d,E.k);const w=s.bd(y);E.tr.setRoll(w.roll),E.tr.setPitch(w.pitch),E.tr.setBearing(w.bearing)}else E.tr.setRoll(E.endEulerAngles.roll),E.tr.setPitch(E.endEulerAngles.pitch),E.tr.setBearing(E.endEulerAngles.bearing);else E.tr.setRoll(s.C.number(E.startEulerAngles.roll,E.endEulerAngles.roll,E.k)),E.tr.setPitch(s.C.number(E.startEulerAngles.pitch,E.endEulerAngles.pitch,E.k)),E.tr.setBearing(s.C.number(E.startEulerAngles.bearing,E.endEulerAngles.bearing,E.k))}function si(E,o,d,y,w){const C=w.padding,I=fe(w.worldSize,d.getNorthWest()),B=fe(w.worldSize,d.getNorthEast()),N=fe(w.worldSize,d.getSouthEast()),H=fe(w.worldSize,d.getSouthWest()),W=s.ae(-y),K=I.rotate(W),Z=B.rotate(W),te=N.rotate(W),oe=H.rotate(W),me=new s.P(Math.max(K.x,Z.x,oe.x,te.x),Math.max(K.y,Z.y,oe.y,te.y)),ye=new s.P(Math.min(K.x,Z.x,oe.x,te.x),Math.min(K.y,Z.y,oe.y,te.y)),_e=me.sub(ye),be=(w.width-(C.left+C.right+o.left+o.right))/_e.x,Ee=(w.height-(C.top+C.bottom+o.top+o.bottom))/_e.y;if(Ee<0||be<0)return void Yd();const Te=Math.min(s.ak(w.scale*Math.min(be,Ee)),E.maxZoom),Oe=s.P.convert(E.offset),Ne=new s.P((o.left-o.right)/2,(o.top-o.bottom)/2).rotate(s.ae(y)),Ce=Oe.add(Ne).mult(w.scale/s.af(Te));return{center:Me(w.worldSize,I.add(N).div(2).sub(Ce)),zoom:Te,bearing:y}}class zi{get useGlobeControls(){return!1}handlePanInertia(o,d){const y=o.mag(),w=Math.abs(ke(d));return{easingOffset:o.mult(Math.min(.75*w/y,1)),easingCenter:d.center}}handleMapControlsRollPitchBearingZoom(o,d){o.bearingDelta&&d.setBearing(d.bearing+o.bearingDelta),o.pitchDelta&&d.setPitch(d.pitch+o.pitchDelta),o.rollDelta&&d.setRoll(d.roll+o.rollDelta),o.zoomDelta&&d.setZoom(d.zoom+o.zoomDelta)}handleMapControlsPan(o,d,y){o.around.distSqr(d.centerPoint)<.01||d.setLocationAtPoint(y,o.around)}cameraForBoxAndBearing(o,d,y,w,C){return si(o,d,y,w,C)}handleJumpToCenterZoom(o,d){o.zoom!==(d.zoom!==void 0?+d.zoom:o.zoom)&&o.setZoom(+d.zoom),d.center!==void 0&&o.setCenter(s.S.convert(d.center))}handleEaseTo(o,d){const y=o.zoom,w=o.padding,C={roll:o.roll,pitch:o.pitch,bearing:o.bearing},I={roll:d.roll===void 0?o.roll:d.roll,pitch:d.pitch===void 0?o.pitch:d.pitch,bearing:d.bearing===void 0?o.bearing:d.bearing},B=d.zoom!==void 0,N=!o.isPaddingEqual(d.padding);let H=!1;const W=B?+d.zoom:o.zoom;let K=o.centerPoint.add(d.offsetAsPoint);const Z=o.screenPointToLocation(K),{center:te,zoom:oe}=o.getConstrained(s.S.convert(d.center||Z),W??y);ga(o,te);const me=fe(o.worldSize,Z),ye=fe(o.worldSize,te).sub(me),_e=s.af(oe-y);return H=oe!==y,{easeFunc:be=>{if(H&&o.setZoom(s.C.number(y,oe,be)),s.be(C,I)||Mi({startEulerAngles:C,endEulerAngles:I,tr:o,k:be,useSlerp:C.roll!=I.roll}),N&&(o.interpolatePadding(w,d.padding,be),K=o.centerPoint.add(d.offsetAsPoint)),d.around)o.setLocationAtPoint(d.around,d.aroundPoint);else{const Ee=s.af(o.zoom-y),Te=oe>y?Math.min(2,_e):Math.max(.5,_e),Oe=Math.pow(Te,1-be),Ne=Me(o.worldSize,me.add(ye.mult(be*Oe)).mult(Ee));o.setLocationAtPoint(o.renderWorldCopies?Ne.wrap():Ne,K)}},isZooming:H,elevationCenter:te}}handleFlyTo(o,d){const y=d.zoom!==void 0,w=o.zoom,C=o.getConstrained(s.S.convert(d.center||d.locationAtOffset),y?+d.zoom:w),I=C.center,B=C.zoom;ga(o,I);const N=fe(o.worldSize,d.locationAtOffset),H=fe(o.worldSize,I).sub(N),W=H.mag(),K=s.af(B-w);let Z;if(d.minZoom!==void 0){const te=Math.min(+d.minZoom,w,B),oe=o.getConstrained(I,te).zoom;Z=s.af(oe-w)}return{easeFunc:(te,oe,me,ye)=>{o.setZoom(te===1?B:w+s.ak(oe));const _e=te===1?I:Me(o.worldSize,N.add(H.mult(me)).mult(oe));o.setLocationAtPoint(o.renderWorldCopies?_e.wrap():_e,ye)},scaleOfZoom:K,targetCenter:I,scaleOfMinZoom:Z,pixelPathLength:W}}}class sn{constructor(o,d,y){this.blendFunction=o,this.blendColor=d,this.mask=y}}sn.Replace=[1,0],sn.disabled=new sn(sn.Replace,s.bf.transparent,[!1,!1,!1,!1]),sn.unblended=new sn(sn.Replace,s.bf.transparent,[!0,!0,!0,!0]),sn.alphaBlended=new sn([1,771],s.bf.transparent,[!0,!0,!0,!0]);const Bs=2305;class hr{constructor(o,d,y){this.enable=o,this.mode=d,this.frontFace=y}}hr.disabled=new hr(!1,1029,Bs),hr.backCCW=new hr(!0,1029,Bs),hr.frontCCW=new hr(!0,1028,Bs);class yr{constructor(o,d,y){this.func=o,this.mask=d,this.range=y}}yr.ReadOnly=!1,yr.ReadWrite=!0,yr.disabled=new yr(519,yr.ReadOnly,[0,1]);const to=7680;class zr{constructor(o,d,y,w,C,I){this.test=o,this.ref=d,this.mask=y,this.fail=w,this.depthFail=C,this.pass=I}}zr.disabled=new zr({func:519,mask:0},0,0,to,to,to);const rs=new WeakMap;function Ba(E){var o;if(rs.has(E))return rs.get(E);{const d=(o=E.getParameter(E.VERSION))===null||o===void 0?void 0:o.startsWith("WebGL 2.0");return rs.set(E,d),d}}class Xn{get awaitingQuery(){return!!this._readbackQueue}constructor(o){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=o;const d=o.context,y=d.gl;this._texFormat=y.RGBA,this._texType=y.UNSIGNED_BYTE;const w=new s.aL;w.emplaceBack(-1,-1),w.emplaceBack(2,-1),w.emplaceBack(-1,2);const C=new s.aN;C.emplaceBack(0,1,2),this._fullscreenTriangle=new Ol(d.createVertexBuffer(w,Fo.members),d.createIndexBuffer(C),s.aM.simpleSegment(0,0,w.length,C.length)),this._resultBuffer=new Uint8Array(4),d.activeTexture.set(y.TEXTURE1);const I=y.createTexture();y.bindTexture(y.TEXTURE_2D,I),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,y.NEAREST),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,y.NEAREST),y.texImage2D(y.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=d.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(I),Ba(y)&&(this._pbo=y.createBuffer(),y.bindBuffer(y.PIXEL_PACK_BUFFER,this._pbo),y.bufferData(y.PIXEL_PACK_BUFFER,4,y.STREAM_READ),y.bindBuffer(y.PIXEL_PACK_BUFFER,null))}destroy(){const o=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),o.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(o,d){const y=this._updateCount;return this._readbackQueue?y>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():y>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(o,d),this._updateCount++,this._measuredError}_bindFramebuffer(){const o=this._cachedRenderContext.context,d=o.gl;o.activeTexture.set(d.TEXTURE1),d.bindTexture(d.TEXTURE_2D,this._fbo.colorAttachment.get()),o.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(o,d){const y=this._cachedRenderContext.context,w=y.gl;if(this._bindFramebuffer(),y.viewport.set([0,0,this._texWidth,this._texHeight]),y.clear({color:s.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(y,w.TRIANGLES,yr.disabled,zr.disabled,sn.unblended,hr.disabled,((C,I)=>({u_input:C,u_output_expected:I}))(o,d),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Ba(w)){w.bindBuffer(w.PIXEL_PACK_BUFFER,this._pbo),w.readBuffer(w.COLOR_ATTACHMENT0),w.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),w.bindBuffer(w.PIXEL_PACK_BUFFER,null);const C=w.fenceSync(w.SYNC_GPU_COMMANDS_COMPLETE,0);w.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:C}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const o=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Ba(o)){const d=o.clientWaitSync(this._readbackQueue.sync,0,0);if(d===o.WAIT_FAILED)return s.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(d===o.TIMEOUT_EXPIRED)return;o.bindBuffer(o.PIXEL_PACK_BUFFER,this._pbo),o.getBufferSubData(o.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),o.bindBuffer(o.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),o.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Xn._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(o){let d=0;return d+=o[0]/256,d+=o[1]/65536,d+=o[2]/16777216,o[3]<127&&(d=-d),d/128}}const ro=s.$/128;function pu(E,o){const d=E.granularity!==void 0?Math.max(E.granularity,1):1,y=d+(E.generateBorders?2:0),w=d+(E.extendToNorthPole||E.generateBorders?1:0)+(E.extendToSouthPole||E.generateBorders?1:0),C=y+1,I=w+1,B=E.generateBorders?-1:0,N=E.generateBorders||E.extendToNorthPole?-1:0,H=d+(E.generateBorders?1:0),W=d+(E.generateBorders||E.extendToSouthPole?1:0),K=C*I,Z=y*w*6,te=C*I>65536;if(te&&o==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const oe=te||o==="32bit",me=new Int16Array(2*K);let ye=0;for(let Ee=N;Ee<=W;Ee++)for(let Te=B;Te<=H;Te++){let Oe=Te/d*s.$;Te===-1&&(Oe=-ro),Te===d+1&&(Oe=s.$+ro);let Ne=Ee/d*s.$;Ee===-1&&(Ne=E.extendToNorthPole?s.bh:-ro),Ee===d+1&&(Ne=E.extendToSouthPole?s.bi:s.$+ro),me[ye++]=Oe,me[ye++]=Ne}const _e=oe?new Uint32Array(Z):new Uint16Array(Z);let be=0;for(let Ee=0;Ee<w;Ee++)for(let Te=0;Te<y;Te++){const Oe=Te+1+Ee*C,Ne=Te+(Ee+1)*C,Ce=Te+1+(Ee+1)*C;_e[be++]=Te+Ee*C,_e[be++]=Ne,_e[be++]=Oe,_e[be++]=Oe,_e[be++]=Ne,_e[be++]=Ce}return{vertices:me.buffer.slice(0),indices:_e.buffer.slice(0),uses32bitIndices:oe}}const no=new s.aK({fill:new s.bj(128,2),line:new s.bj(512,0),tile:new s.bj(128,32),stencil:new s.bj(128,1),circle:3});class gh{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return ts.projectionGlobe}get vertexShaderPreludeCode(){return ts.projectionMercator.vertexSource}get subdivisionGranularity(){return no}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(o){this._errorMeasurement||(this._errorMeasurement=new Xn(o));const d=s.U(this._errorQueryLatitudeDegrees),y=2*Math.atan(Math.exp(Math.PI-d*Math.PI*2))-.5*Math.PI,w=this._errorMeasurement.updateErrorLoop(d,y),C=M.now();w!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=w,this._errorMeasurementLastChangeTime=C);const I=Math.min(Math.max((C-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=s.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,s.bl(I))}_getMeshKey(o){return`${o.granularity.toString(36)}_${o.generateBorders?"b":""}${o.extendToNorthPole?"n":""}${o.extendToSouthPole?"s":""}`}getMeshFromTileID(o,d,y,w,C){const I=(C==="stencil"?no.stencil:no.tile).getGranularityForZoomLevel(d.z);return this._getMesh(o,{granularity:I,generateBorders:y,extendToNorthPole:d.y===0&&w,extendToSouthPole:d.y===(1<<d.z)-1&&w})}_getMesh(o,d){const y=this._getMeshKey(d);if(y in this._tileMeshCache)return this._tileMeshCache[y];const w=(function(C,I){const B=pu(I,"16bit"),N=s.aL.deserialize({arrayBuffer:B.vertices,length:B.vertices.byteLength/2/2}),H=s.aN.deserialize({arrayBuffer:B.indices,length:B.indices.byteLength/2/3});return new Ol(C.createVertexBuffer(N,Fo.members),C.createIndexBuffer(H),s.aM.simpleSegment(0,0,N.length,H.length))})(o,d);return this._tileMeshCache[y]=w,w}recalculate(o){}hasTransition(){const o=M.now();let d=!1;return d=d||(o-this._errorMeasurementLastChangeTime)/1e3<.7,d=d||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,d}setErrorQueryLatitudeDegrees(o){this._errorQueryLatitudeDegrees=o}}const gu=new s.r({type:new s.D(s.v.projection.type)});class mu extends s.E{constructor(o){super(),this._transitionable=new s.t(gu,void 0),this.setProjection(o),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.F(0)),this._mercatorProjection=new Lr,this._verticalPerspectiveProjection=new gh}get transitionState(){const o=this.properties.get("type");if(typeof o=="string"&&o==="mercator")return 0;if(typeof o=="string"&&o==="vertical-perspective")return 1;if(o instanceof s.bm){if(o.from==="vertical-perspective"&&o.to==="mercator")return 1-o.transition;if(o.from==="mercator"&&o.to==="vertical-perspective")return o.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(o){this._mercatorProjection.updateGPUdependent(o),this._verticalPerspectiveProjection.updateGPUdependent(o)}getMeshFromTileID(o,d,y,w,C){return this.currentProjection.getMeshFromTileID(o,d,y,w,C)}setProjection(o){this._transitionable.setValue("type",o?.type||"mercator")}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}setErrorQueryLatitudeDegrees(o){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(o),this._mercatorProjection.setErrorQueryLatitudeDegrees(o)}}function kl(E){const o=yu(E.worldSize,E.center.lat);return 2*Math.PI*o}function Ns(E,o,d,y,w){const C=1/(1<<w),I=o/s.$*C+y*C,B=s.bo((E/s.$*C+d*C)*Math.PI*2+Math.PI,2*Math.PI),N=2*Math.atan(Math.exp(Math.PI-I*Math.PI*2))-.5*Math.PI,H=Math.cos(N),W=new Float64Array(3);return W[0]=Math.sin(B)*H,W[1]=Math.sin(N),W[2]=Math.cos(B)*H,W}function Ii(E){return(function(o,d){const y=Math.cos(d),w=new Float64Array(3);return w[0]=Math.sin(o)*y,w[1]=Math.sin(d),w[2]=Math.cos(o)*y,w})(E.lng*Math.PI/180,E.lat*Math.PI/180)}function yu(E,o){return E/(2*Math.PI)/Math.cos(o*Math.PI/180)}function mh(E){const o=Math.asin(E[1])/Math.PI*180,d=Math.sqrt(E[0]*E[0]+E[2]*E[2]);if(d>1e-6){const y=E[0]/d,w=Math.acos(E[2]/d),C=(y>0?w:-w)/Math.PI*180;return new s.S(s.aO(C,-180,180),o)}return new s.S(0,o)}function Ac(E){return Math.cos(E*Math.PI/180)}function zn(E,o){const d=Ac(E),y=Ac(o);return s.ak(y/d)}function Hg(E,o){const d=E.rotate(o.bearingInRadians),y=o.zoom+zn(o.center.lat,0),w=s.bk(1/Ac(o.center.lat),1/Ac(Math.min(Math.abs(o.center.lat),60)),s.bn(y,7,3,0,1)),C=360/kl({worldSize:o.worldSize,center:{lat:o.center.lat}});return new s.S(o.center.lng-d.x*C*w,s.ah(o.center.lat+d.y*C,-s.ai,s.ai))}function yh(E){const o=.5*E,d=Math.sin(o),y=Math.cos(o);return Math.log(d+y)-Math.log(y-d)}function Kd(E,o,d,y){const w=E.lat+d*y;if(Math.abs(d)>1){const C=(Math.sign(E.lat+d)!==Math.sign(E.lat)?-Math.abs(E.lat):Math.abs(E.lat))*Math.PI/180,I=Math.abs(E.lat+d)*Math.PI/180,B=yh(C+y*(I-C)),N=yh(C),H=yh(I);return new s.S(E.lng+o*((B-N)/(H-N)),w)}return new s.S(E.lng+o*y,w)}class Zy{constructor(o){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=o}swapBuffers(){if(!this._hadAnyChanges)return;const o=this._cachePrevious;this._cachePrevious=this._cache,this._cache=o,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(o,d,y,w){const C=`${o.z}_${o.x}_${o.y}_${w?.terrain?"t":""}`,I=this._cache.get(C);if(I)return I;const B=this._cachePrevious.get(C);if(B)return this._cache.set(C,B),B;const N=this._boundingVolumeFactory(o,d,y,w);return this._cache.set(C,N),this._hadAnyChanges=!0,N}}class _u{constructor(o,d,y,w){this.min=y,this.max=w,this.points=o,this.planes=d}static fromAabb(o,d){const y=[];for(let w=0;w<8;w++)y.push([1&~w?o[0]:d[0],(w>>1&1)==1?d[1]:o[1],(w>>2&1)==1?d[2]:o[2]]);return new _u(y,[[-1,0,0,d[0]],[1,0,0,-o[0]],[0,-1,0,d[1]],[0,1,0,-o[1]],[0,0,-1,d[2]],[0,0,1,-o[2]]],o,d)}static fromCenterSizeAngles(o,d,y){const w=s.br([],y[0],y[1],y[2]),C=s.bs([],[d[0],0,0],w),I=s.bs([],[0,d[1],0],w),B=s.bs([],[0,0,d[2]],w),N=[...o],H=[...o];for(let K=0;K<8;K++)for(let Z=0;Z<3;Z++){const te=o[Z]+C[Z]*(1&~K?-1:1)+I[Z]*((K>>1&1)==1?1:-1)+B[Z]*((K>>2&1)==1?1:-1);N[Z]=Math.min(N[Z],te),H[Z]=Math.max(H[Z],te)}const W=[];for(let K=0;K<8;K++){const Z=[...o];s.aS(Z,Z,s.aR([],C,1&~K?-1:1)),s.aS(Z,Z,s.aR([],I,(K>>1&1)==1?1:-1)),s.aS(Z,Z,s.aR([],B,(K>>2&1)==1?1:-1)),W.push(Z)}return new _u(W,[[...C,-s.aX(C,W[0])],[...I,-s.aX(I,W[0])],[...B,-s.aX(B,W[0])],[-C[0],-C[1],-C[2],-s.aX(C,W[7])],[-I[0],-I[1],-I[2],-s.aX(I,W[7])],[-B[0],-B[1],-B[2],-s.aX(B,W[7])]],N,H)}intersectsFrustum(o){let d=!0;const y=this.points.length,w=this.planes.length,C=o.planes.length,I=o.points.length;for(let B=0;B<C;B++){const N=o.planes[B];let H=0;for(let W=0;W<y;W++){const K=this.points[W];N[0]*K[0]+N[1]*K[1]+N[2]*K[2]+N[3]>=0&&H++}if(H===0)return 0;H<y&&(d=!1)}if(d)return 2;for(let B=0;B<w;B++){const N=this.planes[B];let H=0;for(let W=0;W<I;W++){const K=o.points[W];N[0]*K[0]+N[1]*K[1]+N[2]*K[2]+N[3]>=0&&H++}if(H===0)return 0}return 1}intersectsPlane(o){const d=this.points.length;let y=0;for(let w=0;w<d;w++){const C=this.points[w];o[0]*C[0]+o[1]*C[1]+o[2]*C[2]+o[3]>=0&&y++}return y===d?2:y===0?0:1}}function Fi(E,o,d){const y=E-o;return y<0?-y:Math.max(0,y-d)}function _h(E,o,d,y,w){const C=E-d;let I;return I=C<0?Math.min(-C,1+C-w):C>1?Math.min(Math.max(C-w,0),1-C):0,Math.max(I,Fi(o,y,w))}class io{constructor(){this._boundingVolumeCache=new Zy(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(o,d,y,w){const C=1<<y.z,I=1/C,B=y.x/C,N=y.y/C;let H=2;return H=Math.min(H,_h(o,d,B,N,I)),H=Math.min(H,_h(o,d,B+.5,-N-I,I)),H=Math.min(H,_h(o,d,B+.5,2-N-I,I)),H}getWrap(o,d,y){const w=1<<d.z,C=1/w,I=d.x/w,B=Fi(o.x,I,C),N=Fi(o.x,I-1,C),H=Fi(o.x,I+1,C),W=Math.min(B,N,H);return W===H?1:W===N?-1:0}allowVariableZoom(o,d){return Xt(o,d)>4}allowWorldCopies(){return!1}getTileBoundingVolume(o,d,y,w){return this._boundingVolumeCache.getTileBoundingVolume(o,d,y,w)}_computeTileBoundingVolume(o,d,y,w){var C,I;let B=0,N=0;if(w?.terrain){const H=new s.Z(o.z,d,o.z,o.x,o.y),W=w.terrain.getMinMaxElevation(H);B=(C=W.minElevation)!==null&&C!==void 0?C:Math.min(0,y),N=(I=W.maxElevation)!==null&&I!==void 0?I:Math.max(0,y)}if(B/=s.bu,N/=s.bu,B+=1,N+=1,o.z<=0)return _u.fromAabb([-N,-N,-N],[N,N,N]);if(o.z===1)return _u.fromAabb([o.x===0?-N:0,o.y===0?0:-N,-N],[o.x===0?0:N,o.y===0?N:0,N]);{const H=[Ns(0,0,o.x,o.y,o.z),Ns(s.$,0,o.x,o.y,o.z),Ns(s.$,s.$,o.x,o.y,o.z),Ns(0,s.$,o.x,o.y,o.z)],W=[];for(const nt of H)W.push(s.aR([],nt,N));if(N!==B)for(const nt of H)W.push(s.aR([],nt,B));o.y===0&&W.push([0,1,0]),o.y===(1<<o.z)-1&&W.push([0,-1,0]);const K=[1,1,1],Z=[-1,-1,-1];for(const nt of W)for(let lt=0;lt<3;lt++)K[lt]=Math.min(K[lt],nt[lt]),Z[lt]=Math.max(Z[lt],nt[lt]);const te=Ns(s.$/2,s.$/2,o.x,o.y,o.z),oe=s.aW([],[0,1,0],te);s.aV(oe,oe);const me=s.aW([],te,oe);s.aV(me,me);const ye=s.aW([],H[2],H[1]);s.aV(ye,ye);const _e=s.aW([],H[0],H[3]);s.aV(_e,_e),W.push(s.aR([],te,N)),o.y>=(1<<o.z)/2&&W.push(s.aR([],Ns(s.$/2,0,o.x,o.y,o.z),N)),o.y<(1<<o.z)/2&&W.push(s.aR([],Ns(s.$/2,s.$,o.x,o.y,o.z),N));const be=vh(te,W),Ee=vh(me,W),Te=[-te[0],-te[1],-te[2],be.max],Oe=[te[0],te[1],te[2],-be.min],Ne=[-me[0],-me[1],-me[2],Ee.max],Ce=[me[0],me[1],me[2],-Ee.min],ze=[...ye,0],ot=[..._e,0],tt=[];return o.y===0?tt.push(s.bt(ot,ze,Te),s.bt(ot,ze,Oe)):tt.push(s.bt(Ne,ze,Te),s.bt(Ne,ze,Oe),s.bt(Ne,ot,Te),s.bt(Ne,ot,Oe)),o.y===(1<<o.z)-1?tt.push(s.bt(ot,ze,Te),s.bt(ot,ze,Oe)):tt.push(s.bt(Ce,ze,Te),s.bt(Ce,ze,Oe),s.bt(Ce,ot,Te),s.bt(Ce,ot,Oe)),new _u(tt,[Te,Oe,Ne,Ce,ze,ot],K,Z)}}}function vh(E,o){let d=1/0,y=-1/0;for(const w of o){const C=s.aX(E,w);d=Math.min(d,C),y=Math.max(y,C)}return{min:d,max:y}}class bh{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(o){this._helper.setMinZoom(o)}setMaxZoom(o){this._helper.setMaxZoom(o)}setMinPitch(o){this._helper.setMinPitch(o)}setMaxPitch(o){this._helper.setMaxPitch(o)}setRenderWorldCopies(o){this._helper.setRenderWorldCopies(o)}setBearing(o){this._helper.setBearing(o)}setPitch(o){this._helper.setPitch(o)}setRoll(o){this._helper.setRoll(o)}setFov(o){this._helper.setFov(o)}setZoom(o){this._helper.setZoom(o)}setCenter(o){this._helper.setCenter(o)}setElevation(o){this._helper.setElevation(o)}setMinElevationForCurrentTile(o){this._helper.setMinElevationForCurrentTile(o)}setPadding(o){this._helper.setPadding(o)}interpolatePadding(o,d,y){return this._helper.interpolatePadding(o,d,y)}isPaddingEqual(o){return this._helper.isPaddingEqual(o)}resize(o,d){this._helper.resize(o,d)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(o){this._helper.setMaxBounds(o)}overrideNearFarZ(o,d){this._helper.overrideNearFarZ(o,d)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(o){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),o)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(o){}constructor(){this._cachedClippingPlane=s.bv(),this._projectionMatrix=s.b9(),this._globeViewProjMatrix32f=s.b8(),this._globeViewProjMatrixNoCorrection=s.b9(),this._globeViewProjMatrixNoCorrectionInverted=s.b9(),this._globeProjMatrixInverted=s.b9(),this._cameraPosition=s.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Yi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(o,d)=>this.getConstrained(o,d)}),this._coveringTilesDetailsProvider=new io}clone(){const o=new bh;return o.apply(this),o}apply(o,d){this._globeLatitudeErrorCorrectionRadians=d||0,this._helper.apply(o)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const o=s.bp();return o[0]=this._cameraPosition[0],o[1]=this._cameraPosition[1],o[2]=this._cameraPosition[2],o}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(o){const{overscaledTileID:d,applyGlobeMatrix:y}=o,w=this._helper.getMercatorTileCoordinates(d);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:w,clippingPlane:this._cachedClippingPlane,projectionTransition:y?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(o){const d=this.pitchInRadians,y=this.cameraToCenterDistance/o,w=Math.sin(d)*y,C=Math.cos(d)*y+1,I=1/Math.sqrt(w*w+C*C)*1;let B=-w,N=C;const H=Math.sqrt(B*B+N*N);B/=H,N/=H;const W=[0,B,N];s.bw(W,W,[0,0,0],-this.bearingInRadians),s.bx(W,W,[0,0,0],-1*this.center.lat*Math.PI/180),s.by(W,W,[0,0,0],this.center.lng*Math.PI/180);const K=1/s.aZ(W);return s.aR(W,W,K),[...W,-I*K]}isLocationOccluded(o){return!this.isSurfacePointVisible(Ii(o))}transformLightDirection(o){const d=this._helper._center.lng*Math.PI/180,y=this._helper._center.lat*Math.PI/180,w=Math.cos(y),C=[Math.sin(d)*w,Math.sin(y),Math.cos(d)*w],I=[C[2],0,-C[0]],B=[0,0,0];s.aW(B,I,C),s.aV(I,I),s.aV(B,B);const N=[0,0,0];return s.aV(N,[I[0]*o[0]+B[0]*o[1]+C[0]*o[2],I[1]*o[0]+B[1]*o[1]+C[1]*o[2],I[2]*o[0]+B[2]*o[1]+C[2]*o[2]]),N}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(o,d,y){const w=(function(B,N,H){const W=1/(1<<H.z);return new s.a1(B/s.$*W+H.x*W,N/s.$*W+H.y*W)})(o,d,y.canonical),C=(I=w.y,[s.bo(w.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-I*Math.PI*2))-.5*Math.PI]);var I;return this.getCircleRadiusCorrection()/Math.cos(C[1])}projectTileCoordinates(o,d,y,w){const C=y.canonical,I=Ns(o,d,C.x,C.y,C.z),B=1+(w?w(o,d):0)/s.bu,N=[I[0]*B,I[1]*B,I[2]*B,1];s.aw(N,N,this._globeViewProjMatrixNoCorrection);const H=this._cachedClippingPlane,W=H[0]*I[0]+H[1]*I[1]+H[2]*I[2]+H[3]<0;return{point:new s.P(N[0]/N[3],N[1]/N[3]),signedDistanceFromCamera:N[3],isOccluded:W}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const o=yu(this.worldSize,this.center.lat),d=s.ba(),y=s.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*o),s.b4(d,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const w=this.centerOffset;d[8]=2*-w.x/this._helper._width,d[9]=2*w.y/this._helper._height,this._projectionMatrix=s.b5(d),this._globeProjMatrixInverted=s.ba(),s.aq(this._globeProjMatrixInverted,d),s.M(d,d,[0,0,-this.cameraToCenterDistance]),s.b6(d,d,this.rollInRadians),s.b7(d,d,-this.pitchInRadians),s.b6(d,d,this.bearingInRadians),s.M(d,d,[0,0,-o]);const C=s.bp();C[0]=o,C[1]=o,C[2]=o,s.b7(y,d,this.center.lat*Math.PI/180),s.bz(y,y,-this.center.lng*Math.PI/180),s.N(y,y,C),this._globeViewProjMatrixNoCorrection=y,s.b7(d,d,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),s.bz(d,d,-this.center.lng*Math.PI/180),s.N(d,d,C),this._globeViewProjMatrix32f=new Float32Array(d),this._globeViewProjMatrixNoCorrectionInverted=s.ba(),s.aq(this._globeViewProjMatrixNoCorrectionInverted,y);const I=s.bp();this._cameraPosition=s.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/o,s.bw(this._cameraPosition,this._cameraPosition,I,-this.rollInRadians),s.bx(this._cameraPosition,this._cameraPosition,I,this.pitchInRadians),s.bw(this._cameraPosition,this._cameraPosition,I,-this.bearingInRadians),s.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),s.bx(this._cameraPosition,this._cameraPosition,I,-this.center.lat*Math.PI/180),s.by(this._cameraPosition,this._cameraPosition,I,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(o);const B=s.b5(this._globeViewProjMatrixNoCorrectionInverted);s.N(B,B,[1,1,-1]),this._cachedFrustum=ii.fromInvProjectionMatrix(B,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(o){s.w("calculateFogMatrix is not supported on globe projection.");const d=s.ba();return s.ag(d),d}getVisibleUnwrappedCoordinates(o){return[new s.b2(0,o)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(o){o&&s.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(o,d){if(!this._globeViewProjMatrixNoCorrection)return 1;const y=Ii(o);s.aR(y,y,1+d/s.bu);const w=s.bv();return s.aw(w,[y[0],y[1],y[2],1],this._globeViewProjMatrixNoCorrection),w[2]/w[3]}populateCache(o){}getBounds(){const o=.5*this.width,d=.5*this.height,y=[new s.P(0,0),new s.P(o,0),new s.P(this.width,0),new s.P(this.width,d),new s.P(this.width,this.height),new s.P(o,this.height),new s.P(0,this.height),new s.P(0,d)],w=[];for(const K of y)w.push(this.unprojectScreenPoint(K));let C=0,I=0,B=0,N=0;const H=this.center;for(const K of w){const Z=s.bA(H.lng,K.lng),te=s.bA(H.lat,K.lat);Z<I&&(I=Z),Z>C&&(C=Z),te<N&&(N=te),te>B&&(B=te)}const W=[H.lng+I,H.lat+N,H.lng+C,H.lat+B];return this.isSurfacePointOnScreen([0,1,0])&&(W[3]=90,W[0]=-180,W[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(W[1]=-90,W[0]=-180,W[2]=180),new Cr(W)}getConstrained(o,d){const y=s.ah(o.lat,-s.ai,s.ai),w=s.ah(+d,this.minZoom+zn(0,y),this.maxZoom);return{center:new s.S(o.lng,y),zoom:w}}calculateCenterFromCameraLngLatAlt(o,d,y,w){return this._helper.calculateCenterFromCameraLngLatAlt(o,d,y,w)}setLocationAtPoint(o,d){const y=Ii(this.unprojectScreenPoint(d)),w=Ii(o),C=s.bp();s.bB(C);const I=s.bp();s.by(I,y,C,-this.center.lng*Math.PI/180),s.bx(I,I,C,this.center.lat*Math.PI/180);const B=w[0]*w[0]+w[2]*w[2],N=I[0]*I[0];if(B<N)return;const H=Math.sqrt(B-N),W=-H,K=s.bC(w[0],w[2],I[0],H),Z=s.bC(w[0],w[2],I[0],W),te=s.bp();s.by(te,w,C,-K);const oe=s.bC(te[1],te[2],I[1],I[2]),me=s.bp();s.by(me,w,C,-Z);const ye=s.bC(me[1],me[2],I[1],I[2]),_e=.5*Math.PI,be=oe>=-_e&&oe<=_e,Ee=ye>=-_e&&ye<=_e;let Te,Oe;if(be&&Ee){const ot=this.center.lng*Math.PI/180,tt=this.center.lat*Math.PI/180;s.bD(K,ot)+s.bD(oe,tt)<s.bD(Z,ot)+s.bD(ye,tt)?(Te=K,Oe=oe):(Te=Z,Oe=ye)}else if(be)Te=K,Oe=oe;else{if(!Ee)return;Te=Z,Oe=ye}const Ne=Te/Math.PI*180,Ce=Oe/Math.PI*180,ze=this.center.lat;this.setCenter(new s.S(Ne,s.ah(Ce,-90,90))),this.setZoom(this.zoom+zn(ze,this.center.lat))}locationToScreenPoint(o,d){const y=Ii(o);if(d){const w=d.getElevationForLngLatZoom(o,this._helper._tileZoom);s.aR(y,y,1+w/s.bu)}return this._projectSurfacePointToScreen(y)}_projectSurfacePointToScreen(o){const d=s.bv();return s.aw(d,[...o,1],this._globeViewProjMatrixNoCorrection),d[0]/=d[3],d[1]/=d[3],new s.P((.5*d[0]+.5)*this.width,(.5*-d[1]+.5)*this.height)}screenPointToMercatorCoordinate(o,d){if(d){const y=d.pointCoordinate(o);if(y)return y}return s.a1.fromLngLat(this.unprojectScreenPoint(o))}screenPointToLocation(o,d){var y;return(y=this.screenPointToMercatorCoordinate(o,d))===null||y===void 0?void 0:y.toLngLat()}isPointOnMapSurface(o,d){const y=this._cameraPosition,w=this.getRayDirectionFromPixel(o);return!!this.rayPlanetIntersection(y,w)}getRayDirectionFromPixel(o){const d=s.bv();d[0]=o.x/this.width*2-1,d[1]=-1*(o.y/this.height*2-1),d[2]=1,d[3]=1,s.aw(d,d,this._globeViewProjMatrixNoCorrectionInverted),d[0]/=d[3],d[1]/=d[3],d[2]/=d[3];const y=s.bp();y[0]=d[0]-this._cameraPosition[0],y[1]=d[1]-this._cameraPosition[1],y[2]=d[2]-this._cameraPosition[2];const w=s.bp();return s.aV(w,y),w}isSurfacePointVisible(o){const d=this._cachedClippingPlane;return d[0]*o[0]+d[1]*o[1]+d[2]*o[2]+d[3]>=0}isSurfacePointOnScreen(o){if(!this.isSurfacePointVisible(o))return!1;const d=s.bv();return s.aw(d,[...o,1],this._globeViewProjMatrixNoCorrection),d[0]/=d[3],d[1]/=d[3],d[2]/=d[3],d[0]>-1&&d[0]<1&&d[1]>-1&&d[1]<1&&d[2]>-1&&d[2]<1}rayPlanetIntersection(o,d){const y=s.aX(o,d),w=s.bp(),C=s.bp();s.aR(C,d,y),s.aU(w,o,C);const I=1-s.aX(w,w);if(I<0)return null;const B=s.aX(o,o)-1,N=-y+(y<0?1:-1)*Math.sqrt(I),H=B/N,W=N;return{tMin:Math.min(H,W),tMax:Math.max(H,W)}}unprojectScreenPoint(o){const d=this._cameraPosition,y=this.getRayDirectionFromPixel(o),w=this.rayPlanetIntersection(d,y);if(w){const W=s.bp();s.aS(W,d,[y[0]*w.tMin,y[1]*w.tMin,y[2]*w.tMin]);const K=s.bp();return s.aV(K,W),mh(K)}const C=this._cachedClippingPlane,I=C[0]*y[0]+C[1]*y[1]+C[2]*y[2],B=-s.b1(C,d)/I,N=s.bp();if(B>0)s.aS(N,d,[y[0]*B,y[1]*B,y[2]*B]);else{const W=s.bp();s.aS(W,d,[2*y[0],2*y[1],2*y[2]]);const K=s.b1(this._cachedClippingPlane,W);s.aU(N,W,[this._cachedClippingPlane[0]*K,this._cachedClippingPlane[1]*K,this._cachedClippingPlane[2]*K])}const H=(function(W){const K=s.bp();return K[0]=W[0]*-W[3],K[1]=W[1]*-W[3],K[2]=W[2]*-W[3],{center:K,radius:Math.sqrt(1-W[3]*W[3])}})(C);return mh((function(W,K,Z){const te=s.bp();s.aU(te,Z,W);const oe=s.bp();return s.bq(oe,W,te,K/s.a$(te)),oe})(H.center,H.radius,N))}getMatrixForModel(o,d){const y=s.S.convert(o),w=1/s.bu,C=s.b9();return s.bz(C,C,y.lng/180*Math.PI),s.b7(C,C,-y.lat/180*Math.PI),s.M(C,C,[0,0,1+d/s.bu]),s.b7(C,C,.5*Math.PI),s.N(C,C,[w,w,w]),C}getProjectionDataForCustomLayer(o=!0){const d=this.getProjectionData({overscaledTileID:new s.Z(0,0,0,0,0),applyGlobeMatrix:o});return d.tileMercatorCoords=[0,0,1,1],d}getFastPathSimpleProjectionMatrix(o){}}class Ec{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(o){this._helper.setMinZoom(o)}setMaxZoom(o){this._helper.setMaxZoom(o)}setMinPitch(o){this._helper.setMinPitch(o)}setMaxPitch(o){this._helper.setMaxPitch(o)}setRenderWorldCopies(o){this._helper.setRenderWorldCopies(o)}setBearing(o){this._helper.setBearing(o)}setPitch(o){this._helper.setPitch(o)}setRoll(o){this._helper.setRoll(o)}setFov(o){this._helper.setFov(o)}setZoom(o){this._helper.setZoom(o)}setCenter(o){this._helper.setCenter(o)}setElevation(o){this._helper.setElevation(o)}setMinElevationForCurrentTile(o){this._helper.setMinElevationForCurrentTile(o)}setPadding(o){this._helper.setPadding(o)}interpolatePadding(o,d,y){return this._helper.interpolatePadding(o,d,y)}isPaddingEqual(o){return this._helper.isPaddingEqual(o)}resize(o,d,y=!0){this._helper.resize(o,d,y)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(o){this._helper.setMaxBounds(o)}overrideNearFarZ(o,d){this._helper.overrideNearFarZ(o,d)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(o){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),o)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(o,d){this._globeness=o,this._globeLatitudeErrorCorrectionRadians=d,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Yi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(o,d)=>this.getConstrained(o,d)}),this._globeness=1,this._mercatorTransform=new nn,this._verticalPerspectiveTransform=new bh}clone(){const o=new Ec;return o._globeness=this._globeness,o._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,o.apply(this),o}apply(o){this._helper.apply(o),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(o){const d=this._mercatorTransform.getProjectionData(o),y=this._verticalPerspectiveTransform.getProjectionData(o);return{mainMatrix:this.isGlobeRendering?y.mainMatrix:d.mainMatrix,clippingPlane:y.clippingPlane,tileMercatorCoords:y.tileMercatorCoords,projectionTransition:o.applyGlobeMatrix?this._globeness:0,fallbackMatrix:d.fallbackMatrix}}isLocationOccluded(o){return this.currentTransform.isLocationOccluded(o)}transformLightDirection(o){return this.currentTransform.transformLightDirection(o)}getPixelScale(){return s.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return s.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(o,d,y){const w=this._mercatorTransform.getPitchedTextCorrection(o,d,y),C=this._verticalPerspectiveTransform.getPitchedTextCorrection(o,d,y);return s.bk(w,C,this._globeness)}projectTileCoordinates(o,d,y,w){return this.currentTransform.projectTileCoordinates(o,d,y,w)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(o){return this.currentTransform.calculateFogMatrix(o)}getVisibleUnwrappedCoordinates(o){return this.currentTransform.getVisibleUnwrappedCoordinates(o)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(o){this._mercatorTransform.recalculateZoomAndCenter(o),this._verticalPerspectiveTransform.recalculateZoomAndCenter(o)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(o,d){return this.currentTransform.lngLatToCameraDepth(o,d)}populateCache(o){this._mercatorTransform.populateCache(o),this._verticalPerspectiveTransform.populateCache(o)}getBounds(){return this.currentTransform.getBounds()}getConstrained(o,d){return this.currentTransform.getConstrained(o,d)}calculateCenterFromCameraLngLatAlt(o,d,y,w){return this._helper.calculateCenterFromCameraLngLatAlt(o,d,y,w)}setLocationAtPoint(o,d){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(o,d),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(o,d),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(o,d){return this.currentTransform.locationToScreenPoint(o,d)}screenPointToMercatorCoordinate(o,d){return this.currentTransform.screenPointToMercatorCoordinate(o,d)}screenPointToLocation(o,d){return this.currentTransform.screenPointToLocation(o,d)}isPointOnMapSurface(o,d){return this.currentTransform.isPointOnMapSurface(o,d)}getRayDirectionFromPixel(o){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(o)}getMatrixForModel(o,d){return this.currentTransform.getMatrixForModel(o,d)}getProjectionDataForCustomLayer(o=!0){const d=this._mercatorTransform.getProjectionDataForCustomLayer(o);if(!this.isGlobeRendering)return d;const y=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(o);return y.fallbackMatrix=d.mainMatrix,y}getFastPathSimpleProjectionMatrix(o){return this.currentTransform.getFastPathSimpleProjectionMatrix(o)}}class ns{get useGlobeControls(){return!0}handlePanInertia(o,d){const y=Hg(o,d);return Math.abs(y.lng-d.center.lng)>180&&(y.lng=d.center.lng+179.5*Math.sign(y.lng-d.center.lng)),{easingCenter:y,easingOffset:new s.P(0,0)}}handleMapControlsRollPitchBearingZoom(o,d){const y=o.around,w=d.screenPointToLocation(y);o.bearingDelta&&d.setBearing(d.bearing+o.bearingDelta),o.pitchDelta&&d.setPitch(d.pitch+o.pitchDelta),o.rollDelta&&d.setRoll(d.roll+o.rollDelta);const C=d.zoom;o.zoomDelta&&d.setZoom(d.zoom+o.zoomDelta);const I=d.zoom-C;if(I===0)return;const B=s.bA(d.center.lng,w.lng),N=B/(Math.abs(B/180)+1),H=s.bA(d.center.lat,w.lat),W=d.getRayDirectionFromPixel(y),K=d.cameraPosition,Z=-1*s.aX(K,W),te=s.bp();s.aS(te,K,[W[0]*Z,W[1]*Z,W[2]*Z]);const oe=s.aZ(te)-1,me=Math.exp(.5*-Math.max(oe-.3,0)),ye=yu(d.worldSize,d.center.lat)/Math.min(d.width,d.height),_e=s.bn(ye,.9,.5,1,.25),be=(1-s.af(-I))*Math.min(me,_e),Ee=d.center.lat,Te=d.zoom,Oe=new s.S(d.center.lng+N*be,s.ah(d.center.lat+H*be,-s.ai,s.ai));d.setLocationAtPoint(w,y);const Ne=d.center,Ce=s.bn(Math.abs(B),45,85,0,1),ze=s.bn(ye,.75,.35,0,1),ot=Math.pow(Math.max(Ce,ze),.25),tt=s.bA(Ne.lng,Oe.lng),nt=s.bA(Ne.lat,Oe.lat);d.setCenter(new s.S(Ne.lng+tt*ot,Ne.lat+nt*ot).wrap()),d.setZoom(Te+zn(Ee,d.center.lat))}handleMapControlsPan(o,d,y){if(!o.panDelta)return;const w=d.center.lat,C=d.zoom;d.setCenter(Hg(o.panDelta,d).wrap()),d.setZoom(C+zn(w,d.center.lat))}cameraForBoxAndBearing(o,d,y,w,C){const I=si(o,d,y,w,C),B=d.left/C.width*2-1,N=(C.width-d.right)/C.width*2-1,H=d.top/C.height*-2+1,W=(C.height-d.bottom)/C.height*-2+1,K=s.bA(y.getWest(),y.getEast())<0,Z=K?y.getEast():y.getWest(),te=K?y.getWest():y.getEast(),oe=Math.max(y.getNorth(),y.getSouth()),me=Math.min(y.getNorth(),y.getSouth()),ye=Z+.5*s.bA(Z,te),_e=oe+.5*s.bA(oe,me),be=C.clone();be.setCenter(I.center),be.setBearing(I.bearing),be.setPitch(0),be.setRoll(0),be.setZoom(I.zoom);const Ee=be.modelViewProjectionMatrix,Te=[Ii(y.getNorthWest()),Ii(y.getNorthEast()),Ii(y.getSouthWest()),Ii(y.getSouthEast()),Ii(new s.S(te,_e)),Ii(new s.S(Z,_e)),Ii(new s.S(ye,oe)),Ii(new s.S(ye,me))],Oe=Ii(I.center);let Ne=Number.POSITIVE_INFINITY;for(const Ce of Te)B<0&&(Ne=ns.getLesserNonNegativeNonNull(Ne,ns.solveVectorScale(Ce,Oe,Ee,"x",B))),N>0&&(Ne=ns.getLesserNonNegativeNonNull(Ne,ns.solveVectorScale(Ce,Oe,Ee,"x",N))),H>0&&(Ne=ns.getLesserNonNegativeNonNull(Ne,ns.solveVectorScale(Ce,Oe,Ee,"y",H))),W<0&&(Ne=ns.getLesserNonNegativeNonNull(Ne,ns.solveVectorScale(Ce,Oe,Ee,"y",W)));if(Number.isFinite(Ne)&&Ne!==0)return I.zoom=be.zoom+s.ak(Ne),I;Yd()}handleJumpToCenterZoom(o,d){const y=o.center.lat,w=o.getConstrained(d.center?s.S.convert(d.center):o.center,o.zoom).center;o.setCenter(w.wrap());const C=d.zoom!==void 0?+d.zoom:o.zoom+zn(y,w.lat);o.zoom!==C&&o.setZoom(C)}handleEaseTo(o,d){const y=o.zoom,w=o.center,C=o.padding,I={roll:o.roll,pitch:o.pitch,bearing:o.bearing},B={roll:d.roll===void 0?o.roll:d.roll,pitch:d.pitch===void 0?o.pitch:d.pitch,bearing:d.bearing===void 0?o.bearing:d.bearing},N=d.zoom!==void 0,H=!o.isPaddingEqual(d.padding);let W=!1;const K=d.center?s.S.convert(d.center):w,Z=o.getConstrained(K,y).center;ga(o,Z);const te=o.clone();te.setCenter(Z),te.setZoom(N?+d.zoom:y+zn(w.lat,K.lat)),te.setBearing(d.bearing);const oe=new s.P(s.ah(o.centerPoint.x+d.offsetAsPoint.x,0,o.width),s.ah(o.centerPoint.y+d.offsetAsPoint.y,0,o.height));te.setLocationAtPoint(Z,oe);const me=(d.offset&&d.offsetAsPoint.mag())>0?te.center:Z,ye=N?+d.zoom:y+zn(w.lat,me.lat),_e=y+zn(w.lat,0),be=ye+zn(me.lat,0),Ee=s.bA(w.lng,me.lng),Te=s.bA(w.lat,me.lat),Oe=s.af(be-_e);return W=ye!==y,{easeFunc:Ne=>{if(s.be(I,B)||Mi({startEulerAngles:I,endEulerAngles:B,tr:o,k:Ne,useSlerp:I.roll!=B.roll}),H&&o.interpolatePadding(C,d.padding,Ne),d.around)s.w("Easing around a point is not supported under globe projection."),o.setLocationAtPoint(d.around,d.aroundPoint);else{const Ce=be>_e?Math.min(2,Oe):Math.max(.5,Oe),ze=Math.pow(Ce,1-Ne),ot=Kd(w,Ee,Te,Ne*ze);o.setCenter(ot.wrap())}if(W){const Ce=s.C.number(_e,be,Ne)+zn(0,o.center.lat);o.setZoom(Ce)}},isZooming:W,elevationCenter:me}}handleFlyTo(o,d){const y=d.zoom!==void 0,w=o.center,C=o.zoom,I=o.padding,B=!o.isPaddingEqual(d.padding),N=o.getConstrained(s.S.convert(d.center||d.locationAtOffset),C).center,H=y?+d.zoom:o.zoom+zn(o.center.lat,N.lat),W=o.clone();W.setCenter(N),W.setZoom(H),W.setBearing(d.bearing);const K=new s.P(s.ah(o.centerPoint.x+d.offsetAsPoint.x,0,o.width),s.ah(o.centerPoint.y+d.offsetAsPoint.y,0,o.height));W.setLocationAtPoint(N,K);const Z=W.center;ga(o,Z);const te=(function(Te,Oe,Ne){const Ce=Ii(Oe),ze=Ii(Ne),ot=s.aX(Ce,ze),tt=Math.acos(ot),nt=kl(Te);return tt/(2*Math.PI)*nt})(o,w,Z),oe=C+zn(w.lat,0),me=H+zn(Z.lat,0),ye=s.af(me-oe);let _e;if(typeof d.minZoom=="number"){const Te=+d.minZoom+zn(Z.lat,0),Oe=Math.min(Te,oe,me)+zn(0,Z.lat),Ne=o.getConstrained(Z,Oe).zoom+zn(Z.lat,0);_e=s.af(Ne-oe)}const be=s.bA(w.lng,Z.lng),Ee=s.bA(w.lat,Z.lat);return{easeFunc:(Te,Oe,Ne,Ce)=>{const ze=Kd(w,be,Ee,Ne);B&&o.interpolatePadding(I,d.padding,Te);const ot=Te===1?Z:ze;o.setCenter(ot.wrap());const tt=oe+s.ak(Oe);o.setZoom(Te===1?H:tt+zn(0,ot.lat))},scaleOfZoom:ye,targetCenter:Z,scaleOfMinZoom:_e,pixelPathLength:te}}static solveVectorScale(o,d,y,w,C){const I=w==="x"?[y[0],y[4],y[8],y[12]]:[y[1],y[5],y[9],y[13]],B=[y[3],y[7],y[11],y[15]],N=o[0]*I[0]+o[1]*I[1]+o[2]*I[2],H=o[0]*B[0]+o[1]*B[1]+o[2]*B[2],W=d[0]*I[0]+d[1]*I[1]+d[2]*I[2],K=d[0]*B[0]+d[1]*B[1]+d[2]*B[2];return W+C*H===N+C*K||B[3]*(N-W)+I[3]*(K-H)+N*K==W*H?null:(W+I[3]-C*K-C*B[3])/(W-N-C*K+C*H)}static getLesserNonNegativeNonNull(o,d){return d!==null&&d>=0&&d<o?d:o}}class Wg{constructor(o){this._globe=o,this._mercatorCameraHelper=new zi,this._verticalPerspectiveCameraHelper=new ns}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(o,d){return this.currentHelper.handlePanInertia(o,d)}handleMapControlsRollPitchBearingZoom(o,d){return this.currentHelper.handleMapControlsRollPitchBearingZoom(o,d)}handleMapControlsPan(o,d,y){this.currentHelper.handleMapControlsPan(o,d,y)}cameraForBoxAndBearing(o,d,y,w,C){return this.currentHelper.cameraForBoxAndBearing(o,d,y,w,C)}handleJumpToCenterZoom(o,d){this.currentHelper.handleJumpToCenterZoom(o,d)}handleEaseTo(o,d){return this.currentHelper.handleEaseTo(o,d)}handleFlyTo(o,d){return this.currentHelper.handleFlyTo(o,d)}}const kf=(E,o)=>s.y(E,o&&o.filter((d=>d.identifier!=="source.canvas"))),qg=s.bE();class Qd extends s.E{constructor(o,d={}){var y,w;super(),this._rtlPluginLoaded=()=>{for(const I in this.sourceCaches){const B=this.sourceCaches[I].getSource().type;B!=="vector"&&B!=="geojson"||this.sourceCaches[I].reload()}},this.map=o,this.dispatcher=new $t(At(),o._getMapId()),this.dispatcher.registerMessageHandler("GG",((I,B)=>this.getGlyphs(I,B))),this.dispatcher.registerMessageHandler("GI",((I,B)=>this.getImages(I,B))),this.dispatcher.registerMessageHandler("GDA",((I,B)=>this.getDashes(I,B))),this.imageManager=new Ze,this.imageManager.setEventedParent(this);const C=((y=o._container)===null||y===void 0?void 0:y.lang)||typeof document<"u"&&((w=document.documentElement)===null||w===void 0?void 0:w.lang)||void 0;this.glyphManager=new Lt(o._requestManager,d.localIdeographFontFamily,C),this.lineAtlas=new Ue(256,512),this.crossTileSymbolIndex=new Tc,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",s.bG()),ko().on(Ei,this._rtlPluginLoaded),this.on("data",(I=>{if(I.dataType!=="source"||I.sourceDataType!=="metadata")return;const B=this.sourceCaches[I.sourceId];if(!B)return;const N=B.getSource();if(N&&N.vectorLayerIds)for(const H in this._layers){const W=this._layers[H];W.source===N.id&&this._validateLayer(W)}}))}setGlobalStateProperty(o,d){var y,w,C;this._checkLoaded();const I=d===null?(C=(w=(y=this.stylesheet.state)===null||y===void 0?void 0:y[o])===null||w===void 0?void 0:w.default)!==null&&C!==void 0?C:null:d;if(s.bH(I,this._globalState[o]))return this;this._globalState[o]=I,this._applyGlobalStateChanges([o])}getGlobalState(){return this._globalState}setGlobalState(o){this._checkLoaded();const d=[];for(const y in o)!s.bH(this._globalState[y],o[y].default)&&(d.push(y),this._globalState[y]=o[y].default);this._applyGlobalStateChanges(d)}_applyGlobalStateChanges(o){if(o.length===0)return;const d=new Set,y={};for(const w of o){y[w]=this._globalState[w];for(const C in this._layers){const I=this._layers[C],B=I.getLayoutAffectingGlobalStateRefs(),N=I.getPaintAffectingGlobalStateRefs();if(B.has(w)&&d.add(I.source),N.has(w))for(const{name:H,value:W}of N.get(w))this._updatePaintProperty(I,H,W)}}this.dispatcher.broadcast("UGS",y);for(const w in this.sourceCaches)d.has(w)&&(this._reloadSource(w),this._changed=!0)}loadURL(o,d={},y){this.fire(new s.l("dataloading",{dataType:"style"})),d.validate=typeof d.validate!="boolean"||d.validate;const w=this.map._requestManager.transformRequest(o,"Style");this._loadStyleRequest=new AbortController;const C=this._loadStyleRequest;s.j(w,this._loadStyleRequest).then((I=>{this._loadStyleRequest=null,this._load(I.data,d,y)})).catch((I=>{this._loadStyleRequest=null,I&&!C.signal.aborted&&this.fire(new s.k(I))}))}loadJSON(o,d={},y){this.fire(new s.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,M.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,d.validate=d.validate!==!1,this._load(o,d,y)})).catch((()=>{}))}loadEmpty(){this.fire(new s.l("dataloading",{dataType:"style"})),this._load(qg,{validate:!1})}_load(o,d,y){var w,C;let I=d.transformStyle?d.transformStyle(y,o):o;if(!d.validate||!kf(this,s.z(I))){I=Object.assign({},I),this._loaded=!0,this.stylesheet=I;for(const B in I.sources)this.addSource(B,I.sources[B],{validate:!1});I.sprite?this._loadSprite(I.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(I.glyphs),this._createLayers(),this.light=new ce(this.stylesheet.light),this._setProjectionInternal(((w=this.stylesheet.projection)===null||w===void 0?void 0:w.type)||"mercator"),this.sky=new Re(this.stylesheet.sky),this.map.setTerrain((C=this.stylesheet.terrain)!==null&&C!==void 0?C:null),this.fire(new s.l("data",{dataType:"style"})),this.fire(new s.l("style.load"))}}_createLayers(){var o;const d=s.bI(this.stylesheet.layers);this.setGlobalState((o=this.stylesheet.state)!==null&&o!==void 0?o:null),this.dispatcher.broadcast("SL",d),this._order=d.map((y=>y.id)),this._layers={},this._serializedLayers=null;for(const y of d){const w=s.bJ(y,this._globalState);w.setEventedParent(this,{layer:{id:y.id}}),this._layers[y.id]=w}}_loadSprite(o,d=!1,y=void 0){let w;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(C,I,B,N){return s._(this,void 0,void 0,(function*(){const H=ge(C),W=B>1?"@2x":"",K={},Z={};for(const{id:te,url:oe}of H){const me=I.transformRequest(Le(oe,W,".json"),"SpriteJSON");K[te]=s.j(me,N);const ye=I.transformRequest(Le(oe,W,".png"),"SpriteImage");Z[te]=ae.getImage(ye,N)}return yield Promise.all([...Object.values(K),...Object.values(Z)]),(function(te,oe){return s._(this,void 0,void 0,(function*(){const me={};for(const ye in te){me[ye]={};const _e=M.getImageCanvasContext((yield oe[ye]).data),be=(yield te[ye]).data;for(const Ee in be){const{width:Te,height:Oe,x:Ne,y:Ce,sdf:ze,pixelRatio:ot,stretchX:tt,stretchY:nt,content:lt,textFitWidth:Nt,textFitHeight:Bt}=be[Ee];me[ye][Ee]={data:null,pixelRatio:ot,sdf:ze,stretchX:tt,stretchY:nt,content:lt,textFitWidth:Nt,textFitHeight:Bt,spriteData:{width:Te,height:Oe,x:Ne,y:Ce,context:_e}}}}return me}))})(K,Z)}))})(o,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((C=>{if(this._spriteRequest=null,C)for(const I in C){this._spritesImagesIds[I]=[];const B=this._spritesImagesIds[I]?this._spritesImagesIds[I].filter((N=>!(N in C))):[];for(const N of B)this.imageManager.removeImage(N),this._changedImages[N]=!0;for(const N in C[I]){const H=I==="default"?N:`${I}:${N}`;this._spritesImagesIds[I].push(H),H in this.imageManager.images?this.imageManager.updateImage(H,C[I][N],!1):this.imageManager.addImage(H,C[I][N]),d&&(this._changedImages[H]=!0)}}})).catch((C=>{this._spriteRequest=null,w=C,this.fire(new s.k(w))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),d&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"})),y&&y(w)}))}_unloadSprite(){for(const o of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(o),this._changedImages[o]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}_validateLayer(o){const d=this.sourceCaches[o.source];if(!d)return;const y=o.sourceLayer;if(!y)return;const w=d.getSource();(w.type==="geojson"||w.vectorLayerIds&&w.vectorLayerIds.indexOf(y)===-1)&&this.fire(new s.k(new Error(`Source layer "${y}" does not exist on source "${w.id}" as specified by style layer "${o.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(o,d=!1){const y=this._serializedAllLayers();if(!o||o.length===0)return Object.values(d?s.bK(y):y);const w=[];for(const C of o)if(y[C]){const I=d?s.bK(y[C]):y[C];w.push(I)}return w}_serializedAllLayers(){let o=this._serializedLayers;if(o)return o;o=this._serializedLayers={};const d=Object.keys(this._layers);for(const y of d){const w=this._layers[y];w.type!=="custom"&&(o[y]=w.serialize())}return o}hasTransitions(){var o,d,y;if(!((o=this.light)===null||o===void 0)&&o.hasTransition()||!((d=this.sky)===null||d===void 0)&&d.hasTransition()||!((y=this.projection)===null||y===void 0)&&y.hasTransition())return!0;for(const w in this.sourceCaches)if(this.sourceCaches[w].hasTransition())return!0;for(const w in this._layers)if(this._layers[w].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(o){if(!this._loaded)return;const d=this._changed;if(d){const w=Object.keys(this._updatedLayers),C=Object.keys(this._removedLayers);(w.length||C.length)&&this._updateWorkerLayers(w,C);for(const I in this._updatedSources){const B=this._updatedSources[I];if(B==="reload")this._reloadSource(I);else{if(B!=="clear")throw new Error(`Invalid action ${B}`);this._clearSource(I)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(o);this.light.updateTransitions(o),this.sky.updateTransitions(o),this._resetUpdates()}const y={};for(const w in this.sourceCaches){const C=this.sourceCaches[w];y[w]=C.used,C.used=!1}for(const w of this._order){const C=this._layers[w];C.recalculate(o,this._availableImages),!C.isHidden(o.zoom)&&C.source&&(this.sourceCaches[C.source].used=!0)}for(const w in y){const C=this.sourceCaches[w];!!y[w]!=!!C.used&&C.fire(new s.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:w}))}this.light.recalculate(o),this.sky.recalculate(o),this.projection.recalculate(o),this.z=o.zoom,d&&this.fire(new s.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(o,d){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(o,!1),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(o,d={}){var y;this._checkLoaded();const w=this.serialize();if(o=d.transformStyle?d.transformStyle(w,o):o,((y=d.validate)===null||y===void 0||y)&&kf(this,s.z(o)))return!1;(o=s.bK(o)).layers=s.bI(o.layers);const C=s.bL(w,o),I=this._getOperationsToPerform(C);if(I.unimplemented.length>0)throw new Error(`Unimplemented: ${I.unimplemented.join(", ")}.`);if(I.operations.length===0)return!1;for(const B of I.operations)B();return this.stylesheet=o,this._serializedLayers=null,!0}_getOperationsToPerform(o){const d=[],y=[];for(const w of o)switch(w.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":d.push((()=>this.addLayer.apply(this,w.args)));break;case"removeLayer":d.push((()=>this.removeLayer.apply(this,w.args)));break;case"setPaintProperty":d.push((()=>this.setPaintProperty.apply(this,w.args)));break;case"setLayoutProperty":d.push((()=>this.setLayoutProperty.apply(this,w.args)));break;case"setFilter":d.push((()=>this.setFilter.apply(this,w.args)));break;case"addSource":d.push((()=>this.addSource.apply(this,w.args)));break;case"removeSource":d.push((()=>this.removeSource.apply(this,w.args)));break;case"setLayerZoomRange":d.push((()=>this.setLayerZoomRange.apply(this,w.args)));break;case"setLight":d.push((()=>this.setLight.apply(this,w.args)));break;case"setGeoJSONSourceData":d.push((()=>this.setGeoJSONSourceData.apply(this,w.args)));break;case"setGlyphs":d.push((()=>this.setGlyphs.apply(this,w.args)));break;case"setSprite":d.push((()=>this.setSprite.apply(this,w.args)));break;case"setTerrain":d.push((()=>this.map.setTerrain.apply(this,w.args)));break;case"setSky":d.push((()=>this.setSky.apply(this,w.args)));break;case"setProjection":this.setProjection.apply(this,w.args);break;case"setGlobalState":d.push((()=>this.setGlobalState.apply(this,w.args)));break;case"setTransition":d.push((()=>{}));break;default:y.push(w.command)}return{operations:d,unimplemented:y}}addImage(o,d){if(this.getImage(o))return this.fire(new s.k(new Error(`An image named "${o}" already exists.`)));this.imageManager.addImage(o,d),this._afterImageUpdated(o)}updateImage(o,d){this.imageManager.updateImage(o,d)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new s.k(new Error(`An image named "${o}" does not exist.`)));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,d,y={}){if(this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error(`Source "${o}" already exists.`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(s.z.source,`sources.${o}`,d,null,y))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const w=this.sourceCaches[o]=new Ir(o,d,this.dispatcher);w.style=this,w.setEventedParent(this,(()=>({isSourceLoaded:w.loaded(),source:w.serialize(),sourceId:o}))),w.onAdd(this.map),this._changed=!0}removeSource(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===o)return this.fire(new s.k(new Error(`Source "${o}" cannot be removed while layer "${y}" is using it.`)));const d=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],d.fire(new s.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),d.setEventedParent(null),d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,d){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error(`There is no source with this ID=${o}`);const y=this.sourceCaches[o].getSource();if(y.type!=="geojson")throw new Error(`geojsonSource.type is ${y.type}, which is !== 'geojson`);y.setData(d),this._changed=!0}getSource(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()}addLayer(o,d,y={}){this._checkLoaded();const w=o.id;if(this.getLayer(w))return void this.fire(new s.k(new Error(`Layer "${w}" already exists on this map.`)));let C;if(o.type==="custom"){if(kf(this,s.bM(o)))return;C=s.bJ(o,this._globalState)}else{if("source"in o&&typeof o.source=="object"&&(this.addSource(w,o.source),o=s.bK(o),o=s.e(o,{source:w})),this._validate(s.z.layer,`layers.${w}`,o,{arrayIndex:-1},y))return;C=s.bJ(o,this._globalState),this._validateLayer(C),C.setEventedParent(this,{layer:{id:w}})}const I=d?this._order.indexOf(d):this._order.length;if(d&&I===-1)this.fire(new s.k(new Error(`Cannot add layer "${w}" before non-existing layer "${d}".`)));else{if(this._order.splice(I,0,w),this._layerOrderChanged=!0,this._layers[w]=C,this._removedLayers[w]&&C.source&&C.type!=="custom"){const B=this._removedLayers[w];delete this._removedLayers[w],B.type!==C.type?this._updatedSources[C.source]="clear":(this._updatedSources[C.source]="reload",this.sourceCaches[C.source].pause())}this._updateLayer(C),C.onAdd&&C.onAdd(this.map)}}moveLayer(o,d){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new s.k(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===d)return;const y=this._order.indexOf(o);this._order.splice(y,1);const w=d?this._order.indexOf(d):this._order.length;d&&w===-1?this.fire(new s.k(new Error(`Cannot move layer "${o}" before non-existing layer "${d}".`))):(this._order.splice(w,0,o),this._layerOrderChanged=!0)}removeLayer(o){this._checkLoaded();const d=this._layers[o];if(!d)return void this.fire(new s.k(new Error(`Cannot remove non-existing layer "${o}".`)));d.setEventedParent(null);const y=this._order.indexOf(o);this._order.splice(y,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=d,delete this._layers[o],this._serializedLayers&&delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],d.onRemove&&d.onRemove(this.map)}getLayer(o){return this._layers[o]}getLayersOrder(){return[...this._order]}hasLayer(o){return o in this._layers}setLayerZoomRange(o,d,y){this._checkLoaded();const w=this.getLayer(o);w?w.minzoom===d&&w.maxzoom===y||(d!=null&&(w.minzoom=d),y!=null&&(w.maxzoom=y),this._updateLayer(w)):this.fire(new s.k(new Error(`Cannot set the zoom range of non-existing layer "${o}".`)))}setFilter(o,d,y={}){this._checkLoaded();const w=this.getLayer(o);if(w){if(!s.bH(w.filter,d))return d==null?(w.setFilter(void 0),void this._updateLayer(w)):void(this._validate(s.z.filter,`layers.${w.id}.filter`,d,null,y)||(w.setFilter(s.bK(d)),this._updateLayer(w)))}else this.fire(new s.k(new Error(`Cannot filter non-existing layer "${o}".`)))}getFilter(o){return s.bK(this.getLayer(o).filter)}setLayoutProperty(o,d,y,w={}){this._checkLoaded();const C=this.getLayer(o);C?s.bH(C.getLayoutProperty(d),y)||(C.setLayoutProperty(d,y,w),this._updateLayer(C)):this.fire(new s.k(new Error(`Cannot style non-existing layer "${o}".`)))}getLayoutProperty(o,d){const y=this.getLayer(o);if(y)return y.getLayoutProperty(d);this.fire(new s.k(new Error(`Cannot get style of non-existing layer "${o}".`)))}setPaintProperty(o,d,y,w={}){this._checkLoaded();const C=this.getLayer(o);C?s.bH(C.getPaintProperty(d),y)||this._updatePaintProperty(C,d,y,w):this.fire(new s.k(new Error(`Cannot style non-existing layer "${o}".`)))}_updatePaintProperty(o,d,y,w={}){o.setPaintProperty(d,y,w)&&this._updateLayer(o),this._changed=!0,this._updatedPaintProps[o.id]=!0,this._serializedLayers=null}getPaintProperty(o,d){return this.getLayer(o).getPaintProperty(d)}setFeatureState(o,d){this._checkLoaded();const y=o.source,w=o.sourceLayer,C=this.sourceCaches[y];if(C===void 0)return void this.fire(new s.k(new Error(`The source '${y}' does not exist in the map's style.`)));const I=C.getSource().type;I==="geojson"&&w?this.fire(new s.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):I!=="vector"||w?(o.id===void 0&&this.fire(new s.k(new Error("The feature id parameter must be provided."))),C.setFeatureState(w,o.id,d)):this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(o,d){this._checkLoaded();const y=o.source,w=this.sourceCaches[y];if(w===void 0)return void this.fire(new s.k(new Error(`The source '${y}' does not exist in the map's style.`)));const C=w.getSource().type,I=C==="vector"?o.sourceLayer:void 0;C!=="vector"||I?d&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new s.k(new Error("A feature id is required to remove its specific state property."))):w.removeFeatureState(I,o.id,d):this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(o){this._checkLoaded();const d=o.source,y=o.sourceLayer,w=this.sourceCaches[d];if(w!==void 0)return w.getSource().type!=="vector"||y?(o.id===void 0&&this.fire(new s.k(new Error("The feature id parameter must be provided."))),w.getFeatureState(y,o.id)):void this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.k(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const o=s.bN(this.sourceCaches,(C=>C.serialize())),d=this._serializeByIds(this._order,!0),y=this.map.getTerrain()||void 0,w=this.stylesheet;return s.bO({version:w.version,name:w.name,metadata:w.metadata,light:w.light,sky:w.sky,center:w.center,zoom:w.zoom,bearing:w.bearing,pitch:w.pitch,sprite:w.sprite,glyphs:w.glyphs,transition:w.transition,projection:w.projection,sources:o,layers:d,terrain:y},(C=>C!==void 0))}_updateLayer(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(o){const d=I=>this._layers[I].type==="fill-extrusion",y={},w=[];for(let I=this._order.length-1;I>=0;I--){const B=this._order[I];if(d(B)){y[B]=I;for(const N of o){const H=N[B];if(H)for(const W of H)w.push(W)}}}w.sort(((I,B)=>B.intersectionZ-I.intersectionZ));const C=[];for(let I=this._order.length-1;I>=0;I--){const B=this._order[I];if(d(B))for(let N=w.length-1;N>=0;N--){const H=w[N].feature;if(y[H.layer.id]<I)break;C.push(H),w.pop()}else for(const N of o){const H=N[B];if(H)for(const W of H)C.push(W.feature)}}return C}queryRenderedFeatures(o,d,y){d&&d.filter&&this._validate(s.z.filter,"queryRenderedFeatures.filter",d.filter,null,d);const w={};if(d&&d.layers){if(!(Array.isArray(d.layers)||d.layers instanceof Set))return this.fire(new s.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const H of d.layers){const W=this._layers[H];if(!W)return this.fire(new s.k(new Error(`The layer '${H}' does not exist in the map's style and cannot be queried for features.`))),[];w[W.source]=!0}}const C=[];d.availableImages=this._availableImages;const I=this._serializedAllLayers(),B=d.layers instanceof Set?d.layers:Array.isArray(d.layers)?new Set(d.layers):null,N=Object.assign(Object.assign({},d),{layers:B,globalState:this._globalState});for(const H in this.sourceCaches)d.layers&&!w[H]||C.push(Et(this.sourceCaches[H],this._layers,I,o,N,y,this.map.terrain?(W,K,Z)=>this.map.terrain.getElevation(W,K,Z):void 0));return this.placement&&C.push((function(H,W,K,Z,te,oe,me){const ye={},_e=oe.queryRenderedSymbols(Z),be=[];for(const Ee of Object.keys(_e).map(Number))be.push(me[Ee]);be.sort(Wt);for(const Ee of be){const Te=Ee.featureIndex.lookupSymbolFeatures(_e[Ee.bucketInstanceId],W,Ee.bucketIndex,Ee.sourceLayerIndex,{filterSpec:te.filter,globalState:te.globalState},te.layers,te.availableImages,H);for(const Oe in Te){const Ne=ye[Oe]=ye[Oe]||[],Ce=Te[Oe];Ce.sort(((ze,ot)=>{const tt=Ee.featureSortOrder;if(tt){const nt=tt.indexOf(ze.featureIndex);return tt.indexOf(ot.featureIndex)-nt}return ot.featureIndex-ze.featureIndex}));for(const ze of Ce)Ne.push(ze)}}return(function(Ee,Te,Oe){for(const Ne in Ee)for(const Ce of Ee[Ne])mr(Ce,Oe[Te[Ne].source]);return Ee})(ye,H,K)})(this._layers,I,this.sourceCaches,o,N,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(C)}querySourceFeatures(o,d){d?.filter&&this._validate(s.z.filter,"querySourceFeatures.filter",d.filter,null,d);const y=this.sourceCaches[o];return y?(function(w,C){const I=w.getRenderableIds().map((H=>w.getTileByID(H))),B=[],N={};for(let H=0;H<I.length;H++){const W=I[H],K=W.tileID.canonical.key;N[K]||(N[K]=!0,W.querySourceFeatures(B,C))}return B})(y,d?Object.assign(Object.assign({},d),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(o,d={}){this._checkLoaded();const y=this.light.getLight();let w=!1;for(const I in o)if(!s.bH(o[I],y[I])){w=!0;break}if(!w)return;const C={now:M.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,d),this.light.updateTransitions(C)}getProjection(){var o;return(o=this.stylesheet)===null||o===void 0?void 0:o.projection}setProjection(o){if(this._checkLoaded(),this.projection){if(this.projection.name===o.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=o,this._setProjectionInternal(o.type)}getSky(){var o;return(o=this.stylesheet)===null||o===void 0?void 0:o.sky}setSky(o,d={}){this._checkLoaded();const y=this.getSky();let w=!1;if(!o&&!y)return;if(o&&!y)w=!0;else if(!o&&y)w=!0;else for(const I in o)if(!s.bH(o[I],y[I])){w=!0;break}if(!w)return;const C={now:M.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=o,this.sky.setSky(o,d),this.sky.updateTransitions(C)}_setProjectionInternal(o){const d=(function(y){if(Array.isArray(y)){const w=new mu({type:y});return{projection:w,transform:new Ec,cameraHelper:new Wg(w)}}switch(y){case"mercator":return{projection:new Lr,transform:new nn,cameraHelper:new zi};case"globe":{const w=new mu({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:w,transform:new Ec,cameraHelper:new Wg(w)}}case"vertical-perspective":return{projection:new gh,transform:new bh,cameraHelper:new ns};default:return s.w(`Unknown projection name: ${y}. Falling back to mercator projection.`),{projection:new Lr,transform:new nn,cameraHelper:new zi}}})(o);this.projection=d.projection,this.map.migrateProjection(d.transform,d.cameraHelper);for(const y in this.sourceCaches)this.sourceCaches[y].reload()}_validate(o,d,y,w,C={}){return(!C||C.validate!==!1)&&kf(this,o.call(s.z,s.e({key:d,style:this.serialize(),value:y,styleSpec:s.v},w)))}_remove(o=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ko().off(Ei,this._rtlPluginLoaded);for(const d in this._layers)this._layers[d].setEventedParent(null);for(const d in this.sourceCaches){const y=this.sourceCaches[d];y.setEventedParent(null),y.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),o&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(o)}_clearSource(o){this.sourceCaches[o].clearTiles()}_reloadSource(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()}_updateSources(o){for(const d in this.sourceCaches)this.sourceCaches[d].update(o,this.map.terrain)}_generateCollisionBoxes(){for(const o in this.sourceCaches)this._reloadSource(o)}_updatePlacement(o,d,y,w,C=!1){let I=!1,B=!1;const N={};for(const H of this._order){const W=this._layers[H];if(W.type!=="symbol")continue;if(!N[W.source]){const Z=this.sourceCaches[W.source];N[W.source]=Z.getRenderableIds(!0).map((te=>Z.getTileByID(te))).sort(((te,oe)=>oe.tileID.overscaledZ-te.tileID.overscaledZ||(te.tileID.isLessThan(oe.tileID)?-1:1)))}const K=this.crossTileSymbolIndex.addLayer(W,N[W.source],o.center.lng);I=I||K}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((C=C||this._layerOrderChanged||y===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(M.now(),o.zoom))&&(this.pauseablePlacement=new Ls(o,this.map.terrain,this._order,C,d,y,w,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,N),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(M.now()),B=!0),I&&this.pauseablePlacement.placement.setStale()),B||I)for(const H of this._order){const W=this._layers[H];W.type==="symbol"&&this.placement.updateLayerOpacities(W,N[W.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(M.now())}_releaseSymbolFadeTiles(){for(const o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,d){return s._(this,void 0,void 0,(function*(){const y=yield this.imageManager.getImages(d.icons);this._updateTilesForChangedImages();const w=this.sourceCaches[d.source];return w&&w.setDependencies(d.tileID.key,d.type,d.icons),y}))}getGlyphs(o,d){return s._(this,void 0,void 0,(function*(){const y=yield this.glyphManager.getGlyphs(d.stacks),w=this.sourceCaches[d.source];return w&&w.setDependencies(d.tileID.key,d.type,[""]),y}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(o,d={}){this._checkLoaded(),o&&this._validate(s.z.glyphs,"glyphs",o,null,d)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=o,this.glyphManager.entries={},this.glyphManager.setURL(o))}getDashes(o,d){return s._(this,void 0,void 0,(function*(){const y={};for(const[w,C]of Object.entries(d.dashes))y[w]=this.lineAtlas.getDash(C.dasharray,C.round);return y}))}addSprite(o,d,y={},w){this._checkLoaded();const C=[{id:o,url:d}],I=[...ge(this.stylesheet.sprite),...C];this._validate(s.z.sprite,"sprite",I,null,y)||(this.stylesheet.sprite=I,this._loadSprite(C,!0,w))}removeSprite(o){this._checkLoaded();const d=ge(this.stylesheet.sprite);if(d.find((y=>y.id===o))){if(this._spritesImagesIds[o])for(const y of this._spritesImagesIds[o])this.imageManager.removeImage(y),this._changedImages[y]=!0;d.splice(d.findIndex((y=>y.id===o)),1),this.stylesheet.sprite=d.length>0?d:void 0,delete this._spritesImagesIds[o],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}else this.fire(new s.k(new Error(`Sprite "${o}" doesn't exists on this map.`)))}getSprite(){return ge(this.stylesheet.sprite)}setSprite(o,d={},y){this._checkLoaded(),o&&this._validate(s.z.sprite,"sprite",o,null,d)||(this.stylesheet.sprite=o,o?this._loadSprite(o,!0,y):(this._unloadSprite(),y&&y(null)))}}var Yy=s.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ky{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,d,y,w,C,I,B,N,H){this.context=o;let W=this.boundPaintVertexBuffers.length!==w.length;for(let K=0;!W&&K<w.length;K++)this.boundPaintVertexBuffers[K]!==w[K]&&(W=!0);!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==y||W||this.boundIndexBuffer!==C||this.boundVertexOffset!==I||this.boundDynamicVertexBuffer!==B||this.boundDynamicVertexBuffer2!==N||this.boundDynamicVertexBuffer3!==H?this.freshBind(d,y,w,C,I,B,N,H):(o.bindVertexArray.set(this.vao),B&&B.bind(),C&&C.dynamicDraw&&C.bind(),N&&N.bind(),H&&H.bind())}freshBind(o,d,y,w,C,I,B,N){const H=o.numAttributes,W=this.context,K=W.gl;this.vao&&this.destroy(),this.vao=W.createVertexArray(),W.bindVertexArray.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=w,this.boundVertexOffset=C,this.boundDynamicVertexBuffer=I,this.boundDynamicVertexBuffer2=B,this.boundDynamicVertexBuffer3=N,d.enableAttributes(K,o);for(const Z of y)Z.enableAttributes(K,o);I&&I.enableAttributes(K,o),B&&B.enableAttributes(K,o),N&&N.enableAttributes(K,o),d.bind(),d.setVertexAttribPointers(K,o,C);for(const Z of y)Z.bind(),Z.setVertexAttribPointers(K,o,C);I&&(I.bind(),I.setVertexAttribPointers(K,o,C)),w&&w.bind(),B&&(B.bind(),B.setVertexAttribPointers(K,o,C)),N&&(N.bind(),N.setVertexAttribPointers(K,o,C)),W.currentNumAttributes=H}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Df=(E,o,d,y,w)=>({u_texture:0,u_ele_delta:E,u_fog_matrix:o,u_fog_color:d?d.properties.get("fog-color"):s.bf.white,u_fog_ground_blend:d?d.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:w?0:d?d.calculateFogBlendOpacity(y):0,u_horizon_color:d?d.properties.get("horizon-color"):s.bf.white,u_horizon_fog_blend:d?d.properties.get("horizon-fog-blend"):1,u_is_globe_mode:w?1:0}),Jd={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Cc(E){const o=[];for(let d=0;d<E.length;d++){if(E[d]===null)continue;const y=E[d].split(" ");o.push(y.pop())}return o}class ep{constructor(o,d,y,w,C,I,B,N,H=[]){const W=o.gl;this.program=W.createProgram();const K=Cc(d.staticAttributes),Z=y?y.getBinderAttributes():[],te=K.concat(Z),oe=ts.prelude.staticUniforms?Cc(ts.prelude.staticUniforms):[],me=B.staticUniforms?Cc(B.staticUniforms):[],ye=d.staticUniforms?Cc(d.staticUniforms):[],_e=y?y.getBinderUniforms():[],be=oe.concat(me).concat(ye).concat(_e),Ee=[];for(const tt of be)Ee.indexOf(tt)<0&&Ee.push(tt);const Te=y?y.defines():[];Ba(W)&&Te.unshift("#version 300 es"),C&&Te.push("#define OVERDRAW_INSPECTOR;"),I&&Te.push("#define TERRAIN3D;"),N&&Te.push(N),H&&Te.push(...H);let Oe=Te.concat(ts.prelude.fragmentSource,B.fragmentSource,d.fragmentSource).join(`
`),Ne=Te.concat(ts.prelude.vertexSource,B.vertexSource,d.vertexSource).join(`
`);Ba(W)||(Oe=(function(tt){return tt.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(Oe),Ne=(function(tt){return tt.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(Ne));const Ce=W.createShader(W.FRAGMENT_SHADER);if(W.isContextLost())return void(this.failedToCreate=!0);if(W.shaderSource(Ce,Oe),W.compileShader(Ce),!W.getShaderParameter(Ce,W.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${W.getShaderInfoLog(Ce)}`);W.attachShader(this.program,Ce);const ze=W.createShader(W.VERTEX_SHADER);if(W.isContextLost())return void(this.failedToCreate=!0);if(W.shaderSource(ze,Ne),W.compileShader(ze),!W.getShaderParameter(ze,W.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${W.getShaderInfoLog(ze)}`);W.attachShader(this.program,ze),this.attributes={};const ot={};this.numAttributes=te.length;for(let tt=0;tt<this.numAttributes;tt++)te[tt]&&(W.bindAttribLocation(this.program,tt,te[tt]),this.attributes[te[tt]]=tt);if(W.linkProgram(this.program),!W.getProgramParameter(this.program,W.LINK_STATUS))throw new Error(`Program failed to link: ${W.getProgramInfoLog(this.program)}`);W.deleteShader(ze),W.deleteShader(Ce);for(let tt=0;tt<Ee.length;tt++){const nt=Ee[tt];if(nt&&!ot[nt]){const lt=W.getUniformLocation(this.program,nt);lt&&(ot[nt]=lt)}}this.fixedUniforms=w(o,ot),this.terrainUniforms=((tt,nt)=>({u_depth:new s.bP(tt,nt.u_depth),u_terrain:new s.bP(tt,nt.u_terrain),u_terrain_dim:new s.bg(tt,nt.u_terrain_dim),u_terrain_matrix:new s.bR(tt,nt.u_terrain_matrix),u_terrain_unpack:new s.bS(tt,nt.u_terrain_unpack),u_terrain_exaggeration:new s.bg(tt,nt.u_terrain_exaggeration)}))(o,ot),this.projectionUniforms=((tt,nt)=>({u_projection_matrix:new s.bR(tt,nt.u_projection_matrix),u_projection_tile_mercator_coords:new s.bS(tt,nt.u_projection_tile_mercator_coords),u_projection_clipping_plane:new s.bS(tt,nt.u_projection_clipping_plane),u_projection_transition:new s.bg(tt,nt.u_projection_transition),u_projection_fallback_matrix:new s.bR(tt,nt.u_projection_fallback_matrix)}))(o,ot),this.binderUniforms=y?y.getUniforms(o,ot):[]}draw(o,d,y,w,C,I,B,N,H,W,K,Z,te,oe,me,ye,_e,be,Ee){const Te=o.gl;if(this.failedToCreate)return;if(o.program.set(this.program),o.setDepthMode(y),o.setStencilMode(w),o.setColorMode(C),o.setCullFace(I),N){o.activeTexture.set(Te.TEXTURE2),Te.bindTexture(Te.TEXTURE_2D,N.depthTexture),o.activeTexture.set(Te.TEXTURE3),Te.bindTexture(Te.TEXTURE_2D,N.texture);for(const Ne in this.terrainUniforms)this.terrainUniforms[Ne].set(N[Ne])}if(H)for(const Ne in H)this.projectionUniforms[Jd[Ne]].set(H[Ne]);if(B)for(const Ne in this.fixedUniforms)this.fixedUniforms[Ne].set(B[Ne]);ye&&ye.setUniforms(o,this.binderUniforms,oe,{zoom:me});let Oe=0;switch(d){case Te.LINES:Oe=2;break;case Te.TRIANGLES:Oe=3;break;case Te.LINE_STRIP:Oe=1}for(const Ne of te.get()){const Ce=Ne.vaos||(Ne.vaos={});(Ce[W]||(Ce[W]=new Ky)).bind(o,this,K,ye?ye.getPaintVertexBuffers():[],Z,Ne.vertexOffset,_e,be,Ee),Te.drawElements(d,Ne.primitiveLength*Oe,Te.UNSIGNED_SHORT,Ne.primitiveOffset*Oe*2)}}}function Lf(E,o,d){const y=1/s.aC(d,1,o.transform.tileZoom),w=Math.pow(2,d.tileID.overscaledZ),C=d.tileSize*Math.pow(2,o.transform.tileZoom)/w,I=C*(d.tileID.canonical.x+d.tileID.wrap*w),B=C*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[y,E.fromScale,E.toScale],u_fade:E.t,u_pixel_coord_upper:[I>>16,B>>16],u_pixel_coord_lower:[65535&I,65535&B]}}const Na=(E,o,d,y)=>{const w=E.style.light,C=w.properties.get("position"),I=[C.x,C.y,C.z],B=s.bV();w.properties.get("anchor")==="viewport"&&s.bW(B,E.transform.bearingInRadians),s.bX(I,I,B);const N=E.transform.transformLightDirection(I),H=w.properties.get("color");return{u_lightpos:I,u_lightpos_globe:N,u_lightintensity:w.properties.get("intensity"),u_lightcolor:[H.r,H.g,H.b],u_vertical_gradient:+o,u_opacity:d,u_fill_translate:y}},tp=(E,o,d,y,w,C,I)=>s.e(Na(E,o,d,y),Lf(C,E,I),{u_height_factor:-Math.pow(2,w.overscaledZ)/I.tileSize/8}),Dl=(E,o,d,y)=>s.e(Lf(o,E,d),{u_fill_translate:y}),xh=(E,o)=>({u_world:E,u_fill_translate:o}),vu=(E,o,d,y,w)=>s.e(Dl(E,o,d,w),{u_world:y}),Gg=(E,o,d,y,w)=>{const C=E.transform;let I,B,N=0;if(d.paint.get("circle-pitch-alignment")==="map"){const H=s.aC(o,1,C.zoom);I=!0,B=[H,H],N=H/(s.$*Math.pow(2,o.tileID.overscaledZ))*2*Math.PI*w}else I=!1,B=C.pixelsToGLUnits;return{u_camera_to_center_distance:C.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+I,u_device_pixel_ratio:E.pixelRatio,u_extrude_scale:B,u_globe_extrude_scale:N,u_translate:y}},wh=E=>({u_pixel_extrude_scale:[1/E.width,1/E.height]}),Xg=E=>({u_viewport_size:[E.width,E.height]}),Ll=(E,o=1)=>({u_color:E,u_overlay:0,u_overlay_scale:o}),Pc=(E,o,d,y)=>{const w=s.aC(E,1,o)/(s.$*Math.pow(2,E.tileID.overscaledZ))*2*Math.PI*y;return{u_extrude_scale:s.aC(E,1,o),u_intensity:d,u_globe_extrude_scale:w}},rp=(E,o,d,y)=>{const w=s.L();s.bY(w,0,E.width,E.height,0,0,1);const C=E.context.gl;return{u_matrix:w,u_world:[C.drawingBufferWidth,C.drawingBufferHeight],u_image:d,u_color_ramp:y,u_opacity:o.paint.get("heatmap-opacity")}},Qy=(E,o,d)=>{const y=d.paint.get("hillshade-accent-color");let w;switch(d.paint.get("hillshade-method")){case"basic":w=4;break;case"combined":w=1;break;case"igor":w=2;break;case"multidirectional":w=3;break;default:w=0}const C=d.getIlluminationProperties();for(let I=0;I<C.directionRadians.length;I++)d.paint.get("hillshade-illumination-anchor")==="viewport"&&(C.directionRadians[I]+=E.transform.bearingInRadians);return{u_image:0,u_latrange:Bf(0,o.tileID),u_exaggeration:d.paint.get("hillshade-exaggeration"),u_altitudes:C.altitudeRadians,u_azimuths:C.directionRadians,u_accent:y,u_method:w,u_highlights:C.highlightColor,u_shadows:C.shadowColor}},Zg=(E,o)=>{const d=o.stride,y=s.L();return s.bY(y,0,s.$,-s.$,0,0,1),s.M(y,y,[0,-s.$,0]),{u_matrix:y,u_image:1,u_dimension:[d,d],u_zoom:E.overscaledZ,u_unpack:o.getUnpackVector()}};function Bf(E,o){const d=Math.pow(2,o.canonical.z),y=o.canonical.y;return[new s.a1(0,y/d).toLngLat().lat,new s.a1(0,(y+1)/d).toLngLat().lat]}const np=(E,o,d=0)=>({u_image:0,u_unpack:o.getUnpackVector(),u_dimension:[o.stride,o.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:d,u_opacity:E.paint.get("color-relief-opacity")}),Bl=(E,o,d,y)=>{const w=E.transform;return{u_translation:zf(E,o,d),u_ratio:y/s.aC(o,1,w.zoom),u_device_pixel_ratio:E.pixelRatio,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]]}},bu=(E,o,d,y,w)=>s.e(Bl(E,o,d,y),{u_image:0,u_image_height:w}),Yg=(E,o,d,y,w)=>{const C=E.transform,I=Nf(o,C);return{u_translation:zf(E,o,d),u_texsize:o.imageAtlasTexture.size,u_ratio:y/s.aC(o,1,C.zoom),u_device_pixel_ratio:E.pixelRatio,u_image:0,u_scale:[I,w.fromScale,w.toScale],u_fade:w.t,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]]}},so=(E,o,d,y,w)=>{const C=Nf(o,E.transform);return s.e(Bl(E,o,d,y),{u_tileratio:C,u_crossfade_from:w.fromScale,u_crossfade_to:w.toScale,u_image:0,u_mix:w.t,u_lineatlas_width:E.lineAtlas.width,u_lineatlas_height:E.lineAtlas.height})};function Nf(E,o){return 1/s.aC(E,1,o.tileZoom)}function zf(E,o,d){return s.aD(E.transform,o,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const Mc=(E,o,d,y,w)=>{return{u_tl_parent:E,u_scale_parent:o,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(I=y.paint.get("raster-saturation"),I>0?1-1/(1.001-I):-I),u_contrast_factor:(C=y.paint.get("raster-contrast"),C>0?1/(1-C):1+C),u_spin_weights:ip(y.paint.get("raster-hue-rotate")),u_coords_top:[w[0].x,w[0].y,w[1].x,w[1].y],u_coords_bottom:[w[3].x,w[3].y,w[2].x,w[2].y]};var C,I};function ip(E){E*=Math.PI/180;const o=Math.sin(E),d=Math.cos(E);return[(2*d+1)/3,(-Math.sqrt(3)*o-d+1)/3,(Math.sqrt(3)*o-d+1)/3]}const xu=(E,o,d,y,w,C,I,B,N,H,W,K,Z)=>{const te=I.transform;return{u_is_size_zoom_constant:+(E==="constant"||E==="source"),u_is_size_feature_constant:+(E==="constant"||E==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:te.cameraToCenterDistance,u_pitch:te.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:te.width/te.height,u_fade_change:I.options.fadeDuration?I.symbolFadeChange:1,u_label_plane_matrix:B,u_coord_matrix:N,u_is_text:+W,u_pitch_with_map:+y,u_is_along_line:w,u_is_variable_anchor:C,u_texsize:K,u_texture:0,u_translation:H,u_pitched_scale:Z}},sp=(E,o,d,y,w,C,I,B,N,H,W,K,Z,te)=>{const oe=I.transform;return s.e(xu(E,o,d,y,w,C,I,B,N,H,W,K,te),{u_gamma_scale:y?Math.cos(oe.pitch*Math.PI/180)*oe.cameraToCenterDistance:1,u_device_pixel_ratio:I.pixelRatio,u_is_halo:1})},Kg=(E,o,d,y,w,C,I,B,N,H,W,K,Z)=>s.e(sp(E,o,d,y,w,C,I,B,N,H,!0,W,0,Z),{u_texsize_icon:K,u_texture_icon:1}),Qg=(E,o)=>({u_opacity:E,u_color:o}),Jg=(E,o,d,y,w)=>s.e((function(C,I,B,N){const H=B.imageManager.getPattern(C.from.toString()),W=B.imageManager.getPattern(C.to.toString()),{width:K,height:Z}=B.imageManager.getPixelSize(),te=Math.pow(2,N.tileID.overscaledZ),oe=N.tileSize*Math.pow(2,B.transform.tileZoom)/te,me=oe*(N.tileID.canonical.x+N.tileID.wrap*te),ye=oe*N.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:H.tl,u_pattern_br_a:H.br,u_pattern_tl_b:W.tl,u_pattern_br_b:W.br,u_texsize:[K,Z],u_mix:I.t,u_pattern_size_a:H.displaySize,u_pattern_size_b:W.displaySize,u_scale_a:I.fromScale,u_scale_b:I.toScale,u_tile_units_to_pixels:1/s.aC(N,1,B.transform.tileZoom),u_pixel_coord_upper:[me>>16,ye>>16],u_pixel_coord_lower:[65535&me,65535&ye]}})(d,w,o,y),{u_opacity:E}),ap=(E,o)=>{},op={fillExtrusion:(E,o)=>({u_lightpos:new s.bT(E,o.u_lightpos),u_lightpos_globe:new s.bT(E,o.u_lightpos_globe),u_lightintensity:new s.bg(E,o.u_lightintensity),u_lightcolor:new s.bT(E,o.u_lightcolor),u_vertical_gradient:new s.bg(E,o.u_vertical_gradient),u_opacity:new s.bg(E,o.u_opacity),u_fill_translate:new s.bU(E,o.u_fill_translate)}),fillExtrusionPattern:(E,o)=>({u_lightpos:new s.bT(E,o.u_lightpos),u_lightpos_globe:new s.bT(E,o.u_lightpos_globe),u_lightintensity:new s.bg(E,o.u_lightintensity),u_lightcolor:new s.bT(E,o.u_lightcolor),u_vertical_gradient:new s.bg(E,o.u_vertical_gradient),u_height_factor:new s.bg(E,o.u_height_factor),u_opacity:new s.bg(E,o.u_opacity),u_fill_translate:new s.bU(E,o.u_fill_translate),u_image:new s.bP(E,o.u_image),u_texsize:new s.bU(E,o.u_texsize),u_pixel_coord_upper:new s.bU(E,o.u_pixel_coord_upper),u_pixel_coord_lower:new s.bU(E,o.u_pixel_coord_lower),u_scale:new s.bT(E,o.u_scale),u_fade:new s.bg(E,o.u_fade)}),fill:(E,o)=>({u_fill_translate:new s.bU(E,o.u_fill_translate)}),fillPattern:(E,o)=>({u_image:new s.bP(E,o.u_image),u_texsize:new s.bU(E,o.u_texsize),u_pixel_coord_upper:new s.bU(E,o.u_pixel_coord_upper),u_pixel_coord_lower:new s.bU(E,o.u_pixel_coord_lower),u_scale:new s.bT(E,o.u_scale),u_fade:new s.bg(E,o.u_fade),u_fill_translate:new s.bU(E,o.u_fill_translate)}),fillOutline:(E,o)=>({u_world:new s.bU(E,o.u_world),u_fill_translate:new s.bU(E,o.u_fill_translate)}),fillOutlinePattern:(E,o)=>({u_world:new s.bU(E,o.u_world),u_image:new s.bP(E,o.u_image),u_texsize:new s.bU(E,o.u_texsize),u_pixel_coord_upper:new s.bU(E,o.u_pixel_coord_upper),u_pixel_coord_lower:new s.bU(E,o.u_pixel_coord_lower),u_scale:new s.bT(E,o.u_scale),u_fade:new s.bg(E,o.u_fade),u_fill_translate:new s.bU(E,o.u_fill_translate)}),circle:(E,o)=>({u_camera_to_center_distance:new s.bg(E,o.u_camera_to_center_distance),u_scale_with_map:new s.bP(E,o.u_scale_with_map),u_pitch_with_map:new s.bP(E,o.u_pitch_with_map),u_extrude_scale:new s.bU(E,o.u_extrude_scale),u_device_pixel_ratio:new s.bg(E,o.u_device_pixel_ratio),u_globe_extrude_scale:new s.bg(E,o.u_globe_extrude_scale),u_translate:new s.bU(E,o.u_translate)}),collisionBox:(E,o)=>({u_pixel_extrude_scale:new s.bU(E,o.u_pixel_extrude_scale)}),collisionCircle:(E,o)=>({u_viewport_size:new s.bU(E,o.u_viewport_size)}),debug:(E,o)=>({u_color:new s.bQ(E,o.u_color),u_overlay:new s.bP(E,o.u_overlay),u_overlay_scale:new s.bg(E,o.u_overlay_scale)}),depth:ap,clippingMask:ap,heatmap:(E,o)=>({u_extrude_scale:new s.bg(E,o.u_extrude_scale),u_intensity:new s.bg(E,o.u_intensity),u_globe_extrude_scale:new s.bg(E,o.u_globe_extrude_scale)}),heatmapTexture:(E,o)=>({u_matrix:new s.bR(E,o.u_matrix),u_world:new s.bU(E,o.u_world),u_image:new s.bP(E,o.u_image),u_color_ramp:new s.bP(E,o.u_color_ramp),u_opacity:new s.bg(E,o.u_opacity)}),hillshade:(E,o)=>({u_image:new s.bP(E,o.u_image),u_latrange:new s.bU(E,o.u_latrange),u_exaggeration:new s.bg(E,o.u_exaggeration),u_altitudes:new s.b_(E,o.u_altitudes),u_azimuths:new s.b_(E,o.u_azimuths),u_accent:new s.bQ(E,o.u_accent),u_method:new s.bP(E,o.u_method),u_shadows:new s.bZ(E,o.u_shadows),u_highlights:new s.bZ(E,o.u_highlights)}),hillshadePrepare:(E,o)=>({u_matrix:new s.bR(E,o.u_matrix),u_image:new s.bP(E,o.u_image),u_dimension:new s.bU(E,o.u_dimension),u_zoom:new s.bg(E,o.u_zoom),u_unpack:new s.bS(E,o.u_unpack)}),colorRelief:(E,o)=>({u_image:new s.bP(E,o.u_image),u_unpack:new s.bS(E,o.u_unpack),u_dimension:new s.bU(E,o.u_dimension),u_elevation_stops:new s.bP(E,o.u_elevation_stops),u_color_stops:new s.bP(E,o.u_color_stops),u_color_ramp_size:new s.bP(E,o.u_color_ramp_size),u_opacity:new s.bg(E,o.u_opacity)}),line:(E,o)=>({u_translation:new s.bU(E,o.u_translation),u_ratio:new s.bg(E,o.u_ratio),u_device_pixel_ratio:new s.bg(E,o.u_device_pixel_ratio),u_units_to_pixels:new s.bU(E,o.u_units_to_pixels)}),lineGradient:(E,o)=>({u_translation:new s.bU(E,o.u_translation),u_ratio:new s.bg(E,o.u_ratio),u_device_pixel_ratio:new s.bg(E,o.u_device_pixel_ratio),u_units_to_pixels:new s.bU(E,o.u_units_to_pixels),u_image:new s.bP(E,o.u_image),u_image_height:new s.bg(E,o.u_image_height)}),linePattern:(E,o)=>({u_translation:new s.bU(E,o.u_translation),u_texsize:new s.bU(E,o.u_texsize),u_ratio:new s.bg(E,o.u_ratio),u_device_pixel_ratio:new s.bg(E,o.u_device_pixel_ratio),u_image:new s.bP(E,o.u_image),u_units_to_pixels:new s.bU(E,o.u_units_to_pixels),u_scale:new s.bT(E,o.u_scale),u_fade:new s.bg(E,o.u_fade)}),lineSDF:(E,o)=>({u_translation:new s.bU(E,o.u_translation),u_ratio:new s.bg(E,o.u_ratio),u_device_pixel_ratio:new s.bg(E,o.u_device_pixel_ratio),u_units_to_pixels:new s.bU(E,o.u_units_to_pixels),u_image:new s.bP(E,o.u_image),u_mix:new s.bg(E,o.u_mix),u_tileratio:new s.bg(E,o.u_tileratio),u_crossfade_from:new s.bg(E,o.u_crossfade_from),u_crossfade_to:new s.bg(E,o.u_crossfade_to),u_lineatlas_width:new s.bg(E,o.u_lineatlas_width),u_lineatlas_height:new s.bg(E,o.u_lineatlas_height)}),raster:(E,o)=>({u_tl_parent:new s.bU(E,o.u_tl_parent),u_scale_parent:new s.bg(E,o.u_scale_parent),u_buffer_scale:new s.bg(E,o.u_buffer_scale),u_fade_t:new s.bg(E,o.u_fade_t),u_opacity:new s.bg(E,o.u_opacity),u_image0:new s.bP(E,o.u_image0),u_image1:new s.bP(E,o.u_image1),u_brightness_low:new s.bg(E,o.u_brightness_low),u_brightness_high:new s.bg(E,o.u_brightness_high),u_saturation_factor:new s.bg(E,o.u_saturation_factor),u_contrast_factor:new s.bg(E,o.u_contrast_factor),u_spin_weights:new s.bT(E,o.u_spin_weights),u_coords_top:new s.bS(E,o.u_coords_top),u_coords_bottom:new s.bS(E,o.u_coords_bottom)}),symbolIcon:(E,o)=>({u_is_size_zoom_constant:new s.bP(E,o.u_is_size_zoom_constant),u_is_size_feature_constant:new s.bP(E,o.u_is_size_feature_constant),u_size_t:new s.bg(E,o.u_size_t),u_size:new s.bg(E,o.u_size),u_camera_to_center_distance:new s.bg(E,o.u_camera_to_center_distance),u_pitch:new s.bg(E,o.u_pitch),u_rotate_symbol:new s.bP(E,o.u_rotate_symbol),u_aspect_ratio:new s.bg(E,o.u_aspect_ratio),u_fade_change:new s.bg(E,o.u_fade_change),u_label_plane_matrix:new s.bR(E,o.u_label_plane_matrix),u_coord_matrix:new s.bR(E,o.u_coord_matrix),u_is_text:new s.bP(E,o.u_is_text),u_pitch_with_map:new s.bP(E,o.u_pitch_with_map),u_is_along_line:new s.bP(E,o.u_is_along_line),u_is_variable_anchor:new s.bP(E,o.u_is_variable_anchor),u_texsize:new s.bU(E,o.u_texsize),u_texture:new s.bP(E,o.u_texture),u_translation:new s.bU(E,o.u_translation),u_pitched_scale:new s.bg(E,o.u_pitched_scale)}),symbolSDF:(E,o)=>({u_is_size_zoom_constant:new s.bP(E,o.u_is_size_zoom_constant),u_is_size_feature_constant:new s.bP(E,o.u_is_size_feature_constant),u_size_t:new s.bg(E,o.u_size_t),u_size:new s.bg(E,o.u_size),u_camera_to_center_distance:new s.bg(E,o.u_camera_to_center_distance),u_pitch:new s.bg(E,o.u_pitch),u_rotate_symbol:new s.bP(E,o.u_rotate_symbol),u_aspect_ratio:new s.bg(E,o.u_aspect_ratio),u_fade_change:new s.bg(E,o.u_fade_change),u_label_plane_matrix:new s.bR(E,o.u_label_plane_matrix),u_coord_matrix:new s.bR(E,o.u_coord_matrix),u_is_text:new s.bP(E,o.u_is_text),u_pitch_with_map:new s.bP(E,o.u_pitch_with_map),u_is_along_line:new s.bP(E,o.u_is_along_line),u_is_variable_anchor:new s.bP(E,o.u_is_variable_anchor),u_texsize:new s.bU(E,o.u_texsize),u_texture:new s.bP(E,o.u_texture),u_gamma_scale:new s.bg(E,o.u_gamma_scale),u_device_pixel_ratio:new s.bg(E,o.u_device_pixel_ratio),u_is_halo:new s.bP(E,o.u_is_halo),u_translation:new s.bU(E,o.u_translation),u_pitched_scale:new s.bg(E,o.u_pitched_scale)}),symbolTextAndIcon:(E,o)=>({u_is_size_zoom_constant:new s.bP(E,o.u_is_size_zoom_constant),u_is_size_feature_constant:new s.bP(E,o.u_is_size_feature_constant),u_size_t:new s.bg(E,o.u_size_t),u_size:new s.bg(E,o.u_size),u_camera_to_center_distance:new s.bg(E,o.u_camera_to_center_distance),u_pitch:new s.bg(E,o.u_pitch),u_rotate_symbol:new s.bP(E,o.u_rotate_symbol),u_aspect_ratio:new s.bg(E,o.u_aspect_ratio),u_fade_change:new s.bg(E,o.u_fade_change),u_label_plane_matrix:new s.bR(E,o.u_label_plane_matrix),u_coord_matrix:new s.bR(E,o.u_coord_matrix),u_is_text:new s.bP(E,o.u_is_text),u_pitch_with_map:new s.bP(E,o.u_pitch_with_map),u_is_along_line:new s.bP(E,o.u_is_along_line),u_is_variable_anchor:new s.bP(E,o.u_is_variable_anchor),u_texsize:new s.bU(E,o.u_texsize),u_texsize_icon:new s.bU(E,o.u_texsize_icon),u_texture:new s.bP(E,o.u_texture),u_texture_icon:new s.bP(E,o.u_texture_icon),u_gamma_scale:new s.bg(E,o.u_gamma_scale),u_device_pixel_ratio:new s.bg(E,o.u_device_pixel_ratio),u_is_halo:new s.bP(E,o.u_is_halo),u_translation:new s.bU(E,o.u_translation),u_pitched_scale:new s.bg(E,o.u_pitched_scale)}),background:(E,o)=>({u_opacity:new s.bg(E,o.u_opacity),u_color:new s.bQ(E,o.u_color)}),backgroundPattern:(E,o)=>({u_opacity:new s.bg(E,o.u_opacity),u_image:new s.bP(E,o.u_image),u_pattern_tl_a:new s.bU(E,o.u_pattern_tl_a),u_pattern_br_a:new s.bU(E,o.u_pattern_br_a),u_pattern_tl_b:new s.bU(E,o.u_pattern_tl_b),u_pattern_br_b:new s.bU(E,o.u_pattern_br_b),u_texsize:new s.bU(E,o.u_texsize),u_mix:new s.bg(E,o.u_mix),u_pattern_size_a:new s.bU(E,o.u_pattern_size_a),u_pattern_size_b:new s.bU(E,o.u_pattern_size_b),u_scale_a:new s.bg(E,o.u_scale_a),u_scale_b:new s.bg(E,o.u_scale_b),u_pixel_coord_upper:new s.bU(E,o.u_pixel_coord_upper),u_pixel_coord_lower:new s.bU(E,o.u_pixel_coord_lower),u_tile_units_to_pixels:new s.bg(E,o.u_tile_units_to_pixels)}),terrain:(E,o)=>({u_texture:new s.bP(E,o.u_texture),u_ele_delta:new s.bg(E,o.u_ele_delta),u_fog_matrix:new s.bR(E,o.u_fog_matrix),u_fog_color:new s.bQ(E,o.u_fog_color),u_fog_ground_blend:new s.bg(E,o.u_fog_ground_blend),u_fog_ground_blend_opacity:new s.bg(E,o.u_fog_ground_blend_opacity),u_horizon_color:new s.bQ(E,o.u_horizon_color),u_horizon_fog_blend:new s.bg(E,o.u_horizon_fog_blend),u_is_globe_mode:new s.bg(E,o.u_is_globe_mode)}),terrainDepth:(E,o)=>({u_ele_delta:new s.bg(E,o.u_ele_delta)}),terrainCoords:(E,o)=>({u_texture:new s.bP(E,o.u_texture),u_terrain_coords_id:new s.bg(E,o.u_terrain_coords_id),u_ele_delta:new s.bg(E,o.u_ele_delta)}),projectionErrorMeasurement:(E,o)=>({u_input:new s.bg(E,o.u_input),u_output_expected:new s.bg(E,o.u_output_expected)}),atmosphere:(E,o)=>({u_sun_pos:new s.bT(E,o.u_sun_pos),u_atmosphere_blend:new s.bg(E,o.u_atmosphere_blend),u_globe_position:new s.bT(E,o.u_globe_position),u_globe_radius:new s.bg(E,o.u_globe_radius),u_inv_proj_matrix:new s.bR(E,o.u_inv_proj_matrix)}),sky:(E,o)=>({u_sky_color:new s.bQ(E,o.u_sky_color),u_horizon_color:new s.bQ(E,o.u_horizon_color),u_horizon:new s.bU(E,o.u_horizon),u_horizon_normal:new s.bU(E,o.u_horizon_normal),u_sky_horizon_blend:new s.bg(E,o.u_sky_horizon_blend),u_sky_blend:new s.bg(E,o.u_sky_blend)})};class em{constructor(o,d,y){this.context=o;const w=o.gl;this.buffer=w.createBuffer(),this.dynamicDraw=!!y,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const d=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const is={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ta{constructor(o,d,y,w){this.length=d.length,this.attributes=y,this.itemSize=d.bytesPerElement,this.dynamicDraw=w,this.context=o;const C=o.gl;this.buffer=C.createBuffer(),o.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){if(o.length!==this.length)throw new Error(`Length of new data is ${o.length}, which doesn't match current length of ${this.length}`);const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,d){for(let y=0;y<this.attributes.length;y++){const w=d.attributes[this.attributes[y].name];w!==void 0&&o.enableVertexAttribArray(w)}}setVertexAttribPointers(o,d,y){for(let w=0;w<this.attributes.length;w++){const C=this.attributes[w],I=d.attributes[C.name];I!==void 0&&o.vertexAttribPointer(I,C.components,o[is[C.type]],!1,this.itemSize,C.offset+this.itemSize*(y||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Gr{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ff extends Gr{getDefault(){return s.bf.transparent}set(o){const d=this.current;(o.r!==d.r||o.g!==d.g||o.b!==d.b||o.a!==d.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Uf extends Gr{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class lp extends Gr{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class Th extends Gr{getDefault(){return[!0,!0,!0,!0]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Ic extends Gr{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class Nl extends Gr{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class cp extends Gr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const d=this.current;(o.func!==d.func||o.ref!==d.ref||o.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Sh extends Gr{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class up extends Gr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=o,this.dirty=!1}}class tm extends Gr{getDefault(){return[0,1]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class zl extends Gr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=o,this.dirty=!1}}class wu extends Gr{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class jf extends Gr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.BLEND):d.disable(d.BLEND),this.current=o,this.dirty=!1}}class Ah extends Gr{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class ao extends Gr{getDefault(){return s.bf.transparent}set(o){const d=this.current;(o.r!==d.r||o.g!==d.g||o.b!==d.b||o.a!==d.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Eh extends Gr{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class Vf extends Gr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=o,this.dirty=!1}}class Fl extends Gr{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class Ch extends Gr{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class Tu extends Gr{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class ma extends Gr{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class hp extends Gr{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class fp extends Gr{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class Ph extends Gr{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Ki extends Gr{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class Rc extends Gr{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class _s extends Gr{getDefault(){return null}set(o){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class oo extends Gr{getDefault(){return null}set(o){var d;if(o===this.current&&!this.dirty)return;const y=this.gl;Ba(y)?y.bindVertexArray(o):(d=y.getExtension("OES_vertex_array_object"))===null||d===void 0||d.bindVertexArrayOES(o),this.current=o,this.dirty=!1}}class Su extends Gr{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class Mh extends Gr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class Uo extends Gr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class lo extends Gr{constructor(o,d){super(o),this.context=o,this.parent=d}getDefault(){return null}}class Ul extends lo{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class $f extends lo{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Rr extends lo{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}const co="Framebuffer is not complete";class Jy{constructor(o,d,y,w,C){this.context=o,this.width=d,this.height=y;const I=o.gl,B=this.framebuffer=I.createFramebuffer();if(this.colorAttachment=new Ul(o,B),w)this.depthAttachment=C?new Rr(o,B):new $f(o,B);else if(C)throw new Error("Stencil cannot be set without depth");if(I.checkFramebufferStatus(I.FRAMEBUFFER)!==I.FRAMEBUFFER_COMPLETE)throw new Error(co)}destroy(){const o=this.context.gl,d=this.colorAttachment.get();if(d&&o.deleteTexture(d),this.depthAttachment){const y=this.depthAttachment.get();y&&o.deleteRenderbuffer(y)}o.deleteFramebuffer(this.framebuffer)}}class zs{constructor(o){var d,y;if(this.gl=o,this.clearColor=new Ff(this),this.clearDepth=new Uf(this),this.clearStencil=new lp(this),this.colorMask=new Th(this),this.depthMask=new Ic(this),this.stencilMask=new Nl(this),this.stencilFunc=new cp(this),this.stencilOp=new Sh(this),this.stencilTest=new up(this),this.depthRange=new tm(this),this.depthTest=new zl(this),this.depthFunc=new wu(this),this.blend=new jf(this),this.blendFunc=new Ah(this),this.blendColor=new ao(this),this.blendEquation=new Eh(this),this.cullFace=new Vf(this),this.cullFaceSide=new Fl(this),this.frontFace=new Ch(this),this.program=new Tu(this),this.activeTexture=new ma(this),this.viewport=new hp(this),this.bindFramebuffer=new fp(this),this.bindRenderbuffer=new Ph(this),this.bindTexture=new Ki(this),this.bindVertexBuffer=new Rc(this),this.bindElementBuffer=new _s(this),this.bindVertexArray=new oo(this),this.pixelStoreUnpack=new Su(this),this.pixelStoreUnpackPremultiplyAlpha=new Mh(this),this.pixelStoreUnpackFlipY=new Uo(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),Ba(o)){this.HALF_FLOAT=o.HALF_FLOAT;const w=o.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(d=o.RGBA16F)!==null&&d!==void 0?d:w?.RGBA16F_EXT,this.RGB16F=(y=o.RGB16F)!==null&&y!==void 0?y:w?.RGB16F_EXT,o.getExtension("EXT_color_buffer_float")}else{o.getExtension("EXT_color_buffer_half_float"),o.getExtension("OES_texture_half_float_linear");const w=o.getExtension("OES_texture_half_float");this.HALF_FLOAT=w?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,d){return new em(this,o,d)}createVertexBuffer(o,d,y){return new ta(this,o,d,y)}createRenderbuffer(o,d,y){const w=this.gl,C=w.createRenderbuffer();return this.bindRenderbuffer.set(C),w.renderbufferStorage(w.RENDERBUFFER,o,d,y),this.bindRenderbuffer.set(null),C}createFramebuffer(o,d,y,w){return new Jy(this,o,d,y,w)}clear({color:o,depth:d,stencil:y}){const w=this.gl;let C=0;o&&(C|=w.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),d!==void 0&&(C|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),y!==void 0&&(C|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),w.clear(C)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){s.bH(o.blendFunction,sn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}createVertexArray(){var o;return Ba(this.gl)?this.gl.createVertexArray():(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.createVertexArrayOES()}deleteVertexArray(o){var d;return Ba(this.gl)?this.gl.deleteVertexArray(o):(d=this.gl.getExtension("OES_vertex_array_object"))===null||d===void 0?void 0:d.deleteVertexArrayOES(o)}unbindVAO(){this.bindVertexArray.set(null)}}let uo;function ho(E,o,d,y,w){const C=E.context,I=E.transform,B=C.gl,N=E.useProgram("collisionBox"),H=[];let W=0,K=0;for(let _e=0;_e<y.length;_e++){const be=y[_e],Ee=o.getTile(be).getBucket(d);if(!Ee)continue;const Te=w?Ee.textCollisionBox:Ee.iconCollisionBox,Oe=Ee.collisionCircleArray;Oe.length>0&&(H.push({circleArray:Oe,circleOffset:K,coord:be}),W+=Oe.length/4,K=W),Te&&N.draw(C,B.LINES,yr.disabled,zr.disabled,E.colorModeForRenderPass(),hr.disabled,wh(E.transform),E.style.map.terrain&&E.style.map.terrain.getTerrainData(be),I.getProjectionData({overscaledTileID:be,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),d.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,null,E.transform.zoom,null,null,Te.collisionVertexBuffer)}if(!w||!H.length)return;const Z=E.useProgram("collisionCircle"),te=new s.b$;te.resize(4*W),te._trim();let oe=0;for(const _e of H)for(let be=0;be<_e.circleArray.length/4;be++){const Ee=4*be,Te=_e.circleArray[Ee+0],Oe=_e.circleArray[Ee+1],Ne=_e.circleArray[Ee+2],Ce=_e.circleArray[Ee+3];te.emplace(oe++,Te,Oe,Ne,Ce,0),te.emplace(oe++,Te,Oe,Ne,Ce,1),te.emplace(oe++,Te,Oe,Ne,Ce,2),te.emplace(oe++,Te,Oe,Ne,Ce,3)}(!uo||uo.length<2*W)&&(uo=(function(_e){const be=2*_e,Ee=new s.c1;Ee.resize(be),Ee._trim();for(let Te=0;Te<be;Te++){const Oe=6*Te;Ee.uint16[Oe+0]=4*Te+0,Ee.uint16[Oe+1]=4*Te+1,Ee.uint16[Oe+2]=4*Te+2,Ee.uint16[Oe+3]=4*Te+2,Ee.uint16[Oe+4]=4*Te+3,Ee.uint16[Oe+5]=4*Te+0}return Ee})(W));const me=C.createIndexBuffer(uo,!0),ye=C.createVertexBuffer(te,s.c0.members,!0);for(const _e of H){const be=Xg(E.transform);Z.draw(C,B.TRIANGLES,yr.disabled,zr.disabled,E.colorModeForRenderPass(),hr.disabled,be,E.style.map.terrain&&E.style.map.terrain.getTerrainData(_e.coord),null,d.id,ye,me,s.aM.simpleSegment(0,2*_e.circleOffset,_e.circleArray.length,_e.circleArray.length/2),null,E.transform.zoom,null,null,null)}ye.destroy(),me.destroy()}const rm=s.ag(new Float32Array(16));function Ih(E,o,d,y,w,C){const{horizontalAlign:I,verticalAlign:B}=s.aH(E);return new s.P((-(I-.5)*o/w+y[0])*C,(-(B-.5)*d/w+y[1])*C)}function Oc(E,o,d,y,w,C){const I=o.tileAnchorPoint.add(new s.P(o.translation[0],o.translation[1]));if(o.pitchWithMap){let B=y.mult(C);d||(B=B.rotate(-w));const N=I.add(B);return Jn(N.x,N.y,o.pitchedLabelPlaneMatrix,o.getElevation).point}if(d){const B=Pi(o.tileAnchorPoint.x+1,o.tileAnchorPoint.y,o).point.sub(E),N=Math.atan(B.y/B.x)+(B.x<0?Math.PI:0);return E.add(y.rotate(N))}return E.add(y)}function Rh(E,o,d,y,w,C,I,B,N,H,W,K){const Z=E.text.placedSymbolArray,te=E.text.dynamicLayoutVertexArray,oe=E.icon.dynamicLayoutVertexArray,me={};te.clear();for(let ye=0;ye<Z.length;ye++){const _e=Z.get(ye),be=_e.hidden||!_e.crossTileID||E.allowVerticalPlacement&&!_e.placedOrientation?null:y[_e.crossTileID];if(be){const Ee=new s.P(_e.anchorX,_e.anchorY),Te={getElevation:K,width:w.width,height:w.height,pitchedLabelPlaneMatrix:C,pitchWithMap:d,transform:w,tileAnchorPoint:Ee,translation:H,unwrappedTileID:W},Oe=d?Pl(Ee.x,Ee.y,Te):Pi(Ee.x,Ee.y,Te),Ne=bt(w.cameraToCenterDistance,Oe.signedDistanceFromCamera);let Ce=s.ap(E.textSizeData,B,_e)*Ne/s.aB;d&&(Ce*=E.tilePixelRatio/I);const{width:ze,height:ot,anchor:tt,textOffset:nt,textBoxScale:lt}=be,Nt=Ih(tt,ze,ot,nt,lt,Ce),Bt=w.getPitchedTextCorrection(Ee.x+H[0],Ee.y+H[1],W),Tt=Oc(Oe.point,Te,o,Nt,-w.bearingInRadians,Bt),qt=E.allowVerticalPlacement&&_e.placedOrientation===s.ao.vertical?Math.PI/2:0;for(let wr=0;wr<_e.numGlyphs;wr++)s.av(te,Tt,qt);N&&_e.associatedIconIndex>=0&&(me[_e.associatedIconIndex]={shiftedAnchor:Tt,angle:qt})}else ms(_e.numGlyphs,te)}if(N){oe.clear();const ye=E.icon.placedSymbolArray;for(let _e=0;_e<ye.length;_e++){const be=ye.get(_e);if(be.hidden)ms(be.numGlyphs,oe);else{const Ee=me[_e];if(Ee)for(let Te=0;Te<be.numGlyphs;Te++)s.av(oe,Ee.shiftedAnchor,Ee.angle);else ms(be.numGlyphs,oe)}}E.icon.dynamicLayoutVertexBuffer.updateData(oe)}E.text.dynamicLayoutVertexBuffer.updateData(te)}function Oh(E,o,d){return d.iconsInText&&o?"symbolTextAndIcon":E?"symbolSDF":"symbolIcon"}function kc(E,o,d,y,w,C,I,B,N,H,W,K,Z){const te=E.context,oe=te.gl,me=E.transform,ye=B==="map",_e=N==="map",be=B!=="viewport"&&d.layout.get("symbol-placement")!=="point",Ee=ye&&!_e&&!be,Te=!d.layout.get("symbol-sort-key").isConstant();let Oe=!1;const Ne=E.getDepthModeForSublayer(0,yr.ReadOnly),Ce=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ze=[],ot=me.getCircleRadiusCorrection();for(const tt of y){const nt=o.getTile(tt),lt=nt.getBucket(d);if(!lt)continue;const Nt=w?lt.text:lt.icon;if(!Nt||!Nt.segments.get().length||!Nt.hasVisibleVertices)continue;const Bt=Nt.programConfigurations.get(d.id),Tt=w||lt.sdfIcons,qt=w?lt.textSizeData:lt.iconSizeData,wr=_e||me.pitch!==0,Yr=E.useProgram(Oh(Tt,w,lt),Bt),xn=s.an(qt,me.zoom),pn=E.style.map.terrain&&E.style.map.terrain.getTerrainData(tt);let En,wn,xi,Cn,on=[0,0],hn=null;if(w)wn=nt.glyphAtlasTexture,xi=oe.LINEAR,En=nt.glyphAtlasTexture.size,lt.iconsInText&&(on=nt.imageAtlasTexture.size,hn=nt.imageAtlasTexture,Cn=wr||E.options.rotating||E.options.zooming||qt.kind==="composite"||qt.kind==="camera"?oe.LINEAR:oe.NEAREST);else{const ai=d.layout.get("icon-size").constantOr(0)!==1||lt.iconsNeedLinear;wn=nt.imageAtlasTexture,xi=Tt||E.options.rotating||E.options.zooming||ai||wr?oe.LINEAR:oe.NEAREST,En=nt.imageAtlasTexture.size}const Or=s.aC(nt,1,E.transform.zoom),wi=Ci(ye,E.transform,Or),_a=s.L();s.aq(_a,wi);const Yl=yi(_e,ye,E.transform,Or),wo=s.aD(me,nt,C,I),Fc=me.getProjectionData({overscaledTileID:tt,applyGlobeMatrix:!Z,applyTerrainMatrix:!0}),Ou=Ce&&lt.hasTextData(),Ko=d.layout.get("icon-text-fit")!=="none"&&Ou&&lt.hasIconData();if(be){const ai=E.style.map.terrain?(ls,Tn)=>E.style.map.terrain.getElevation(tt,ls,Tn):null,ti=d.layout.get("text-rotation-alignment")==="map";ks(lt,E,w,wi,_a,_e,H,ti,tt.toUnwrapped(),me.width,me.height,wo,ai)}const Kl=w&&Ce||Ko,Ws=be||Kl?rm:_e?wi:E.transform.clipSpaceToPixelsMatrix,Qo=Tt&&d.paint.get(w?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ja;ja=Tt?lt.iconsInText?Kg(qt.kind,xn,Ee,_e,be,Kl,E,Ws,Yl,wo,En,on,ot):sp(qt.kind,xn,Ee,_e,be,Kl,E,Ws,Yl,wo,w,En,0,ot):xu(qt.kind,xn,Ee,_e,be,Kl,E,Ws,Yl,wo,w,En,ot);const Jo={program:Yr,buffers:Nt,uniformValues:ja,projectionData:Fc,atlasTexture:wn,atlasTextureIcon:hn,atlasInterpolation:xi,atlasInterpolationIcon:Cn,isSDF:Tt,hasHalo:Qo};if(Te&&lt.canOverlap){Oe=!0;const ai=Nt.segments.get();for(const ti of ai)ze.push({segments:new s.aM([ti]),sortKey:ti.sortKey,state:Jo,terrainData:pn})}else ze.push({segments:Nt.segments,sortKey:0,state:Jo,terrainData:pn})}Oe&&ze.sort(((tt,nt)=>tt.sortKey-nt.sortKey));for(const tt of ze){const nt=tt.state;if(te.activeTexture.set(oe.TEXTURE0),nt.atlasTexture.bind(nt.atlasInterpolation,oe.CLAMP_TO_EDGE),nt.atlasTextureIcon&&(te.activeTexture.set(oe.TEXTURE1),nt.atlasTextureIcon&&nt.atlasTextureIcon.bind(nt.atlasInterpolationIcon,oe.CLAMP_TO_EDGE)),nt.isSDF){const lt=nt.uniformValues;nt.hasHalo&&(lt.u_is_halo=1,Au(nt.buffers,tt.segments,d,E,nt.program,Ne,W,K,lt,nt.projectionData,tt.terrainData)),lt.u_is_halo=0}Au(nt.buffers,tt.segments,d,E,nt.program,Ne,W,K,nt.uniformValues,nt.projectionData,tt.terrainData)}}function Au(E,o,d,y,w,C,I,B,N,H,W){const K=y.context;w.draw(K,K.gl.TRIANGLES,C,I,B,hr.backCCW,N,W,H,d.id,E.layoutVertexBuffer,E.indexBuffer,o,d.paint,y.transform.zoom,E.programConfigurations.get(d.id),E.dynamicLayoutVertexBuffer,E.opacityVertexBuffer)}function Fs(E,o,d,y,w){const C=E.context,I=C.gl,B=zr.disabled,N=new sn([I.ONE,I.ONE],s.bf.transparent,[!0,!0,!0,!0]),H=o.getBucket(d);if(!H)return;const W=y.key;let K=d.heatmapFbos.get(W);K||(K=fo(C,o.tileSize,o.tileSize),d.heatmapFbos.set(W,K)),C.bindFramebuffer.set(K.framebuffer),C.viewport.set([0,0,o.tileSize,o.tileSize]),C.clear({color:s.bf.transparent});const Z=H.programConfigurations.get(d.id),te=E.useProgram("heatmap",Z,!w),oe=E.transform.getProjectionData({overscaledTileID:o.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),me=E.style.map.terrain.getTerrainData(y);te.draw(C,I.TRIANGLES,yr.disabled,B,N,hr.disabled,Pc(o,E.transform.zoom,d.paint.get("heatmap-intensity"),1),me,oe,d.id,H.layoutVertexBuffer,H.indexBuffer,H.segments,d.paint,E.transform.zoom,Z)}function Dc(E,o,d,y,w){const C=E.context,I=C.gl,B=E.transform;C.setColorMode(E.colorModeForRenderPass());const N=jl(C,o),H=d.key,W=o.heatmapFbos.get(H);if(!W)return;C.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,W.colorAttachment.get()),C.activeTexture.set(I.TEXTURE1),N.bind(I.LINEAR,I.CLAMP_TO_EDGE);const K=B.getProjectionData({overscaledTileID:d,applyTerrainMatrix:w,applyGlobeMatrix:!y});E.useProgram("heatmapTexture").draw(C,I.TRIANGLES,yr.disabled,zr.disabled,E.colorModeForRenderPass(),hr.disabled,rp(E,o,0,1),null,K,o.id,E.rasterBoundsBuffer,E.quadTriangleIndexBuffer,E.rasterBoundsSegments,o.paint,B.zoom),W.destroy(),o.heatmapFbos.delete(H)}function fo(E,o,d){var y,w;const C=E.gl,I=C.createTexture();C.bindTexture(C.TEXTURE_2D,I),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_S,C.CLAMP_TO_EDGE),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_T,C.CLAMP_TO_EDGE),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MIN_FILTER,C.LINEAR),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MAG_FILTER,C.LINEAR);const B=(y=E.HALF_FLOAT)!==null&&y!==void 0?y:C.UNSIGNED_BYTE,N=(w=E.RGBA16F)!==null&&w!==void 0?w:C.RGBA;C.texImage2D(C.TEXTURE_2D,0,N,o,d,0,C.RGBA,B,null);const H=E.createFramebuffer(o,d,!1,!1);return H.colorAttachment.set(I),H}function jl(E,o){return o.colorRampTexture||(o.colorRampTexture=new s.T(E,o.colorRamp,E.gl.RGBA)),o.colorRampTexture}function jo(E,o,d,y,w){if(!d||!y||!y.imageAtlas)return;const C=y.imageAtlas.patternPositions;let I=C[d.to.toString()],B=C[d.from.toString()];if(!I&&B&&(I=B),!B&&I&&(B=I),!I||!B){const N=w.getPaintProperty(o);I=C[N],B=C[N]}I&&B&&E.setConstantPatternPositions(I,B)}function Ui(E,o,d,y,w,C,I,B){const N=E.context.gl,H="fill-pattern",W=d.paint.get(H),K=W&&W.constantOr(1),Z=d.getCrossfadeParameters();let te,oe,me,ye,_e;const be=E.transform,Ee=d.paint.get("fill-translate"),Te=d.paint.get("fill-translate-anchor");I?(oe=K&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",te=N.LINES):(oe=K?"fillPattern":"fill",te=N.TRIANGLES);const Oe=W.constantOr(null);for(const Ne of y){const Ce=o.getTile(Ne);if(K&&!Ce.patternsLoaded())continue;const ze=Ce.getBucket(d);if(!ze)continue;const ot=ze.programConfigurations.get(d.id),tt=E.useProgram(oe,ot),nt=E.style.map.terrain&&E.style.map.terrain.getTerrainData(Ne);K&&(E.context.activeTexture.set(N.TEXTURE0),Ce.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),ot.updatePaintBuffers(Z)),jo(ot,H,Oe,Ce,d);const lt=be.getProjectionData({overscaledTileID:Ne,applyGlobeMatrix:!B,applyTerrainMatrix:!0}),Nt=s.aD(be,Ce,Ee,Te);if(I){ye=ze.indexBuffer2,_e=ze.segments2;const Tt=[N.drawingBufferWidth,N.drawingBufferHeight];me=oe==="fillOutlinePattern"&&K?vu(E,Z,Ce,Tt,Nt):xh(Tt,Nt)}else ye=ze.indexBuffer,_e=ze.segments,me=K?Dl(E,Z,Ce,Nt):{u_fill_translate:Nt};const Bt=E.stencilModeForClipping(Ne);tt.draw(E.context,te,w,Bt,C,hr.backCCW,me,nt,lt,d.id,ze.layoutVertexBuffer,ye,_e,d.paint,E.transform.zoom,ot)}}function ss(E,o,d,y,w,C,I,B){const N=E.context,H=N.gl,W="fill-extrusion-pattern",K=d.paint.get(W),Z=K.constantOr(1),te=d.getCrossfadeParameters(),oe=d.paint.get("fill-extrusion-opacity"),me=K.constantOr(null),ye=E.transform;for(const _e of y){const be=o.getTile(_e),Ee=be.getBucket(d);if(!Ee)continue;const Te=E.style.map.terrain&&E.style.map.terrain.getTerrainData(_e),Oe=Ee.programConfigurations.get(d.id),Ne=E.useProgram(Z?"fillExtrusionPattern":"fillExtrusion",Oe);Z&&(E.context.activeTexture.set(H.TEXTURE0),be.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),Oe.updatePaintBuffers(te));const Ce=ye.getProjectionData({overscaledTileID:_e,applyGlobeMatrix:!B,applyTerrainMatrix:!0});jo(Oe,W,me,be,d);const ze=s.aD(ye,be,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),ot=d.paint.get("fill-extrusion-vertical-gradient"),tt=Z?tp(E,ot,oe,ze,_e,te,be):Na(E,ot,oe,ze);Ne.draw(N,N.gl.TRIANGLES,w,C,I,hr.backCCW,tt,Te,Ce,d.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,d.paint,E.transform.zoom,Oe,E.style.map.terrain&&Ee.centroidVertexBuffer)}}function po(E,o,d,y,w,C,I,B,N){var H;const W=E.style.projection,K=E.context,Z=E.transform,te=K.gl,oe=[`#define NUM_ILLUMINATION_SOURCES ${d.paint.get("hillshade-highlight-color").values.length}`],me=E.useProgram("hillshade",null,!1,oe),ye=!E.options.moving;for(const _e of y){const be=o.getTile(_e),Ee=be.fbo;if(!Ee)continue;const Te=W.getMeshFromTileID(K,_e.canonical,B,!0,"raster"),Oe=(H=E.style.map.terrain)===null||H===void 0?void 0:H.getTerrainData(_e);K.activeTexture.set(te.TEXTURE0),te.bindTexture(te.TEXTURE_2D,Ee.colorAttachment.get());const Ne=Z.getProjectionData({overscaledTileID:_e,aligned:ye,applyGlobeMatrix:!N,applyTerrainMatrix:!0});me.draw(K,te.TRIANGLES,C,w[_e.overscaledZ],I,hr.backCCW,Qy(E,be,d),Oe,Ne,d.id,Te.vertexBuffer,Te.indexBuffer,Te.segments)}}function as(E,o,d,y,w,C,I,B,N){var H;const W=E.style.projection,K=E.context,Z=E.transform,te=K.gl,oe=E.useProgram("colorRelief"),me=!E.options.moving;let ye=!0,_e=0;for(const be of y){const Ee=o.getTile(be),Te=Ee.dem;if(ye){const tt=te.getParameter(te.MAX_TEXTURE_SIZE),{elevationTexture:nt,colorTexture:lt}=d.getColorRampTextures(K,tt,Te.getUnpackVector());K.activeTexture.set(te.TEXTURE1),nt.bind(te.NEAREST,te.CLAMP_TO_EDGE),K.activeTexture.set(te.TEXTURE4),lt.bind(te.LINEAR,te.CLAMP_TO_EDGE),ye=!1,_e=nt.size[0]}if(!Te||!Te.data)continue;const Oe=Te.stride,Ne=Te.getPixels();if(K.activeTexture.set(te.TEXTURE0),K.pixelStoreUnpackPremultiplyAlpha.set(!1),Ee.demTexture=Ee.demTexture||E.getTileTexture(Oe),Ee.demTexture){const tt=Ee.demTexture;tt.update(Ne,{premultiply:!1}),tt.bind(te.LINEAR,te.CLAMP_TO_EDGE)}else Ee.demTexture=new s.T(K,Ne,te.RGBA,{premultiply:!1}),Ee.demTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE);const Ce=W.getMeshFromTileID(K,be.canonical,B,!0,"raster"),ze=(H=E.style.map.terrain)===null||H===void 0?void 0:H.getTerrainData(be),ot=Z.getProjectionData({overscaledTileID:be,aligned:me,applyGlobeMatrix:!N,applyTerrainMatrix:!0});oe.draw(K,te.TRIANGLES,C,w[be.overscaledZ],I,hr.backCCW,np(d,Ee.dem,_e),ze,ot,d.id,Ce.vertexBuffer,Ce.indexBuffer,Ce.segments)}}const ya=[new s.P(0,0),new s.P(s.$,0),new s.P(s.$,s.$),new s.P(0,s.$)];function ra(E,o,d,y,w,C,I,B,N=!1,H=!1){const W=y[y.length-1].overscaledZ,K=E.context,Z=K.gl,te=E.useProgram("raster"),oe=E.transform,me=E.style.projection,ye=E.colorModeForRenderPass(),_e=!E.options.moving;for(const be of y){const Ee=E.getDepthModeForSublayer(be.overscaledZ-W,d.paint.get("raster-opacity")===1?yr.ReadWrite:yr.ReadOnly,Z.LESS),Te=o.getTile(be);Te.registerFadeDuration(d.paint.get("raster-fade-duration"));const Oe=o.findLoadedParent(be,0),Ne=o.findLoadedSibling(be),Ce=kh(Te,Oe||Ne||null,o,d,E.transform,E.style.map.terrain);let ze,ot;const tt=d.paint.get("raster-resampling")==="nearest"?Z.NEAREST:Z.LINEAR;K.activeTexture.set(Z.TEXTURE0),Te.texture.bind(tt,Z.CLAMP_TO_EDGE,Z.LINEAR_MIPMAP_NEAREST),K.activeTexture.set(Z.TEXTURE1),Oe?(Oe.texture.bind(tt,Z.CLAMP_TO_EDGE,Z.LINEAR_MIPMAP_NEAREST),ze=Math.pow(2,Oe.tileID.overscaledZ-Te.tileID.overscaledZ),ot=[Te.tileID.canonical.x*ze%1,Te.tileID.canonical.y*ze%1]):Te.texture.bind(tt,Z.CLAMP_TO_EDGE,Z.LINEAR_MIPMAP_NEAREST),Te.texture.useMipmap&&K.extTextureFilterAnisotropic&&E.transform.pitch>20&&Z.texParameterf(Z.TEXTURE_2D,K.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,K.extTextureFilterAnisotropicMax);const nt=E.style.map.terrain&&E.style.map.terrain.getTerrainData(be),lt=oe.getProjectionData({overscaledTileID:be,aligned:_e,applyGlobeMatrix:!H,applyTerrainMatrix:!0}),Nt=Mc(ot||[0,0],ze||1,Ce,d,B),Bt=me.getMeshFromTileID(K,be.canonical,C,I,"raster");te.draw(K,Z.TRIANGLES,Ee,w?w[be.overscaledZ]:zr.disabled,ye,N?hr.frontCCW:hr.backCCW,Nt,nt,lt,d.id,Bt.vertexBuffer,Bt.indexBuffer,Bt.segments)}}function kh(E,o,d,y,w,C){const I=y.paint.get("raster-fade-duration");if(!C&&I>0){const B=M.now(),N=(B-E.timeAdded)/I,H=o?(B-o.timeAdded)/I:-1,W=d.getSource(),K=Xt(w,{tileSize:W.tileSize,roundZoom:W.roundZoom}),Z=!o||Math.abs(o.tileID.overscaledZ-K)>Math.abs(E.tileID.overscaledZ-K),te=Z&&E.refreshedUponExpiration?1:s.ah(Z?N:1-H,0,1);return E.refreshedUponExpiration&&N>=1&&(E.refreshedUponExpiration=!1),o?{opacity:1,mix:1-te}:{opacity:te,mix:0}}return{opacity:1,mix:0}}const Dh=new s.bf(1,0,0,1),Hf=new s.bf(0,1,0,1),dp=new s.bf(0,0,1,1),vi=new s.bf(1,0,1,1),vn=new s.bf(0,1,1,1);function $r(E,o,d,y){Hr(E,0,o+d/2,E.transform.width,d,y)}function go(E,o,d,y){Hr(E,o-d/2,0,d,E.transform.height,y)}function Hr(E,o,d,y,w,C){const I=E.context,B=I.gl;B.enable(B.SCISSOR_TEST),B.scissor(o*E.pixelRatio,d*E.pixelRatio,y*E.pixelRatio,w*E.pixelRatio),I.clear({color:C}),B.disable(B.SCISSOR_TEST)}function Vo(E,o,d){const y=E.context,w=y.gl,C=E.useProgram("debug"),I=yr.disabled,B=zr.disabled,N=E.colorModeForRenderPass(),H="$debug",W=E.style.map.terrain&&E.style.map.terrain.getTerrainData(d);y.activeTexture.set(w.TEXTURE0);const K=o.getTileByID(d.key).latestRawTileData,Z=Math.floor((K&&K.byteLength||0)/1024),te=o.getTile(d).tileSize,oe=512/Math.min(te,512)*(d.overscaledZ/E.transform.zoom)*.5;let me=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(me+=` => ${d.overscaledZ}`),(function(_e,be){_e.initDebugOverlayCanvas();const Ee=_e.debugOverlayCanvas,Te=_e.context.gl,Oe=_e.debugOverlayCanvas.getContext("2d");Oe.clearRect(0,0,Ee.width,Ee.height),Oe.shadowColor="white",Oe.shadowBlur=2,Oe.lineWidth=1.5,Oe.strokeStyle="white",Oe.textBaseline="top",Oe.font="bold 36px Open Sans, sans-serif",Oe.fillText(be,5,5),Oe.strokeText(be,5,5),_e.debugOverlayTexture.update(Ee),_e.debugOverlayTexture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE)})(E,`${me} ${Z}kB`);const ye=E.transform.getProjectionData({overscaledTileID:d,applyGlobeMatrix:!0,applyTerrainMatrix:!0});C.draw(y,w.TRIANGLES,I,B,sn.alphaBlended,hr.disabled,Ll(s.bf.transparent,oe),null,ye,H,E.debugBuffer,E.quadTriangleIndexBuffer,E.debugSegments),C.draw(y,w.LINE_STRIP,I,B,N,hr.disabled,Ll(s.bf.red),W,ye,H,E.debugBuffer,E.tileBorderIndexBuffer,E.debugSegments)}function bi(E,o,d,y){const{isRenderingGlobe:w}=y,C=E.context,I=C.gl,B=E.transform,N=E.colorModeForRenderPass(),H=E.getDepthModeFor3D(),W=E.useProgram("terrain");C.bindFramebuffer.set(null),C.viewport.set([0,0,E.width,E.height]);for(const K of d){const Z=o.getTerrainMesh(K.tileID),te=E.renderToTexture.getTexture(K),oe=o.getTerrainData(K.tileID);C.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,te.texture);const me=o.getMeshFrameDelta(B.zoom),ye=B.calculateFogMatrix(K.tileID.toUnwrapped()),_e=Df(me,ye,E.style.sky,B.pitch,w),be=B.getProjectionData({overscaledTileID:K.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});W.draw(C,I.TRIANGLES,H,zr.disabled,N,hr.backCCW,_e,oe,be,"terrain",Z.vertexBuffer,Z.indexBuffer,Z.segments)}}function Lh(E,o){if(!o.mesh){const d=new s.aL;d.emplaceBack(-1,-1),d.emplaceBack(1,-1),d.emplaceBack(1,1),d.emplaceBack(-1,1);const y=new s.aN;y.emplaceBack(0,1,2),y.emplaceBack(0,2,3),o.mesh=new Ol(E.createVertexBuffer(d,Fo.members),E.createIndexBuffer(y),s.aM.simpleSegment(0,0,d.length,y.length))}return o.mesh}class Bh{constructor(o,d){this.context=new zs(o),this.transform=d,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ir.maxUnderzooming+Ir.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Tc}resize(o,d,y){if(this.width=Math.floor(o*y),this.height=Math.floor(d*y),this.pixelRatio=y,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const w of this.style._order)this.style._layers[w].resize()}setup(){const o=this.context,d=new s.aL;d.emplaceBack(0,0),d.emplaceBack(s.$,0),d.emplaceBack(0,s.$),d.emplaceBack(s.$,s.$),this.tileExtentBuffer=o.createVertexBuffer(d,Fo.members),this.tileExtentSegments=s.aM.simpleSegment(0,0,4,2);const y=new s.aL;y.emplaceBack(0,0),y.emplaceBack(s.$,0),y.emplaceBack(0,s.$),y.emplaceBack(s.$,s.$),this.debugBuffer=o.createVertexBuffer(y,Fo.members),this.debugSegments=s.aM.simpleSegment(0,0,4,5);const w=new s.c6;w.emplaceBack(0,0,0,0),w.emplaceBack(s.$,0,s.$,0),w.emplaceBack(0,s.$,0,s.$),w.emplaceBack(s.$,s.$,s.$,s.$),this.rasterBoundsBuffer=o.createVertexBuffer(w,Yy.members),this.rasterBoundsSegments=s.aM.simpleSegment(0,0,4,2);const C=new s.aL;C.emplaceBack(0,0),C.emplaceBack(s.$,0),C.emplaceBack(0,s.$),C.emplaceBack(s.$,s.$),this.rasterBoundsBufferPosOnly=o.createVertexBuffer(C,Fo.members),this.rasterBoundsSegmentsPosOnly=s.aM.simpleSegment(0,0,4,5);const I=new s.aL;I.emplaceBack(0,0),I.emplaceBack(1,0),I.emplaceBack(0,1),I.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(I,Fo.members),this.viewportSegments=s.aM.simpleSegment(0,0,4,2);const B=new s.c7;B.emplaceBack(0),B.emplaceBack(1),B.emplaceBack(3),B.emplaceBack(2),B.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(B);const N=new s.aN;N.emplaceBack(1,0,2),N.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(N);const H=this.context.gl;this.stencilClearMode=new zr({func:H.ALWAYS,mask:0},0,255,H.ZERO,H.ZERO,H.ZERO),this.tileExtentMesh=new Ol(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const o=this.context,d=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const y=s.L();s.bY(y,0,this.width,this.height,0,0,1),s.N(y,y,[d.drawingBufferWidth,d.drawingBufferHeight,0]);const w={mainMatrix:y,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:y};this.useProgram("clippingMask",null,!0).draw(o,d.TRIANGLES,yr.disabled,this.stencilClearMode,sn.disabled,hr.disabled,null,null,w,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,d,y){if(this.currentStencilSource===o.source||!o.isTileClipped()||!d||!d.length)return;this.currentStencilSource=o.source,this.nextStencilID+d.length>256&&this.clearStencil();const w=this.context;w.setColorMode(sn.disabled),w.setDepthMode(yr.disabled);const C={};for(const I of d)C[I.key]=this.nextStencilID++;this._renderTileMasks(C,d,y,!0),this._renderTileMasks(C,d,y,!1),this._tileClippingMaskIDs=C}_renderTileMasks(o,d,y,w){const C=this.context,I=C.gl,B=this.style.projection,N=this.transform,H=this.useProgram("clippingMask");for(const W of d){const K=o[W.key],Z=this.style.map.terrain&&this.style.map.terrain.getTerrainData(W),te=B.getMeshFromTileID(this.context,W.canonical,w,!0,"stencil"),oe=N.getProjectionData({overscaledTileID:W,applyGlobeMatrix:!y,applyTerrainMatrix:!0});H.draw(C,I.TRIANGLES,yr.disabled,new zr({func:I.ALWAYS,mask:0},K,255,I.KEEP,I.KEEP,I.REPLACE),sn.disabled,y?hr.disabled:hr.backCCW,null,Z,oe,"$clipping",te.vertexBuffer,te.indexBuffer,te.segments)}}_renderTilesDepthBuffer(){const o=this.context,d=o.gl,y=this.style.projection,w=this.transform,C=this.useProgram("depth"),I=this.getDepthModeFor3D(),B=He(w,{tileSize:w.tileSize});for(const N of B){const H=this.style.map.terrain&&this.style.map.terrain.getTerrainData(N),W=y.getMeshFromTileID(this.context,N.canonical,!0,!0,"raster"),K=w.getProjectionData({overscaledTileID:N,applyGlobeMatrix:!0,applyTerrainMatrix:!0});C.draw(o,d.TRIANGLES,I,zr.disabled,sn.disabled,hr.backCCW,null,H,K,"$clipping",W.vertexBuffer,W.indexBuffer,W.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,d=this.context.gl;return new zr({func:d.NOTEQUAL,mask:255},o,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(o){const d=this.context.gl;return new zr({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,d.KEEP,d.KEEP,d.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(o){const d=this.context.gl,y=o.sort(((I,B)=>B.overscaledZ-I.overscaledZ)),w=y[y.length-1].overscaledZ,C=y[0].overscaledZ-w+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();const I={};for(let B=0;B<C;B++)I[B+w]=new zr({func:d.GEQUAL,mask:255},B+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=C,[I,y]}return[{[w]:zr.disabled},y]}stencilConfigForOverlapTwoPass(o){const d=this.context.gl,y=o.sort(((I,B)=>B.overscaledZ-I.overscaledZ)),w=y[y.length-1].overscaledZ,C=y[0].overscaledZ-w+1;if(this.clearStencil(),C>1){const I={},B={};for(let N=0;N<C;N++)I[N+w]=new zr({func:d.GREATER,mask:255},C+1+N,255,d.KEEP,d.KEEP,d.REPLACE),B[N+w]=new zr({func:d.GREATER,mask:255},1+N,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID=2*C+1,[I,B,y]}return this.nextStencilID=3,[{[w]:new zr({func:d.GREATER,mask:255},2,255,d.KEEP,d.KEEP,d.REPLACE)},{[w]:new zr({func:d.GREATER,mask:255},1,255,d.KEEP,d.KEEP,d.REPLACE)},y]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new sn([o.CONSTANT_COLOR,o.ONE],new s.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?sn.unblended:sn.alphaBlended}getDepthModeForSublayer(o,d,y){if(!this.opaquePassEnabledForLayer())return yr.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new yr(y||this.context.gl.LEQUAL,d,[w,w])}getDepthModeFor3D(){return new yr(this.context.gl.LEQUAL,yr.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,d){var y,w;this.style=o,this.options=d,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(M.now()),this.imageManager.beginFrame();const C=this.style._order,I=this.style.sourceCaches,B={},N={},H={},W={isRenderingToTexture:!1,isRenderingGlobe:((y=o.projection)===null||y===void 0?void 0:y.transitionState)>0};for(const Z in I){const te=I[Z];te.used&&te.prepare(this.context),B[Z]=te.getVisibleCoordinates(!1),N[Z]=B[Z].slice().reverse(),H[Z]=te.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let Z=0;Z<C.length;Z++)if(this.style._layers[C[Z]].is3D()){this.opaquePassCutoff=Z;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const Z of C){const te=this.style._layers[Z];if(!te.hasOffscreenPass()||te.isHidden(this.transform.zoom))continue;const oe=N[te.source];(te.type==="custom"||oe.length)&&this.renderLayer(this,I[te.source],te,oe,W)}if((w=this.style.projection)===null||w===void 0||w.updateGPUdependent({context:this.context,useProgram:Z=>this.useProgram(Z)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?s.bf.black:s.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(Z,te){const oe=Z.context,me=oe.gl,ye=((Ne,Ce,ze)=>{const ot=Math.cos(Ce.rollInRadians),tt=Math.sin(Ce.rollInRadians),nt=ke(Ce),lt=Ce.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Ne.properties.get("sky-color"),u_horizon_color:Ne.properties.get("horizon-color"),u_horizon:[(Ce.width/2-nt*tt)*ze,(Ce.height/2+nt*ot)*ze],u_horizon_normal:[-tt,ot],u_sky_horizon_blend:Ne.properties.get("sky-horizon-blend")*Ce.height/2*ze,u_sky_blend:lt}})(te,Z.style.map.transform,Z.pixelRatio),_e=new yr(me.LEQUAL,yr.ReadWrite,[0,1]),be=zr.disabled,Ee=Z.colorModeForRenderPass(),Te=Z.useProgram("sky"),Oe=Lh(oe,te);Te.draw(oe,me.TRIANGLES,_e,be,Ee,hr.disabled,ye,null,void 0,"sky",Oe.vertexBuffer,Oe.indexBuffer,Oe.segments)})(this,this.style.sky),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(o._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=C.length-1;this.currentLayer>=0;this.currentLayer--){const Z=this.style._layers[C[this.currentLayer]],te=I[Z.source],oe=B[Z.source];this._renderTileClippingMasks(Z,oe,!1),this.renderLayer(this,te,Z,oe,W)}this.renderPass="translucent";let K=!1;for(this.currentLayer=0;this.currentLayer<C.length;this.currentLayer++){const Z=this.style._layers[C[this.currentLayer]],te=I[Z.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(Z,W))continue;this.opaquePassEnabledForLayer()||K||(K=!0,W.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const oe=(Z.type==="symbol"?H:N)[Z.source];this._renderTileClippingMasks(Z,B[Z.source],!!this.renderToTexture),this.renderLayer(this,te,Z,oe,W)}if(W.isRenderingGlobe&&(function(Z,te,oe){const me=Z.context,ye=me.gl,_e=Z.useProgram("atmosphere"),be=new yr(ye.LEQUAL,yr.ReadOnly,[0,1]),Ee=Z.transform,Te=(function(lt,Nt){const Bt=lt.properties.get("position"),Tt=[-Bt.x,-Bt.y,-Bt.z],qt=s.ag(new Float64Array(16));return lt.properties.get("anchor")==="map"&&(s.b6(qt,qt,Nt.rollInRadians),s.b7(qt,qt,-Nt.pitchInRadians),s.b6(qt,qt,Nt.bearingInRadians),s.b7(qt,qt,Nt.center.lat*Math.PI/180),s.bz(qt,qt,-Nt.center.lng*Math.PI/180)),s.c5(Tt,Tt,qt),Tt})(oe,Z.transform),Oe=Ee.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Ne=te.properties.get("atmosphere-blend")*Oe.projectionTransition;if(Ne===0)return;const Ce=yu(Ee.worldSize,Ee.center.lat),ze=Ee.inverseProjectionMatrix,ot=new Float64Array(4);ot[3]=1,s.aw(ot,ot,Ee.modelViewProjectionMatrix),ot[0]/=ot[3],ot[1]/=ot[3],ot[2]/=ot[3],ot[3]=1,s.aw(ot,ot,ze),ot[0]/=ot[3],ot[1]/=ot[3],ot[2]/=ot[3],ot[3]=1;const tt=((lt,Nt,Bt,Tt,qt)=>({u_sun_pos:lt,u_atmosphere_blend:Nt,u_globe_position:Bt,u_globe_radius:Tt,u_inv_proj_matrix:qt}))(Te,Ne,[ot[0],ot[1],ot[2]],Ce,ze),nt=Lh(me,te);_e.draw(me,ye.TRIANGLES,be,zr.disabled,sn.alphaBlended,hr.disabled,tt,null,null,"atmosphere",nt.vertexBuffer,nt.indexBuffer,nt.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const Z=(function(te,oe){let me=null;const ye=Object.values(te._layers).flatMap((Te=>Te.source&&!Te.isHidden(oe)?[te.sourceCaches[Te.source]]:[])),_e=ye.filter((Te=>Te.getSource().type==="vector")),be=ye.filter((Te=>Te.getSource().type!=="vector")),Ee=Te=>{(!me||me.getSource().maxzoom<Te.getSource().maxzoom)&&(me=Te)};return _e.forEach((Te=>Ee(Te))),me||be.forEach((Te=>Ee(Te))),me})(this.style,this.transform.zoom);Z&&(function(te,oe,me){for(let ye=0;ye<me.length;ye++)Vo(te,oe,me[ye])})(this,Z,Z.getVisibleCoordinates())}this.options.showPadding&&(function(Z){const te=Z.transform.padding;$r(Z,Z.transform.height-(te.top||0),3,Dh),$r(Z,te.bottom||0,3,Hf),go(Z,te.left||0,3,dp),go(Z,Z.transform.width-(te.right||0),3,vi);const oe=Z.transform.centerPoint;(function(me,ye,_e,be){Hr(me,ye-1,_e-10,2,20,be),Hr(me,ye-10,_e-1,20,2,be)})(Z,oe.x,Z.transform.height-oe.y,vn)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(o){if(!this.style||!this.style.map||!this.style.map.terrain)return;const d=this.terrainFacilitator.matrix,y=this.transform.modelViewProjectionMatrix;let w=this.terrainFacilitator.dirty;w||(w=o?!s.c8(d,y):!s.c9(d,y)),w||(w=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),w&&(s.ca(d,y),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(C,I){const B=C.context,N=B.gl,H=C.transform,W=sn.unblended,K=new yr(N.LEQUAL,yr.ReadWrite,[0,1]),Z=I.sourceCache.getRenderableTiles(),te=C.useProgram("terrainDepth");B.bindFramebuffer.set(I.getFramebuffer("depth").framebuffer),B.viewport.set([0,0,C.width/devicePixelRatio,C.height/devicePixelRatio]),B.clear({color:s.bf.transparent,depth:1});for(const oe of Z){const me=I.getTerrainMesh(oe.tileID),ye=I.getTerrainData(oe.tileID),_e=H.getProjectionData({overscaledTileID:oe.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),be={u_ele_delta:I.getMeshFrameDelta(H.zoom)};te.draw(B,N.TRIANGLES,K,zr.disabled,W,hr.backCCW,be,ye,_e,"terrain",me.vertexBuffer,me.indexBuffer,me.segments)}B.bindFramebuffer.set(null),B.viewport.set([0,0,C.width,C.height])})(this,this.style.map.terrain),(function(C,I){const B=C.context,N=B.gl,H=C.transform,W=sn.unblended,K=new yr(N.LEQUAL,yr.ReadWrite,[0,1]),Z=I.getCoordsTexture(),te=I.sourceCache.getRenderableTiles(),oe=C.useProgram("terrainCoords");B.bindFramebuffer.set(I.getFramebuffer("coords").framebuffer),B.viewport.set([0,0,C.width/devicePixelRatio,C.height/devicePixelRatio]),B.clear({color:s.bf.transparent,depth:1}),I.coordsIndex=[];for(const me of te){const ye=I.getTerrainMesh(me.tileID),_e=I.getTerrainData(me.tileID);B.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,Z.texture);const be={u_terrain_coords_id:(255-I.coordsIndex.length)/255,u_texture:0,u_ele_delta:I.getMeshFrameDelta(H.zoom)},Ee=H.getProjectionData({overscaledTileID:me.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});oe.draw(B,N.TRIANGLES,K,zr.disabled,W,hr.backCCW,be,_e,Ee,"terrain",ye.vertexBuffer,ye.indexBuffer,ye.segments),I.coordsIndex.push(me.tileID.key)}B.bindFramebuffer.set(null),B.viewport.set([0,0,C.width,C.height])})(this,this.style.map.terrain))}renderLayer(o,d,y,w,C){y.isHidden(this.transform.zoom)||(y.type==="background"||y.type==="custom"||(w||[]).length)&&(this.id=y.id,s.cb(y)?(function(I,B,N,H,W,K){if(I.renderPass!=="translucent")return;const{isRenderingToTexture:Z}=K,te=zr.disabled,oe=I.colorModeForRenderPass();(N._unevaluatedLayout.hasValue("text-variable-anchor")||N._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(me,ye,_e,be,Ee,Te,Oe,Ne,Ce){const ze=ye.transform,ot=ye.style.map.terrain,tt=Ee==="map",nt=Te==="map";for(const lt of me){const Nt=be.getTile(lt),Bt=Nt.getBucket(_e);if(!Bt||!Bt.text||!Bt.text.segments.get().length)continue;const Tt=s.an(Bt.textSizeData,ze.zoom),qt=s.aC(Nt,1,ye.transform.zoom),wr=Ci(tt,ye.transform,qt),Yr=_e.layout.get("icon-text-fit")!=="none"&&Bt.hasIconData();if(Tt){const xn=Math.pow(2,ze.zoom-Nt.tileID.overscaledZ),pn=ot?(En,wn)=>ot.getElevation(lt,En,wn):null;Rh(Bt,tt,nt,Ce,ze,wr,xn,Tt,Yr,s.aD(ze,Nt,Oe,Ne),lt.toUnwrapped(),pn)}}})(H,I,N,B,N.layout.get("text-rotation-alignment"),N.layout.get("text-pitch-alignment"),N.paint.get("text-translate"),N.paint.get("text-translate-anchor"),W),N.paint.get("icon-opacity").constantOr(1)!==0&&kc(I,B,N,H,!1,N.paint.get("icon-translate"),N.paint.get("icon-translate-anchor"),N.layout.get("icon-rotation-alignment"),N.layout.get("icon-pitch-alignment"),N.layout.get("icon-keep-upright"),te,oe,Z),N.paint.get("text-opacity").constantOr(1)!==0&&kc(I,B,N,H,!0,N.paint.get("text-translate"),N.paint.get("text-translate-anchor"),N.layout.get("text-rotation-alignment"),N.layout.get("text-pitch-alignment"),N.layout.get("text-keep-upright"),te,oe,Z),B.map.showCollisionBoxes&&(ho(I,B,N,H,!0),ho(I,B,N,H,!1))})(o,d,y,w,this.style.placement.variableOffsets,C):s.cc(y)?(function(I,B,N,H,W){if(I.renderPass!=="translucent")return;const{isRenderingToTexture:K}=W,Z=N.paint.get("circle-opacity"),te=N.paint.get("circle-stroke-width"),oe=N.paint.get("circle-stroke-opacity"),me=!N.layout.get("circle-sort-key").isConstant();if(Z.constantOr(1)===0&&(te.constantOr(1)===0||oe.constantOr(1)===0))return;const ye=I.context,_e=ye.gl,be=I.transform,Ee=I.getDepthModeForSublayer(0,yr.ReadOnly),Te=zr.disabled,Oe=I.colorModeForRenderPass(),Ne=[],Ce=be.getCircleRadiusCorrection();for(let ze=0;ze<H.length;ze++){const ot=H[ze],tt=B.getTile(ot),nt=tt.getBucket(N);if(!nt)continue;const lt=N.paint.get("circle-translate"),Nt=N.paint.get("circle-translate-anchor"),Bt=s.aD(be,tt,lt,Nt),Tt=nt.programConfigurations.get(N.id),qt=I.useProgram("circle",Tt),wr=nt.layoutVertexBuffer,Yr=nt.indexBuffer,xn=I.style.map.terrain&&I.style.map.terrain.getTerrainData(ot),pn={programConfiguration:Tt,program:qt,layoutVertexBuffer:wr,indexBuffer:Yr,uniformValues:Gg(I,tt,N,Bt,Ce),terrainData:xn,projectionData:be.getProjectionData({overscaledTileID:ot,applyGlobeMatrix:!K,applyTerrainMatrix:!0})};if(me){const En=nt.segments.get();for(const wn of En)Ne.push({segments:new s.aM([wn]),sortKey:wn.sortKey,state:pn})}else Ne.push({segments:nt.segments,sortKey:0,state:pn})}me&&Ne.sort(((ze,ot)=>ze.sortKey-ot.sortKey));for(const ze of Ne){const{programConfiguration:ot,program:tt,layoutVertexBuffer:nt,indexBuffer:lt,uniformValues:Nt,terrainData:Bt,projectionData:Tt}=ze.state;tt.draw(ye,_e.TRIANGLES,Ee,Te,Oe,hr.backCCW,Nt,Bt,Tt,N.id,nt,lt,ze.segments,N.paint,I.transform.zoom,ot)}})(o,d,y,w,C):s.cd(y)?(function(I,B,N,H,W){if(N.paint.get("heatmap-opacity")===0)return;const K=I.context,{isRenderingToTexture:Z,isRenderingGlobe:te}=W;if(I.style.map.terrain){for(const oe of H){const me=B.getTile(oe);B.hasRenderableParent(oe)||(I.renderPass==="offscreen"?Fs(I,me,N,oe,te):I.renderPass==="translucent"&&Dc(I,N,oe,Z,te))}K.viewport.set([0,0,I.width,I.height])}else I.renderPass==="offscreen"?(function(oe,me,ye,_e){const be=oe.context,Ee=be.gl,Te=oe.transform,Oe=zr.disabled,Ne=new sn([Ee.ONE,Ee.ONE],s.bf.transparent,[!0,!0,!0,!0]);(function(Ce,ze,ot){const tt=Ce.gl;Ce.activeTexture.set(tt.TEXTURE1),Ce.viewport.set([0,0,ze.width/4,ze.height/4]);let nt=ot.heatmapFbos.get(s.c2);nt?(tt.bindTexture(tt.TEXTURE_2D,nt.colorAttachment.get()),Ce.bindFramebuffer.set(nt.framebuffer)):(nt=fo(Ce,ze.width/4,ze.height/4),ot.heatmapFbos.set(s.c2,nt))})(be,oe,ye),be.clear({color:s.bf.transparent});for(let Ce=0;Ce<_e.length;Ce++){const ze=_e[Ce];if(me.hasRenderableParent(ze))continue;const ot=me.getTile(ze),tt=ot.getBucket(ye);if(!tt)continue;const nt=tt.programConfigurations.get(ye.id),lt=oe.useProgram("heatmap",nt),Nt=Te.getProjectionData({overscaledTileID:ze,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Bt=Te.getCircleRadiusCorrection();lt.draw(be,Ee.TRIANGLES,yr.disabled,Oe,Ne,hr.backCCW,Pc(ot,Te.zoom,ye.paint.get("heatmap-intensity"),Bt),null,Nt,ye.id,tt.layoutVertexBuffer,tt.indexBuffer,tt.segments,ye.paint,Te.zoom,nt)}be.viewport.set([0,0,oe.width,oe.height])})(I,B,N,H):I.renderPass==="translucent"&&(function(oe,me){const ye=oe.context,_e=ye.gl;ye.setColorMode(oe.colorModeForRenderPass());const be=me.heatmapFbos.get(s.c2);be&&(ye.activeTexture.set(_e.TEXTURE0),_e.bindTexture(_e.TEXTURE_2D,be.colorAttachment.get()),ye.activeTexture.set(_e.TEXTURE1),jl(ye,me).bind(_e.LINEAR,_e.CLAMP_TO_EDGE),oe.useProgram("heatmapTexture").draw(ye,_e.TRIANGLES,yr.disabled,zr.disabled,oe.colorModeForRenderPass(),hr.disabled,rp(oe,me,0,1),null,null,me.id,oe.viewportBuffer,oe.quadTriangleIndexBuffer,oe.viewportSegments,me.paint,oe.transform.zoom))})(I,N)})(o,d,y,w,C):s.ce(y)?(function(I,B,N,H,W){if(I.renderPass!=="translucent")return;const{isRenderingToTexture:K}=W,Z=N.paint.get("line-opacity"),te=N.paint.get("line-width");if(Z.constantOr(1)===0||te.constantOr(1)===0)return;const oe=I.getDepthModeForSublayer(0,yr.ReadOnly),me=I.colorModeForRenderPass(),ye=N.paint.get("line-dasharray"),_e=ye.constantOr(1),be=N.paint.get("line-pattern"),Ee=be.constantOr(1),Te=N.paint.get("line-gradient"),Oe=N.getCrossfadeParameters(),Ne=Ee?"linePattern":_e?"lineSDF":Te?"lineGradient":"line",Ce=I.context,ze=Ce.gl,ot=I.transform;let tt=!0;for(const nt of H){const lt=B.getTile(nt);if(Ee&&!lt.patternsLoaded())continue;const Nt=lt.getBucket(N);if(!Nt)continue;const Bt=Nt.programConfigurations.get(N.id),Tt=I.context.program.get(),qt=I.useProgram(Ne,Bt),wr=tt||qt.program!==Tt,Yr=I.style.map.terrain&&I.style.map.terrain.getTerrainData(nt),xn=be.constantOr(null),pn=ye&&ye.constantOr(null);if(xn&&lt.imageAtlas){const on=lt.imageAtlas,hn=on.patternPositions[xn.to.toString()],Or=on.patternPositions[xn.from.toString()];hn&&Or&&Bt.setConstantPatternPositions(hn,Or)}else if(pn){const on=N.layout.get("line-cap")==="round",hn=I.lineAtlas.getDash(pn.to,on),Or=I.lineAtlas.getDash(pn.from,on);Bt.setConstantDashPositions(hn,Or)}const En=ot.getProjectionData({overscaledTileID:nt,applyGlobeMatrix:!K,applyTerrainMatrix:!0}),wn=ot.getPixelScale(),xi=Ee?Yg(I,lt,N,wn,Oe):_e?so(I,lt,N,wn,Oe):Te?bu(I,lt,N,wn,Nt.lineClipsArray.length):Bl(I,lt,N,wn);if(Ee)Ce.activeTexture.set(ze.TEXTURE0),lt.imageAtlasTexture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),Bt.updatePaintBuffers(Oe);else if(_e)(wr||I.lineAtlas.dirty)&&(Ce.activeTexture.set(ze.TEXTURE0),I.lineAtlas.bind(Ce)),Bt.updatePaintBuffers(Oe);else if(Te){const on=Nt.gradients[N.id];let hn=on.texture;if(N.gradientVersion!==on.version){let Or=256;if(N.stepInterpolant){const wi=B.getSource().maxzoom,_a=nt.canonical.z===wi?Math.ceil(1<<I.transform.maxZoom-nt.canonical.z):1;Or=s.ah(s.c3(Nt.maxLineLength/s.$*1024*_a),256,Ce.maxTextureSize)}on.gradient=s.c4({expression:N.gradientExpression(),evaluationKey:"lineProgress",resolution:Or,image:on.gradient||void 0,clips:Nt.lineClipsArray}),on.texture?on.texture.update(on.gradient):on.texture=new s.T(Ce,on.gradient,ze.RGBA),on.version=N.gradientVersion,hn=on.texture}Ce.activeTexture.set(ze.TEXTURE0),hn.bind(N.stepInterpolant?ze.NEAREST:ze.LINEAR,ze.CLAMP_TO_EDGE)}const Cn=I.stencilModeForClipping(nt);qt.draw(Ce,ze.TRIANGLES,oe,Cn,me,hr.disabled,xi,Yr,En,N.id,Nt.layoutVertexBuffer,Nt.indexBuffer,Nt.segments,N.paint,I.transform.zoom,Bt,Nt.layoutVertexBuffer2),tt=!1}})(o,d,y,w,C):s.cf(y)?(function(I,B,N,H,W){const K=N.paint.get("fill-color"),Z=N.paint.get("fill-opacity");if(Z.constantOr(1)===0)return;const{isRenderingToTexture:te}=W,oe=I.colorModeForRenderPass(),me=N.paint.get("fill-pattern"),ye=I.opaquePassEnabledForLayer()&&!me.constantOr(1)&&K.constantOr(s.bf.transparent).a===1&&Z.constantOr(0)===1?"opaque":"translucent";if(I.renderPass===ye){const _e=I.getDepthModeForSublayer(1,I.renderPass==="opaque"?yr.ReadWrite:yr.ReadOnly);Ui(I,B,N,H,_e,oe,!1,te)}if(I.renderPass==="translucent"&&N.paint.get("fill-antialias")){const _e=I.getDepthModeForSublayer(N.getPaintProperty("fill-outline-color")?2:0,yr.ReadOnly);Ui(I,B,N,H,_e,oe,!0,te)}})(o,d,y,w,C):s.cg(y)?(function(I,B,N,H,W){const K=N.paint.get("fill-extrusion-opacity");if(K===0)return;const{isRenderingToTexture:Z}=W;if(I.renderPass==="translucent"){const te=new yr(I.context.gl.LEQUAL,yr.ReadWrite,I.depthRangeFor3D);if(K!==1||N.paint.get("fill-extrusion-pattern").constantOr(1))ss(I,B,N,H,te,zr.disabled,sn.disabled,Z),ss(I,B,N,H,te,I.stencilModeFor3D(),I.colorModeForRenderPass(),Z);else{const oe=I.colorModeForRenderPass();ss(I,B,N,H,te,zr.disabled,oe,Z)}}})(o,d,y,w,C):s.ch(y)?(function(I,B,N,H,W){if(I.renderPass!=="offscreen"&&I.renderPass!=="translucent")return;const{isRenderingToTexture:K}=W,Z=I.context,te=I.style.projection.useSubdivision,oe=I.getDepthModeForSublayer(0,yr.ReadOnly),me=I.colorModeForRenderPass();if(I.renderPass==="offscreen")(function(ye,_e,be,Ee,Te,Oe,Ne){const Ce=ye.context,ze=Ce.gl;for(const ot of be){const tt=_e.getTile(ot),nt=tt.dem;if(!nt||!nt.data||!tt.needsHillshadePrepare)continue;const lt=nt.dim,Nt=nt.stride,Bt=nt.getPixels();if(Ce.activeTexture.set(ze.TEXTURE1),Ce.pixelStoreUnpackPremultiplyAlpha.set(!1),tt.demTexture=tt.demTexture||ye.getTileTexture(Nt),tt.demTexture){const qt=tt.demTexture;qt.update(Bt,{premultiply:!1}),qt.bind(ze.NEAREST,ze.CLAMP_TO_EDGE)}else tt.demTexture=new s.T(Ce,Bt,ze.RGBA,{premultiply:!1}),tt.demTexture.bind(ze.NEAREST,ze.CLAMP_TO_EDGE);Ce.activeTexture.set(ze.TEXTURE0);let Tt=tt.fbo;if(!Tt){const qt=new s.T(Ce,{width:lt,height:lt,data:null},ze.RGBA);qt.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),Tt=tt.fbo=Ce.createFramebuffer(lt,lt,!0,!1),Tt.colorAttachment.set(qt.texture)}Ce.bindFramebuffer.set(Tt.framebuffer),Ce.viewport.set([0,0,lt,lt]),ye.useProgram("hillshadePrepare").draw(Ce,ze.TRIANGLES,Te,Oe,Ne,hr.disabled,Zg(tt.tileID,nt),null,null,Ee.id,ye.rasterBoundsBuffer,ye.quadTriangleIndexBuffer,ye.rasterBoundsSegments),tt.needsHillshadePrepare=!1}})(I,B,H,N,oe,zr.disabled,me),Z.viewport.set([0,0,I.width,I.height]);else if(I.renderPass==="translucent")if(te){const[ye,_e,be]=I.stencilConfigForOverlapTwoPass(H);po(I,B,N,be,ye,oe,me,!1,K),po(I,B,N,be,_e,oe,me,!0,K)}else{const[ye,_e]=I.getStencilConfigForOverlapAndUpdateStencilID(H);po(I,B,N,_e,ye,oe,me,!1,K)}})(o,d,y,w,C):s.ci(y)?(function(I,B,N,H,W){if(I.renderPass!=="translucent"||!H.length)return;const{isRenderingToTexture:K}=W,Z=I.style.projection.useSubdivision,te=I.getDepthModeForSublayer(0,yr.ReadOnly),oe=I.colorModeForRenderPass();if(Z){const[me,ye,_e]=I.stencilConfigForOverlapTwoPass(H);as(I,B,N,_e,me,te,oe,!1,K),as(I,B,N,_e,ye,te,oe,!0,K)}else{const[me,ye]=I.getStencilConfigForOverlapAndUpdateStencilID(H);as(I,B,N,ye,me,te,oe,!1,K)}})(o,d,y,w,C):s.cj(y)?(function(I,B,N,H,W){if(I.renderPass!=="translucent"||N.paint.get("raster-opacity")===0||!H.length)return;const{isRenderingToTexture:K}=W,Z=B.getSource(),te=I.style.projection.useSubdivision;if(Z instanceof pa)ra(I,B,N,H,null,!1,!1,Z.tileCoords,Z.flippedWindingOrder,K);else if(te){const[oe,me,ye]=I.stencilConfigForOverlapTwoPass(H);ra(I,B,N,ye,oe,!1,!0,ya,!1,K),ra(I,B,N,ye,me,!0,!0,ya,!1,K)}else{const[oe,me]=I.getStencilConfigForOverlapAndUpdateStencilID(H);ra(I,B,N,me,oe,!1,!0,ya,!1,K)}})(o,d,y,w,C):s.ck(y)?(function(I,B,N,H,W){const K=N.paint.get("background-color"),Z=N.paint.get("background-opacity");if(Z===0)return;const{isRenderingToTexture:te}=W,oe=I.context,me=oe.gl,ye=I.style.projection,_e=I.transform,be=_e.tileSize,Ee=N.paint.get("background-pattern");if(I.isPatternMissing(Ee))return;const Te=!Ee&&K.a===1&&Z===1&&I.opaquePassEnabledForLayer()?"opaque":"translucent";if(I.renderPass!==Te)return;const Oe=zr.disabled,Ne=I.getDepthModeForSublayer(0,Te==="opaque"?yr.ReadWrite:yr.ReadOnly),Ce=I.colorModeForRenderPass(),ze=I.useProgram(Ee?"backgroundPattern":"background"),ot=H||He(_e,{tileSize:be,terrain:I.style.map.terrain});Ee&&(oe.activeTexture.set(me.TEXTURE0),I.imageManager.bind(I.context));const tt=N.getCrossfadeParameters();for(const nt of ot){const lt=_e.getProjectionData({overscaledTileID:nt,applyGlobeMatrix:!te,applyTerrainMatrix:!0}),Nt=Ee?Jg(Z,I,Ee,{tileID:nt,tileSize:be},tt):Qg(Z,K),Bt=I.style.map.terrain&&I.style.map.terrain.getTerrainData(nt),Tt=ye.getMeshFromTileID(oe,nt.canonical,!1,!0,"raster");ze.draw(oe,me.TRIANGLES,Ne,Oe,Ce,hr.backCCW,Nt,Bt,lt,N.id,Tt.vertexBuffer,Tt.indexBuffer,Tt.segments)}})(o,0,y,w,C):s.cl(y)&&(function(I,B,N,H){const{isRenderingGlobe:W}=H,K=I.context,Z=N.implementation,te=I.style.projection,oe=I.transform,me=oe.getProjectionDataForCustomLayer(W),ye={farZ:oe.farZ,nearZ:oe.nearZ,fov:oe.fov*Math.PI/180,modelViewProjectionMatrix:oe.modelViewProjectionMatrix,projectionMatrix:oe.projectionMatrix,shaderData:{variantName:te.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${te.shaderPreludeCode.vertexSource}`,define:te.shaderDefine},defaultProjectionData:me},_e=Z.renderingMode?Z.renderingMode:"2d";if(I.renderPass==="offscreen"){const be=Z.prerender;be&&(I.setCustomLayerDefaults(),K.setColorMode(I.colorModeForRenderPass()),be.call(Z,K.gl,ye),K.setDirty(),I.setBaseState())}else if(I.renderPass==="translucent"){I.setCustomLayerDefaults(),K.setColorMode(I.colorModeForRenderPass()),K.setStencilMode(zr.disabled);const be=_e==="3d"?I.getDepthModeFor3D():I.getDepthModeForSublayer(0,yr.ReadOnly);K.setDepthMode(be),Z.render(K.gl,ye),K.setDirty(),I.setBaseState(),K.bindFramebuffer.set(null)}})(o,0,y,C))}saveTileTexture(o){const d=this._tileTextures[o.size[0]];d?d.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const d=this._tileTextures[o];return d&&d.length>0?d.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const d=this.imageManager.getPattern(o.from.toString()),y=this.imageManager.getPattern(o.to.toString());return!d||!y}useProgram(o,d,y=!1,w=[]){this.cache=this.cache||{};const C=!!this.style.map.terrain,I=this.style.projection,B=y?ts.projectionMercator:I.shaderPreludeCode,N=y?La:I.shaderDefine,H=o+(d?d.cacheKey:"")+`/${y?Sc:I.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(C?"/terrain":"")+(w?`/${w.join("/")}`:"");return this.cache[H]||(this.cache[H]=new ep(this.context,ts[o],d,op[o],this._showOverdrawInspector,C,B,N,w)),this.cache[H]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:o,drawingBufferHeight:d}=this.context.gl;return this.width!==o||this.height!==d}}function Vl(E,o){let d,y=!1,w=null,C=null;const I=()=>{w=null,y&&(E.apply(C,d),w=setTimeout(I,o),y=!1)};return(...B)=>(y=!0,C=this,d=B,w||I(),w)}class na{constructor(o){this._getCurrentHash=()=>{const d=window.location.hash.replace("#","");if(this._hashName){let y;return d.split("&").map((w=>w.split("="))).forEach((w=>{w[0]===this._hashName&&(y=w)})),(y&&y[1]||"").split("/")}return d.split("/")},this._onHashChange=()=>{const d=this._getCurrentHash();if(!this._isValidHash(d))return!1;const y=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(d[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:y,pitch:+(d[4]||0)}),!0},this._updateHashUnthrottled=()=>{const d=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,d)},this._removeHash=()=>{const d=this._getCurrentHash();if(d.length===0)return;const y=d.join("/");let w=y;w.split("&").length>0&&(w=w.split("&")[0]),this._hashName&&(w=`${this._hashName}=${y}`);let C=window.location.hash.replace(w,"");C.startsWith("#&")?C=C.slice(0,1)+C.slice(2):C==="#"&&(C="");let I=window.location.href.replace(/(#.+)?$/,C);I=I.replace("&&","&"),window.history.replaceState(window.history.state,null,I)},this._updateHash=Vl(this._updateHashUnthrottled,300),this._hashName=o&&encodeURIComponent(o)}addTo(o){return this._map=o,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(o){const d=this._map.getCenter(),y=Math.round(100*this._map.getZoom())/100,w=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),C=Math.pow(10,w),I=Math.round(d.lng*C)/C,B=Math.round(d.lat*C)/C,N=this._map.getBearing(),H=this._map.getPitch();let W="";if(W+=o?`/${I}/${B}/${y}`:`${y}/${B}/${I}`,(N||H)&&(W+="/"+Math.round(10*N)/10),H&&(W+=`/${Math.round(H)}`),this._hashName){const K=this._hashName;let Z=!1;const te=window.location.hash.slice(1).split("&").map((oe=>{const me=oe.split("=")[0];return me===K?(Z=!0,`${me}=${W}`):oe})).filter((oe=>oe));return Z||te.push(`${K}=${W}`),`#${te.join("&")}`}return`#${W}`}_isValidHash(o){if(o.length<3||o.some(isNaN))return!1;try{new s.S(+o[2],+o[1])}catch{return!1}const d=+o[0],y=+(o[3]||0),w=+(o[4]||0);return d>=this._map.getMinZoom()&&d<=this._map.getMaxZoom()&&y>=-180&&y<=180&&w>=this._map.getMinPitch()&&w<=this._map.getMaxPitch()}}const $o={linearity:.3,easing:s.cm(0,0,.3,1)},Ho=s.e({deceleration:2500,maxSpeed:1400},$o),Nh=s.e({deceleration:20,maxSpeed:1400},$o),$l=s.e({deceleration:1e3,maxSpeed:360},$o),mo=s.e({deceleration:1e3,maxSpeed:90},$o),Wo=s.e({deceleration:1e3,maxSpeed:360},$o);class yo{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:M.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,d=M.now();for(;o.length>0&&d-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,roll:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:C}of this._inertiaBuffer)d.zoom+=C.zoomDelta||0,d.bearing+=C.bearingDelta||0,d.pitch+=C.pitchDelta||0,d.roll+=C.rollDelta||0,C.panDelta&&d.pan._add(C.panDelta),C.around&&(d.around=C.around),C.pinchAround&&(d.pinchAround=C.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,w={};if(d.pan.mag()){const C=ia(d.pan.mag(),y,s.e({},Ho,o||{})),I=d.pan.mult(C.amount/d.pan.mag()),B=this._map.cameraHelper.handlePanInertia(I,this._map.transform);w.center=B.easingCenter,w.offset=B.easingOffset,Hl(w,C)}if(d.zoom){const C=ia(d.zoom,y,Nh);w.zoom=this._map.transform.zoom+C.amount,Hl(w,C)}if(d.bearing){const C=ia(d.bearing,y,$l);w.bearing=this._map.transform.bearing+s.ah(C.amount,-179,179),Hl(w,C)}if(d.pitch){const C=ia(d.pitch,y,mo);w.pitch=this._map.transform.pitch+C.amount,Hl(w,C)}if(d.roll){const C=ia(d.roll,y,Wo);w.roll=this._map.transform.roll+s.ah(C.amount,-179,179),Hl(w,C)}if(w.zoom||w.bearing){const C=d.pinchAround===void 0?d.around:d.pinchAround;w.around=C?this._map.unproject(C):this._map.getCenter()}return this.clear(),s.e(w,{noMoveStart:!0})}}function Hl(E,o){(!E.duration||E.duration<o.duration)&&(E.duration=o.duration,E.easing=o.easing)}function ia(E,o,d){const{maxSpeed:y,linearity:w,deceleration:C}=d,I=s.ah(E*w/(o/1e3),-y,y),B=Math.abs(I)/(C*w);return{easing:d.easing,duration:1e3*B,amount:I*(B/2)}}class Ri extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,y,w={}){y=y instanceof MouseEvent?y:new MouseEvent(o,y);const C=O.mousePos(d.getCanvas(),y),I=d.unproject(C);super(o,s.e({point:C,lngLat:I,originalEvent:y},w)),this._defaultPrevented=!1,this.target=d}}class qo extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,y){const w=o==="touchend"?y.changedTouches:y.touches,C=O.touchPos(d.getCanvasContainer(),w),I=C.map((N=>d.unproject(N))),B=C.reduce(((N,H,W,K)=>N.add(H.div(K.length))),new s.P(0,0));super(o,{points:C,point:B,lngLats:I,lngLat:d.unproject(B),originalEvent:y}),this._defaultPrevented=!1}}class Go extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,y){super(o,{originalEvent:y}),this._defaultPrevented=!1}}class ji{constructor(o,d){this._map=o,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new Go(o.type,this._map,o))}mousedown(o,d){return this._mousedownPos=d,this._firePreventable(new Ri(o.type,this._map,o))}mouseup(o){this._map.fire(new Ri(o.type,this._map,o))}click(o,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Ri(o.type,this._map,o))}dblclick(o){return this._firePreventable(new Ri(o.type,this._map,o))}mouseover(o){this._map.fire(new Ri(o.type,this._map,o))}mouseout(o){this._map.fire(new Ri(o.type,this._map,o))}touchstart(o){return this._firePreventable(new qo(o.type,this._map,o))}touchmove(o){this._map.fire(new qo(o.type,this._map,o))}touchend(o){this._map.fire(new qo(o.type,this._map,o))}touchcancel(o){this._map.fire(new qo(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class zh{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(o){this._map.fire(new Ri(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ri("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._ignoreContextMenu||this._map.fire(new Ri(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Lc{constructor(o){this._map=o}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(o){return this.transform.screenPointToLocation(s.P.convert(o),this._map.terrain)}}class pp{constructor(o,d){this._map=o,this._tr=new Lc(o),this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,d){this.isEnabled()&&o.shiftKey&&o.button===0&&(O.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(o,d){if(!this._active)return;const y=d;if(this._lastPos.equals(y)||!this._box&&y.dist(this._startPos)<this._clickTolerance)return;const w=this._startPos;this._lastPos=y,this._box||(this._box=O.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",o));const C=Math.min(w.x,y.x),I=Math.max(w.x,y.x),B=Math.min(w.y,y.y),N=Math.max(w.y,y.y);O.setTransform(this._box,`translate(${C}px,${B}px)`),this._box.style.width=I-C+"px",this._box.style.height=N-B+"px"}mouseupWindow(o,d){if(!this._active||o.button!==0)return;const y=this._startPos,w=d;if(this.reset(),O.suppressClick(),y.x!==w.x||y.y!==w.y)return this._map.fire(new s.l("boxzoomend",{originalEvent:o})),{cameraAnimation:C=>C.fitScreenCoordinates(y,w,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(O.remove(this._box),this._box=null),O.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,d){return this._map.fire(new s.l(o,{originalEvent:d}))}}function Wf(E,o){if(E.length!==o.length)throw new Error(`The number of touches and points are not equal - touches ${E.length}, points ${o.length}`);const d={};for(let y=0;y<E.length;y++)d[E[y].identifier]=o[y];return d}class qf{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,d,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=o.timeStamp),y.length===this.numTouches&&(this.centroid=(function(w){const C=new s.P(0,0);for(const I of w)C._add(I);return C.div(w.length)})(d),this.touches=Wf(y,d)))}touchmove(o,d,y){if(this.aborted||!this.centroid)return;const w=Wf(y,d);for(const C in this.touches){const I=w[C];(!I||I.dist(this.touches[C])>30)&&(this.aborted=!0)}}touchend(o,d,y){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),y.length===0){const w=!this.aborted&&this.centroid;if(this.reset(),w)return w}}}class Zn{constructor(o){this.singleTap=new qf(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,d,y){this.singleTap.touchstart(o,d,y)}touchmove(o,d,y){this.singleTap.touchmove(o,d,y)}touchend(o,d,y){const w=this.singleTap.touchend(o,d,y);if(w){const C=o.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(w)<30;if(C&&I||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=w,this.count===this.numTaps)return this.reset(),w}}}class Us{constructor(o){this._tr=new Lc(o),this._zoomIn=new Zn({numTouches:1,numTaps:2}),this._zoomOut=new Zn({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,d,y){this._zoomIn.touchstart(o,d,y),this._zoomOut.touchstart(o,d,y)}touchmove(o,d,y){this._zoomIn.touchmove(o,d,y),this._zoomOut.touchmove(o,d,y)}touchend(o,d,y){const w=this._zoomIn.touchend(o,d,y),C=this._zoomOut.touchend(o,d,y),I=this._tr;return w?(this._active=!0,o.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:B=>B.easeTo({duration:300,zoom:I.zoom+1,around:I.unproject(w)},{originalEvent:o})}):C?(this._active=!0,o.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:B=>B.easeTo({duration:300,zoom:I.zoom-1,around:I.unproject(C)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Oi{constructor(o){this._enabled=!!o.enable,this._moveStateManager=o.moveStateManager,this._clickTolerance=o.clickTolerance||1,this._moveFunction=o.move,this._activateOnStart=!!o.activateOnStart,o.assignEvents(this),this.reset()}reset(o){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(o)}_move(...o){const d=this._moveFunction(...o);if(d.bearingDelta||d.pitchDelta||d.rollDelta||d.around||d.panDelta)return this._active=!0,d}dragStart(o,d){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(o)&&(this._moveStateManager.startMove(o),this._lastPoint=Array.isArray(d)?d[0]:d,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(o,d){if(!this.isEnabled())return;const y=this._lastPoint;if(!y)return;if(o.preventDefault(),!this._moveStateManager.isValidMoveEvent(o))return void this.reset(o);const w=Array.isArray(d)?d[0]:d;return!this._moved&&w.dist(y)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=w,this._move(y,w))}dragEnd(o){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(o)&&(this._moved&&O.suppressClick(),this.reset(o))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Eu=0,sa=2,za={[Eu]:1,[sa]:2};class _o{constructor(o){this._correctEvent=o.checkCorrectEvent}startMove(o){const d=O.mouseButton(o);this._eventButton=d}endMove(o){delete this._eventButton}isValidStartEvent(o){return this._correctEvent(o)}isValidMoveEvent(o){return!(function(d,y){const w=za[y];return d.buttons===void 0||(d.buttons&w)!==w})(o,this._eventButton)}isValidEndEvent(o){return O.mouseButton(o)===this._eventButton}}class e_{constructor(){this._firstTouch=void 0}_isOneFingerTouch(o){return o.targetTouches.length===1}_isSameTouchEvent(o){return o.targetTouches[0].identifier===this._firstTouch}startMove(o){this._firstTouch=o.targetTouches[0].identifier}endMove(o){delete this._firstTouch}isValidStartEvent(o){return this._isOneFingerTouch(o)}isValidMoveEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}isValidEndEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}}class nm{constructor(o=new _o({checkCorrectEvent:()=>!0}),d=new e_){this.mouseMoveStateManager=o,this.oneFingerTouchMoveStateManager=d}_executeRelevantHandler(o,d,y){return o instanceof MouseEvent?d(o):typeof TouchEvent<"u"&&o instanceof TouchEvent?y(o):void 0}startMove(o){this._executeRelevantHandler(o,(d=>this.mouseMoveStateManager.startMove(d)),(d=>this.oneFingerTouchMoveStateManager.startMove(d)))}endMove(o){this._executeRelevantHandler(o,(d=>this.mouseMoveStateManager.endMove(d)),(d=>this.oneFingerTouchMoveStateManager.endMove(d)))}isValidStartEvent(o){return this._executeRelevantHandler(o,(d=>this.mouseMoveStateManager.isValidStartEvent(d)),(d=>this.oneFingerTouchMoveStateManager.isValidStartEvent(d)))}isValidMoveEvent(o){return this._executeRelevantHandler(o,(d=>this.mouseMoveStateManager.isValidMoveEvent(d)),(d=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(d)))}isValidEndEvent(o){return this._executeRelevantHandler(o,(d=>this.mouseMoveStateManager.isValidEndEvent(d)),(d=>this.oneFingerTouchMoveStateManager.isValidEndEvent(d)))}}const Gf=E=>{E.mousedown=E.dragStart,E.mousemoveWindow=E.dragMove,E.mouseup=E.dragEnd,E.contextmenu=o=>{o.preventDefault()}};class gp{constructor(o,d){this._clickTolerance=o.clickTolerance||1,this._map=d,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}_shouldBePrevented(o){return o<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(o,d,y){return this._calculateTransform(o,d,y)}touchmove(o,d,y){if(this._active){if(!this._shouldBePrevented(y.length))return o.preventDefault(),this._calculateTransform(o,d,y);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",o)}}touchend(o,d,y){this._calculateTransform(o,d,y),this._active&&this._shouldBePrevented(y.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,d,y){y.length>0&&(this._active=!0);const w=Wf(y,d),C=new s.P(0,0),I=new s.P(0,0);let B=0;for(const H in w){const W=w[H],K=this._touches[H];K&&(C._add(W),I._add(W.sub(K)),B++,w[H]=W)}if(this._touches=w,this._shouldBePrevented(B)||!I.mag())return;const N=I.div(B);return this._sum._add(N),this._sum.mag()<this._clickTolerance?void 0:{around:C.div(B),panDelta:N}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class aa{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(o,d,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([d[0],d[1]]))}touchmove(o,d,y){if(!this._firstTwoTouches)return;o.preventDefault();const[w,C]=this._firstTwoTouches,I=js(y,d,w),B=js(y,d,C);if(!I||!B)return;const N=this._aroundCenter?null:I.add(B).div(2);return this._move([I,B],N,o)}touchend(o,d,y){if(!this._firstTwoTouches)return;const[w,C]=this._firstTwoTouches,I=js(y,d,w),B=js(y,d,C);I&&B||(this._active&&O.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function js(E,o,d){for(let y=0;y<E.length;y++)if(E[y].identifier===d)return o[y]}function Ht(E,o){return Math.log(E/o)/Math.LN2}class Xf extends aa{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,d){const y=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(Ht(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ht(this._distance,y),pinchAround:d}}}function Xo(E,o){return 180*E.angleWith(o)/Math.PI}class Fh extends aa{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,d,y){const w=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Xo(this._vector,w),pinchAround:d}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const d=25/(Math.PI*this._minDiameter)*360,y=Xo(o,this._startVector);return Math.abs(y)<d}}function vo(E){return Math.abs(E.y)>Math.abs(E.x)}class Zo extends aa{constructor(o){super(),this._currentTouchCount=0,this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(o,d,y){super.touchstart(o,d,y),this._currentTouchCount=y.length}_start(o){this._lastPoints=o,vo(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,d,y){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const w=o[0].sub(this._lastPoints[0]),C=o[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(w,C,y.timeStamp),this._valid?(this._lastPoints=o,this._active=!0,{pitchDelta:(w.y+C.y)/2*-.5}):void 0}gestureBeginsVertically(o,d,y){if(this._valid!==void 0)return this._valid;const w=o.mag()>=2,C=d.mag()>=2;if(!w&&!C)return;if(!w||!C)return this._firstMove===void 0&&(this._firstMove=y),y-this._firstMove<100&&void 0;const I=o.y>0==d.y>0;return vo(o)&&vo(d)&&I}}const Zf={panStep:100,bearingStep:15,pitchStep:10};class Br{constructor(o){this._tr=new Lc(o);const d=Zf;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let d=0,y=0,w=0,C=0,I=0;switch(o.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:o.shiftKey?y=-1:(o.preventDefault(),C=-1);break;case 39:o.shiftKey?y=1:(o.preventDefault(),C=1);break;case 38:o.shiftKey?w=1:(o.preventDefault(),I=-1);break;case 40:o.shiftKey?w=-1:(o.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(y=0,w=0),{cameraAnimation:B=>{const N=this._tr;B.easeTo({duration:300,easeId:"keyboardHandler",easing:Yo,zoom:d?Math.round(N.zoom)+d*(o.shiftKey?2:1):N.zoom,bearing:N.bearing+y*this._bearingStep,pitch:N.pitch+w*this._pitchStep,offset:[-C*this._panStep,-I*this._panStep],center:N.center},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Yo(E){return E*(2-E)}const Wl=4.000244140625,Yf=1/450;class mp{constructor(o,d){this._onTimeout=y=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(y)},this._map=o,this._tr=new Lc(o),this._triggerRenderFrame=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Yf}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(o){return!!this._map.cooperativeGestures.isEnabled()&&!(o.ctrlKey||this._map.cooperativeGestures.isBypassed(o))}wheel(o){if(!this.isEnabled())return;if(this._shouldBePrevented(o))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",o);let d=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const y=M.now(),w=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,d!==0&&d%Wl==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":w>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(w*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),o.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=o,this._delta-=d,this._active||this._start(o)),o.preventDefault()}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=O.mousePos(this._map.getCanvas(),o),y=this._tr;this._aroundPoint=this._aroundCenter?y.transform.locationToScreenPoint(s.S.convert(y.center)):d,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const B=o.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=B),typeof this._targetZoom=="number"&&(this._targetZoom+=B)}if(this._delta!==0){const B=this._type==="wheel"&&Math.abs(this._delta)>Wl?this._wheelZoomRate:this._defaultZoomRate;let N=2/(1+Math.exp(-Math.abs(this._delta*B)));this._delta<0&&N!==0&&(N=1/N);const H=typeof this._targetZoom!="number"?o.scale:s.af(this._targetZoom);this._targetZoom=o.getConstrained(o.getCameraLngLat(),s.ak(H*N)).zoom,this._type==="wheel"&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom!="number"?o.zoom:this._targetZoom,y=this._startZoom,w=this._easing;let C,I=!1;if(this._type==="wheel"&&y&&w){const B=M.now()-this._lastWheelEventTime,N=Math.min((B+5)/200,1),H=w(N);C=s.C.number(y,d,H),N<1?this._frameId||(this._frameId=!0):I=!0}else C=d,I=!0;return this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=C,{noInertia:!0,needsRenderFrame:!I,zoomDelta:C-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let d=s.co;if(this._prevEase){const y=this._prevEase,w=(M.now()-y.start)/y.duration,C=y.easing(w+.01)-y.easing(w),I=.27/Math.sqrt(C*C+1e-4)*.01,B=Math.sqrt(.0729-I*I);d=s.cm(I,B,.25,1)}return this._prevEase={start:M.now(),duration:o,easing:d},d}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Bc{constructor(o,d){this._clickZoom=o,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Cu{constructor(o){this._tr=new Lc(o),this.reset()}reset(){this._active=!1}dblclick(o,d){return o.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:this._tr.zoom+(o.shiftKey?-1:1),around:this._tr.unproject(d)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pu{constructor(){this._tap=new Zn({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(o,d,y){if(!this._swipePoint)if(this._tapTime){const w=d[0],C=o.timeStamp-this._tapTime<500,I=this._tapPoint.dist(w)<30;C&&I?y.length>0&&(this._swipePoint=w,this._swipeTouch=y[0].identifier):this.reset()}else this._tap.touchstart(o,d,y)}touchmove(o,d,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const w=d[0],C=w.y-this._swipePoint.y;return this._swipePoint=w,o.preventDefault(),this._active=!0,{zoomDelta:C/128}}}else this._tap.touchmove(o,d,y)}touchend(o,d,y){if(this._tapTime)this._swipePoint&&y.length===0&&this.reset();else{const w=this._tap.touchend(o,d,y);w&&(this._tapTime=o.timeStamp,this._tapPoint=w)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nc{constructor(o,d,y){this._el=o,this._mousePan=d,this._touchPan=y}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Uh{constructor(o,d,y,w){this._pitchWithRotate=o.pitchWithRotate,this._rollEnabled=o.rollEnabled,this._mouseRotate=d,this._mousePitch=y,this._mouseRoll=w}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Kf{constructor(o,d,y,w){this._el=o,this._touchZoom=d,this._touchRotate=y,this._tapDragZoom=w,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ql{constructor(o,d){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=o,this._options=d,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const o=this._map.getCanvasContainer();o.classList.add("maplibregl-cooperative-gestures"),this._container=O.create("div","maplibregl-cooperative-gesture-screen",o);let d=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(d=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const y=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),w=document.createElement("div");w.className="maplibregl-desktop-message",w.textContent=d,this._container.appendChild(w);const C=document.createElement("div");C.className="maplibregl-mobile-message",C.textContent=y,this._container.appendChild(C),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(O.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(o){return o[this._bypassKey]}notifyGestureBlocked(o,d){this._enabled&&(this._map.fire(new s.l("cooperativegestureprevented",{gestureType:o,originalEvent:d})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const jh=E=>E.zoom||E.drag||E.roll||E.pitch||E.rotate;class vs extends s.l{}function Qr(E){return E.panDelta&&E.panDelta.mag()||E.zoomDelta||E.bearingDelta||E.pitchDelta||E.rollDelta}class yp{constructor(o,d){this.handleWindowEvent=w=>{this.handleEvent(w,`${w.type}Window`)},this.handleEvent=(w,C)=>{if(w.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const I=w.type==="renderFrame"?void 0:w,B={needsRenderFrame:!1},N={},H={};for(const{handlerName:Z,handler:te,allowed:oe}of this._handlers){if(!te.isEnabled())continue;let me;if(this._blockedByActive(H,oe,Z))te.reset();else if(te[C||w.type]){if(s.cp(w,C||w.type)){const ye=O.mousePos(this._map.getCanvas(),w);me=te[C||w.type](w,ye)}else if(s.cq(w,C||w.type)){const ye=this._getMapTouches(w.touches),_e=O.touchPos(this._map.getCanvas(),ye);me=te[C||w.type](w,_e,ye)}else s.cr(C||w.type)||(me=te[C||w.type](w));this.mergeHandlerResult(B,N,me,Z,I),me&&me.needsRenderFrame&&this._triggerRenderFrame()}(me||te.isActive())&&(H[Z]=te)}const W={};for(const Z in this._previousActiveHandlers)H[Z]||(W[Z]=I);this._previousActiveHandlers=H,(Object.keys(W).length||Qr(B))&&(this._changes.push([B,N,W]),this._triggerRenderFrame()),(Object.keys(H).length||Qr(B))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:K}=B;K&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],K(this._map))},this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new yo(o),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[window,"blur",void 0]];for(const[w,C,I]of this._listeners)O.addEventListener(w,C,w===document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[o,d,y]of this._listeners)O.removeEventListener(o,d,o===document?this.handleWindowEvent:this.handleEvent,y)}_addDefaultHandlers(o){const d=this._map,y=d.getCanvasContainer();this._add("mapEvent",new ji(d,o));const w=d.boxZoom=new pp(d,o);this._add("boxZoom",w),o.interactive&&o.boxZoom&&w.enable();const C=d.cooperativeGestures=new ql(d,o.cooperativeGestures);this._add("cooperativeGestures",C),o.cooperativeGestures&&C.enable();const I=new Us(d),B=new Cu(d);d.doubleClickZoom=new Bc(B,I),this._add("tapZoom",I),this._add("clickZoom",B),o.interactive&&o.doubleClickZoom&&d.doubleClickZoom.enable();const N=new Pu;this._add("tapDragZoom",N);const H=d.touchPitch=new Zo(d);this._add("touchPitch",H),o.interactive&&o.touchPitch&&d.touchPitch.enable(o.touchPitch);const W=()=>d.project(d.getCenter()),K=(function({enable:Te,clickTolerance:Oe,aroundCenter:Ne=!0,minPixelCenterThreshold:Ce=100,rotateDegreesPerPixelMoved:ze=.8},ot){const tt=new _o({checkCorrectEvent:nt=>O.mouseButton(nt)===0&&nt.ctrlKey||O.mouseButton(nt)===2&&!nt.ctrlKey});return new Oi({clickTolerance:Oe,move:(nt,lt)=>{const Nt=ot();if(Ne&&Math.abs(Nt.y-nt.y)>Ce)return{bearingDelta:s.cn(new s.P(nt.x,lt.y),lt,Nt)};let Bt=(lt.x-nt.x)*ze;return Ne&&lt.y<Nt.y&&(Bt=-Bt),{bearingDelta:Bt}},moveStateManager:tt,enable:Te,assignEvents:Gf})})(o,W),Z=(function({enable:Te,clickTolerance:Oe,pitchDegreesPerPixelMoved:Ne=-.5}){const Ce=new _o({checkCorrectEvent:ze=>O.mouseButton(ze)===0&&ze.ctrlKey||O.mouseButton(ze)===2});return new Oi({clickTolerance:Oe,move:(ze,ot)=>({pitchDelta:(ot.y-ze.y)*Ne}),moveStateManager:Ce,enable:Te,assignEvents:Gf})})(o),te=(function({enable:Te,clickTolerance:Oe,rollDegreesPerPixelMoved:Ne=.3},Ce){const ze=new _o({checkCorrectEvent:ot=>O.mouseButton(ot)===2&&ot.ctrlKey});return new Oi({clickTolerance:Oe,move:(ot,tt)=>{const nt=Ce();let lt=(tt.x-ot.x)*Ne;return tt.y<nt.y&&(lt=-lt),{rollDelta:lt}},moveStateManager:ze,enable:Te,assignEvents:Gf})})(o,W);d.dragRotate=new Uh(o,K,Z,te),this._add("mouseRotate",K,["mousePitch"]),this._add("mousePitch",Z,["mouseRotate","mouseRoll"]),this._add("mouseRoll",te,["mousePitch"]),o.interactive&&o.dragRotate&&d.dragRotate.enable();const oe=(function({enable:Te,clickTolerance:Oe}){const Ne=new _o({checkCorrectEvent:Ce=>O.mouseButton(Ce)===0&&!Ce.ctrlKey});return new Oi({clickTolerance:Oe,move:(Ce,ze)=>({around:ze,panDelta:ze.sub(Ce)}),activateOnStart:!0,moveStateManager:Ne,enable:Te,assignEvents:Gf})})(o),me=new gp(o,d);d.dragPan=new Nc(y,oe,me),this._add("mousePan",oe),this._add("touchPan",me,["touchZoom","touchRotate"]),o.interactive&&o.dragPan&&d.dragPan.enable(o.dragPan);const ye=new Fh,_e=new Xf;d.touchZoomRotate=new Kf(y,_e,ye,N),this._add("touchRotate",ye,["touchPan","touchZoom"]),this._add("touchZoom",_e,["touchPan","touchRotate"]),o.interactive&&o.touchZoomRotate&&d.touchZoomRotate.enable(o.touchZoomRotate);const be=d.scrollZoom=new mp(d,(()=>this._triggerRenderFrame()));this._add("scrollZoom",be,["mousePan"]),o.interactive&&o.scrollZoom&&d.scrollZoom.enable(o.scrollZoom);const Ee=d.keyboard=new Br(d);this._add("keyboard",Ee),o.interactive&&o.keyboard&&d.keyboard.enable(),this._add("blockableMapEvent",new zh(d))}_add(o,d,y){this._handlers.push({handlerName:o,handler:d,allowed:y}),this._handlersById[o]=d}stop(o){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!jh(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,d,y){for(const w in o)if(w!==y&&(!d||d.indexOf(w)<0))return!0;return!1}_getMapTouches(o){const d=[];for(const y of o)this._el.contains(y.target)&&d.push(y);return d}mergeHandlerResult(o,d,y,w,C){if(!y)return;s.e(o,y);const I={handlerName:w,originalEvent:y.originalEvent||C};y.zoomDelta!==void 0&&(d.zoom=I),y.panDelta!==void 0&&(d.drag=I),y.rollDelta!==void 0&&(d.roll=I),y.pitchDelta!==void 0&&(d.pitch=I),y.bearingDelta!==void 0&&(d.rotate=I)}_applyChanges(){const o={},d={},y={};for(const[w,C,I]of this._changes)w.panDelta&&(o.panDelta=(o.panDelta||new s.P(0,0))._add(w.panDelta)),w.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+w.zoomDelta),w.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+w.bearingDelta),w.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+w.pitchDelta),w.rollDelta&&(o.rollDelta=(o.rollDelta||0)+w.rollDelta),w.around!==void 0&&(o.around=w.around),w.pinchAround!==void 0&&(o.pinchAround=w.pinchAround),w.noInertia&&(o.noInertia=w.noInertia),s.e(d,C),s.e(y,I);this._updateMapTransform(o,d,y),this._changes=[]}_updateMapTransform(o,d,y){const w=this._map,C=w._getTransformForUpdate(),I=w.terrain;if(!(Qr(o)||I&&this._terrainMovement))return this._fireEvents(d,y,!0);w._stop(!0);let{panDelta:B,zoomDelta:N,bearingDelta:H,pitchDelta:W,rollDelta:K,around:Z,pinchAround:te}=o;te!==void 0&&(Z=te),Z=Z||w.transform.centerPoint,I&&!C.isPointOnMapSurface(Z)&&(Z=C.centerPoint);const oe={panDelta:B,zoomDelta:N,rollDelta:K,pitchDelta:W,bearingDelta:H,around:Z};this._map.cameraHelper.useGlobeControls&&!C.isPointOnMapSurface(Z)&&(Z=C.centerPoint);const me=Z.distSqr(C.centerPoint)<.01?C.center:C.screenPointToLocation(B?Z.sub(B):Z);this._handleMapControls({terrain:I,tr:C,deltasForHelper:oe,preZoomAroundLoc:me,combinedEventsInProgress:d,panDelta:B}),w._applyUpdatedTransform(C),this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(d,y,!0)}_handleMapControls({terrain:o,tr:d,deltasForHelper:y,preZoomAroundLoc:w,combinedEventsInProgress:C,panDelta:I}){const B=this._map.cameraHelper;if(B.handleMapControlsRollPitchBearingZoom(y,d),o)return B.useGlobeControls?(this._terrainMovement||!C.drag&&!C.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void B.handleMapControlsPan(y,d,w)):this._terrainMovement||!C.drag&&!C.zoom?void(C.drag&&this._terrainMovement&&I?d.setCenter(d.screenPointToLocation(d.centerPoint.sub(I))):B.handleMapControlsPan(y,d,w)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void B.handleMapControlsPan(y,d,w));B.handleMapControlsPan(y,d,w)}_fireEvents(o,d,y){const w=jh(this._eventsInProgress),C=jh(o),I={};for(const K in o){const{originalEvent:Z}=o[K];this._eventsInProgress[K]||(I[`${K}start`]=Z),this._eventsInProgress[K]=o[K]}!w&&C&&this._fireEvent("movestart",C.originalEvent);for(const K in I)this._fireEvent(K,I[K]);C&&this._fireEvent("move",C.originalEvent);for(const K in o){const{originalEvent:Z}=o[K];this._fireEvent(K,Z)}const B={};let N;for(const K in this._eventsInProgress){const{handlerName:Z,originalEvent:te}=this._eventsInProgress[K];this._handlersById[Z].isActive()||(delete this._eventsInProgress[K],N=d[Z]||te,B[`${K}end`]=N)}for(const K in B)this._fireEvent(K,B[K]);const H=jh(this._eventsInProgress),W=(w||C)&&!H;if(W&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const K=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&K.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(K)}if(y&&W){this._updatingCamera=!0;const K=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Z=te=>te!==0&&-this._bearingSnap<te&&te<this._bearingSnap;!K||!K.essential&&M.prefersReducedMotion?(this._map.fire(new s.l("moveend",{originalEvent:N})),Z(this._map.getBearing())&&this._map.resetNorth()):(Z(K.bearing||this._map.getBearing())&&(K.bearing=0),K.freezeElevation=!0,this._map.easeTo(K,{originalEvent:N})),this._updatingCamera=!1}}_fireEvent(o,d){this._map.fire(new s.l(o,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((o=>{delete this._frameId,this.handleEvent(new vs("renderFrame",{timeStamp:o})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Fa extends s.E{constructor(o,d,y){super(),this._renderFrameCallback=()=>{const w=Math.min((M.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(w)),w<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=y.bearingSnap,this.cameraHelper=d,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(o,d){o.apply(this.transform),this.transform=o,this.cameraHelper=d}getCenter(){return new s.S(this.transform.center.lng,this.transform.center.lat)}setCenter(o,d){return this.jumpTo({center:o},d)}getCenterElevation(){return this.transform.elevation}setCenterElevation(o,d){return this.jumpTo({elevation:o},d),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(o){this._centerClampedToGround=o}panBy(o,d,y){return o=s.P.convert(o).mult(-1),this.panTo(this.transform.center,s.e({offset:o},d),y)}panTo(o,d,y){return this.easeTo(s.e({center:o},d),y)}getZoom(){return this.transform.zoom}setZoom(o,d){return this.jumpTo({zoom:o},d),this}zoomTo(o,d,y){return this.easeTo(s.e({zoom:o},d),y)}zoomIn(o,d){return this.zoomTo(this.getZoom()+1,o,d),this}zoomOut(o,d){return this.zoomTo(this.getZoom()-1,o,d),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(o,d){return o!=this.transform.fov&&(this.transform.setFov(o),this.fire(new s.l("movestart",d)).fire(new s.l("move",d)).fire(new s.l("moveend",d))),this}getBearing(){return this.transform.bearing}setBearing(o,d){return this.jumpTo({bearing:o},d),this}getPadding(){return this.transform.padding}setPadding(o,d){return this.jumpTo({padding:o},d),this}rotateTo(o,d,y){return this.easeTo(s.e({bearing:o},d),y)}resetNorth(o,d){return this.rotateTo(0,s.e({duration:1e3},o),d),this}resetNorthPitch(o,d){return this.easeTo(s.e({bearing:0,pitch:0,roll:0,duration:1e3},o),d),this}snapToNorth(o,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,d):this}getPitch(){return this.transform.pitch}setPitch(o,d){return this.jumpTo({pitch:o},d),this}getRoll(){return this.transform.roll}setRoll(o,d){return this.jumpTo({roll:o},d),this}cameraForBounds(o,d){o=Cr.convert(o).adjustAntiMeridian();const y=d&&d.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),y,d)}_cameraForBoxAndBearing(o,d,y,w){const C={top:0,bottom:0,right:0,left:0};if(typeof(w=s.e({padding:C,offset:[0,0],maxZoom:this.transform.maxZoom},w)).padding=="number"){const H=w.padding;w.padding={top:H,bottom:H,right:H,left:H}}const I=s.e(C,w.padding);w.padding=I;const B=this.transform,N=new Cr(o,d);return this.cameraHelper.cameraForBoxAndBearing(w,I,N,y,B)}fitBounds(o,d,y){return this._fitInternal(this.cameraForBounds(o,d),d,y)}fitScreenCoordinates(o,d,y,w,C){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(s.P.convert(o)),this.transform.screenPointToLocation(s.P.convert(d)),y,w),w,C)}_fitInternal(o,d,y){return o?(delete(d=s.e(o,d)).padding,d.linear?this.easeTo(d,y):this.flyTo(d,y)):this}jumpTo(o,d){this.stop();const y=this._getTransformForUpdate();let w=!1,C=!1,I=!1;const B=y.zoom;this.cameraHelper.handleJumpToCenterZoom(y,o);const N=y.zoom!==B;return"elevation"in o&&y.elevation!==+o.elevation&&y.setElevation(+o.elevation),"bearing"in o&&y.bearing!==+o.bearing&&(w=!0,y.setBearing(+o.bearing)),"pitch"in o&&y.pitch!==+o.pitch&&(C=!0,y.setPitch(+o.pitch)),"roll"in o&&y.roll!==+o.roll&&(I=!0,y.setRoll(+o.roll)),o.padding==null||y.isPaddingEqual(o.padding)||y.setPadding(o.padding),this._applyUpdatedTransform(y),this.fire(new s.l("movestart",d)).fire(new s.l("move",d)),N&&this.fire(new s.l("zoomstart",d)).fire(new s.l("zoom",d)).fire(new s.l("zoomend",d)),w&&this.fire(new s.l("rotatestart",d)).fire(new s.l("rotate",d)).fire(new s.l("rotateend",d)),C&&this.fire(new s.l("pitchstart",d)).fire(new s.l("pitch",d)).fire(new s.l("pitchend",d)),I&&this.fire(new s.l("rollstart",d)).fire(new s.l("roll",d)).fire(new s.l("rollend",d)),this.fire(new s.l("moveend",d))}calculateCameraOptionsFromTo(o,d,y,w=0){const C=s.a1.fromLngLat(o,d),I=s.a1.fromLngLat(y,w),B=I.x-C.x,N=I.y-C.y,H=I.z-C.z,W=Math.hypot(B,N,H);if(W===0)throw new Error("Can't calculate camera options with same From and To");const K=Math.hypot(B,N),Z=s.ak(this.transform.cameraToCenterDistance/W/this.transform.tileSize),te=180*Math.atan2(B,-N)/Math.PI;let oe=180*Math.acos(K/W)/Math.PI;return oe=H<0?90-oe:90+oe,{center:I.toLngLat(),elevation:w,zoom:Z,pitch:oe,bearing:te}}calculateCameraOptionsFromCameraLngLatAltRotation(o,d,y,w,C){const I=this.transform.calculateCenterFromCameraLngLatAlt(o,d,y,w);return{center:I.center,elevation:I.elevation,zoom:I.zoom,bearing:y,pitch:w,roll:C}}easeTo(o,d){this._stop(!1,o.easeId),((o=s.e({offset:[0,0],duration:500,easing:s.co},o)).animate===!1||!o.essential&&M.prefersReducedMotion)&&(o.duration=0);const y=this._getTransformForUpdate(),w=this.getBearing(),C=y.pitch,I=y.roll,B="bearing"in o?this._normalizeBearing(o.bearing,w):w,N="pitch"in o?+o.pitch:C,H="roll"in o?this._normalizeBearing(o.roll,I):I,W="padding"in o?o.padding:y.padding,K=s.P.convert(o.offset);let Z,te;o.around&&(Z=s.S.convert(o.around),te=y.locationToScreenPoint(Z));const oe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},me=this.cameraHelper.handleEaseTo(y,{bearing:B,pitch:N,roll:H,padding:W,around:Z,aroundPoint:te,offsetAsPoint:K,offset:o.offset,zoom:o.zoom,center:o.center});return this._rotating=this._rotating||w!==B,this._pitching=this._pitching||N!==C,this._rolling=this._rolling||H!==I,this._padding=!y.isPaddingEqual(W),this._zooming=this._zooming||me.isZooming,this._easeId=o.easeId,this._prepareEase(d,o.noMoveStart,oe),this.terrain&&this._prepareElevation(me.elevationCenter),this._ease((ye=>{me.easeFunc(ye),this.terrain&&!o.freezeElevation&&this._updateElevation(ye),this._applyUpdatedTransform(y),this._fireMoveEvents(d)}),(ye=>{this.terrain&&o.freezeElevation&&this._finalizeElevation(),this._afterEase(d,ye)}),o),this}_prepareEase(o,d,y={}){this._moving=!0,d||y.moving||this.fire(new s.l("movestart",o)),this._zooming&&!y.zooming&&this.fire(new s.l("zoomstart",o)),this._rotating&&!y.rotating&&this.fire(new s.l("rotatestart",o)),this._pitching&&!y.pitching&&this.fire(new s.l("pitchstart",o)),this._rolling&&!y.rolling&&this.fire(new s.l("rollstart",o))}_prepareElevation(o){this._elevationCenter=o,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(o){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const d=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(o<1&&d!==this._elevationTarget){const y=this._elevationTarget-this._elevationStart;this._elevationStart+=o*(y-(d-(y*o+this._elevationStart))/(1-o)),this._elevationTarget=d}this.transform.setElevation(s.C.number(this._elevationStart,this._elevationTarget,o))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(o){if(!this.terrain&&o.elevation>=0&&o.pitch<=90)return{};const d=o.getCameraLngLat(),y=o.getCameraAltitude(),w=this.terrain?this.terrain.getElevationForLngLatZoom(d,o.zoom):0;if(y<w){const C=this.calculateCameraOptionsFromTo(d,w,o.center,o.elevation);return{pitch:C.pitch,zoom:C.zoom}}return{}}_applyUpdatedTransform(o){const d=[];if(d.push((w=>this._elevateCameraIfInsideTerrain(w))),this.transformCameraUpdate&&d.push((w=>this.transformCameraUpdate(w))),!d.length)return;const y=o.clone();for(const w of d){const C=y.clone(),{center:I,zoom:B,roll:N,pitch:H,bearing:W,elevation:K}=w(C);I&&C.setCenter(I),K!==void 0&&C.setElevation(K),B!==void 0&&C.setZoom(B),N!==void 0&&C.setRoll(N),H!==void 0&&C.setPitch(H),W!==void 0&&C.setBearing(W),y.apply(C)}this.transform.apply(y)}_fireMoveEvents(o){this.fire(new s.l("move",o)),this._zooming&&this.fire(new s.l("zoom",o)),this._rotating&&this.fire(new s.l("rotate",o)),this._pitching&&this.fire(new s.l("pitch",o)),this._rolling&&this.fire(new s.l("roll",o))}_afterEase(o,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId;const y=this._zooming,w=this._rotating,C=this._pitching,I=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,y&&this.fire(new s.l("zoomend",o)),w&&this.fire(new s.l("rotateend",o)),C&&this.fire(new s.l("pitchend",o)),I&&this.fire(new s.l("rollend",o)),this.fire(new s.l("moveend",o))}flyTo(o,d){if(!o.essential&&M.prefersReducedMotion){const lt=s.Q(o,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(lt,d)}this.stop(),o=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.co},o);const y=this._getTransformForUpdate(),w=y.bearing,C=y.pitch,I=y.roll,B=y.padding,N="bearing"in o?this._normalizeBearing(o.bearing,w):w,H="pitch"in o?+o.pitch:C,W="roll"in o?this._normalizeBearing(o.roll,I):I,K="padding"in o?o.padding:y.padding,Z=s.P.convert(o.offset);let te=y.centerPoint.add(Z);const oe=y.screenPointToLocation(te),me=this.cameraHelper.handleFlyTo(y,{bearing:N,pitch:H,roll:W,padding:K,locationAtOffset:oe,offsetAsPoint:Z,center:o.center,minZoom:o.minZoom,zoom:o.zoom});let ye=o.curve;const _e=Math.max(y.width,y.height),be=_e/me.scaleOfZoom,Ee=me.pixelPathLength;typeof me.scaleOfMinZoom=="number"&&(ye=Math.sqrt(_e/me.scaleOfMinZoom/Ee*2));const Te=ye*ye;function Oe(lt){const Nt=(be*be-_e*_e+(lt?-1:1)*Te*Te*Ee*Ee)/(2*(lt?be:_e)*Te*Ee);return Math.log(Math.sqrt(Nt*Nt+1)-Nt)}function Ne(lt){return(Math.exp(lt)-Math.exp(-lt))/2}function Ce(lt){return(Math.exp(lt)+Math.exp(-lt))/2}const ze=Oe(!1);let ot=function(lt){return Ce(ze)/Ce(ze+ye*lt)},tt=function(lt){return _e*((Ce(ze)*(Ne(Nt=ze+ye*lt)/Ce(Nt))-Ne(ze))/Te)/Ee;var Nt},nt=(Oe(!0)-ze)/ye;if(Math.abs(Ee)<2e-6||!isFinite(nt)){if(Math.abs(_e-be)<1e-6)return this.easeTo(o,d);const lt=be<_e?-1:1;nt=Math.abs(Math.log(be/_e))/ye,tt=()=>0,ot=Nt=>Math.exp(lt*ye*Nt)}return o.duration="duration"in o?+o.duration:1e3*nt/("screenSpeed"in o?+o.screenSpeed/ye:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=w!==N,this._pitching=H!==C,this._rolling=W!==I,this._padding=!y.isPaddingEqual(K),this._prepareEase(d,!1),this.terrain&&this._prepareElevation(me.targetCenter),this._ease((lt=>{const Nt=lt*nt,Bt=1/ot(Nt),Tt=tt(Nt);this._rotating&&y.setBearing(s.C.number(w,N,lt)),this._pitching&&y.setPitch(s.C.number(C,H,lt)),this._rolling&&y.setRoll(s.C.number(I,W,lt)),this._padding&&(y.interpolatePadding(B,K,lt),te=y.centerPoint.add(Z)),me.easeFunc(lt,Bt,Tt,te),this.terrain&&!o.freezeElevation&&this._updateElevation(lt),this._applyUpdatedTransform(y),this._fireMoveEvents(d)}),(()=>{this.terrain&&o.freezeElevation&&this._finalizeElevation(),this._afterEase(d)}),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,d){var y;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const w=this._onEaseEnd;delete this._onEaseEnd,w.call(this,d)}return o||(y=this.handlers)===null||y===void 0||y.stop(!1),this}_ease(o,d,y){y.animate===!1||y.duration===0?(o(1),d()):(this._easeStart=M.now(),this._easeOptions=y,this._onEaseFrame=o,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(o,d){o=s.aO(o,-180,180);const y=Math.abs(o-d);return Math.abs(o-360-d)<y&&(o-=360),Math.abs(o+360-d)<y&&(o+=360),o}queryTerrainElevation(o){return this.terrain?this.terrain.getElevationForLngLatZoom(s.S.convert(o),this.transform.tileZoom):null}}const Ua={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class zc{constructor(o=Ua){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=d=>{!d||d.sourceDataType!=="metadata"&&d.sourceDataType!=="visibility"&&d.dataType!=="style"&&d.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=o}getDefaultPosition(){return"bottom-right"}onAdd(o){return this._map=o,this._compact=this.options.compact,this._container=O.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=O.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=O.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){O.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(o,d){const y=this._map._getUIString(`AttributionControl.${d}`);o.title=y,o.setAttribute("aria-label",y)}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map((w=>typeof w!="string"?"":w))):typeof this.options.customAttribution=="string"&&o.push(this.options.customAttribution)),this._map.style.stylesheet){const w=this._map.style.stylesheet;this.styleOwner=w.owner,this.styleId=w.id}const d=this._map.style.sourceCaches;for(const w in d){const C=d[w];if(C.used||C.usedForTerrain){const I=C.getSource();I.attribution&&o.indexOf(I.attribution)<0&&o.push(I.attribution)}}o=o.filter((w=>String(w).trim())),o.sort(((w,C)=>w.length-C.length)),o=o.filter(((w,C)=>{for(let I=C+1;I<o.length;I++)if(o[I].indexOf(w)>=0)return!1;return!0}));const y=o.join(" | ");y!==this._attribHTML&&(this._attribHTML=y,o.length?(this._innerContainer.innerHTML=O.sanitize(y),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Vh{constructor(o={}){this._updateCompact=()=>{const d=this._container.children;if(d.length){const y=d[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&y.classList.add("maplibregl-compact"):y.classList.remove("maplibregl-compact")}},this.options=o}getDefaultPosition(){return"bottom-left"}onAdd(o){this._map=o,this._compact=this.options&&this.options.compact,this._container=O.create("div","maplibregl-ctrl");const d=O.create("a","maplibregl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://maplibre.org/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){O.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Qf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const d=++this._id;return this._queue.push({callback:o,id:d,cancelled:!1}),d}remove(o){const d=this._currentlyRunning,y=d?this._queue.concat(d):this._queue;for(const w of y)if(w.id===o)return void(w.cancelled=!0)}run(o=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const d=this._currentlyRunning=this._queue;this._queue=[];for(const y of d)if(!y.cancelled&&(y.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var $h=s.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class Vs extends s.E{constructor(o){super(),this._lastTilesetChange=M.now(),this.sourceCache=o,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=o._source.tileSize*2**this.deltaZoom,o.usedForTerrain=!0,o.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(o,d){this.sourceCache.update(o,d),this._renderableTilesKeys=[];const y={};for(const w of He(o,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:d,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))y[w.key]=!0,this._renderableTilesKeys.push(w.key),this._tiles[w.key]||(w.terrainRttPosMatrix32f=new Float64Array(16),s.bY(w.terrainRttPosMatrix32f,0,s.$,s.$,0,0,1),this._tiles[w.key]=new Do(w,this.tileSize),this._lastTilesetChange=M.now());for(const w in this._tiles)y[w]||delete this._tiles[w]}freeRtt(o){for(const d in this._tiles){const y=this._tiles[d];(!o||y.tileID.equals(o)||y.tileID.isChildOf(o)||o.isChildOf(y.tileID))&&(y.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((o=>this.getTileByID(o)))}getTileByID(o){return this._tiles[o]}getTerrainCoords(o,d){return d?this._getTerrainCoordsForTileRanges(o,d):this._getTerrainCoordsForRegularTile(o)}_getTerrainCoordsForRegularTile(o){const d={};for(const y of this._renderableTilesKeys){const w=this._tiles[y].tileID,C=o.clone(),I=s.ba();if(w.canonical.equals(o.canonical))s.bY(I,0,s.$,s.$,0,0,1);else if(w.canonical.isChildOf(o.canonical)){const B=w.canonical.z-o.canonical.z,N=w.canonical.x-(w.canonical.x>>B<<B),H=w.canonical.y-(w.canonical.y>>B<<B),W=s.$>>B;s.bY(I,0,W,W,0,0,1),s.M(I,I,[-N*W,-H*W,0])}else{if(!o.canonical.isChildOf(w.canonical))continue;{const B=o.canonical.z-w.canonical.z,N=o.canonical.x-(o.canonical.x>>B<<B),H=o.canonical.y-(o.canonical.y>>B<<B),W=s.$>>B;s.bY(I,0,s.$,s.$,0,0,1),s.M(I,I,[N*W,H*W,0]),s.N(I,I,[1/2**B,1/2**B,0])}}C.terrainRttPosMatrix32f=new Float32Array(I),d[y]=C}return d}_getTerrainCoordsForTileRanges(o,d){const y={};for(const w of this._renderableTilesKeys){const C=this._tiles[w].tileID;if(!this._isWithinTileRanges(C,d))continue;const I=o.clone(),B=s.ba();if(C.canonical.z===o.canonical.z){const N=o.canonical.x-C.canonical.x,H=o.canonical.y-C.canonical.y;s.bY(B,0,s.$,s.$,0,0,1),s.M(B,B,[N*s.$,H*s.$,0])}else if(C.canonical.z>o.canonical.z){const N=C.canonical.z-o.canonical.z,H=C.canonical.x-(C.canonical.x>>N<<N),W=C.canonical.y-(C.canonical.y>>N<<N),K=o.canonical.x-(C.canonical.x>>N),Z=o.canonical.y-(C.canonical.y>>N),te=s.$>>N;s.bY(B,0,te,te,0,0,1),s.M(B,B,[-H*te+K*s.$,-W*te+Z*s.$,0])}else{const N=o.canonical.z-C.canonical.z,H=o.canonical.x-(o.canonical.x>>N<<N),W=o.canonical.y-(o.canonical.y>>N<<N),K=(o.canonical.x>>N)-C.canonical.x,Z=(o.canonical.y>>N)-C.canonical.y,te=s.$<<N;s.bY(B,0,te,te,0,0,1),s.M(B,B,[H*s.$+K*te,W*s.$+Z*te,0])}I.terrainRttPosMatrix32f=new Float32Array(B),y[w]=I}return y}getSourceTile(o,d){const y=this.sourceCache._source;let w=o.overscaledZ-this.deltaZoom;if(w>y.maxzoom&&(w=y.maxzoom),w<y.minzoom)return null;this._sourceTileCache[o.key]||(this._sourceTileCache[o.key]=o.scaledTo(w).key);let C=this.sourceCache.getTileByID(this._sourceTileCache[o.key]);if((!C||!C.dem)&&d)for(;w>=y.minzoom&&(!C||!C.dem);)C=this.sourceCache.getTileByID(o.scaledTo(w--).key);return C}anyTilesAfterTime(o=Date.now()){return this._lastTilesetChange>=o}_isWithinTileRanges(o,d){return d[o.canonical.z]&&o.canonical.x>=d[o.canonical.z].minTileX&&o.canonical.x<=d[o.canonical.z].maxTileX&&o.canonical.y>=d[o.canonical.z].minTileY&&o.canonical.y<=d[o.canonical.z].maxTileY}}class Hh{constructor(o,d,y){this._meshCache={},this.painter=o,this.sourceCache=new Vs(d),this.options=y,this.exaggeration=typeof y.exaggeration=="number"?y.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(o,d,y,w=s.$){var C;if(!(d>=0&&d<w&&y>=0&&y<w))return 0;const I=this.getTerrainData(o),B=(C=I.tile)===null||C===void 0?void 0:C.dem;if(!B)return 0;const N=s.cs([],[d/w*s.$,y/w*s.$],I.u_terrain_matrix),H=[N[0]*B.dim,N[1]*B.dim],W=Math.floor(H[0]),K=Math.floor(H[1]),Z=H[0]-W,te=H[1]-K;return B.get(W,K)*(1-Z)*(1-te)+B.get(W+1,K)*Z*(1-te)+B.get(W,K+1)*(1-Z)*te+B.get(W+1,K+1)*Z*te}getElevationForLngLatZoom(o,d){if(!s.ct(d,o.wrap()))return 0;const{tileID:y,mercatorX:w,mercatorY:C}=this._getOverscaledTileIDFromLngLatZoom(o,d);return this.getElevation(y,w%s.$,C%s.$,s.$)}getElevation(o,d,y,w=s.$){return this.getDEMElevation(o,d,y,w)*this.exaggeration}getTerrainData(o){if(!this._emptyDemTexture){const w=this.painter.context,C=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new s.T(w,C,w.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new s.T(w,new s.R({width:1,height:1}),w.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(w.gl.NEAREST,w.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.ag([])}const d=this.sourceCache.getSourceTile(o,!0);if(d&&d.dem&&(!d.demTexture||d.needsTerrainPrepare)){const w=this.painter.context;d.demTexture=this.painter.getTileTexture(d.dem.stride),d.demTexture?d.demTexture.update(d.dem.getPixels(),{premultiply:!1}):d.demTexture=new s.T(w,d.dem.getPixels(),w.gl.RGBA,{premultiply:!1}),d.demTexture.bind(w.gl.NEAREST,w.gl.CLAMP_TO_EDGE),d.needsTerrainPrepare=!1}const y=d&&d+d.tileID.key+o.key;if(y&&!this._demMatrixCache[y]){const w=this.sourceCache.sourceCache._source.maxzoom;let C=o.canonical.z-d.tileID.canonical.z;o.overscaledZ>o.canonical.z&&(o.canonical.z>=w?C=o.canonical.z-w:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const I=o.canonical.x-(o.canonical.x>>C<<C),B=o.canonical.y-(o.canonical.y>>C<<C),N=s.cu(new Float64Array(16),[1/(s.$<<C),1/(s.$<<C),0]);s.M(N,N,[I*s.$,B*s.$,0]),this._demMatrixCache[o.key]={matrix:N,coord:o}}return{u_depth:2,u_terrain:3,u_terrain_dim:d&&d.dem&&d.dem.dim||1,u_terrain_matrix:y?this._demMatrixCache[o.key].matrix:this._emptyDemMatrix,u_terrain_unpack:d&&d.dem&&d.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(d&&d.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:d}}getFramebuffer(o){const d=this.painter,y=d.width/devicePixelRatio,w=d.height/devicePixelRatio;return!this._fbo||this._fbo.width===y&&this._fbo.height===w||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new s.T(d.context,{width:y,height:w,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new s.T(d.context,{width:y,height:w,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=d.context.createFramebuffer(y,w,!0,!1),this._fbo.depthAttachment.set(d.context.createRenderbuffer(d.context.gl.DEPTH_COMPONENT16,y,w))),this._fbo.colorAttachment.set(o==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const o=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const d=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let C=0,I=0;C<this._coordsTextureSize;C++)for(let B=0;B<this._coordsTextureSize;B++,I+=4)d[I+0]=255&B,d[I+1]=255&C,d[I+2]=B>>8<<4|C>>8,d[I+3]=0;const y=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(d.buffer)),w=new s.T(o,y,o.gl.RGBA,{premultiply:!1});return w.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._coordsTexture=w,w}pointCoordinate(o){this.painter.maybeDrawDepthAndCoords(!0);const d=new Uint8Array(4),y=this.painter.context,w=y.gl,C=Math.round(o.x*this.painter.pixelRatio/devicePixelRatio),I=Math.round(o.y*this.painter.pixelRatio/devicePixelRatio),B=Math.round(this.painter.height/devicePixelRatio);y.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),w.readPixels(C,B-I-1,1,1,w.RGBA,w.UNSIGNED_BYTE,d),y.bindFramebuffer.set(null);const N=d[0]+(d[2]>>4<<8),H=d[1]+((15&d[2])<<8),W=this.coordsIndex[255-d[3]],K=W&&this.sourceCache.getTileByID(W);if(!K)return null;const Z=this._coordsTextureSize,te=(1<<K.tileID.canonical.z)*Z;return new s.a1((K.tileID.canonical.x*Z+N)/te+K.tileID.wrap,(K.tileID.canonical.y*Z+H)/te,this.getElevation(K.tileID,N,H,Z))}depthAtPoint(o){const d=new Uint8Array(4),y=this.painter.context,w=y.gl;return y.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),w.readPixels(o.x,this.painter.height/devicePixelRatio-o.y-1,1,1,w.RGBA,w.UNSIGNED_BYTE,d),y.bindFramebuffer.set(null),(d[0]/16777216+d[1]/65536+d[2]/256+d[3])/256}getTerrainMesh(o){var d;const y=((d=this.painter.style.projection)===null||d===void 0?void 0:d.transitionState)>0,w=y&&o.canonical.y===0,C=y&&o.canonical.y===(1<<o.canonical.z)-1,I=`m_${w?"n":""}_${C?"s":""}`;if(this._meshCache[I])return this._meshCache[I];const B=this.painter.context,N=new s.cv,H=new s.aN,W=this.meshSize,K=s.$/W,Z=W*W;for(let Ce=0;Ce<=W;Ce++)for(let ze=0;ze<=W;ze++)N.emplaceBack(ze*K,Ce*K,0);for(let Ce=0;Ce<Z;Ce+=W+1)for(let ze=0;ze<W;ze++)H.emplaceBack(ze+Ce,W+ze+Ce+1,W+ze+Ce+2),H.emplaceBack(ze+Ce,W+ze+Ce+2,ze+Ce+1);const te=N.length,oe=te+(W+1),me=(W+1)*W,ye=w?s.bh:0,_e=w?0:1,be=C?s.bi:s.$,Ee=C?0:1;for(let Ce=0;Ce<=W;Ce++)N.emplaceBack(Ce*K,ye,_e);for(let Ce=0;Ce<=W;Ce++)N.emplaceBack(Ce*K,be,Ee);for(let Ce=0;Ce<W;Ce++)H.emplaceBack(me+Ce,oe+Ce,oe+Ce+1),H.emplaceBack(me+Ce,oe+Ce+1,me+Ce+1),H.emplaceBack(0+Ce,te+Ce+1,te+Ce),H.emplaceBack(0+Ce,0+Ce+1,te+Ce+1);const Te=N.length,Oe=Te+2*(W+1);for(const Ce of[0,1])for(let ze=0;ze<=W;ze++)for(const ot of[0,1])N.emplaceBack(Ce*s.$,ze*K,ot);for(let Ce=0;Ce<2*W;Ce+=2)H.emplaceBack(Te+Ce,Te+Ce+1,Te+Ce+3),H.emplaceBack(Te+Ce,Te+Ce+3,Te+Ce+2),H.emplaceBack(Oe+Ce,Oe+Ce+3,Oe+Ce+1),H.emplaceBack(Oe+Ce,Oe+Ce+2,Oe+Ce+3);const Ne=new Ol(B.createVertexBuffer(N,$h.members),B.createIndexBuffer(H),s.aM.simpleSegment(0,0,N.length,H.length));return this._meshCache[I]=Ne,Ne}getMeshFrameDelta(o){return 2*Math.PI*s.bu/Math.pow(2,Math.max(o,0))/5}getMinTileElevationForLngLatZoom(o,d){var y;const{tileID:w}=this._getOverscaledTileIDFromLngLatZoom(o,d);return(y=this.getMinMaxElevation(w).minElevation)!==null&&y!==void 0?y:0}getMinMaxElevation(o){const d=this.getTerrainData(o).tile,y={minElevation:null,maxElevation:null};return d&&d.dem&&(y.minElevation=d.dem.min*this.exaggeration,y.maxElevation=d.dem.max*this.exaggeration),y}_getOverscaledTileIDFromLngLatZoom(o,d){const y=s.a1.fromLngLat(o.wrap()),w=(1<<d)*s.$,C=y.x*w,I=y.y*w,B=Math.floor(C/s.$),N=Math.floor(I/s.$);return{tileID:new s.Z(d,0,d,B,N),mercatorX:C,mercatorY:I}}}class Qt{constructor(o,d,y){this._context=o,this._size=d,this._tileSize=y,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const o of this._objects)o.texture.destroy(),o.fbo.destroy()}_createObject(o){const d=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),y=new s.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return y.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),d.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),d.colorAttachment.set(y.texture),{id:o,fbo:d,texture:y,stamp:-1,inUse:!1}}getObjectForId(o){return this._objects[o]}useObject(o){o.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((d=>o.id!==d)),this._recentlyUsed.push(o.id)}stampObject(o){o.stamp=++this._stamp}getOrCreateFreeObject(){for(const d of this._recentlyUsed)if(!this._objects[d].inUse)return this._objects[d];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const o=this._createObject(this._objects.length);return this._objects.push(o),o}freeObject(o){o.inUse=!1}freeAllObjects(){for(const o of this._objects)this.freeObject(o)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((o=>!o.inUse))===!1}}const tr={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Gl{constructor(o,d){this.painter=o,this.terrain=d,this.pool=new Qt(o.context,30,d.sourceCache.tileSize*d.qualityFactor)}destruct(){this.pool.destruct()}getTexture(o){return this.pool.getObjectForId(o.rtt[this._stacks.length-1].id).texture}prepareForRender(o,d){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=o._order.filter((y=>!o._layers[y].isHidden(d))),this._coordsAscending={};for(const y in o.sourceCaches){this._coordsAscending[y]={};const w=o.sourceCaches[y].getVisibleCoordinates(),C=o.sourceCaches[y].getSource(),I=C instanceof pa?C.terrainTileRanges:null;for(const B of w){const N=this.terrain.sourceCache.getTerrainCoords(B,I);for(const H in N)this._coordsAscending[y][H]||(this._coordsAscending[y][H]=[]),this._coordsAscending[y][H].push(N[H])}}this._coordsAscendingStr={};for(const y of o._order){const w=o._layers[y],C=w.source;if(tr[w.type]&&!this._coordsAscendingStr[C]){this._coordsAscendingStr[C]={};for(const I in this._coordsAscending[C])this._coordsAscendingStr[C][I]=this._coordsAscending[C][I].map((B=>B.key)).sort().join()}}for(const y of this._renderableTiles)for(const w in this._coordsAscendingStr){const C=this._coordsAscendingStr[w][y.tileID.key];C&&C!==y.rttCoords[w]&&(y.rtt=[])}}renderLayer(o,d){if(o.isHidden(this.painter.transform.zoom))return!1;const y=Object.assign(Object.assign({},d),{isRenderingToTexture:!0}),w=o.type,C=this.painter,I=this._renderableLayerIds[this._renderableLayerIds.length-1]===o.id;if(tr[w]&&(this._prevType&&tr[this._prevType]||this._stacks.push([]),this._prevType=w,this._stacks[this._stacks.length-1].push(o.id),!I))return!0;if(tr[this._prevType]||tr[w]&&I){this._prevType=w;const B=this._stacks.length-1,N=this._stacks[B]||[];for(const H of this._renderableTiles){if(this.pool.isFull()&&(bi(this.painter,this.terrain,this._rttTiles,y),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(H),H.rtt[B]){const K=this.pool.getObjectForId(H.rtt[B].id);if(K.stamp===H.rtt[B].stamp){this.pool.useObject(K);continue}}const W=this.pool.getOrCreateFreeObject();this.pool.useObject(W),this.pool.stampObject(W),H.rtt[B]={id:W.id,stamp:W.stamp},C.context.bindFramebuffer.set(W.fbo.framebuffer),C.context.clear({color:s.bf.transparent,stencil:0}),C.currentStencilSource=void 0;for(let K=0;K<N.length;K++){const Z=C.style._layers[N[K]],te=Z.source?this._coordsAscending[Z.source][H.tileID.key]:[H.tileID];C.context.viewport.set([0,0,W.fbo.width,W.fbo.height]),C._renderTileClippingMasks(Z,te,!0),C.renderLayer(C,C.style.sourceCaches[Z.source],Z,te,y),Z.source&&(H.rttCoords[Z.source]=this._coordsAscendingStr[Z.source][H.tileID.key])}}return bi(this.painter,this.terrain,this._rttTiles,y),this._rttTiles=[],this.pool.freeAllObjects(),tr[w]}return!1}}const _p={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Mu=g,Vi={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Ua,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},$s={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class ei{constructor(o,d,y=!1){this.mousedown=C=>{this.startMove(C,O.mousePos(this.element,C)),O.addEventListener(window,"mousemove",this.mousemove),O.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=C=>{this.move(C,O.mousePos(this.element,C))},this.mouseup=C=>{this._rotatePitchHandler.dragEnd(C),this.offTemp()},this.touchstart=C=>{C.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=O.touchPos(this.element,C.targetTouches)[0],this.startMove(C,this._startPos),O.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),O.addEventListener(window,"touchend",this.touchend))},this.touchmove=C=>{C.targetTouches.length!==1?this.reset():(this._lastPos=O.touchPos(this.element,C.targetTouches)[0],this.move(C,this._lastPos))},this.touchend=C=>{C.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=d;const w=new nm;this._rotatePitchHandler=new Oi({clickTolerance:3,move:(C,I)=>{const B=d.getBoundingClientRect(),N=new s.P((B.bottom-B.top)/2,(B.right-B.left)/2);return{bearingDelta:s.cn(new s.P(C.x,I.y),I,N),pitchDelta:y?-.5*(I.y-C.y):void 0}},moveStateManager:w,enable:!0,assignEvents:()=>{}}),this.map=o,O.addEventListener(d,"mousedown",this.mousedown),O.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),O.addEventListener(d,"touchcancel",this.reset)}startMove(o,d){this._rotatePitchHandler.dragStart(o,d),O.disableDrag()}move(o,d){const y=this.map,{bearingDelta:w,pitchDelta:C}=this._rotatePitchHandler.dragMove(o,d)||{};w&&y.setBearing(y.getBearing()+w),C&&y.setPitch(y.getPitch()+C)}off(){const o=this.element;O.removeEventListener(o,"mousedown",this.mousedown),O.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),O.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),O.removeEventListener(window,"touchend",this.touchend),O.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){O.enableDrag(),O.removeEventListener(window,"mousemove",this.mousemove),O.removeEventListener(window,"mouseup",this.mouseup),O.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),O.removeEventListener(window,"touchend",this.touchend)}}let Hs;function Xl(E,o,d,y=!1){if(y||!d.getCoveringTilesDetailsProvider().allowWorldCopies())return E?.wrap();const w=new s.S(E.lng,E.lat);if(E=new s.S(E.lng,E.lat),o){const C=new s.S(E.lng-360,E.lat),I=new s.S(E.lng+360,E.lat),B=d.locationToScreenPoint(E).distSqr(o);d.locationToScreenPoint(C).distSqr(o)<B?E=C:d.locationToScreenPoint(I).distSqr(o)<B&&(E=I)}for(;Math.abs(E.lng-d.center.lng)>180;){const C=d.locationToScreenPoint(E);if(C.x>=0&&C.y>=0&&C.x<=d.width&&C.y<=d.height)break;E.lng>d.center.lng?E.lng-=360:E.lng+=360}return E.lng!==w.lng&&d.isPointOnMapSurface(d.locationToScreenPoint(E))?E:w}const bn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function an(E,o,d){const y=E.classList;for(const w in bn)y.remove(`maplibregl-${d}-anchor-${w}`);y.add(`maplibregl-${d}-anchor-${o}`)}class os extends s.E{constructor(o){if(super(),this._onKeyPress=d=>{const y=d.code,w=d.charCode||d.keyCode;y!=="Space"&&y!=="Enter"&&w!==32&&w!==13||this.togglePopup()},this._onMapClick=d=>{const y=d.originalEvent.target,w=this._element;this._popup&&(y===w||w.contains(y))&&this.togglePopup()},this._update=d=>{if(!this._map)return;const y=this._map.loaded()&&!this._map.isMoving();(d?.type==="terrain"||d?.type==="render"&&!y)&&this._map.once("render",this._update),this._lngLat=Xl(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let w="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?w=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(w=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let C="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?C="rotateX(0deg)":this._pitchAlignment==="map"&&(C=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||d&&d.type!=="moveend"||(this._pos=this._pos.round()),O.setTransform(this._element,`${bn[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${C} ${w}`),M.frameAsync(new AbortController).then((()=>{this._updateOpacity(d&&d.type==="moveend")})).catch((()=>{}))},this._onMove=d=>{if(!this._isDragging){const y=this._clickTolerance||this._map._clickTolerance;this._isDragging=d.point.dist(this._pointerdownPos)>=y}this._isDragging&&(this._pos=d.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.l("dragstart"))),this.fire(new s.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.l("dragend")),this._state="inactive"},this._addDragHandler=d=>{this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(this._pos).add(this._offset),this._pointerdownPos=d.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._subpixelPositioning=o&&o.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,this.setOpacity(o?.opacity,o?.opacityWhenCovered),o&&o.element)this._element=o.element,this._offset=s.P.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=O.create("div");const d=O.createNS("http://www.w3.org/2000/svg","svg"),y=41,w=27;d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height",`${y}px`),d.setAttributeNS(null,"width",`${w}px`),d.setAttributeNS(null,"viewBox",`0 0 ${w} ${y}`);const C=O.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"stroke","none"),C.setAttributeNS(null,"stroke-width","1"),C.setAttributeNS(null,"fill","none"),C.setAttributeNS(null,"fill-rule","evenodd");const I=O.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill-rule","nonzero");const B=O.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"transform","translate(3.0, 29.0)"),B.setAttributeNS(null,"fill","#000000");const N=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const _e of N){const be=O.createNS("http://www.w3.org/2000/svg","ellipse");be.setAttributeNS(null,"opacity","0.04"),be.setAttributeNS(null,"cx","10.5"),be.setAttributeNS(null,"cy","5.80029008"),be.setAttributeNS(null,"rx",_e.rx),be.setAttributeNS(null,"ry",_e.ry),B.appendChild(be)}const H=O.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"fill",this._color);const W=O.createNS("http://www.w3.org/2000/svg","path");W.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),H.appendChild(W);const K=O.createNS("http://www.w3.org/2000/svg","g");K.setAttributeNS(null,"opacity","0.25"),K.setAttributeNS(null,"fill","#000000");const Z=O.createNS("http://www.w3.org/2000/svg","path");Z.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),K.appendChild(Z);const te=O.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"transform","translate(6.0, 7.0)"),te.setAttributeNS(null,"fill","#FFFFFF");const oe=O.createNS("http://www.w3.org/2000/svg","g");oe.setAttributeNS(null,"transform","translate(8.0, 8.0)");const me=O.createNS("http://www.w3.org/2000/svg","circle");me.setAttributeNS(null,"fill","#000000"),me.setAttributeNS(null,"opacity","0.25"),me.setAttributeNS(null,"cx","5.5"),me.setAttributeNS(null,"cy","5.5"),me.setAttributeNS(null,"r","5.4999962");const ye=O.createNS("http://www.w3.org/2000/svg","circle");ye.setAttributeNS(null,"fill","#FFFFFF"),ye.setAttributeNS(null,"cx","5.5"),ye.setAttributeNS(null,"cy","5.5"),ye.setAttributeNS(null,"r","5.4999962"),oe.appendChild(me),oe.appendChild(ye),I.appendChild(B),I.appendChild(H),I.appendChild(K),I.appendChild(te),I.appendChild(oe),d.appendChild(I),d.setAttributeNS(null,"height",y*this._scale+"px"),d.setAttributeNS(null,"width",w*this._scale+"px"),this._element.appendChild(d),this._offset=s.P.convert(o&&o.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(d=>{d.preventDefault()})),this._element.addEventListener("mousedown",(d=>{d.preventDefault()})),an(this._element,this._anchor,"marker"),o&&o.className)for(const d of o.className.split(" "))this._element.classList.add(d);this._popup=null}addTo(o){return this.remove(),this._map=o,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",o._getUIString("Marker.Title")),o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),o.on("terrain",this._update),o.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),O.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=s.S.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const w=Math.abs(13.5)/Math.SQRT2;o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[w,-1*(38.1-13.5+w)],"bottom-right":[-w,-1*(38.1-13.5+w)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(o){return this._subpixelPositioning=o,this}getPopup(){return this._popup}togglePopup(){const o=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:o?(o.isOpen()?o.remove():(o.setLngLat(this._lngLat),o.addTo(this._map)),this):this}_updateOpacity(o=!1){var d,y;const w=(d=this._map)===null||d===void 0?void 0:d.terrain,C=this._map.transform.isLocationOccluded(this._lngLat);if(!w||C){const te=C?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==te&&(this._element.style.opacity=te))}if(o)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const I=this._map,B=I.terrain.depthAtPoint(this._pos),N=I.terrain.getElevationForLngLatZoom(this._lngLat,I.transform.tileZoom);if(I.transform.lngLatToCameraDepth(this._lngLat,N)-B<.006)return void(this._element.style.opacity=this._opacity);const H=-this._offset.y/I.transform.pixelsPerMeter,W=Math.sin(I.getPitch()*Math.PI/180)*H,K=I.terrain.depthAtPoint(new s.P(this._pos.x,this._pos.y-this._offset.y)),Z=I.transform.lngLatToCameraDepth(this._lngLat,N+W)-K>.006;!((y=this._popup)===null||y===void 0)&&y.isOpen()&&Z&&this._popup.remove(),this._element.style.opacity=Z?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(o){return this._offset=s.P.convert(o),this._update(),this}addClassName(o){this._element.classList.add(o)}removeClassName(o){this._element.classList.remove(o)}toggleClassName(o){return this._element.classList.toggle(o)}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(o,d){return(this._opacity===void 0||o===void 0&&d===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),o!==void 0&&(this._opacity=o),d!==void 0&&(this._opacityWhenCovered=d),this._map&&this._updateOpacity(!0),this}}const Dn={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let bo=0,bs=!1;const Pr={maxWidth:100,unit:"metric"};function Jr(E,o,d){const y=d&&d.maxWidth||100,w=E._container.clientHeight/2,C=E._container.clientWidth/2,I=E.unproject([C-y/2,w]),B=E.unproject([C+y/2,w]),N=Math.round(E.project(B).x-E.project(I).x),H=Math.min(y,N,E._container.clientWidth),W=I.distanceTo(B);if(d&&d.unit==="imperial"){const K=3.2808*W;K>5280?dn(o,H,K/5280,E._getUIString("ScaleControl.Miles")):dn(o,H,K,E._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?dn(o,H,W/1852,E._getUIString("ScaleControl.NauticalMiles")):W>=1e3?dn(o,H,W/1e3,E._getUIString("ScaleControl.Kilometers")):dn(o,H,W,E._getUIString("ScaleControl.Meters"))}function dn(E,o,d,y){const w=(function(C){const I=Math.pow(10,`${Math.floor(C)}`.length-1);let B=C/I;return B=B>=10?10:B>=5?5:B>=3?3:B>=2?2:B>=1?1:(function(N){const H=Math.pow(10,Math.ceil(-Math.log(N)/Math.LN10));return Math.round(N*H)/H})(B),I*B})(d);E.style.width=o*(w/d)+"px",E.innerHTML=`${w}&nbsp;${y}`}const Iu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Zl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function xo(E){if(E){if(typeof E=="number"){const o=Math.round(Math.abs(E)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,E),"top-left":new s.P(o,o),"top-right":new s.P(-o,o),bottom:new s.P(0,-E),"bottom-left":new s.P(o,-o),"bottom-right":new s.P(-o,-o),left:new s.P(E,0),right:new s.P(-E,0)}}if(E instanceof s.P||Array.isArray(E)){const o=s.P.convert(E);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:s.P.convert(E.center||[0,0]),top:s.P.convert(E.top||[0,0]),"top-left":s.P.convert(E["top-left"]||[0,0]),"top-right":s.P.convert(E["top-right"]||[0,0]),bottom:s.P.convert(E.bottom||[0,0]),"bottom-left":s.P.convert(E["bottom-left"]||[0,0]),"bottom-right":s.P.convert(E["bottom-right"]||[0,0]),left:s.P.convert(E.left||[0,0]),right:s.P.convert(E.right||[0,0])}}return xo(new s.P(0,0))}const Ru=g;c.AJAXError=s.cz,c.Event=s.l,c.Evented=s.E,c.LngLat=s.S,c.MercatorCoordinate=s.a1,c.Point=s.P,c.addProtocol=s.cA,c.config=s.a,c.removeProtocol=s.cB,c.AttributionControl=zc,c.BoxZoomHandler=pp,c.CanvasSource=Ya,c.CooperativeGesturesHandler=ql,c.DoubleClickZoomHandler=Bc,c.DragPanHandler=Nc,c.DragRotateHandler=Uh,c.EdgeInsets=eo,c.FullscreenControl=class extends s.E{constructor(E={}){super(),this._onFullscreenChange=()=>{var o;let d=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((o=d?.shadowRoot)===null||o===void 0)&&o.fullscreenElement;)d=d.shadowRoot.fullscreenElement;d===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,E&&E.container&&(E.container instanceof HTMLElement?this._container=E.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(E){return this._map=E,this._container||(this._container=this._map.getContainer()),this._controlContainer=O.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){O.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const E=this._fullscreenButton=O.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);O.create("span","maplibregl-ctrl-icon",E).setAttribute("aria-hidden","true"),E.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const E=this._getTitle();this._fullscreenButton.setAttribute("aria-label",E),this._fullscreenButton.title=E}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new s.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},c.GeoJSONSource=Os,c.GeolocateControl=class extends s.E{constructor(E){super(),this._onSuccess=o=>{if(this._map){if(this._isOutOfMapMaxBounds(o))return this._setErrorState(),this.fire(new s.l("outofmaxbounds",o)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=o,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(o),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(o),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.l("geolocate",o)),this._finish()}},this._updateCamera=o=>{const d=new s.S(o.coords.longitude,o.coords.latitude),y=o.coords.accuracy,w=this._map.getBearing(),C=s.e({bearing:w},this.options.fitBoundsOptions),I=Cr.fromLngLat(d,y);this._map.fitBounds(I,C,{geolocateSource:!0})},this._updateMarker=o=>{if(o){const d=new s.S(o.coords.longitude,o.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=o.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=o=>{if(this._map){if(o.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(o.code===3&&bs)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.l("error",o)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(o=>o.preventDefault())),this._geolocateButton=O.create("button","maplibregl-ctrl-geolocate",this._container),O.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=o=>{if(this._map){if(o===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}else{const d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=O.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new os({element:this._dotElement}),this._circleElement=O.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new os({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(d=>{const y=d?.[0]instanceof ResizeObserverEntry;d.geolocateSource||this._watchState!=="ACTIVE_LOCK"||y||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.l("trackuserlocationend")),this.fire(new s.l("userlocationlostfocus")))}))}},this.options=s.e({},Dn,E)}onAdd(E){return this._map=E,this._container=O.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return s._(this,arguments,void 0,(function*(o=!1){if(Hs!==void 0&&!o)return Hs;if(window.navigator.permissions===void 0)return Hs=!!window.navigator.geolocation,Hs;try{Hs=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Hs=!!window.navigator.geolocation}return Hs}))})().then((o=>this._finishSetupUI(o))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),O.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,bo=0,bs=!1}_isOutOfMapMaxBounds(E){const o=this._map.getMaxBounds(),d=E.coords;return o&&(d.longitude<o.getWest()||d.longitude>o.getEast()||d.latitude<o.getSouth()||d.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const E=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&E))return;const o=this._map.project(E),d=this._map.unproject([o.x+100,o.y]),y=E.distanceTo(d)/100,w=2*this._accuracy/y;this._circleElement.style.width=`${w.toFixed(2)}px`,this._circleElement.style.height=`${w.toFixed(2)}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":bo--,bs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.l("trackuserlocationstart")),this.fire(new s.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let E;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),bo++,bo>1?(E={maximumAge:6e5,timeout:0},bs=!0):(E=this.options.positionOptions,bs=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,E)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},c.GlobeControl=class{constructor(){this._toggleProjection=()=>{var E;const o=(E=this._map.getProjection())===null||E===void 0?void 0:E.type;this._map.setProjection(o!=="mercator"&&o?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var E;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((E=this._map.getProjection())===null||E===void 0?void 0:E.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(E){return this._map=E,this._container=O.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=O.create("button","maplibregl-ctrl-globe",this._container),O.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){O.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},c.Hash=na,c.ImageSource=pa,c.KeyboardHandler=Br,c.LngLatBounds=Cr,c.LogoControl=Vh,c.Map=class extends Fa{constructor(E){var o,d;s.cw.mark(s.cx.create);const y=Object.assign(Object.assign(Object.assign({},Vi),E),{canvasContextAttributes:Object.assign(Object.assign({},Vi.canvasContextAttributes),E.canvasContextAttributes)});if(y.minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const w=new nn,C=new zi;if(y.minZoom!==void 0&&w.setMinZoom(y.minZoom),y.maxZoom!==void 0&&w.setMaxZoom(y.maxZoom),y.minPitch!==void 0&&w.setMinPitch(y.minPitch),y.maxPitch!==void 0&&w.setMaxPitch(y.maxPitch),y.renderWorldCopies!==void 0&&w.setRenderWorldCopies(y.renderWorldCopies),super(w,C,{bearingSnap:y.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Qf,this._controls=[],this._mapId=s.a7(),this._contextLost=B=>{B.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new s.l("webglcontextlost",{originalEvent:B}))},this._contextRestored=B=>{this._setupPainter(),this.resize(),this._update(),this.fire(new s.l("webglcontextrestored",{originalEvent:B}))},this._onMapScroll=B=>{if(B.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=y.interactive,this._maxTileCacheSize=y.maxTileCacheSize,this._maxTileCacheZoomLevels=y.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},y.canvasContextAttributes),this._trackResize=y.trackResize===!0,this._bearingSnap=y.bearingSnap,this._centerClampedToGround=y.centerClampedToGround,this._refreshExpiredTiles=y.refreshExpiredTiles===!0,this._fadeDuration=y.fadeDuration,this._crossSourceCollisions=y.crossSourceCollisions===!0,this._collectResourceTiming=y.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},_p),y.locale),this._clickTolerance=y.clickTolerance,this._overridePixelRatio=y.pixelRatio,this._maxCanvasSize=y.maxCanvasSize,this.transformCameraUpdate=y.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=y.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=ae.addThrottleControl((()=>this.isMoving())),this._requestManager=new ue(y.transformRequest),typeof y.container=="string"){if(this._container=document.getElementById(y.container),!this._container)throw new Error(`Container '${y.container}' not found.`)}else{if(!(y.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(y.maxBounds&&this.setMaxBounds(y.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let B=!1;const N=Vl((H=>{this._trackResize&&!this._removed&&(this.resize(H),this.redraw())}),50);this._resizeObserver=new ResizeObserver((H=>{B?N(H):B=!0})),this._resizeObserver.observe(this._container)}this.handlers=new yp(this,y),this._hash=y.hash&&new na(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,elevation:y.elevation,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch,roll:y.roll}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,s.e({},y.fitBoundsOptions,{duration:0}))));const I=typeof y.style=="string"||((d=(o=y.style)===null||o===void 0?void 0:o.projection)===null||d===void 0?void 0:d.type)!=="globe";this.resize(null,I),this._localIdeographFontFamily=y.localIdeographFontFamily,this._validateStyle=y.validateStyle,y.style&&this.setStyle(y.style,{localIdeographFontFamily:y.localIdeographFontFamily}),y.attributionControl&&this.addControl(new zc(typeof y.attributionControl=="boolean"?void 0:y.attributionControl)),y.maplibreLogo&&this.addControl(new Vh,y.logoPosition),this.on("style.load",(()=>{if(I||this._resizeTransform(),this.transform.unmodified){const B=s.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(B)}})),this.on("data",(B=>{this._update(B.dataType==="style"),this.fire(new s.l(`${B.dataType}data`,B))})),this.on("dataloading",(B=>{this.fire(new s.l(`${B.dataType}dataloading`,B))})),this.on("dataabort",(B=>{this.fire(new s.l("sourcedataabort",B))}))}_getMapId(){return this._mapId}setGlobalStateProperty(E,o){return this.style.setGlobalStateProperty(E,o),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(E,o){if(o===void 0&&(o=E.getDefaultPosition?E.getDefaultPosition():"top-right"),!E||!E.onAdd)return this.fire(new s.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=E.onAdd(this);this._controls.push(E);const y=this._controlPositions[o];return o.indexOf("bottom")!==-1?y.insertBefore(d,y.firstChild):y.appendChild(d),this}removeControl(E){if(!E||!E.onRemove)return this.fire(new s.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(E);return o>-1&&this._controls.splice(o,1),E.onRemove(this),this}hasControl(E){return this._controls.indexOf(E)>-1}coveringTiles(E){return He(this.transform,E)}calculateCameraOptionsFromTo(E,o,d,y){return y==null&&this.terrain&&(y=this.terrain.getElevationForLngLatZoom(d,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(E,o,d,y)}resize(E,o=!0){const[d,y]=this._containerDimensions(),w=this._getClampedPixelRatio(d,y);if(this._resizeCanvas(d,y,w),this.painter.resize(d,y,w),this.painter.overLimit()){const I=this.painter.context.gl;this._maxCanvasSize=[I.drawingBufferWidth,I.drawingBufferHeight];const B=this._getClampedPixelRatio(d,y);this._resizeCanvas(d,y,B),this.painter.resize(d,y,B)}this._resizeTransform(o);const C=!this._moving;return C&&(this.stop(),this.fire(new s.l("movestart",E)).fire(new s.l("move",E))),this.fire(new s.l("resize",E)),C&&this.fire(new s.l("moveend",E)),this}_resizeTransform(E=!0){var o;const[d,y]=this._containerDimensions();this.transform.resize(d,y,E),(o=this._requestedCameraState)===null||o===void 0||o.resize(d,y,E)}_getClampedPixelRatio(E,o){const{0:d,1:y}=this._maxCanvasSize,w=this.getPixelRatio(),C=E*w,I=o*w;return Math.min(C>d?d/C:1,I>y?y/I:1)*w}getPixelRatio(){var E;return(E=this._overridePixelRatio)!==null&&E!==void 0?E:devicePixelRatio}setPixelRatio(E){this._overridePixelRatio=E,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(E){return this.transform.setMaxBounds(Cr.convert(E)),this._update()}setMinZoom(E){if((E=E??-2)>=-2&&E<=this.transform.maxZoom)return this.transform.setMinZoom(E),this._update(),this.getZoom()<E&&this.setZoom(E),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(E){if((E=E??22)>=this.transform.minZoom)return this.transform.setMaxZoom(E),this._update(),this.getZoom()>E&&this.setZoom(E),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(E){if((E=E??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(E>=0&&E<=this.transform.maxPitch)return this.transform.setMinPitch(E),this._update(),this.getPitch()<E&&this.setPitch(E),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(E){if((E=E??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(E>=this.transform.minPitch)return this.transform.setMaxPitch(E),this._update(),this.getPitch()>E&&this.setPitch(E),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(E){return this.transform.setRenderWorldCopies(E),this._update()}project(E){return this.transform.locationToScreenPoint(s.S.convert(E),this.style&&this.terrain)}unproject(E){return this.transform.screenPointToLocation(s.P.convert(E),this.terrain)}isMoving(){var E;return this._moving||((E=this.handlers)===null||E===void 0?void 0:E.isMoving())}isZooming(){var E;return this._zooming||((E=this.handlers)===null||E===void 0?void 0:E.isZooming())}isRotating(){var E;return this._rotating||((E=this.handlers)===null||E===void 0?void 0:E.isRotating())}_createDelegatedListener(E,o,d){if(E==="mouseenter"||E==="mouseover"){let y=!1;return{layers:o,listener:d,delegates:{mousemove:C=>{const I=o.filter((N=>this.getLayer(N))),B=I.length!==0?this.queryRenderedFeatures(C.point,{layers:I}):[];B.length?y||(y=!0,d.call(this,new Ri(E,this,C.originalEvent,{features:B}))):y=!1},mouseout:()=>{y=!1}}}}if(E==="mouseleave"||E==="mouseout"){let y=!1;return{layers:o,listener:d,delegates:{mousemove:I=>{const B=o.filter((N=>this.getLayer(N)));(B.length!==0?this.queryRenderedFeatures(I.point,{layers:B}):[]).length?y=!0:y&&(y=!1,d.call(this,new Ri(E,this,I.originalEvent)))},mouseout:I=>{y&&(y=!1,d.call(this,new Ri(E,this,I.originalEvent)))}}}}{const y=w=>{const C=o.filter((B=>this.getLayer(B))),I=C.length!==0?this.queryRenderedFeatures(w.point,{layers:C}):[];I.length&&(w.features=I,d.call(this,w),delete w.features)};return{layers:o,listener:d,delegates:{[E]:y}}}}_saveDelegatedListener(E,o){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[E]=this._delegatedListeners[E]||[],this._delegatedListeners[E].push(o)}_removeDelegatedListener(E,o,d){if(!this._delegatedListeners||!this._delegatedListeners[E])return;const y=this._delegatedListeners[E];for(let w=0;w<y.length;w++){const C=y[w];if(C.listener===d&&C.layers.length===o.length&&C.layers.every((I=>o.includes(I)))){for(const I in C.delegates)this.off(I,C.delegates[I]);return void y.splice(w,1)}}}on(E,o,d){if(d===void 0)return super.on(E,o);const y=typeof o=="string"?[o]:o,w=this._createDelegatedListener(E,y,d);this._saveDelegatedListener(E,w);for(const C in w.delegates)this.on(C,w.delegates[C]);return{unsubscribe:()=>{this._removeDelegatedListener(E,y,d)}}}once(E,o,d){if(d===void 0)return super.once(E,o);const y=typeof o=="string"?[o]:o,w=this._createDelegatedListener(E,y,d);for(const C in w.delegates){const I=w.delegates[C];w.delegates[C]=(...B)=>{this._removeDelegatedListener(E,y,d),I(...B)}}this._saveDelegatedListener(E,w);for(const C in w.delegates)this.once(C,w.delegates[C]);return this}off(E,o,d){return d===void 0?super.off(E,o):(this._removeDelegatedListener(E,typeof o=="string"?[o]:o,d),this)}queryRenderedFeatures(E,o){if(!this.style)return[];let d;const y=E instanceof s.P||Array.isArray(E),w=y?E:[[0,0],[this.transform.width,this.transform.height]];if(o=o||(y?{}:E)||{},w instanceof s.P||typeof w[0]=="number")d=[s.P.convert(w)];else{const C=s.P.convert(w[0]),I=s.P.convert(w[1]);d=[C,new s.P(I.x,C.y),I,new s.P(C.x,I.y),C]}return this.style.queryRenderedFeatures(d,o,this.transform)}querySourceFeatures(E,o){return this.style.querySourceFeatures(E,o)}setStyle(E,o){return(o=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&E?(this._diffStyle(E,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._updateStyle(E,o))}setTransformRequest(E){return this._requestManager.setTransformRequest(E),this}_getUIString(E){const o=this._locale[E];if(o==null)throw new Error(`Missing UI string '${E}'`);return o}_updateStyle(E,o){var d,y;if(o.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(E,o)));const w=this.style&&o.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!E)),E?(this.style=new Qd(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof E=="string"?this.style.loadURL(E,o,w):this.style.loadJSON(E,o,w),this):((y=(d=this.style)===null||d===void 0?void 0:d.projection)===null||y===void 0||y.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Qd(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(E,o){if(typeof E=="string"){const d=this._requestManager.transformRequest(E,"Style");s.j(d,new AbortController).then((y=>{this._updateDiff(y.data,o)})).catch((y=>{y&&this.fire(new s.k(y))}))}else typeof E=="object"&&this._updateDiff(E,o)}_updateDiff(E,o){try{this.style.setState(E,o)&&this._update(!0)}catch(d){s.w(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(E,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(E,o){return this._lazyInitEmptyStyle(),this.style.addSource(E,o),this._update(!0)}isSourceLoaded(E){const o=this.style&&this.style.sourceCaches[E];if(o!==void 0)return o.loaded();this.fire(new s.k(new Error(`There is no source with ID '${E}'`)))}setTerrain(E){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),E){const o=this.style.sourceCaches[E.source];if(!o)throw new Error(`cannot load terrain, because there exists no source with ID: ${E.source}`);this.terrain===null&&o.reload();for(const d in this.style._layers){const y=this.style._layers[d];y.type==="hillshade"&&y.source===E.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),y.type==="color-relief"&&y.source===E.source&&s.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Hh(this.painter,o,E),this.painter.renderToTexture=new Gl(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=d=>{var y;d.dataType==="style"?this.terrain.sourceCache.freeRtt():d.dataType==="source"&&d.tile&&(d.sourceId!==E.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((y=d.source)===null||y===void 0?void 0:y.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(d.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new s.l("terrain",{terrain:E})),this}getTerrain(){var E,o;return(o=(E=this.terrain)===null||E===void 0?void 0:E.options)!==null&&o!==void 0?o:null}areTilesLoaded(){const E=this.style&&this.style.sourceCaches;for(const o in E){const d=E[o]._tiles;for(const y in d){const w=d[y];if(w.state!=="loaded"&&w.state!=="errored")return!1}}return!0}removeSource(E){return this.style.removeSource(E),this._update(!0)}getSource(E){return this.style.getSource(E)}setSourceTileLodParams(E,o,d){if(d){const y=this.getSource(d);if(!y)throw new Error(`There is no source with ID "${d}", cannot set LOD parameters`);y.calculateTileZoom=kt(Math.max(1,E),Math.max(1,o))}else for(const y in this.style.sourceCaches)this.style.sourceCaches[y].getSource().calculateTileZoom=kt(Math.max(1,E),Math.max(1,o));return this._update(!0),this}refreshTiles(E,o){const d=this.style.sourceCaches[E];if(!d)throw new Error(`There is no source cache with ID "${E}", cannot refresh tile`);o===void 0?d.reload(!0):d.refreshTiles(o.map((y=>new s.a4(y.z,y.x,y.y))))}addImage(E,o,d={}){const{pixelRatio:y=1,sdf:w=!1,stretchX:C,stretchY:I,content:B,textFitWidth:N,textFitHeight:H}=d;if(this._lazyInitEmptyStyle(),!(o instanceof HTMLImageElement||s.b(o))){if(o.width===void 0||o.height===void 0)return this.fire(new s.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:W,height:K,data:Z}=o,te=o;return this.style.addImage(E,{data:new s.R({width:W,height:K},new Uint8Array(Z)),pixelRatio:y,stretchX:C,stretchY:I,content:B,textFitWidth:N,textFitHeight:H,sdf:w,version:0,userImage:te}),te.onAdd&&te.onAdd(this,E),this}}{const{width:W,height:K,data:Z}=M.getImageData(o);this.style.addImage(E,{data:new s.R({width:W,height:K},Z),pixelRatio:y,stretchX:C,stretchY:I,content:B,textFitWidth:N,textFitHeight:H,sdf:w,version:0})}}updateImage(E,o){const d=this.style.getImage(E);if(!d)return this.fire(new s.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=o instanceof HTMLImageElement||s.b(o)?M.getImageData(o):o,{width:w,height:C,data:I}=y;if(w===void 0||C===void 0)return this.fire(new s.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(w!==d.data.width||C!==d.data.height)return this.fire(new s.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const B=!(o instanceof HTMLImageElement||s.b(o));return d.data.replace(I,B),this.style.updateImage(E,d),this}getImage(E){return this.style.getImage(E)}hasImage(E){return E?!!this.style.getImage(E):(this.fire(new s.k(new Error("Missing required image id"))),!1)}removeImage(E){this.style.removeImage(E)}loadImage(E){return ae.getImage(this._requestManager.transformRequest(E,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(E,o){return this._lazyInitEmptyStyle(),this.style.addLayer(E,o),this._update(!0)}moveLayer(E,o){return this.style.moveLayer(E,o),this._update(!0)}removeLayer(E){return this.style.removeLayer(E),this._update(!0)}getLayer(E){return this.style.getLayer(E)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(E,o,d){return this.style.setLayerZoomRange(E,o,d),this._update(!0)}setFilter(E,o,d={}){return this.style.setFilter(E,o,d),this._update(!0)}getFilter(E){return this.style.getFilter(E)}setPaintProperty(E,o,d,y={}){return this.style.setPaintProperty(E,o,d,y),this._update(!0)}getPaintProperty(E,o){return this.style.getPaintProperty(E,o)}setLayoutProperty(E,o,d,y={}){return this.style.setLayoutProperty(E,o,d,y),this._update(!0)}getLayoutProperty(E,o){return this.style.getLayoutProperty(E,o)}setGlyphs(E,o={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(E,o),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(E,o,d={}){return this._lazyInitEmptyStyle(),this.style.addSprite(E,o,d,(y=>{y||this._update(!0)})),this}removeSprite(E){return this._lazyInitEmptyStyle(),this.style.removeSprite(E),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(E,o={}){return this._lazyInitEmptyStyle(),this.style.setSprite(E,o,(d=>{d||this._update(!0)})),this}setLight(E,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(E,o),this._update(!0)}getLight(){return this.style.getLight()}setSky(E,o={}){return this._lazyInitEmptyStyle(),this.style.setSky(E,o),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(E,o){return this.style.setFeatureState(E,o),this._update()}removeFeatureState(E,o){return this.style.removeFeatureState(E,o),this._update()}getFeatureState(E){return this.style.getFeatureState(E)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let E=0,o=0;return this._container&&(E=this._container.clientWidth||400,o=this._container.clientHeight||300),[E,o]}_setupContainer(){const E=this._container;E.classList.add("maplibregl-map");const o=this._canvasContainer=O.create("div","maplibregl-canvas-container",E);this._interactive&&o.classList.add("maplibregl-interactive"),this._canvas=O.create("canvas","maplibregl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const d=this._containerDimensions(),y=this._getClampedPixelRatio(d[0],d[1]);this._resizeCanvas(d[0],d[1],y);const w=this._controlContainer=O.create("div","maplibregl-control-container",E),C=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((I=>{C[I]=O.create("div",`maplibregl-ctrl-${I} `,w)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(E,o,d){this._canvas.width=Math.floor(d*E),this._canvas.height=Math.floor(d*o),this._canvas.style.width=`${E}px`,this._canvas.style.height=`${o}px`}_setupPainter(){const E=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let o=null;this._canvas.addEventListener("webglcontextcreationerror",(y=>{o={requestedAttributes:E},y&&(o.statusMessage=y.statusMessage,o.type=y.type)}),{once:!0});let d=null;if(d=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,E):this._canvas.getContext("webgl2",E)||this._canvas.getContext("webgl",E),!d){const y="Failed to initialize WebGL";throw o?(o.message=y,new Error(JSON.stringify(o))):new Error(y)}this.painter=new Bh(d,this.transform),F.testSupport(d)}migrateProjection(E,o){super.migrateProjection(E,o),this.painter.transform=E,this.fire(new s.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(E){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||E,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(E){return this._update(),this._renderTaskQueue.add(E)}_cancelRenderFrame(E){this._renderTaskQueue.remove(E)}_render(E){var o,d,y,w,C;const I=this._idleTriggered?this._fadeDuration:0,B=((o=this.style.projection)===null||o===void 0?void 0:o.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(E),this._removed)return;let N=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const K=this.transform.zoom,Z=M.now();this.style.zoomHistory.update(K,Z);const te=new s.F(K,{now:Z,fadeDuration:I,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),oe=te.crossFadingFactor();oe===1&&oe===this._crossFadingFactor||(N=!0,this._crossFadingFactor=oe),this.style.update(te)}const H=((d=this.style.projection)===null||d===void 0?void 0:d.transitionState)>0!==B;(y=this.style.projection)===null||y===void 0||y.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((w=this.style.projection)===null||w===void 0?void 0:w.transitionState,(C=this.style.projection)===null||C===void 0?void 0:C.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||H)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,I,this._crossSourceCollisions,H),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:I,showPadding:this.showPadding}),this.fire(new s.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.cw.mark(s.cx.load),this.fire(new s.l("load"))),this.style&&(this.style.hasTransitions()||N)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const W=this._sourcesDirty||this._styleDirty||this._placementDirty;return W||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.l("idle")),!this._loaded||this._fullyLoaded||W||(this._fullyLoaded=!0,s.cw.mark(s.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var E;this._hash&&this._hash.remove();for(const d of this._controls)d.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ae.removeThrottleControl(this._imageQueueHandle),(E=this._resizeObserver)===null||E===void 0||E.disconnect();const o=this.painter.context.gl.getExtension("WEBGL_lose_context");o?.loseContext&&o.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),O.remove(this._canvasContainer),O.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),s.cw.clearMetrics(),this._removed=!0,this.fire(new s.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,M.frame(this._frameRequest,(E=>{s.cw.frame(E),this._frameRequest=null;try{this._render(E)}catch(o){if(!s.cy(o)&&!(function(d){return d.message===co})(o))throw o}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(E){this._showTileBoundaries!==E&&(this._showTileBoundaries=E,this._update())}get showPadding(){return!!this._showPadding}set showPadding(E){this._showPadding!==E&&(this._showPadding=E,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(E){this._showCollisionBoxes!==E&&(this._showCollisionBoxes=E,E?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(E){this._showOverdrawInspector!==E&&(this._showOverdrawInspector=E,this._update())}get repaint(){return!!this._repaint}set repaint(E){this._repaint!==E&&(this._repaint=E,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(E){this._vertices=E,this._update()}get version(){return Mu}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(E){return this._lazyInitEmptyStyle(),this.style.setProjection(E),this._update(!0)}},c.MapMouseEvent=Ri,c.MapTouchEvent=qo,c.MapWheelEvent=Go,c.Marker=os,c.NavigationControl=class{constructor(E){this._updateZoomButtons=()=>{const o=this._map.getZoom(),d=o===this._map.getMaxZoom(),y=o===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=y,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",y.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(o,d)=>{const y=this._map._getUIString(`NavigationControl.${d}`);o.title=y,o.setAttribute("aria-label",y)},this.options=s.e({},$s,E),this._container=O.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(o=>o.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(o=>this._map.zoomIn({},{originalEvent:o}))),O.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(o=>this._map.zoomOut({},{originalEvent:o}))),O.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})})),this._compassIcon=O.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(E){return this._map=E,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ei(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){O.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(E,o){const d=O.create("button",E,this._container);return d.type="button",d.addEventListener("click",o),d}},c.Popup=class extends s.E{constructor(E){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&O.remove(this._content),this._container&&(O.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new s.l("close"))),this),this._onMouseUp=o=>{this._update(o.point)},this._onMouseMove=o=>{this._update(o.point)},this._onDrag=o=>{this._update(o.point)},this._update=o=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=O.create("div","maplibregl-popup",this._map.getContainer()),this._tip=O.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const I of this.options.className.split(" "))this._container.classList.add(I);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Xl(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!o)return;const d=this._flatPos=this._pos=this._trackPointer&&o?o:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&o?o:this._map.transform.locationToScreenPoint(this._lngLat));let y=this.options.anchor;const w=xo(this.options.offset);if(!y){const I=this._container.offsetWidth,B=this._container.offsetHeight;let N;N=d.y+w.bottom.y<B?["top"]:d.y>this._map.transform.height-B?["bottom"]:[],d.x<I/2?N.push("left"):d.x>this._map.transform.width-I/2&&N.push("right"),y=N.length===0?"bottom":N.join("-")}let C=d.add(w[y]);this.options.subpixelPositioning||(C=C.round()),O.setTransform(this._container,`${bn[y]} translate(${C.x}px,${C.y}px)`),an(this._container,y,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(Iu),E)}addTo(E){return this._map&&this.remove(),this._map=E,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(E){return this._lngLat=s.S.convert(E),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(E){return this.setDOMContent(document.createTextNode(E))}setHTML(E){const o=document.createDocumentFragment(),d=document.createElement("body");let y;for(d.innerHTML=E;y=d.firstChild,y;)o.appendChild(y);return this.setDOMContent(o)}getMaxWidth(){var E;return(E=this._container)===null||E===void 0?void 0:E.style.maxWidth}setMaxWidth(E){return this.options.maxWidth=E,this._update(),this}setDOMContent(E){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=O.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(E),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(E){return this._container&&this._container.classList.add(E),this}removeClassName(E){return this._container&&this._container.classList.remove(E),this}setOffset(E){return this.options.offset=E,this._update(),this}toggleClassName(E){if(this._container)return this._container.classList.toggle(E)}setSubpixelPositioning(E){this.options.subpixelPositioning=E}_createCloseButton(){this.options.closeButton&&(this._closeButton=O.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const E=this._container.querySelector(Zl);E&&E.focus()}},c.RasterDEMTileSource=gs,c.RasterTileSource=ur,c.ScaleControl=class{constructor(E){this._onMove=()=>{Jr(this._map,this._container,this.options)},this.setUnit=o=>{this.options.unit=o,Jr(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Pr),E)}getDefaultPosition(){return"bottom-left"}onAdd(E){return this._map=E,this._container=O.create("div","maplibregl-ctrl maplibregl-ctrl-scale",E.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){O.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},c.ScrollZoomHandler=mp,c.Style=Qd,c.TerrainControl=class{constructor(E){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=E}onAdd(E){return this._map=E,this._container=O.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=O.create("button","maplibregl-ctrl-terrain",this._container),O.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){O.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},c.TwoFingersTouchPitchHandler=Zo,c.TwoFingersTouchRotateHandler=Fh,c.TwoFingersTouchZoomHandler=Xf,c.TwoFingersTouchZoomRotateHandler=Kf,c.VectorTileSource=or,c.VideoSource=Tl,c.addSourceType=(E,o)=>s._(void 0,void 0,void 0,(function*(){if(Al(E))throw new Error(`A source type called "${E}" already exists.`);((d,y)=>{Sl[d]=y})(E,o)})),c.clearPrewarmedResources=function(){const E=rt;E&&(E.isPreloaded()&&E.numActive()===1?(E.release(at),rt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},c.createTileMesh=pu,c.getMaxParallelImageRequests=function(){return s.a.MAX_PARALLEL_IMAGE_REQUESTS},c.getRTLTextPluginStatus=function(){return ko().getRTLTextPluginStatus()},c.getVersion=function(){return Ru},c.getWorkerCount=function(){return pe.workerCount},c.getWorkerUrl=function(){return s.a.WORKER_URL},c.importScriptInWorkers=function(E){return Gt().broadcast("IS",E)},c.prewarm=function(){At().acquire(at)},c.setMaxParallelImageRequests=function(E){s.a.MAX_PARALLEL_IMAGE_REQUESTS=E},c.setRTLTextPlugin=function(E,o){return ko().setRTLTextPlugin(E,o)},c.setWorkerCount=function(E){pe.workerCount=E},c.setWorkerUrl=function(E){s.a.WORKER_URL=E}}));var a=r;return a}))})(sx)),sx.exports}var UD=KF();const gl=xl(UD),QF=ND({__proto__:null,default:gl},[UD]);function fa(t){return(e,...r)=>JF(t,e,r)}function Dy(t,e){return fa(jD(t,e).get)}const{apply:JF,getOwnPropertyDescriptor:jD,getPrototypeOf:HA,ownKeys:e8}=Reflect,{iterator:t0,toStringTag:t8}=Symbol,r8=Object,{create:WA,defineProperty:n8}=r8,i8=Array,s8=i8.prototype,VD=s8[t0],a8=fa(VD),$D=ArrayBuffer,o8=$D.prototype;Dy(o8,"byteLength");const JC=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;JC&&Dy(JC.prototype,"byteLength");const HD=HA(Uint8Array);HD.from;const Xa=HD.prototype;Xa[t0];fa(Xa.keys);fa(Xa.values);fa(Xa.entries);fa(Xa.set);fa(Xa.reverse);fa(Xa.fill);fa(Xa.copyWithin);fa(Xa.sort);fa(Xa.slice);fa(Xa.subarray);Dy(Xa,"buffer");Dy(Xa,"byteOffset");Dy(Xa,"length");Dy(Xa,t8);const l8=Uint8Array,WD=Uint16Array,qA=Uint32Array,c8=Float32Array,Bv=HA([][t0]()),qD=fa(Bv.next),u8=fa((function*(){})().next),h8=HA(Bv),f8=DataView.prototype,d8=fa(f8.getUint16),GA=WeakMap,GD=GA.prototype,XD=fa(GD.get),p8=fa(GD.set),ZD=new GA,g8=WA(null,{next:{value:function(){const e=XD(ZD,this);return qD(e)}},[t0]:{value:function(){return this}}});function m8(t){if(t[t0]===VD&&Bv.next===qD)return t;const e=WA(g8);return p8(ZD,e,a8(t)),e}const y8=new GA,_8=WA(h8,{next:{value:function(){const e=XD(y8,this);return u8(e)},writable:!0,configurable:!0}});for(const t of e8(Bv))t!=="next"&&n8(_8,t,jD(Bv,t));const YD=new $D(4),v8=new c8(YD),b8=new qA(YD),Zu=new WD(512),Yu=new l8(512);for(let t=0;t<256;++t){const e=t-127;e<-24?(Zu[t]=0,Zu[t|256]=32768,Yu[t]=24,Yu[t|256]=24):e<-14?(Zu[t]=1024>>-e-14,Zu[t|256]=1024>>-e-14|32768,Yu[t]=-e-1,Yu[t|256]=-e-1):e<=15?(Zu[t]=e+15<<10,Zu[t|256]=e+15<<10|32768,Yu[t]=13,Yu[t|256]=13):e<128?(Zu[t]=31744,Zu[t|256]=64512,Yu[t]=24,Yu[t|256]=24):(Zu[t]=31744,Zu[t|256]=64512,Yu[t]=13,Yu[t|256]=13)}const XA=new qA(2048);for(let t=1;t<1024;++t){let e=t<<13,r=0;for(;(e&8388608)===0;)e<<=1,r-=8388608;e&=-8388609,r+=947912704,XA[t]=e|r}for(let t=1024;t<2048;++t)XA[t]=939524096+(t-1024<<13);const Ly=new qA(64);for(let t=1;t<31;++t)Ly[t]=t<<23;Ly[31]=1199570944;Ly[32]=2147483648;for(let t=33;t<63;++t)Ly[t]=2147483648+(t-32<<23);Ly[63]=3347054592;const KD=new WD(64);for(let t=1;t<64;++t)t!==32&&(KD[t]=1024);function x8(t){const e=t>>10;return b8[0]=XA[KD[e]+(t&1023)]+Ly[e],v8[0]}function QD(t,e,...r){return x8(d8(t,e,...m8(r)))}var mb={exports:{}},eP;function w8(){if(eP)return mb.exports;eP=1;function t(e,r,n){const i=n&&n.debug||!1;i&&console.log("[xml-utils] getting "+r+" in "+e);const a=typeof e=="object"?e.outer:e,c=a.slice(0,a.indexOf(">")+1),s=['"',"'"];for(let g=0;g<s.length;g++){const _=s[g],v=r+"\\="+_+"([^"+_+"]*)"+_;i&&console.log("[xml-utils] pattern:",v);const M=new RegExp(v).exec(c);if(i&&console.log("[xml-utils] match:",M),M)return M[1]}}return mb.exports=t,mb.exports.default=t,mb.exports}var T8=w8();const Hw=xl(T8);var yb={exports:{}},_b={exports:{}},vb={exports:{}},tP;function S8(){if(tP)return vb.exports;tP=1;function t(e,r,n){const a=new RegExp(r).exec(e.slice(n));return a?n+a.index:-1}return vb.exports=t,vb.exports.default=t,vb.exports}var bb={exports:{}},rP;function A8(){if(rP)return bb.exports;rP=1;function t(e,r,n){const a=new RegExp(r).exec(e.slice(n));return a?n+a.index+a[0].length-1:-1}return bb.exports=t,bb.exports.default=t,bb.exports}var xb={exports:{}},nP;function E8(){if(nP)return xb.exports;nP=1;function t(e,r){const n=new RegExp(r,"g"),i=e.match(n);return i?i.length:0}return xb.exports=t,xb.exports.default=t,xb.exports}var iP;function C8(){if(iP)return _b.exports;iP=1;const t=S8(),e=A8(),r=E8();function n(i,a,c){const s=c&&c.debug||!1,g=!(c&&typeof c.nested===!1),_=c&&c.startIndex||0;s&&console.log("[xml-utils] starting findTagByName with",a," and ",c);const v=t(i,`<${a}[ 
>/]`,_);if(s&&console.log("[xml-utils] start:",v),v===-1)return;const T=i.slice(v+a.length);let M=e(T,"^[^<]*[ /]>",0);const O=M!==-1&&T[M-1]==="/";if(s&&console.log("[xml-utils] selfClosing:",O),O===!1)if(g){let q=0,Y=1,X=0;for(;(M=e(T,"[ /]"+a+">",q))!==-1;){const ae=T.substring(q,M+1);if(Y+=r(ae,"<"+a+`[ 
	>]`),X+=r(ae,"</"+a+">"),X>=Y)break;q=M}}else M=e(T,"[ /]"+a+">",0);const F=v+a.length+M+1;if(s&&console.log("[xml-utils] end:",F),F===-1)return;const j=i.slice(v,F);let V;return O?V=null:V=j.slice(j.indexOf(">")+1,j.lastIndexOf("<")),{inner:V,outer:j,start:v,end:F}}return _b.exports=n,_b.exports.default=n,_b.exports}var sP;function P8(){if(sP)return yb.exports;sP=1;const t=C8();function e(r,n,i){const a=[],c=i&&i.debug||!1,s=i&&typeof i.nested=="boolean"?i.nested:!0;let g=i&&i.startIndex||0,_;for(;_=t(r,n,{debug:c,startIndex:g});)s?g=_.start+1+n.length:g=_.end,a.push(_);return c&&console.log("findTagsByName found",a.length,"tags"),a}return yb.exports=e,yb.exports.default=e,yb.exports}var M8=P8();const I8=xl(M8),xv={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},Ju={};for(const t in xv)xv.hasOwnProperty(t)&&(Ju[xv[t]]=parseInt(t,10));const R8=[Ju.BitsPerSample,Ju.ExtraSamples,Ju.SampleFormat,Ju.StripByteCounts,Ju.StripOffsets,Ju.StripRowCounts,Ju.TileByteCounts,Ju.TileOffsets,Ju.SubIFDs],Ww={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},Vr={};for(const t in Ww)Ww.hasOwnProperty(t)&&(Vr[Ww[t]]=parseInt(t,10));const sl={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,CMYK:5,YCbCr:6,CIELab:8},O8={Unspecified:0},Mye={AddCompression:1},Iye={None:0,Deflate:1,Zstandard:2},k8={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function D8(t,e){const{width:r,height:n}=t,i=new Uint8Array(r*n*3);let a;for(let c=0,s=0;c<t.length;++c,s+=3)a=256-t[c]/e*256,i[s]=a,i[s+1]=a,i[s+2]=a;return i}function L8(t,e){const{width:r,height:n}=t,i=new Uint8Array(r*n*3);let a;for(let c=0,s=0;c<t.length;++c,s+=3)a=t[c]/e*256,i[s]=a,i[s+1]=a,i[s+2]=a;return i}function B8(t,e){const{width:r,height:n}=t,i=new Uint8Array(r*n*3),a=e.length/3,c=e.length/3*2;for(let s=0,g=0;s<t.length;++s,g+=3){const _=t[s];i[g]=e[_]/65536*256,i[g+1]=e[_+a]/65536*256,i[g+2]=e[_+c]/65536*256}return i}function N8(t){const{width:e,height:r}=t,n=new Uint8Array(e*r*3);for(let i=0,a=0;i<t.length;i+=4,a+=3){const c=t[i],s=t[i+1],g=t[i+2],_=t[i+3];n[a]=255*((255-c)/256)*((255-_)/256),n[a+1]=255*((255-s)/256)*((255-_)/256),n[a+2]=255*((255-g)/256)*((255-_)/256)}return n}function z8(t){const{width:e,height:r}=t,n=new Uint8ClampedArray(e*r*3);for(let i=0,a=0;i<t.length;i+=3,a+=3){const c=t[i],s=t[i+1],g=t[i+2];n[a]=c+1.402*(g-128),n[a+1]=c-.34414*(s-128)-.71414*(g-128),n[a+2]=c+1.772*(s-128)}return n}const F8=.95047,U8=1,j8=1.08883;function V8(t){const{width:e,height:r}=t,n=new Uint8Array(e*r*3);for(let i=0,a=0;i<t.length;i+=3,a+=3){const c=t[i+0],s=t[i+1]<<24>>24,g=t[i+2]<<24>>24;let _=(c+16)/116,v=s/500+_,T=_-g/200,M,O,F;v=F8*(v*v*v>.008856?v*v*v:(v-16/116)/7.787),_=U8*(_*_*_>.008856?_*_*_:(_-16/116)/7.787),T=j8*(T*T*T>.008856?T*T*T:(T-16/116)/7.787),M=v*3.2406+_*-1.5372+T*-.4986,O=v*-.9689+_*1.8758+T*.0415,F=v*.0557+_*-.204+T*1.057,M=M>.0031308?1.055*M**(1/2.4)-.055:12.92*M,O=O>.0031308?1.055*O**(1/2.4)-.055:12.92*O,F=F>.0031308?1.055*F**(1/2.4)-.055:12.92*F,n[a]=Math.max(0,Math.min(1,M))*255,n[a+1]=Math.max(0,Math.min(1,O))*255,n[a+2]=Math.max(0,Math.min(1,F))*255}return n}const $8="modulepreload",H8=function(t){return"/"+t},aP={},lu=function(e,r,n){let i=Promise.resolve();if(r&&r.length>0){let g=function(_){return Promise.all(_.map(v=>Promise.resolve(v).then(T=>({status:"fulfilled",value:T}),T=>({status:"rejected",reason:T}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),s=c?.nonce||c?.getAttribute("nonce");i=g(r.map(_=>{if(_=H8(_),_ in aP)return;aP[_]=!0;const v=_.endsWith(".css"),T=v?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${_}"]${T}`))return;const M=document.createElement("link");if(M.rel=v?"stylesheet":$8,v||(M.as="script"),M.crossOrigin="",M.href=_,s&&M.setAttribute("nonce",s),document.head.appendChild(M),v)return new Promise((O,F)=>{M.addEventListener("load",O),M.addEventListener("error",()=>F(new Error(`Unable to preload CSS for ${_}`)))})}))}function a(c){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=c,window.dispatchEvent(s),!s.defaultPrevented)throw c}return i.then(c=>{for(const s of c||[])s.status==="rejected"&&a(s.reason);return e().catch(a)})},JD=new Map;function jd(t,e){Array.isArray(t)||(t=[t]),t.forEach(r=>JD.set(r,e))}async function e4(t){const e=JD.get(t.Compression);if(!e)throw new Error(`Unknown compression method identifier: ${t.Compression}`);const r=await e();return new r(t)}jd([void 0,1],()=>lu(()=>import("./raw-in9isEBO.js"),__vite__mapDeps([0,1])).then(t=>t.default));jd(5,()=>lu(()=>import("./lzw-_aCqfs4w.js"),__vite__mapDeps([2,1])).then(t=>t.default));jd(6,()=>{throw new Error("old style JPEG compression is not supported.")});jd(7,()=>lu(()=>import("./jpeg-vtRboCKw.js"),__vite__mapDeps([3,1])).then(t=>t.default));jd([8,32946],()=>lu(()=>import("./deflate-B9JhHpvg.js"),__vite__mapDeps([4,5,1])).then(t=>t.default));jd(32773,()=>lu(()=>import("./packbits-DDWKfGV_.js"),__vite__mapDeps([6,1])).then(t=>t.default));jd(34887,()=>lu(()=>import("./lerc-CMEo9q1U.js"),__vite__mapDeps([7,5,1])).then(async t=>(await t.zstd.init(),t)).then(t=>t.default));jd(50001,()=>lu(()=>import("./webimage-DBgUwIbt.js"),__vite__mapDeps([8,1])).then(t=>t.default));function M1(t,e,r,n=1){return new(Object.getPrototypeOf(t)).constructor(e*r*n)}function W8(t,e,r,n,i){const a=e/n,c=r/i;return t.map(s=>{const g=M1(s,n,i);for(let _=0;_<i;++_){const v=Math.min(Math.round(c*_),r-1);for(let T=0;T<n;++T){const M=Math.min(Math.round(a*T),e-1),O=s[v*e+M];g[_*n+T]=O}}return g})}function ay(t,e,r){return(1-r)*t+r*e}function q8(t,e,r,n,i){const a=e/n,c=r/i;return t.map(s=>{const g=M1(s,n,i);for(let _=0;_<i;++_){const v=c*_,T=Math.floor(v),M=Math.min(Math.ceil(v),r-1);for(let O=0;O<n;++O){const F=a*O,j=F%1,V=Math.floor(F),q=Math.min(Math.ceil(F),e-1),Y=s[T*e+V],X=s[T*e+q],ae=s[M*e+V],ue=s[M*e+q],ge=ay(ay(Y,X,j),ay(ae,ue,j),v%1);g[_*n+O]=ge}}return g})}function G8(t,e,r,n,i,a="nearest"){switch(a.toLowerCase()){case"nearest":return W8(t,e,r,n,i);case"bilinear":case"linear":return q8(t,e,r,n,i);default:throw new Error(`Unsupported resampling method: '${a}'`)}}function X8(t,e,r,n,i,a){const c=e/n,s=r/i,g=M1(t,n,i,a);for(let _=0;_<i;++_){const v=Math.min(Math.round(s*_),r-1);for(let T=0;T<n;++T){const M=Math.min(Math.round(c*T),e-1);for(let O=0;O<a;++O){const F=t[v*e*a+M*a+O];g[_*n*a+T*a+O]=F}}}return g}function Z8(t,e,r,n,i,a){const c=e/n,s=r/i,g=M1(t,n,i,a);for(let _=0;_<i;++_){const v=s*_,T=Math.floor(v),M=Math.min(Math.ceil(v),r-1);for(let O=0;O<n;++O){const F=c*O,j=F%1,V=Math.floor(F),q=Math.min(Math.ceil(F),e-1);for(let Y=0;Y<a;++Y){const X=t[T*e*a+V*a+Y],ae=t[T*e*a+q*a+Y],ue=t[M*e*a+V*a+Y],ge=t[M*e*a+q*a+Y],Le=ay(ay(X,ae,j),ay(ue,ge,j),v%1);g[_*n*a+O*a+Y]=Le}}}return g}function Y8(t,e,r,n,i,a,c="nearest"){switch(c.toLowerCase()){case"nearest":return X8(t,e,r,n,i,a);case"bilinear":case"linear":return Z8(t,e,r,n,i,a);default:throw new Error(`Unsupported resampling method: '${c}'`)}}function K8(t,e,r){let n=0;for(let i=e;i<r;++i)n+=t[i];return n}function fS(t,e,r){switch(t){case 1:if(e<=8)return new Uint8Array(r);if(e<=16)return new Uint16Array(r);if(e<=32)return new Uint32Array(r);break;case 2:if(e===8)return new Int8Array(r);if(e===16)return new Int16Array(r);if(e===32)return new Int32Array(r);break;case 3:switch(e){case 16:case 32:return new Float32Array(r);case 64:return new Float64Array(r)}break}throw Error("Unsupported data format/bitsPerSample")}function Q8(t,e){return(t===1||t===2)&&e<=32&&e%8===0?!1:!(t===3&&(e===16||e===32||e===64))}function J8(t,e,r,n,i,a,c){const s=new DataView(t),g=r===2?c*a:c*a*n,_=r===2?1:n,v=fS(e,i,g),T=parseInt("1".repeat(i),2);if(e===1){let M;r===1?M=n*i:M=i;let O=a*M;(O&7)!==0&&(O=O+7&-8);for(let F=0;F<c;++F){const j=F*O;for(let V=0;V<a;++V){const q=j+V*_*i;for(let Y=0;Y<_;++Y){const X=q+Y*i,ae=(F*a+V)*_+Y,ue=Math.floor(X/8),ge=X%8;if(ge+i<=8)v[ae]=s.getUint8(ue)>>8-i-ge&T;else if(ge+i<=16)v[ae]=s.getUint16(ue)>>16-i-ge&T;else if(ge+i<=24){const Le=s.getUint16(ue)<<8|s.getUint8(ue+2);v[ae]=Le>>24-i-ge&T}else v[ae]=s.getUint32(ue)>>32-i-ge&T}}}}return v.buffer}class eU{constructor(e,r,n,i,a,c){this.fileDirectory=e,this.geoKeys=r,this.dataView=n,this.littleEndian=i,this.tiles=a?{}:null,this.isTiled=!e.StripOffsets;const s=e.PlanarConfiguration;if(this.planarConfiguration=typeof s>"u"?1:s,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=c}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let r=0;r<this.fileDirectory.BitsPerSample.length;++r)e+=this.getSampleByteSize(r);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const r=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,n=this.fileDirectory.BitsPerSample[e];switch(r){case 1:if(n<=8)return DataView.prototype.getUint8;if(n<=16)return DataView.prototype.getUint16;if(n<=32)return DataView.prototype.getUint32;break;case 2:if(n<=8)return DataView.prototype.getInt8;if(n<=16)return DataView.prototype.getInt16;if(n<=32)return DataView.prototype.getInt32;break;case 3:switch(n){case 16:return function(i,a){return QD(this,i,a)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,r){const n=this.getSampleFormat(e),i=this.getBitsPerSample(e);return fS(n,i,r)}async getTileOrStrip(e,r,n,i,a){const c=Math.ceil(this.getWidth()/this.getTileWidth()),s=Math.ceil(this.getHeight()/this.getTileHeight());let g;const{tiles:_}=this;this.planarConfiguration===1?g=r*c+e:this.planarConfiguration===2&&(g=n*c*s+r*c+e);let v,T;this.isTiled?(v=this.fileDirectory.TileOffsets[g],T=this.fileDirectory.TileByteCounts[g]):(v=this.fileDirectory.StripOffsets[g],T=this.fileDirectory.StripByteCounts[g]);const M=(await this.source.fetch([{offset:v,length:T}],a))[0];let O;return _===null||!_[g]?(O=(async()=>{let F=await i.decode(this.fileDirectory,M);const j=this.getSampleFormat(),V=this.getBitsPerSample();return Q8(j,V)&&(F=J8(F,j,this.planarConfiguration,this.getSamplesPerPixel(),V,this.getTileWidth(),this.getBlockHeight(r))),F})(),_!==null&&(_[g]=O)):O=_[g],{x:e,y:r,sample:n,data:await O}}async _readRaster(e,r,n,i,a,c,s,g,_){const v=this.getTileWidth(),T=this.getTileHeight(),M=this.getWidth(),O=this.getHeight(),F=Math.max(Math.floor(e[0]/v),0),j=Math.min(Math.ceil(e[2]/v),Math.ceil(M/v)),V=Math.max(Math.floor(e[1]/T),0),q=Math.min(Math.ceil(e[3]/T),Math.ceil(O/T)),Y=e[2]-e[0];let X=this.getBytesPerPixel();const ae=[],ue=[];for(let qe=0;qe<r.length;++qe)this.planarConfiguration===1?ae.push(K8(this.fileDirectory.BitsPerSample,0,r[qe])/8):ae.push(0),ue.push(this.getReaderForSample(r[qe]));const ge=[],{littleEndian:Le}=this;for(let qe=V;qe<q;++qe)for(let Ze=F;Ze<j;++Ze){let _t;this.planarConfiguration===1&&(_t=this.getTileOrStrip(Ze,qe,0,a,_));for(let it=0;it<r.length;++it){const gt=it,Lt=r[it];this.planarConfiguration===2&&(X=this.getSampleByteSize(Lt),_t=this.getTileOrStrip(Ze,qe,Lt,a,_));const Ot=_t.then(Yt=>{const ce=Yt.data,we=new DataView(ce),Re=this.getBlockHeight(Yt.y),Ue=Yt.y*T,at=Yt.x*v,pe=Ue+Re,Pe=(Yt.x+1)*v,rt=ue[gt],vt=Math.min(Re,Re-(pe-e[3]),O-Ue),At=Math.min(v,v-(Pe-e[2]),M-at);for(let $t=Math.max(0,e[1]-Ue);$t<vt;++$t)for(let Gt=Math.max(0,e[0]-at);Gt<At;++Gt){const nr=($t*v+Gt)*X,Et=rt.call(we,nr+ae[gt],Le);let Wt;i?(Wt=($t+Ue-e[1])*Y*r.length+(Gt+at-e[0])*r.length+gt,n[Wt]=Et):(Wt=($t+Ue-e[1])*Y+Gt+at-e[0],n[gt][Wt]=Et)}});ge.push(Ot)}}if(await Promise.all(ge),c&&e[2]-e[0]!==c||s&&e[3]-e[1]!==s){let qe;return i?qe=Y8(n,e[2]-e[0],e[3]-e[1],c,s,r.length,g):qe=G8(n,e[2]-e[0],e[3]-e[1],c,s,g),qe.width=c,qe.height=s,qe}return n.width=c||e[2]-e[0],n.height=s||e[3]-e[1],n}async readRasters({window:e,samples:r=[],interleave:n,pool:i=null,width:a,height:c,resampleMethod:s,fillValue:g,signal:_}={}){const v=e||[0,0,this.getWidth(),this.getHeight()];if(v[0]>v[2]||v[1]>v[3])throw new Error("Invalid subsets");const T=v[2]-v[0],M=v[3]-v[1],O=T*M,F=this.getSamplesPerPixel();if(!r||!r.length)for(let Y=0;Y<F;++Y)r.push(Y);else for(let Y=0;Y<r.length;++Y)if(r[Y]>=F)return Promise.reject(new RangeError(`Invalid sample index '${r[Y]}'.`));let j;if(n){const Y=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,X=Math.max.apply(null,this.fileDirectory.BitsPerSample);j=fS(Y,X,O*r.length),g&&j.fill(g)}else{j=[];for(let Y=0;Y<r.length;++Y){const X=this.getArrayForSample(r[Y],O);Array.isArray(g)&&Y<g.length?X.fill(g[Y]):g&&!Array.isArray(g)&&X.fill(g),j.push(X)}}const V=i||await e4(this.fileDirectory);return await this._readRaster(v,r,j,n,V,a,c,s,_)}async readRGB({window:e,interleave:r=!0,pool:n=null,width:i,height:a,resampleMethod:c,enableAlpha:s=!1,signal:g}={}){const _=e||[0,0,this.getWidth(),this.getHeight()];if(_[0]>_[2]||_[1]>_[3])throw new Error("Invalid subsets");const v=this.fileDirectory.PhotometricInterpretation;if(v===sl.RGB){let q=[0,1,2];if(this.fileDirectory.ExtraSamples!==O8.Unspecified&&s){q=[];for(let Y=0;Y<this.fileDirectory.BitsPerSample.length;Y+=1)q.push(Y)}return this.readRasters({window:e,interleave:r,samples:q,pool:n,width:i,height:a,resampleMethod:c,signal:g})}let T;switch(v){case sl.WhiteIsZero:case sl.BlackIsZero:case sl.Palette:T=[0];break;case sl.CMYK:T=[0,1,2,3];break;case sl.YCbCr:case sl.CIELab:T=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const M={window:_,interleave:!0,samples:T,pool:n,width:i,height:a,resampleMethod:c,signal:g},{fileDirectory:O}=this,F=await this.readRasters(M),j=2**this.fileDirectory.BitsPerSample[0];let V;switch(v){case sl.WhiteIsZero:V=D8(F,j);break;case sl.BlackIsZero:V=L8(F,j);break;case sl.Palette:V=B8(F,O.ColorMap);break;case sl.CMYK:V=N8(F);break;case sl.YCbCr:V=z8(F);break;case sl.CIELab:V=V8(F);break;default:throw new Error("Unsupported photometric interpretation.")}if(!r){const q=new Uint8Array(V.length/3),Y=new Uint8Array(V.length/3),X=new Uint8Array(V.length/3);for(let ae=0,ue=0;ae<V.length;ae+=3,++ue)q[ue]=V[ae],Y[ue]=V[ae+1],X[ue]=V[ae+2];V=[q,Y,X]}return V.width=F.width,V.height=F.height,V}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let r=0;r<this.fileDirectory.ModelTiepoint.length;r+=6)e.push({i:this.fileDirectory.ModelTiepoint[r],j:this.fileDirectory.ModelTiepoint[r+1],k:this.fileDirectory.ModelTiepoint[r+2],x:this.fileDirectory.ModelTiepoint[r+3],y:this.fileDirectory.ModelTiepoint[r+4],z:this.fileDirectory.ModelTiepoint[r+5]});return e}getGDALMetadata(e=null){const r={};if(!this.fileDirectory.GDAL_METADATA)return null;const n=this.fileDirectory.GDAL_METADATA;let i=I8(n,"Item");e===null?i=i.filter(a=>Hw(a,"sample")===void 0):i=i.filter(a=>Number(Hw(a,"sample"))===e);for(let a=0;a<i.length;++a){const c=i[a];r[Hw(c,"name")]=c.inner}return r}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,r=this.fileDirectory.ModelTransformation;if(e&&e.length===6)return[e[3],e[4],e[5]];if(r)return[r[3],r[7],r[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const r=this.fileDirectory.ModelPixelScale,n=this.fileDirectory.ModelTransformation;if(r)return[r[0],-r[1],r[2]];if(n)return n[1]===0&&n[4]===0?[n[0],-n[5],n[10]]:[Math.sqrt(n[0]*n[0]+n[4]*n[4]),-Math.sqrt(n[1]*n[1]+n[5]*n[5]),n[10]];if(e){const[i,a,c]=e.getResolution();return[i*e.getWidth()/this.getWidth(),a*e.getHeight()/this.getHeight(),c*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(e=!1){const r=this.getHeight(),n=this.getWidth();if(this.fileDirectory.ModelTransformation&&!e){const[i,a,c,s,g,_,v,T]=this.fileDirectory.ModelTransformation,O=[[0,0],[0,r],[n,0],[n,r]].map(([V,q])=>[s+i*V+a*q,T+g*V+_*q]),F=O.map(V=>V[0]),j=O.map(V=>V[1]);return[Math.min(...F),Math.min(...j),Math.max(...F),Math.max(...j)]}else{const i=this.getOrigin(),a=this.getResolution(),c=i[0],s=i[1],g=c+a[0]*n,_=s+a[1]*r;return[Math.min(c,g),Math.min(s,_),Math.max(c,g),Math.max(s,_)]}}}class tU{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,r){const n=this.getUint32(e,r),i=this.getUint32(e+4,r);let a;if(r){if(a=n+2**32*i,!Number.isSafeInteger(a))throw new Error(`${a} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return a}if(a=2**32*n+i,!Number.isSafeInteger(a))throw new Error(`${a} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return a}getInt64(e,r){let n=0;const i=(this._dataView.getUint8(e+(r?7:0))&128)>0;let a=!0;for(let c=0;c<8;c++){let s=this._dataView.getUint8(e+(r?c:7-c));i&&(a?s!==0&&(s=~(s-1)&255,a=!1):s=~s&255),n+=s*256**c}return i&&(n=-n),n}getUint8(e,r){return this._dataView.getUint8(e,r)}getInt8(e,r){return this._dataView.getInt8(e,r)}getUint16(e,r){return this._dataView.getUint16(e,r)}getInt16(e,r){return this._dataView.getInt16(e,r)}getUint32(e,r){return this._dataView.getUint32(e,r)}getInt32(e,r){return this._dataView.getInt32(e,r)}getFloat16(e,r){return QD(this._dataView,e,r)}getFloat32(e,r){return this._dataView.getFloat32(e,r)}getFloat64(e,r){return this._dataView.getFloat64(e,r)}}class rU{constructor(e,r,n,i){this._dataView=new DataView(e),this._sliceOffset=r,this._littleEndian=n,this._bigTiff=i}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,r){return this.sliceOffset<=e&&this.sliceTop>=e+r}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const r=this.readUint32(e),n=this.readUint32(e+4);let i;if(this._littleEndian){if(i=r+2**32*n,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}if(i=2**32*r+n,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}readInt64(e){let r=0;const n=(this._dataView.getUint8(e+(this._littleEndian?7:0))&128)>0;let i=!0;for(let a=0;a<8;a++){let c=this._dataView.getUint8(e+(this._littleEndian?a:7-a));n&&(i?c!==0&&(c=~(c-1)&255,i=!1):c=~c&255),r+=c*256**a}return n&&(r=-r),r}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}const nU=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class iU{constructor(e=nU,r){this.workers=null,this._awaitingDecoder=null,this.size=e,this.messageId=0,e&&(this._awaitingDecoder=r?Promise.resolve(r):new Promise(n=>{lu(()=>import("./decoder-tqM1uIvc.js"),[]).then(i=>{n(i.create)})}),this._awaitingDecoder.then(n=>{this._awaitingDecoder=null,this.workers=[];for(let i=0;i<e;i++)this.workers.push({worker:n(),idle:!0})}))}async decode(e,r){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?e4(e).then(n=>n.decode(e,r)):new Promise(n=>{const i=this.workers.find(s=>s.idle)||this.workers[Math.floor(Math.random()*this.size)];i.idle=!1;const a=this.messageId++,c=s=>{s.data.id===a&&(i.idle=!0,n(s.data.decoded),i.worker.removeEventListener("message",c))};i.worker.addEventListener("message",c),i.worker.postMessage({fileDirectory:e,buffer:r,id:a},[r])})}destroy(){this.workers&&(this.workers.forEach(e=>{e.worker.terminate()}),this.workers=null)}}const oP=`\r
\r
`;function t4(t){if(typeof Object.fromEntries<"u")return Object.fromEntries(t);const e={};for(const[r,n]of t)e[r.toLowerCase()]=n;return e}function sU(t){const e=t.split(`\r
`).map(r=>{const n=r.split(":").map(i=>i.trim());return n[0]=n[0].toLowerCase(),n});return t4(e)}function aU(t){const[e,...r]=t.split(";").map(i=>i.trim()),n=r.map(i=>i.split("="));return{type:e,params:t4(n)}}function dS(t){let e,r,n;return t&&([,e,r,n]=t.match(/bytes (\d+)-(\d+)\/(\d+)/),e=parseInt(e,10),r=parseInt(r,10),n=parseInt(n,10)),{start:e,end:r,total:n}}function oU(t,e){let r=null;const n=new TextDecoder("ascii"),i=[],a=`--${e}`,c=`${a}--`;for(let s=0;s<10;++s)n.decode(new Uint8Array(t,s,a.length))===a&&(r=s);if(r===null)throw new Error("Could not find initial boundary");for(;r<t.byteLength;){const s=n.decode(new Uint8Array(t,r,Math.min(a.length+1024,t.byteLength-r)));if(s.length===0||s.startsWith(c))break;if(!s.startsWith(a))throw new Error("Part does not start with boundary");const g=s.substr(a.length+2);if(g.length===0)break;const _=g.indexOf(oP),v=sU(g.substr(0,_)),{start:T,end:M,total:O}=dS(v["content-range"]),F=r+a.length+_+oP.length,j=parseInt(M,10)+1-parseInt(T,10);i.push({headers:v,data:t.slice(F,F+j),offset:T,length:j,fileSize:O}),r=F+j+4}return i}class r4{async fetch(e,r=void 0){return Promise.all(e.map(n=>this.fetchSlice(n,r)))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}let lU=class extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(const[r,n]of e)this.onEviction(r,n.value)}_deleteIfExpired(e,r){return typeof r.expiry=="number"&&r.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,r.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,r){if(this._deleteIfExpired(e,r)===!1)return r.value}_getItemValue(e,r){return r.expiry?this._getOrDeleteIfExpired(e,r):r.value}_peek(e,r){const n=r.get(e);return this._getItemValue(e,n)}_set(e,r){this.cache.set(e,r),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,r){this.oldCache.delete(e),this._set(e,r)}*_entriesAscending(){for(const e of this.oldCache){const[r,n]=e;this.cache.has(r)||this._deleteIfExpired(r,n)===!1&&(yield e)}for(const e of this.cache){const[r,n]=e;this._deleteIfExpired(r,n)===!1&&(yield e)}}get(e){if(this.cache.has(e)){const r=this.cache.get(e);return this._getItemValue(e,r)}if(this.oldCache.has(e)){const r=this.oldCache.get(e);if(this._deleteIfExpired(e,r)===!1)return this._moveToRecent(e,r),r.value}}set(e,r,{maxAge:n=this.maxAge}={}){const i=typeof n=="number"&&n!==Number.POSITIVE_INFINITY?Date.now()+n:void 0;return this.cache.has(e)?this.cache.set(e,{value:r,expiry:i}):this._set(e,{value:r,expiry:i}),this}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){const r=this.cache.delete(e);return r&&this._size--,this.oldCache.delete(e)||r}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const r=[...this._entriesAscending()],n=r.length-e;n<0?(this.cache=new Map(r),this.oldCache=new Map,this._size=r.length):(n>0&&this._emitEvictions(r.slice(0,n)),this.oldCache=new Map(r.slice(n)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[r,n]=e;this._deleteIfExpired(r,n)===!1&&(yield[r,n.value])}for(const e of this.oldCache){const[r,n]=e;this.cache.has(r)||this._deleteIfExpired(r,n)===!1&&(yield[r,n.value])}}*entriesDescending(){let e=[...this.cache];for(let r=e.length-1;r>=0;--r){const n=e[r],[i,a]=n;this._deleteIfExpired(i,a)===!1&&(yield[i,a.value])}e=[...this.oldCache];for(let r=e.length-1;r>=0;--r){const n=e[r],[i,a]=n;this.cache.has(i)||this._deleteIfExpired(i,a)===!1&&(yield[i,a.value])}}*entriesAscending(){for(const[e,r]of this._entriesAscending())yield[e,r.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const r of this.oldCache.keys())this.cache.has(r)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,r=this){for(const[n,i]of this.entriesAscending())e.call(r,i,n,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}};async function cU(t){return new Promise(e=>setTimeout(e,t))}function uU(t,e){const r=Array.isArray(t)?t:Array.from(t),n=Array.isArray(e)?e:Array.from(e);return r.map((i,a)=>[i,n[a]])}class dy extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,dy),this.name="AbortError"}}class hU extends Error{constructor(e,r){super(r),this.errors=e,this.message=r,this.name="AggregateError"}}const fU=hU;class dU{constructor(e,r,n=null){this.offset=e,this.length=r,this.data=n}get top(){return this.offset+this.length}}class lP{constructor(e,r,n){this.offset=e,this.length=r,this.blockIds=n}}class pU extends r4{constructor(e,{blockSize:r=65536,cacheSize:n=100}={}){super(),this.source=e,this.blockSize=r,this.blockCache=new lU({maxSize:n,onEviction:(i,a)=>{this.evictedBlocks.set(i,a)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(e,r){const n=[],i=[],a=[];this.evictedBlocks.clear();for(const{offset:M,length:O}of e){let F=M+O;const{fileSize:j}=this;j!==null&&(F=Math.min(F,j));const V=Math.floor(M/this.blockSize)*this.blockSize;for(let q=V;q<F;q+=this.blockSize){const Y=Math.floor(q/this.blockSize);!this.blockCache.has(Y)&&!this.blockRequests.has(Y)&&(this.blockIdsToFetch.add(Y),i.push(Y)),this.blockRequests.has(Y)&&n.push(this.blockRequests.get(Y)),a.push(Y)}}await cU(),this.fetchBlocks(r);const c=[];for(const M of i)this.blockRequests.has(M)&&c.push(this.blockRequests.get(M));await Promise.allSettled(n),await Promise.allSettled(c);const s=[],g=a.filter(M=>this.abortedBlockIds.has(M)||!this.blockCache.has(M));if(g.forEach(M=>this.blockIdsToFetch.add(M)),g.length>0&&r&&!r.aborted){this.fetchBlocks(null);for(const M of g){const O=this.blockRequests.get(M);if(!O)throw new Error(`Block ${M} is not in the block requests`);s.push(O)}await Promise.allSettled(s)}if(r&&r.aborted)throw new dy("Request was aborted");const _=a.map(M=>this.blockCache.get(M)||this.evictedBlocks.get(M)),v=_.filter(M=>!M);if(v.length)throw new fU(v,"Request failed");const T=new Map(uU(a,_));return this.readSliceData(e,T)}fetchBlocks(e){if(this.blockIdsToFetch.size>0){const r=this.groupBlocks(this.blockIdsToFetch),n=this.source.fetch(r,e);for(let i=0;i<r.length;++i){const a=r[i];for(const c of a.blockIds)this.blockRequests.set(c,(async()=>{try{const s=(await n)[i],g=c*this.blockSize,_=g-s.offset,v=Math.min(_+this.blockSize,s.data.byteLength),T=s.data.slice(_,v),M=new dU(g,T.byteLength,T,c);this.blockCache.set(c,M),this.abortedBlockIds.delete(c)}catch(s){if(s.name==="AbortError")s.signal=e,this.blockCache.delete(c),this.abortedBlockIds.add(c);else throw s}finally{this.blockRequests.delete(c)}})())}this.blockIdsToFetch.clear()}}groupBlocks(e){const r=Array.from(e).sort((c,s)=>c-s);if(r.length===0)return[];let n=[],i=null;const a=[];for(const c of r)i===null||i+1===c?(n.push(c),i=c):(a.push(new lP(n[0]*this.blockSize,n.length*this.blockSize,n)),n=[c],i=c);return a.push(new lP(n[0]*this.blockSize,n.length*this.blockSize,n)),a}readSliceData(e,r){return e.map(n=>{let i=n.offset+n.length;this.fileSize!==null&&(i=Math.min(this.fileSize,i));const a=Math.floor(n.offset/this.blockSize),c=Math.floor(i/this.blockSize),s=new ArrayBuffer(n.length),g=new Uint8Array(s);for(let _=a;_<=c;++_){const v=r.get(_),T=v.offset-n.offset,M=v.top-i;let O=0,F=0,j;T<0?O=-T:T>0&&(F=T),M<0?j=v.length-O:j=i-v.offset-O;const V=new Uint8Array(v.data,O,j);g.set(V,F)}return s})}}class ZA{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(e){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class YA{constructor(e){this.url=e}async request({headers:e,signal:r}={}){throw new Error("request is not implemented")}}class gU extends ZA{constructor(e){super(),this.response=e}get status(){return this.response.status}getHeader(e){return this.response.headers.get(e)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class mU extends YA{constructor(e,r){super(e),this.credentials=r}async request({headers:e,signal:r}={}){const n=await fetch(this.url,{headers:e,credentials:this.credentials,signal:r});return new gU(n)}}class yU extends ZA{constructor(e,r){super(),this.xhr=e,this.data=r}get status(){return this.xhr.status}getHeader(e){return this.xhr.getResponseHeader(e)}async getData(){return this.data}}class _U extends YA{constructRequest(e,r){return new Promise((n,i)=>{const a=new XMLHttpRequest;a.open("GET",this.url),a.responseType="arraybuffer";for(const[c,s]of Object.entries(e))a.setRequestHeader(c,s);a.onload=()=>{const c=a.response;n(new yU(a,c))},a.onerror=i,a.onabort=()=>i(new dy("Request aborted")),a.send(),r&&(r.aborted&&a.abort(),r.addEventListener("abort",()=>a.abort()))})}async request({headers:e,signal:r}={}){return await this.constructRequest(e,r)}}const qw={};class vU extends ZA{constructor(e,r){super(),this.response=e,this.dataPromise=r}get status(){return this.response.statusCode}getHeader(e){return this.response.headers[e]}async getData(){return await this.dataPromise}}class bU extends YA{constructor(e){super(e),this.parsedUrl=qw.parse(this.url),this.httpApi=(this.parsedUrl.protocol==="http:",qw)}constructRequest(e,r){return new Promise((n,i)=>{const a=this.httpApi.get({...this.parsedUrl,headers:e},c=>{const s=new Promise(g=>{const _=[];c.on("data",v=>{_.push(v)}),c.on("end",()=>{const v=Buffer.concat(_).buffer;g(v)}),c.on("error",i)});n(new vU(c,s))});a.on("error",i),r&&(r.aborted&&a.destroy(new dy("Request aborted")),r.addEventListener("abort",()=>a.destroy(new dy("Request aborted"))))})}async request({headers:e,signal:r}={}){return await this.constructRequest(e,r)}}class KA extends r4{constructor(e,r,n,i){super(),this.client=e,this.headers=r,this.maxRanges=n,this.allowFullFile=i,this._fileSize=null}async fetch(e,r){return this.maxRanges>=e.length?this.fetchSlices(e,r):(this.maxRanges>0&&e.length>1,Promise.all(e.map(n=>this.fetchSlice(n,r))))}async fetchSlices(e,r){const n=await this.client.request({headers:{...this.headers,Range:`bytes=${e.map(({offset:i,length:a})=>`${i}-${i+a}`).join(",")}`},signal:r});if(n.ok)if(n.status===206){const{type:i,params:a}=aU(n.getHeader("content-type"));if(i==="multipart/byteranges"){const T=oU(await n.getData(),a.boundary);return this._fileSize=T[0].fileSize||null,T}const c=await n.getData(),{start:s,end:g,total:_}=dS(n.getHeader("content-range"));this._fileSize=_||null;const v=[{data:c,offset:s,length:g-s}];if(e.length>1){const T=await Promise.all(e.slice(1).map(M=>this.fetchSlice(M,r)));return v.concat(T)}return v}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const i=await n.getData();return this._fileSize=i.byteLength,[{data:i,offset:0,length:i.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(e,r){const{offset:n,length:i}=e,a=await this.client.request({headers:{...this.headers,Range:`bytes=${n}-${n+i}`},signal:r});if(a.ok)if(a.status===206){const c=await a.getData(),{total:s}=dS(a.getHeader("content-range"));return this._fileSize=s||null,{data:c,offset:n,length:i}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const c=await a.getData();return this._fileSize=c.byteLength,{data:c,offset:0,length:c.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function QA(t,{blockSize:e,cacheSize:r}){return e===null?t:new pU(t,{blockSize:e,cacheSize:r})}function xU(t,{headers:e={},credentials:r,maxRanges:n=0,allowFullFile:i=!1,...a}={}){const c=new mU(t,r),s=new KA(c,e,n,i);return QA(s,a)}function wU(t,{headers:e={},maxRanges:r=0,allowFullFile:n=!1,...i}={}){const a=new _U(t),c=new KA(a,e,r,n);return QA(c,i)}function TU(t,{headers:e={},maxRanges:r=0,allowFullFile:n=!1,...i}={}){const a=new bU(t),c=new KA(a,e,r,n);return QA(c,i)}function SU(t,{forceXHR:e=!1,...r}={}){return typeof fetch=="function"&&!e?xU(t,r):typeof XMLHttpRequest<"u"?wU(t,r):TU(t,r)}function pS(t){switch(t){case Vr.BYTE:case Vr.ASCII:case Vr.SBYTE:case Vr.UNDEFINED:return 1;case Vr.SHORT:case Vr.SSHORT:return 2;case Vr.LONG:case Vr.SLONG:case Vr.FLOAT:case Vr.IFD:return 4;case Vr.RATIONAL:case Vr.SRATIONAL:case Vr.DOUBLE:case Vr.LONG8:case Vr.SLONG8:case Vr.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${t}`)}}function AU(t){const e=t.GeoKeyDirectory;if(!e)return null;const r={};for(let n=4;n<=e[3]*4;n+=4){const i=k8[e[n]],a=e[n+1]?xv[e[n+1]]:null,c=e[n+2],s=e[n+3];let g=null;if(!a)g=s;else{if(g=t[a],typeof g>"u"||g===null)throw new Error(`Could not get value of geoKey '${i}'.`);typeof g=="string"?g=g.substring(s,s+c-1):g.subarray&&(g=g.subarray(s,s+c),c===1&&(g=g[0]))}r[i]=g}return r}function $m(t,e,r,n){let i=null,a=null;const c=pS(e);switch(e){case Vr.BYTE:case Vr.ASCII:case Vr.UNDEFINED:i=new Uint8Array(r),a=t.readUint8;break;case Vr.SBYTE:i=new Int8Array(r),a=t.readInt8;break;case Vr.SHORT:i=new Uint16Array(r),a=t.readUint16;break;case Vr.SSHORT:i=new Int16Array(r),a=t.readInt16;break;case Vr.LONG:case Vr.IFD:i=new Uint32Array(r),a=t.readUint32;break;case Vr.SLONG:i=new Int32Array(r),a=t.readInt32;break;case Vr.LONG8:case Vr.IFD8:i=new Array(r),a=t.readUint64;break;case Vr.SLONG8:i=new Array(r),a=t.readInt64;break;case Vr.RATIONAL:i=new Uint32Array(r*2),a=t.readUint32;break;case Vr.SRATIONAL:i=new Int32Array(r*2),a=t.readInt32;break;case Vr.FLOAT:i=new Float32Array(r),a=t.readFloat32;break;case Vr.DOUBLE:i=new Float64Array(r),a=t.readFloat64;break;default:throw new RangeError(`Invalid field type: ${e}`)}if(e===Vr.RATIONAL||e===Vr.SRATIONAL)for(let s=0;s<r;s+=2)i[s]=a.call(t,n+s*c),i[s+1]=a.call(t,n+(s*c+4));else for(let s=0;s<r;++s)i[s]=a.call(t,n+s*c);return e===Vr.ASCII?new TextDecoder("utf-8").decode(i):i}class EU{constructor(e,r,n){this.fileDirectory=e,this.geoKeyDirectory=r,this.nextIFDByteOffset=n}}class wb extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class CU{async readRasters(e={}){const{window:r,width:n,height:i}=e;let{resX:a,resY:c,bbox:s}=e;const g=await this.getImage();let _=g;const v=await this.getImageCount(),T=g.getBoundingBox();if(r&&s)throw new Error('Both "bbox" and "window" passed.');if(n||i){if(r){const[F,j]=g.getOrigin(),[V,q]=g.getResolution();s=[F+r[0]*V,j+r[1]*q,F+r[2]*V,j+r[3]*q]}const O=s||T;if(n){if(a)throw new Error("Both width and resX passed");a=(O[2]-O[0])/n}if(i){if(c)throw new Error("Both width and resY passed");c=(O[3]-O[1])/i}}if(a||c){const O=[];for(let F=0;F<v;++F){const j=await this.getImage(F),{SubfileType:V,NewSubfileType:q}=j.fileDirectory;(F===0||V===2||q&1)&&O.push(j)}O.sort((F,j)=>F.getWidth()-j.getWidth());for(let F=0;F<O.length;++F){const j=O[F],V=(T[2]-T[0])/j.getWidth(),q=(T[3]-T[1])/j.getHeight();if(_=j,a&&a>V||c&&c>q)break}}let M=r;if(s){const[O,F]=g.getOrigin(),[j,V]=_.getResolution(g);M=[Math.round((s[0]-O)/j),Math.round((s[1]-F)/V),Math.round((s[2]-O)/j),Math.round((s[3]-F)/V)],M=[Math.min(M[0],M[2]),Math.min(M[1],M[3]),Math.max(M[0],M[2]),Math.max(M[1],M[3])]}return _.readRasters({...e,window:M})}}class JA extends CU{constructor(e,r,n,i,a={}){super(),this.source=e,this.littleEndian=r,this.bigTiff=n,this.firstIFDOffset=i,this.cache=a.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,r){const n=this.bigTiff?4048:1024;return new rU((await this.source.fetch([{offset:e,length:typeof r<"u"?r:n}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const r=this.bigTiff?20:12,n=this.bigTiff?8:2;let i=await this.getSlice(e);const a=this.bigTiff?i.readUint64(e):i.readUint16(e),c=a*r+(this.bigTiff?16:6);i.covers(e,c)||(i=await this.getSlice(e,c));const s={};let g=e+(this.bigTiff?8:2);for(let T=0;T<a;g+=r,++T){const M=i.readUint16(g),O=i.readUint16(g+2),F=this.bigTiff?i.readUint64(g+4):i.readUint32(g+4);let j,V;const q=pS(O),Y=g+(this.bigTiff?12:8);if(q*F<=(this.bigTiff?8:4))j=$m(i,O,F,Y);else{const X=i.readOffset(Y),ae=pS(O)*F;if(i.covers(X,ae))j=$m(i,O,F,X);else{const ue=await this.getSlice(X,ae);j=$m(ue,O,F,X)}}F===1&&R8.indexOf(M)===-1&&!(O===Vr.RATIONAL||O===Vr.SRATIONAL)?V=j[0]:V=j,s[xv[M]]=V}const _=AU(s),v=i.readOffset(e+n+r*a);return new EU(s,_,v)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(e===0)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(r){throw r instanceof wb?new wb(e):r}return this.ifdRequests[e]=(async()=>{const r=await this.ifdRequests[e-1];if(r.nextIFDByteOffset===0)throw new wb(e);return this.parseFileDirectoryAt(r.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const r=await this.requestIFD(e);return new eU(r.fileDirectory,r.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,r=!0;for(;r;)try{await this.requestIFD(e),++e}catch(n){if(n instanceof wb)r=!1;else throw n}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const r="GDAL_STRUCTURAL_METADATA_SIZE=",n=r.length+100;let i=await this.getSlice(e,n);if(r===$m(i,Vr.ASCII,r.length,e)){const c=$m(i,Vr.ASCII,n,e).split(`
`)[0],s=Number(c.split("=")[1].split(" ")[0])+c.length;s>n&&(i=await this.getSlice(e,s));const g=$m(i,Vr.ASCII,s,e);this.ghostValues={},g.split(`
`).filter(_=>_.length>0).map(_=>_.split("=")).forEach(([_,v])=>{this.ghostValues[_]=v})}return this.ghostValues}static async fromSource(e,r,n){const i=(await e.fetch([{offset:0,length:1024}],n))[0],a=new tU(i),c=a.getUint16(0,0);let s;if(c===18761)s=!0;else if(c===19789)s=!1;else throw new TypeError("Invalid byte order value.");const g=a.getUint16(2,s);let _;if(g===42)_=!1;else if(g===43){if(_=!0,a.getUint16(4,s)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const v=_?a.getUint64(8,s):a.getUint32(4,s);return new JA(e,s,_,v,r)}close(){return typeof this.source.close=="function"?this.source.close():!1}}async function PU(t,e={},r){return JA.fromSource(SU(t,e),r)}class eE extends Map{#r=0;#e=new Map;#t=new Map;#i;#l;#s;constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.#i=e.maxSize,this.#l=e.maxAge||Number.POSITIVE_INFINITY,this.#s=e.onEviction}get __oldCache(){return this.#t}#a(e){if(typeof this.#s=="function")for(const[r,n]of e)this.#s(r,n.value)}#n(e,r){return typeof r.expiry=="number"&&r.expiry<=Date.now()?(typeof this.#s=="function"&&this.#s(e,r.value),this.delete(e)):!1}#f(e,r){if(this.#n(e,r)===!1)return r.value}#c(e,r){return r.expiry?this.#f(e,r):r.value}#u(e,r){const n=r.get(e);return this.#c(e,n)}#h(e,r){this.#e.set(e,r),this.#r++,this.#r>=this.#i&&(this.#r=0,this.#a(this.#t),this.#t=this.#e,this.#e=new Map)}#d(e,r){this.#t.delete(e),this.#h(e,r)}*#o(){for(const e of this.#t){const[r,n]=e;this.#e.has(r)||this.#n(r,n)===!1&&(yield e)}for(const e of this.#e){const[r,n]=e;this.#n(r,n)===!1&&(yield e)}}get(e){if(this.#e.has(e)){const r=this.#e.get(e);return this.#c(e,r)}if(this.#t.has(e)){const r=this.#t.get(e);if(this.#n(e,r)===!1)return this.#d(e,r),r.value}}set(e,r,{maxAge:n=this.#l}={}){const i=typeof n=="number"&&n!==Number.POSITIVE_INFINITY?Date.now()+n:void 0;return this.#e.has(e)?this.#e.set(e,{value:r,expiry:i}):this.#h(e,{value:r,expiry:i}),this}has(e){return this.#e.has(e)?!this.#n(e,this.#e.get(e)):this.#t.has(e)?!this.#n(e,this.#t.get(e)):!1}peek(e){if(this.#e.has(e))return this.#u(e,this.#e);if(this.#t.has(e))return this.#u(e,this.#t)}expiresIn(e){const r=this.#e.get(e)??this.#t.get(e);if(r)return r.expiry?r.expiry-Date.now():Number.POSITIVE_INFINITY}delete(e){const r=this.#e.delete(e);return r&&this.#r--,this.#t.delete(e)||r}clear(){this.#e.clear(),this.#t.clear(),this.#r=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const r=[...this.#o()],n=r.length-e;n<0?(this.#e=new Map(r),this.#t=new Map,this.#r=r.length):(n>0&&this.#a(r.slice(0,n)),this.#t=new Map(r.slice(n)),this.#e=new Map,this.#r=0),this.#i=e}evict(e=1){const r=Number(e);if(!r||r<=0)return;const n=[...this.#o()],i=Math.trunc(Math.min(r,Math.max(n.length-1,0)));i<=0||(this.#a(n.slice(0,i)),this.#t=new Map(n.slice(i)),this.#e=new Map,this.#r=0)}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.#e){const[r,n]=e;this.#n(r,n)===!1&&(yield[r,n.value])}for(const e of this.#t){const[r,n]=e;this.#e.has(r)||this.#n(r,n)===!1&&(yield[r,n.value])}}*entriesDescending(){let e=[...this.#e];for(let r=e.length-1;r>=0;--r){const n=e[r],[i,a]=n;this.#n(i,a)===!1&&(yield[i,a.value])}e=[...this.#t];for(let r=e.length-1;r>=0;--r){const n=e[r],[i,a]=n;this.#e.has(i)||this.#n(i,a)===!1&&(yield[i,a.value])}}*entriesAscending(){for(const[e,r]of this.#o())yield[e,r.value]}get size(){if(!this.#r)return this.#t.size;let e=0;for(const r of this.#t.keys())this.#e.has(r)||e++;return Math.min(this.#r+e,this.#i)}get maxSize(){return this.#i}entries(){return this.entriesAscending()}forEach(e,r=this){for(const[n,i]of this.entriesAscending())e.call(r,i,n,this)}get[Symbol.toStringTag](){return"QuickLRU"}toString(){return`QuickLRU(${this.size}/${this.maxSize})`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}}var Gw={exports:{}},cP;function MU(){return cP||(cP=1,(function(t,e){var r=(function(){var n={},i=Math.PI/180,a=180/Math.PI,c=6378137,s=20037508342789244e-9;function g(v){return Number(v)===v&&v%1!==0}function _(v){if(v=v||{},this.size=v.size||256,this.expansion=v.antimeridian===!0?2:1,!n[this.size]){var T=this.size,M=n[this.size]={};M.Bc=[],M.Cc=[],M.zc=[],M.Ac=[];for(var O=0;O<30;O++)M.Bc.push(T/360),M.Cc.push(T/(2*Math.PI)),M.zc.push(T/2),M.Ac.push(T),T*=2}this.Bc=n[this.size].Bc,this.Cc=n[this.size].Cc,this.zc=n[this.size].zc,this.Ac=n[this.size].Ac}return _.prototype.px=function(v,T){if(g(T)){var M=this.size*Math.pow(2,T),O=M/2,F=M/360,j=M/(2*Math.PI),V=M,q=Math.min(Math.max(Math.sin(i*v[1]),-.9999),.9999),Y=O+v[0]*F,X=O+.5*Math.log((1+q)/(1-q))*-j;return Y>V*this.expansion&&(Y=V*this.expansion),X>V&&(X=V),[Y,X]}else{var O=this.zc[T],q=Math.min(Math.max(Math.sin(i*v[1]),-.9999),.9999),Y=Math.round(O+v[0]*this.Bc[T]),X=Math.round(O+.5*Math.log((1+q)/(1-q))*-this.Cc[T]);return Y>this.Ac[T]*this.expansion&&(Y=this.Ac[T]*this.expansion),X>this.Ac[T]&&(X=this.Ac[T]),[Y,X]}},_.prototype.ll=function(v,T){if(g(T)){var M=this.size*Math.pow(2,T),O=M/360,F=M/(2*Math.PI),j=M/2,V=(v[1]-j)/-F,q=(v[0]-j)/O,Y=a*(2*Math.atan(Math.exp(V))-.5*Math.PI);return[q,Y]}else{var V=(v[1]-this.zc[T])/-this.Cc[T],q=(v[0]-this.zc[T])/this.Bc[T],Y=a*(2*Math.atan(Math.exp(V))-.5*Math.PI);return[q,Y]}},_.prototype.bbox=function(v,T,M,O,F){O&&(T=Math.pow(2,M)-1-T);var j=[v*this.size,(+T+1)*this.size],V=[(+v+1)*this.size,T*this.size],q=this.ll(j,M).concat(this.ll(V,M));return F==="900913"?this.convert(q,"900913"):q},_.prototype.xyz=function(v,T,M,O){O==="900913"&&(v=this.convert(v,"WGS84"));var F=[v[0],v[1]],j=[v[2],v[3]],V=this.px(F,T),q=this.px(j,T),Y=[Math.floor(V[0]/this.size),Math.floor((q[0]-1)/this.size)],X=[Math.floor(q[1]/this.size),Math.floor((V[1]-1)/this.size)],ae={minX:Math.min.apply(Math,Y)<0?0:Math.min.apply(Math,Y),minY:Math.min.apply(Math,X)<0?0:Math.min.apply(Math,X),maxX:Math.max.apply(Math,Y),maxY:Math.max.apply(Math,X)};if(M){var ue={minY:Math.pow(2,T)-1-ae.maxY,maxY:Math.pow(2,T)-1-ae.minY};ae.minY=ue.minY,ae.maxY=ue.maxY}return ae},_.prototype.convert=function(v,T){return T==="900913"?this.forward(v.slice(0,2)).concat(this.forward(v.slice(2,4))):this.inverse(v.slice(0,2)).concat(this.inverse(v.slice(2,4)))},_.prototype.forward=function(v){var T=[c*v[0]*i,c*Math.log(Math.tan(Math.PI*.25+.5*v[1]*i))];return T[0]>s&&(T[0]=s),T[0]<-s&&(T[0]=-s),T[1]>s&&(T[1]=s),T[1]<-s&&(T[1]=-s),T},_.prototype.inverse=function(v){return[v[0]*a/c,(Math.PI*.5-2*Math.atan(Math.exp(-v[1]/c)))*a]},_})();t.exports=r})(Gw)),Gw.exports}var IU=MU();const RU=xl(IU),n4=256,OU=2*20037508342789244e-9,gS=new RU({size:n4,antimeridian:!0}),kU=({x:t,y:e,z:r})=>gS.bbox(t,e,r,!1,"900913"),DU=([t,e,r,n])=>[...gS.inverse([t,e]),...gS.inverse([r,n])],LU=t=>Math.log2(OU/(n4*t)),tE=3600*1e3;let Xw;const uP=new eE({maxSize:16,maxAge:tE}),hP=new eE({maxSize:16,maxAge:tE}),fP=new eE({maxSize:1024,maxAge:tE}),i4=t=>{Xw===void 0&&(Xw=new iU);const e=a=>{const c=uP.get(a);if(c)return c;{const s=PU(a,void 0);return uP.set(a,s),s}},r=async()=>{const a=hP.get(t);if(a)return a;{const c=await e(t),s=await c.getImage(),g=s.getGDALMetadata(0),_=s.fileDirectory,v=s.fileDirectory?.Artist,T=DU(s.getBoundingBox()),M=[],O=await c.getImageCount();for(let j=0;j<O;j++){const V=await c.getImage(j),q=LU(V.getResolution(s)[0]),Y=!!(V.fileDirectory.NewSubfileType&1),X=!!(V.fileDirectory.NewSubfileType&4);M.push({zoom:q,isOverview:Y,isMask:X})}const F={offset:g?.OFFSET!==void 0?parseFloat(g.OFFSET):0,scale:g?.SCALE!==void 0?parseFloat(g.SCALE):1,noData:s.getGDALNoData()??void 0,photometricInterpretation:_?.PhotometricInterpretation,bitsPerSample:_?.BitsPerSample,colorMap:_?.ColorMap,artist:v,bbox:T,images:M};return hP.set(t,F),F}};return{getTilejson:async a=>{const{artist:c,images:s,bbox:g}=await r(),_=s.map(v=>v.zoom);return{tilejson:"2.2.0",tiles:[a+"/{z}/{x}/{y}"],attribution:c,minzoom:Math.round(Math.min(..._)),maxzoom:Math.round(Math.max(..._)),bounds:g}},getMetadata:r,getRawTile:async({z:a,x:c,y:s},g=256)=>{const _=`${t}/${g}/${a}/${c}/${s}`,v=fP.get(_);if(v)return v;{const T=await e(t),{noData:M}=await r(),O=M===void 0||isNaN(M)?1/0:M,F=T.readRasters({bbox:kU({x:c,y:s,z:a}),width:g,height:g,interleave:!0,resampleMethod:"nearest",pool:Xw,fillValue:O});return fP.set(_,F),F}}}};function Ld(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function BU(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function rE(t){let e,r,n;t.length!==2?(e=Ld,r=(s,g)=>Ld(t(s),g),n=(s,g)=>t(s)-g):(e=t===Ld||t===BU?t:NU,r=t,n=t);function i(s,g,_=0,v=s.length){if(_<v){if(e(g,g)!==0)return v;do{const T=_+v>>>1;r(s[T],g)<0?_=T+1:v=T}while(_<v)}return _}function a(s,g,_=0,v=s.length){if(_<v){if(e(g,g)!==0)return v;do{const T=_+v>>>1;r(s[T],g)<=0?_=T+1:v=T}while(_<v)}return _}function c(s,g,_=0,v=s.length){const T=i(s,g,_,v-1);return T>_&&n(s[T-1],g)>-n(s[T],g)?T-1:T}return{left:i,center:c,right:a}}function NU(){return 0}function s4(t){return t===null?NaN:+t}function*zU(t,e){for(let r of t)r!=null&&(r=+r)>=r&&(yield r)}const FU=rE(Ld),r0=FU.right;rE(s4).center;class dP extends Map{constructor(e,r=VU){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),e!=null)for(const[n,i]of e)this.set(n,i)}get(e){return super.get(pP(this,e))}has(e){return super.has(pP(this,e))}set(e,r){return super.set(UU(this,e),r)}delete(e){return super.delete(jU(this,e))}}function pP({_intern:t,_key:e},r){const n=e(r);return t.has(n)?t.get(n):r}function UU({_intern:t,_key:e},r){const n=e(r);return t.has(n)?t.get(n):(t.set(n,r),r)}function jU({_intern:t,_key:e},r){const n=e(r);return t.has(n)&&(r=t.get(n),t.delete(n)),r}function VU(t){return t!==null&&typeof t=="object"?t.valueOf():t}function $U(t=Ld){if(t===Ld)return a4;if(typeof t!="function")throw new TypeError("compare is not a function");return(e,r)=>{const n=t(e,r);return n||n===0?n:(t(r,r)===0)-(t(e,e)===0)}}function a4(t,e){return(t==null||!(t>=t))-(e==null||!(e>=e))||(t<e?-1:t>e?1:0)}const HU=Math.sqrt(50),WU=Math.sqrt(10),qU=Math.sqrt(2);function wx(t,e,r){const n=(e-t)/Math.max(0,r),i=Math.floor(Math.log10(n)),a=n/Math.pow(10,i),c=a>=HU?10:a>=WU?5:a>=qU?2:1;let s,g,_;return i<0?(_=Math.pow(10,-i)/c,s=Math.round(t*_),g=Math.round(e*_),s/_<t&&++s,g/_>e&&--g,_=-_):(_=Math.pow(10,i)*c,s=Math.round(t/_),g=Math.round(e/_),s*_<t&&++s,g*_>e&&--g),g<s&&.5<=r&&r<2?wx(t,e,r*2):[s,g,_]}function mS(t,e,r){if(e=+e,t=+t,r=+r,!(r>0))return[];if(t===e)return[t];const n=e<t,[i,a,c]=n?wx(e,t,r):wx(t,e,r);if(!(a>=i))return[];const s=a-i+1,g=new Array(s);if(n)if(c<0)for(let _=0;_<s;++_)g[_]=(a-_)/-c;else for(let _=0;_<s;++_)g[_]=(a-_)*c;else if(c<0)for(let _=0;_<s;++_)g[_]=(i+_)/-c;else for(let _=0;_<s;++_)g[_]=(i+_)*c;return g}function yS(t,e,r){return e=+e,t=+t,r=+r,wx(t,e,r)[2]}function _S(t,e,r){e=+e,t=+t,r=+r;const n=e<t,i=n?yS(e,t,r):yS(t,e,r);return(n?-1:1)*(i<0?1/-i:i)}function gP(t,e){let r;for(const n of t)n!=null&&(r<n||r===void 0&&n>=n)&&(r=n);return r}function mP(t,e){let r;for(const n of t)n!=null&&(r>n||r===void 0&&n>=n)&&(r=n);return r}function o4(t,e,r=0,n=1/0,i){if(e=Math.floor(e),r=Math.floor(Math.max(0,r)),n=Math.floor(Math.min(t.length-1,n)),!(r<=e&&e<=n))return t;for(i=i===void 0?a4:$U(i);n>r;){if(n-r>600){const g=n-r+1,_=e-r+1,v=Math.log(g),T=.5*Math.exp(2*v/3),M=.5*Math.sqrt(v*T*(g-T)/g)*(_-g/2<0?-1:1),O=Math.max(r,Math.floor(e-_*T/g+M)),F=Math.min(n,Math.floor(e+(g-_)*T/g+M));o4(t,e,O,F,i)}const a=t[e];let c=r,s=n;for(ev(t,r,e),i(t[n],a)>0&&ev(t,r,n);c<s;){for(ev(t,c,s),++c,--s;i(t[c],a)<0;)++c;for(;i(t[s],a)>0;)--s}i(t[r],a)===0?ev(t,r,s):(++s,ev(t,s,n)),s<=e&&(r=s+1),e<=s&&(n=s-1)}return t}function ev(t,e,r){const n=t[e];t[e]=t[r],t[r]=n}function GU(t,e,r){if(t=Float64Array.from(zU(t)),!(!(n=t.length)||isNaN(e=+e))){if(e<=0||n<2)return mP(t);if(e>=1)return gP(t);var n,i=(n-1)*e,a=Math.floor(i),c=gP(o4(t,a).subarray(0,a+1)),s=mP(t.subarray(a+1));return c+(s-c)*(i-a)}}function XU(t,e,r=s4){if(!(!(n=t.length)||isNaN(e=+e))){if(e<=0||n<2)return+r(t[0],0,t);if(e>=1)return+r(t[n-1],n-1,t);var n,i=(n-1)*e,a=Math.floor(i),c=+r(t[a],a,t),s=+r(t[a+1],a+1,t);return c+(s-c)*(i-a)}}function ZU(t,e,r){t=+t,e=+e,r=(i=arguments.length)<2?(e=t,t=0,1):i<3?1:+r;for(var n=-1,i=Math.max(0,Math.ceil((e-t)/r))|0,a=new Array(i);++n<i;)a[n]=t+n*r;return a}function _c(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function wf(t,e){switch(arguments.length){case 0:break;case 1:{typeof t=="function"?this.interpolator(t):this.range(t);break}default:{this.domain(t),typeof e=="function"?this.interpolator(e):this.range(e);break}}return this}const vS=Symbol("implicit");function nE(){var t=new dP,e=[],r=[],n=vS;function i(a){let c=t.get(a);if(c===void 0){if(n!==vS)return n;t.set(a,c=e.push(a)-1)}return r[c%r.length]}return i.domain=function(a){if(!arguments.length)return e.slice();e=[],t=new dP;for(const c of a)t.has(c)||t.set(c,e.push(c)-1);return i},i.range=function(a){return arguments.length?(r=Array.from(a),i):r.slice()},i.unknown=function(a){return arguments.length?(n=a,i):n},i.copy=function(){return nE(e,r).unknown(n)},_c.apply(i,arguments),i}function iE(){var t=nE().unknown(void 0),e=t.domain,r=t.range,n=0,i=1,a,c,s=!1,g=0,_=0,v=.5;delete t.unknown;function T(){var M=e().length,O=i<n,F=O?i:n,j=O?n:i;a=(j-F)/Math.max(1,M-g+_*2),s&&(a=Math.floor(a)),F+=(j-F-a*(M-g))*v,c=a*(1-g),s&&(F=Math.round(F),c=Math.round(c));var V=ZU(M).map(function(q){return F+a*q});return r(O?V.reverse():V)}return t.domain=function(M){return arguments.length?(e(M),T()):e()},t.range=function(M){return arguments.length?([n,i]=M,n=+n,i=+i,T()):[n,i]},t.rangeRound=function(M){return[n,i]=M,n=+n,i=+i,s=!0,T()},t.bandwidth=function(){return c},t.step=function(){return a},t.round=function(M){return arguments.length?(s=!!M,T()):s},t.padding=function(M){return arguments.length?(g=Math.min(1,_=+M),T()):g},t.paddingInner=function(M){return arguments.length?(g=Math.min(1,M),T()):g},t.paddingOuter=function(M){return arguments.length?(_=+M,T()):_},t.align=function(M){return arguments.length?(v=Math.max(0,Math.min(1,M)),T()):v},t.copy=function(){return iE(e(),[n,i]).round(s).paddingInner(g).paddingOuter(_).align(v)},_c.apply(T(),arguments)}function l4(t){var e=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,delete t.paddingOuter,t.copy=function(){return l4(e())},t}function YU(){return l4(iE.apply(null,arguments).paddingInner(1))}function sE(t,e,r){t.prototype=e.prototype=r,r.constructor=t}function c4(t,e){var r=Object.create(t.prototype);for(var n in e)r[n]=e[n];return r}function n0(){}var Nv=.7,Tx=1/Nv,oy="\\s*([+-]?\\d+)\\s*",zv="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",sh="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",KU=/^#([0-9a-f]{3,8})$/,QU=new RegExp(`^rgb\\(${oy},${oy},${oy}\\)$`),JU=new RegExp(`^rgb\\(${sh},${sh},${sh}\\)$`),ej=new RegExp(`^rgba\\(${oy},${oy},${oy},${zv}\\)$`),tj=new RegExp(`^rgba\\(${sh},${sh},${sh},${zv}\\)$`),rj=new RegExp(`^hsl\\(${zv},${sh},${sh}\\)$`),nj=new RegExp(`^hsla\\(${zv},${sh},${sh},${zv}\\)$`),yP={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};sE(n0,Fv,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:_P,formatHex:_P,formatHex8:ij,formatHsl:sj,formatRgb:vP,toString:vP});function _P(){return this.rgb().formatHex()}function ij(){return this.rgb().formatHex8()}function sj(){return u4(this).formatHsl()}function vP(){return this.rgb().formatRgb()}function Fv(t){var e,r;return t=(t+"").trim().toLowerCase(),(e=KU.exec(t))?(r=e[1].length,e=parseInt(e[1],16),r===6?bP(e):r===3?new Io(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):r===8?Tb(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):r===4?Tb(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=QU.exec(t))?new Io(e[1],e[2],e[3],1):(e=JU.exec(t))?new Io(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=ej.exec(t))?Tb(e[1],e[2],e[3],e[4]):(e=tj.exec(t))?Tb(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=rj.exec(t))?TP(e[1],e[2]/100,e[3]/100,1):(e=nj.exec(t))?TP(e[1],e[2]/100,e[3]/100,e[4]):yP.hasOwnProperty(t)?bP(yP[t]):t==="transparent"?new Io(NaN,NaN,NaN,0):null}function bP(t){return new Io(t>>16&255,t>>8&255,t&255,1)}function Tb(t,e,r,n){return n<=0&&(t=e=r=NaN),new Io(t,e,r,n)}function aj(t){return t instanceof n0||(t=Fv(t)),t?(t=t.rgb(),new Io(t.r,t.g,t.b,t.opacity)):new Io}function bS(t,e,r,n){return arguments.length===1?aj(t):new Io(t,e,r,n??1)}function Io(t,e,r,n){this.r=+t,this.g=+e,this.b=+r,this.opacity=+n}sE(Io,bS,c4(n0,{brighter(t){return t=t==null?Tx:Math.pow(Tx,t),new Io(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Nv:Math.pow(Nv,t),new Io(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Io(dg(this.r),dg(this.g),dg(this.b),Sx(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:xP,formatHex:xP,formatHex8:oj,formatRgb:wP,toString:wP}));function xP(){return`#${ag(this.r)}${ag(this.g)}${ag(this.b)}`}function oj(){return`#${ag(this.r)}${ag(this.g)}${ag(this.b)}${ag((isNaN(this.opacity)?1:this.opacity)*255)}`}function wP(){const t=Sx(this.opacity);return`${t===1?"rgb(":"rgba("}${dg(this.r)}, ${dg(this.g)}, ${dg(this.b)}${t===1?")":`, ${t})`}`}function Sx(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function dg(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function ag(t){return t=dg(t),(t<16?"0":"")+t.toString(16)}function TP(t,e,r,n){return n<=0?t=e=r=NaN:r<=0||r>=1?t=e=NaN:e<=0&&(t=NaN),new nu(t,e,r,n)}function u4(t){if(t instanceof nu)return new nu(t.h,t.s,t.l,t.opacity);if(t instanceof n0||(t=Fv(t)),!t)return new nu;if(t instanceof nu)return t;t=t.rgb();var e=t.r/255,r=t.g/255,n=t.b/255,i=Math.min(e,r,n),a=Math.max(e,r,n),c=NaN,s=a-i,g=(a+i)/2;return s?(e===a?c=(r-n)/s+(r<n)*6:r===a?c=(n-e)/s+2:c=(e-r)/s+4,s/=g<.5?a+i:2-a-i,c*=60):s=g>0&&g<1?0:c,new nu(c,s,g,t.opacity)}function lj(t,e,r,n){return arguments.length===1?u4(t):new nu(t,e,r,n??1)}function nu(t,e,r,n){this.h=+t,this.s=+e,this.l=+r,this.opacity=+n}sE(nu,lj,c4(n0,{brighter(t){return t=t==null?Tx:Math.pow(Tx,t),new nu(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Nv:Math.pow(Nv,t),new nu(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*e,i=2*r-n;return new Io(Zw(t>=240?t-240:t+120,i,n),Zw(t,i,n),Zw(t<120?t+240:t-120,i,n),this.opacity)},clamp(){return new nu(SP(this.h),Sb(this.s),Sb(this.l),Sx(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Sx(this.opacity);return`${t===1?"hsl(":"hsla("}${SP(this.h)}, ${Sb(this.s)*100}%, ${Sb(this.l)*100}%${t===1?")":`, ${t})`}`}}));function SP(t){return t=(t||0)%360,t<0?t+360:t}function Sb(t){return Math.max(0,Math.min(1,t||0))}function Zw(t,e,r){return(t<60?e+(r-e)*t/60:t<180?r:t<240?e+(r-e)*(240-t)/60:e)*255}const aE=t=>()=>t;function cj(t,e){return function(r){return t+r*e}}function uj(t,e,r){return t=Math.pow(t,r),e=Math.pow(e,r)-t,r=1/r,function(n){return Math.pow(t+n*e,r)}}function hj(t){return(t=+t)==1?h4:function(e,r){return r-e?uj(e,r,t):aE(isNaN(e)?r:e)}}function h4(t,e){var r=e-t;return r?cj(t,r):aE(isNaN(t)?e:t)}const AP=(function t(e){var r=hj(e);function n(i,a){var c=r((i=bS(i)).r,(a=bS(a)).r),s=r(i.g,a.g),g=r(i.b,a.b),_=h4(i.opacity,a.opacity);return function(v){return i.r=c(v),i.g=s(v),i.b=g(v),i.opacity=_(v),i+""}}return n.gamma=t,n})(1);function fj(t,e){e||(e=[]);var r=t?Math.min(e.length,t.length):0,n=e.slice(),i;return function(a){for(i=0;i<r;++i)n[i]=t[i]*(1-a)+e[i]*a;return n}}function dj(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function pj(t,e){var r=e?e.length:0,n=t?Math.min(r,t.length):0,i=new Array(n),a=new Array(r),c;for(c=0;c<n;++c)i[c]=By(t[c],e[c]);for(;c<r;++c)a[c]=e[c];return function(s){for(c=0;c<n;++c)a[c]=i[c](s);return a}}function gj(t,e){var r=new Date;return t=+t,e=+e,function(n){return r.setTime(t*(1-n)+e*n),r}}function Ax(t,e){return t=+t,e=+e,function(r){return t*(1-r)+e*r}}function mj(t,e){var r={},n={},i;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in t?r[i]=By(t[i],e[i]):n[i]=e[i];return function(a){for(i in r)n[i]=r[i](a);return n}}var xS=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Yw=new RegExp(xS.source,"g");function yj(t){return function(){return t}}function _j(t){return function(e){return t(e)+""}}function vj(t,e){var r=xS.lastIndex=Yw.lastIndex=0,n,i,a,c=-1,s=[],g=[];for(t=t+"",e=e+"";(n=xS.exec(t))&&(i=Yw.exec(e));)(a=i.index)>r&&(a=e.slice(r,a),s[c]?s[c]+=a:s[++c]=a),(n=n[0])===(i=i[0])?s[c]?s[c]+=i:s[++c]=i:(s[++c]=null,g.push({i:c,x:Ax(n,i)})),r=Yw.lastIndex;return r<e.length&&(a=e.slice(r),s[c]?s[c]+=a:s[++c]=a),s.length<2?g[0]?_j(g[0].x):yj(e):(e=g.length,function(_){for(var v=0,T;v<e;++v)s[(T=g[v]).i]=T.x(_);return s.join("")})}function By(t,e){var r=typeof e,n;return e==null||r==="boolean"?aE(e):(r==="number"?Ax:r==="string"?(n=Fv(e))?(e=n,AP):vj:e instanceof Fv?AP:e instanceof Date?gj:dj(e)?fj:Array.isArray(e)?pj:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?mj:Ax)(t,e)}function oE(t,e){return t=+t,e=+e,function(r){return Math.round(t*(1-r)+e*r)}}function bj(t,e){e===void 0&&(e=t,t=By);for(var r=0,n=e.length-1,i=e[0],a=new Array(n<0?0:n);r<n;)a[r]=t(i,i=e[++r]);return function(c){var s=Math.max(0,Math.min(n-1,Math.floor(c*=n)));return a[s](c-s)}}function xj(t){return function(){return t}}function Ex(t){return+t}var EP=[0,1];function qa(t){return t}function wS(t,e){return(e-=t=+t)?function(r){return(r-t)/e}:xj(isNaN(e)?NaN:.5)}function wj(t,e){var r;return t>e&&(r=t,t=e,e=r),function(n){return Math.max(t,Math.min(e,n))}}function Tj(t,e,r){var n=t[0],i=t[1],a=e[0],c=e[1];return i<n?(n=wS(i,n),a=r(c,a)):(n=wS(n,i),a=r(a,c)),function(s){return a(n(s))}}function Sj(t,e,r){var n=Math.min(t.length,e.length)-1,i=new Array(n),a=new Array(n),c=-1;for(t[n]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++c<n;)i[c]=wS(t[c],t[c+1]),a[c]=r(e[c],e[c+1]);return function(s){var g=r0(t,s,1,n)-1;return a[g](i[g](s))}}function i0(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function I1(){var t=EP,e=EP,r=By,n,i,a,c=qa,s,g,_;function v(){var M=Math.min(t.length,e.length);return c!==qa&&(c=wj(t[0],t[M-1])),s=M>2?Sj:Tj,g=_=null,T}function T(M){return M==null||isNaN(M=+M)?a:(g||(g=s(t.map(n),e,r)))(n(c(M)))}return T.invert=function(M){return c(i((_||(_=s(e,t.map(n),Ax)))(M)))},T.domain=function(M){return arguments.length?(t=Array.from(M,Ex),v()):t.slice()},T.range=function(M){return arguments.length?(e=Array.from(M),v()):e.slice()},T.rangeRound=function(M){return e=Array.from(M),r=oE,v()},T.clamp=function(M){return arguments.length?(c=M?!0:qa,v()):c!==qa},T.interpolate=function(M){return arguments.length?(r=M,v()):r},T.unknown=function(M){return arguments.length?(a=M,T):a},function(M,O){return n=M,i=O,v()}}function lE(){return I1()(qa,qa)}function Aj(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function Cx(t,e){if((r=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var r,n=t.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+t.slice(r+1)]}function py(t){return t=Cx(Math.abs(t)),t?t[1]:NaN}function Ej(t,e){return function(r,n){for(var i=r.length,a=[],c=0,s=t[0],g=0;i>0&&s>0&&(g+s+1>n&&(s=Math.max(1,n-g)),a.push(r.substring(i-=s,i+s)),!((g+=s+1)>n));)s=t[c=(c+1)%t.length];return a.reverse().join(e)}}function Cj(t){return function(e){return e.replace(/[0-9]/g,function(r){return t[+r]})}}var Pj=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Uv(t){if(!(e=Pj.exec(t)))throw new Error("invalid format: "+t);var e;return new cE({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Uv.prototype=cE.prototype;function cE(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}cE.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Mj(t){e:for(var e=t.length,r=1,n=-1,i;r<e;++r)switch(t[r]){case".":n=i=r;break;case"0":n===0&&(n=r),i=r;break;default:if(!+t[r])break e;n>0&&(n=0);break}return n>0?t.slice(0,n)+t.slice(i+1):t}var f4;function Ij(t,e){var r=Cx(t,e);if(!r)return t+"";var n=r[0],i=r[1],a=i-(f4=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,c=n.length;return a===c?n:a>c?n+new Array(a-c+1).join("0"):a>0?n.slice(0,a)+"."+n.slice(a):"0."+new Array(1-a).join("0")+Cx(t,Math.max(0,e+a-1))[0]}function CP(t,e){var r=Cx(t,e);if(!r)return t+"";var n=r[0],i=r[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")}const PP={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:Aj,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>CP(t*100,e),r:CP,s:Ij,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function MP(t){return t}var IP=Array.prototype.map,RP=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function Rj(t){var e=t.grouping===void 0||t.thousands===void 0?MP:Ej(IP.call(t.grouping,Number),t.thousands+""),r=t.currency===void 0?"":t.currency[0]+"",n=t.currency===void 0?"":t.currency[1]+"",i=t.decimal===void 0?".":t.decimal+"",a=t.numerals===void 0?MP:Cj(IP.call(t.numerals,String)),c=t.percent===void 0?"%":t.percent+"",s=t.minus===void 0?"":t.minus+"",g=t.nan===void 0?"NaN":t.nan+"";function _(T){T=Uv(T);var M=T.fill,O=T.align,F=T.sign,j=T.symbol,V=T.zero,q=T.width,Y=T.comma,X=T.precision,ae=T.trim,ue=T.type;ue==="n"?(Y=!0,ue="g"):PP[ue]||(X===void 0&&(X=12),ae=!0,ue="g"),(V||M==="0"&&O==="=")&&(V=!0,M="0",O="=");var ge=j==="$"?r:j==="#"&&/[boxX]/.test(ue)?"0"+ue.toLowerCase():"",Le=j==="$"?n:/[%p]/.test(ue)?c:"",qe=PP[ue],Ze=/[defgprs%]/.test(ue);X=X===void 0?6:/[gprs]/.test(ue)?Math.max(1,Math.min(21,X)):Math.max(0,Math.min(20,X));function _t(it){var gt=ge,Lt=Le,Ot,Yt,ce;if(ue==="c")Lt=qe(it)+Lt,it="";else{it=+it;var we=it<0||1/it<0;if(it=isNaN(it)?g:qe(Math.abs(it),X),ae&&(it=Mj(it)),we&&+it==0&&F!=="+"&&(we=!1),gt=(we?F==="("?F:s:F==="-"||F==="("?"":F)+gt,Lt=(ue==="s"?RP[8+f4/3]:"")+Lt+(we&&F==="("?")":""),Ze){for(Ot=-1,Yt=it.length;++Ot<Yt;)if(ce=it.charCodeAt(Ot),48>ce||ce>57){Lt=(ce===46?i+it.slice(Ot+1):it.slice(Ot))+Lt,it=it.slice(0,Ot);break}}}Y&&!V&&(it=e(it,1/0));var Re=gt.length+it.length+Lt.length,Ue=Re<q?new Array(q-Re+1).join(M):"";switch(Y&&V&&(it=e(Ue+it,Ue.length?q-Lt.length:1/0),Ue=""),O){case"<":it=gt+it+Lt+Ue;break;case"=":it=gt+Ue+it+Lt;break;case"^":it=Ue.slice(0,Re=Ue.length>>1)+gt+it+Lt+Ue.slice(Re);break;default:it=Ue+gt+it+Lt;break}return a(it)}return _t.toString=function(){return T+""},_t}function v(T,M){var O=_((T=Uv(T),T.type="f",T)),F=Math.max(-8,Math.min(8,Math.floor(py(M)/3)))*3,j=Math.pow(10,-F),V=RP[8+F/3];return function(q){return O(j*q)+V}}return{format:_,formatPrefix:v}}var Ab,uE,d4;Oj({thousands:",",grouping:[3],currency:["$",""]});function Oj(t){return Ab=Rj(t),uE=Ab.format,d4=Ab.formatPrefix,Ab}function kj(t){return Math.max(0,-py(Math.abs(t)))}function Dj(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(py(e)/3)))*3-py(Math.abs(t)))}function Lj(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,py(e)-py(t))+1}function p4(t,e,r,n){var i=_S(t,e,r),a;switch(n=Uv(n??",f"),n.type){case"s":{var c=Math.max(Math.abs(t),Math.abs(e));return n.precision==null&&!isNaN(a=Dj(i,c))&&(n.precision=a),d4(n,c)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(a=Lj(i,Math.max(Math.abs(t),Math.abs(e))))&&(n.precision=a-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(a=kj(i))&&(n.precision=a-(n.type==="%")*2);break}}return uE(n)}function Vd(t){var e=t.domain;return t.ticks=function(r){var n=e();return mS(n[0],n[n.length-1],r??10)},t.tickFormat=function(r,n){var i=e();return p4(i[0],i[i.length-1],r??10,n)},t.nice=function(r){r==null&&(r=10);var n=e(),i=0,a=n.length-1,c=n[i],s=n[a],g,_,v=10;for(s<c&&(_=c,c=s,s=_,_=i,i=a,a=_);v-- >0;){if(_=yS(c,s,r),_===g)return n[i]=c,n[a]=s,e(n);if(_>0)c=Math.floor(c/_)*_,s=Math.ceil(s/_)*_;else if(_<0)c=Math.ceil(c*_)/_,s=Math.floor(s*_)/_;else break;g=_}return t},t}function R1(){var t=lE();return t.copy=function(){return i0(t,R1())},_c.apply(t,arguments),Vd(t)}function g4(t){var e;function r(n){return n==null||isNaN(n=+n)?e:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(t=Array.from(n,Ex),r):t.slice()},r.unknown=function(n){return arguments.length?(e=n,r):e},r.copy=function(){return g4(t).unknown(e)},t=arguments.length?Array.from(t,Ex):[0,1],Vd(r)}function m4(t,e){t=t.slice();var r=0,n=t.length-1,i=t[r],a=t[n],c;return a<i&&(c=r,r=n,n=c,c=i,i=a,a=c),t[r]=e.floor(i),t[n]=e.ceil(a),t}function OP(t){return Math.log(t)}function kP(t){return Math.exp(t)}function Bj(t){return-Math.log(-t)}function Nj(t){return-Math.exp(-t)}function zj(t){return isFinite(t)?+("1e"+t):t<0?0:t}function Fj(t){return t===10?zj:t===Math.E?Math.exp:e=>Math.pow(t,e)}function Uj(t){return t===Math.E?Math.log:t===10&&Math.log10||t===2&&Math.log2||(t=Math.log(t),e=>Math.log(e)/t)}function DP(t){return(e,r)=>-t(-e,r)}function hE(t){const e=t(OP,kP),r=e.domain;let n=10,i,a;function c(){return i=Uj(n),a=Fj(n),r()[0]<0?(i=DP(i),a=DP(a),t(Bj,Nj)):t(OP,kP),e}return e.base=function(s){return arguments.length?(n=+s,c()):n},e.domain=function(s){return arguments.length?(r(s),c()):r()},e.ticks=s=>{const g=r();let _=g[0],v=g[g.length-1];const T=v<_;T&&([_,v]=[v,_]);let M=i(_),O=i(v),F,j;const V=s==null?10:+s;let q=[];if(!(n%1)&&O-M<V){if(M=Math.floor(M),O=Math.ceil(O),_>0){for(;M<=O;++M)for(F=1;F<n;++F)if(j=M<0?F/a(-M):F*a(M),!(j<_)){if(j>v)break;q.push(j)}}else for(;M<=O;++M)for(F=n-1;F>=1;--F)if(j=M>0?F/a(-M):F*a(M),!(j<_)){if(j>v)break;q.push(j)}q.length*2<V&&(q=mS(_,v,V))}else q=mS(M,O,Math.min(O-M,V)).map(a);return T?q.reverse():q},e.tickFormat=(s,g)=>{if(s==null&&(s=10),g==null&&(g=n===10?"s":","),typeof g!="function"&&(!(n%1)&&(g=Uv(g)).precision==null&&(g.trim=!0),g=uE(g)),s===1/0)return g;const _=Math.max(1,n*s/e.ticks().length);return v=>{let T=v/a(Math.round(i(v)));return T*n<n-.5&&(T*=n),T<=_?g(v):""}},e.nice=()=>r(m4(r(),{floor:s=>a(Math.floor(i(s))),ceil:s=>a(Math.ceil(i(s)))})),e}function y4(){const t=hE(I1()).domain([1,10]);return t.copy=()=>i0(t,y4()).base(t.base()),_c.apply(t,arguments),t}function LP(t){return function(e){return Math.sign(e)*Math.log1p(Math.abs(e/t))}}function BP(t){return function(e){return Math.sign(e)*Math.expm1(Math.abs(e))*t}}function fE(t){var e=1,r=t(LP(e),BP(e));return r.constant=function(n){return arguments.length?t(LP(e=+n),BP(e)):e},Vd(r)}function _4(){var t=fE(I1());return t.copy=function(){return i0(t,_4()).constant(t.constant())},_c.apply(t,arguments)}function NP(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function jj(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function Vj(t){return t<0?-t*t:t*t}function dE(t){var e=t(qa,qa),r=1;function n(){return r===1?t(qa,qa):r===.5?t(jj,Vj):t(NP(r),NP(1/r))}return e.exponent=function(i){return arguments.length?(r=+i,n()):r},Vd(e)}function pE(){var t=dE(I1());return t.copy=function(){return i0(t,pE()).exponent(t.exponent())},_c.apply(t,arguments),t}function $j(){return pE.apply(null,arguments).exponent(.5)}function zP(t){return Math.sign(t)*t*t}function Hj(t){return Math.sign(t)*Math.sqrt(Math.abs(t))}function v4(){var t=lE(),e=[0,1],r=!1,n;function i(a){var c=Hj(t(a));return isNaN(c)?n:r?Math.round(c):c}return i.invert=function(a){return t.invert(zP(a))},i.domain=function(a){return arguments.length?(t.domain(a),i):t.domain()},i.range=function(a){return arguments.length?(t.range((e=Array.from(a,Ex)).map(zP)),i):e.slice()},i.rangeRound=function(a){return i.range(a).round(!0)},i.round=function(a){return arguments.length?(r=!!a,i):r},i.clamp=function(a){return arguments.length?(t.clamp(a),i):t.clamp()},i.unknown=function(a){return arguments.length?(n=a,i):n},i.copy=function(){return v4(t.domain(),e).round(r).clamp(t.clamp()).unknown(n)},_c.apply(i,arguments),Vd(i)}function b4(){var t=[],e=[],r=[],n;function i(){var c=0,s=Math.max(1,e.length);for(r=new Array(s-1);++c<s;)r[c-1]=XU(t,c/s);return a}function a(c){return c==null||isNaN(c=+c)?n:e[r0(r,c)]}return a.invertExtent=function(c){var s=e.indexOf(c);return s<0?[NaN,NaN]:[s>0?r[s-1]:t[0],s<r.length?r[s]:t[t.length-1]]},a.domain=function(c){if(!arguments.length)return t.slice();t=[];for(let s of c)s!=null&&!isNaN(s=+s)&&t.push(s);return t.sort(Ld),i()},a.range=function(c){return arguments.length?(e=Array.from(c),i()):e.slice()},a.unknown=function(c){return arguments.length?(n=c,a):n},a.quantiles=function(){return r.slice()},a.copy=function(){return b4().domain(t).range(e).unknown(n)},_c.apply(a,arguments)}function x4(){var t=0,e=1,r=1,n=[.5],i=[0,1],a;function c(g){return g!=null&&g<=g?i[r0(n,g,0,r)]:a}function s(){var g=-1;for(n=new Array(r);++g<r;)n[g]=((g+1)*e-(g-r)*t)/(r+1);return c}return c.domain=function(g){return arguments.length?([t,e]=g,t=+t,e=+e,s()):[t,e]},c.range=function(g){return arguments.length?(r=(i=Array.from(g)).length-1,s()):i.slice()},c.invertExtent=function(g){var _=i.indexOf(g);return _<0?[NaN,NaN]:_<1?[t,n[0]]:_>=r?[n[r-1],e]:[n[_-1],n[_]]},c.unknown=function(g){return arguments.length&&(a=g),c},c.thresholds=function(){return n.slice()},c.copy=function(){return x4().domain([t,e]).range(i).unknown(a)},_c.apply(Vd(c),arguments)}function gE(){var t=[.5],e=[0,1],r,n=1;function i(a){return a!=null&&a<=a?e[r0(t,a,0,n)]:r}return i.domain=function(a){return arguments.length?(t=Array.from(a),n=Math.min(t.length,e.length-1),i):t.slice()},i.range=function(a){return arguments.length?(e=Array.from(a),n=Math.min(t.length,e.length-1),i):e.slice()},i.invertExtent=function(a){var c=e.indexOf(a);return[t[c-1],t[c]]},i.unknown=function(a){return arguments.length?(r=a,i):r},i.copy=function(){return gE().domain(t).range(e).unknown(r)},_c.apply(i,arguments)}const Kw=new Date,Qw=new Date;function Is(t,e,r,n){function i(a){return t(a=arguments.length===0?new Date:new Date(+a)),a}return i.floor=a=>(t(a=new Date(+a)),a),i.ceil=a=>(t(a=new Date(a-1)),e(a,1),t(a),a),i.round=a=>{const c=i(a),s=i.ceil(a);return a-c<s-a?c:s},i.offset=(a,c)=>(e(a=new Date(+a),c==null?1:Math.floor(c)),a),i.range=(a,c,s)=>{const g=[];if(a=i.ceil(a),s=s==null?1:Math.floor(s),!(a<c)||!(s>0))return g;let _;do g.push(_=new Date(+a)),e(a,s),t(a);while(_<a&&a<c);return g},i.filter=a=>Is(c=>{if(c>=c)for(;t(c),!a(c);)c.setTime(c-1)},(c,s)=>{if(c>=c)if(s<0)for(;++s<=0;)for(;e(c,-1),!a(c););else for(;--s>=0;)for(;e(c,1),!a(c););}),r&&(i.count=(a,c)=>(Kw.setTime(+a),Qw.setTime(+c),t(Kw),t(Qw),Math.floor(r(Kw,Qw))),i.every=a=>(a=Math.floor(a),!isFinite(a)||!(a>0)?null:a>1?i.filter(n?c=>n(c)%a===0:c=>i.count(0,c)%a===0):i)),i}const Px=Is(()=>{},(t,e)=>{t.setTime(+t+e)},(t,e)=>e-t);Px.every=t=>(t=Math.floor(t),!isFinite(t)||!(t>0)?null:t>1?Is(e=>{e.setTime(Math.floor(e/t)*t)},(e,r)=>{e.setTime(+e+r*t)},(e,r)=>(r-e)/t):Px);Px.range;const uf=1e3,oc=uf*60,hf=oc*60,gf=hf*24,mE=gf*7,FP=gf*30,Jw=gf*365,og=Is(t=>{t.setTime(t-t.getMilliseconds())},(t,e)=>{t.setTime(+t+e*uf)},(t,e)=>(e-t)/uf,t=>t.getUTCSeconds());og.range;const yE=Is(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*uf)},(t,e)=>{t.setTime(+t+e*oc)},(t,e)=>(e-t)/oc,t=>t.getMinutes());yE.range;const _E=Is(t=>{t.setUTCSeconds(0,0)},(t,e)=>{t.setTime(+t+e*oc)},(t,e)=>(e-t)/oc,t=>t.getUTCMinutes());_E.range;const vE=Is(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*uf-t.getMinutes()*oc)},(t,e)=>{t.setTime(+t+e*hf)},(t,e)=>(e-t)/hf,t=>t.getHours());vE.range;const bE=Is(t=>{t.setUTCMinutes(0,0,0)},(t,e)=>{t.setTime(+t+e*hf)},(t,e)=>(e-t)/hf,t=>t.getUTCHours());bE.range;const s0=Is(t=>t.setHours(0,0,0,0),(t,e)=>t.setDate(t.getDate()+e),(t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*oc)/gf,t=>t.getDate()-1);s0.range;const O1=Is(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/gf,t=>t.getUTCDate()-1);O1.range;const w4=Is(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/gf,t=>Math.floor(t/gf));w4.range;function kg(t){return Is(e=>{e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},(e,r)=>{e.setDate(e.getDate()+r*7)},(e,r)=>(r-e-(r.getTimezoneOffset()-e.getTimezoneOffset())*oc)/mE)}const k1=kg(0),Mx=kg(1),Wj=kg(2),qj=kg(3),gy=kg(4),Gj=kg(5),Xj=kg(6);k1.range;Mx.range;Wj.range;qj.range;gy.range;Gj.range;Xj.range;function Dg(t){return Is(e=>{e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},(e,r)=>{e.setUTCDate(e.getUTCDate()+r*7)},(e,r)=>(r-e)/mE)}const D1=Dg(0),Ix=Dg(1),Zj=Dg(2),Yj=Dg(3),my=Dg(4),Kj=Dg(5),Qj=Dg(6);D1.range;Ix.range;Zj.range;Yj.range;my.range;Kj.range;Qj.range;const xE=Is(t=>{t.setDate(1),t.setHours(0,0,0,0)},(t,e)=>{t.setMonth(t.getMonth()+e)},(t,e)=>e.getMonth()-t.getMonth()+(e.getFullYear()-t.getFullYear())*12,t=>t.getMonth());xE.range;const wE=Is(t=>{t.setUTCDate(1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCMonth(t.getUTCMonth()+e)},(t,e)=>e.getUTCMonth()-t.getUTCMonth()+(e.getUTCFullYear()-t.getUTCFullYear())*12,t=>t.getUTCMonth());wE.range;const mf=Is(t=>{t.setMonth(0,1),t.setHours(0,0,0,0)},(t,e)=>{t.setFullYear(t.getFullYear()+e)},(t,e)=>e.getFullYear()-t.getFullYear(),t=>t.getFullYear());mf.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:Is(e=>{e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)},(e,r)=>{e.setFullYear(e.getFullYear()+r*t)});mf.range;const yf=Is(t=>{t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCFullYear(t.getUTCFullYear()+e)},(t,e)=>e.getUTCFullYear()-t.getUTCFullYear(),t=>t.getUTCFullYear());yf.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:Is(e=>{e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,r)=>{e.setUTCFullYear(e.getUTCFullYear()+r*t)});yf.range;function T4(t,e,r,n,i,a){const c=[[og,1,uf],[og,5,5*uf],[og,15,15*uf],[og,30,30*uf],[a,1,oc],[a,5,5*oc],[a,15,15*oc],[a,30,30*oc],[i,1,hf],[i,3,3*hf],[i,6,6*hf],[i,12,12*hf],[n,1,gf],[n,2,2*gf],[r,1,mE],[e,1,FP],[e,3,3*FP],[t,1,Jw]];function s(_,v,T){const M=v<_;M&&([_,v]=[v,_]);const O=T&&typeof T.range=="function"?T:g(_,v,T),F=O?O.range(_,+v+1):[];return M?F.reverse():F}function g(_,v,T){const M=Math.abs(v-_)/T,O=rE(([,,V])=>V).right(c,M);if(O===c.length)return t.every(_S(_/Jw,v/Jw,T));if(O===0)return Px.every(Math.max(_S(_,v,T),1));const[F,j]=c[M/c[O-1][2]<c[O][2]/M?O-1:O];return F.every(j)}return[s,g]}const[Jj,e7]=T4(yf,wE,D1,w4,bE,_E),[t7,r7]=T4(mf,xE,k1,s0,vE,yE);function e2(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function t2(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function tv(t,e,r){return{y:t,m:e,d:r,H:0,M:0,S:0,L:0}}function n7(t){var e=t.dateTime,r=t.date,n=t.time,i=t.periods,a=t.days,c=t.shortDays,s=t.months,g=t.shortMonths,_=rv(i),v=nv(i),T=rv(a),M=nv(a),O=rv(c),F=nv(c),j=rv(s),V=nv(s),q=rv(g),Y=nv(g),X={a:we,A:Re,b:Ue,B:at,c:null,d:WP,e:WP,f:E7,g:B7,G:z7,H:T7,I:S7,j:A7,L:S4,m:C7,M:P7,p:pe,q:Pe,Q:XP,s:ZP,S:M7,u:I7,U:R7,V:O7,w:k7,W:D7,x:null,X:null,y:L7,Y:N7,Z:F7,"%":GP},ae={a:rt,A:vt,b:At,B:$t,c:null,d:qP,e:qP,f:$7,g:J7,G:t9,H:U7,I:j7,j:V7,L:E4,m:H7,M:W7,p:Gt,q:nr,Q:XP,s:ZP,S:q7,u:G7,U:X7,V:Z7,w:Y7,W:K7,x:null,X:null,y:Q7,Y:e9,Z:r9,"%":GP},ue={a:_t,A:it,b:gt,B:Lt,c:Ot,d:$P,e:$P,f:v7,g:VP,G:jP,H:HP,I:HP,j:g7,L:_7,m:p7,M:m7,p:Ze,q:d7,Q:x7,s:w7,S:y7,u:l7,U:c7,V:u7,w:o7,W:h7,x:Yt,X:ce,y:VP,Y:jP,Z:f7,"%":b7};X.x=ge(r,X),X.X=ge(n,X),X.c=ge(e,X),ae.x=ge(r,ae),ae.X=ge(n,ae),ae.c=ge(e,ae);function ge(Et,Wt){return function(mr){var Mt=[],Cr=-1,cr=0,or=Et.length,ur,gs,Os;for(mr instanceof Date||(mr=new Date(+mr));++Cr<or;)Et.charCodeAt(Cr)===37&&(Mt.push(Et.slice(cr,Cr)),(gs=UP[ur=Et.charAt(++Cr)])!=null?ur=Et.charAt(++Cr):gs=ur==="e"?" ":"0",(Os=Wt[ur])&&(ur=Os(mr,gs)),Mt.push(ur),cr=Cr+1);return Mt.push(Et.slice(cr,Cr)),Mt.join("")}}function Le(Et,Wt){return function(mr){var Mt=tv(1900,void 0,1),Cr=qe(Mt,Et,mr+="",0),cr,or;if(Cr!=mr.length)return null;if("Q"in Mt)return new Date(Mt.Q);if("s"in Mt)return new Date(Mt.s*1e3+("L"in Mt?Mt.L:0));if(Wt&&!("Z"in Mt)&&(Mt.Z=0),"p"in Mt&&(Mt.H=Mt.H%12+Mt.p*12),Mt.m===void 0&&(Mt.m="q"in Mt?Mt.q:0),"V"in Mt){if(Mt.V<1||Mt.V>53)return null;"w"in Mt||(Mt.w=1),"Z"in Mt?(cr=t2(tv(Mt.y,0,1)),or=cr.getUTCDay(),cr=or>4||or===0?Ix.ceil(cr):Ix(cr),cr=O1.offset(cr,(Mt.V-1)*7),Mt.y=cr.getUTCFullYear(),Mt.m=cr.getUTCMonth(),Mt.d=cr.getUTCDate()+(Mt.w+6)%7):(cr=e2(tv(Mt.y,0,1)),or=cr.getDay(),cr=or>4||or===0?Mx.ceil(cr):Mx(cr),cr=s0.offset(cr,(Mt.V-1)*7),Mt.y=cr.getFullYear(),Mt.m=cr.getMonth(),Mt.d=cr.getDate()+(Mt.w+6)%7)}else("W"in Mt||"U"in Mt)&&("w"in Mt||(Mt.w="u"in Mt?Mt.u%7:"W"in Mt?1:0),or="Z"in Mt?t2(tv(Mt.y,0,1)).getUTCDay():e2(tv(Mt.y,0,1)).getDay(),Mt.m=0,Mt.d="W"in Mt?(Mt.w+6)%7+Mt.W*7-(or+5)%7:Mt.w+Mt.U*7-(or+6)%7);return"Z"in Mt?(Mt.H+=Mt.Z/100|0,Mt.M+=Mt.Z%100,t2(Mt)):e2(Mt)}}function qe(Et,Wt,mr,Mt){for(var Cr=0,cr=Wt.length,or=mr.length,ur,gs;Cr<cr;){if(Mt>=or)return-1;if(ur=Wt.charCodeAt(Cr++),ur===37){if(ur=Wt.charAt(Cr++),gs=ue[ur in UP?Wt.charAt(Cr++):ur],!gs||(Mt=gs(Et,mr,Mt))<0)return-1}else if(ur!=mr.charCodeAt(Mt++))return-1}return Mt}function Ze(Et,Wt,mr){var Mt=_.exec(Wt.slice(mr));return Mt?(Et.p=v.get(Mt[0].toLowerCase()),mr+Mt[0].length):-1}function _t(Et,Wt,mr){var Mt=O.exec(Wt.slice(mr));return Mt?(Et.w=F.get(Mt[0].toLowerCase()),mr+Mt[0].length):-1}function it(Et,Wt,mr){var Mt=T.exec(Wt.slice(mr));return Mt?(Et.w=M.get(Mt[0].toLowerCase()),mr+Mt[0].length):-1}function gt(Et,Wt,mr){var Mt=q.exec(Wt.slice(mr));return Mt?(Et.m=Y.get(Mt[0].toLowerCase()),mr+Mt[0].length):-1}function Lt(Et,Wt,mr){var Mt=j.exec(Wt.slice(mr));return Mt?(Et.m=V.get(Mt[0].toLowerCase()),mr+Mt[0].length):-1}function Ot(Et,Wt,mr){return qe(Et,e,Wt,mr)}function Yt(Et,Wt,mr){return qe(Et,r,Wt,mr)}function ce(Et,Wt,mr){return qe(Et,n,Wt,mr)}function we(Et){return c[Et.getDay()]}function Re(Et){return a[Et.getDay()]}function Ue(Et){return g[Et.getMonth()]}function at(Et){return s[Et.getMonth()]}function pe(Et){return i[+(Et.getHours()>=12)]}function Pe(Et){return 1+~~(Et.getMonth()/3)}function rt(Et){return c[Et.getUTCDay()]}function vt(Et){return a[Et.getUTCDay()]}function At(Et){return g[Et.getUTCMonth()]}function $t(Et){return s[Et.getUTCMonth()]}function Gt(Et){return i[+(Et.getUTCHours()>=12)]}function nr(Et){return 1+~~(Et.getUTCMonth()/3)}return{format:function(Et){var Wt=ge(Et+="",X);return Wt.toString=function(){return Et},Wt},parse:function(Et){var Wt=Le(Et+="",!1);return Wt.toString=function(){return Et},Wt},utcFormat:function(Et){var Wt=ge(Et+="",ae);return Wt.toString=function(){return Et},Wt},utcParse:function(Et){var Wt=Le(Et+="",!0);return Wt.toString=function(){return Et},Wt}}}var UP={"-":"",_:" ",0:"0"},Qs=/^\s*\d+/,i7=/^%/,s7=/[\\^$*+?|[\]().{}]/g;function gn(t,e,r){var n=t<0?"-":"",i=(n?-t:t)+"",a=i.length;return n+(a<r?new Array(r-a+1).join(e)+i:i)}function a7(t){return t.replace(s7,"\\$&")}function rv(t){return new RegExp("^(?:"+t.map(a7).join("|")+")","i")}function nv(t){return new Map(t.map((e,r)=>[e.toLowerCase(),r]))}function o7(t,e,r){var n=Qs.exec(e.slice(r,r+1));return n?(t.w=+n[0],r+n[0].length):-1}function l7(t,e,r){var n=Qs.exec(e.slice(r,r+1));return n?(t.u=+n[0],r+n[0].length):-1}function c7(t,e,r){var n=Qs.exec(e.slice(r,r+2));return n?(t.U=+n[0],r+n[0].length):-1}function u7(t,e,r){var n=Qs.exec(e.slice(r,r+2));return n?(t.V=+n[0],r+n[0].length):-1}function h7(t,e,r){var n=Qs.exec(e.slice(r,r+2));return n?(t.W=+n[0],r+n[0].length):-1}function jP(t,e,r){var n=Qs.exec(e.slice(r,r+4));return n?(t.y=+n[0],r+n[0].length):-1}function VP(t,e,r){var n=Qs.exec(e.slice(r,r+2));return n?(t.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function f7(t,e,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(r,r+6));return n?(t.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function d7(t,e,r){var n=Qs.exec(e.slice(r,r+1));return n?(t.q=n[0]*3-3,r+n[0].length):-1}function p7(t,e,r){var n=Qs.exec(e.slice(r,r+2));return n?(t.m=n[0]-1,r+n[0].length):-1}function $P(t,e,r){var n=Qs.exec(e.slice(r,r+2));return n?(t.d=+n[0],r+n[0].length):-1}function g7(t,e,r){var n=Qs.exec(e.slice(r,r+3));return n?(t.m=0,t.d=+n[0],r+n[0].length):-1}function HP(t,e,r){var n=Qs.exec(e.slice(r,r+2));return n?(t.H=+n[0],r+n[0].length):-1}function m7(t,e,r){var n=Qs.exec(e.slice(r,r+2));return n?(t.M=+n[0],r+n[0].length):-1}function y7(t,e,r){var n=Qs.exec(e.slice(r,r+2));return n?(t.S=+n[0],r+n[0].length):-1}function _7(t,e,r){var n=Qs.exec(e.slice(r,r+3));return n?(t.L=+n[0],r+n[0].length):-1}function v7(t,e,r){var n=Qs.exec(e.slice(r,r+6));return n?(t.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function b7(t,e,r){var n=i7.exec(e.slice(r,r+1));return n?r+n[0].length:-1}function x7(t,e,r){var n=Qs.exec(e.slice(r));return n?(t.Q=+n[0],r+n[0].length):-1}function w7(t,e,r){var n=Qs.exec(e.slice(r));return n?(t.s=+n[0],r+n[0].length):-1}function WP(t,e){return gn(t.getDate(),e,2)}function T7(t,e){return gn(t.getHours(),e,2)}function S7(t,e){return gn(t.getHours()%12||12,e,2)}function A7(t,e){return gn(1+s0.count(mf(t),t),e,3)}function S4(t,e){return gn(t.getMilliseconds(),e,3)}function E7(t,e){return S4(t,e)+"000"}function C7(t,e){return gn(t.getMonth()+1,e,2)}function P7(t,e){return gn(t.getMinutes(),e,2)}function M7(t,e){return gn(t.getSeconds(),e,2)}function I7(t){var e=t.getDay();return e===0?7:e}function R7(t,e){return gn(k1.count(mf(t)-1,t),e,2)}function A4(t){var e=t.getDay();return e>=4||e===0?gy(t):gy.ceil(t)}function O7(t,e){return t=A4(t),gn(gy.count(mf(t),t)+(mf(t).getDay()===4),e,2)}function k7(t){return t.getDay()}function D7(t,e){return gn(Mx.count(mf(t)-1,t),e,2)}function L7(t,e){return gn(t.getFullYear()%100,e,2)}function B7(t,e){return t=A4(t),gn(t.getFullYear()%100,e,2)}function N7(t,e){return gn(t.getFullYear()%1e4,e,4)}function z7(t,e){var r=t.getDay();return t=r>=4||r===0?gy(t):gy.ceil(t),gn(t.getFullYear()%1e4,e,4)}function F7(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+gn(e/60|0,"0",2)+gn(e%60,"0",2)}function qP(t,e){return gn(t.getUTCDate(),e,2)}function U7(t,e){return gn(t.getUTCHours(),e,2)}function j7(t,e){return gn(t.getUTCHours()%12||12,e,2)}function V7(t,e){return gn(1+O1.count(yf(t),t),e,3)}function E4(t,e){return gn(t.getUTCMilliseconds(),e,3)}function $7(t,e){return E4(t,e)+"000"}function H7(t,e){return gn(t.getUTCMonth()+1,e,2)}function W7(t,e){return gn(t.getUTCMinutes(),e,2)}function q7(t,e){return gn(t.getUTCSeconds(),e,2)}function G7(t){var e=t.getUTCDay();return e===0?7:e}function X7(t,e){return gn(D1.count(yf(t)-1,t),e,2)}function C4(t){var e=t.getUTCDay();return e>=4||e===0?my(t):my.ceil(t)}function Z7(t,e){return t=C4(t),gn(my.count(yf(t),t)+(yf(t).getUTCDay()===4),e,2)}function Y7(t){return t.getUTCDay()}function K7(t,e){return gn(Ix.count(yf(t)-1,t),e,2)}function Q7(t,e){return gn(t.getUTCFullYear()%100,e,2)}function J7(t,e){return t=C4(t),gn(t.getUTCFullYear()%100,e,2)}function e9(t,e){return gn(t.getUTCFullYear()%1e4,e,4)}function t9(t,e){var r=t.getUTCDay();return t=r>=4||r===0?my(t):my.ceil(t),gn(t.getUTCFullYear()%1e4,e,4)}function r9(){return"+0000"}function GP(){return"%"}function XP(t){return+t}function ZP(t){return Math.floor(+t/1e3)}var Hm,P4,M4;n9({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function n9(t){return Hm=n7(t),P4=Hm.format,Hm.parse,M4=Hm.utcFormat,Hm.utcParse,Hm}function i9(t){return new Date(t)}function s9(t){return t instanceof Date?+t:+new Date(+t)}function TE(t,e,r,n,i,a,c,s,g,_){var v=lE(),T=v.invert,M=v.domain,O=_(".%L"),F=_(":%S"),j=_("%I:%M"),V=_("%I %p"),q=_("%a %d"),Y=_("%b %d"),X=_("%B"),ae=_("%Y");function ue(ge){return(g(ge)<ge?O:s(ge)<ge?F:c(ge)<ge?j:a(ge)<ge?V:n(ge)<ge?i(ge)<ge?q:Y:r(ge)<ge?X:ae)(ge)}return v.invert=function(ge){return new Date(T(ge))},v.domain=function(ge){return arguments.length?M(Array.from(ge,s9)):M().map(i9)},v.ticks=function(ge){var Le=M();return t(Le[0],Le[Le.length-1],ge??10)},v.tickFormat=function(ge,Le){return Le==null?ue:_(Le)},v.nice=function(ge){var Le=M();return(!ge||typeof ge.range!="function")&&(ge=e(Le[0],Le[Le.length-1],ge??10)),ge?M(m4(Le,ge)):v},v.copy=function(){return i0(v,TE(t,e,r,n,i,a,c,s,g,_))},v}function a9(){return _c.apply(TE(t7,r7,mf,xE,k1,s0,vE,yE,og,P4).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function o9(){return _c.apply(TE(Jj,e7,yf,wE,D1,O1,bE,_E,og,M4).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function L1(){var t=0,e=1,r,n,i,a,c=qa,s=!1,g;function _(T){return T==null||isNaN(T=+T)?g:c(i===0?.5:(T=(a(T)-r)*i,s?Math.max(0,Math.min(1,T)):T))}_.domain=function(T){return arguments.length?([t,e]=T,r=a(t=+t),n=a(e=+e),i=r===n?0:1/(n-r),_):[t,e]},_.clamp=function(T){return arguments.length?(s=!!T,_):s},_.interpolator=function(T){return arguments.length?(c=T,_):c};function v(T){return function(M){var O,F;return arguments.length?([O,F]=M,c=T(O,F),_):[c(0),c(1)]}}return _.range=v(By),_.rangeRound=v(oE),_.unknown=function(T){return arguments.length?(g=T,_):g},function(T){return a=T,r=T(t),n=T(e),i=r===n?0:1/(n-r),_}}function $d(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function I4(){var t=Vd(L1()(qa));return t.copy=function(){return $d(t,I4())},wf.apply(t,arguments)}function R4(){var t=hE(L1()).domain([1,10]);return t.copy=function(){return $d(t,R4()).base(t.base())},wf.apply(t,arguments)}function O4(){var t=fE(L1());return t.copy=function(){return $d(t,O4()).constant(t.constant())},wf.apply(t,arguments)}function SE(){var t=dE(L1());return t.copy=function(){return $d(t,SE()).exponent(t.exponent())},wf.apply(t,arguments)}function l9(){return SE.apply(null,arguments).exponent(.5)}function k4(){var t=[],e=qa;function r(n){if(n!=null&&!isNaN(n=+n))return e((r0(t,n,1)-1)/(t.length-1))}return r.domain=function(n){if(!arguments.length)return t.slice();t=[];for(let i of n)i!=null&&!isNaN(i=+i)&&t.push(i);return t.sort(Ld),r},r.interpolator=function(n){return arguments.length?(e=n,r):e},r.range=function(){return t.map((n,i)=>e(i/(t.length-1)))},r.quantiles=function(n){return Array.from({length:n+1},(i,a)=>GU(t,a/n))},r.copy=function(){return k4(e).domain(t)},wf.apply(r,arguments)}function B1(){var t=0,e=.5,r=1,n=1,i,a,c,s,g,_=qa,v,T=!1,M;function O(j){return isNaN(j=+j)?M:(j=.5+((j=+v(j))-a)*(n*j<n*a?s:g),_(T?Math.max(0,Math.min(1,j)):j))}O.domain=function(j){return arguments.length?([t,e,r]=j,i=v(t=+t),a=v(e=+e),c=v(r=+r),s=i===a?0:.5/(a-i),g=a===c?0:.5/(c-a),n=a<i?-1:1,O):[t,e,r]},O.clamp=function(j){return arguments.length?(T=!!j,O):T},O.interpolator=function(j){return arguments.length?(_=j,O):_};function F(j){return function(V){var q,Y,X;return arguments.length?([q,Y,X]=V,_=bj(j,[q,Y,X]),O):[_(0),_(.5),_(1)]}}return O.range=F(By),O.rangeRound=F(oE),O.unknown=function(j){return arguments.length?(M=j,O):M},function(j){return v=j,i=j(t),a=j(e),c=j(r),s=i===a?0:.5/(a-i),g=a===c?0:.5/(c-a),n=a<i?-1:1,O}}function D4(){var t=Vd(B1()(qa));return t.copy=function(){return $d(t,D4())},wf.apply(t,arguments)}function L4(){var t=hE(B1()).domain([.1,1,10]);return t.copy=function(){return $d(t,L4()).base(t.base())},wf.apply(t,arguments)}function B4(){var t=fE(B1());return t.copy=function(){return $d(t,B4()).constant(t.constant())},wf.apply(t,arguments)}function AE(){var t=dE(B1());return t.copy=function(){return $d(t,AE()).exponent(t.exponent())},wf.apply(t,arguments)}function c9(){return AE.apply(null,arguments).exponent(.5)}const N4={BrewerYlGn3:["#f7fcb9","#addd8e","#31a354"],BrewerYlGn4:["#ffffcc","#c2e699","#78c679","#238443"],BrewerYlGn5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],BrewerYlGn6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],BrewerYlGn7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],BrewerYlGn8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],BrewerYlGn9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],BrewerYlGnBu3:["#edf8b1","#7fcdbb","#2c7fb8"],BrewerYlGnBu4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],BrewerYlGnBu5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],BrewerYlGnBu6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],BrewerYlGnBu7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],BrewerYlGnBu8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],BrewerYlGnBu9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],BrewerGnBu3:["#e0f3db","#a8ddb5","#43a2ca"],BrewerGnBu4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],BrewerGnBu5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],BrewerGnBu6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],BrewerGnBu7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],BrewerGnBu8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],BrewerGnBu9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],BrewerBuGn3:["#e5f5f9","#99d8c9","#2ca25f"],BrewerBuGn4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],BrewerBuGn5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],BrewerBuGn6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],BrewerBuGn7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],BrewerBuGn8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],BrewerBuGn9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],BrewerPuBuGn3:["#ece2f0","#a6bddb","#1c9099"],BrewerPuBuGn4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],BrewerPuBuGn5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],BrewerPuBuGn6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],BrewerPuBuGn7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],BrewerPuBuGn8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],BrewerPuBuGn9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],BrewerPuBu3:["#ece7f2","#a6bddb","#2b8cbe"],BrewerPuBu4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],BrewerPuBu5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],BrewerPuBu6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],BrewerPuBu7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],BrewerPuBu8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],BrewerPuBu9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BrewerBuPu3:["#e0ecf4","#9ebcda","#8856a7"],BrewerBuPu4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],BrewerBuPu5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],BrewerBuPu6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],BrewerBuPu7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],BrewerBuPu8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],BrewerBuPu9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],BrewerRdPu3:["#fde0dd","#fa9fb5","#c51b8a"],BrewerRdPu4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],BrewerRdPu5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],BrewerRdPu6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],BrewerRdPu7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],BrewerRdPu8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],BrewerRdPu9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],BrewerPuRd3:["#e7e1ef","#c994c7","#dd1c77"],BrewerPuRd4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],BrewerPuRd5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],BrewerPuRd6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],BrewerPuRd7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],BrewerPuRd8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],BrewerPuRd9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],BrewerOrRd3:["#fee8c8","#fdbb84","#e34a33"],BrewerOrRd4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],BrewerOrRd5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],BrewerOrRd6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],BrewerOrRd7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],BrewerOrRd8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],BrewerOrRd9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],BrewerYlOrRd3:["#ffeda0","#feb24c","#f03b20"],BrewerYlOrRd4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],BrewerYlOrRd5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],BrewerYlOrRd6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],BrewerYlOrRd7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],BrewerYlOrRd8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],BrewerYlOrRd9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],BrewerYlOrBr3:["#fff7bc","#fec44f","#d95f0e"],BrewerYlOrBr4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],BrewerYlOrBr5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],BrewerYlOrBr6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],BrewerYlOrBr7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],BrewerYlOrBr8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],BrewerYlOrBr9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],BrewerPurples3:["#efedf5","#bcbddc","#756bb1"],BrewerPurples4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],BrewerPurples5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],BrewerPurples6:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],BrewerPurples7:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],BrewerPurples8:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],BrewerPurples9:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],BrewerBlues3:["#deebf7","#9ecae1","#3182bd"],BrewerBlues4:["#eff3ff","#bdd7e7","#6baed6","#2171b5"],BrewerBlues5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],BrewerBlues6:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],BrewerBlues7:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],BrewerBlues8:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],BrewerBlues9:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],BrewerGreens3:["#e5f5e0","#a1d99b","#31a354"],BrewerGreens4:["#edf8e9","#bae4b3","#74c476","#238b45"],BrewerGreens5:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],BrewerGreens6:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],BrewerGreens7:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],BrewerGreens8:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],BrewerGreens9:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],BrewerOranges3:["#fee6ce","#fdae6b","#e6550d"],BrewerOranges4:["#feedde","#fdbe85","#fd8d3c","#d94701"],BrewerOranges5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],BrewerOranges6:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],BrewerOranges7:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],BrewerOranges8:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],BrewerOranges9:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BrewerReds3:["#fee0d2","#fc9272","#de2d26"],BrewerReds4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],BrewerReds5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],BrewerReds6:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],BrewerReds7:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],BrewerReds8:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],BrewerReds9:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],BrewerGreys3:["#f0f0f0","#bdbdbd","#636363"],BrewerGreys4:["#f7f7f7","#cccccc","#969696","#525252"],BrewerGreys5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],BrewerGreys6:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#636363","#252525"],BrewerGreys7:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],BrewerGreys8:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],BrewerGreys9:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],BrewerPuOr3:["#f1a340","#f7f7f7","#998ec3"],BrewerPuOr4:["#e66101","#fdb863","#b2abd2","#5e3c99"],BrewerPuOr5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],BrewerPuOr6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],BrewerPuOr7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],BrewerPuOr8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],BrewerPuOr9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],BrewerPuOr10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],BrewerPuOr11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],BrewerBrBG3:["#d8b365","#f5f5f5","#5ab4ac"],BrewerBrBG4:["#a6611a","#dfc27d","#80cdc1","#018571"],BrewerBrBG5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],BrewerBrBG6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],BrewerBrBG7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],BrewerBrBG8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],BrewerBrBG9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],BrewerBrBG10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],BrewerBrBG11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],BrewerPRGn3:["#af8dc3","#f7f7f7","#7fbf7b"],BrewerPRGn4:["#7b3294","#c2a5cf","#a6dba0","#008837"],BrewerPRGn5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],BrewerPRGn6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],BrewerPRGn7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],BrewerPRGn8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],BrewerPRGn9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],BrewerPRGn10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],BrewerPRGn11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],BrewerPiYG3:["#e9a3c9","#f7f7f7","#a1d76a"],BrewerPiYG4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],BrewerPiYG5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],BrewerPiYG6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],BrewerPiYG7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],BrewerPiYG8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],BrewerPiYG9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],BrewerPiYG10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],BrewerPiYG11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],BrewerRdBu3:["#ef8a62","#f7f7f7","#67a9cf"],BrewerRdBu4:["#ca0020","#f4a582","#92c5de","#0571b0"],BrewerRdBu5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],BrewerRdBu6:["#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac"],BrewerRdBu7:["#b2182b","#ef8a62","#fddbc7","#f7f7f7","#d1e5f0","#67a9cf","#2166ac"],BrewerRdBu8:["#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac"],BrewerRdBu9:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],BrewerRdBu10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],BrewerRdBu11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],BrewerRdGy3:["#ef8a62","#ffffff","#999999"],BrewerRdGy4:["#ca0020","#f4a582","#bababa","#404040"],BrewerRdGy5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],BrewerRdGy6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],BrewerRdGy7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],BrewerRdGy8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],BrewerRdGy9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],BrewerRdGy10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],BrewerRdGy11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],BrewerRdYlBu3:["#fc8d59","#ffffbf","#91bfdb"],BrewerRdYlBu4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],BrewerRdYlBu5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],BrewerRdYlBu6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],BrewerRdYlBu7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],BrewerRdYlBu8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],BrewerRdYlBu9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],BrewerRdYlBu10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrewerRdYlBu11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrewerSpectral3:["#fc8d59","#ffffbf","#99d594"],BrewerSpectral4:["#d7191c","#fdae61","#abdda4","#2b83ba"],BrewerSpectral5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],BrewerSpectral6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],BrewerSpectral7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],BrewerSpectral8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],BrewerSpectral9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],BrewerSpectral10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],BrewerSpectral11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],BrewerRdYlGn3:["#fc8d59","#ffffbf","#91cf60"],BrewerRdYlGn4:["#d7191c","#fdae61","#a6d96a","#1a9641"],BrewerRdYlGn5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],BrewerRdYlGn6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],BrewerRdYlGn7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],BrewerRdYlGn8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],BrewerRdYlGn9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],BrewerRdYlGn10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],BrewerRdYlGn11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],BrewerAccent3:["#7fc97f","#beaed4","#fdc086"],BrewerAccent4:["#7fc97f","#beaed4","#fdc086","#ffff99"],BrewerAccent5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],BrewerAccent6:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"],BrewerAccent7:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],BrewerAccent8:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],BrewerDark23:["#1b9e77","#d95f02","#7570b3"],BrewerDark24:["#1b9e77","#d95f02","#7570b3","#e7298a"],BrewerDark25:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],BrewerDark26:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],BrewerDark27:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],BrewerDark28:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],BrewerPaired3:["#a6cee3","#1f78b4","#b2df8a"],BrewerPaired4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],BrewerPaired5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],BrewerPaired6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],BrewerPaired7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],BrewerPaired8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],BrewerPaired9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],BrewerPaired10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],BrewerPaired11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],BrewerPaired12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],BrewerPastel13:["#fbb4ae","#b3cde3","#ccebc5"],BrewerPastel14:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],BrewerPastel15:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],BrewerPastel16:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc"],BrewerPastel17:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd"],BrewerPastel18:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],BrewerPastel19:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"],BrewerPastel23:["#b3e2cd","#fdcdac","#cbd5e8"],BrewerPastel24:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],BrewerPastel25:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],BrewerPastel26:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae"],BrewerPastel27:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],BrewerPastel28:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],BrewerSet13:["#e41a1c","#377eb8","#4daf4a"],BrewerSet14:["#e41a1c","#377eb8","#4daf4a","#984ea3"],BrewerSet15:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],BrewerSet16:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],BrewerSet17:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],BrewerSet18:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],BrewerSet19:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],BrewerSet23:["#66c2a5","#fc8d62","#8da0cb"],BrewerSet24:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],BrewerSet25:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],BrewerSet26:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"],BrewerSet27:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],BrewerSet28:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],BrewerSet33:["#8dd3c7","#ffffb3","#bebada"],BrewerSet34:["#8dd3c7","#ffffb3","#bebada","#fb8072"],BrewerSet35:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],BrewerSet36:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462"],BrewerSet37:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],BrewerSet38:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],BrewerSet39:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],BrewerSet310:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd"],BrewerSet311:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5"],BrewerSet312:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],CartoBurg:["#ffc6c4","#f4a3a8","#e38191","#cc607d","#ad466c","#8b3058","#672044"],CartoBurgYl:["#fbe6c5","#f5ba98","#ee8a82","#dc7176","#c8586c","#9c3f5d","#70284a"],CartoRedOr:["#f6d2a9","#f5b78e","#f19c7c","#ea8171","#dd686c","#ca5268","#b13f64"],CartoOrYel:["#ecda9a","#efc47e","#f3ad6a","#f7945d","#f97b57","#f66356","#ee4d5a"],CartoPeach:["#fde0c5","#facba6","#f8b58b","#f59e72","#f2855d","#ef6a4c","#eb4a40"],CartoPinkYl:["#fef6b5","#ffdd9a","#ffc285","#ffa679","#fa8a76","#f16d7a","#e15383"],CartoMint:["#e4f1e1","#b4d9cc","#89c0b6","#63a6a0","#448c8a","#287274","#0d585f"],CartoBluGrn:["#c4e6c3","#96d2a4","#6dbc90","#4da284","#36877a","#266b6e","#1d4f60"],CartoDarkMint:["#d2fbd4","#a5dbc2","#7bbcb0","#559c9e","#3a7c89","#235d72","#123f5a"],CartoEmrld:["#d3f2a3","#97e196","#6cc08b","#4c9b82","#217a79","#105965","#074050"],CartoBluYl:["#f7feae","#b7e6a5","#7ccba2","#46aea0","#089099","#00718b","#045275"],CartoTeal:["#d1eeea","#a8dbd9","#85c4c9","#68abb8","#4f90a6","#3b738f","#2a5674"],CartoTealGrn:["#b0f2bc","#89e8ac","#67dba5","#4cc8a3","#38b2a3","#2c98a0","#257d98"],CartoPurp:["#f3e0f7","#e4c7f1","#d1afe8","#b998dd","#9f82ce","#826dba","#63589f"],CartoPurpOr:["#f9ddda","#f2b9c4","#e597b9","#ce78b3","#ad5fad","#834ba0","#573b88"],CartoSunset:["#f3e79b","#fac484","#f8a07e","#eb7f86","#ce6693","#a059a0","#5c53a5"],CartoMagenta:["#f3cbd3","#eaa9bd","#dd88ac","#ca699d","#b14d8e","#91357d","#6c2167"],CartoSunsetDark:["#fcde9c","#faa476","#f0746e","#e34f6f","#dc3977","#b9257a","#7c1d6f"],CartoBrwnYl:["#ede5cf","#e0c2a2","#d39c83","#c1766f","#a65461","#813753","#541f3f"],CartoArmyRose:["#798234","#a3ad62","#d0d3a2","#fdfbe4","#f0c6c3","#df91a3","#d46780"],CartoFall:["#3d5941","#778868","#b5b991","#f6edbd","#edbb8a","#de8a5a","#ca562c"],CartoGeyser:["#008080","#70a494","#b4c8a8","#f6edbd","#edbb8a","#de8a5a","#ca562c"],CartoTemps:["#009392","#39b185","#9ccb86","#e9e29c","#eeb479","#e88471","#cf597e"],CartoTealRose:["#009392","#72aaa1","#b1c7b3","#f1eac8","#e5b9ad","#d98994","#d0587e"],CartoTropic:["#009B9E","#42B7B9","#A7D3D4","#F1F1F1","#E4C1D9","#D691C1","#C75DAB"],CartoEarth:["#A16928","#bd925a","#d6bd8d","#edeac2","#b5c8b8","#79a7ac","#2887a1"]},u9=Object.keys(N4);function h9(t){return u9.includes(t)}const f9=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,d9=t=>{const e=f9.exec(t);if(e!==null)return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)];throw new Error(`Cannot parse hex color "${t}"`)},p9=(t,e,r)=>Array.from({length:r},(n,i)=>t+i*(e-t)/(r-1)),g9=(t,e,r)=>Array.from({length:r-1},(n,i)=>t+(i+1)*(e-t)/r),m9=({colorScheme:t,customColors:e,min:r,max:n,isReverse:i=!1,isContinuous:a=!1})=>{let c;if(t)if(h9(t))c=N4[t];else throw new Error(`"${t}" is not a supported color scheme`);else if(e&&e.length>=2)c=e;else throw new Error("You must provide a colorScheme or an array of at least 2 customColors");const s=c.map(d9),g=i?s.reverse():s;if(a){const _=p9(r,n,g.length);return R1(_,g).clamp(!0)}else{const _=g9(r,n,g.length);return gE(_,g)}},zd=256,y9=(t,{offset:e,scale:r,noData:n,colorScale:i})=>{const a=zd*zd,c=t.length/a,s=new Uint8ClampedArray(a*4),g=m9(i);for(let _=0;_<a;_++){const v=e+t[_*c]*r;if(v===n||isNaN(v)||v===1/0)s[4*_]=0,s[4*_+1]=0,s[4*_+2]=0,s[4*_+3]=0;else{const T=g(v);s[4*_]=T[0],s[4*_+1]=T[1],s[4*_+2]=T[2],s[4*_+3]=255}}return s},vl=zd*zd,Lg=t=>t.length/vl;function _9(t,e,r){const n=new Uint8ClampedArray(vl*4),i=Lg(t);let a;for(let c=0;c<vl;c++)a=255-t[c*i]/e*255,n[c*4]=a,n[c*4+1]=a,n[c*4+2]=a,n[c*4+3]=t[c*i]===r?0:255;return n}function v9(t,e,r){const n=new Uint8ClampedArray(vl*4),i=Lg(t);let a;for(let c=0;c<vl;c++)a=t[c*i]/e*255,n[c*4]=a,n[c*4+1]=a,n[c*4+2]=a,n[c*4+3]=t[c*i]===r?0:255;return n}function b9(t,e){const r=new Uint8ClampedArray(vl*4),n=Lg(t);for(let i=0;i<vl;i++)r[i*4]=t[i*n],r[i*4+1]=t[i*n+1],r[i*4+2]=t[i*n+2],r[i*4+3]=t[i*n]===e&&t[i*n+1]===e&&t[i*n+2]===e?0:255;return r}function x9(t,e,r){const n=new Uint8ClampedArray(vl*4),i=Lg(t),a=e.length/3,c=e.length/3*2;for(let s=0;s<vl;s++){const g=t[s*i];n[s*4]=e[g]/65536*256,n[s*4+1]=e[g+a]/65536*256,n[s*4+2]=e[g+c]/65536*256,n[s*4+3]=t[s*i]===r?0:255}return n}function w9(t,e){const r=new Uint8ClampedArray(vl*4),n=Lg(t);for(let i=0;i<t.length;i++){const a=t[i*n],c=t[i*n+1],s=t[i*n+2],g=t[i*n+3];r[i*4]=255*((255-a)/256)*((255-g)/256),r[i*4+1]=255*((255-c)/256)*((255-g)/256),r[i*4+2]=255*((255-s)/256)*((255-g)/256),r[i*4+3]=a===e&&c===e&&s===e&&g===e?0:255}return r}function T9(t,e){const r=new Uint8ClampedArray(vl*4),n=Lg(t);for(let i=0;i<vl;i++){const a=t[i*n],c=t[i*n+1],s=t[i*n+2];r[i*4]=a+1.402*(s-128),r[i*4+1]=a-.34414*(c-128)-.71414*(s-128),r[i*4+2]=a+1.772*(c-128),r[i*4+3]=a===e&&c==e&&s==e?0:255}return r}const S9=.95047,A9=1,E9=1.08883;function C9(t,e){const r=new Uint8ClampedArray(vl),n=Lg(t);for(let i=0;i<t.length;i++){const a=t[i*n],c=t[i*n+1]<<24>>24,s=t[i*n+2]<<24>>24;let g=(a+16)/116,_=c/500+g,v=g-s/200,T,M,O;_=S9*(_*_*_>.008856?_*_*_:(_-16/116)/7.787),g=A9*(g*g*g>.008856?g*g*g:(g-16/116)/7.787),v=E9*(v*v*v>.008856?v*v*v:(v-16/116)/7.787),T=_*3.2406+g*-1.5372+v*-.4986,M=_*-.9689+g*1.8758+v*.0415,O=_*.0557+g*-.204+v*1.057,T=T>.0031308?1.055*T**(1/2.4)-.055:12.92*T,M=M>.0031308?1.055*M**(1/2.4)-.055:12.92*M,O=O>.0031308?1.055*O**(1/2.4)-.055:12.92*O,r[4*i]=Math.max(0,Math.min(1,T))*255,r[4*i+1]=Math.max(0,Math.min(1,M))*255,r[4*i+2]=Math.max(0,Math.min(1,O))*255,r[i*4+3]=a===e&&c==e&&s==e?0:255}return r}var rf;(function(t){t[t.WhiteIsZero=0]="WhiteIsZero",t[t.BlackIsZero=1]="BlackIsZero",t[t.RGB=2]="RGB",t[t.Palette=3]="Palette",t[t.TransparencyMask=4]="TransparencyMask",t[t.CMYK=5]="CMYK",t[t.YCbCr=6]="YCbCr",t[t.CIELab=8]="CIELab",t[t.ICCLab=9]="ICCLab"})(rf||(rf={}));const P9=(t,{noData:e,photometricInterpretation:r,bitsPerSample:n,colorMap:i})=>{const a=n&&n[0]?2**n[0]:NaN,c=e??0;let s;switch(r){case rf.WhiteIsZero:s=_9(t,a,c);break;case rf.BlackIsZero:s=v9(t,a,c);break;case rf.RGB:s=b9(t,c);break;case rf.Palette:if(i)s=x9(t,i,c);else throw new Error("colorMap for paletted image not found.");break;case rf.CMYK:s=w9(t,c);break;case rf.YCbCr:s=T9(t,c);break;case rf.CIELab:s=C9(t,c);break;default:throw new Error("Unsupported photometric interpretation.")}return s},M9=(t,{offset:e,scale:r,noData:n})=>{const i=zd*zd,a=t.length/i,c=new Uint8ClampedArray(i*4),s=-1e4,g=.1;for(let _=0;_<i;_++){const v=e+t[_*a]*r,M=((v==n?0:v)-s)/g;c[4*_]=Math.floor(M/256/256)%256,c[4*_+1]=Math.floor(M/256)%256,c[4*_+2]=M%256,c[4*_+3]=255}return c},YP={},I9={get:t=>YP[t],set:(t,e)=>{YP[t]=e}},R9=async t=>{const e=new RegExp(/cog:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),r=t.match(e);if(!r)throw new Error(`Invalid COG protocol URL '${t}'`);const n=r[1].split("#"),i=n[0];n.shift();const a=n.join("#")??"",c=parseInt(r[2]),s=parseInt(r[3]),g=parseInt(r[4]),_=i4(i),v=await _.getRawTile({z:c,x:s,y:g}),T=await _.getMetadata();let M;const O=I9.get(i);if(O!==void 0)M=O(v,T);else if(a.startsWith("dem"))M=M9(v,T);else if(a.startsWith("color")){const F=a.split("color").pop()?.substring(1);if(F){const j=F.match(/\[("#([0-9a-fA-F]{3,6})"(,(\s)?)?)+]/)?.[0];let V="",q=[],Y,X,ae;j?(q=JSON.parse(j),[Y,X,ae]=F.replace(`${j},`,"").split(",")):[V,Y,X,ae]=F.split(",");const ue=parseFloat(Y),ge=parseFloat(X),Le=ae?.includes("-")||!1,qe=ae?.includes("c")||!1;M=y9(v,{...T,colorScale:{colorScheme:V,customColors:q,min:ue,max:ge,isReverse:Le,isContinuous:qe}})}else throw new Error("Color params are not defined")}else M=P9(v,T);return await createImageBitmap(new ImageData(M,zd,zd))},z4=async t=>{if(t.type=="json"){const e=t.url.replace("cog://","").split("#")[0];return{data:await i4(e).getTilejson(t.url)}}else{if(t.type=="image")return{data:await R9(t.url)};throw new Error(`Unsupported request type '${t.type}'`)}};var ml=Uint8Array,Jm=Uint16Array,O9=Int32Array,F4=new ml([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),U4=new ml([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),k9=new ml([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),j4=function(t,e){for(var r=new Jm(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];for(var i=new O9(r[30]),n=1;n<30;++n)for(var a=r[n];a<r[n+1];++a)i[a]=a-r[n]<<5|n;return{b:r,r:i}},V4=j4(F4,2),$4=V4.b,D9=V4.r;$4[28]=258,D9[258]=28;var L9=j4(U4,0),B9=L9.b,TS=new Jm(32768);for(var pi=0;pi<32768;++pi){var wd=(pi&43690)>>1|(pi&21845)<<1;wd=(wd&52428)>>2|(wd&13107)<<2,wd=(wd&61680)>>4|(wd&3855)<<4,TS[pi]=((wd&65280)>>8|(wd&255)<<8)>>1}var wv=(function(t,e,r){for(var n=t.length,i=0,a=new Jm(e);i<n;++i)t[i]&&++a[t[i]-1];var c=new Jm(e);for(i=1;i<e;++i)c[i]=c[i-1]+a[i-1]<<1;var s;if(r){s=new Jm(1<<e);var g=15-e;for(i=0;i<n;++i)if(t[i])for(var _=i<<4|t[i],v=e-t[i],T=c[t[i]-1]++<<v,M=T|(1<<v)-1;T<=M;++T)s[TS[T]>>g]=_}else for(s=new Jm(n),i=0;i<n;++i)t[i]&&(s[i]=TS[c[t[i]-1]++]>>15-t[i]);return s}),a0=new ml(288);for(var pi=0;pi<144;++pi)a0[pi]=8;for(var pi=144;pi<256;++pi)a0[pi]=9;for(var pi=256;pi<280;++pi)a0[pi]=7;for(var pi=280;pi<288;++pi)a0[pi]=8;var H4=new ml(32);for(var pi=0;pi<32;++pi)H4[pi]=5;var N9=wv(a0,9,1),z9=wv(H4,5,1),r2=function(t){for(var e=t[0],r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},eu=function(t,e,r){var n=e/8|0;return(t[n]|t[n+1]<<8)>>(e&7)&r},n2=function(t,e){var r=e/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(e&7)},F9=function(t){return(t+7)/8|0},U9=function(t,e,r){return(r==null||r>t.length)&&(r=t.length),new ml(t.subarray(e,r))},j9=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ul=function(t,e,r){var n=new Error(e||j9[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,ul),!r)throw n;return n},EE=function(t,e,r,n){var i=t.length,a=0;if(!i||e.f&&!e.l)return r||new ml(0);var c=!r,s=c||e.i!=2,g=e.i;c&&(r=new ml(i*3));var _=function(mr){var Mt=r.length;if(mr>Mt){var Cr=new ml(Math.max(Mt*2,mr));Cr.set(r),r=Cr}},v=e.f||0,T=e.p||0,M=e.b||0,O=e.l,F=e.d,j=e.m,V=e.n,q=i*8;do{if(!O){v=eu(t,T,1);var Y=eu(t,T+1,3);if(T+=3,Y)if(Y==1)O=N9,F=z9,j=9,V=5;else if(Y==2){var ge=eu(t,T,31)+257,Le=eu(t,T+10,15)+4,qe=ge+eu(t,T+5,31)+1;T+=14;for(var Ze=new ml(qe),_t=new ml(19),it=0;it<Le;++it)_t[k9[it]]=eu(t,T+it*3,7);T+=Le*3;for(var gt=r2(_t),Lt=(1<<gt)-1,Ot=wv(_t,gt,1),it=0;it<qe;){var Yt=Ot[eu(t,T,Lt)];T+=Yt&15;var X=Yt>>4;if(X<16)Ze[it++]=X;else{var ce=0,we=0;for(X==16?(we=3+eu(t,T,3),T+=2,ce=Ze[it-1]):X==17?(we=3+eu(t,T,7),T+=3):X==18&&(we=11+eu(t,T,127),T+=7);we--;)Ze[it++]=ce}}var Re=Ze.subarray(0,ge),Ue=Ze.subarray(ge);j=r2(Re),V=r2(Ue),O=wv(Re,j,1),F=wv(Ue,V,1)}else ul(1);else{var X=F9(T)+4,ae=t[X-4]|t[X-3]<<8,ue=X+ae;if(ue>i){g&&ul(0);break}s&&_(M+ae),r.set(t.subarray(X,ue),M),e.b=M+=ae,e.p=T=ue*8,e.f=v;continue}if(T>q){g&&ul(0);break}}s&&_(M+131072);for(var at=(1<<j)-1,pe=(1<<V)-1,Pe=T;;Pe=T){var ce=O[n2(t,T)&at],rt=ce>>4;if(T+=ce&15,T>q){g&&ul(0);break}if(ce||ul(2),rt<256)r[M++]=rt;else if(rt==256){Pe=T,O=null;break}else{var vt=rt-254;if(rt>264){var it=rt-257,At=F4[it];vt=eu(t,T,(1<<At)-1)+$4[it],T+=At}var $t=F[n2(t,T)&pe],Gt=$t>>4;$t||ul(3),T+=$t&15;var Ue=B9[Gt];if(Gt>3){var At=U4[Gt];Ue+=n2(t,T)&(1<<At)-1,T+=At}if(T>q){g&&ul(0);break}s&&_(M+131072);var nr=M+vt;if(M<Ue){var Et=a-Ue,Wt=Math.min(Ue,nr);for(Et+M<0&&ul(3);M<Wt;++M)r[M]=n[Et+M]}for(;M<nr;++M)r[M]=r[M-Ue]}}e.l=O,e.p=Pe,e.b=M,e.f=v,O&&(v=1,e.m=j,e.d=F,e.n=V)}while(!v);return M!=r.length&&c?U9(r,0,M):r.subarray(0,M)},V9=new ml(0),$9=function(t){(t[0]!=31||t[1]!=139||t[2]!=8)&&ul(6,"invalid gzip data");var e=t[3],r=10;e&4&&(r+=(t[10]|t[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!t[r++]);return r+(e&2)},H9=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},W9=function(t,e){return((t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31)&&ul(6,"invalid zlib data"),(t[1]>>5&1)==1&&ul(6,"invalid zlib data: "+(t[1]&32?"need":"unexpected")+" dictionary"),(t[1]>>3&4)+2};function q9(t,e){return EE(t,{i:2},e,e)}function G9(t,e){var r=$9(t);return r+8>t.length&&ul(6,"invalid gzip data"),EE(t.subarray(r,-8),{i:2},new ml(H9(t)),e)}function X9(t,e){return EE(t.subarray(W9(t),-4),{i:2},e,e)}function Z9(t,e){return t[0]==31&&t[1]==139&&t[2]==8?G9(t,e):(t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31?q9(t,e):X9(t,e)}var Y9=typeof TextDecoder<"u"&&new TextDecoder,K9=0;try{Y9.decode(V9,{stream:!0}),K9=1}catch{}var Q9=Object.defineProperty,Tv=Math.pow,jn=(t,e)=>Q9(t,"name",{value:e,configurable:!0}),Ys=(t,e,r)=>new Promise((n,i)=>{var a=g=>{try{s(r.next(g))}catch(_){i(_)}},c=g=>{try{s(r.throw(g))}catch(_){i(_)}},s=g=>g.done?n(g.value):Promise.resolve(g.value).then(a,c);s((r=r.apply(t,e)).next())});jn((t,e)=>{let r=!1,n="",i=L.GridLayer.extend({createTile:jn((a,c)=>{let s=document.createElement("img"),g=new AbortController,_=g.signal;return s.cancel=()=>{g.abort()},r||(t.getHeader().then(v=>{v.tileType===1?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):v.tileType===2?n="image/png":v.tileType===3?n="image/jpeg":v.tileType===4?n="image/webp":v.tileType===5&&(n="image/avif")}),r=!0),t.getZxy(a.z,a.x,a.y,_).then(v=>{if(v){let T=new Blob([v.data],{type:n}),M=window.URL.createObjectURL(T);s.src=M,s.cancel=void 0,c(void 0,s)}}).catch(v=>{if(v.name!=="AbortError")throw v}),s},"createTile"),_removeTile:jn(function(a){let c=this._tiles[a];c&&(c.el.cancel&&c.el.cancel(),c.el.width=0,c.el.height=0,c.el.deleted=!0,L.DomUtil.remove(c.el),delete this._tiles[a],this.fire("tileunload",{tile:c.el,coords:this._keyToTileCoords(a)}))},"_removeTile")});return new i(e)},"leafletRasterLayer");var J9=jn(t=>(e,r)=>{if(r instanceof AbortController)return t(e,r);let n=new AbortController;return t(e,n).then(i=>r(void 0,i.data,i.cacheControl||"",i.expires||""),i=>r(i)).catch(i=>r(i)),{cancel:jn(()=>n.abort(),"cancel")}},"v3compat"),W4=class{constructor(e){this.tilev4=jn((r,n)=>Ys(this,null,function*(){if(r.type==="json"){let O=r.url.substr(10),F=this.tiles.get(O);if(F||(F=new KP(O),this.tiles.set(O,F)),this.metadata)return{data:yield F.getTileJson(r.url)};let j=yield F.getHeader();return(j.minLon>=j.maxLon||j.minLat>=j.maxLat)&&console.error(`Bounds of PMTiles archive ${j.minLon},${j.minLat},${j.maxLon},${j.maxLat} are not valid.`),{data:{tiles:[`${r.url}/{z}/{x}/{y}`],minzoom:j.minZoom,maxzoom:j.maxZoom,bounds:[j.minLon,j.minLat,j.maxLon,j.maxLat]}}}let i=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),a=r.url.match(i);if(!a)throw new Error("Invalid PMTiles protocol URL");let c=a[1],s=this.tiles.get(c);s||(s=new KP(c),this.tiles.set(c,s));let g=a[2],_=a[3],v=a[4],T=yield s.getHeader(),M=yield s?.getZxy(+g,+_,+v,n.signal);if(M)return{data:new Uint8Array(M.data),cacheControl:M.cacheControl,expires:M.expires};if(T.tileType===1){if(this.errorOnMissingTile)throw new Error("Tile not found.");return{data:new Uint8Array}}return{data:null}}),"tilev4"),this.tile=J9(this.tilev4),this.tiles=new Map,this.metadata=e?.metadata||!1,this.errorOnMissingTile=e?.errorOnMissingTile||!1}add(e){this.tiles.set(e.source.getKey(),e)}get(e){return this.tiles.get(e)}};jn(W4,"Protocol");var CE=W4;function q4(t,e){return(e>>>0)*4294967296+(t>>>0)}jn(q4,"toNum");function G4(t,e){let r=e.buf,n=r[e.pos++],i=(n&112)>>4;if(n<128||(n=r[e.pos++],i|=(n&127)<<3,n<128)||(n=r[e.pos++],i|=(n&127)<<10,n<128)||(n=r[e.pos++],i|=(n&127)<<17,n<128)||(n=r[e.pos++],i|=(n&127)<<24,n<128)||(n=r[e.pos++],i|=(n&1)<<31,n<128))return q4(t,i);throw new Error("Expected varint not more than 10 bytes")}jn(G4,"readVarintRemainder");function Km(t){let e=t.buf,r=e[t.pos++],n=r&127;return r<128||(r=e[t.pos++],n|=(r&127)<<7,r<128)||(r=e[t.pos++],n|=(r&127)<<14,r<128)||(r=e[t.pos++],n|=(r&127)<<21,r<128)?n:(r=e[t.pos],n|=(r&15)<<28,G4(n,t))}jn(Km,"readVarint");function PE(t,e,r,n){if(n===0){r===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);let i=e[0];e[0]=e[1],e[1]=i}}jn(PE,"rotate");function X4(t,e){let r=Tv(2,t),n=e,i=e,a=e,c=[0,0],s=1;for(;s<r;)n=1&a/2,i=1&(a^n),PE(s,c,n,i),c[0]+=s*n,c[1]+=s*i,a=a/4,s*=2;return[t,c[0],c[1]]}jn(X4,"idOnLevel");var eV=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Z4(t,e,r){if(t>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");if(e>Tv(2,t)-1||r>Tv(2,t)-1)throw new Error("tile x/y outside zoom level bounds");let n=eV[t],i=Tv(2,t),a=0,c=0,s=0,g=[e,r],_=i/2;for(;_>0;)a=(g[0]&_)>0?1:0,c=(g[1]&_)>0?1:0,s+=_*_*(3*a^c),PE(_,g,a,c),_=_/2;return n+s}jn(Z4,"zxyToTileId");function tV(t){let e=0;for(let r=0;r<27;r++){let n=(1<<r)*(1<<r);if(e+n>t)return X4(r,t-e);e+=n}throw new Error("Tile zoom level exceeds max safe number limit (26)")}jn(tV,"tileIdToZxy");var rV=(t=>(t[t.Unknown=0]="Unknown",t[t.None=1]="None",t[t.Gzip=2]="Gzip",t[t.Brotli=3]="Brotli",t[t.Zstd=4]="Zstd",t))(rV||{});function N1(t,e){return Ys(this,null,function*(){if(e===1||e===0)return t;if(e===2){if(typeof globalThis.DecompressionStream>"u")return Z9(new Uint8Array(t));let r=new Response(t).body;if(!r)throw new Error("Failed to read response stream");let n=r.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}throw new Error("Compression method not supported")})}jn(N1,"defaultDecompress");var nV=(t=>(t[t.Unknown=0]="Unknown",t[t.Mvt=1]="Mvt",t[t.Png=2]="Png",t[t.Jpeg=3]="Jpeg",t[t.Webp=4]="Webp",t[t.Avif=5]="Avif",t))(nV||{});function Y4(t){return t===1?".mvt":t===2?".png":t===3?".jpg":t===4?".webp":t===5?".avif":""}jn(Y4,"tileTypeExt");var iV=127;function K4(t,e){let r=0,n=t.length-1;for(;r<=n;){let i=n+r>>1,a=e-t[i].tileId;if(a>0)r=i+1;else if(a<0)n=i-1;else return t[i]}return n>=0&&(t[n].runLength===0||e-t[n].tileId<t[n].runLength)?t[n]:null}jn(K4,"findTile");var sV=class{constructor(e){this.file=e}getKey(){return this.file.name}getBytes(e,r){return Ys(this,null,function*(){return{data:yield this.file.slice(e,e+r).arrayBuffer()}})}};jn(sV,"FileSource");var Q4=class{constructor(e,r=new Headers){this.url=e,this.customHeaders=r,this.mustReload=!1;let n="";"navigator"in globalThis&&(n=globalThis.navigator.userAgent||"");let i=n.indexOf("Windows")>-1,a=/Chrome|Chromium|Edg|OPR|Brave/.test(n);this.chromeWindowsNoCache=!1,i&&a&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(e){this.customHeaders=e}getBytes(e,r,n,i){return Ys(this,null,function*(){let a,c;n?c=n:(a=new AbortController,c=a.signal);let s=new Headers(this.customHeaders);s.set("range",`bytes=${e}-${e+r-1}`);let g;this.mustReload?g="reload":this.chromeWindowsNoCache&&(g="no-store");let _=yield fetch(this.url,{signal:c,cache:g,headers:s});if(e===0&&_.status===416){let M=_.headers.get("Content-Range");if(!M||!M.startsWith("bytes */"))throw new Error("Missing content-length on 416 response");let O=+M.substr(8);_=yield fetch(this.url,{signal:c,cache:"reload",headers:{range:`bytes=0-${O-1}`}})}let v=_.headers.get("Etag");if(v!=null&&v.startsWith("W/")&&(v=null),_.status===416||i&&v&&v!==i)throw this.mustReload=!0,new SS(`Server returned non-matching ETag ${i} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(_.status>=300)throw new Error(`Bad response code: ${_.status}`);let T=_.headers.get("Content-Length");if(_.status===200&&(!T||+T>r))throw a&&a.abort(),new Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield _.arrayBuffer(),etag:v||void 0,cacheControl:_.headers.get("Cache-Control")||void 0,expires:_.headers.get("Expires")||void 0}})}};jn(Q4,"FetchSource");var aV=Q4;function ic(t,e){let r=t.getUint32(e+4,!0),n=t.getUint32(e+0,!0);return r*Tv(2,32)+n}jn(ic,"getUint64");function J4(t,e){let r=new DataView(t),n=r.getUint8(7);if(n>3)throw new Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:ic(r,8),rootDirectoryLength:ic(r,16),jsonMetadataOffset:ic(r,24),jsonMetadataLength:ic(r,32),leafDirectoryOffset:ic(r,40),leafDirectoryLength:ic(r,48),tileDataOffset:ic(r,56),tileDataLength:ic(r,64),numAddressedTiles:ic(r,72),numTileEntries:ic(r,80),numTileContents:ic(r,88),clustered:r.getUint8(96)===1,internalCompression:r.getUint8(97),tileCompression:r.getUint8(98),tileType:r.getUint8(99),minZoom:r.getUint8(100),maxZoom:r.getUint8(101),minLon:r.getInt32(102,!0)/1e7,minLat:r.getInt32(106,!0)/1e7,maxLon:r.getInt32(110,!0)/1e7,maxLat:r.getInt32(114,!0)/1e7,centerZoom:r.getUint8(118),centerLon:r.getInt32(119,!0)/1e7,centerLat:r.getInt32(123,!0)/1e7,etag:e}}jn(J4,"bytesToHeader");function ME(t){let e={buf:new Uint8Array(t),pos:0},r=Km(e),n=[],i=0;for(let a=0;a<r;a++){let c=Km(e);n.push({tileId:i+c,offset:0,length:0,runLength:1}),i+=c}for(let a=0;a<r;a++)n[a].runLength=Km(e);for(let a=0;a<r;a++)n[a].length=Km(e);for(let a=0;a<r;a++){let c=Km(e);c===0&&a>0?n[a].offset=n[a-1].offset+n[a-1].length:n[a].offset=c-1}return n}jn(ME,"deserializeIndex");var e6=class extends Error{};jn(e6,"EtagMismatch");var SS=e6;function IE(t,e){return Ys(this,null,function*(){let r=yield t.getBytes(0,16384);if(new DataView(r.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");let n=r.data.slice(0,iV),i=J4(n,r.etag),a=r.data.slice(i.rootDirectoryOffset,i.rootDirectoryOffset+i.rootDirectoryLength),c=`${t.getKey()}|${i.etag||""}|${i.rootDirectoryOffset}|${i.rootDirectoryLength}`,s=ME(yield e(a,i.internalCompression));return[i,[c,s.length,s]]})}jn(IE,"getHeaderAndRoot");function RE(t,e,r,n,i){return Ys(this,null,function*(){let a=yield t.getBytes(r,n,void 0,i.etag),c=yield e(a.data,i.internalCompression),s=ME(c);if(s.length===0)throw new Error("Empty directory is invalid");return s})}jn(RE,"getDirectory");var oV=class{constructor(e=100,r=!0,n=N1){this.cache=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=n}getHeader(e){return Ys(this,null,function*(){let r=e.getKey(),n=this.cache.get(r);if(n)return n.lastUsed=this.counter++,n.data;let i=yield IE(e,this.decompress);return i[1]&&this.cache.set(i[1][0],{lastUsed:this.counter++,data:i[1][2]}),this.cache.set(r,{lastUsed:this.counter++,data:i[0]}),this.prune(),i[0]})}getDirectory(e,r,n,i){return Ys(this,null,function*(){let a=`${e.getKey()}|${i.etag||""}|${r}|${n}`,c=this.cache.get(a);if(c)return c.lastUsed=this.counter++,c.data;let s=yield RE(e,this.decompress,r,n,i);return this.cache.set(a,{lastUsed:this.counter++,data:s}),this.prune(),s})}prune(){if(this.cache.size>this.maxCacheEntries){let e=1/0,r;this.cache.forEach((n,i)=>{n.lastUsed<e&&(e=n.lastUsed,r=i)}),r&&this.cache.delete(r)}}invalidate(e){return Ys(this,null,function*(){this.cache.delete(e.getKey())})}};jn(oV,"ResolvedValueCache");var t6=class{constructor(e=100,r=!0,n=N1){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=n}getHeader(e){return Ys(this,null,function*(){let r=e.getKey(),n=this.cache.get(r);if(n)return n.lastUsed=this.counter++,yield n.data;let i=new Promise((a,c)=>{IE(e,this.decompress).then(s=>{s[1]&&this.cache.set(s[1][0],{lastUsed:this.counter++,data:Promise.resolve(s[1][2])}),a(s[0]),this.prune()}).catch(s=>{c(s)})});return this.cache.set(r,{lastUsed:this.counter++,data:i}),i})}getDirectory(e,r,n,i){return Ys(this,null,function*(){let a=`${e.getKey()}|${i.etag||""}|${r}|${n}`,c=this.cache.get(a);if(c)return c.lastUsed=this.counter++,yield c.data;let s=new Promise((g,_)=>{RE(e,this.decompress,r,n,i).then(v=>{g(v),this.prune()}).catch(v=>{_(v)})});return this.cache.set(a,{lastUsed:this.counter++,data:s}),s})}prune(){if(this.cache.size>=this.maxCacheEntries){let e=1/0,r;this.cache.forEach((n,i)=>{n.lastUsed<e&&(e=n.lastUsed,r=i)}),r&&this.cache.delete(r)}}invalidate(e){return Ys(this,null,function*(){let r=e.getKey();if(this.invalidations.get(r))return yield this.invalidations.get(r);this.cache.delete(e.getKey());let n=new Promise((i,a)=>{this.getHeader(e).then(c=>{i(),this.invalidations.delete(r)}).catch(c=>{a(c)})});this.invalidations.set(r,n)})}};jn(t6,"SharedPromiseCache");var lV=t6,r6=class{constructor(e,r,n){typeof e=="string"?this.source=new aV(e):this.source=e,n?this.decompress=n:this.decompress=N1,r?this.cache=r:this.cache=new lV}getHeader(){return Ys(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(e,r,n,i){return Ys(this,null,function*(){let a=Z4(e,r,n),c=yield this.cache.getHeader(this.source);if(e<c.minZoom||e>c.maxZoom)return;let s=c.rootDirectoryOffset,g=c.rootDirectoryLength;for(let _=0;_<=3;_++){let v=yield this.cache.getDirectory(this.source,s,g,c),T=K4(v,a);if(T){if(T.runLength>0){let M=yield this.source.getBytes(c.tileDataOffset+T.offset,T.length,i,c.etag);return{data:yield this.decompress(M.data,c.tileCompression),cacheControl:M.cacheControl,expires:M.expires}}s=c.leafDirectoryOffset+T.offset,g=T.length}else return}throw new Error("Maximum directory depth exceeded")})}getZxy(e,r,n,i){return Ys(this,null,function*(){try{return yield this.getZxyAttempt(e,r,n,i)}catch(a){if(a instanceof SS)return this.cache.invalidate(this.source),yield this.getZxyAttempt(e,r,n,i);throw a}})}getMetadataAttempt(){return Ys(this,null,function*(){let e=yield this.cache.getHeader(this.source),r=yield this.source.getBytes(e.jsonMetadataOffset,e.jsonMetadataLength,void 0,e.etag),n=yield this.decompress(r.data,e.internalCompression),i=new TextDecoder("utf-8");return JSON.parse(i.decode(n))})}getMetadata(){return Ys(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(e){if(e instanceof SS)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw e}})}getTileJson(e){return Ys(this,null,function*(){let r=yield this.getHeader(),n=yield this.getMetadata(),i=Y4(r.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${e}/{z}/{x}/{y}${i}`],vector_layers:n.vector_layers,attribution:n.attribution,description:n.description,name:n.name,version:n.version,bounds:[r.minLon,r.minLat,r.maxLon,r.maxLat],center:[r.centerLon,r.centerLat,r.centerZoom],minzoom:r.minZoom,maxzoom:r.maxZoom}})}};jn(r6,"PMTiles");var KP=r6;function cV(){const t=Q.useRef(null),e=Q.useRef(null),r=Q.useRef(null),[n,i]=Q.useState(-10),[a,c]=Q.useState(!1),s=Q.useRef(null),g=Q.useRef(null),_=[{year:"2011",url:"https://dicratiler.blob.core.windows.net/dicra-dev/unfpa/Data/ghs_2010.tif"},{year:"2024",url:"https://dicratiler.blob.core.windows.net/dicra-dev/unfpa/Data/ghs_2025.tif"}],[v,T]=Q.useState(_[0].url),[M,O]=Q.useState(_[1].url),F="https://basemaps.cartocdn.com/gl/positron-nolabels-gl-style/style.json";return Q.useEffect(()=>{if(r.current){const V=r.current.getBoundingClientRect();i(V.width/2)}const j=()=>{if(r.current){const V=r.current.getBoundingClientRect();i(V.width/2)}};return window.addEventListener("resize",j),()=>window.removeEventListener("resize",j)},[]),Q.useEffect(()=>{gl.addProtocol("cog",z4);const j=new CE;return gl.addProtocol("pmtiles",j.tile),()=>gl.removeProtocol("pmtiles")},[]),Q.useEffect(()=>{const V=[84.90014,21.11117946909088];s.current=new gl.Map({container:t.current,style:F,center:V,zoom:8,minZoom:8}),s.current.on("load",()=>{s.current.addSource("leftNDVI",{type:"raster",url:`cog://${v}#color:["#6C2F2D","#6C2F2D"],0,8000,c`,tileSize:256}),s.current.addLayer({id:"ndvi-left",type:"raster",source:"leftNDVI",paint:{"raster-opacity":1}}),s.current.addSource("leftVector",{type:"vector",url:"pmtiles://https://dicratiler.blob.core.windows.net/dicra-dev/unfpa/Data/anugul_boundary.pmtiles"}),s.current.addLayer({id:"vector-outline-left",type:"line",source:"leftVector","source-layer":"zcta",paint:{"line-color":"black","line-width":1}})}),g.current=new gl.Map({container:e.current,style:F,center:V,zoom:8,minZoom:8}),g.current.on("load",()=>{g.current.addSource("rightNDVI",{type:"raster",url:`cog://${M}#color:["#6C2F2D","#6C2F2D"],0,8000,c`,tileSize:256}),g.current.addLayer({id:"ndvi-right",type:"raster",source:"rightNDVI",paint:{"raster-opacity":1}}),g.current.addSource("rightVector",{type:"vector",url:"pmtiles://https://dicratiler.blob.core.windows.net/dicra-dev/unfpa/Data/anugul_boundary.pmtiles"}),g.current.addLayer({id:"vector-outline-right",type:"line",source:"rightVector","source-layer":"zcta",paint:{"line-color":"black","line-width":1}})});let q=!1;const Y=(X,ae)=>{X.on("move",()=>{q||(q=!0,ae.jumpTo({center:X.getCenter(),zoom:X.getZoom(),bearing:X.getBearing(),pitch:X.getPitch()}),q=!1)})};return Y(s.current,g.current),Y(g.current,s.current),()=>{s.current.remove(),g.current.remove()}},[]),Q.useEffect(()=>{s.current&&s.current.getSource("leftNDVI")&&s.current.getSource("leftNDVI").setUrl(`cog://${v}#color:["#000000","#000000"],1,1,c`)},[v]),Q.useEffect(()=>{g.current&&g.current.getSource("rightNDVI")&&g.current.getSource("rightNDVI").setUrl(`cog://${M}#color:["#000000","#000000"],1,1,c`)},[M]),Q.useEffect(()=>{const j=q=>{if(!a)return;const Y=q.clientX||q.touches&&q.touches[0].clientX;if(!r.current)return;const X=r.current.getBoundingClientRect(),ae=Math.max(0,Math.min(X.width,Y-X.left));i(ae)},V=()=>c(!1);return window.addEventListener("mousemove",j),window.addEventListener("mouseup",V),window.addEventListener("touchmove",j),window.addEventListener("touchend",V),()=>{window.removeEventListener("mousemove",j),window.removeEventListener("mouseup",V),window.removeEventListener("touchmove",j),window.removeEventListener("touchend",V)}},[a]),Se.jsx("div",{className:"relative w-full rounded-lg",children:Se.jsxs("div",{ref:r,className:"relative w-full h-[600px] overflow-hidden select-none rounded-lg",children:[Se.jsx("div",{className:"absolute top-4 left-4 z-30 bg-white text-gray-800 px-3 py-1 rounded-md text-sm font-medium shadow",children:"2011"}),Se.jsx("div",{className:"absolute top-4 right-4 z-30 bg-white text-gray-800 px-3 py-1 rounded-md text-sm font-medium shadow",children:"2024"}),Se.jsx("div",{ref:t,className:"relative w-full h-[600px] overflow-hidden select-none"}),Se.jsx("div",{ref:e,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",clipPath:`inset(0 0 0 ${n}px)`,pointerEvents:"none",overflow:"hidden"}}),Se.jsx("div",{onMouseDown:()=>c(!0),onTouchStart:()=>c(!0),className:"absolute top-0 z-20 flex items-center justify-center w-0.5 h-full bg-sky-500 cursor-ew-resize",style:{left:`${n-.5}px`},children:Se.jsx("div",{className:"absolute w-6 h-6 rounded-full bg-sky-500 border-2 border-white shadow-lg flex items-center justify-center",children:Se.jsxs("span",{className:"text-white text-sm",children:["< ",""," >"]})})})]})})}function n6(t){var e,r,n="";if(typeof t=="string"||typeof t=="number")n+=t;else if(typeof t=="object")if(Array.isArray(t)){var i=t.length;for(e=0;e<i;e++)t[e]&&(r=n6(t[e]))&&(n&&(n+=" "),n+=r)}else for(r in t)t[r]&&(n&&(n+=" "),n+=r);return n}function gi(){for(var t,e,r=0,n="",i=arguments.length;r<i;r++)(t=arguments[r])&&(e=n6(t))&&(n&&(n+=" "),n+=e);return n}var i2={},s2={},QP;function uV(){return QP||(QP=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){return r==="__proto__"}t.isUnsafeProperty=e})(s2)),s2}var a2={},JP;function i6(){return JP||(JP=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){switch(typeof r){case"number":case"symbol":return!1;case"string":return r.includes(".")||r.includes("[")||r.includes("]")}}t.isDeepKey=e})(a2)),a2}var o2={},eM;function OE(){return eM||(eM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){return typeof r=="string"||typeof r=="symbol"?r:Object.is(r?.valueOf?.(),-0)?"-0":String(r)}t.toKey=e})(o2)),o2}var l2={},c2={},tM;function hV(){return tM||(tM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){if(r==null)return"";if(typeof r=="string")return r;if(Array.isArray(r))return r.map(e).join(",");const n=String(r);return n==="0"&&Object.is(Number(r),-0)?"-0":n}t.toString=e})(c2)),c2}var rM;function kE(){return rM||(rM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=hV(),r=OE();function n(i){if(Array.isArray(i))return i.map(r.toKey);if(typeof i=="symbol")return[i];i=e.toString(i);const a=[],c=i.length;if(c===0)return a;let s=0,g="",_="",v=!1;for(i.charCodeAt(0)===46&&(a.push(""),s++);s<c;){const T=i[s];_?T==="\\"&&s+1<c?(s++,g+=i[s]):T===_?_="":g+=T:v?T==='"'||T==="'"?_=T:T==="]"?(v=!1,a.push(g),g=""):g+=T:T==="["?(v=!0,g&&(a.push(g),g="")):T==="."?g&&(a.push(g),g=""):g+=T,s++}return g&&a.push(g),a}t.toPath=n})(l2)),l2}var nM;function DE(){return nM||(nM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=uV(),r=i6(),n=OE(),i=kE();function a(s,g,_){if(s==null)return _;switch(typeof g){case"string":{if(e.isUnsafeProperty(g))return _;const v=s[g];return v===void 0?r.isDeepKey(g)?a(s,i.toPath(g),_):_:v}case"number":case"symbol":{typeof g=="number"&&(g=n.toKey(g));const v=s[g];return v===void 0?_:v}default:{if(Array.isArray(g))return c(s,g,_);if(Object.is(g?.valueOf(),-0)?g="-0":g=String(g),e.isUnsafeProperty(g))return _;const v=s[g];return v===void 0?_:v}}}function c(s,g,_){if(g.length===0)return _;let v=s;for(let T=0;T<g.length;T++){if(v==null||e.isUnsafeProperty(g[T]))return _;v=v[g[T]]}return v===void 0?_:v}t.get=a})(i2)),i2}var u2,iM;function fV(){return iM||(iM=1,u2=DE().get),u2}var dV=fV();const z1=xl(dV);var lc=t=>t===0?0:t>0?1:-1,pc=t=>typeof t=="number"&&t!=+t,lg=t=>typeof t=="string"&&t.indexOf("%")===t.length-1,kr=t=>(typeof t=="number"||t instanceof Number)&&!pc(t),ah=t=>kr(t)||typeof t=="string",pV=0,jv=t=>{var e=++pV;return"".concat(t||"").concat(e)},Fd=function(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!kr(e)&&typeof e!="string")return n;var a;if(lg(e)){if(r==null)return n;var c=e.indexOf("%");a=r*parseFloat(e.slice(0,c))/100}else a=+e;return pc(a)&&(a=n),i&&r!=null&&a>r&&(a=r),a},s6=t=>{if(!Array.isArray(t))return!1;for(var e=t.length,r={},n=0;n<e;n++)if(!r[t[n]])r[t[n]]=!0;else return!0;return!1};function af(t,e,r){return kr(t)&&kr(e)?t+r*(e-t):e}function a6(t,e,r){if(!(!t||!t.length))return t.find(n=>n&&(typeof e=="function"?e(n):z1(n,e))===r)}var Ks=t=>t===null||typeof t>"u",LE=t=>Ks(t)?t:"".concat(t.charAt(0).toUpperCase()).concat(t.slice(1)),gV=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"];function BE(t){if(typeof t!="string")return!1;var e=gV;return e.includes(t)}var mV=["viewBox","children"],sM=["points","pathLength"],h2={svg:mV,polygon:sM,polyline:sM},NE=(t,e)=>{if(!t||typeof t=="function"||typeof t=="boolean")return null;var r=t;if(Q.isValidElement(t)&&(r=t.props),typeof r!="object"&&typeof r!="function")return null;var n={};return Object.keys(r).forEach(i=>{BE(i)&&(n[i]=(a=>r[i](r,a)))}),n},yV=(t,e,r)=>n=>(t(e,r,n),null),_V=(t,e,r)=>{if(t===null||typeof t!="object"&&typeof t!="function")return null;var n=null;return Object.keys(t).forEach(i=>{var a=t[i];BE(i)&&typeof a=="function"&&(n||(n={}),n[i]=yV(a,e,r))}),n},vV=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"];function o6(t){if(typeof t!="string")return!1;var e=vV;return e.includes(t)}function Bg(t){var e=Object.entries(t).filter(r=>{var[n]=r;return o6(n)});return Object.fromEntries(e)}var l6=t=>t&&typeof t=="object"&&"clipDot"in t?!!t.clipDot:!0,bV=(t,e,r,n)=>{var i;if(typeof e=="symbol"||typeof e=="number")return!0;var a=(i=n&&h2?.[n])!==null&&i!==void 0?i:[],c=e.startsWith("data-"),s=typeof t!="function"&&(!!n&&a.includes(e)||o6(e)),g=!!r&&BE(e);return c||s||g},ha=(t,e,r)=>{if(!t||typeof t=="function"||typeof t=="boolean")return null;var n=t;if(Q.isValidElement(t)&&(n=t.props),typeof n!="object"&&typeof n!="function")return null;var i={};return Object.keys(n).forEach(a=>{var c;bV((c=n)===null||c===void 0?void 0:c[a],a,e,r)&&(i[a]=n[a])}),i},xV=["children","width","height","viewBox","className","style","title","desc"];function AS(){return AS=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},AS.apply(null,arguments)}function wV(t,e){if(t==null)return{};var r,n,i=TV(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)r=a[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function TV(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}var c6=Q.forwardRef((t,e)=>{var{children:r,width:n,height:i,viewBox:a,className:c,style:s,title:g,desc:_}=t,v=wV(t,xV),T=a||{width:n,height:i,x:0,y:0},M=gi("recharts-surface",c);return Q.createElement("svg",AS({},ha(v,!0,"svg"),{className:M,width:n,height:i,style:s,viewBox:"".concat(T.x," ").concat(T.y," ").concat(T.width," ").concat(T.height),ref:e}),Q.createElement("title",null,g),Q.createElement("desc",null,_),r)}),SV=["children","className"];function ES(){return ES=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},ES.apply(null,arguments)}function AV(t,e){if(t==null)return{};var r,n,i=EV(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)r=a[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function EV(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}var Ny=Q.forwardRef((t,e)=>{var{children:r,className:n}=t,i=AV(t,SV),a=gi("recharts-layer",n);return Q.createElement("g",ES({className:a},ha(i,!0),{ref:e}),r)}),zE=zD(),CV=Q.createContext(null);function Xi(t){return function(){return t}}const CS=Math.PI,PS=2*CS,rg=1e-6,PV=PS-rg;function u6(t){this._+=t[0];for(let e=1,r=t.length;e<r;++e)this._+=arguments[e]+t[e]}function MV(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return u6;const r=10**e;return function(n){this._+=n[0];for(let i=1,a=n.length;i<a;++i)this._+=Math.round(arguments[i]*r)/r+n[i]}}class IV{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?u6:MV(e)}moveTo(e,r){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,r){this._append`L${this._x1=+e},${this._y1=+r}`}quadraticCurveTo(e,r,n,i){this._append`Q${+e},${+r},${this._x1=+n},${this._y1=+i}`}bezierCurveTo(e,r,n,i,a,c){this._append`C${+e},${+r},${+n},${+i},${this._x1=+a},${this._y1=+c}`}arcTo(e,r,n,i,a){if(e=+e,r=+r,n=+n,i=+i,a=+a,a<0)throw new Error(`negative radius: ${a}`);let c=this._x1,s=this._y1,g=n-e,_=i-r,v=c-e,T=s-r,M=v*v+T*T;if(this._x1===null)this._append`M${this._x1=e},${this._y1=r}`;else if(M>rg)if(!(Math.abs(T*g-_*v)>rg)||!a)this._append`L${this._x1=e},${this._y1=r}`;else{let O=n-c,F=i-s,j=g*g+_*_,V=O*O+F*F,q=Math.sqrt(j),Y=Math.sqrt(M),X=a*Math.tan((CS-Math.acos((j+M-V)/(2*q*Y)))/2),ae=X/Y,ue=X/q;Math.abs(ae-1)>rg&&this._append`L${e+ae*v},${r+ae*T}`,this._append`A${a},${a},0,0,${+(T*O>v*F)},${this._x1=e+ue*g},${this._y1=r+ue*_}`}}arc(e,r,n,i,a,c){if(e=+e,r=+r,n=+n,c=!!c,n<0)throw new Error(`negative radius: ${n}`);let s=n*Math.cos(i),g=n*Math.sin(i),_=e+s,v=r+g,T=1^c,M=c?i-a:a-i;this._x1===null?this._append`M${_},${v}`:(Math.abs(this._x1-_)>rg||Math.abs(this._y1-v)>rg)&&this._append`L${_},${v}`,n&&(M<0&&(M=M%PS+PS),M>PV?this._append`A${n},${n},0,1,${T},${e-s},${r-g}A${n},${n},0,1,${T},${this._x1=_},${this._y1=v}`:M>rg&&this._append`A${n},${n},0,${+(M>=CS)},${T},${this._x1=e+n*Math.cos(a)},${this._y1=r+n*Math.sin(a)}`)}rect(e,r,n,i){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+r}h${n=+n}v${+i}h${-n}Z`}toString(){return this._}}function h6(t){let e=3;return t.digits=function(r){if(!arguments.length)return e;if(r==null)e=null;else{const n=Math.floor(r);if(!(n>=0))throw new RangeError(`invalid digits: ${r}`);e=n}return t},()=>new IV(e)}function FE(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function f6(t){this._context=t}f6.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e);break}}};function F1(t){return new f6(t)}function d6(t){return t[0]}function p6(t){return t[1]}function g6(t,e){var r=Xi(!0),n=null,i=F1,a=null,c=h6(s);t=typeof t=="function"?t:t===void 0?d6:Xi(t),e=typeof e=="function"?e:e===void 0?p6:Xi(e);function s(g){var _,v=(g=FE(g)).length,T,M=!1,O;for(n==null&&(a=i(O=c())),_=0;_<=v;++_)!(_<v&&r(T=g[_],_,g))===M&&((M=!M)?a.lineStart():a.lineEnd()),M&&a.point(+t(T,_,g),+e(T,_,g));if(O)return a=null,O+""||null}return s.x=function(g){return arguments.length?(t=typeof g=="function"?g:Xi(+g),s):t},s.y=function(g){return arguments.length?(e=typeof g=="function"?g:Xi(+g),s):e},s.defined=function(g){return arguments.length?(r=typeof g=="function"?g:Xi(!!g),s):r},s.curve=function(g){return arguments.length?(i=g,n!=null&&(a=i(n)),s):i},s.context=function(g){return arguments.length?(g==null?n=a=null:a=i(n=g),s):n},s}function Eb(t,e,r){var n=null,i=Xi(!0),a=null,c=F1,s=null,g=h6(_);t=typeof t=="function"?t:t===void 0?d6:Xi(+t),e=typeof e=="function"?e:Xi(e===void 0?0:+e),r=typeof r=="function"?r:r===void 0?p6:Xi(+r);function _(T){var M,O,F,j=(T=FE(T)).length,V,q=!1,Y,X=new Array(j),ae=new Array(j);for(a==null&&(s=c(Y=g())),M=0;M<=j;++M){if(!(M<j&&i(V=T[M],M,T))===q)if(q=!q)O=M,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),F=M-1;F>=O;--F)s.point(X[F],ae[F]);s.lineEnd(),s.areaEnd()}q&&(X[M]=+t(V,M,T),ae[M]=+e(V,M,T),s.point(n?+n(V,M,T):X[M],r?+r(V,M,T):ae[M]))}if(Y)return s=null,Y+""||null}function v(){return g6().defined(i).curve(c).context(a)}return _.x=function(T){return arguments.length?(t=typeof T=="function"?T:Xi(+T),n=null,_):t},_.x0=function(T){return arguments.length?(t=typeof T=="function"?T:Xi(+T),_):t},_.x1=function(T){return arguments.length?(n=T==null?null:typeof T=="function"?T:Xi(+T),_):n},_.y=function(T){return arguments.length?(e=typeof T=="function"?T:Xi(+T),r=null,_):e},_.y0=function(T){return arguments.length?(e=typeof T=="function"?T:Xi(+T),_):e},_.y1=function(T){return arguments.length?(r=T==null?null:typeof T=="function"?T:Xi(+T),_):r},_.lineX0=_.lineY0=function(){return v().x(t).y(e)},_.lineY1=function(){return v().x(t).y(r)},_.lineX1=function(){return v().x(n).y(e)},_.defined=function(T){return arguments.length?(i=typeof T=="function"?T:Xi(!!T),_):i},_.curve=function(T){return arguments.length?(c=T,a!=null&&(s=c(a)),_):c},_.context=function(T){return arguments.length?(T==null?a=s=null:s=c(a=T),_):a},_}class m6{constructor(e,r){this._context=e,this._x=r}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(e,r){switch(e=+e,r=+r,this._point){case 0:{this._point=1,this._line?this._context.lineTo(e,r):this._context.moveTo(e,r);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+e)/2,this._y0,this._x0,r,e,r):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+r)/2,e,this._y0,e,r);break}}this._x0=e,this._y0=r}}function RV(t){return new m6(t,!0)}function OV(t){return new m6(t,!1)}function Rx(){}function Ox(t,e,r){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+r)/6)}function y6(t){this._context=t}y6.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:Ox(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:Ox(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function kV(t){return new y6(t)}function _6(t){this._context=t}_6.prototype={areaStart:Rx,areaEnd:Rx,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x2=t,this._y2=e;break;case 1:this._point=2,this._x3=t,this._y3=e;break;case 2:this._point=3,this._x4=t,this._y4=e,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+e)/6);break;default:Ox(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function DV(t){return new _6(t)}function v6(t){this._context=t}v6.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var r=(this._x0+4*this._x1+t)/6,n=(this._y0+4*this._y1+e)/6;this._line?this._context.lineTo(r,n):this._context.moveTo(r,n);break;case 3:this._point=4;default:Ox(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function LV(t){return new v6(t)}function b6(t){this._context=t}b6.prototype={areaStart:Rx,areaEnd:Rx,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,e){t=+t,e=+e,this._point?this._context.lineTo(t,e):(this._point=1,this._context.moveTo(t,e))}};function BV(t){return new b6(t)}function aM(t){return t<0?-1:1}function oM(t,e,r){var n=t._x1-t._x0,i=e-t._x1,a=(t._y1-t._y0)/(n||i<0&&-0),c=(r-t._y1)/(i||n<0&&-0),s=(a*i+c*n)/(n+i);return(aM(a)+aM(c))*Math.min(Math.abs(a),Math.abs(c),.5*Math.abs(s))||0}function lM(t,e){var r=t._x1-t._x0;return r?(3*(t._y1-t._y0)/r-e)/2:e}function f2(t,e,r){var n=t._x0,i=t._y0,a=t._x1,c=t._y1,s=(a-n)/3;t._context.bezierCurveTo(n+s,i+s*e,a-s,c-s*r,a,c)}function kx(t){this._context=t}kx.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:f2(this,this._t0,lM(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var r=NaN;if(t=+t,e=+e,!(t===this._x1&&e===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,f2(this,lM(this,r=oM(this,t,e)),r);break;default:f2(this,this._t0,r=oM(this,t,e));break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=r}}};function x6(t){this._context=new w6(t)}(x6.prototype=Object.create(kx.prototype)).point=function(t,e){kx.prototype.point.call(this,e,t)};function w6(t){this._context=t}w6.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,r,n,i,a){this._context.bezierCurveTo(e,t,n,r,a,i)}};function NV(t){return new kx(t)}function zV(t){return new x6(t)}function T6(t){this._context=t}T6.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,e=this._y,r=t.length;if(r)if(this._line?this._context.lineTo(t[0],e[0]):this._context.moveTo(t[0],e[0]),r===2)this._context.lineTo(t[1],e[1]);else for(var n=cM(t),i=cM(e),a=0,c=1;c<r;++a,++c)this._context.bezierCurveTo(n[0][a],i[0][a],n[1][a],i[1][a],t[c],e[c]);(this._line||this._line!==0&&r===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,e){this._x.push(+t),this._y.push(+e)}};function cM(t){var e,r=t.length-1,n,i=new Array(r),a=new Array(r),c=new Array(r);for(i[0]=0,a[0]=2,c[0]=t[0]+2*t[1],e=1;e<r-1;++e)i[e]=1,a[e]=4,c[e]=4*t[e]+2*t[e+1];for(i[r-1]=2,a[r-1]=7,c[r-1]=8*t[r-1]+t[r],e=1;e<r;++e)n=i[e]/a[e-1],a[e]-=n,c[e]-=n*c[e-1];for(i[r-1]=c[r-1]/a[r-1],e=r-2;e>=0;--e)i[e]=(c[e]-i[e+1])/a[e];for(a[r-1]=(t[r]+i[r-1])/2,e=0;e<r-1;++e)a[e]=2*t[e+1]-i[e+1];return[i,a]}function FV(t){return new T6(t)}function U1(t,e){this._context=t,this._t=e}U1.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,e),this._context.lineTo(t,e);else{var r=this._x*(1-this._t)+t*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,e)}break}}this._x=t,this._y=e}};function UV(t){return new U1(t,.5)}function jV(t){return new U1(t,0)}function VV(t){return new U1(t,1)}function yy(t,e){if((c=t.length)>1)for(var r=1,n,i,a=t[e[0]],c,s=a.length;r<c;++r)for(i=a,a=t[e[r]],n=0;n<s;++n)a[n][1]+=a[n][0]=isNaN(i[n][1])?i[n][0]:i[n][1]}function MS(t){for(var e=t.length,r=new Array(e);--e>=0;)r[e]=e;return r}function $V(t,e){return t[e]}function HV(t){const e=[];return e.key=t,e}function WV(){var t=Xi([]),e=MS,r=yy,n=$V;function i(a){var c=Array.from(t.apply(this,arguments),HV),s,g=c.length,_=-1,v;for(const T of a)for(s=0,++_;s<g;++s)(c[s][_]=[0,+n(T,c[s].key,_,a)]).data=T;for(s=0,v=FE(e(c));s<g;++s)c[v[s]].index=s;return r(c,v),c}return i.keys=function(a){return arguments.length?(t=typeof a=="function"?a:Xi(Array.from(a)),i):t},i.value=function(a){return arguments.length?(n=typeof a=="function"?a:Xi(+a),i):n},i.order=function(a){return arguments.length?(e=a==null?MS:typeof a=="function"?a:Xi(Array.from(a)),i):e},i.offset=function(a){return arguments.length?(r=a??yy,i):r},i}function qV(t,e){if((n=t.length)>0){for(var r,n,i=0,a=t[0].length,c;i<a;++i){for(c=r=0;r<n;++r)c+=t[r][i][1]||0;if(c)for(r=0;r<n;++r)t[r][i][1]/=c}yy(t,e)}}function GV(t,e){if((i=t.length)>0){for(var r=0,n=t[e[0]],i,a=n.length;r<a;++r){for(var c=0,s=0;c<i;++c)s+=t[c][r][1]||0;n[r][1]+=n[r][0]=-s/2}yy(t,e)}}function XV(t,e){if(!(!((c=t.length)>0)||!((a=(i=t[e[0]]).length)>0))){for(var r=0,n=1,i,a,c;n<a;++n){for(var s=0,g=0,_=0;s<c;++s){for(var v=t[e[s]],T=v[n][1]||0,M=v[n-1][1]||0,O=(T-M)/2,F=0;F<s;++F){var j=t[e[F]],V=j[n][1]||0,q=j[n-1][1]||0;O+=V-q}g+=T,_+=O*T}i[n-1][1]+=i[n-1][0]=r,g&&(r-=_/g)}i[n-1][1]+=i[n-1][0]=r,yy(t,e)}}var d2={},p2={},uM;function ZV(){return uM||(uM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r,n){const i=new Map;for(let a=0;a<r.length;a++){const c=r[a],s=n(c);i.has(s)||i.set(s,c)}return Array.from(i.values())}t.uniqBy=e})(p2)),p2}var g2={},hM;function S6(){return hM||(hM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){return r}t.identity=e})(g2)),g2}var m2={},y2={},_2={},fM;function YV(){return fM||(fM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){return Number.isSafeInteger(r)&&r>=0}t.isLength=e})(_2)),_2}var dM;function UE(){return dM||(dM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=YV();function r(n){return n!=null&&typeof n!="function"&&e.isLength(n.length)}t.isArrayLike=r})(y2)),y2}var v2={},pM;function KV(){return pM||(pM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){return typeof r=="object"&&r!==null}t.isObjectLike=e})(v2)),v2}var gM;function QV(){return gM||(gM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=UE(),r=KV();function n(i){return r.isObjectLike(i)&&e.isArrayLike(i)}t.isArrayLikeObject=n})(m2)),m2}var b2={},x2={},mM;function JV(){return mM||(mM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=DE();function r(n){return function(i){return e.get(i,n)}}t.property=r})(x2)),x2}var w2={},T2={},S2={},A2={},yM;function A6(){return yM||(yM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){return r!==null&&(typeof r=="object"||typeof r=="function")}t.isObject=e})(A2)),A2}var E2={},_M;function E6(){return _M||(_M=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){return r==null||typeof r!="object"&&typeof r!="function"}t.isPrimitive=e})(E2)),E2}var C2={},vM;function C6(){return vM||(vM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r,n){return r===n||Number.isNaN(r)&&Number.isNaN(n)}t.eq=e})(C2)),C2}var bM;function e$(){return bM||(bM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=jE(),r=A6(),n=E6(),i=C6();function a(T,M,O){return typeof O!="function"?e.isMatch(T,M):c(T,M,function F(j,V,q,Y,X,ae){const ue=O(j,V,q,Y,X,ae);return ue!==void 0?!!ue:c(j,V,F,ae)},new Map)}function c(T,M,O,F){if(M===T)return!0;switch(typeof M){case"object":return s(T,M,O,F);case"function":return Object.keys(M).length>0?c(T,{...M},O,F):i.eq(T,M);default:return r.isObject(T)?typeof M=="string"?M==="":!0:i.eq(T,M)}}function s(T,M,O,F){if(M==null)return!0;if(Array.isArray(M))return _(T,M,O,F);if(M instanceof Map)return g(T,M,O,F);if(M instanceof Set)return v(T,M,O,F);const j=Object.keys(M);if(T==null)return j.length===0;if(j.length===0)return!0;if(F&&F.has(M))return F.get(M)===T;F&&F.set(M,T);try{for(let V=0;V<j.length;V++){const q=j[V];if(!n.isPrimitive(T)&&!(q in T)||M[q]===void 0&&T[q]!==void 0||M[q]===null&&T[q]!==null||!O(T[q],M[q],q,T,M,F))return!1}return!0}finally{F&&F.delete(M)}}function g(T,M,O,F){if(M.size===0)return!0;if(!(T instanceof Map))return!1;for(const[j,V]of M.entries()){const q=T.get(j);if(O(q,V,j,T,M,F)===!1)return!1}return!0}function _(T,M,O,F){if(M.length===0)return!0;if(!Array.isArray(T))return!1;const j=new Set;for(let V=0;V<M.length;V++){const q=M[V];let Y=!1;for(let X=0;X<T.length;X++){if(j.has(X))continue;const ae=T[X];let ue=!1;if(O(ae,q,V,T,M,F)&&(ue=!0),ue){j.add(X),Y=!0;break}}if(!Y)return!1}return!0}function v(T,M,O,F){return M.size===0?!0:T instanceof Set?_([...T],[...M],O,F):!1}t.isMatchWith=a,t.isSetMatch=v})(S2)),S2}var xM;function jE(){return xM||(xM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=e$();function r(n,i){return e.isMatchWith(n,i,()=>{})}t.isMatch=r})(T2)),T2}var P2={},M2={},I2={},wM;function t$(){return wM||(wM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){return Object.getOwnPropertySymbols(r).filter(n=>Object.prototype.propertyIsEnumerable.call(r,n))}t.getSymbols=e})(I2)),I2}var R2={},TM;function P6(){return TM||(TM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){return r==null?r===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(r)}t.getTag=e})(R2)),R2}var O2={},SM;function M6(){return SM||(SM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e="[object RegExp]",r="[object String]",n="[object Number]",i="[object Boolean]",a="[object Arguments]",c="[object Symbol]",s="[object Date]",g="[object Map]",_="[object Set]",v="[object Array]",T="[object Function]",M="[object ArrayBuffer]",O="[object Object]",F="[object Error]",j="[object DataView]",V="[object Uint8Array]",q="[object Uint8ClampedArray]",Y="[object Uint16Array]",X="[object Uint32Array]",ae="[object BigUint64Array]",ue="[object Int8Array]",ge="[object Int16Array]",Le="[object Int32Array]",qe="[object BigInt64Array]",Ze="[object Float32Array]",_t="[object Float64Array]";t.argumentsTag=a,t.arrayBufferTag=M,t.arrayTag=v,t.bigInt64ArrayTag=qe,t.bigUint64ArrayTag=ae,t.booleanTag=i,t.dataViewTag=j,t.dateTag=s,t.errorTag=F,t.float32ArrayTag=Ze,t.float64ArrayTag=_t,t.functionTag=T,t.int16ArrayTag=ge,t.int32ArrayTag=Le,t.int8ArrayTag=ue,t.mapTag=g,t.numberTag=n,t.objectTag=O,t.regexpTag=e,t.setTag=_,t.stringTag=r,t.symbolTag=c,t.uint16ArrayTag=Y,t.uint32ArrayTag=X,t.uint8ArrayTag=V,t.uint8ClampedArrayTag=q})(O2)),O2}var k2={},AM;function r$(){return AM||(AM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}t.isTypedArray=e})(k2)),k2}var EM;function I6(){return EM||(EM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=t$(),r=P6(),n=M6(),i=E6(),a=r$();function c(v,T){return s(v,void 0,v,new Map,T)}function s(v,T,M,O=new Map,F=void 0){const j=F?.(v,T,M,O);if(j!==void 0)return j;if(i.isPrimitive(v))return v;if(O.has(v))return O.get(v);if(Array.isArray(v)){const V=new Array(v.length);O.set(v,V);for(let q=0;q<v.length;q++)V[q]=s(v[q],q,M,O,F);return Object.hasOwn(v,"index")&&(V.index=v.index),Object.hasOwn(v,"input")&&(V.input=v.input),V}if(v instanceof Date)return new Date(v.getTime());if(v instanceof RegExp){const V=new RegExp(v.source,v.flags);return V.lastIndex=v.lastIndex,V}if(v instanceof Map){const V=new Map;O.set(v,V);for(const[q,Y]of v)V.set(q,s(Y,q,M,O,F));return V}if(v instanceof Set){const V=new Set;O.set(v,V);for(const q of v)V.add(s(q,void 0,M,O,F));return V}if(typeof Buffer<"u"&&Buffer.isBuffer(v))return v.subarray();if(a.isTypedArray(v)){const V=new(Object.getPrototypeOf(v)).constructor(v.length);O.set(v,V);for(let q=0;q<v.length;q++)V[q]=s(v[q],q,M,O,F);return V}if(v instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&v instanceof SharedArrayBuffer)return v.slice(0);if(v instanceof DataView){const V=new DataView(v.buffer.slice(0),v.byteOffset,v.byteLength);return O.set(v,V),g(V,v,M,O,F),V}if(typeof File<"u"&&v instanceof File){const V=new File([v],v.name,{type:v.type});return O.set(v,V),g(V,v,M,O,F),V}if(typeof Blob<"u"&&v instanceof Blob){const V=new Blob([v],{type:v.type});return O.set(v,V),g(V,v,M,O,F),V}if(v instanceof Error){const V=new v.constructor;return O.set(v,V),V.message=v.message,V.name=v.name,V.stack=v.stack,V.cause=v.cause,g(V,v,M,O,F),V}if(v instanceof Boolean){const V=new Boolean(v.valueOf());return O.set(v,V),g(V,v,M,O,F),V}if(v instanceof Number){const V=new Number(v.valueOf());return O.set(v,V),g(V,v,M,O,F),V}if(v instanceof String){const V=new String(v.valueOf());return O.set(v,V),g(V,v,M,O,F),V}if(typeof v=="object"&&_(v)){const V=Object.create(Object.getPrototypeOf(v));return O.set(v,V),g(V,v,M,O,F),V}return v}function g(v,T,M=v,O,F){const j=[...Object.keys(T),...e.getSymbols(T)];for(let V=0;V<j.length;V++){const q=j[V],Y=Object.getOwnPropertyDescriptor(v,q);(Y==null||Y.writable)&&(v[q]=s(T[q],q,M,O,F))}}function _(v){switch(r.getTag(v)){case n.argumentsTag:case n.arrayTag:case n.arrayBufferTag:case n.dataViewTag:case n.booleanTag:case n.dateTag:case n.float32ArrayTag:case n.float64ArrayTag:case n.int8ArrayTag:case n.int16ArrayTag:case n.int32ArrayTag:case n.mapTag:case n.numberTag:case n.objectTag:case n.regexpTag:case n.setTag:case n.stringTag:case n.symbolTag:case n.uint8ArrayTag:case n.uint8ClampedArrayTag:case n.uint16ArrayTag:case n.uint32ArrayTag:return!0;default:return!1}}t.cloneDeepWith=c,t.cloneDeepWithImpl=s,t.copyProperties=g})(M2)),M2}var CM;function n$(){return CM||(CM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=I6();function r(n){return e.cloneDeepWithImpl(n,void 0,n,new Map,void 0)}t.cloneDeep=r})(P2)),P2}var PM;function i$(){return PM||(PM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=jE(),r=n$();function n(i){return i=r.cloneDeep(i),a=>e.isMatch(a,i)}t.matches=n})(w2)),w2}var D2={},L2={},B2={},MM;function s$(){return MM||(MM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=I6(),r=M6();function n(i,a){return e.cloneDeepWith(i,(c,s,g,_)=>{const v=a?.(c,s,g,_);if(v!==void 0)return v;if(typeof i=="object")switch(Object.prototype.toString.call(i)){case r.numberTag:case r.stringTag:case r.booleanTag:{const T=new i.constructor(i?.valueOf());return e.copyProperties(T,i),T}case r.argumentsTag:{const T={};return e.copyProperties(T,i),T.length=i.length,T[Symbol.iterator]=i[Symbol.iterator],T}default:return}})}t.cloneDeepWith=n})(B2)),B2}var IM;function a$(){return IM||(IM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=s$();function r(n){return e.cloneDeepWith(n)}t.cloneDeep=r})(L2)),L2}var N2={},z2={},RM;function R6(){return RM||(RM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=/^(?:0|[1-9]\d*)$/;function r(n,i=Number.MAX_SAFE_INTEGER){switch(typeof n){case"number":return Number.isInteger(n)&&n>=0&&n<i;case"symbol":return!1;case"string":return e.test(n)}}t.isIndex=r})(z2)),z2}var F2={},OM;function o$(){return OM||(OM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=P6();function r(n){return n!==null&&typeof n=="object"&&e.getTag(n)==="[object Arguments]"}t.isArguments=r})(F2)),F2}var kM;function l$(){return kM||(kM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=i6(),r=R6(),n=o$(),i=kE();function a(c,s){let g;if(Array.isArray(s)?g=s:typeof s=="string"&&e.isDeepKey(s)&&c?.[s]==null?g=i.toPath(s):g=[s],g.length===0)return!1;let _=c;for(let v=0;v<g.length;v++){const T=g[v];if((_==null||!Object.hasOwn(_,T))&&!((Array.isArray(_)||n.isArguments(_))&&r.isIndex(T)&&T<_.length))return!1;_=_[T]}return!0}t.has=a})(N2)),N2}var DM;function c$(){return DM||(DM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=jE(),r=OE(),n=a$(),i=DE(),a=l$();function c(s,g){switch(typeof s){case"object":{Object.is(s?.valueOf(),-0)&&(s="-0");break}case"number":{s=r.toKey(s);break}}return g=n.cloneDeep(g),function(_){const v=i.get(_,s);return v===void 0?a.has(_,s):g===void 0?v===void 0:e.isMatch(v,g)}}t.matchesProperty=c})(D2)),D2}var LM;function u$(){return LM||(LM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=S6(),r=JV(),n=i$(),i=c$();function a(c){if(c==null)return e.identity;switch(typeof c){case"function":return c;case"object":return Array.isArray(c)&&c.length===2?i.matchesProperty(c[0],c[1]):n.matches(c);case"string":case"symbol":case"number":return r.property(c)}}t.iteratee=a})(b2)),b2}var BM;function h$(){return BM||(BM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=ZV(),r=S6(),n=QV(),i=u$();function a(c,s=r.identity){return n.isArrayLikeObject(c)?e.uniqBy(Array.from(c),i.iteratee(s)):[]}t.uniqBy=a})(d2)),d2}var U2,NM;function f$(){return NM||(NM=1,U2=h$().uniqBy),U2}var d$=f$();const zM=xl(d$);function p$(t,e,r){return e===!0?zM(t,r):typeof e=="function"?zM(t,e):t}var j2={exports:{}},V2={},$2={exports:{}},H2={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var FM;function g$(){if(FM)return H2;FM=1;var t=ky();function e(T,M){return T===M&&(T!==0||1/T===1/M)||T!==T&&M!==M}var r=typeof Object.is=="function"?Object.is:e,n=t.useState,i=t.useEffect,a=t.useLayoutEffect,c=t.useDebugValue;function s(T,M){var O=M(),F=n({inst:{value:O,getSnapshot:M}}),j=F[0].inst,V=F[1];return a(function(){j.value=O,j.getSnapshot=M,g(j)&&V({inst:j})},[T,O,M]),i(function(){return g(j)&&V({inst:j}),T(function(){g(j)&&V({inst:j})})},[T]),c(O),O}function g(T){var M=T.getSnapshot;T=T.value;try{var O=M();return!r(T,O)}catch{return!0}}function _(T,M){return M()}var v=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?_:s;return H2.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:v,H2}var UM;function m$(){return UM||(UM=1,$2.exports=g$()),$2.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jM;function y$(){if(jM)return V2;jM=1;var t=ky(),e=m$();function r(_,v){return _===v&&(_!==0||1/_===1/v)||_!==_&&v!==v}var n=typeof Object.is=="function"?Object.is:r,i=e.useSyncExternalStore,a=t.useRef,c=t.useEffect,s=t.useMemo,g=t.useDebugValue;return V2.useSyncExternalStoreWithSelector=function(_,v,T,M,O){var F=a(null);if(F.current===null){var j={hasValue:!1,value:null};F.current=j}else j=F.current;F=s(function(){function q(ge){if(!Y){if(Y=!0,X=ge,ge=M(ge),O!==void 0&&j.hasValue){var Le=j.value;if(O(Le,ge))return ae=Le}return ae=ge}if(Le=ae,n(X,ge))return Le;var qe=M(ge);return O!==void 0&&O(Le,qe)?(X=ge,Le):(X=ge,ae=qe)}var Y=!1,X,ae,ue=T===void 0?null:T;return[function(){return q(v())},ue===null?void 0:function(){return q(ue())}]},[v,T,M,O]);var V=i(_,F[0],F[1]);return c(function(){j.hasValue=!0,j.value=V},[V]),g(V),V},V2}var VM;function _$(){return VM||(VM=1,j2.exports=y$()),j2.exports}var v$=_$(),VE=Q.createContext(null),b$=t=>t,Za=()=>{var t=Q.useContext(VE);return t?t.store.dispatch:b$},ax=()=>{},x$=()=>ax,w$=(t,e)=>t===e;function br(t){var e=Q.useContext(VE);return v$.useSyncExternalStoreWithSelector(e?e.subscription.addNestedSub:x$,e?e.store.getState:ax,e?e.store.getState:ax,e?t:ax,w$)}function T$(t,e=`expected a function, instead received ${typeof t}`){if(typeof t!="function")throw new TypeError(e)}function S$(t,e=`expected an object, instead received ${typeof t}`){if(typeof t!="object")throw new TypeError(e)}function A$(t,e="expected all items to be functions, instead received the following types: "){if(!t.every(r=>typeof r=="function")){const r=t.map(n=>typeof n=="function"?`function ${n.name||"unnamed"}()`:typeof n).join(", ");throw new TypeError(`${e}[${r}]`)}}var $M=t=>Array.isArray(t)?t:[t];function E$(t){const e=Array.isArray(t[0])?t[0]:t;return A$(e,"createSelector expects all input-selectors to be functions, but received the following types: "),e}function C$(t,e){const r=[],{length:n}=t;for(let i=0;i<n;i++)r.push(t[i].apply(null,e));return r}var P$=class{constructor(t){this.value=t}deref(){return this.value}},M$=typeof WeakRef<"u"?WeakRef:P$,I$=0,HM=1;function Cb(){return{s:I$,v:void 0,o:null,p:null}}function O6(t,e={}){let r=Cb();const{resultEqualityCheck:n}=e;let i,a=0;function c(){let s=r;const{length:g}=arguments;for(let T=0,M=g;T<M;T++){const O=arguments[T];if(typeof O=="function"||typeof O=="object"&&O!==null){let F=s.o;F===null&&(s.o=F=new WeakMap);const j=F.get(O);j===void 0?(s=Cb(),F.set(O,s)):s=j}else{let F=s.p;F===null&&(s.p=F=new Map);const j=F.get(O);j===void 0?(s=Cb(),F.set(O,s)):s=j}}const _=s;let v;if(s.s===HM)v=s.v;else if(v=t.apply(null,arguments),a++,n){const T=i?.deref?.()??i;T!=null&&n(T,v)&&(v=T,a!==0&&a--),i=typeof v=="object"&&v!==null||typeof v=="function"?new M$(v):v}return _.s=HM,_.v=v,v}return c.clearCache=()=>{r=Cb(),c.resetResultsCount()},c.resultsCount=()=>a,c.resetResultsCount=()=>{a=0},c}function R$(t,...e){const r=typeof t=="function"?{memoize:t,memoizeOptions:e}:t,n=(...i)=>{let a=0,c=0,s,g={},_=i.pop();typeof _=="object"&&(g=_,_=i.pop()),T$(_,`createSelector expects an output function after the inputs, but received: [${typeof _}]`);const v={...r,...g},{memoize:T,memoizeOptions:M=[],argsMemoize:O=O6,argsMemoizeOptions:F=[]}=v,j=$M(M),V=$M(F),q=E$(i),Y=T(function(){return a++,_.apply(null,arguments)},...j),X=O(function(){c++;const ue=C$(q,arguments);return s=Y.apply(null,ue),s},...V);return Object.assign(X,{resultFunc:_,memoizedResultFunc:Y,dependencies:q,dependencyRecomputations:()=>c,resetDependencyRecomputations:()=>{c=0},lastResult:()=>s,recomputations:()=>a,resetRecomputations:()=>{a=0},memoize:T,argsMemoize:O})};return Object.assign(n,{withTypes:()=>n}),n}var wt=R$(O6),O$=Object.assign((t,e=wt)=>{S$(t,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof t}`);const r=Object.keys(t),n=r.map(a=>t[a]);return e(n,(...a)=>a.reduce((c,s,g)=>(c[r[g]]=s,c),{}))},{withTypes:()=>O$}),W2={},q2={},G2={},WM;function k$(){return WM||(WM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(n){return typeof n=="symbol"?1:n===null?2:n===void 0?3:n!==n?4:0}const r=(n,i,a)=>{if(n!==i){const c=e(n),s=e(i);if(c===s&&c===0){if(n<i)return a==="desc"?1:-1;if(n>i)return a==="desc"?-1:1}return a==="desc"?s-c:c-s}return 0};t.compareValues=r})(G2)),G2}var X2={},Z2={},qM;function k6(){return qM||(qM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){return typeof r=="symbol"||r instanceof Symbol}t.isSymbol=e})(Z2)),Z2}var GM;function D$(){return GM||(GM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=k6(),r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,n=/^\w*$/;function i(a,c){return Array.isArray(a)?!1:typeof a=="number"||typeof a=="boolean"||a==null||e.isSymbol(a)?!0:typeof a=="string"&&(n.test(a)||!r.test(a))||c!=null&&Object.hasOwn(c,a)}t.isKey=i})(X2)),X2}var XM;function L$(){return XM||(XM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=k$(),r=D$(),n=kE();function i(a,c,s,g){if(a==null)return[];s=g?void 0:s,Array.isArray(a)||(a=Object.values(a)),Array.isArray(c)||(c=c==null?[null]:[c]),c.length===0&&(c=[null]),Array.isArray(s)||(s=s==null?[]:[s]),s=s.map(O=>String(O));const _=(O,F)=>{let j=O;for(let V=0;V<F.length&&j!=null;++V)j=j[F[V]];return j},v=(O,F)=>F==null||O==null?F:typeof O=="object"&&"key"in O?Object.hasOwn(F,O.key)?F[O.key]:_(F,O.path):typeof O=="function"?O(F):Array.isArray(O)?_(F,O):typeof F=="object"?F[O]:F,T=c.map(O=>(Array.isArray(O)&&O.length===1&&(O=O[0]),O==null||typeof O=="function"||Array.isArray(O)||r.isKey(O)?O:{key:O,path:n.toPath(O)}));return a.map(O=>({original:O,criteria:T.map(F=>v(F,O))})).slice().sort((O,F)=>{for(let j=0;j<T.length;j++){const V=e.compareValues(O.criteria[j],F.criteria[j],s[j]);if(V!==0)return V}return 0}).map(O=>O.original)}t.orderBy=i})(q2)),q2}var Y2={},ZM;function B$(){return ZM||(ZM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r,n=1){const i=[],a=Math.floor(n),c=(s,g)=>{for(let _=0;_<s.length;_++){const v=s[_];Array.isArray(v)&&g<a?c(v,g+1):i.push(v)}};return c(r,0),i}t.flatten=e})(Y2)),Y2}var K2={},YM;function D6(){return YM||(YM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=R6(),r=UE(),n=A6(),i=C6();function a(c,s,g){return n.isObject(g)&&(typeof s=="number"&&r.isArrayLike(g)&&e.isIndex(s)&&s<g.length||typeof s=="string"&&s in g)?i.eq(g[s],c):!1}t.isIterateeCall=a})(K2)),K2}var KM;function N$(){return KM||(KM=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=L$(),r=B$(),n=D6();function i(a,...c){const s=c.length;return s>1&&n.isIterateeCall(a,c[0],c[1])?c=[]:s>2&&n.isIterateeCall(c[0],c[1],c[2])&&(c=[c[0]]),e.orderBy(a,r.flatten(c),["asc"])}t.sortBy=i})(W2)),W2}var Q2,QM;function z$(){return QM||(QM=1,Q2=N$().sortBy),Q2}var F$=z$();const j1=xl(F$);var L6=t=>t.legend.settings,U$=t=>t.legend.size,j$=t=>t.legend.payload;wt([j$,L6],(t,e)=>{var{itemSorter:r}=e,n=t.flat(1);return r?j1(n,r):n});var Pb=1;function V$(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],[e,r]=Q.useState({height:0,left:0,top:0,width:0}),n=Q.useCallback(i=>{if(i!=null){var a=i.getBoundingClientRect(),c={height:a.height,left:a.left,top:a.top,width:a.width};(Math.abs(c.height-e.height)>Pb||Math.abs(c.left-e.left)>Pb||Math.abs(c.top-e.top)>Pb||Math.abs(c.width-e.width)>Pb)&&r({height:c.height,left:c.left,top:c.top,width:c.width})}},[e.width,e.height,e.top,e.left,...t]);return[e,n]}function oa(t){return`Minified Redux error #${t}; visit https://redux.js.org/Errors?code=${t} for the full message or use the non-minified dev environment for full errors. `}var $$=typeof Symbol=="function"&&Symbol.observable||"@@observable",JM=$$,J2=()=>Math.random().toString(36).substring(7).split("").join("."),H$={INIT:`@@redux/INIT${J2()}`,REPLACE:`@@redux/REPLACE${J2()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${J2()}`},Dx=H$;function $E(t){if(typeof t!="object"||t===null)return!1;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e||Object.getPrototypeOf(t)===null}function B6(t,e,r){if(typeof t!="function")throw new Error(oa(2));if(typeof e=="function"&&typeof r=="function"||typeof r=="function"&&typeof arguments[3]=="function")throw new Error(oa(0));if(typeof e=="function"&&typeof r>"u"&&(r=e,e=void 0),typeof r<"u"){if(typeof r!="function")throw new Error(oa(1));return r(B6)(t,e)}let n=t,i=e,a=new Map,c=a,s=0,g=!1;function _(){c===a&&(c=new Map,a.forEach((V,q)=>{c.set(q,V)}))}function v(){if(g)throw new Error(oa(3));return i}function T(V){if(typeof V!="function")throw new Error(oa(4));if(g)throw new Error(oa(5));let q=!0;_();const Y=s++;return c.set(Y,V),function(){if(q){if(g)throw new Error(oa(6));q=!1,_(),c.delete(Y),a=null}}}function M(V){if(!$E(V))throw new Error(oa(7));if(typeof V.type>"u")throw new Error(oa(8));if(typeof V.type!="string")throw new Error(oa(17));if(g)throw new Error(oa(9));try{g=!0,i=n(i,V)}finally{g=!1}return(a=c).forEach(Y=>{Y()}),V}function O(V){if(typeof V!="function")throw new Error(oa(10));n=V,M({type:Dx.REPLACE})}function F(){const V=T;return{subscribe(q){if(typeof q!="object"||q===null)throw new Error(oa(11));function Y(){const ae=q;ae.next&&ae.next(v())}return Y(),{unsubscribe:V(Y)}},[JM](){return this}}}return M({type:Dx.INIT}),{dispatch:M,subscribe:T,getState:v,replaceReducer:O,[JM]:F}}function W$(t){Object.keys(t).forEach(e=>{const r=t[e];if(typeof r(void 0,{type:Dx.INIT})>"u")throw new Error(oa(12));if(typeof r(void 0,{type:Dx.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(oa(13))})}function N6(t){const e=Object.keys(t),r={};for(let a=0;a<e.length;a++){const c=e[a];typeof t[c]=="function"&&(r[c]=t[c])}const n=Object.keys(r);let i;try{W$(r)}catch(a){i=a}return function(c={},s){if(i)throw i;let g=!1;const _={};for(let v=0;v<n.length;v++){const T=n[v],M=r[T],O=c[T],F=M(O,s);if(typeof F>"u")throw s&&s.type,new Error(oa(14));_[T]=F,g=g||F!==O}return g=g||n.length!==Object.keys(c).length,g?_:c}}function Lx(...t){return t.length===0?e=>e:t.length===1?t[0]:t.reduce((e,r)=>(...n)=>e(r(...n)))}function q$(...t){return e=>(r,n)=>{const i=e(r,n);let a=()=>{throw new Error(oa(15))};const c={getState:i.getState,dispatch:(g,..._)=>a(g,..._)},s=t.map(g=>g(c));return a=Lx(...s)(i.dispatch),{...i,dispatch:a}}}function z6(t){return $E(t)&&"type"in t&&typeof t.type=="string"}var F6=Symbol.for("immer-nothing"),eI=Symbol.for("immer-draftable"),bl=Symbol.for("immer-state");function iu(t,...e){throw new Error(`[Immer] minified error nr: ${t}. Full error at: https://bit.ly/3cXEKWf`)}var _y=Object.getPrototypeOf;function wg(t){return!!t&&!!t[bl]}function _f(t){return t?U6(t)||Array.isArray(t)||!!t[eI]||!!t.constructor?.[eI]||o0(t)||$1(t):!1}var G$=Object.prototype.constructor.toString();function U6(t){if(!t||typeof t!="object")return!1;const e=_y(t);if(e===null)return!0;const r=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return r===Object?!0:typeof r=="function"&&Function.toString.call(r)===G$}function Bx(t,e){V1(t)===0?Reflect.ownKeys(t).forEach(r=>{e(r,t[r],t)}):t.forEach((r,n)=>e(n,r,t))}function V1(t){const e=t[bl];return e?e.type_:Array.isArray(t)?1:o0(t)?2:$1(t)?3:0}function IS(t,e){return V1(t)===2?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function j6(t,e,r){const n=V1(t);n===2?t.set(e,r):n===3?t.add(r):t[e]=r}function X$(t,e){return t===e?t!==0||1/t===1/e:t!==t&&e!==e}function o0(t){return t instanceof Map}function $1(t){return t instanceof Set}function ng(t){return t.copy_||t.base_}function RS(t,e){if(o0(t))return new Map(t);if($1(t))return new Set(t);if(Array.isArray(t))return Array.prototype.slice.call(t);const r=U6(t);if(e===!0||e==="class_only"&&!r){const n=Object.getOwnPropertyDescriptors(t);delete n[bl];let i=Reflect.ownKeys(n);for(let a=0;a<i.length;a++){const c=i[a],s=n[c];s.writable===!1&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(n[c]={configurable:!0,writable:!0,enumerable:s.enumerable,value:t[c]})}return Object.create(_y(t),n)}else{const n=_y(t);if(n!==null&&r)return{...t};const i=Object.create(n);return Object.assign(i,t)}}function HE(t,e=!1){return H1(t)||wg(t)||!_f(t)||(V1(t)>1&&Object.defineProperties(t,{set:{value:Mb},add:{value:Mb},clear:{value:Mb},delete:{value:Mb}}),Object.freeze(t),e&&Object.values(t).forEach(r=>HE(r,!0))),t}function Mb(){iu(2)}function H1(t){return Object.isFrozen(t)}var Z$={};function Tg(t){const e=Z$[t];return e||iu(0,t),e}var Vv;function V6(){return Vv}function Y$(t,e){return{drafts_:[],parent_:t,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function tI(t,e){e&&(Tg("Patches"),t.patches_=[],t.inversePatches_=[],t.patchListener_=e)}function OS(t){kS(t),t.drafts_.forEach(K$),t.drafts_=null}function kS(t){t===Vv&&(Vv=t.parent_)}function rI(t){return Vv=Y$(Vv,t)}function K$(t){const e=t[bl];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function nI(t,e){e.unfinalizedDrafts_=e.drafts_.length;const r=e.drafts_[0];return t!==void 0&&t!==r?(r[bl].modified_&&(OS(e),iu(4)),_f(t)&&(t=Nx(e,t),e.parent_||zx(e,t)),e.patches_&&Tg("Patches").generateReplacementPatches_(r[bl].base_,t,e.patches_,e.inversePatches_)):t=Nx(e,r,[]),OS(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),t!==F6?t:void 0}function Nx(t,e,r){if(H1(e))return e;const n=e[bl];if(!n)return Bx(e,(i,a)=>iI(t,n,e,i,a,r)),e;if(n.scope_!==t)return e;if(!n.modified_)return zx(t,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;const i=n.copy_;let a=i,c=!1;n.type_===3&&(a=new Set(i),i.clear(),c=!0),Bx(a,(s,g)=>iI(t,n,i,s,g,r,c)),zx(t,i,!1),r&&t.patches_&&Tg("Patches").generatePatches_(n,r,t.patches_,t.inversePatches_)}return n.copy_}function iI(t,e,r,n,i,a,c){if(wg(i)){const s=a&&e&&e.type_!==3&&!IS(e.assigned_,n)?a.concat(n):void 0,g=Nx(t,i,s);if(j6(r,n,g),wg(g))t.canAutoFreeze_=!1;else return}else c&&r.add(i);if(_f(i)&&!H1(i)){if(!t.immer_.autoFreeze_&&t.unfinalizedDrafts_<1)return;Nx(t,i),(!e||!e.scope_.parent_)&&typeof n!="symbol"&&(o0(r)?r.has(n):Object.prototype.propertyIsEnumerable.call(r,n))&&zx(t,i)}}function zx(t,e,r=!1){!t.parent_&&t.immer_.autoFreeze_&&t.canAutoFreeze_&&HE(e,r)}function Q$(t,e){const r=Array.isArray(t),n={type_:r?1:0,scope_:e?e.scope_:V6(),modified_:!1,finalized_:!1,assigned_:{},parent_:e,base_:t,draft_:null,copy_:null,revoke_:null,isManual_:!1};let i=n,a=WE;r&&(i=[n],a=$v);const{revoke:c,proxy:s}=Proxy.revocable(i,a);return n.draft_=s,n.revoke_=c,s}var WE={get(t,e){if(e===bl)return t;const r=ng(t);if(!IS(r,e))return J$(t,r,e);const n=r[e];return t.finalized_||!_f(n)?n:n===eT(t.base_,e)?(tT(t),t.copy_[e]=LS(n,t)):n},has(t,e){return e in ng(t)},ownKeys(t){return Reflect.ownKeys(ng(t))},set(t,e,r){const n=$6(ng(t),e);if(n?.set)return n.set.call(t.draft_,r),!0;if(!t.modified_){const i=eT(ng(t),e),a=i?.[bl];if(a&&a.base_===r)return t.copy_[e]=r,t.assigned_[e]=!1,!0;if(X$(r,i)&&(r!==void 0||IS(t.base_,e)))return!0;tT(t),DS(t)}return t.copy_[e]===r&&(r!==void 0||e in t.copy_)||Number.isNaN(r)&&Number.isNaN(t.copy_[e])||(t.copy_[e]=r,t.assigned_[e]=!0),!0},deleteProperty(t,e){return eT(t.base_,e)!==void 0||e in t.base_?(t.assigned_[e]=!1,tT(t),DS(t)):delete t.assigned_[e],t.copy_&&delete t.copy_[e],!0},getOwnPropertyDescriptor(t,e){const r=ng(t),n=Reflect.getOwnPropertyDescriptor(r,e);return n&&{writable:!0,configurable:t.type_!==1||e!=="length",enumerable:n.enumerable,value:r[e]}},defineProperty(){iu(11)},getPrototypeOf(t){return _y(t.base_)},setPrototypeOf(){iu(12)}},$v={};Bx(WE,(t,e)=>{$v[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}});$v.deleteProperty=function(t,e){return $v.set.call(this,t,e,void 0)};$v.set=function(t,e,r){return WE.set.call(this,t[0],e,r,t[0])};function eT(t,e){const r=t[bl];return(r?ng(r):t)[e]}function J$(t,e,r){const n=$6(e,r);return n?"value"in n?n.value:n.get?.call(t.draft_):void 0}function $6(t,e){if(!(e in t))return;let r=_y(t);for(;r;){const n=Object.getOwnPropertyDescriptor(r,e);if(n)return n;r=_y(r)}}function DS(t){t.modified_||(t.modified_=!0,t.parent_&&DS(t.parent_))}function tT(t){t.copy_||(t.copy_=RS(t.base_,t.scope_.immer_.useStrictShallowCopy_))}var eH=class{constructor(t){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,r,n)=>{if(typeof e=="function"&&typeof r!="function"){const a=r;r=e;const c=this;return function(g=a,..._){return c.produce(g,v=>r.call(this,v,..._))}}typeof r!="function"&&iu(6),n!==void 0&&typeof n!="function"&&iu(7);let i;if(_f(e)){const a=rI(this),c=LS(e,void 0);let s=!0;try{i=r(c),s=!1}finally{s?OS(a):kS(a)}return tI(a,n),nI(i,a)}else if(!e||typeof e!="object"){if(i=r(e),i===void 0&&(i=e),i===F6&&(i=void 0),this.autoFreeze_&&HE(i,!0),n){const a=[],c=[];Tg("Patches").generateReplacementPatches_(e,i,a,c),n(a,c)}return i}else iu(1,e)},this.produceWithPatches=(e,r)=>{if(typeof e=="function")return(c,...s)=>this.produceWithPatches(c,g=>e(g,...s));let n,i;return[this.produce(e,r,(c,s)=>{n=c,i=s}),n,i]},typeof t?.autoFreeze=="boolean"&&this.setAutoFreeze(t.autoFreeze),typeof t?.useStrictShallowCopy=="boolean"&&this.setUseStrictShallowCopy(t.useStrictShallowCopy)}createDraft(t){_f(t)||iu(8),wg(t)&&(t=ff(t));const e=rI(this),r=LS(t,void 0);return r[bl].isManual_=!0,kS(e),r}finishDraft(t,e){const r=t&&t[bl];(!r||!r.isManual_)&&iu(9);const{scope_:n}=r;return tI(n,e),nI(void 0,n)}setAutoFreeze(t){this.autoFreeze_=t}setUseStrictShallowCopy(t){this.useStrictShallowCopy_=t}applyPatches(t,e){let r;for(r=e.length-1;r>=0;r--){const i=e[r];if(i.path.length===0&&i.op==="replace"){t=i.value;break}}r>-1&&(e=e.slice(r+1));const n=Tg("Patches").applyPatches_;return wg(t)?n(t,e):this.produce(t,i=>n(i,e))}};function LS(t,e){const r=o0(t)?Tg("MapSet").proxyMap_(t,e):$1(t)?Tg("MapSet").proxySet_(t,e):Q$(t,e);return(e?e.scope_:V6()).drafts_.push(r),r}function ff(t){return wg(t)||iu(10,t),H6(t)}function H6(t){if(!_f(t)||H1(t))return t;const e=t[bl];let r;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,r=RS(t,e.scope_.immer_.useStrictShallowCopy_)}else r=RS(t,!0);return Bx(r,(n,i)=>{j6(r,n,H6(i))}),e&&(e.finalized_=!1),r}var tH=new eH,W6=tH.produce;function q6(t){return({dispatch:r,getState:n})=>i=>a=>typeof a=="function"?a(r,n,t):i(a)}var rH=q6(),nH=q6,iH=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?Lx:Lx.apply(null,arguments)};function gc(t,e){function r(...n){if(e){let i=e(...n);if(!i)throw new Error(_l(0));return{type:t,payload:i.payload,..."meta"in i&&{meta:i.meta},..."error"in i&&{error:i.error}}}return{type:t,payload:n[0]}}return r.toString=()=>`${t}`,r.type=t,r.match=n=>z6(n)&&n.type===t,r}var G6=class dv extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,dv.prototype)}static get[Symbol.species](){return dv}concat(...e){return super.concat.apply(this,e)}prepend(...e){return e.length===1&&Array.isArray(e[0])?new dv(...e[0].concat(this)):new dv(...e.concat(this))}};function sI(t){return _f(t)?W6(t,()=>{}):t}function Ib(t,e,r){return t.has(e)?t.get(e):t.set(e,r(e)).get(e)}function sH(t){return typeof t=="boolean"}var aH=()=>function(e){const{thunk:r=!0,immutableCheck:n=!0,serializableCheck:i=!0,actionCreatorCheck:a=!0}=e??{};let c=new G6;return r&&(sH(r)?c.push(rH):c.push(nH(r.extraArgument))),c},oH="RTK_autoBatch",aI=t=>e=>{setTimeout(e,t)},lH=(t={type:"raf"})=>e=>(...r)=>{const n=e(...r);let i=!0,a=!1,c=!1;const s=new Set,g=t.type==="tick"?queueMicrotask:t.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:aI(10):t.type==="callback"?t.queueNotification:aI(t.timeout),_=()=>{c=!1,a&&(a=!1,s.forEach(v=>v()))};return Object.assign({},n,{subscribe(v){const T=()=>i&&v(),M=n.subscribe(T);return s.add(v),()=>{M(),s.delete(v)}},dispatch(v){try{return i=!v?.meta?.[oH],a=!i,a&&(c||(c=!0,g(_))),n.dispatch(v)}finally{i=!0}}})},cH=t=>function(r){const{autoBatch:n=!0}=r??{};let i=new G6(t);return n&&i.push(lH(typeof n=="object"?n:void 0)),i};function uH(t){const e=aH(),{reducer:r=void 0,middleware:n,devTools:i=!0,preloadedState:a=void 0,enhancers:c=void 0}=t||{};let s;if(typeof r=="function")s=r;else if($E(r))s=N6(r);else throw new Error(_l(1));let g;typeof n=="function"?g=n(e):g=e();let _=Lx;i&&(_=iH({trace:!1,...typeof i=="object"&&i}));const v=q$(...g),T=cH(v);let M=typeof c=="function"?c(T):T();const O=_(...M);return B6(s,a,O)}function X6(t){const e={},r=[];let n;const i={addCase(a,c){const s=typeof a=="string"?a:a.type;if(!s)throw new Error(_l(28));if(s in e)throw new Error(_l(29));return e[s]=c,i},addAsyncThunk(a,c){return c.pending&&(e[a.pending.type]=c.pending),c.rejected&&(e[a.rejected.type]=c.rejected),c.fulfilled&&(e[a.fulfilled.type]=c.fulfilled),c.settled&&r.push({matcher:a.settled,reducer:c.settled}),i},addMatcher(a,c){return r.push({matcher:a,reducer:c}),i},addDefaultCase(a){return n=a,i}};return t(i),[e,r,n]}function hH(t){return typeof t=="function"}function fH(t,e){let[r,n,i]=X6(e),a;if(hH(t))a=()=>sI(t());else{const s=sI(t);a=()=>s}function c(s=a(),g){let _=[r[g.type],...n.filter(({matcher:v})=>v(g)).map(({reducer:v})=>v)];return _.filter(v=>!!v).length===0&&(_=[i]),_.reduce((v,T)=>{if(T)if(wg(v)){const O=T(v,g);return O===void 0?v:O}else{if(_f(v))return W6(v,M=>T(M,g));{const M=T(v,g);if(M===void 0){if(v===null)return v;throw Error("A case reducer on a non-draftable value must not return undefined")}return M}}return v},s)}return c.getInitialState=a,c}var dH="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",pH=(t=21)=>{let e="",r=t;for(;r--;)e+=dH[Math.random()*64|0];return e},gH=Symbol.for("rtk-slice-createasyncthunk");function mH(t,e){return`${t}/${e}`}function yH({creators:t}={}){const e=t?.asyncThunk?.[gH];return function(n){const{name:i,reducerPath:a=i}=n;if(!i)throw new Error(_l(11));const c=(typeof n.reducers=="function"?n.reducers(vH()):n.reducers)||{},s=Object.keys(c),g={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},_={addCase(X,ae){const ue=typeof X=="string"?X:X.type;if(!ue)throw new Error(_l(12));if(ue in g.sliceCaseReducersByType)throw new Error(_l(13));return g.sliceCaseReducersByType[ue]=ae,_},addMatcher(X,ae){return g.sliceMatchers.push({matcher:X,reducer:ae}),_},exposeAction(X,ae){return g.actionCreators[X]=ae,_},exposeCaseReducer(X,ae){return g.sliceCaseReducersByName[X]=ae,_}};s.forEach(X=>{const ae=c[X],ue={reducerName:X,type:mH(i,X),createNotation:typeof n.reducers=="function"};xH(ae)?TH(ue,ae,_,e):bH(ue,ae,_)});function v(){const[X={},ae=[],ue=void 0]=typeof n.extraReducers=="function"?X6(n.extraReducers):[n.extraReducers],ge={...X,...g.sliceCaseReducersByType};return fH(n.initialState,Le=>{for(let qe in ge)Le.addCase(qe,ge[qe]);for(let qe of g.sliceMatchers)Le.addMatcher(qe.matcher,qe.reducer);for(let qe of ae)Le.addMatcher(qe.matcher,qe.reducer);ue&&Le.addDefaultCase(ue)})}const T=X=>X,M=new Map,O=new WeakMap;let F;function j(X,ae){return F||(F=v()),F(X,ae)}function V(){return F||(F=v()),F.getInitialState()}function q(X,ae=!1){function ue(Le){let qe=Le[X];return typeof qe>"u"&&ae&&(qe=Ib(O,ue,V)),qe}function ge(Le=T){const qe=Ib(M,ae,()=>new WeakMap);return Ib(qe,Le,()=>{const Ze={};for(const[_t,it]of Object.entries(n.selectors??{}))Ze[_t]=_H(it,Le,()=>Ib(O,Le,V),ae);return Ze})}return{reducerPath:X,getSelectors:ge,get selectors(){return ge(ue)},selectSlice:ue}}const Y={name:i,reducer:j,actions:g.actionCreators,caseReducers:g.sliceCaseReducersByName,getInitialState:V,...q(a),injectInto(X,{reducerPath:ae,...ue}={}){const ge=ae??a;return X.inject({reducerPath:ge,reducer:j},ue),{...Y,...q(ge,!0)}}};return Y}}function _H(t,e,r,n){function i(a,...c){let s=e(a);return typeof s>"u"&&n&&(s=r()),t(s,...c)}return i.unwrapped=t,i}var wl=yH();function vH(){function t(e,r){return{_reducerDefinitionType:"asyncThunk",payloadCreator:e,...r}}return t.withTypes=()=>t,{reducer(e){return Object.assign({[e.name](...r){return e(...r)}}[e.name],{_reducerDefinitionType:"reducer"})},preparedReducer(e,r){return{_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:r}},asyncThunk:t}}function bH({type:t,reducerName:e,createNotation:r},n,i){let a,c;if("reducer"in n){if(r&&!wH(n))throw new Error(_l(17));a=n.reducer,c=n.prepare}else a=n;i.addCase(t,a).exposeCaseReducer(e,a).exposeAction(e,c?gc(t,c):gc(t))}function xH(t){return t._reducerDefinitionType==="asyncThunk"}function wH(t){return t._reducerDefinitionType==="reducerWithPrepare"}function TH({type:t,reducerName:e},r,n,i){if(!i)throw new Error(_l(18));const{payloadCreator:a,fulfilled:c,pending:s,rejected:g,settled:_,options:v}=r,T=i(t,a,v);n.exposeAction(e,T),c&&n.addCase(T.fulfilled,c),s&&n.addCase(T.pending,s),g&&n.addCase(T.rejected,g),_&&n.addMatcher(T.settled,_),n.exposeCaseReducer(e,{fulfilled:c||Rb,pending:s||Rb,rejected:g||Rb,settled:_||Rb})}function Rb(){}var SH="task",Z6="listener",Y6="completed",qE="cancelled",AH=`task-${qE}`,EH=`task-${Y6}`,BS=`${Z6}-${qE}`,CH=`${Z6}-${Y6}`,W1=class{constructor(t){this.code=t,this.message=`${SH} ${qE} (reason: ${t})`}name="TaskAbortError";message},GE=(t,e)=>{if(typeof t!="function")throw new TypeError(_l(32))},Fx=()=>{},K6=(t,e=Fx)=>(t.catch(e),t),Q6=(t,e)=>(t.addEventListener("abort",e,{once:!0}),()=>t.removeEventListener("abort",e)),pg=(t,e)=>{const r=t.signal;r.aborted||("reason"in r||Object.defineProperty(r,"reason",{enumerable:!0,value:e,configurable:!0,writable:!0}),t.abort(e))},gg=t=>{if(t.aborted){const{reason:e}=t;throw new W1(e)}};function J6(t,e){let r=Fx;return new Promise((n,i)=>{const a=()=>i(new W1(t.reason));if(t.aborted){a();return}r=Q6(t,a),e.finally(()=>r()).then(n,i)}).finally(()=>{r=Fx})}var PH=async(t,e)=>{try{return await Promise.resolve(),{status:"ok",value:await t()}}catch(r){return{status:r instanceof W1?"cancelled":"rejected",error:r}}finally{e?.()}},Ux=t=>e=>K6(J6(t,e).then(r=>(gg(t),r))),eL=t=>{const e=Ux(t);return r=>e(new Promise(n=>setTimeout(n,r)))},{assign:ly}=Object,oI={},q1="listenerMiddleware",MH=(t,e)=>{const r=n=>Q6(t,()=>pg(n,t.reason));return(n,i)=>{GE(n);const a=new AbortController;r(a);const c=PH(async()=>{gg(t),gg(a.signal);const s=await n({pause:Ux(a.signal),delay:eL(a.signal),signal:a.signal});return gg(a.signal),s},()=>pg(a,EH));return i?.autoJoin&&e.push(c.catch(Fx)),{result:Ux(t)(c),cancel(){pg(a,AH)}}}},IH=(t,e)=>{const r=async(n,i)=>{gg(e);let a=()=>{};const s=[new Promise((g,_)=>{let v=t({predicate:n,effect:(T,M)=>{M.unsubscribe(),g([T,M.getState(),M.getOriginalState()])}});a=()=>{v(),_()}})];i!=null&&s.push(new Promise(g=>setTimeout(g,i,null)));try{const g=await J6(e,Promise.race(s));return gg(e),g}finally{a()}};return(n,i)=>K6(r(n,i))},tL=t=>{let{type:e,actionCreator:r,matcher:n,predicate:i,effect:a}=t;if(e)i=gc(e).match;else if(r)e=r.type,i=r.match;else if(n)i=n;else if(!i)throw new Error(_l(21));return GE(a),{predicate:i,type:e,effect:a}},rL=ly(t=>{const{type:e,predicate:r,effect:n}=tL(t);return{id:pH(),effect:n,type:e,predicate:r,pending:new Set,unsubscribe:()=>{throw new Error(_l(22))}}},{withTypes:()=>rL}),lI=(t,e)=>{const{type:r,effect:n,predicate:i}=tL(e);return Array.from(t.values()).find(a=>(typeof r=="string"?a.type===r:a.predicate===i)&&a.effect===n)},NS=t=>{t.pending.forEach(e=>{pg(e,BS)})},RH=t=>()=>{t.forEach(NS),t.clear()},cI=(t,e,r)=>{try{t(e,r)}catch(n){setTimeout(()=>{throw n},0)}},nL=ly(gc(`${q1}/add`),{withTypes:()=>nL}),OH=gc(`${q1}/removeAll`),iL=ly(gc(`${q1}/remove`),{withTypes:()=>iL}),kH=(...t)=>{console.error(`${q1}/error`,...t)},l0=(t={})=>{const e=new Map,{extra:r,onError:n=kH}=t;GE(n);const i=v=>(v.unsubscribe=()=>e.delete(v.id),e.set(v.id,v),T=>{v.unsubscribe(),T?.cancelActive&&NS(v)}),a=v=>{const T=lI(e,v)??rL(v);return i(T)};ly(a,{withTypes:()=>a});const c=v=>{const T=lI(e,v);return T&&(T.unsubscribe(),v.cancelActive&&NS(T)),!!T};ly(c,{withTypes:()=>c});const s=async(v,T,M,O)=>{const F=new AbortController,j=IH(a,F.signal),V=[];try{v.pending.add(F),await Promise.resolve(v.effect(T,ly({},M,{getOriginalState:O,condition:(q,Y)=>j(q,Y).then(Boolean),take:j,delay:eL(F.signal),pause:Ux(F.signal),extra:r,signal:F.signal,fork:MH(F.signal,V),unsubscribe:v.unsubscribe,subscribe:()=>{e.set(v.id,v)},cancelActiveListeners:()=>{v.pending.forEach((q,Y,X)=>{q!==F&&(pg(q,BS),X.delete(q))})},cancel:()=>{pg(F,BS),v.pending.delete(F)},throwIfCancelled:()=>{gg(F.signal)}})))}catch(q){q instanceof W1||cI(n,q,{raisedBy:"effect"})}finally{await Promise.all(V),pg(F,CH),v.pending.delete(F)}},g=RH(e);return{middleware:v=>T=>M=>{if(!z6(M))return T(M);if(nL.match(M))return a(M.payload);if(OH.match(M)){g();return}if(iL.match(M))return c(M.payload);let O=v.getState();const F=()=>{if(O===oI)throw new Error(_l(23));return O};let j;try{if(j=T(M),e.size>0){const V=v.getState(),q=Array.from(e.values());for(const Y of q){let X=!1;try{X=Y.predicate(M,V,O)}catch(ae){X=!1,cI(n,ae,{raisedBy:"predicate"})}X&&s(Y,M,v,F)}}}finally{O=oI}return j},startListening:a,stopListening:c,clearListeners:g}};function _l(t){return`Minified Redux Toolkit error #${t}; visit https://redux-toolkit.js.org/Errors?code=${t} for the full message or use the non-minified dev environment for full errors. `}var DH={layoutType:"horizontal",width:0,height:0,margin:{top:5,right:5,bottom:5,left:5},scale:1},sL=wl({name:"chartLayout",initialState:DH,reducers:{setLayout(t,e){t.layoutType=e.payload},setChartSize(t,e){t.width=e.payload.width,t.height=e.payload.height},setMargin(t,e){var r,n,i,a;t.margin.top=(r=e.payload.top)!==null&&r!==void 0?r:0,t.margin.right=(n=e.payload.right)!==null&&n!==void 0?n:0,t.margin.bottom=(i=e.payload.bottom)!==null&&i!==void 0?i:0,t.margin.left=(a=e.payload.left)!==null&&a!==void 0?a:0},setScale(t,e){t.scale=e.payload}}}),{setMargin:LH,setLayout:BH,setChartSize:NH,setScale:zH}=sL.actions,FH=sL.reducer;function uI(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function hI(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?uI(Object(r),!0).forEach(function(n){UH(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):uI(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function UH(t,e,r){return(e=jH(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function jH(t){var e=VH(t,"string");return typeof e=="symbol"?e:e+""}function VH(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var jx=Math.PI/180,$H=t=>t*180/Math.PI,ua=(t,e,r,n)=>({x:t+Math.cos(-jx*n)*r,y:e+Math.sin(-jx*n)*r}),HH=function(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(e-(n.left||0)-(n.right||0)),Math.abs(r-(n.top||0)-(n.bottom||0)))/2},WH=(t,e)=>{var{x:r,y:n}=t,{x:i,y:a}=e;return Math.sqrt((r-i)**2+(n-a)**2)},qH=(t,e)=>{var{x:r,y:n}=t,{cx:i,cy:a}=e,c=WH({x:r,y:n},{x:i,y:a});if(c<=0)return{radius:c,angle:0};var s=(r-i)/c,g=Math.acos(s);return n>a&&(g=2*Math.PI-g),{radius:c,angle:$H(g),angleInRadian:g}},GH=t=>{var{startAngle:e,endAngle:r}=t,n=Math.floor(e/360),i=Math.floor(r/360),a=Math.min(n,i);return{startAngle:e-a*360,endAngle:r-a*360}},XH=(t,e)=>{var{startAngle:r,endAngle:n}=e,i=Math.floor(r/360),a=Math.floor(n/360),c=Math.min(i,a);return t+c*360},ZH=(t,e)=>{var{x:r,y:n}=t,{radius:i,angle:a}=qH({x:r,y:n},e),{innerRadius:c,outerRadius:s}=e;if(i<c||i>s||i===0)return null;var{startAngle:g,endAngle:_}=GH(e),v=a,T;if(g<=_){for(;v>_;)v-=360;for(;v<g;)v+=360;T=v>=g&&v<=_}else{for(;v>g;)v-=360;for(;v<_;)v+=360;T=v>=_&&v<=g}return T?hI(hI({},e),{},{radius:i,angle:XH(v,e)}):null};function aL(t,e,r){return Array.isArray(t)&&t&&e+r!==0?t.slice(e,r+1):t}function fI(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function ac(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?fI(Object(r),!0).forEach(function(n){YH(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):fI(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function YH(t,e,r){return(e=KH(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function KH(t){var e=QH(t,"string");return typeof e=="symbol"?e:e+""}function QH(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Ga(t,e,r){return Ks(t)||Ks(e)?r:ah(e)?z1(t,e,r):typeof e=="function"?e(t):r}var JH=(t,e,r,n,i)=>{var a,c=-1,s=(a=e?.length)!==null&&a!==void 0?a:0;if(s<=1||t==null)return 0;if(n==="angleAxis"&&i!=null&&Math.abs(Math.abs(i[1]-i[0])-360)<=1e-6)for(var g=0;g<s;g++){var _=g>0?r[g-1].coordinate:r[s-1].coordinate,v=r[g].coordinate,T=g>=s-1?r[0].coordinate:r[g+1].coordinate,M=void 0;if(lc(v-_)!==lc(T-v)){var O=[];if(lc(T-v)===lc(i[1]-i[0])){M=T;var F=v+i[1]-i[0];O[0]=Math.min(F,(F+_)/2),O[1]=Math.max(F,(F+_)/2)}else{M=_;var j=T+i[1]-i[0];O[0]=Math.min(v,(j+v)/2),O[1]=Math.max(v,(j+v)/2)}var V=[Math.min(v,(M+v)/2),Math.max(v,(M+v)/2)];if(t>V[0]&&t<=V[1]||t>=O[0]&&t<=O[1]){({index:c}=r[g]);break}}else{var q=Math.min(_,T),Y=Math.max(_,T);if(t>(q+v)/2&&t<=(Y+v)/2){({index:c}=r[g]);break}}}else if(e){for(var X=0;X<s;X++)if(X===0&&t<=(e[X].coordinate+e[X+1].coordinate)/2||X>0&&X<s-1&&t>(e[X].coordinate+e[X-1].coordinate)/2&&t<=(e[X].coordinate+e[X+1].coordinate)/2||X===s-1&&t>(e[X].coordinate+e[X-1].coordinate)/2){({index:c}=e[X]);break}}return c},eW=(t,e,r)=>{if(e&&r){var{width:n,height:i}=r,{align:a,verticalAlign:c,layout:s}=e;if((s==="vertical"||s==="horizontal"&&c==="middle")&&a!=="center"&&kr(t[a]))return ac(ac({},t),{},{[a]:t[a]+(n||0)});if((s==="horizontal"||s==="vertical"&&a==="center")&&c!=="middle"&&kr(t[c]))return ac(ac({},t),{},{[c]:t[c]+(i||0)})}return t},Hd=(t,e)=>t==="horizontal"&&e==="xAxis"||t==="vertical"&&e==="yAxis"||t==="centric"&&e==="angleAxis"||t==="radial"&&e==="radiusAxis",oL=(t,e,r,n)=>{if(n)return t.map(s=>s.coordinate);var i,a,c=t.map(s=>(s.coordinate===e&&(i=!0),s.coordinate===r&&(a=!0),s.coordinate));return i||c.push(e),a||c.push(r),c},lL=(t,e,r)=>{if(!t)return null;var{duplicateDomain:n,type:i,range:a,scale:c,realScaleType:s,isCategorical:g,categoricalDomain:_,tickCount:v,ticks:T,niceTicks:M,axisType:O}=t;if(!c)return null;var F=s==="scaleBand"&&c.bandwidth?c.bandwidth()/2:2,j=i==="category"&&c.bandwidth?c.bandwidth()/F:0;if(j=O==="angleAxis"&&a&&a.length>=2?lc(a[0]-a[1])*2*j:j,T||M){var V=(T||M||[]).map((q,Y)=>{var X=n?n.indexOf(q):q;return{coordinate:c(X)+j,value:q,offset:j,index:Y}});return V.filter(q=>!pc(q.coordinate))}return g&&_?_.map((q,Y)=>({coordinate:c(q)+j,value:q,index:Y,offset:j})):c.ticks&&v!=null?c.ticks(v).map((q,Y)=>({coordinate:c(q)+j,value:q,offset:j,index:Y})):c.domain().map((q,Y)=>({coordinate:c(q)+j,value:n?n[q]:q,index:Y,offset:j}))},dI=1e-4,tW=t=>{var e=t.domain();if(!(!e||e.length<=2)){var r=e.length,n=t.range(),i=Math.min(n[0],n[1])-dI,a=Math.max(n[0],n[1])+dI,c=t(e[0]),s=t(e[r-1]);(c<i||c>a||s<i||s>a)&&t.domain([e[0],e[r-1]])}},rW=t=>{var e=t.length;if(!(e<=0))for(var r=0,n=t[0].length;r<n;++r)for(var i=0,a=0,c=0;c<e;++c){var s=pc(t[c][r][1])?t[c][r][0]:t[c][r][1];s>=0?(t[c][r][0]=i,t[c][r][1]=i+s,i=t[c][r][1]):(t[c][r][0]=a,t[c][r][1]=a+s,a=t[c][r][1])}},nW=t=>{var e=t.length;if(!(e<=0))for(var r=0,n=t[0].length;r<n;++r)for(var i=0,a=0;a<e;++a){var c=pc(t[a][r][1])?t[a][r][0]:t[a][r][1];c>=0?(t[a][r][0]=i,t[a][r][1]=i+c,i=t[a][r][1]):(t[a][r][0]=0,t[a][r][1]=0)}},iW={sign:rW,expand:qV,none:yy,silhouette:GV,wiggle:XV,positive:nW},sW=(t,e,r)=>{var n=iW[r],i=WV().keys(e).value((a,c)=>+Ga(a,c,0)).order(MS).offset(n);return i(t)};function pI(t){var{axis:e,ticks:r,bandSize:n,entry:i,index:a,dataKey:c}=t;if(e.type==="category"){if(!e.allowDuplicatedCategory&&e.dataKey&&!Ks(i[e.dataKey])){var s=a6(r,"value",i[e.dataKey]);if(s)return s.coordinate+n/2}return r[a]?r[a].coordinate+n/2:null}var g=Ga(i,Ks(c)?e.dataKey:c);return Ks(g)?null:e.scale(g)}var aW=t=>{var e=t.flat(2).filter(kr);return[Math.min(...e),Math.max(...e)]},oW=t=>[t[0]===1/0?0:t[0],t[1]===-1/0?0:t[1]],lW=(t,e,r)=>{if(t!=null)return oW(Object.keys(t).reduce((n,i)=>{var a=t[i],{stackedData:c}=a,s=c.reduce((g,_)=>{var v=aL(_,e,r),T=aW(v);return[Math.min(g[0],T[0]),Math.max(g[1],T[1])]},[1/0,-1/0]);return[Math.min(s[0],n[0]),Math.max(s[1],n[1])]},[1/0,-1/0]))},gI=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,mI=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,zS=(t,e,r)=>{if(t&&t.scale&&t.scale.bandwidth){var n=t.scale.bandwidth();if(!r||n>0)return n}if(t&&e&&e.length>=2){for(var i=j1(e,v=>v.coordinate),a=1/0,c=1,s=i.length;c<s;c++){var g=i[c],_=i[c-1];a=Math.min((g.coordinate||0)-(_.coordinate||0),a)}return a===1/0?0:a}return r?void 0:0};function yI(t){var{tooltipEntrySettings:e,dataKey:r,payload:n,value:i,name:a}=t;return ac(ac({},e),{},{dataKey:r,payload:n,value:i,name:a})}function cL(t,e){if(t)return String(t);if(typeof e=="string")return e}function cW(t,e,r,n,i){if(r==="horizontal"||r==="vertical"){var a=t>=i.left&&t<=i.left+i.width&&e>=i.top&&e<=i.top+i.height;return a?{x:t,y:e}:null}return n?ZH({x:t,y:e},n):null}var uW=(t,e,r,n)=>{var i=e.find(_=>_&&_.index===r);if(i){if(t==="horizontal")return{x:i.coordinate,y:n.y};if(t==="vertical")return{x:n.x,y:i.coordinate};if(t==="centric"){var a=i.coordinate,{radius:c}=n;return ac(ac(ac({},n),ua(n.cx,n.cy,c,a)),{},{angle:a,radius:c})}var s=i.coordinate,{angle:g}=n;return ac(ac(ac({},n),ua(n.cx,n.cy,s,g)),{},{angle:g,radius:s})}return{x:0,y:0}},hW=(t,e)=>e==="horizontal"?t.x:e==="vertical"?t.y:e==="centric"?t.angle:t.radius,Tf=t=>t.layout.width,Sf=t=>t.layout.height,fW=t=>t.layout.scale,uL=t=>t.layout.margin,G1=wt(t=>t.cartesianAxis.xAxis,t=>Object.values(t)),X1=wt(t=>t.cartesianAxis.yAxis,t=>Object.values(t)),dW="data-recharts-item-index",pW="data-recharts-item-data-key",c0=60;function _I(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Ob(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?_I(Object(r),!0).forEach(function(n){gW(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):_I(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function gW(t,e,r){return(e=mW(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function mW(t){var e=yW(t,"string");return typeof e=="symbol"?e:e+""}function yW(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var _W=t=>t.brush.height;function vW(t){var e=X1(t);return e.reduce((r,n)=>{if(n.orientation==="left"&&!n.mirror&&!n.hide){var i=typeof n.width=="number"?n.width:c0;return r+i}return r},0)}function bW(t){var e=X1(t);return e.reduce((r,n)=>{if(n.orientation==="right"&&!n.mirror&&!n.hide){var i=typeof n.width=="number"?n.width:c0;return r+i}return r},0)}function xW(t){var e=G1(t);return e.reduce((r,n)=>n.orientation==="top"&&!n.mirror&&!n.hide?r+n.height:r,0)}function wW(t){var e=G1(t);return e.reduce((r,n)=>n.orientation==="bottom"&&!n.mirror&&!n.hide?r+n.height:r,0)}var da=wt([Tf,Sf,uL,_W,vW,bW,xW,wW,L6,U$],(t,e,r,n,i,a,c,s,g,_)=>{var v={left:(r.left||0)+i,right:(r.right||0)+a},T={top:(r.top||0)+c,bottom:(r.bottom||0)+s},M=Ob(Ob({},T),v),O=M.bottom;M.bottom+=n,M=eW(M,g,_);var F=t-M.left-M.right,j=e-M.top-M.bottom;return Ob(Ob({brushBottom:O},M),{},{width:Math.max(F,0),height:Math.max(j,0)})}),TW=wt(da,t=>({x:t.left,y:t.top,width:t.width,height:t.height})),hL=wt(Tf,Sf,(t,e)=>({x:0,y:0,width:t,height:e})),SW=Q.createContext(null),vc=()=>Q.useContext(SW)!=null,Z1=t=>t.brush,Y1=wt([Z1,da,uL],(t,e,r)=>({height:t.height,x:kr(t.x)?t.x:e.left,y:kr(t.y)?t.y:e.top+e.height+e.brushBottom-(r?.bottom||0),width:kr(t.width)?t.width:e.width})),XE=()=>{var t,e=vc(),r=br(TW),n=br(Y1),i=(t=br(Z1))===null||t===void 0?void 0:t.padding;return!e||!n||!i?r:{width:n.width-i.left-i.right,height:n.height-i.top-i.bottom,x:i.left,y:i.top}},AW={top:0,bottom:0,left:0,right:0,width:0,height:0,brushBottom:0},fL=()=>{var t;return(t=br(da))!==null&&t!==void 0?t:AW},dL=()=>br(Tf),pL=()=>br(Sf),mi=t=>t.layout.layoutType,ZE=()=>br(mi),EW={settings:{layout:"horizontal",align:"center",verticalAlign:"middle",itemSorter:"value"},size:{width:0,height:0},payload:[]},gL=wl({name:"legend",initialState:EW,reducers:{setLegendSize(t,e){t.size.width=e.payload.width,t.size.height=e.payload.height},setLegendSettings(t,e){t.settings.align=e.payload.align,t.settings.layout=e.payload.layout,t.settings.verticalAlign=e.payload.verticalAlign,t.settings.itemSorter=e.payload.itemSorter},addLegendPayload(t,e){t.payload.push(e.payload)},removeLegendPayload(t,e){var r=ff(t).payload.indexOf(e.payload);r>-1&&t.payload.splice(r,1)}}}),{setLegendSize:Fye,setLegendSettings:Uye,addLegendPayload:CW,removeLegendPayload:PW}=gL.actions,MW=gL.reducer;function FS(){return FS=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},FS.apply(null,arguments)}function vI(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function rT(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?vI(Object(r),!0).forEach(function(n){IW(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):vI(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function IW(t,e,r){return(e=RW(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function RW(t){var e=OW(t,"string");return typeof e=="symbol"?e:e+""}function OW(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function kW(t){return Array.isArray(t)&&ah(t[0])&&ah(t[1])?t.join(" ~ "):t}var DW=t=>{var{separator:e=" : ",contentStyle:r={},itemStyle:n={},labelStyle:i={},payload:a,formatter:c,itemSorter:s,wrapperClassName:g,labelClassName:_,label:v,labelFormatter:T,accessibilityLayer:M=!1}=t,O=()=>{if(a&&a.length){var ue={padding:0,margin:0},ge=(s?j1(a,s):a).map((Le,qe)=>{if(Le.type==="none")return null;var Ze=Le.formatter||c||kW,{value:_t,name:it}=Le,gt=_t,Lt=it;if(Ze){var Ot=Ze(_t,it,Le,qe,a);if(Array.isArray(Ot))[gt,Lt]=Ot;else if(Ot!=null)gt=Ot;else return null}var Yt=rT({display:"block",paddingTop:4,paddingBottom:4,color:Le.color||"#000"},n);return Q.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(qe),style:Yt},ah(Lt)?Q.createElement("span",{className:"recharts-tooltip-item-name"},Lt):null,ah(Lt)?Q.createElement("span",{className:"recharts-tooltip-item-separator"},e):null,Q.createElement("span",{className:"recharts-tooltip-item-value"},gt),Q.createElement("span",{className:"recharts-tooltip-item-unit"},Le.unit||""))});return Q.createElement("ul",{className:"recharts-tooltip-item-list",style:ue},ge)}return null},F=rT({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},r),j=rT({margin:0},i),V=!Ks(v),q=V?v:"",Y=gi("recharts-default-tooltip",g),X=gi("recharts-tooltip-label",_);V&&T&&a!==void 0&&a!==null&&(q=T(v,a));var ae=M?{role:"status","aria-live":"assertive"}:{};return Q.createElement("div",FS({className:Y,style:F},ae),Q.createElement("p",{className:X,style:j},Q.isValidElement(q)?q:"".concat(q)),O())},iv="recharts-tooltip-wrapper",LW={visibility:"hidden"};function BW(t){var{coordinate:e,translateX:r,translateY:n}=t;return gi(iv,{["".concat(iv,"-right")]:kr(r)&&e&&kr(e.x)&&r>=e.x,["".concat(iv,"-left")]:kr(r)&&e&&kr(e.x)&&r<e.x,["".concat(iv,"-bottom")]:kr(n)&&e&&kr(e.y)&&n>=e.y,["".concat(iv,"-top")]:kr(n)&&e&&kr(e.y)&&n<e.y})}function bI(t){var{allowEscapeViewBox:e,coordinate:r,key:n,offsetTopLeft:i,position:a,reverseDirection:c,tooltipDimension:s,viewBox:g,viewBoxDimension:_}=t;if(a&&kr(a[n]))return a[n];var v=r[n]-s-(i>0?i:0),T=r[n]+i;if(e[n])return c[n]?v:T;var M=g[n];if(M==null)return 0;if(c[n]){var O=v,F=M;return O<F?Math.max(T,M):Math.max(v,M)}if(_==null)return 0;var j=T+s,V=M+_;return j>V?Math.max(v,M):Math.max(T,M)}function NW(t){var{translateX:e,translateY:r,useTranslate3d:n}=t;return{transform:n?"translate3d(".concat(e,"px, ").concat(r,"px, 0)"):"translate(".concat(e,"px, ").concat(r,"px)")}}function zW(t){var{allowEscapeViewBox:e,coordinate:r,offsetTopLeft:n,position:i,reverseDirection:a,tooltipBox:c,useTranslate3d:s,viewBox:g}=t,_,v,T;return c.height>0&&c.width>0&&r?(v=bI({allowEscapeViewBox:e,coordinate:r,key:"x",offsetTopLeft:n,position:i,reverseDirection:a,tooltipDimension:c.width,viewBox:g,viewBoxDimension:g.width}),T=bI({allowEscapeViewBox:e,coordinate:r,key:"y",offsetTopLeft:n,position:i,reverseDirection:a,tooltipDimension:c.height,viewBox:g,viewBoxDimension:g.height}),_=NW({translateX:v,translateY:T,useTranslate3d:s})):_=LW,{cssProperties:_,cssClasses:BW({translateX:v,translateY:T,coordinate:r})}}function xI(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function kb(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?xI(Object(r),!0).forEach(function(n){US(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):xI(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function US(t,e,r){return(e=FW(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function FW(t){var e=UW(t,"string");return typeof e=="symbol"?e:e+""}function UW(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class jW extends Q.PureComponent{constructor(){super(...arguments),US(this,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0}}),US(this,"handleKeyDown",e=>{if(e.key==="Escape"){var r,n,i,a;this.setState({dismissed:!0,dismissedAtCoordinate:{x:(r=(n=this.props.coordinate)===null||n===void 0?void 0:n.x)!==null&&r!==void 0?r:0,y:(i=(a=this.props.coordinate)===null||a===void 0?void 0:a.y)!==null&&i!==void 0?i:0}})}})}componentDidMount(){document.addEventListener("keydown",this.handleKeyDown)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeyDown)}componentDidUpdate(){var e,r;this.state.dismissed&&(((e=this.props.coordinate)===null||e===void 0?void 0:e.x)!==this.state.dismissedAtCoordinate.x||((r=this.props.coordinate)===null||r===void 0?void 0:r.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}render(){var{active:e,allowEscapeViewBox:r,animationDuration:n,animationEasing:i,children:a,coordinate:c,hasPayload:s,isAnimationActive:g,offset:_,position:v,reverseDirection:T,useTranslate3d:M,viewBox:O,wrapperStyle:F,lastBoundingBox:j,innerRef:V,hasPortalFromProps:q}=this.props,{cssClasses:Y,cssProperties:X}=zW({allowEscapeViewBox:r,coordinate:c,offsetTopLeft:_,position:v,reverseDirection:T,tooltipBox:{height:j.height,width:j.width},useTranslate3d:M,viewBox:O}),ae=q?{}:kb(kb({transition:g&&e?"transform ".concat(n,"ms ").concat(i):void 0},X),{},{pointerEvents:"none",visibility:!this.state.dismissed&&e&&s?"visible":"hidden",position:"absolute",top:0,left:0}),ue=kb(kb({},ae),{},{visibility:!this.state.dismissed&&e&&s?"visible":"hidden"},F);return Q.createElement("div",{xmlns:"http://www.w3.org/1999/xhtml",tabIndex:-1,className:Y,style:ue,ref:V},a)}}var VW=()=>!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout),zy={devToolsEnabled:!1,isSsr:VW()},mL=()=>br(t=>t.rootProps.accessibilityLayer);function cu(t){return Number.isFinite(t)}function Vx(t){return typeof t=="number"&&t>0&&Number.isFinite(t)}function jS(){return jS=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},jS.apply(null,arguments)}function wI(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function TI(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?wI(Object(r),!0).forEach(function(n){$W(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):wI(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function $W(t,e,r){return(e=HW(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function HW(t){var e=WW(t,"string");return typeof e=="symbol"?e:e+""}function WW(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var SI={curveBasisClosed:DV,curveBasisOpen:LV,curveBasis:kV,curveBumpX:RV,curveBumpY:OV,curveLinearClosed:BV,curveLinear:F1,curveMonotoneX:NV,curveMonotoneY:zV,curveNatural:FV,curveStep:UV,curveStepAfter:VV,curveStepBefore:jV},Db=t=>cu(t.x)&&cu(t.y),sv=t=>t.x,av=t=>t.y,qW=(t,e)=>{if(typeof t=="function")return t;var r="curve".concat(LE(t));return(r==="curveMonotone"||r==="curveBump")&&e?SI["".concat(r).concat(e==="vertical"?"Y":"X")]:SI[r]||F1},GW=t=>{var{type:e="linear",points:r=[],baseLine:n,layout:i,connectNulls:a=!1}=t,c=qW(e,i),s=a?r.filter(Db):r,g;if(Array.isArray(n)){var _=a?n.filter(T=>Db(T)):n,v=s.map((T,M)=>TI(TI({},T),{},{base:_[M]}));return i==="vertical"?g=Eb().y(av).x1(sv).x0(T=>T.base.x):g=Eb().x(sv).y1(av).y0(T=>T.base.y),g.defined(Db).curve(c),g(v)}return i==="vertical"&&kr(n)?g=Eb().y(av).x1(sv).x0(n):kr(n)?g=Eb().x(sv).y1(av).y0(n):g=g6().x(sv).y(av),g.defined(Db).curve(c),g(s)},yL=t=>{var{className:e,points:r,path:n,pathRef:i}=t;if((!r||!r.length)&&!n)return null;var a=r&&r.length?GW(t):n;return Q.createElement("path",jS({},Bg(t),NE(t),{className:gi("recharts-curve",e),d:a===null?void 0:a,ref:i}))},XW=["x","y","top","left","width","height","className"];function VS(){return VS=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},VS.apply(null,arguments)}function AI(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function ZW(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?AI(Object(r),!0).forEach(function(n){YW(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):AI(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function YW(t,e,r){return(e=KW(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function KW(t){var e=QW(t,"string");return typeof e=="symbol"?e:e+""}function QW(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function JW(t,e){if(t==null)return{};var r,n,i=eq(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)r=a[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function eq(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}var tq=(t,e,r,n,i,a)=>"M".concat(t,",").concat(i,"v").concat(n,"M").concat(a,",").concat(e,"h").concat(r),rq=t=>{var{x:e=0,y:r=0,top:n=0,left:i=0,width:a=0,height:c=0,className:s}=t,g=JW(t,XW),_=ZW({x:e,y:r,top:n,left:i,width:a,height:c},g);return!kr(e)||!kr(r)||!kr(a)||!kr(c)||!kr(n)||!kr(i)?null:Q.createElement("path",VS({},ha(_,!0),{className:gi("recharts-cross",s),d:tq(e,r,a,c,n,i)}))};function nq(t,e,r,n){var i=n/2;return{stroke:"none",fill:"#ccc",x:t==="horizontal"?e.x-i:r.left+.5,y:t==="horizontal"?r.top+.5:e.y-i,width:t==="horizontal"?n:r.width-1,height:t==="horizontal"?r.height-1:n}}function EI(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function iq(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?EI(Object(r),!0).forEach(function(n){sq(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):EI(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function sq(t,e,r){return(e=aq(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function aq(t){var e=oq(t,"string");return typeof e=="symbol"?e:e+""}function oq(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function bc(t,e){var r=iq({},t),n=e,i=Object.keys(e),a=i.reduce((c,s)=>(c[s]===void 0&&n[s]!==void 0&&(c[s]=n[s]),c),r);return a}function lq(){}function CI(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function PI(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?CI(Object(r),!0).forEach(function(n){cq(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):CI(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function cq(t,e,r){return(e=uq(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function uq(t){var e=hq(t,"string");return typeof e=="symbol"?e:e+""}function hq(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var fq=t=>t.replace(/([A-Z])/g,e=>"-".concat(e.toLowerCase())),dq=(t,e,r)=>t.map(n=>"".concat(fq(n)," ").concat(e,"ms ").concat(r)).join(","),pq=(t,e)=>[Object.keys(t),Object.keys(e)].reduce((r,n)=>r.filter(i=>n.includes(i))),Hv=(t,e)=>Object.keys(e).reduce((r,n)=>PI(PI({},r),{},{[n]:t(n,e[n])}),{});function MI(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function la(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?MI(Object(r),!0).forEach(function(n){gq(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):MI(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function gq(t,e,r){return(e=mq(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function mq(t){var e=yq(t,"string");return typeof e=="symbol"?e:e+""}function yq(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var $x=(t,e,r)=>t+(e-t)*r,$S=t=>{var{from:e,to:r}=t;return e!==r},_L=(t,e,r)=>{var n=Hv((i,a)=>{if($S(a)){var[c,s]=t(a.from,a.to,a.velocity);return la(la({},a),{},{from:c,velocity:s})}return a},e);return r<1?Hv((i,a)=>$S(a)?la(la({},a),{},{velocity:$x(a.velocity,n[i].velocity,r),from:$x(a.from,n[i].from,r)}):a,e):_L(t,n,r-1)};function _q(t,e,r,n,i,a){var c,s=n.reduce((M,O)=>la(la({},M),{},{[O]:{from:t[O],velocity:0,to:e[O]}}),{}),g=()=>Hv((M,O)=>O.from,s),_=()=>!Object.values(s).filter($S).length,v=null,T=M=>{c||(c=M);var O=M-c,F=O/r.dt;s=_L(r,s,F),i(la(la(la({},t),e),g())),c=M,_()||(v=a.setTimeout(T))};return()=>(v=a.setTimeout(T),()=>{v()})}function vq(t,e,r,n,i,a,c){var s=null,g=i.reduce((T,M)=>la(la({},T),{},{[M]:[t[M],e[M]]}),{}),_,v=T=>{_||(_=T);var M=(T-_)/n,O=Hv((j,V)=>$x(...V,r(M)),g);if(a(la(la(la({},t),e),O)),M<1)s=c.setTimeout(v);else{var F=Hv((j,V)=>$x(...V,r(1)),g);a(la(la(la({},t),e),F))}};return()=>(s=c.setTimeout(v),()=>{s()})}const bq=(t,e,r,n,i,a)=>{var c=pq(t,e);return r.isStepper===!0?_q(t,e,r,c,i,a):vq(t,e,r,n,c,i,a)};var Hx=1e-4,vL=(t,e)=>[0,3*t,3*e-6*t,3*t-3*e+1],bL=(t,e)=>t.map((r,n)=>r*e**n).reduce((r,n)=>r+n),II=(t,e)=>r=>{var n=vL(t,e);return bL(n,r)},xq=(t,e)=>r=>{var n=vL(t,e),i=[...n.map((a,c)=>a*c).slice(1),0];return bL(i,r)},RI=function(){for(var e,r,n,i,a=arguments.length,c=new Array(a),s=0;s<a;s++)c[s]=arguments[s];if(c.length===1)switch(c[0]){case"linear":[e,n,r,i]=[0,0,1,1];break;case"ease":[e,n,r,i]=[.25,.1,.25,1];break;case"ease-in":[e,n,r,i]=[.42,0,1,1];break;case"ease-out":[e,n,r,i]=[.42,0,.58,1];break;case"ease-in-out":[e,n,r,i]=[0,0,.58,1];break;default:{var g=c[0].split("(");g[0]==="cubic-bezier"&&g[1].split(")")[0].split(",").length===4&&([e,n,r,i]=g[1].split(")")[0].split(",").map(F=>parseFloat(F)))}}else c.length===4&&([e,n,r,i]=c);var _=II(e,r),v=II(n,i),T=xq(e,r),M=F=>F>1?1:F<0?0:F,O=F=>{for(var j=F>1?1:F,V=j,q=0;q<8;++q){var Y=_(V)-j,X=T(V);if(Math.abs(Y-j)<Hx||X<Hx)return v(V);V=M(V-Y/X)}return v(V)};return O.isStepper=!1,O},wq=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{stiff:r=100,damping:n=8,dt:i=17}=e,a=(c,s,g)=>{var _=-(c-s)*r,v=g*n,T=g+(_-v)*i/1e3,M=g*i/1e3+c;return Math.abs(M-s)<Hx&&Math.abs(T)<Hx?[s,0]:[M,T]};return a.isStepper=!0,a.dt=i,a},Tq=t=>{if(typeof t=="string")switch(t){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return RI(t);case"spring":return wq();default:if(t.split("(")[0]==="cubic-bezier")return RI(t)}return typeof t=="function"?t:null};function Sq(t){var e,r=()=>null,n=!1,i=null,a=c=>{if(!n){if(Array.isArray(c)){if(!c.length)return;var s=c,[g,..._]=s;if(typeof g=="number"){i=t.setTimeout(a.bind(null,_),g);return}a(g),i=t.setTimeout(a.bind(null,_));return}typeof c=="string"&&(e=c,r(e)),typeof c=="object"&&(e=c,r(e)),typeof c=="function"&&c()}};return{stop:()=>{n=!0},start:c=>{n=!1,i&&(i(),i=null),a(c)},subscribe:c=>(r=c,()=>{r=()=>null}),getTimeoutController:()=>t}}class Aq{setTimeout(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=performance.now(),i=null,a=c=>{c-n>=r?e(c):typeof requestAnimationFrame=="function"&&(i=requestAnimationFrame(a))};return i=requestAnimationFrame(a),()=>{cancelAnimationFrame(i)}}}function Eq(){return Sq(new Aq)}var Cq=Q.createContext(Eq);function Pq(t,e){var r=Q.useContext(Cq);return Q.useMemo(()=>e??r(t),[t,e,r])}var Mq={begin:0,duration:1e3,easing:"ease",isActive:!0,canBegin:!0,onAnimationEnd:()=>{},onAnimationStart:()=>{}},OI={t:0},nT={t:1};function xL(t){var e=bc(t,Mq),{isActive:r,canBegin:n,duration:i,easing:a,begin:c,onAnimationEnd:s,onAnimationStart:g,children:_}=e,v=Pq(e.animationId,e.animationManager),[T,M]=Q.useState(r?OI:nT),O=Q.useRef(null);return Q.useEffect(()=>{r||M(nT)},[r]),Q.useEffect(()=>{if(!r||!n)return lq;var F=bq(OI,nT,Tq(a),i,M,v.getTimeoutController()),j=()=>{O.current=F()};return v.start([g,c,j,i,s]),()=>{v.stop(),O.current&&O.current(),s()}},[r,n,i,a,c,g,s,v]),_(T.t)}function wL(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"animation-",r=Q.useRef(jv(e)),n=Q.useRef(t);return n.current!==t&&(r.current=jv(e),n.current=t),r.current}function kI(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function DI(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?kI(Object(r),!0).forEach(function(n){Iq(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):kI(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Iq(t,e,r){return(e=Rq(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Rq(t){var e=Oq(t,"string");return typeof e=="symbol"?e:e+""}function Oq(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Wx(){return Wx=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Wx.apply(null,arguments)}var LI=(t,e,r,n,i)=>{var a=Math.min(Math.abs(r)/2,Math.abs(n)/2),c=n>=0?1:-1,s=r>=0?1:-1,g=n>=0&&r>=0||n<0&&r<0?1:0,_;if(a>0&&i instanceof Array){for(var v=[0,0,0,0],T=0,M=4;T<M;T++)v[T]=i[T]>a?a:i[T];_="M".concat(t,",").concat(e+c*v[0]),v[0]>0&&(_+="A ".concat(v[0],",").concat(v[0],",0,0,").concat(g,",").concat(t+s*v[0],",").concat(e)),_+="L ".concat(t+r-s*v[1],",").concat(e),v[1]>0&&(_+="A ".concat(v[1],",").concat(v[1],",0,0,").concat(g,`,
        `).concat(t+r,",").concat(e+c*v[1])),_+="L ".concat(t+r,",").concat(e+n-c*v[2]),v[2]>0&&(_+="A ".concat(v[2],",").concat(v[2],",0,0,").concat(g,`,
        `).concat(t+r-s*v[2],",").concat(e+n)),_+="L ".concat(t+s*v[3],",").concat(e+n),v[3]>0&&(_+="A ".concat(v[3],",").concat(v[3],",0,0,").concat(g,`,
        `).concat(t,",").concat(e+n-c*v[3])),_+="Z"}else if(a>0&&i===+i&&i>0){var O=Math.min(a,i);_="M ".concat(t,",").concat(e+c*O,`
            A `).concat(O,",").concat(O,",0,0,").concat(g,",").concat(t+s*O,",").concat(e,`
            L `).concat(t+r-s*O,",").concat(e,`
            A `).concat(O,",").concat(O,",0,0,").concat(g,",").concat(t+r,",").concat(e+c*O,`
            L `).concat(t+r,",").concat(e+n-c*O,`
            A `).concat(O,",").concat(O,",0,0,").concat(g,",").concat(t+r-s*O,",").concat(e+n,`
            L `).concat(t+s*O,",").concat(e+n,`
            A `).concat(O,",").concat(O,",0,0,").concat(g,",").concat(t,",").concat(e+n-c*O," Z")}else _="M ".concat(t,",").concat(e," h ").concat(r," v ").concat(n," h ").concat(-r," Z");return _},kq={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},Dq=t=>{var e=bc(t,kq),r=Q.useRef(null),[n,i]=Q.useState(-1);Q.useEffect(()=>{if(r.current&&r.current.getTotalLength)try{var Ot=r.current.getTotalLength();Ot&&i(Ot)}catch{}},[]);var{x:a,y:c,width:s,height:g,radius:_,className:v}=e,{animationEasing:T,animationDuration:M,animationBegin:O,isAnimationActive:F,isUpdateAnimationActive:j}=e,V=Q.useRef(s),q=Q.useRef(g),Y=Q.useRef(a),X=Q.useRef(c),ae=Q.useMemo(()=>({x:a,y:c,width:s,height:g,radius:_}),[a,c,s,g,_]),ue=wL(ae,"rectangle-");if(a!==+a||c!==+c||s!==+s||g!==+g||s===0||g===0)return null;var ge=gi("recharts-rectangle",v);if(!j)return Q.createElement("path",Wx({},ha(e,!0),{className:ge,d:LI(a,c,s,g,_)}));var Le=V.current,qe=q.current,Ze=Y.current,_t=X.current,it="0px ".concat(n===-1?1:n,"px"),gt="".concat(n,"px 0px"),Lt=dq(["strokeDasharray"],M,typeof T=="string"?T:void 0);return Q.createElement(xL,{animationId:ue,key:ue,canBegin:n>0,duration:M,easing:T,isActive:j,begin:O},Ot=>{var Yt=af(Le,s,Ot),ce=af(qe,g,Ot),we=af(Ze,a,Ot),Re=af(_t,c,Ot);r.current&&(V.current=Yt,q.current=ce,Y.current=we,X.current=Re);var Ue;return F?Ot>0?Ue={transition:Lt,strokeDasharray:gt}:Ue={strokeDasharray:it}:Ue={strokeDasharray:gt},Q.createElement("path",Wx({},ha(e,!0),{className:ge,d:LI(we,Re,Yt,ce,_),ref:r,style:DI(DI({},Ue),e.style)}))})};function TL(t){var{cx:e,cy:r,radius:n,startAngle:i,endAngle:a}=t,c=ua(e,r,n,i),s=ua(e,r,n,a);return{points:[c,s],cx:e,cy:r,radius:n,startAngle:i,endAngle:a}}function HS(){return HS=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},HS.apply(null,arguments)}var Lq=(t,e)=>{var r=lc(e-t),n=Math.min(Math.abs(e-t),359.999);return r*n},Lb=t=>{var{cx:e,cy:r,radius:n,angle:i,sign:a,isExternal:c,cornerRadius:s,cornerIsExternal:g}=t,_=s*(c?1:-1)+n,v=Math.asin(s/_)/jx,T=g?i:i+a*v,M=ua(e,r,_,T),O=ua(e,r,n,T),F=g?i-a*v:i,j=ua(e,r,_*Math.cos(v*jx),F);return{center:M,circleTangency:O,lineTangency:j,theta:v}},SL=t=>{var{cx:e,cy:r,innerRadius:n,outerRadius:i,startAngle:a,endAngle:c}=t,s=Lq(a,c),g=a+s,_=ua(e,r,i,a),v=ua(e,r,i,g),T="M ".concat(_.x,",").concat(_.y,`
    A `).concat(i,",").concat(i,`,0,
    `).concat(+(Math.abs(s)>180),",").concat(+(a>g),`,
    `).concat(v.x,",").concat(v.y,`
  `);if(n>0){var M=ua(e,r,n,a),O=ua(e,r,n,g);T+="L ".concat(O.x,",").concat(O.y,`
            A `).concat(n,",").concat(n,`,0,
            `).concat(+(Math.abs(s)>180),",").concat(+(a<=g),`,
            `).concat(M.x,",").concat(M.y," Z")}else T+="L ".concat(e,",").concat(r," Z");return T},Bq=t=>{var{cx:e,cy:r,innerRadius:n,outerRadius:i,cornerRadius:a,forceCornerRadius:c,cornerIsExternal:s,startAngle:g,endAngle:_}=t,v=lc(_-g),{circleTangency:T,lineTangency:M,theta:O}=Lb({cx:e,cy:r,radius:i,angle:g,sign:v,cornerRadius:a,cornerIsExternal:s}),{circleTangency:F,lineTangency:j,theta:V}=Lb({cx:e,cy:r,radius:i,angle:_,sign:-v,cornerRadius:a,cornerIsExternal:s}),q=s?Math.abs(g-_):Math.abs(g-_)-O-V;if(q<0)return c?"M ".concat(M.x,",").concat(M.y,`
        a`).concat(a,",").concat(a,",0,0,1,").concat(a*2,`,0
        a`).concat(a,",").concat(a,",0,0,1,").concat(-a*2,`,0
      `):SL({cx:e,cy:r,innerRadius:n,outerRadius:i,startAngle:g,endAngle:_});var Y="M ".concat(M.x,",").concat(M.y,`
    A`).concat(a,",").concat(a,",0,0,").concat(+(v<0),",").concat(T.x,",").concat(T.y,`
    A`).concat(i,",").concat(i,",0,").concat(+(q>180),",").concat(+(v<0),",").concat(F.x,",").concat(F.y,`
    A`).concat(a,",").concat(a,",0,0,").concat(+(v<0),",").concat(j.x,",").concat(j.y,`
  `);if(n>0){var{circleTangency:X,lineTangency:ae,theta:ue}=Lb({cx:e,cy:r,radius:n,angle:g,sign:v,isExternal:!0,cornerRadius:a,cornerIsExternal:s}),{circleTangency:ge,lineTangency:Le,theta:qe}=Lb({cx:e,cy:r,radius:n,angle:_,sign:-v,isExternal:!0,cornerRadius:a,cornerIsExternal:s}),Ze=s?Math.abs(g-_):Math.abs(g-_)-ue-qe;if(Ze<0&&a===0)return"".concat(Y,"L").concat(e,",").concat(r,"Z");Y+="L".concat(Le.x,",").concat(Le.y,`
      A`).concat(a,",").concat(a,",0,0,").concat(+(v<0),",").concat(ge.x,",").concat(ge.y,`
      A`).concat(n,",").concat(n,",0,").concat(+(Ze>180),",").concat(+(v>0),",").concat(X.x,",").concat(X.y,`
      A`).concat(a,",").concat(a,",0,0,").concat(+(v<0),",").concat(ae.x,",").concat(ae.y,"Z")}else Y+="L".concat(e,",").concat(r,"Z");return Y},Nq={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},zq=t=>{var e=bc(t,Nq),{cx:r,cy:n,innerRadius:i,outerRadius:a,cornerRadius:c,forceCornerRadius:s,cornerIsExternal:g,startAngle:_,endAngle:v,className:T}=e;if(a<i||_===v)return null;var M=gi("recharts-sector",T),O=a-i,F=Fd(c,O,0,!0),j;return F>0&&Math.abs(_-v)<360?j=Bq({cx:r,cy:n,innerRadius:i,outerRadius:a,cornerRadius:Math.min(F,O/2),forceCornerRadius:s,cornerIsExternal:g,startAngle:_,endAngle:v}):j=SL({cx:r,cy:n,innerRadius:i,outerRadius:a,startAngle:_,endAngle:v}),Q.createElement("path",HS({},ha(e,!0),{className:M,d:j}))};function Fq(t,e,r){var n,i,a,c;if(t==="horizontal")n=e.x,a=n,i=r.top,c=r.top+r.height;else if(t==="vertical")i=e.y,c=i,n=r.left,a=r.left+r.width;else if(e.cx!=null&&e.cy!=null)if(t==="centric"){var{cx:s,cy:g,innerRadius:_,outerRadius:v,angle:T}=e,M=ua(s,g,_,T),O=ua(s,g,v,T);n=M.x,i=M.y,a=O.x,c=O.y}else return TL(e);return[{x:n,y:i},{x:a,y:c}]}var iT={},sT={},aT={},BI;function Uq(){return BI||(BI=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=k6();function r(n){return e.isSymbol(n)?NaN:Number(n)}t.toNumber=r})(aT)),aT}var NI;function jq(){return NI||(NI=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=Uq();function r(n){return n?(n=e.toNumber(n),n===1/0||n===-1/0?(n<0?-1:1)*Number.MAX_VALUE:n===n?n:0):n===0?n:0}t.toFinite=r})(sT)),sT}var zI;function Vq(){return zI||(zI=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=D6(),r=jq();function n(i,a,c){c&&typeof c!="number"&&e.isIterateeCall(i,a,c)&&(a=c=void 0),i=r.toFinite(i),a===void 0?(a=i,i=0):a=r.toFinite(a),c=c===void 0?i<a?1:-1:r.toFinite(c);const s=Math.max(Math.ceil((a-i)/(c||1)),0),g=new Array(s);for(let _=0;_<s;_++)g[_]=i,i+=c;return g}t.range=n})(iT)),iT}var oT,FI;function $q(){return FI||(FI=1,oT=Vq().range),oT}var Hq=$q();const AL=xl(Hq),pv=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:iE,scaleDiverging:D4,scaleDivergingLog:L4,scaleDivergingPow:AE,scaleDivergingSqrt:c9,scaleDivergingSymlog:B4,scaleIdentity:g4,scaleImplicit:vS,scaleLinear:R1,scaleLog:y4,scaleOrdinal:nE,scalePoint:YU,scalePow:pE,scaleQuantile:b4,scaleQuantize:x4,scaleRadial:v4,scaleSequential:I4,scaleSequentialLog:R4,scaleSequentialPow:SE,scaleSequentialQuantile:k4,scaleSequentialSqrt:l9,scaleSequentialSymlog:O4,scaleSqrt:$j,scaleSymlog:_4,scaleThreshold:gE,scaleTime:a9,scaleUtc:o9,tickFormat:p4},Symbol.toStringTag,{value:"Module"}));var Wd=t=>t.chartData,Wq=wt([Wd],t=>{var e=t.chartData!=null?t.chartData.length-1:0;return{chartData:t.chartData,computedData:t.computedData,dataEndIndex:e,dataStartIndex:0}}),YE=(t,e,r,n)=>n?Wq(t):Wd(t);function vy(t){if(Array.isArray(t)&&t.length===2){var[e,r]=t;if(cu(e)&&cu(r))return!0}return!1}function UI(t,e,r){return r?t:[Math.min(t[0],e[0]),Math.max(t[1],e[1])]}function qq(t,e){if(e&&typeof t!="function"&&Array.isArray(t)&&t.length===2){var[r,n]=t,i,a;if(cu(r))i=r;else if(typeof r=="function")return;if(cu(n))a=n;else if(typeof n=="function")return;var c=[i,a];if(vy(c))return c}}function Gq(t,e,r){if(!(!r&&e==null)){if(typeof t=="function"&&e!=null)try{var n=t(e,r);if(vy(n))return UI(n,e,r)}catch{}if(Array.isArray(t)&&t.length===2){var[i,a]=t,c,s;if(i==="auto")e!=null&&(c=Math.min(...e));else if(kr(i))c=i;else if(typeof i=="function")try{e!=null&&(c=i(e?.[0]))}catch{}else if(typeof i=="string"&&gI.test(i)){var g=gI.exec(i);if(g==null||e==null)c=void 0;else{var _=+g[1];c=e[0]-_}}else c=e?.[0];if(a==="auto")e!=null&&(s=Math.max(...e));else if(kr(a))s=a;else if(typeof a=="function")try{e!=null&&(s=a(e?.[1]))}catch{}else if(typeof a=="string"&&mI.test(a)){var v=mI.exec(a);if(v==null||e==null)s=void 0;else{var T=+v[1];s=e[1]+T}}else s=e?.[1];var M=[c,s];if(vy(M))return e==null?M:UI(M,e,r)}}}var Fy=1e9,Xq={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},QE,Si=!0,mc="[DecimalError] ",mg=mc+"Invalid argument: ",KE=mc+"Exponent out of range: ",Uy=Math.floor,ig=Math.pow,Zq=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,yl,Zs=1e7,di=7,EL=9007199254740991,qx=Uy(EL/di),sr={};sr.absoluteValue=sr.abs=function(){var t=new this.constructor(this);return t.s&&(t.s=1),t};sr.comparedTo=sr.cmp=function(t){var e,r,n,i,a=this;if(t=new a.constructor(t),a.s!==t.s)return a.s||-t.s;if(a.e!==t.e)return a.e>t.e^a.s<0?1:-1;for(n=a.d.length,i=t.d.length,e=0,r=n<i?n:i;e<r;++e)if(a.d[e]!==t.d[e])return a.d[e]>t.d[e]^a.s<0?1:-1;return n===i?0:n>i^a.s<0?1:-1};sr.decimalPlaces=sr.dp=function(){var t=this,e=t.d.length-1,r=(e-t.e)*di;if(e=t.d[e],e)for(;e%10==0;e/=10)r--;return r<0?0:r};sr.dividedBy=sr.div=function(t){return df(this,new this.constructor(t))};sr.dividedToIntegerBy=sr.idiv=function(t){var e=this,r=e.constructor;return Qn(df(e,new r(t),0,1),r.precision)};sr.equals=sr.eq=function(t){return!this.cmp(t)};sr.exponent=function(){return ds(this)};sr.greaterThan=sr.gt=function(t){return this.cmp(t)>0};sr.greaterThanOrEqualTo=sr.gte=function(t){return this.cmp(t)>=0};sr.isInteger=sr.isint=function(){return this.e>this.d.length-2};sr.isNegative=sr.isneg=function(){return this.s<0};sr.isPositive=sr.ispos=function(){return this.s>0};sr.isZero=function(){return this.s===0};sr.lessThan=sr.lt=function(t){return this.cmp(t)<0};sr.lessThanOrEqualTo=sr.lte=function(t){return this.cmp(t)<1};sr.logarithm=sr.log=function(t){var e,r=this,n=r.constructor,i=n.precision,a=i+5;if(t===void 0)t=new n(10);else if(t=new n(t),t.s<1||t.eq(yl))throw Error(mc+"NaN");if(r.s<1)throw Error(mc+(r.s?"NaN":"-Infinity"));return r.eq(yl)?new n(0):(Si=!1,e=df(Wv(r,a),Wv(t,a),a),Si=!0,Qn(e,i))};sr.minus=sr.sub=function(t){var e=this;return t=new e.constructor(t),e.s==t.s?ML(e,t):CL(e,(t.s=-t.s,t))};sr.modulo=sr.mod=function(t){var e,r=this,n=r.constructor,i=n.precision;if(t=new n(t),!t.s)throw Error(mc+"NaN");return r.s?(Si=!1,e=df(r,t,0,1).times(t),Si=!0,r.minus(e)):Qn(new n(r),i)};sr.naturalExponential=sr.exp=function(){return PL(this)};sr.naturalLogarithm=sr.ln=function(){return Wv(this)};sr.negated=sr.neg=function(){var t=new this.constructor(this);return t.s=-t.s||0,t};sr.plus=sr.add=function(t){var e=this;return t=new e.constructor(t),e.s==t.s?CL(e,t):ML(e,(t.s=-t.s,t))};sr.precision=sr.sd=function(t){var e,r,n,i=this;if(t!==void 0&&t!==!!t&&t!==1&&t!==0)throw Error(mg+t);if(e=ds(i)+1,n=i.d.length-1,r=n*di+1,n=i.d[n],n){for(;n%10==0;n/=10)r--;for(n=i.d[0];n>=10;n/=10)r++}return t&&e>r?e:r};sr.squareRoot=sr.sqrt=function(){var t,e,r,n,i,a,c,s=this,g=s.constructor;if(s.s<1){if(!s.s)return new g(0);throw Error(mc+"NaN")}for(t=ds(s),Si=!1,i=Math.sqrt(+s),i==0||i==1/0?(e=nh(s.d),(e.length+t)%2==0&&(e+="0"),i=Math.sqrt(e),t=Uy((t+1)/2)-(t<0||t%2),i==1/0?e="5e"+t:(e=i.toExponential(),e=e.slice(0,e.indexOf("e")+1)+t),n=new g(e)):n=new g(i.toString()),r=g.precision,i=c=r+3;;)if(a=n,n=a.plus(df(s,a,c+2)).times(.5),nh(a.d).slice(0,c)===(e=nh(n.d)).slice(0,c)){if(e=e.slice(c-3,c+1),i==c&&e=="4999"){if(Qn(a,r+1,0),a.times(a).eq(s)){n=a;break}}else if(e!="9999")break;c+=4}return Si=!0,Qn(n,r)};sr.times=sr.mul=function(t){var e,r,n,i,a,c,s,g,_,v=this,T=v.constructor,M=v.d,O=(t=new T(t)).d;if(!v.s||!t.s)return new T(0);for(t.s*=v.s,r=v.e+t.e,g=M.length,_=O.length,g<_&&(a=M,M=O,O=a,c=g,g=_,_=c),a=[],c=g+_,n=c;n--;)a.push(0);for(n=_;--n>=0;){for(e=0,i=g+n;i>n;)s=a[i]+O[n]*M[i-n-1]+e,a[i--]=s%Zs|0,e=s/Zs|0;a[i]=(a[i]+e)%Zs|0}for(;!a[--c];)a.pop();return e?++r:a.shift(),t.d=a,t.e=r,Si?Qn(t,T.precision):t};sr.toDecimalPlaces=sr.todp=function(t,e){var r=this,n=r.constructor;return r=new n(r),t===void 0?r:(oh(t,0,Fy),e===void 0?e=n.rounding:oh(e,0,8),Qn(r,t+ds(r)+1,e))};sr.toExponential=function(t,e){var r,n=this,i=n.constructor;return t===void 0?r=Sg(n,!0):(oh(t,0,Fy),e===void 0?e=i.rounding:oh(e,0,8),n=Qn(new i(n),t+1,e),r=Sg(n,!0,t+1)),r};sr.toFixed=function(t,e){var r,n,i=this,a=i.constructor;return t===void 0?Sg(i):(oh(t,0,Fy),e===void 0?e=a.rounding:oh(e,0,8),n=Qn(new a(i),t+ds(i)+1,e),r=Sg(n.abs(),!1,t+ds(n)+1),i.isneg()&&!i.isZero()?"-"+r:r)};sr.toInteger=sr.toint=function(){var t=this,e=t.constructor;return Qn(new e(t),ds(t)+1,e.rounding)};sr.toNumber=function(){return+this};sr.toPower=sr.pow=function(t){var e,r,n,i,a,c,s=this,g=s.constructor,_=12,v=+(t=new g(t));if(!t.s)return new g(yl);if(s=new g(s),!s.s){if(t.s<1)throw Error(mc+"Infinity");return s}if(s.eq(yl))return s;if(n=g.precision,t.eq(yl))return Qn(s,n);if(e=t.e,r=t.d.length-1,c=e>=r,a=s.s,c){if((r=v<0?-v:v)<=EL){for(i=new g(yl),e=Math.ceil(n/di+4),Si=!1;r%2&&(i=i.times(s),VI(i.d,e)),r=Uy(r/2),r!==0;)s=s.times(s),VI(s.d,e);return Si=!0,t.s<0?new g(yl).div(i):Qn(i,n)}}else if(a<0)throw Error(mc+"NaN");return a=a<0&&t.d[Math.max(e,r)]&1?-1:1,s.s=1,Si=!1,i=t.times(Wv(s,n+_)),Si=!0,i=PL(i),i.s=a,i};sr.toPrecision=function(t,e){var r,n,i=this,a=i.constructor;return t===void 0?(r=ds(i),n=Sg(i,r<=a.toExpNeg||r>=a.toExpPos)):(oh(t,1,Fy),e===void 0?e=a.rounding:oh(e,0,8),i=Qn(new a(i),t,e),r=ds(i),n=Sg(i,t<=r||r<=a.toExpNeg,t)),n};sr.toSignificantDigits=sr.tosd=function(t,e){var r=this,n=r.constructor;return t===void 0?(t=n.precision,e=n.rounding):(oh(t,1,Fy),e===void 0?e=n.rounding:oh(e,0,8)),Qn(new n(r),t,e)};sr.toString=sr.valueOf=sr.val=sr.toJSON=sr[Symbol.for("nodejs.util.inspect.custom")]=function(){var t=this,e=ds(t),r=t.constructor;return Sg(t,e<=r.toExpNeg||e>=r.toExpPos)};function CL(t,e){var r,n,i,a,c,s,g,_,v=t.constructor,T=v.precision;if(!t.s||!e.s)return e.s||(e=new v(t)),Si?Qn(e,T):e;if(g=t.d,_=e.d,c=t.e,i=e.e,g=g.slice(),a=c-i,a){for(a<0?(n=g,a=-a,s=_.length):(n=_,i=c,s=g.length),c=Math.ceil(T/di),s=c>s?c+1:s+1,a>s&&(a=s,n.length=1),n.reverse();a--;)n.push(0);n.reverse()}for(s=g.length,a=_.length,s-a<0&&(a=s,n=_,_=g,g=n),r=0;a;)r=(g[--a]=g[a]+_[a]+r)/Zs|0,g[a]%=Zs;for(r&&(g.unshift(r),++i),s=g.length;g[--s]==0;)g.pop();return e.d=g,e.e=i,Si?Qn(e,T):e}function oh(t,e,r){if(t!==~~t||t<e||t>r)throw Error(mg+t)}function nh(t){var e,r,n,i=t.length-1,a="",c=t[0];if(i>0){for(a+=c,e=1;e<i;e++)n=t[e]+"",r=di-n.length,r&&(a+=Ed(r)),a+=n;c=t[e],n=c+"",r=di-n.length,r&&(a+=Ed(r))}else if(c===0)return"0";for(;c%10===0;)c/=10;return a+c}var df=(function(){function t(n,i){var a,c=0,s=n.length;for(n=n.slice();s--;)a=n[s]*i+c,n[s]=a%Zs|0,c=a/Zs|0;return c&&n.unshift(c),n}function e(n,i,a,c){var s,g;if(a!=c)g=a>c?1:-1;else for(s=g=0;s<a;s++)if(n[s]!=i[s]){g=n[s]>i[s]?1:-1;break}return g}function r(n,i,a){for(var c=0;a--;)n[a]-=c,c=n[a]<i[a]?1:0,n[a]=c*Zs+n[a]-i[a];for(;!n[0]&&n.length>1;)n.shift()}return function(n,i,a,c){var s,g,_,v,T,M,O,F,j,V,q,Y,X,ae,ue,ge,Le,qe,Ze=n.constructor,_t=n.s==i.s?1:-1,it=n.d,gt=i.d;if(!n.s)return new Ze(n);if(!i.s)throw Error(mc+"Division by zero");for(g=n.e-i.e,Le=gt.length,ue=it.length,O=new Ze(_t),F=O.d=[],_=0;gt[_]==(it[_]||0);)++_;if(gt[_]>(it[_]||0)&&--g,a==null?Y=a=Ze.precision:c?Y=a+(ds(n)-ds(i))+1:Y=a,Y<0)return new Ze(0);if(Y=Y/di+2|0,_=0,Le==1)for(v=0,gt=gt[0],Y++;(_<ue||v)&&Y--;_++)X=v*Zs+(it[_]||0),F[_]=X/gt|0,v=X%gt|0;else{for(v=Zs/(gt[0]+1)|0,v>1&&(gt=t(gt,v),it=t(it,v),Le=gt.length,ue=it.length),ae=Le,j=it.slice(0,Le),V=j.length;V<Le;)j[V++]=0;qe=gt.slice(),qe.unshift(0),ge=gt[0],gt[1]>=Zs/2&&++ge;do v=0,s=e(gt,j,Le,V),s<0?(q=j[0],Le!=V&&(q=q*Zs+(j[1]||0)),v=q/ge|0,v>1?(v>=Zs&&(v=Zs-1),T=t(gt,v),M=T.length,V=j.length,s=e(T,j,M,V),s==1&&(v--,r(T,Le<M?qe:gt,M))):(v==0&&(s=v=1),T=gt.slice()),M=T.length,M<V&&T.unshift(0),r(j,T,V),s==-1&&(V=j.length,s=e(gt,j,Le,V),s<1&&(v++,r(j,Le<V?qe:gt,V))),V=j.length):s===0&&(v++,j=[0]),F[_++]=v,s&&j[0]?j[V++]=it[ae]||0:(j=[it[ae]],V=1);while((ae++<ue||j[0]!==void 0)&&Y--)}return F[0]||F.shift(),O.e=g,Qn(O,c?a+ds(O)+1:a)}})();function PL(t,e){var r,n,i,a,c,s,g=0,_=0,v=t.constructor,T=v.precision;if(ds(t)>16)throw Error(KE+ds(t));if(!t.s)return new v(yl);for(Si=!1,s=T,c=new v(.03125);t.abs().gte(.1);)t=t.times(c),_+=5;for(n=Math.log(ig(2,_))/Math.LN10*2+5|0,s+=n,r=i=a=new v(yl),v.precision=s;;){if(i=Qn(i.times(t),s),r=r.times(++g),c=a.plus(df(i,r,s)),nh(c.d).slice(0,s)===nh(a.d).slice(0,s)){for(;_--;)a=Qn(a.times(a),s);return v.precision=T,e==null?(Si=!0,Qn(a,T)):a}a=c}}function ds(t){for(var e=t.e*di,r=t.d[0];r>=10;r/=10)e++;return e}function lT(t,e,r){if(e>t.LN10.sd())throw Si=!0,r&&(t.precision=r),Error(mc+"LN10 precision limit exceeded");return Qn(new t(t.LN10),e)}function Ed(t){for(var e="";t--;)e+="0";return e}function Wv(t,e){var r,n,i,a,c,s,g,_,v,T=1,M=10,O=t,F=O.d,j=O.constructor,V=j.precision;if(O.s<1)throw Error(mc+(O.s?"NaN":"-Infinity"));if(O.eq(yl))return new j(0);if(e==null?(Si=!1,_=V):_=e,O.eq(10))return e==null&&(Si=!0),lT(j,_);if(_+=M,j.precision=_,r=nh(F),n=r.charAt(0),a=ds(O),Math.abs(a)<15e14){for(;n<7&&n!=1||n==1&&r.charAt(1)>3;)O=O.times(t),r=nh(O.d),n=r.charAt(0),T++;a=ds(O),n>1?(O=new j("0."+r),a++):O=new j(n+"."+r.slice(1))}else return g=lT(j,_+2,V).times(a+""),O=Wv(new j(n+"."+r.slice(1)),_-M).plus(g),j.precision=V,e==null?(Si=!0,Qn(O,V)):O;for(s=c=O=df(O.minus(yl),O.plus(yl),_),v=Qn(O.times(O),_),i=3;;){if(c=Qn(c.times(v),_),g=s.plus(df(c,new j(i),_)),nh(g.d).slice(0,_)===nh(s.d).slice(0,_))return s=s.times(2),a!==0&&(s=s.plus(lT(j,_+2,V).times(a+""))),s=df(s,new j(T),_),j.precision=V,e==null?(Si=!0,Qn(s,V)):s;s=g,i+=2}}function jI(t,e){var r,n,i;for((r=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(r<0&&(r=n),r+=+e.slice(n+1),e=e.substring(0,n)):r<0&&(r=e.length),n=0;e.charCodeAt(n)===48;)++n;for(i=e.length;e.charCodeAt(i-1)===48;)--i;if(e=e.slice(n,i),e){if(i-=n,r=r-n-1,t.e=Uy(r/di),t.d=[],n=(r+1)%di,r<0&&(n+=di),n<i){for(n&&t.d.push(+e.slice(0,n)),i-=di;n<i;)t.d.push(+e.slice(n,n+=di));e=e.slice(n),n=di-e.length}else n-=i;for(;n--;)e+="0";if(t.d.push(+e),Si&&(t.e>qx||t.e<-qx))throw Error(KE+r)}else t.s=0,t.e=0,t.d=[0];return t}function Qn(t,e,r){var n,i,a,c,s,g,_,v,T=t.d;for(c=1,a=T[0];a>=10;a/=10)c++;if(n=e-c,n<0)n+=di,i=e,_=T[v=0];else{if(v=Math.ceil((n+1)/di),a=T.length,v>=a)return t;for(_=a=T[v],c=1;a>=10;a/=10)c++;n%=di,i=n-di+c}if(r!==void 0&&(a=ig(10,c-i-1),s=_/a%10|0,g=e<0||T[v+1]!==void 0||_%a,g=r<4?(s||g)&&(r==0||r==(t.s<0?3:2)):s>5||s==5&&(r==4||g||r==6&&(n>0?i>0?_/ig(10,c-i):0:T[v-1])%10&1||r==(t.s<0?8:7))),e<1||!T[0])return g?(a=ds(t),T.length=1,e=e-a-1,T[0]=ig(10,(di-e%di)%di),t.e=Uy(-e/di)||0):(T.length=1,T[0]=t.e=t.s=0),t;if(n==0?(T.length=v,a=1,v--):(T.length=v+1,a=ig(10,di-n),T[v]=i>0?(_/ig(10,c-i)%ig(10,i)|0)*a:0),g)for(;;)if(v==0){(T[0]+=a)==Zs&&(T[0]=1,++t.e);break}else{if(T[v]+=a,T[v]!=Zs)break;T[v--]=0,a=1}for(n=T.length;T[--n]===0;)T.pop();if(Si&&(t.e>qx||t.e<-qx))throw Error(KE+ds(t));return t}function ML(t,e){var r,n,i,a,c,s,g,_,v,T,M=t.constructor,O=M.precision;if(!t.s||!e.s)return e.s?e.s=-e.s:e=new M(t),Si?Qn(e,O):e;if(g=t.d,T=e.d,n=e.e,_=t.e,g=g.slice(),c=_-n,c){for(v=c<0,v?(r=g,c=-c,s=T.length):(r=T,n=_,s=g.length),i=Math.max(Math.ceil(O/di),s)+2,c>i&&(c=i,r.length=1),r.reverse(),i=c;i--;)r.push(0);r.reverse()}else{for(i=g.length,s=T.length,v=i<s,v&&(s=i),i=0;i<s;i++)if(g[i]!=T[i]){v=g[i]<T[i];break}c=0}for(v&&(r=g,g=T,T=r,e.s=-e.s),s=g.length,i=T.length-s;i>0;--i)g[s++]=0;for(i=T.length;i>c;){if(g[--i]<T[i]){for(a=i;a&&g[--a]===0;)g[a]=Zs-1;--g[a],g[i]+=Zs}g[i]-=T[i]}for(;g[--s]===0;)g.pop();for(;g[0]===0;g.shift())--n;return g[0]?(e.d=g,e.e=n,Si?Qn(e,O):e):new M(0)}function Sg(t,e,r){var n,i=ds(t),a=nh(t.d),c=a.length;return e?(r&&(n=r-c)>0?a=a.charAt(0)+"."+a.slice(1)+Ed(n):c>1&&(a=a.charAt(0)+"."+a.slice(1)),a=a+(i<0?"e":"e+")+i):i<0?(a="0."+Ed(-i-1)+a,r&&(n=r-c)>0&&(a+=Ed(n))):i>=c?(a+=Ed(i+1-c),r&&(n=r-i-1)>0&&(a=a+"."+Ed(n))):((n=i+1)<c&&(a=a.slice(0,n)+"."+a.slice(n)),r&&(n=r-c)>0&&(i+1===c&&(a+="."),a+=Ed(n))),t.s<0?"-"+a:a}function VI(t,e){if(t.length>e)return t.length=e,!0}function IL(t){var e,r,n;function i(a){var c=this;if(!(c instanceof i))return new i(a);if(c.constructor=i,a instanceof i){c.s=a.s,c.e=a.e,c.d=(a=a.d)?a.slice():a;return}if(typeof a=="number"){if(a*0!==0)throw Error(mg+a);if(a>0)c.s=1;else if(a<0)a=-a,c.s=-1;else{c.s=0,c.e=0,c.d=[0];return}if(a===~~a&&a<1e7){c.e=0,c.d=[a];return}return jI(c,a.toString())}else if(typeof a!="string")throw Error(mg+a);if(a.charCodeAt(0)===45?(a=a.slice(1),c.s=-1):c.s=1,Zq.test(a))jI(c,a);else throw Error(mg+a)}if(i.prototype=sr,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.clone=IL,i.config=i.set=Yq,t===void 0&&(t={}),t)for(n=["precision","rounding","toExpNeg","toExpPos","LN10"],e=0;e<n.length;)t.hasOwnProperty(r=n[e++])||(t[r]=this[r]);return i.config(t),i}function Yq(t){if(!t||typeof t!="object")throw Error(mc+"Object expected");var e,r,n,i=["precision",1,Fy,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(e=0;e<i.length;e+=3)if((n=t[r=i[e]])!==void 0)if(Uy(n)===n&&n>=i[e+1]&&n<=i[e+2])this[r]=n;else throw Error(mg+r+": "+n);if((n=t[r="LN10"])!==void 0)if(n==Math.LN10)this[r]=new this(n);else throw Error(mg+r+": "+n);return this}var QE=IL(Xq);yl=new QE(1);const Nn=QE;var Kq=t=>t,RL={},OL=t=>t===RL,$I=t=>function e(){return arguments.length===0||arguments.length===1&&OL(arguments.length<=0?void 0:arguments[0])?e:t(...arguments)},kL=(t,e)=>t===1?e:$I(function(){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];var a=n.filter(c=>c!==RL).length;return a>=t?e(...n):kL(t-a,$I(function(){for(var c=arguments.length,s=new Array(c),g=0;g<c;g++)s[g]=arguments[g];var _=n.map(v=>OL(v)?s.shift():v);return e(..._,...s)}))}),K1=t=>kL(t.length,t),WS=(t,e)=>{for(var r=[],n=t;n<e;++n)r[n-t]=n;return r},Qq=K1((t,e)=>Array.isArray(e)?e.map(t):Object.keys(e).map(r=>e[r]).map(t)),Jq=function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];if(!r.length)return Kq;var i=r.reverse(),a=i[0],c=i.slice(1);return function(){return c.reduce((s,g)=>g(s),a(...arguments))}},qS=t=>Array.isArray(t)?t.reverse():t.split("").reverse().join(""),DL=t=>{var e=null,r=null;return function(){for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e&&i.every((c,s)=>{var g;return c===((g=e)===null||g===void 0?void 0:g[s])})||(e=i,r=t(...i)),r}};function LL(t){var e;return t===0?e=1:e=Math.floor(new Nn(t).abs().log(10).toNumber())+1,e}function BL(t,e,r){for(var n=new Nn(t),i=0,a=[];n.lt(e)&&i<1e5;)a.push(n.toNumber()),n=n.add(r),i++;return a}K1((t,e,r)=>{var n=+t,i=+e;return n+r*(i-n)});K1((t,e,r)=>{var n=e-+t;return n=n||1/0,(r-t)/n});K1((t,e,r)=>{var n=e-+t;return n=n||1/0,Math.max(0,Math.min(1,(r-t)/n))});var NL=t=>{var[e,r]=t,[n,i]=[e,r];return e>r&&([n,i]=[r,e]),[n,i]},zL=(t,e,r)=>{if(t.lte(0))return new Nn(0);var n=LL(t.toNumber()),i=new Nn(10).pow(n),a=t.div(i),c=n!==1?.05:.1,s=new Nn(Math.ceil(a.div(c).toNumber())).add(r).mul(c),g=s.mul(i);return e?new Nn(g.toNumber()):new Nn(Math.ceil(g.toNumber()))},eG=(t,e,r)=>{var n=new Nn(1),i=new Nn(t);if(!i.isint()&&r){var a=Math.abs(t);a<1?(n=new Nn(10).pow(LL(t)-1),i=new Nn(Math.floor(i.div(n).toNumber())).mul(n)):a>1&&(i=new Nn(Math.floor(t)))}else t===0?i=new Nn(Math.floor((e-1)/2)):r||(i=new Nn(Math.floor(t)));var c=Math.floor((e-1)/2),s=Jq(Qq(g=>i.add(new Nn(g-c).mul(n)).toNumber()),WS);return s(0,e)},FL=function(e,r,n,i){var a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((r-e)/(n-1)))return{step:new Nn(0),tickMin:new Nn(0),tickMax:new Nn(0)};var c=zL(new Nn(r).sub(e).div(n-1),i,a),s;e<=0&&r>=0?s=new Nn(0):(s=new Nn(e).add(r).div(2),s=s.sub(new Nn(s).mod(c)));var g=Math.ceil(s.sub(e).div(c).toNumber()),_=Math.ceil(new Nn(r).sub(s).div(c).toNumber()),v=g+_+1;return v>n?FL(e,r,n,i,a+1):(v<n&&(_=r>0?_+(n-v):_,g=r>0?g:g+(n-v)),{step:c,tickMin:s.sub(new Nn(g).mul(c)),tickMax:s.add(new Nn(_).mul(c))})};function tG(t){var[e,r]=t,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a=Math.max(n,2),[c,s]=NL([e,r]);if(c===-1/0||s===1/0){var g=s===1/0?[c,...WS(0,n-1).map(()=>1/0)]:[...WS(0,n-1).map(()=>-1/0),s];return e>r?qS(g):g}if(c===s)return eG(c,n,i);var{step:_,tickMin:v,tickMax:T}=FL(c,s,a,i,0),M=BL(v,T.add(new Nn(.1).mul(_)),_);return e>r?qS(M):M}function rG(t,e){var[r,n]=t,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,[a,c]=NL([r,n]);if(a===-1/0||c===1/0)return[r,n];if(a===c)return[a];var s=Math.max(e,2),g=zL(new Nn(c).sub(a).div(s-1),i,0),_=[...BL(new Nn(a),new Nn(c),g),c];return i===!1&&(_=_.map(v=>Math.round(v))),r>n?qS(_):_}var nG=DL(tG),iG=DL(rG),sG=t=>t.rootProps.barCategoryGap,Q1=t=>t.rootProps.stackOffset,JE=t=>t.options.chartName,e3=t=>t.rootProps.syncId,UL=t=>t.rootProps.syncMethod,t3=t=>t.options.eventEmitter,of={allowDuplicatedCategory:!0,angleAxisId:0,reversed:!1,scale:"auto",tick:!0,type:"category"},hl={allowDataOverflow:!1,allowDuplicatedCategory:!0,radiusAxisId:0,scale:"auto",tick:!0,tickCount:5,type:"number"},J1=(t,e)=>{if(!(!t||!e))return t!=null&&t.reversed?[e[1],e[0]]:e},aG={allowDataOverflow:!1,allowDecimals:!1,allowDuplicatedCategory:!1,dataKey:void 0,domain:void 0,id:of.angleAxisId,includeHidden:!1,name:void 0,reversed:of.reversed,scale:of.scale,tick:of.tick,tickCount:void 0,ticks:void 0,type:of.type,unit:void 0},oG={allowDataOverflow:hl.allowDataOverflow,allowDecimals:!1,allowDuplicatedCategory:hl.allowDuplicatedCategory,dataKey:void 0,domain:void 0,id:hl.radiusAxisId,includeHidden:!1,name:void 0,reversed:!1,scale:hl.scale,tick:hl.tick,tickCount:hl.tickCount,ticks:void 0,type:hl.type,unit:void 0},lG={allowDataOverflow:!1,allowDecimals:!1,allowDuplicatedCategory:of.allowDuplicatedCategory,dataKey:void 0,domain:void 0,id:of.angleAxisId,includeHidden:!1,name:void 0,reversed:!1,scale:of.scale,tick:of.tick,tickCount:void 0,ticks:void 0,type:"number",unit:void 0},cG={allowDataOverflow:hl.allowDataOverflow,allowDecimals:!1,allowDuplicatedCategory:hl.allowDuplicatedCategory,dataKey:void 0,domain:void 0,id:hl.radiusAxisId,includeHidden:!1,name:void 0,reversed:!1,scale:hl.scale,tick:hl.tick,tickCount:hl.tickCount,ticks:void 0,type:"category",unit:void 0},r3=(t,e)=>t.polarAxis.angleAxis[e]!=null?t.polarAxis.angleAxis[e]:t.layout.layoutType==="radial"?lG:aG,n3=(t,e)=>t.polarAxis.radiusAxis[e]!=null?t.polarAxis.radiusAxis[e]:t.layout.layoutType==="radial"?cG:oG,ew=t=>t.polarOptions,i3=wt([Tf,Sf,da],HH),jL=wt([ew,i3],(t,e)=>{if(t!=null)return Fd(t.innerRadius,e,0)}),VL=wt([ew,i3],(t,e)=>{if(t!=null)return Fd(t.outerRadius,e,e*.8)}),uG=t=>{if(t==null)return[0,0];var{startAngle:e,endAngle:r}=t;return[e,r]},$L=wt([ew],uG);wt([r3,$L],J1);var HL=wt([i3,jL,VL],(t,e,r)=>{if(!(t==null||e==null||r==null))return[e,r]});wt([n3,HL],J1);var WL=wt([mi,ew,jL,VL,Tf,Sf],(t,e,r,n,i,a)=>{if(!(t!=="centric"&&t!=="radial"||e==null||r==null||n==null)){var{cx:c,cy:s,startAngle:g,endAngle:_}=e;return{cx:Fd(c,i,i/2),cy:Fd(s,a,a/2),innerRadius:r,outerRadius:n,startAngle:g,endAngle:_,clockWise:!1}}}),ps=(t,e)=>e,tw=(t,e,r)=>r;function qL(t){return t?.id}var Rs=t=>{var e=mi(t);return e==="horizontal"?"xAxis":e==="vertical"?"yAxis":e==="centric"?"angleAxis":"radiusAxis"},jy=t=>t.tooltip.settings.axisId,Js=t=>{var e=Rs(t),r=jy(t);return u0(t,e,r)},GL=wt([Js],t=>t?.dataKey);function XL(t,e,r){var{chartData:n=[]}=e,{allowDuplicatedCategory:i,dataKey:a}=r,c=new Map;return t.forEach(s=>{var g,_=(g=s.data)!==null&&g!==void 0?g:n;if(!(_==null||_.length===0)){var v=qL(s);_.forEach((T,M)=>{var O=a==null||i?M:String(Ga(T,a,null)),F=Ga(T,s.dataKey,0),j;c.has(O)?j=c.get(O):j={},Object.assign(j,{[v]:F}),c.set(O,j)})}}),Array.from(c.values())}function s3(t){return t.stackId!=null&&t.dataKey!=null}function HI(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Gx(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?HI(Object(r),!0).forEach(function(n){hG(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):HI(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function hG(t,e,r){return(e=fG(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function fG(t){var e=dG(t,"string");return typeof e=="symbol"?e:e+""}function dG(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var GS=[0,"auto"],ll={allowDataOverflow:!1,allowDecimals:!0,allowDuplicatedCategory:!0,angle:0,dataKey:void 0,domain:void 0,height:30,hide:!0,id:0,includeHidden:!1,interval:"preserveEnd",minTickGap:5,mirror:!1,name:void 0,orientation:"bottom",padding:{left:0,right:0},reversed:!1,scale:"auto",tick:!0,tickCount:5,tickFormatter:void 0,ticks:void 0,type:"category",unit:void 0},ZL=(t,e)=>t.cartesianAxis.xAxis[e],Af=(t,e)=>{var r=ZL(t,e);return r??ll},cl={allowDataOverflow:!1,allowDecimals:!0,allowDuplicatedCategory:!0,angle:0,dataKey:void 0,domain:GS,hide:!0,id:0,includeHidden:!1,interval:"preserveEnd",minTickGap:5,mirror:!1,name:void 0,orientation:"left",padding:{top:0,bottom:0},reversed:!1,scale:"auto",tick:!0,tickCount:5,tickFormatter:void 0,ticks:void 0,type:"number",unit:void 0,width:c0},YL=(t,e)=>t.cartesianAxis.yAxis[e],Ef=(t,e)=>{var r=YL(t,e);return r??cl},pG={domain:[0,"auto"],includeHidden:!1,reversed:!1,allowDataOverflow:!1,allowDuplicatedCategory:!1,dataKey:void 0,id:0,name:"",range:[64,64],scale:"auto",type:"number",unit:""},a3=(t,e)=>{var r=t.cartesianAxis.zAxis[e];return r??pG},Ro=(t,e,r)=>{switch(e){case"xAxis":return Af(t,r);case"yAxis":return Ef(t,r);case"zAxis":return a3(t,r);case"angleAxis":return r3(t,r);case"radiusAxis":return n3(t,r);default:throw new Error("Unexpected axis type: ".concat(e))}},gG=(t,e,r)=>{switch(e){case"xAxis":return Af(t,r);case"yAxis":return Ef(t,r);default:throw new Error("Unexpected axis type: ".concat(e))}},u0=(t,e,r)=>{switch(e){case"xAxis":return Af(t,r);case"yAxis":return Ef(t,r);case"angleAxis":return r3(t,r);case"radiusAxis":return n3(t,r);default:throw new Error("Unexpected axis type: ".concat(e))}},KL=t=>t.graphicalItems.cartesianItems.some(e=>e.type==="bar")||t.graphicalItems.polarItems.some(e=>e.type==="radialBar");function QL(t,e){return r=>{switch(t){case"xAxis":return"xAxisId"in r&&r.xAxisId===e;case"yAxis":return"yAxisId"in r&&r.yAxisId===e;case"zAxis":return"zAxisId"in r&&r.zAxisId===e;case"angleAxis":return"angleAxisId"in r&&r.angleAxisId===e;case"radiusAxis":return"radiusAxisId"in r&&r.radiusAxisId===e;default:return!1}}}var JL=t=>t.graphicalItems.cartesianItems,mG=wt([ps,tw],QL),eB=(t,e,r)=>t.filter(r).filter(n=>e?.includeHidden===!0?!0:!n.hide),h0=wt([JL,Ro,mG],eB),tB=wt([h0],t=>t.filter(e=>e.type==="area"||e.type==="bar").filter(s3)),rB=t=>t.filter(e=>!("stackId"in e)||e.stackId===void 0),nB=wt([h0],rB),iB=t=>t.map(e=>e.data).filter(Boolean).flat(1),yG=wt([h0],iB),sB=(t,e)=>{var{chartData:r=[],dataStartIndex:n,dataEndIndex:i}=e;return t.length>0?t:r.slice(n,i+1)},o3=wt([yG,YE],sB),aB=(t,e,r)=>e?.dataKey!=null?t.map(n=>({value:Ga(n,e.dataKey)})):r.length>0?r.map(n=>n.dataKey).flatMap(n=>t.map(i=>({value:Ga(i,n)}))):t.map(n=>({value:n})),rw=wt([o3,Ro,h0],aB);function oB(t,e){switch(t){case"xAxis":return e.direction==="x";case"yAxis":return e.direction==="y";default:return!1}}function Ng(t){return t.filter(e=>ah(e)||e instanceof Date).map(Number).filter(e=>pc(e)===!1)}function _G(t,e,r){return!r||typeof e!="number"||pc(e)?[]:r.length?Ng(r.flatMap(n=>{var i=Ga(t,n.dataKey),a,c;if(Array.isArray(i)?[a,c]=i:a=c=i,!(!cu(a)||!cu(c)))return[e-a,e+c]})):[]}var vG=wt([tB,YE,Js],XL),lB=(t,e,r)=>{var n={},i=e.reduce((a,c)=>(c.stackId==null||(a[c.stackId]==null&&(a[c.stackId]=[]),a[c.stackId].push(c)),a),n);return Object.fromEntries(Object.entries(i).map(a=>{var[c,s]=a,g=s.map(qL);return[c,{stackedData:sW(t,g,r),graphicalItems:s}]}))},bG=wt([vG,tB,Q1],lB),cB=(t,e,r)=>{var{dataStartIndex:n,dataEndIndex:i}=e;if(r!=="zAxis"){var a=lW(t,n,i);if(!(a!=null&&a[0]===0&&a[1]===0))return a}},xG=wt([bG,Wd,ps],cB),uB=(t,e,r,n,i)=>r.length>0?t.flatMap(a=>r.flatMap(c=>{var s,g,_=(s=n[c.id])===null||s===void 0?void 0:s.filter(T=>oB(i,T)),v=Ga(a,(g=e.dataKey)!==null&&g!==void 0?g:c.dataKey);return{value:v,errorDomain:_G(a,v,_)}})).filter(Boolean):e?.dataKey!=null?t.map(a=>({value:Ga(a,e.dataKey),errorDomain:[]})):t.map(a=>({value:a,errorDomain:[]})),nw=t=>t.errorBars,hB=(t,e,r)=>t.flatMap(n=>e[n.id]).filter(Boolean).filter(n=>oB(r,n));wt([nB,nw,ps],hB);var wG=wt([o3,Ro,nB,nw,ps],uB);function TG(t){var{value:e}=t;if(ah(e)||e instanceof Date)return e}var WI=t=>{var e=t.flatMap(n=>[n.value,n.errorDomain]).flat(1),r=Ng(e);if(r.length!==0)return[Math.min(...r),Math.max(...r)]},SG=(t,e,r)=>{var n=t.map(TG).filter(i=>i!=null);return r&&(e.dataKey==null||e.allowDuplicatedCategory&&s6(n))?AL(0,t.length):e.allowDuplicatedCategory?n:Array.from(new Set(n))},l3=t=>{var e;if(t==null||!("domain"in t))return GS;if(t.domain!=null)return t.domain;if(t.ticks!=null){if(t.type==="number"){var r=Ng(t.ticks);return[Math.min(...r),Math.max(...r)]}if(t.type==="category")return t.ticks.map(String)}return(e=t?.domain)!==null&&e!==void 0?e:GS},Xx=function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];var i=r.filter(Boolean);if(i.length!==0){var a=i.flat(),c=Math.min(...a),s=Math.max(...a);return[c,s]}},fB=t=>t.referenceElements.dots,Vy=(t,e,r)=>t.filter(n=>n.ifOverflow==="extendDomain").filter(n=>e==="xAxis"?n.xAxisId===r:n.yAxisId===r),AG=wt([fB,ps,tw],Vy),dB=t=>t.referenceElements.areas,EG=wt([dB,ps,tw],Vy),pB=t=>t.referenceElements.lines,CG=wt([pB,ps,tw],Vy),gB=(t,e)=>{var r=Ng(t.map(n=>e==="xAxis"?n.x:n.y));if(r.length!==0)return[Math.min(...r),Math.max(...r)]},PG=wt(AG,ps,gB),mB=(t,e)=>{var r=Ng(t.flatMap(n=>[e==="xAxis"?n.x1:n.y1,e==="xAxis"?n.x2:n.y2]));if(r.length!==0)return[Math.min(...r),Math.max(...r)]},MG=wt([EG,ps],mB),yB=(t,e)=>{var r=Ng(t.map(n=>e==="xAxis"?n.x:n.y));if(r.length!==0)return[Math.min(...r),Math.max(...r)]},IG=wt(CG,ps,yB),RG=wt(PG,IG,MG,(t,e,r)=>Xx(t,r,e)),OG=wt([Ro],l3),_B=(t,e,r,n,i,a,c)=>{var s=qq(e,t.allowDataOverflow);if(s!=null)return s;var g=a==="vertical"&&c==="xAxis"||a==="horizontal"&&c==="yAxis",_=g?Xx(r,i,WI(n)):Xx(i,WI(n));return Gq(e,_,t.allowDataOverflow)},kG=wt([Ro,OG,xG,wG,RG,mi,ps],_B),DG=[0,1],vB=(t,e,r,n,i,a,c)=>{if(!((t==null||r==null||r.length===0)&&c===void 0)){var{dataKey:s,type:g}=t,_=Hd(e,a);return _&&s==null?AL(0,r.length):g==="category"?SG(n,t,_):i==="expand"?DG:c}},c3=wt([Ro,mi,o3,rw,Q1,ps,kG],vB),bB=(t,e,r,n,i)=>{if(t!=null){var{scale:a,type:c}=t;if(a==="auto")return e==="radial"&&i==="radiusAxis"?"band":e==="radial"&&i==="angleAxis"?"linear":c==="category"&&n&&(n.indexOf("LineChart")>=0||n.indexOf("AreaChart")>=0||n.indexOf("ComposedChart")>=0&&!r)?"point":c==="category"?"band":"linear";if(typeof a=="string"){var s="scale".concat(LE(a));return s in pv?s:"point"}}},f0=wt([Ro,mi,KL,JE,ps],bB);function LG(t){if(t!=null){if(t in pv)return pv[t]();var e="scale".concat(LE(t));if(e in pv)return pv[e]()}}function u3(t,e,r,n){if(!(r==null||n==null)){if(typeof t.scale=="function")return t.scale.copy().domain(r).range(n);var i=LG(e);if(i!=null){var a=i.domain(r).range(n);return tW(a),a}}}var xB=(t,e,r)=>{var n=l3(e);if(!(r!=="auto"&&r!=="linear")){if(e!=null&&e.tickCount&&Array.isArray(n)&&(n[0]==="auto"||n[1]==="auto")&&vy(t))return nG(t,e.tickCount,e.allowDecimals);if(e!=null&&e.tickCount&&e.type==="number"&&vy(t))return iG(t,e.tickCount,e.allowDecimals)}},h3=wt([c3,u0,f0],xB),wB=(t,e,r,n)=>{if(n!=="angleAxis"&&t?.type==="number"&&vy(e)&&Array.isArray(r)&&r.length>0){var i=e[0],a=r[0],c=e[1],s=r[r.length-1];return[Math.min(i,a),Math.max(c,s)]}return e},BG=wt([Ro,c3,h3,ps],wB),NG=wt(rw,Ro,(t,e)=>{if(!(!e||e.type!=="number")){var r=1/0,n=Array.from(Ng(t.map(s=>s.value))).sort((s,g)=>s-g);if(n.length<2)return 1/0;var i=n[n.length-1]-n[0];if(i===0)return 1/0;for(var a=0;a<n.length-1;a++){var c=n[a+1]-n[a];r=Math.min(r,c)}return r/i}}),TB=wt(NG,mi,sG,da,(t,e,r,n)=>n,(t,e,r,n,i)=>{if(!cu(t))return 0;var a=e==="vertical"?n.height:n.width;if(i==="gap")return t*a/2;if(i==="no-gap"){var c=Fd(r,t*a),s=t*a/2;return s-c-(s-c)/a*c}return 0}),zG=(t,e)=>{var r=Af(t,e);return r==null||typeof r.padding!="string"?0:TB(t,"xAxis",e,r.padding)},FG=(t,e)=>{var r=Ef(t,e);return r==null||typeof r.padding!="string"?0:TB(t,"yAxis",e,r.padding)},UG=wt(Af,zG,(t,e)=>{var r,n;if(t==null)return{left:0,right:0};var{padding:i}=t;return typeof i=="string"?{left:e,right:e}:{left:((r=i.left)!==null&&r!==void 0?r:0)+e,right:((n=i.right)!==null&&n!==void 0?n:0)+e}}),jG=wt(Ef,FG,(t,e)=>{var r,n;if(t==null)return{top:0,bottom:0};var{padding:i}=t;return typeof i=="string"?{top:e,bottom:e}:{top:((r=i.top)!==null&&r!==void 0?r:0)+e,bottom:((n=i.bottom)!==null&&n!==void 0?n:0)+e}}),VG=wt([da,UG,Y1,Z1,(t,e,r)=>r],(t,e,r,n,i)=>{var{padding:a}=n;return i?[a.left,r.width-a.right]:[t.left+e.left,t.left+t.width-e.right]}),$G=wt([da,mi,jG,Y1,Z1,(t,e,r)=>r],(t,e,r,n,i,a)=>{var{padding:c}=i;return a?[n.height-c.bottom,c.top]:e==="horizontal"?[t.top+t.height-r.bottom,t.top+r.top]:[t.top+r.top,t.top+t.height-r.bottom]}),d0=(t,e,r,n)=>{var i;switch(e){case"xAxis":return VG(t,r,n);case"yAxis":return $G(t,r,n);case"zAxis":return(i=a3(t,r))===null||i===void 0?void 0:i.range;case"angleAxis":return $L(t);case"radiusAxis":return HL(t,r);default:return}},SB=wt([Ro,d0],J1),$y=wt([Ro,f0,BG,SB],u3);wt([h0,nw,ps],hB);function AB(t,e){return t.id<e.id?-1:t.id>e.id?1:0}var iw=(t,e)=>e,sw=(t,e,r)=>r,HG=wt(G1,iw,sw,(t,e,r)=>t.filter(n=>n.orientation===e).filter(n=>n.mirror===r).sort(AB)),WG=wt(X1,iw,sw,(t,e,r)=>t.filter(n=>n.orientation===e).filter(n=>n.mirror===r).sort(AB)),EB=(t,e)=>({width:t.width,height:e.height}),qG=(t,e)=>{var r=typeof e.width=="number"?e.width:c0;return{width:r,height:t.height}},GG=wt(da,Af,EB),XG=(t,e,r)=>{switch(e){case"top":return t.top;case"bottom":return r-t.bottom;default:return 0}},ZG=(t,e,r)=>{switch(e){case"left":return t.left;case"right":return r-t.right;default:return 0}},YG=wt(Sf,da,HG,iw,sw,(t,e,r,n,i)=>{var a={},c;return r.forEach(s=>{var g=EB(e,s);c==null&&(c=XG(e,n,t));var _=n==="top"&&!i||n==="bottom"&&i;a[s.id]=c-Number(_)*g.height,c+=(_?-1:1)*g.height}),a}),KG=wt(Tf,da,WG,iw,sw,(t,e,r,n,i)=>{var a={},c;return r.forEach(s=>{var g=qG(e,s);c==null&&(c=ZG(e,n,t));var _=n==="left"&&!i||n==="right"&&i;a[s.id]=c-Number(_)*g.width,c+=(_?-1:1)*g.width}),a}),QG=(t,e)=>{var r=Af(t,e);if(r!=null)return YG(t,r.orientation,r.mirror)},JG=wt([da,Af,QG,(t,e)=>e],(t,e,r,n)=>{if(e!=null){var i=r?.[n];return i==null?{x:t.left,y:0}:{x:t.left,y:i}}}),eX=(t,e)=>{var r=Ef(t,e);if(r!=null)return KG(t,r.orientation,r.mirror)},tX=wt([da,Ef,eX,(t,e)=>e],(t,e,r,n)=>{if(e!=null){var i=r?.[n];return i==null?{x:0,y:t.top}:{x:i,y:t.top}}}),rX=wt(da,Ef,(t,e)=>{var r=typeof e.width=="number"?e.width:c0;return{width:r,height:t.height}}),CB=(t,e,r,n)=>{if(r!=null){var{allowDuplicatedCategory:i,type:a,dataKey:c}=r,s=Hd(t,n),g=e.map(_=>_.value);if(c&&s&&a==="category"&&i&&s6(g))return g}},f3=wt([mi,rw,Ro,ps],CB),PB=(t,e,r,n)=>{if(!(r==null||r.dataKey==null)){var{type:i,scale:a}=r,c=Hd(t,n);if(c&&(i==="number"||a!=="auto"))return e.map(s=>s.value)}},d3=wt([mi,rw,u0,ps],PB),qI=wt([mi,gG,f0,$y,f3,d3,d0,h3,ps],(t,e,r,n,i,a,c,s,g)=>{if(e==null)return null;var _=Hd(t,g);return{angle:e.angle,interval:e.interval,minTickGap:e.minTickGap,orientation:e.orientation,tick:e.tick,tickCount:e.tickCount,tickFormatter:e.tickFormatter,ticks:e.ticks,type:e.type,unit:e.unit,axisType:g,categoricalDomain:a,duplicateDomain:i,isCategorical:_,niceTicks:s,range:c,realScaleType:r,scale:n}}),nX=(t,e,r,n,i,a,c,s,g)=>{if(!(e==null||n==null)){var _=Hd(t,g),{type:v,ticks:T,tickCount:M}=e,O=r==="scaleBand"&&typeof n.bandwidth=="function"?n.bandwidth()/2:2,F=v==="category"&&n.bandwidth?n.bandwidth()/O:0;F=g==="angleAxis"&&a!=null&&a.length>=2?lc(a[0]-a[1])*2*F:F;var j=T||i;if(j){var V=j.map((q,Y)=>{var X=c?c.indexOf(q):q;return{index:Y,coordinate:n(X)+F,value:q,offset:F}});return V.filter(q=>!pc(q.coordinate))}return _&&s?s.map((q,Y)=>({coordinate:n(q)+F,value:q,index:Y,offset:F})):n.ticks?n.ticks(M).map(q=>({coordinate:n(q)+F,value:q,offset:F})):n.domain().map((q,Y)=>({coordinate:n(q)+F,value:c?c[q]:q,index:Y,offset:F}))}},MB=wt([mi,u0,f0,$y,h3,d0,f3,d3,ps],nX),iX=(t,e,r,n,i,a,c)=>{if(!(e==null||r==null||n==null||n[0]===n[1])){var s=Hd(t,c),{tickCount:g}=e,_=0;return _=c==="angleAxis"&&n?.length>=2?lc(n[0]-n[1])*2*_:_,s&&a?a.map((v,T)=>({coordinate:r(v)+_,value:v,index:T,offset:_})):r.ticks?r.ticks(g).map(v=>({coordinate:r(v)+_,value:v,offset:_})):r.domain().map((v,T)=>({coordinate:r(v)+_,value:i?i[v]:v,index:T,offset:_}))}},IB=wt([mi,u0,$y,d0,f3,d3,ps],iX),RB=wt(Ro,$y,(t,e)=>{if(!(t==null||e==null))return Gx(Gx({},t),{},{scale:e})}),sX=wt([Ro,f0,c3,SB],u3);wt((t,e,r)=>a3(t,r),sX,(t,e)=>{if(!(t==null||e==null))return Gx(Gx({},t),{},{scale:e})});var aX=wt([mi,G1,X1],(t,e,r)=>{switch(t){case"horizontal":return e.some(n=>n.reversed)?"right-to-left":"left-to-right";case"vertical":return r.some(n=>n.reversed)?"bottom-to-top":"top-to-bottom";case"centric":case"radial":return"left-to-right";default:return}}),OB=t=>t.options.defaultTooltipEventType,kB=t=>t.options.validateTooltipEventTypes;function DB(t,e,r){if(t==null)return e;var n=t?"axis":"item";return r==null?e:r.includes(n)?n:e}function p3(t,e){var r=OB(t),n=kB(t);return DB(e,r,n)}function oX(t){return br(e=>p3(e,t))}var LB=(t,e)=>{var r,n=Number(e);if(!(pc(n)||e==null))return n>=0?t==null||(r=t[n])===null||r===void 0?void 0:r.value:void 0},lX=t=>t.tooltip.settings,Md={active:!1,index:null,dataKey:void 0,coordinate:void 0},cX={itemInteraction:{click:Md,hover:Md},axisInteraction:{click:Md,hover:Md},keyboardInteraction:Md,syncInteraction:{active:!1,index:null,dataKey:void 0,label:void 0,coordinate:void 0},tooltipItemPayloads:[],settings:{shared:void 0,trigger:"hover",axisId:0,active:!1,defaultIndex:void 0}},BB=wl({name:"tooltip",initialState:cX,reducers:{addTooltipEntrySettings(t,e){t.tooltipItemPayloads.push(e.payload)},removeTooltipEntrySettings(t,e){var r=ff(t).tooltipItemPayloads.indexOf(e.payload);r>-1&&t.tooltipItemPayloads.splice(r,1)},setTooltipSettingsState(t,e){t.settings=e.payload},setActiveMouseOverItemIndex(t,e){t.syncInteraction.active=!1,t.keyboardInteraction.active=!1,t.itemInteraction.hover.active=!0,t.itemInteraction.hover.index=e.payload.activeIndex,t.itemInteraction.hover.dataKey=e.payload.activeDataKey,t.itemInteraction.hover.coordinate=e.payload.activeCoordinate},mouseLeaveChart(t){t.itemInteraction.hover.active=!1,t.axisInteraction.hover.active=!1},mouseLeaveItem(t){t.itemInteraction.hover.active=!1},setActiveClickItemIndex(t,e){t.syncInteraction.active=!1,t.itemInteraction.click.active=!0,t.keyboardInteraction.active=!1,t.itemInteraction.click.index=e.payload.activeIndex,t.itemInteraction.click.dataKey=e.payload.activeDataKey,t.itemInteraction.click.coordinate=e.payload.activeCoordinate},setMouseOverAxisIndex(t,e){t.syncInteraction.active=!1,t.axisInteraction.hover.active=!0,t.keyboardInteraction.active=!1,t.axisInteraction.hover.index=e.payload.activeIndex,t.axisInteraction.hover.dataKey=e.payload.activeDataKey,t.axisInteraction.hover.coordinate=e.payload.activeCoordinate},setMouseClickAxisIndex(t,e){t.syncInteraction.active=!1,t.keyboardInteraction.active=!1,t.axisInteraction.click.active=!0,t.axisInteraction.click.index=e.payload.activeIndex,t.axisInteraction.click.dataKey=e.payload.activeDataKey,t.axisInteraction.click.coordinate=e.payload.activeCoordinate},setSyncInteraction(t,e){t.syncInteraction=e.payload},setKeyboardInteraction(t,e){t.keyboardInteraction.active=e.payload.active,t.keyboardInteraction.index=e.payload.activeIndex,t.keyboardInteraction.coordinate=e.payload.activeCoordinate,t.keyboardInteraction.dataKey=e.payload.activeDataKey}}}),{addTooltipEntrySettings:uX,removeTooltipEntrySettings:hX,setTooltipSettingsState:fX,setActiveMouseOverItemIndex:dX,mouseLeaveItem:jye,mouseLeaveChart:NB,setActiveClickItemIndex:Vye,setMouseOverAxisIndex:zB,setMouseClickAxisIndex:pX,setSyncInteraction:XS,setKeyboardInteraction:ZS}=BB.actions,gX=BB.reducer;function GI(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Bb(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?GI(Object(r),!0).forEach(function(n){mX(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):GI(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function mX(t,e,r){return(e=yX(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function yX(t){var e=_X(t,"string");return typeof e=="symbol"?e:e+""}function _X(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function vX(t,e,r){return e==="axis"?r==="click"?t.axisInteraction.click:t.axisInteraction.hover:r==="click"?t.itemInteraction.click:t.itemInteraction.hover}function bX(t){return t.index!=null}var FB=(t,e,r,n)=>{if(e==null)return Md;var i=vX(t,e,r);if(i==null)return Md;if(i.active)return i;if(t.keyboardInteraction.active)return t.keyboardInteraction;if(t.syncInteraction.active&&t.syncInteraction.index!=null)return t.syncInteraction;var a=t.settings.active===!0;if(bX(i)){if(a)return Bb(Bb({},i),{},{active:!0})}else if(n!=null)return{active:!0,coordinate:void 0,dataKey:void 0,index:n};return Bb(Bb({},Md),{},{coordinate:i.coordinate})},g3=(t,e)=>{var r=t?.index;if(r==null)return null;var n=Number(r);if(!cu(n))return r;var i=0,a=1/0;return e.length>0&&(a=e.length-1),String(Math.max(i,Math.min(n,a)))},UB=(t,e,r,n,i,a,c,s)=>{if(!(a==null||s==null)){var g=c[0],_=g==null?void 0:s(g.positions,a);if(_!=null)return _;var v=i?.[Number(a)];if(v)switch(r){case"horizontal":return{x:v.coordinate,y:(n.top+e)/2};default:return{x:(n.left+t)/2,y:v.coordinate}}}},jB=(t,e,r,n)=>{if(e==="axis")return t.tooltipItemPayloads;if(t.tooltipItemPayloads.length===0)return[];var i;return r==="hover"?i=t.itemInteraction.hover.dataKey:i=t.itemInteraction.click.dataKey,i==null&&n!=null?[t.tooltipItemPayloads[0]]:t.tooltipItemPayloads.filter(a=>{var c;return((c=a.settings)===null||c===void 0?void 0:c.dataKey)===i})},p0=t=>t.options.tooltipPayloadSearcher,Hy=t=>t.tooltip;function XI(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function ZI(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?XI(Object(r),!0).forEach(function(n){xX(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):XI(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function xX(t,e,r){return(e=wX(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function wX(t){var e=TX(t,"string");return typeof e=="symbol"?e:e+""}function TX(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function SX(t,e){return t??e}var VB=(t,e,r,n,i,a,c)=>{if(!(e==null||a==null)){var{chartData:s,computedData:g,dataStartIndex:_,dataEndIndex:v}=r,T=[];return t.reduce((M,O)=>{var F,{dataDefinedOnItem:j,settings:V}=O,q=SX(j,s),Y=Array.isArray(q)?aL(q,_,v):q,X=(F=V?.dataKey)!==null&&F!==void 0?F:n,ae=V?.nameKey,ue;if(n&&Array.isArray(Y)&&!Array.isArray(Y[0])&&c==="axis"?ue=a6(Y,n,i):ue=a(Y,e,g,ae),Array.isArray(ue))ue.forEach(Le=>{var qe=ZI(ZI({},V),{},{name:Le.name,unit:Le.unit,color:void 0,fill:void 0});M.push(yI({tooltipEntrySettings:qe,dataKey:Le.dataKey,payload:Le.payload,value:Ga(Le.payload,Le.dataKey),name:Le.name}))});else{var ge;M.push(yI({tooltipEntrySettings:V,dataKey:X,payload:ue,value:Ga(ue,X),name:(ge=Ga(ue,ae))!==null&&ge!==void 0?ge:V?.name}))}return M},T)}},m3=wt([Js,mi,KL,JE,Rs],bB),AX=wt([t=>t.graphicalItems.cartesianItems,t=>t.graphicalItems.polarItems],(t,e)=>[...t,...e]),EX=wt([Rs,jy],QL),g0=wt([AX,Js,EX],eB),CX=wt([g0],t=>t.filter(s3)),PX=wt([g0],iB),Wy=wt([PX,Wd],sB),MX=wt([CX,Wd,Js],XL),y3=wt([Wy,Js,g0],aB),IX=wt([Js],l3),RX=wt([g0],t=>t.filter(s3)),OX=wt([MX,RX,Q1],lB),kX=wt([OX,Wd,Rs],cB),DX=wt([g0],rB),LX=wt([Wy,Js,DX,nw,Rs],uB),BX=wt([fB,Rs,jy],Vy),NX=wt([BX,Rs],gB),zX=wt([dB,Rs,jy],Vy),FX=wt([zX,Rs],mB),UX=wt([pB,Rs,jy],Vy),jX=wt([UX,Rs],yB),VX=wt([NX,jX,FX],Xx),$X=wt([Js,IX,kX,LX,VX,mi,Rs],_B),$B=wt([Js,mi,Wy,y3,Q1,Rs,$X],vB),HX=wt([$B,Js,m3],xB),WX=wt([Js,$B,HX,Rs],wB),HB=t=>{var e=Rs(t),r=jy(t),n=!1;return d0(t,e,r,n)},WB=wt([Js,HB],J1),qB=wt([Js,m3,WX,WB],u3),qX=wt([mi,y3,Js,Rs],CB),GX=wt([mi,y3,Js,Rs],PB),XX=(t,e,r,n,i,a,c,s)=>{if(e){var{type:g}=e,_=Hd(t,s);if(n){var v=r==="scaleBand"&&n.bandwidth?n.bandwidth()/2:2,T=g==="category"&&n.bandwidth?n.bandwidth()/v:0;return T=s==="angleAxis"&&i!=null&&i?.length>=2?lc(i[0]-i[1])*2*T:T,_&&c?c.map((M,O)=>({coordinate:n(M)+T,value:M,index:O,offset:T})):n.domain().map((M,O)=>({coordinate:n(M)+T,value:a?a[M]:M,index:O,offset:T}))}}},Cf=wt([mi,Js,m3,qB,HB,qX,GX,Rs],XX),_3=wt([OB,kB,lX],(t,e,r)=>DB(r.shared,t,e)),GB=t=>t.tooltip.settings.trigger,v3=t=>t.tooltip.settings.defaultIndex,aw=wt([Hy,_3,GB,v3],FB),qv=wt([aw,Wy],g3),XB=wt([Cf,qv],LB),ZX=wt([aw],t=>{if(t)return t.dataKey}),ZB=wt([Hy,_3,GB,v3],jB),YX=wt([Tf,Sf,mi,da,Cf,v3,ZB,p0],UB),KX=wt([aw,YX],(t,e)=>t!=null&&t.coordinate?t.coordinate:e),QX=wt([aw],t=>t.active),JX=wt([ZB,qv,Wd,GL,XB,p0,_3],VB),eZ=wt([JX],t=>{if(t!=null){var e=t.map(r=>r.payload).filter(r=>r!=null);return Array.from(new Set(e))}});function YI(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function KI(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?YI(Object(r),!0).forEach(function(n){tZ(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):YI(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function tZ(t,e,r){return(e=rZ(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function rZ(t){var e=nZ(t,"string");return typeof e=="symbol"?e:e+""}function nZ(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var iZ=()=>br(Js),sZ=()=>{var t=iZ(),e=br(Cf),r=br(qB);return zS(KI(KI({},t),{},{scale:r}),e)},aZ=()=>br(JE),b3=(t,e)=>e,YB=(t,e,r)=>r,x3=(t,e,r,n)=>n,oZ=wt(Cf,t=>j1(t,e=>e.coordinate)),w3=wt([Hy,b3,YB,x3],FB),KB=wt([w3,Wy],g3),lZ=(t,e,r)=>{if(e!=null){var n=Hy(t);return e==="axis"?r==="hover"?n.axisInteraction.hover.dataKey:n.axisInteraction.click.dataKey:r==="hover"?n.itemInteraction.hover.dataKey:n.itemInteraction.click.dataKey}},QB=wt([Hy,b3,YB,x3],jB),Zx=wt([Tf,Sf,mi,da,Cf,x3,QB,p0],UB),cZ=wt([w3,Zx],(t,e)=>{var r;return(r=t.coordinate)!==null&&r!==void 0?r:e}),JB=wt(Cf,KB,LB),uZ=wt([QB,KB,Wd,GL,JB,p0,b3],VB),hZ=wt([w3],t=>({isActive:t.active,activeIndex:t.index})),fZ=(t,e,r,n,i,a,c,s)=>{if(!(!t||!e||!n||!i||!a)){var g=cW(t.chartX,t.chartY,e,r,s);if(g){var _=hW(g,e),v=JH(_,c,a,n,i),T=uW(e,a,v,g);return{activeIndex:String(v),activeCoordinate:T}}}};function YS(){return YS=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},YS.apply(null,arguments)}function QI(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Nb(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?QI(Object(r),!0).forEach(function(n){dZ(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):QI(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function dZ(t,e,r){return(e=pZ(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function pZ(t){var e=gZ(t,"string");return typeof e=="symbol"?e:e+""}function gZ(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function mZ(t){var{coordinate:e,payload:r,index:n,offset:i,tooltipAxisBandSize:a,layout:c,cursor:s,tooltipEventType:g,chartName:_}=t,v=e,T=r,M=n;if(!s||!v||_!=="ScatterChart"&&g!=="axis")return null;var O,F;if(_==="ScatterChart")O=v,F=rq;else if(_==="BarChart")O=nq(c,v,i,a),F=Dq;else if(c==="radial"){var{cx:j,cy:V,radius:q,startAngle:Y,endAngle:X}=TL(v);O={cx:j,cy:V,startAngle:Y,endAngle:X,innerRadius:q,outerRadius:q},F=zq}else O={points:Fq(c,v,i)},F=yL;var ae=typeof s=="object"&&"className"in s?s.className:void 0,ue=Nb(Nb(Nb(Nb({stroke:"#ccc",pointerEvents:"none"},i),O),ha(s,!1)),{},{payload:T,payloadIndex:M,className:gi("recharts-tooltip-cursor",ae)});return Q.isValidElement(s)?Q.cloneElement(s,ue):Q.createElement(F,ue)}function yZ(t){var e=sZ(),r=fL(),n=ZE(),i=aZ();return Q.createElement(mZ,YS({},t,{coordinate:t.coordinate,index:t.index,payload:t.payload,offset:r,layout:n,tooltipAxisBandSize:e,chartName:i}))}var eN=Q.createContext(null),_Z=()=>Q.useContext(eN),cT={exports:{}},JI;function vZ(){return JI||(JI=1,(function(t){var e=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function i(g,_,v){this.fn=g,this.context=_,this.once=v||!1}function a(g,_,v,T,M){if(typeof v!="function")throw new TypeError("The listener must be a function");var O=new i(v,T||g,M),F=r?r+_:_;return g._events[F]?g._events[F].fn?g._events[F]=[g._events[F],O]:g._events[F].push(O):(g._events[F]=O,g._eventsCount++),g}function c(g,_){--g._eventsCount===0?g._events=new n:delete g._events[_]}function s(){this._events=new n,this._eventsCount=0}s.prototype.eventNames=function(){var _=[],v,T;if(this._eventsCount===0)return _;for(T in v=this._events)e.call(v,T)&&_.push(r?T.slice(1):T);return Object.getOwnPropertySymbols?_.concat(Object.getOwnPropertySymbols(v)):_},s.prototype.listeners=function(_){var v=r?r+_:_,T=this._events[v];if(!T)return[];if(T.fn)return[T.fn];for(var M=0,O=T.length,F=new Array(O);M<O;M++)F[M]=T[M].fn;return F},s.prototype.listenerCount=function(_){var v=r?r+_:_,T=this._events[v];return T?T.fn?1:T.length:0},s.prototype.emit=function(_,v,T,M,O,F){var j=r?r+_:_;if(!this._events[j])return!1;var V=this._events[j],q=arguments.length,Y,X;if(V.fn){switch(V.once&&this.removeListener(_,V.fn,void 0,!0),q){case 1:return V.fn.call(V.context),!0;case 2:return V.fn.call(V.context,v),!0;case 3:return V.fn.call(V.context,v,T),!0;case 4:return V.fn.call(V.context,v,T,M),!0;case 5:return V.fn.call(V.context,v,T,M,O),!0;case 6:return V.fn.call(V.context,v,T,M,O,F),!0}for(X=1,Y=new Array(q-1);X<q;X++)Y[X-1]=arguments[X];V.fn.apply(V.context,Y)}else{var ae=V.length,ue;for(X=0;X<ae;X++)switch(V[X].once&&this.removeListener(_,V[X].fn,void 0,!0),q){case 1:V[X].fn.call(V[X].context);break;case 2:V[X].fn.call(V[X].context,v);break;case 3:V[X].fn.call(V[X].context,v,T);break;case 4:V[X].fn.call(V[X].context,v,T,M);break;default:if(!Y)for(ue=1,Y=new Array(q-1);ue<q;ue++)Y[ue-1]=arguments[ue];V[X].fn.apply(V[X].context,Y)}}return!0},s.prototype.on=function(_,v,T){return a(this,_,v,T,!1)},s.prototype.once=function(_,v,T){return a(this,_,v,T,!0)},s.prototype.removeListener=function(_,v,T,M){var O=r?r+_:_;if(!this._events[O])return this;if(!v)return c(this,O),this;var F=this._events[O];if(F.fn)F.fn===v&&(!M||F.once)&&(!T||F.context===T)&&c(this,O);else{for(var j=0,V=[],q=F.length;j<q;j++)(F[j].fn!==v||M&&!F[j].once||T&&F[j].context!==T)&&V.push(F[j]);V.length?this._events[O]=V.length===1?V[0]:V:c(this,O)}return this},s.prototype.removeAllListeners=function(_){var v;return _?(v=r?r+_:_,this._events[v]&&c(this,v)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,t.exports=s})(cT)),cT.exports}var bZ=vZ();const xZ=xl(bZ);var Gv=new xZ,KS="recharts.syncEvent.tooltip",eR="recharts.syncEvent.brush";function wZ(t,e){if(e){var r=Number.parseInt(e,10);if(!pc(r))return t?.[r]}}var TZ={chartName:"",tooltipPayloadSearcher:void 0,eventEmitter:void 0,defaultTooltipEventType:"axis"},tN=wl({name:"options",initialState:TZ,reducers:{createEventEmitter:t=>{t.eventEmitter==null&&(t.eventEmitter=Symbol("rechartsEventEmitter"))}}}),SZ=tN.reducer,{createEventEmitter:AZ}=tN.actions;function EZ(t){return t.tooltip.syncInteraction}var CZ={chartData:void 0,computedData:void 0,dataStartIndex:0,dataEndIndex:0},rN=wl({name:"chartData",initialState:CZ,reducers:{setChartData(t,e){if(t.chartData=e.payload,e.payload==null){t.dataStartIndex=0,t.dataEndIndex=0;return}e.payload.length>0&&t.dataEndIndex!==e.payload.length-1&&(t.dataEndIndex=e.payload.length-1)},setComputedData(t,e){t.computedData=e.payload},setDataStartEndIndexes(t,e){var{startIndex:r,endIndex:n}=e.payload;r!=null&&(t.dataStartIndex=r),n!=null&&(t.dataEndIndex=n)}}}),{setChartData:tR,setDataStartEndIndexes:PZ,setComputedData:$ye}=rN.actions,MZ=rN.reducer,IZ=["x","y"];function rR(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Jp(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?rR(Object(r),!0).forEach(function(n){RZ(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):rR(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function RZ(t,e,r){return(e=OZ(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function OZ(t){var e=kZ(t,"string");return typeof e=="symbol"?e:e+""}function kZ(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function DZ(t,e){if(t==null)return{};var r,n,i=LZ(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)r=a[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function LZ(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}var nN=()=>{};function BZ(){var t=br(e3),e=br(t3),r=Za(),n=br(UL),i=br(Cf),a=ZE(),c=XE(),s=br(g=>g.rootProps.className);Q.useEffect(()=>{if(t==null)return nN;var g=(_,v,T)=>{if(e!==T&&t===_){if(n==="index"){var M;if(c&&v!==null&&v!==void 0&&(M=v.payload)!==null&&M!==void 0&&M.coordinate){var O=v.payload.coordinate,{x:F,y:j}=O,V=DZ(O,IZ),q=Jp(Jp(Jp({},V),typeof F=="number"&&{x:Math.max(c.x,Math.min(F,c.x+c.width))}),typeof j=="number"&&{y:Math.max(c.y,Math.min(j,c.y+c.height))}),Y=Jp(Jp({},v),{},{payload:Jp(Jp({},v.payload),{},{coordinate:q})});r(Y)}else r(v);return}if(i!=null){var X;if(typeof n=="function"){var ae={activeTooltipIndex:v.payload.index==null?void 0:Number(v.payload.index),isTooltipActive:v.payload.active,activeIndex:v.payload.index==null?void 0:Number(v.payload.index),activeLabel:v.payload.label,activeDataKey:v.payload.dataKey,activeCoordinate:v.payload.coordinate},ue=n(i,ae);X=i[ue]}else n==="value"&&(X=i.find(Lt=>String(Lt.value)===v.payload.label));var{coordinate:ge}=v.payload;if(X==null||v.payload.active===!1||ge==null||c==null){r(XS({active:!1,coordinate:void 0,dataKey:void 0,index:null,label:void 0}));return}var{x:Le,y:qe}=ge,Ze=Math.min(Le,c.x+c.width),_t=Math.min(qe,c.y+c.height),it={x:a==="horizontal"?X.coordinate:Ze,y:a==="horizontal"?_t:X.coordinate},gt=XS({active:v.payload.active,coordinate:it,dataKey:v.payload.dataKey,index:String(X.index),label:v.payload.label});r(gt)}}};return Gv.on(KS,g),()=>{Gv.off(KS,g)}},[s,r,e,t,n,i,a,c])}function NZ(){var t=br(e3),e=br(t3),r=Za();Q.useEffect(()=>{if(t==null)return nN;var n=(i,a,c)=>{e!==c&&t===i&&r(PZ(a))};return Gv.on(eR,n),()=>{Gv.off(eR,n)}},[r,e,t])}function zZ(){var t=Za();Q.useEffect(()=>{t(AZ())},[t]),BZ(),NZ()}function FZ(t,e,r,n,i,a){var c=br(M=>lZ(M,t,e)),s=br(t3),g=br(e3),_=br(UL),v=br(EZ),T=v?.active;Q.useEffect(()=>{if(!T&&g!=null&&s!=null){var M=XS({active:a,coordinate:r,dataKey:c,index:i,label:typeof n=="number"?String(n):n});Gv.emit(KS,g,M,s)}},[T,r,c,i,n,s,g,_,a])}function nR(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function iR(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?nR(Object(r),!0).forEach(function(n){UZ(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):nR(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function UZ(t,e,r){return(e=jZ(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function jZ(t){var e=VZ(t,"string");return typeof e=="symbol"?e:e+""}function VZ(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function $Z(t){return t.dataKey}function HZ(t,e){return Q.isValidElement(t)?Q.cloneElement(t,e):typeof t=="function"?Q.createElement(t,e):Q.createElement(DW,e)}var sR=[],WZ={allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",axisId:0,contentStyle:{},cursor:!0,filterNull:!0,isAnimationActive:!zy.isSsr,itemSorter:"name",itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,wrapperStyle:{}};function iN(t){var e=bc(t,WZ),{active:r,allowEscapeViewBox:n,animationDuration:i,animationEasing:a,content:c,filterNull:s,isAnimationActive:g,offset:_,payloadUniqBy:v,position:T,reverseDirection:M,useTranslate3d:O,wrapperStyle:F,cursor:j,shared:V,trigger:q,defaultIndex:Y,portal:X,axisId:ae}=e,ue=Za(),ge=typeof Y=="number"?String(Y):Y;Q.useEffect(()=>{ue(fX({shared:V,trigger:q,axisId:ae,active:r,defaultIndex:ge}))},[ue,V,q,ae,r,ge]);var Le=XE(),qe=mL(),Ze=oX(V),{activeIndex:_t,isActive:it}=br(At=>hZ(At,Ze,q,ge)),gt=br(At=>uZ(At,Ze,q,ge)),Lt=br(At=>JB(At,Ze,q,ge)),Ot=br(At=>cZ(At,Ze,q,ge)),Yt=gt,ce=_Z(),we=r??it,[Re,Ue]=V$([Yt,we]),at=Ze==="axis"?Lt:void 0;FZ(Ze,q,Ot,at,_t,we);var pe=X??ce;if(pe==null)return null;var Pe=Yt??sR;we||(Pe=sR),s&&Pe.length&&(Pe=p$(Yt.filter(At=>At.value!=null&&(At.hide!==!0||e.includeHidden)),v,$Z));var rt=Pe.length>0,vt=Q.createElement(jW,{allowEscapeViewBox:n,animationDuration:i,animationEasing:a,isAnimationActive:g,active:we,coordinate:Ot,hasPayload:rt,offset:_,position:T,reverseDirection:M,useTranslate3d:O,viewBox:Le,wrapperStyle:F,lastBoundingBox:Re,innerRef:Ue,hasPortalFromProps:!!X},HZ(c,iR(iR({},e),{},{payload:Pe,label:at,active:we,coordinate:Ot,accessibilityLayer:qe})));return Q.createElement(Q.Fragment,null,zE.createPortal(vt,pe),we&&Q.createElement(yZ,{cursor:j,tooltipEventType:Ze,coordinate:Ot,payload:Yt,index:_t}))}var uT={},hT={},fT={},aR;function qZ(){return aR||(aR=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r,n,{signal:i,edges:a}={}){let c,s=null;const g=a!=null&&a.includes("leading"),_=a==null||a.includes("trailing"),v=()=>{s!==null&&(r.apply(c,s),c=void 0,s=null)},T=()=>{_&&v(),j()};let M=null;const O=()=>{M!=null&&clearTimeout(M),M=setTimeout(()=>{M=null,T()},n)},F=()=>{M!==null&&(clearTimeout(M),M=null)},j=()=>{F(),c=void 0,s=null},V=()=>{v()},q=function(...Y){if(i?.aborted)return;c=this,s=Y;const X=M==null;O(),g&&X&&v()};return q.schedule=O,q.cancel=j,q.flush=V,i?.addEventListener("abort",j,{once:!0}),q}t.debounce=e})(fT)),fT}var oR;function GZ(){return oR||(oR=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=qZ();function r(n,i=0,a={}){typeof a!="object"&&(a={});const{leading:c=!1,trailing:s=!0,maxWait:g}=a,_=Array(2);c&&(_[0]="leading"),s&&(_[1]="trailing");let v,T=null;const M=e.debounce(function(...j){v=n.apply(this,j),T=null},i,{edges:_}),O=function(...j){return g!=null&&(T===null&&(T=Date.now()),Date.now()-T>=g)?(v=n.apply(this,j),T=Date.now(),M.cancel(),M.schedule(),v):(M.apply(this,j),v)},F=()=>(M.flush(),v);return O.cancel=M.cancel,O.flush=F,O}t.debounce=r})(hT)),hT}var lR;function XZ(){return lR||(lR=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=GZ();function r(n,i=0,a={}){const{leading:c=!0,trailing:s=!0}=a;return e.debounce(n,i,{leading:c,maxWait:i,trailing:s})}t.throttle=r})(uT)),uT}var dT,cR;function ZZ(){return cR||(cR=1,dT=XZ().throttle),dT}var YZ=ZZ();const KZ=xl(YZ);var Sv=function(e,r){for(var n=arguments.length,i=new Array(n>2?n-2:0),a=2;a<n;a++)i[a-2]=arguments[a]};function uR(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function pT(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?uR(Object(r),!0).forEach(function(n){QZ(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):uR(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function QZ(t,e,r){return(e=JZ(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function JZ(t){var e=eY(t,"string");return typeof e=="symbol"?e:e+""}function eY(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var sN=Q.forwardRef((t,e)=>{var{aspect:r,initialDimension:n={width:-1,height:-1},width:i="100%",height:a="100%",minWidth:c=0,minHeight:s,maxHeight:g,children:_,debounce:v=0,id:T,className:M,onResize:O,style:F={}}=t,j=Q.useRef(null),V=Q.useRef();V.current=O,Q.useImperativeHandle(e,()=>j.current);var[q,Y]=Q.useState({containerWidth:n.width,containerHeight:n.height}),X=Q.useCallback((ue,ge)=>{Y(Le=>{var qe=Math.round(ue),Ze=Math.round(ge);return Le.containerWidth===qe&&Le.containerHeight===Ze?Le:{containerWidth:qe,containerHeight:Ze}})},[]);Q.useEffect(()=>{var ue=Ze=>{var _t,{width:it,height:gt}=Ze[0].contentRect;X(it,gt),(_t=V.current)===null||_t===void 0||_t.call(V,it,gt)};v>0&&(ue=KZ(ue,v,{trailing:!0,leading:!1}));var ge=new ResizeObserver(ue),{width:Le,height:qe}=j.current.getBoundingClientRect();return X(Le,qe),ge.observe(j.current),()=>{ge.disconnect()}},[X,v]);var ae=Q.useMemo(()=>{var{containerWidth:ue,containerHeight:ge}=q;if(ue<0||ge<0)return null;Sv(lg(i)||lg(a),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,i,a),Sv(!r||r>0,"The aspect(%s) must be greater than zero.",r);var Le=lg(i)?ue:i,qe=lg(a)?ge:a;return r&&r>0&&(Le?qe=Le/r:qe&&(Le=qe*r),g&&qe>g&&(qe=g)),Sv(Le>0||qe>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,Le,qe,i,a,c,s,r),Q.Children.map(_,Ze=>Q.cloneElement(Ze,{width:Le,height:qe,style:pT({width:Le,height:qe},Ze.props.style)}))},[r,_,a,g,s,c,q,i]);return Q.createElement("div",{id:T?"".concat(T):void 0,className:gi("recharts-responsive-container",M),style:pT(pT({},F),{},{width:i,height:a,minWidth:c,minHeight:s,maxHeight:g}),ref:j},Q.createElement("div",{style:{width:0,height:0,overflow:"visible"}},ae))});function tY(t,e,r){return(e=rY(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function rY(t){var e=nY(t,"string");return typeof e=="symbol"?e:e+""}function nY(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}let iY=class{constructor(e){tY(this,"cache",new Map),this.maxSize=e}get(e){var r=this.cache.get(e);return r!==void 0&&(this.cache.delete(e),this.cache.set(e,r)),r}set(e,r){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxSize){var n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(e,r)}clear(){this.cache.clear()}size(){return this.cache.size}};function hR(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function sY(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?hR(Object(r),!0).forEach(function(n){aY(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):hR(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function aY(t,e,r){return(e=oY(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function oY(t){var e=lY(t,"string");return typeof e=="symbol"?e:e+""}function lY(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var cY={cacheSize:2e3,enableCache:!0},aN=sY({},cY),fR=new iY(aN.cacheSize),uY={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},dR="recharts_measurement_span";function hY(t,e){var r=e.fontSize||"",n=e.fontFamily||"",i=e.fontWeight||"",a=e.fontStyle||"",c=e.letterSpacing||"",s=e.textTransform||"";return"".concat(t,"|").concat(r,"|").concat(n,"|").concat(i,"|").concat(a,"|").concat(c,"|").concat(s)}var pR=(t,e)=>{try{var r=document.getElementById(dR);r||(r=document.createElement("span"),r.setAttribute("id",dR),r.setAttribute("aria-hidden","true"),document.body.appendChild(r)),Object.assign(r.style,uY,e),r.textContent="".concat(t);var n=r.getBoundingClientRect();return{width:n.width,height:n.height}}catch{return{width:0,height:0}}},Av=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e==null||zy.isSsr)return{width:0,height:0};if(!aN.enableCache)return pR(e,r);var n=hY(e,r),i=fR.get(n);if(i)return i;var a=pR(e,r);return fR.set(n,a),a},gR=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,mR=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,fY=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,dY=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,oN={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},pY=Object.keys(oN),ey="NaN";function gY(t,e){return t*oN[e]}class Mo{static parse(e){var r,[,n,i]=(r=dY.exec(e))!==null&&r!==void 0?r:[];return new Mo(parseFloat(n),i??"")}constructor(e,r){this.num=e,this.unit=r,this.num=e,this.unit=r,pc(e)&&(this.unit=""),r!==""&&!fY.test(r)&&(this.num=NaN,this.unit=""),pY.includes(r)&&(this.num=gY(e,r),this.unit="px")}add(e){return this.unit!==e.unit?new Mo(NaN,""):new Mo(this.num+e.num,this.unit)}subtract(e){return this.unit!==e.unit?new Mo(NaN,""):new Mo(this.num-e.num,this.unit)}multiply(e){return this.unit!==""&&e.unit!==""&&this.unit!==e.unit?new Mo(NaN,""):new Mo(this.num*e.num,this.unit||e.unit)}divide(e){return this.unit!==""&&e.unit!==""&&this.unit!==e.unit?new Mo(NaN,""):new Mo(this.num/e.num,this.unit||e.unit)}toString(){return"".concat(this.num).concat(this.unit)}isNaN(){return pc(this.num)}}function lN(t){if(t.includes(ey))return ey;for(var e=t;e.includes("*")||e.includes("/");){var r,[,n,i,a]=(r=gR.exec(e))!==null&&r!==void 0?r:[],c=Mo.parse(n??""),s=Mo.parse(a??""),g=i==="*"?c.multiply(s):c.divide(s);if(g.isNaN())return ey;e=e.replace(gR,g.toString())}for(;e.includes("+")||/.-\d+(?:\.\d+)?/.test(e);){var _,[,v,T,M]=(_=mR.exec(e))!==null&&_!==void 0?_:[],O=Mo.parse(v??""),F=Mo.parse(M??""),j=T==="+"?O.add(F):O.subtract(F);if(j.isNaN())return ey;e=e.replace(mR,j.toString())}return e}var yR=/\(([^()]*)\)/;function mY(t){for(var e=t,r;(r=yR.exec(e))!=null;){var[,n]=r;e=e.replace(yR,lN(n))}return e}function yY(t){var e=t.replace(/\s+/g,"");return e=mY(e),e=lN(e),e}function _Y(t){try{return yY(t)}catch{return ey}}function gT(t){var e=_Y(t.slice(5,-1));return e===ey?"":e}var vY=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],bY=["dx","dy","angle","className","breakAll"];function QS(){return QS=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},QS.apply(null,arguments)}function _R(t,e){if(t==null)return{};var r,n,i=xY(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)r=a[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function xY(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}var cN=/[ \f\n\r\t\v\u2028\u2029]+/,uN=t=>{var{children:e,breakAll:r,style:n}=t;try{var i=[];Ks(e)||(r?i=e.toString().split(""):i=e.toString().split(cN));var a=i.map(s=>({word:s,width:Av(s,n).width})),c=r?0:Av("",n).width;return{wordsWithComputedWidth:a,spaceWidth:c}}catch{return null}},wY=(t,e,r,n,i)=>{var{maxLines:a,children:c,style:s,breakAll:g}=t,_=kr(a),v=c,T=function(){var it=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return it.reduce((gt,Lt)=>{var{word:Ot,width:Yt}=Lt,ce=gt[gt.length-1];if(ce&&(n==null||i||ce.width+Yt+r<Number(n)))ce.words.push(Ot),ce.width+=Yt+r;else{var we={words:[Ot],width:Yt};gt.push(we)}return gt},[])},M=T(e),O=_t=>_t.reduce((it,gt)=>it.width>gt.width?it:gt);if(!_||i)return M;var F=M.length>a||O(M).width>Number(n);if(!F)return M;for(var j="",V=_t=>{var it=v.slice(0,_t),gt=uN({breakAll:g,style:s,children:it+j}).wordsWithComputedWidth,Lt=T(gt),Ot=Lt.length>a||O(Lt).width>Number(n);return[Ot,Lt]},q=0,Y=v.length-1,X=0,ae;q<=Y&&X<=v.length-1;){var ue=Math.floor((q+Y)/2),ge=ue-1,[Le,qe]=V(ge),[Ze]=V(ue);if(!Le&&!Ze&&(q=ue+1),Le&&Ze&&(Y=ue-1),!Le&&Ze){ae=qe;break}X++}return ae||M},vR=t=>{var e=Ks(t)?[]:t.toString().split(cN);return[{words:e}]},TY=t=>{var{width:e,scaleToFit:r,children:n,style:i,breakAll:a,maxLines:c}=t;if((e||r)&&!zy.isSsr){var s,g,_=uN({breakAll:a,children:n,style:i});if(_){var{wordsWithComputedWidth:v,spaceWidth:T}=_;s=v,g=T}else return vR(n);return wY({breakAll:a,children:n,maxLines:c,style:i},s,g,e,r)}return vR(n)},bR="#808080",T3=Q.forwardRef((t,e)=>{var{x:r=0,y:n=0,lineHeight:i="1em",capHeight:a="0.71em",scaleToFit:c=!1,textAnchor:s="start",verticalAnchor:g="end",fill:_=bR}=t,v=_R(t,vY),T=Q.useMemo(()=>TY({breakAll:v.breakAll,children:v.children,maxLines:v.maxLines,scaleToFit:c,style:v.style,width:v.width}),[v.breakAll,v.children,v.maxLines,c,v.style,v.width]),{dx:M,dy:O,angle:F,className:j,breakAll:V}=v,q=_R(v,bY);if(!ah(r)||!ah(n)||T.length===0)return null;var Y=r+(kr(M)?M:0),X=n+(kr(O)?O:0),ae;switch(g){case"start":ae=gT("calc(".concat(a,")"));break;case"middle":ae=gT("calc(".concat((T.length-1)/2," * -").concat(i," + (").concat(a," / 2))"));break;default:ae=gT("calc(".concat(T.length-1," * -").concat(i,")"));break}var ue=[];if(c){var ge=T[0].width,{width:Le}=v;ue.push("scale(".concat(kr(Le)?Le/ge:1,")"))}return F&&ue.push("rotate(".concat(F,", ").concat(Y,", ").concat(X,")")),ue.length&&(q.transform=ue.join(" ")),Q.createElement("text",QS({},ha(q,!0),{ref:e,x:Y,y:X,className:gi("recharts-text",j),textAnchor:s,fill:_.includes("url")?bR:_}),T.map((qe,Ze)=>{var _t=qe.words.join(V?"":" ");return Q.createElement("tspan",{x:Y,dy:Ze===0?ae:i,key:"".concat(_t,"-").concat(Ze)},_t)}))});T3.displayName="Text";var SY=["labelRef"];function AY(t,e){if(t==null)return{};var r,n,i=EY(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)r=a[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function EY(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}function xR(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function es(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?xR(Object(r),!0).forEach(function(n){CY(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):xR(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function CY(t,e,r){return(e=PY(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function PY(t){var e=MY(t,"string");return typeof e=="symbol"?e:e+""}function MY(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function lf(){return lf=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},lf.apply(null,arguments)}var hN=Q.createContext(null),IY=t=>{var{x:e,y:r,width:n,height:i,children:a}=t,c=Q.useMemo(()=>({x:e,y:r,width:n,height:i}),[e,r,n,i]);return Q.createElement(hN.Provider,{value:c},a)},fN=()=>{var t=Q.useContext(hN),e=XE();return t||e},RY=Q.createContext(null),OY=()=>{var t=Q.useContext(RY),e=br(WL);return t||e},kY=t=>{var{value:e,formatter:r}=t,n=Ks(t.children)?e:t.children;return typeof r=="function"?r(n):n},S3=t=>t!=null&&typeof t=="function",DY=(t,e)=>{var r=lc(e-t),n=Math.min(Math.abs(e-t),360);return r*n},LY=(t,e,r,n,i)=>{var{offset:a,className:c}=t,{cx:s,cy:g,innerRadius:_,outerRadius:v,startAngle:T,endAngle:M,clockWise:O}=i,F=(_+v)/2,j=DY(T,M),V=j>=0?1:-1,q,Y;switch(e){case"insideStart":q=T+V*a,Y=O;break;case"insideEnd":q=M-V*a,Y=!O;break;case"end":q=M+V*a,Y=O;break;default:throw new Error("Unsupported position ".concat(e))}Y=j<=0?Y:!Y;var X=ua(s,g,F,q),ae=ua(s,g,F,q+(Y?1:-1)*359),ue="M".concat(X.x,",").concat(X.y,`
    A`).concat(F,",").concat(F,",0,1,").concat(Y?0:1,`,
    `).concat(ae.x,",").concat(ae.y),ge=Ks(t.id)?jv("recharts-radial-line-"):t.id;return Q.createElement("text",lf({},n,{dominantBaseline:"central",className:gi("recharts-radial-bar-label",c)}),Q.createElement("defs",null,Q.createElement("path",{id:ge,d:ue})),Q.createElement("textPath",{xlinkHref:"#".concat(ge)},r))},BY=(t,e,r)=>{var{cx:n,cy:i,innerRadius:a,outerRadius:c,startAngle:s,endAngle:g}=t,_=(s+g)/2;if(r==="outside"){var{x:v,y:T}=ua(n,i,c+e,_);return{x:v,y:T,textAnchor:v>=n?"start":"end",verticalAnchor:"middle"}}if(r==="center")return{x:n,y:i,textAnchor:"middle",verticalAnchor:"middle"};if(r==="centerTop")return{x:n,y:i,textAnchor:"middle",verticalAnchor:"start"};if(r==="centerBottom")return{x:n,y:i,textAnchor:"middle",verticalAnchor:"end"};var M=(a+c)/2,{x:O,y:F}=ua(n,i,M,_);return{x:O,y:F,textAnchor:"middle",verticalAnchor:"middle"}},dN=t=>"cx"in t&&kr(t.cx),NY=(t,e)=>{var{parentViewBox:r,offset:n,position:i}=t,a;r!=null&&!dN(r)&&(a=r);var{x:c,y:s,width:g,height:_}=e,v=_>=0?1:-1,T=v*n,M=v>0?"end":"start",O=v>0?"start":"end",F=g>=0?1:-1,j=F*n,V=F>0?"end":"start",q=F>0?"start":"end";if(i==="top"){var Y={x:c+g/2,y:s-v*n,textAnchor:"middle",verticalAnchor:M};return es(es({},Y),a?{height:Math.max(s-a.y,0),width:g}:{})}if(i==="bottom"){var X={x:c+g/2,y:s+_+T,textAnchor:"middle",verticalAnchor:O};return es(es({},X),a?{height:Math.max(a.y+a.height-(s+_),0),width:g}:{})}if(i==="left"){var ae={x:c-j,y:s+_/2,textAnchor:V,verticalAnchor:"middle"};return es(es({},ae),a?{width:Math.max(ae.x-a.x,0),height:_}:{})}if(i==="right"){var ue={x:c+g+j,y:s+_/2,textAnchor:q,verticalAnchor:"middle"};return es(es({},ue),a?{width:Math.max(a.x+a.width-ue.x,0),height:_}:{})}var ge=a?{width:g,height:_}:{};return i==="insideLeft"?es({x:c+j,y:s+_/2,textAnchor:q,verticalAnchor:"middle"},ge):i==="insideRight"?es({x:c+g-j,y:s+_/2,textAnchor:V,verticalAnchor:"middle"},ge):i==="insideTop"?es({x:c+g/2,y:s+T,textAnchor:"middle",verticalAnchor:O},ge):i==="insideBottom"?es({x:c+g/2,y:s+_-T,textAnchor:"middle",verticalAnchor:M},ge):i==="insideTopLeft"?es({x:c+j,y:s+T,textAnchor:q,verticalAnchor:O},ge):i==="insideTopRight"?es({x:c+g-j,y:s+T,textAnchor:V,verticalAnchor:O},ge):i==="insideBottomLeft"?es({x:c+j,y:s+_-T,textAnchor:q,verticalAnchor:M},ge):i==="insideBottomRight"?es({x:c+g-j,y:s+_-T,textAnchor:V,verticalAnchor:M},ge):i&&typeof i=="object"&&(kr(i.x)||lg(i.x))&&(kr(i.y)||lg(i.y))?es({x:c+Fd(i.x,g),y:s+Fd(i.y,_),textAnchor:"end",verticalAnchor:"end"},ge):es({x:c+g/2,y:s+_/2,textAnchor:"middle",verticalAnchor:"middle"},ge)},zY={offset:5};function Cd(t){var e=bc(t,zY),{viewBox:r,position:n,value:i,children:a,content:c,className:s="",textBreakAll:g,labelRef:_}=e,v=OY(),T=fN(),M=n==="center"?T:v??T,O=r||M;if(!O||Ks(i)&&Ks(a)&&!Q.isValidElement(c)&&typeof c!="function")return null;var F=es(es({},e),{},{viewBox:O});if(Q.isValidElement(c)){var{labelRef:j}=F,V=AY(F,SY);return Q.cloneElement(c,V)}var q;if(typeof c=="function"){if(q=Q.createElement(c,F),Q.isValidElement(q))return q}else q=kY(e);var Y=dN(O),X=ha(e,!0);if(Y&&(n==="insideStart"||n==="insideEnd"||n==="end"))return LY(e,n,q,X,O);var ae=Y?BY(O,e.offset,e.position):NY(e,O);return Q.createElement(T3,lf({ref:_,className:gi("recharts-label",s)},X,ae,{breakAll:g}),q)}Cd.displayName="Label";var FY=(t,e,r)=>{if(!t)return null;var n={viewBox:e,labelRef:r};return t===!0?Q.createElement(Cd,lf({key:"label-implicit"},n)):ah(t)?Q.createElement(Cd,lf({key:"label-implicit",value:t},n)):Q.isValidElement(t)?t.type===Cd?Q.cloneElement(t,es({key:"label-implicit"},n)):Q.createElement(Cd,lf({key:"label-implicit",content:t},n)):S3(t)?Q.createElement(Cd,lf({key:"label-implicit",content:t},n)):t&&typeof t=="object"?Q.createElement(Cd,lf({},t,{key:"label-implicit"},n)):null};function UY(t){var{label:e}=t,r=fN();return FY(e,r)||null}var mT={},yT={},wR;function jY(){return wR||(wR=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){return r[r.length-1]}t.last=e})(yT)),yT}var _T={},TR;function VY(){return TR||(TR=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function e(r){return Array.isArray(r)?r:Array.from(r)}t.toArray=e})(_T)),_T}var SR;function $Y(){return SR||(SR=1,(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const e=jY(),r=VY(),n=UE();function i(a){if(n.isArrayLike(a))return e.last(r.toArray(a))}t.last=i})(mT)),mT}var vT,AR;function HY(){return AR||(AR=1,vT=$Y().last),vT}var WY=HY();const qY=xl(WY);var GY=["valueAccessor"],XY=["dataKey","clockWise","id","textBreakAll"];function Yx(){return Yx=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Yx.apply(null,arguments)}function ER(t,e){if(t==null)return{};var r,n,i=ZY(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)r=a[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function ZY(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}var YY=t=>Array.isArray(t.value)?qY(t.value):t.value,pN=Q.createContext(void 0),KY=pN.Provider,gN=Q.createContext(void 0);gN.Provider;function QY(){return Q.useContext(pN)}function JY(){return Q.useContext(gN)}function Ev(t){var{valueAccessor:e=YY}=t,r=ER(t,GY),{dataKey:n,clockWise:i,id:a,textBreakAll:c}=r,s=ER(r,XY),g=QY(),_=JY(),v=g||_;return!v||!v.length?null:Q.createElement(Ny,{className:"recharts-label-list"},v.map((T,M)=>{var O,F=Ks(n)?e(T,M):Ga(T&&T.payload,n),j=Ks(a)?{}:{id:"".concat(a,"-").concat(M)};return Q.createElement(Cd,Yx({},ha(T,!0),s,j,{fill:(O=r.fill)!==null&&O!==void 0?O:T.fill,parentViewBox:T.parentViewBox,value:F,textBreakAll:c,viewBox:T.viewBox,key:"label-".concat(M),index:M}))}))}Ev.displayName="LabelList";function eK(t){var{label:e}=t;return e?e===!0?Q.createElement(Ev,{key:"labelList-implicit"}):Q.isValidElement(e)||S3(e)?Q.createElement(Ev,{key:"labelList-implicit",content:e}):typeof e=="object"?Q.createElement(Ev,Yx({key:"labelList-implicit"},e,{type:String(e.type)})):null:null}function JS(){return JS=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},JS.apply(null,arguments)}var mN=t=>{var{cx:e,cy:r,r:n,className:i}=t,a=gi("recharts-dot",i);return e===+e&&r===+r&&n===+n?Q.createElement("circle",JS({},Bg(t),NE(t),{className:a,cx:e,cy:r,r:n})):null},tK={radiusAxis:{},angleAxis:{}},yN=wl({name:"polarAxis",initialState:tK,reducers:{addRadiusAxis(t,e){t.radiusAxis[e.payload.id]=e.payload},removeRadiusAxis(t,e){delete t.radiusAxis[e.payload.id]},addAngleAxis(t,e){t.angleAxis[e.payload.id]=e.payload},removeAngleAxis(t,e){delete t.angleAxis[e.payload.id]}}}),{addRadiusAxis:Wye,removeRadiusAxis:qye,addAngleAxis:Gye,removeAngleAxis:Xye}=yN.actions,rK=yN.reducer;function nK(t){var{fn:e,args:r}=t,n=Za(),i=vc();return Q.useEffect(()=>{if(!i){var a=e(r);return n(uX(a)),()=>{n(hX(a))}}},[e,r,n,i]),null}var iK=()=>{};function sK(t){var{legendPayload:e}=t,r=Za(),n=vc();return Q.useEffect(()=>n?iK:(r(CW(e)),()=>{r(PW(e))}),[r,n,e]),null}var bT,aK=()=>{var[t]=Q.useState(()=>jv("uid-"));return t},oK=(bT=UF.useId)!==null&&bT!==void 0?bT:aK;function lK(t,e){var r=oK();return e||(t?"".concat(t,"-").concat(r):r)}var cK=Q.createContext(void 0),uK=t=>{var{id:e,type:r,children:n}=t,i=lK("recharts-".concat(r),e);return Q.createElement(cK.Provider,{value:i},n(i))},hK={cartesianItems:[],polarItems:[]},_N=wl({name:"graphicalItems",initialState:hK,reducers:{addCartesianGraphicalItem(t,e){t.cartesianItems.push(e.payload)},replaceCartesianGraphicalItem(t,e){var{prev:r,next:n}=e.payload,i=ff(t).cartesianItems.indexOf(r);i>-1&&(t.cartesianItems[i]=n)},removeCartesianGraphicalItem(t,e){var r=ff(t).cartesianItems.indexOf(e.payload);r>-1&&t.cartesianItems.splice(r,1)},addPolarGraphicalItem(t,e){t.polarItems.push(e.payload)},removePolarGraphicalItem(t,e){var r=ff(t).polarItems.indexOf(e.payload);r>-1&&t.polarItems.splice(r,1)}}}),{addCartesianGraphicalItem:fK,replaceCartesianGraphicalItem:dK,removeCartesianGraphicalItem:pK,addPolarGraphicalItem:Zye,removePolarGraphicalItem:Yye}=_N.actions,gK=_N.reducer;function mK(t){var e=Za(),r=Q.useRef(null);return Q.useEffect(()=>{r.current===null?e(fK(t)):r.current!==t&&e(dK({prev:r.current,next:t})),r.current=t},[e,t]),Q.useEffect(()=>()=>{r.current&&(e(pK(r.current)),r.current=null)},[e]),null}function CR(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function PR(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?CR(Object(r),!0).forEach(function(n){yK(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):CR(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function yK(t,e,r){return(e=_K(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function _K(t){var e=vK(t,"string");return typeof e=="symbol"?e:e+""}function vK(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var bK={xAxis:{},yAxis:{},zAxis:{}},vN=wl({name:"cartesianAxis",initialState:bK,reducers:{addXAxis(t,e){t.xAxis[e.payload.id]=e.payload},removeXAxis(t,e){delete t.xAxis[e.payload.id]},addYAxis(t,e){t.yAxis[e.payload.id]=e.payload},removeYAxis(t,e){delete t.yAxis[e.payload.id]},addZAxis(t,e){t.zAxis[e.payload.id]=e.payload},removeZAxis(t,e){delete t.zAxis[e.payload.id]},updateYAxisWidth(t,e){var{id:r,width:n}=e.payload;t.yAxis[r]&&(t.yAxis[r]=PR(PR({},t.yAxis[r]),{},{width:n}))}}}),{addXAxis:xK,removeXAxis:wK,addYAxis:TK,removeYAxis:SK,addZAxis:Kye,removeZAxis:Qye,updateYAxisWidth:AK}=vN.actions,EK=vN.reducer,CK=wt([da],t=>{if(t)return{top:t.top,bottom:t.bottom,left:t.left,right:t.right}}),PK=wt([CK,Tf,Sf],(t,e,r)=>{if(!(!t||e==null||r==null))return{x:t.left,y:t.top,width:Math.max(0,e-t.left-t.right),height:Math.max(0,r-t.top-t.bottom)}}),A3=()=>br(PK),MK=()=>br(eZ);function MR(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function IR(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?MR(Object(r),!0).forEach(function(n){IK(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):MR(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function IK(t,e,r){return(e=RK(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function RK(t){var e=OK(t,"string");return typeof e=="symbol"?e:e+""}function OK(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var kK=t=>{var{point:e,childIndex:r,mainColor:n,activeDot:i,dataKey:a}=t;if(i===!1||e.x==null||e.y==null)return null;var c=IR(IR({index:r,dataKey:a,cx:e.x,cy:e.y,r:4,fill:n??"none",strokeWidth:2,stroke:"#fff",payload:e.payload,value:e.value},ha(i,!1)),NE(i)),s;return Q.isValidElement(i)?s=Q.cloneElement(i,c):typeof i=="function"?s=i(c):s=Q.createElement(mN,c),Q.createElement(Ny,{className:"recharts-active-dot"},s)};function DK(t){var{points:e,mainColor:r,activeDot:n,itemDataKey:i}=t,a=br(qv),c=MK();if(e==null||c==null)return null;var s=e.find(g=>c.includes(g.payload));return Ks(s)?null:kK({point:s,childIndex:Number(a),mainColor:r,dataKey:i,activeDot:n})}var LK={},bN=wl({name:"errorBars",initialState:LK,reducers:{addErrorBar:(t,e)=>{var{itemId:r,errorBar:n}=e.payload;t[r]||(t[r]=[]),t[r].push(n)},replaceErrorBar:(t,e)=>{var{itemId:r,prev:n,next:i}=e.payload;t[r]&&(t[r]=t[r].map(a=>a.dataKey===n.dataKey&&a.direction===n.direction?i:a))},removeErrorBar:(t,e)=>{var{itemId:r,errorBar:n}=e.payload;t[r]&&(t[r]=t[r].filter(i=>i.dataKey!==n.dataKey||i.direction!==n.direction))}}}),{addErrorBar:Jye,replaceErrorBar:e_e,removeErrorBar:t_e}=bN.actions,BK=bN.reducer,NK=["children"];function zK(t,e){if(t==null)return{};var r,n,i=FK(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)r=a[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function FK(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}var UK={data:[],xAxisId:"xAxis-0",yAxisId:"yAxis-0",dataPointFormatter:()=>({x:0,y:0,value:0}),errorBarOffset:0},jK=Q.createContext(UK);function VK(t){var{children:e}=t,r=zK(t,NK);return Q.createElement(jK.Provider,{value:r},e)}function xN(t,e){var r,n,i=br(_=>Af(_,t)),a=br(_=>Ef(_,e)),c=(r=i?.allowDataOverflow)!==null&&r!==void 0?r:ll.allowDataOverflow,s=(n=a?.allowDataOverflow)!==null&&n!==void 0?n:cl.allowDataOverflow,g=c||s;return{needClip:g,needClipX:c,needClipY:s}}function $K(t){var{xAxisId:e,yAxisId:r,clipPathId:n}=t,i=A3(),{needClipX:a,needClipY:c,needClip:s}=xN(e,r);if(!s)return null;var{x:g,y:_,width:v,height:T}=i;return Q.createElement("clipPath",{id:"clipPath-".concat(n)},Q.createElement("rect",{x:a?g:g-v/2,y:c?_:_-T/2,width:a?v:v*2,height:c?T:T*2}))}var HK=t=>{var{chartData:e}=t,r=Za(),n=vc();return Q.useEffect(()=>n?()=>{}:(r(tR(e)),()=>{r(tR(void 0))}),[e,r,n]),null},RR={x:0,y:0,width:0,height:0,padding:{top:0,right:0,bottom:0,left:0}},wN=wl({name:"brush",initialState:RR,reducers:{setBrushSettings(t,e){return e.payload==null?RR:e.payload}}}),{setBrushSettings:r_e}=wN.actions,WK=wN.reducer;function qK(t,e,r){return(e=GK(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function GK(t){var e=XK(t,"string");return typeof e=="symbol"?e:e+""}function XK(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}class E3{static create(e){return new E3(e)}constructor(e){this.scale=e}get domain(){return this.scale.domain}get range(){return this.scale.range}get rangeMin(){return this.range()[0]}get rangeMax(){return this.range()[1]}get bandwidth(){return this.scale.bandwidth}apply(e){var{bandAware:r,position:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e!==void 0){if(n)switch(n){case"start":return this.scale(e);case"middle":{var i=this.bandwidth?this.bandwidth()/2:0;return this.scale(e)+i}case"end":{var a=this.bandwidth?this.bandwidth():0;return this.scale(e)+a}default:return this.scale(e)}if(r){var c=this.bandwidth?this.bandwidth()/2:0;return this.scale(e)+c}return this.scale(e)}}isInRange(e){var r=this.range(),n=r[0],i=r[r.length-1];return n<=i?e>=n&&e<=i:e>=i&&e<=n}}qK(E3,"EPS",1e-4);function ZK(t){return(t%180+180)%180}var YK=function(e){var{width:r,height:n}=e,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=ZK(i),c=a*Math.PI/180,s=Math.atan(n/r),g=c>s&&c<Math.PI-s?n/Math.sin(c):r/Math.cos(c);return Math.abs(g)},KK={dots:[],areas:[],lines:[]},TN=wl({name:"referenceElements",initialState:KK,reducers:{addDot:(t,e)=>{t.dots.push(e.payload)},removeDot:(t,e)=>{var r=ff(t).dots.findIndex(n=>n===e.payload);r!==-1&&t.dots.splice(r,1)},addArea:(t,e)=>{t.areas.push(e.payload)},removeArea:(t,e)=>{var r=ff(t).areas.findIndex(n=>n===e.payload);r!==-1&&t.areas.splice(r,1)},addLine:(t,e)=>{t.lines.push(e.payload)},removeLine:(t,e)=>{var r=ff(t).lines.findIndex(n=>n===e.payload);r!==-1&&t.lines.splice(r,1)}}}),{addDot:n_e,removeDot:i_e,addArea:s_e,removeArea:a_e,addLine:o_e,removeLine:l_e}=TN.actions,QK=TN.reducer,JK=Q.createContext(void 0),eQ=t=>{var{children:e}=t,[r]=Q.useState("".concat(jv("recharts"),"-clip")),n=A3();if(n==null)return null;var{x:i,y:a,width:c,height:s}=n;return Q.createElement(JK.Provider,{value:r},Q.createElement("defs",null,Q.createElement("clipPath",{id:r},Q.createElement("rect",{x:i,y:a,height:s,width:c}))),e)};function by(t,e){for(var r in t)if({}.hasOwnProperty.call(t,r)&&(!{}.hasOwnProperty.call(e,r)||t[r]!==e[r]))return!1;for(var n in e)if({}.hasOwnProperty.call(e,n)&&!{}.hasOwnProperty.call(t,n))return!1;return!0}function SN(t,e,r){if(e<1)return[];if(e===1&&r===void 0)return t;for(var n=[],i=0;i<t.length;i+=e)n.push(t[i]);return n}function tQ(t,e,r){var n={width:t.width+e.width,height:t.height+e.height};return YK(n,r)}function rQ(t,e,r){var n=r==="width",{x:i,y:a,width:c,height:s}=t;return e===1?{start:n?i:a,end:n?i+c:a+s}:{start:n?i+c:a+s,end:n?i:a}}function Kx(t,e,r,n,i){if(t*e<t*n||t*e>t*i)return!1;var a=r();return t*(e-t*a/2-n)>=0&&t*(e+t*a/2-i)<=0}function nQ(t,e){return SN(t,e+1)}function iQ(t,e,r,n,i){for(var a=(n||[]).slice(),{start:c,end:s}=e,g=0,_=1,v=c,T=function(){var F=n?.[g];if(F===void 0)return{v:SN(n,_)};var j=g,V,q=()=>(V===void 0&&(V=r(F,j)),V),Y=F.coordinate,X=g===0||Kx(t,Y,q,v,s);X||(g=0,v=c,_+=1),X&&(v=Y+t*(q()/2+i),g+=_)},M;_<=a.length;)if(M=T(),M)return M.v;return[]}function OR(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Oa(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?OR(Object(r),!0).forEach(function(n){sQ(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):OR(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function sQ(t,e,r){return(e=aQ(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function aQ(t){var e=oQ(t,"string");return typeof e=="symbol"?e:e+""}function oQ(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function lQ(t,e,r,n,i){for(var a=(n||[]).slice(),c=a.length,{start:s}=e,{end:g}=e,_=function(M){var O=a[M],F,j=()=>(F===void 0&&(F=r(O,M)),F);if(M===c-1){var V=t*(O.coordinate+t*j()/2-g);a[M]=O=Oa(Oa({},O),{},{tickCoord:V>0?O.coordinate-V*t:O.coordinate})}else a[M]=O=Oa(Oa({},O),{},{tickCoord:O.coordinate});var q=Kx(t,O.tickCoord,j,s,g);q&&(g=O.tickCoord-t*(j()/2+i),a[M]=Oa(Oa({},O),{},{isShow:!0}))},v=c-1;v>=0;v--)_(v);return a}function cQ(t,e,r,n,i,a){var c=(n||[]).slice(),s=c.length,{start:g,end:_}=e;if(a){var v=n[s-1],T=r(v,s-1),M=t*(v.coordinate+t*T/2-_);c[s-1]=v=Oa(Oa({},v),{},{tickCoord:M>0?v.coordinate-M*t:v.coordinate});var O=Kx(t,v.tickCoord,()=>T,g,_);O&&(_=v.tickCoord-t*(T/2+i),c[s-1]=Oa(Oa({},v),{},{isShow:!0}))}for(var F=a?s-1:s,j=function(Y){var X=c[Y],ae,ue=()=>(ae===void 0&&(ae=r(X,Y)),ae);if(Y===0){var ge=t*(X.coordinate-t*ue()/2-g);c[Y]=X=Oa(Oa({},X),{},{tickCoord:ge<0?X.coordinate-ge*t:X.coordinate})}else c[Y]=X=Oa(Oa({},X),{},{tickCoord:X.coordinate});var Le=Kx(t,X.tickCoord,ue,g,_);Le&&(g=X.tickCoord+t*(ue()/2+i),c[Y]=Oa(Oa({},X),{},{isShow:!0}))},V=0;V<F;V++)j(V);return c}function C3(t,e,r){var{tick:n,ticks:i,viewBox:a,minTickGap:c,orientation:s,interval:g,tickFormatter:_,unit:v,angle:T}=t;if(!i||!i.length||!n)return[];if(kr(g)||zy.isSsr){var M;return(M=nQ(i,kr(g)?g:0))!==null&&M!==void 0?M:[]}var O=[],F=s==="top"||s==="bottom"?"width":"height",j=v&&F==="width"?Av(v,{fontSize:e,letterSpacing:r}):{width:0,height:0},V=(X,ae)=>{var ue=typeof _=="function"?_(X.value,ae):X.value;return F==="width"?tQ(Av(ue,{fontSize:e,letterSpacing:r}),j,T):Av(ue,{fontSize:e,letterSpacing:r})[F]},q=i.length>=2?lc(i[1].coordinate-i[0].coordinate):1,Y=rQ(a,q,F);return g==="equidistantPreserveStart"?iQ(q,Y,V,i,c):(g==="preserveStart"||g==="preserveStartEnd"?O=cQ(q,Y,V,i,c,g==="preserveStartEnd"):O=lQ(q,Y,V,i,c),O.filter(X=>X.isShow))}var uQ=t=>{var{ticks:e,label:r,labelGapWithTick:n=5,tickSize:i=0,tickMargin:a=0}=t,c=0;if(e){e.forEach(v=>{if(v){var T=v.getBoundingClientRect();T.width>c&&(c=T.width)}});var s=r?r.getBoundingClientRect().width:0,g=i+a,_=c+g+s+(r?n:0);return Math.round(_)}return 0},hQ=["axisLine","width","height","className","hide","ticks"],fQ=["viewBox"],dQ=["viewBox"];function eA(t,e){if(t==null)return{};var r,n,i=pQ(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)r=a[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function pQ(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}function Ag(){return Ag=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Ag.apply(null,arguments)}function kR(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Cs(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?kR(Object(r),!0).forEach(function(n){gQ(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):kR(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function gQ(t,e,r){return(e=mQ(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function mQ(t){var e=yQ(t,"string");return typeof e=="symbol"?e:e+""}function yQ(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var P3={x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"};function _Q(t){var{x:e,y:r,width:n,height:i,orientation:a,mirror:c,axisLine:s,otherSvgProps:g}=t;if(!s)return null;var _=Cs(Cs(Cs({},g),ha(s,!1)),{},{fill:"none"});if(a==="top"||a==="bottom"){var v=+(a==="top"&&!c||a==="bottom"&&c);_=Cs(Cs({},_),{},{x1:e,y1:r+v*i,x2:e+n,y2:r+v*i})}else{var T=+(a==="left"&&!c||a==="right"&&c);_=Cs(Cs({},_),{},{x1:e+T*n,y1:r,x2:e+T*n,y2:r+i})}return Q.createElement("line",Ag({},_,{className:gi("recharts-cartesian-axis-line",z1(s,"className"))}))}function vQ(t,e,r,n,i,a,c,s,g){var _,v,T,M,O,F,j=s?-1:1,V=t.tickSize||c,q=kr(t.tickCoord)?t.tickCoord:t.coordinate;switch(a){case"top":_=v=t.coordinate,M=r+ +!s*i,T=M-j*V,F=T-j*g,O=q;break;case"left":T=M=t.coordinate,v=e+ +!s*n,_=v-j*V,O=_-j*g,F=q;break;case"right":T=M=t.coordinate,v=e+ +s*n,_=v+j*V,O=_+j*g,F=q;break;default:_=v=t.coordinate,M=r+ +s*i,T=M+j*V,F=T+j*g,O=q;break}return{line:{x1:_,y1:T,x2:v,y2:M},tick:{x:O,y:F}}}function bQ(t,e){switch(t){case"left":return e?"start":"end";case"right":return e?"end":"start";default:return"middle"}}function xQ(t,e){switch(t){case"left":case"right":return"middle";case"top":return e?"start":"end";default:return e?"end":"start"}}function wQ(t){var{option:e,tickProps:r,value:n}=t,i,a=gi(r.className,"recharts-cartesian-axis-tick-value");if(Q.isValidElement(e))i=Q.cloneElement(e,Cs(Cs({},r),{},{className:a}));else if(typeof e=="function")i=e(Cs(Cs({},r),{},{className:a}));else{var c="recharts-cartesian-axis-tick-value";typeof e!="boolean"&&(c=gi(c,e?.className)),i=Q.createElement(T3,Ag({},r,{className:c}),n)}return i}function TQ(t){var{ticks:e=[],tick:r,tickLine:n,stroke:i,tickFormatter:a,unit:c,padding:s,tickTextProps:g,orientation:_,mirror:v,x:T,y:M,width:O,height:F,tickSize:j,tickMargin:V,fontSize:q,letterSpacing:Y,getTicksConfig:X,events:ae}=t,ue=C3(Cs(Cs({},X),{},{ticks:e}),q,Y),ge=bQ(_,v),Le=xQ(_,v),qe=Bg(X),Ze=ha(r,!1),_t=Cs(Cs({},qe),{},{fill:"none"},ha(n,!1)),it=ue.map((gt,Lt)=>{var{line:Ot,tick:Yt}=vQ(gt,T,M,O,F,_,j,v,V),ce=Cs(Cs(Cs(Cs({textAnchor:ge,verticalAnchor:Le},qe),{},{stroke:"none",fill:i},Ze),Yt),{},{index:Lt,payload:gt,visibleTicksCount:ue.length,tickFormatter:a,padding:s},g);return Q.createElement(Ny,Ag({className:"recharts-cartesian-axis-tick",key:"tick-".concat(gt.value,"-").concat(gt.coordinate,"-").concat(gt.tickCoord)},_V(ae,gt,Lt)),n&&Q.createElement("line",Ag({},_t,Ot,{className:gi("recharts-cartesian-axis-tick-line",z1(n,"className"))})),r&&Q.createElement(wQ,{option:r,tickProps:ce,value:"".concat(typeof a=="function"?a(gt.value,Lt):gt.value).concat(c||"")}))});return it.length>0?Q.createElement("g",{className:"recharts-cartesian-axis-ticks"},it):null}var SQ=Q.forwardRef((t,e)=>{var{axisLine:r,width:n,height:i,className:a,hide:c,ticks:s}=t,g=eA(t,hQ),[_,v]=Q.useState(""),[T,M]=Q.useState(""),O=Q.useRef([]);Q.useImperativeHandle(e,()=>({getCalculatedWidth:()=>{var j;return uQ({ticks:O.current,label:(j=t.labelRef)===null||j===void 0?void 0:j.current,labelGapWithTick:5,tickSize:t.tickSize,tickMargin:t.tickMargin})}}));var F=Q.useCallback(j=>{if(j){var V=j.getElementsByClassName("recharts-cartesian-axis-tick-value");O.current=Array.from(V);var q=V[0];if(q){var Y=window.getComputedStyle(q),X=Y.fontSize,ae=Y.letterSpacing;(X!==_||ae!==T)&&(v(X),M(ae))}}},[_,T]);return c||n!=null&&n<=0||i!=null&&i<=0?null:Q.createElement(Ny,{className:gi("recharts-cartesian-axis",a),ref:F},Q.createElement(_Q,{x:t.x,y:t.y,width:n,height:i,orientation:t.orientation,mirror:t.mirror,axisLine:r,otherSvgProps:Bg(t)}),Q.createElement(TQ,{ticks:s,tick:t.tick,tickLine:t.tickLine,stroke:t.stroke,tickFormatter:t.tickFormatter,unit:t.unit,padding:t.padding,tickTextProps:t.tickTextProps,orientation:t.orientation,mirror:t.mirror,x:t.x,y:t.y,width:t.width,height:t.height,tickSize:t.tickSize,tickMargin:t.tickMargin,fontSize:_,letterSpacing:T,getTicksConfig:t,events:g}),Q.createElement(IY,{x:t.x,y:t.y,width:t.width,height:t.height},Q.createElement(UY,{label:t.label}),t.children))}),AQ=Q.memo(SQ,(t,e)=>{var{viewBox:r}=t,n=eA(t,fQ),{viewBox:i}=e,a=eA(e,dQ);return by(r,i)&&by(n,a)}),M3=Q.forwardRef((t,e)=>{var r=bc(t,P3);return Q.createElement(AQ,Ag({},r,{ref:e}))});M3.displayName="CartesianAxis";var EQ=["x1","y1","x2","y2","key"],CQ=["offset"],PQ=["xAxisId","yAxisId"],MQ=["xAxisId","yAxisId"];function DR(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Da(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?DR(Object(r),!0).forEach(function(n){IQ(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):DR(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function IQ(t,e,r){return(e=RQ(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function RQ(t){var e=OQ(t,"string");return typeof e=="symbol"?e:e+""}function OQ(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function cg(){return cg=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},cg.apply(null,arguments)}function Qx(t,e){if(t==null)return{};var r,n,i=kQ(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)r=a[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function kQ(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}var DQ=t=>{var{fill:e}=t;if(!e||e==="none")return null;var{fillOpacity:r,x:n,y:i,width:a,height:c,ry:s}=t;return Q.createElement("rect",{x:n,y:i,ry:s,width:a,height:c,stroke:"none",fill:e,fillOpacity:r,className:"recharts-cartesian-grid-bg"})};function AN(t,e){var r;if(Q.isValidElement(t))r=Q.cloneElement(t,e);else if(typeof t=="function")r=t(e);else{var{x1:n,y1:i,x2:a,y2:c,key:s}=e,g=Qx(e,EQ),_=Bg(g),{offset:v}=_,T=Qx(_,CQ);r=Q.createElement("line",cg({},T,{x1:n,y1:i,x2:a,y2:c,fill:"none",key:s}))}return r}function LQ(t){var{x:e,width:r,horizontal:n=!0,horizontalPoints:i}=t;if(!n||!i||!i.length)return null;var{xAxisId:a,yAxisId:c}=t,s=Qx(t,PQ),g=i.map((_,v)=>{var T=Da(Da({},s),{},{x1:e,y1:_,x2:e+r,y2:_,key:"line-".concat(v),index:v});return AN(n,T)});return Q.createElement("g",{className:"recharts-cartesian-grid-horizontal"},g)}function BQ(t){var{y:e,height:r,vertical:n=!0,verticalPoints:i}=t;if(!n||!i||!i.length)return null;var{xAxisId:a,yAxisId:c}=t,s=Qx(t,MQ),g=i.map((_,v)=>{var T=Da(Da({},s),{},{x1:_,y1:e,x2:_,y2:e+r,key:"line-".concat(v),index:v});return AN(n,T)});return Q.createElement("g",{className:"recharts-cartesian-grid-vertical"},g)}function NQ(t){var{horizontalFill:e,fillOpacity:r,x:n,y:i,width:a,height:c,horizontalPoints:s,horizontal:g=!0}=t;if(!g||!e||!e.length)return null;var _=s.map(T=>Math.round(T+i-i)).sort((T,M)=>T-M);i!==_[0]&&_.unshift(0);var v=_.map((T,M)=>{var O=!_[M+1],F=O?i+c-T:_[M+1]-T;if(F<=0)return null;var j=M%e.length;return Q.createElement("rect",{key:"react-".concat(M),y:T,x:n,height:F,width:a,stroke:"none",fill:e[j],fillOpacity:r,className:"recharts-cartesian-grid-bg"})});return Q.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},v)}function zQ(t){var{vertical:e=!0,verticalFill:r,fillOpacity:n,x:i,y:a,width:c,height:s,verticalPoints:g}=t;if(!e||!r||!r.length)return null;var _=g.map(T=>Math.round(T+i-i)).sort((T,M)=>T-M);i!==_[0]&&_.unshift(0);var v=_.map((T,M)=>{var O=!_[M+1],F=O?i+c-T:_[M+1]-T;if(F<=0)return null;var j=M%r.length;return Q.createElement("rect",{key:"react-".concat(M),x:T,y:a,width:F,height:s,stroke:"none",fill:r[j],fillOpacity:n,className:"recharts-cartesian-grid-bg"})});return Q.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},v)}var FQ=(t,e)=>{var{xAxis:r,width:n,height:i,offset:a}=t;return oL(C3(Da(Da(Da({},P3),r),{},{ticks:lL(r),viewBox:{x:0,y:0,width:n,height:i}})),a.left,a.left+a.width,e)},UQ=(t,e)=>{var{yAxis:r,width:n,height:i,offset:a}=t;return oL(C3(Da(Da(Da({},P3),r),{},{ticks:lL(r),viewBox:{x:0,y:0,width:n,height:i}})),a.top,a.top+a.height,e)},jQ={horizontal:!0,vertical:!0,horizontalPoints:[],verticalPoints:[],stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[],xAxisId:0,yAxisId:0};function EN(t){var e=dL(),r=pL(),n=fL(),i=Da(Da({},bc(t,jQ)),{},{x:kr(t.x)?t.x:n.left,y:kr(t.y)?t.y:n.top,width:kr(t.width)?t.width:n.width,height:kr(t.height)?t.height:n.height}),{xAxisId:a,yAxisId:c,x:s,y:g,width:_,height:v,syncWithTicks:T,horizontalValues:M,verticalValues:O}=i,F=vc(),j=br(Ze=>qI(Ze,"xAxis",a,F)),V=br(Ze=>qI(Ze,"yAxis",c,F));if(!kr(_)||_<=0||!kr(v)||v<=0||!kr(s)||s!==+s||!kr(g)||g!==+g)return null;var q=i.verticalCoordinatesGenerator||FQ,Y=i.horizontalCoordinatesGenerator||UQ,{horizontalPoints:X,verticalPoints:ae}=i;if((!X||!X.length)&&typeof Y=="function"){var ue=M&&M.length,ge=Y({yAxis:V?Da(Da({},V),{},{ticks:ue?M:V.ticks}):void 0,width:e,height:r,offset:n},ue?!0:T);Sv(Array.isArray(ge),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(typeof ge,"]")),Array.isArray(ge)&&(X=ge)}if((!ae||!ae.length)&&typeof q=="function"){var Le=O&&O.length,qe=q({xAxis:j?Da(Da({},j),{},{ticks:Le?O:j.ticks}):void 0,width:e,height:r,offset:n},Le?!0:T);Sv(Array.isArray(qe),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(typeof qe,"]")),Array.isArray(qe)&&(ae=qe)}return Q.createElement("g",{className:"recharts-cartesian-grid"},Q.createElement(DQ,{fill:i.fill,fillOpacity:i.fillOpacity,x:i.x,y:i.y,width:i.width,height:i.height,ry:i.ry}),Q.createElement(NQ,cg({},i,{horizontalPoints:X})),Q.createElement(zQ,cg({},i,{verticalPoints:ae})),Q.createElement(LQ,cg({},i,{offset:n,horizontalPoints:X,xAxis:j,yAxis:V})),Q.createElement(BQ,cg({},i,{offset:n,verticalPoints:ae,xAxis:j,yAxis:V})))}EN.displayName="CartesianGrid";var CN=(t,e,r,n)=>RB(t,"xAxis",e,n),PN=(t,e,r,n)=>IB(t,"xAxis",e,n),MN=(t,e,r,n)=>RB(t,"yAxis",r,n),IN=(t,e,r,n)=>IB(t,"yAxis",r,n),VQ=wt([mi,CN,MN,PN,IN],(t,e,r,n,i)=>Hd(t,"xAxis")?zS(e,n,!1):zS(r,i,!1)),$Q=(t,e,r,n,i)=>i;function HQ(t){return t.type==="line"}var WQ=wt([JL,$Q],(t,e)=>t.filter(HQ).find(r=>r.id===e)),qQ=wt([mi,CN,MN,PN,IN,WQ,VQ,YE],(t,e,r,n,i,a,c,s)=>{var{chartData:g,dataStartIndex:_,dataEndIndex:v}=s;if(!(a==null||e==null||r==null||n==null||i==null||n.length===0||i.length===0||c==null)){var{dataKey:T,data:M}=a,O;if(M!=null&&M.length>0?O=M:O=g?.slice(_,v+1),O!=null)return pJ({layout:t,xAxis:e,yAxis:r,xAxisTicks:n,yAxisTicks:i,dataKey:T,bandSize:c,displayedData:O})}}),GQ=["id"],XQ=["type","layout","connectNulls","needClip"],ZQ=["activeDot","animateNewValues","animationBegin","animationDuration","animationEasing","connectNulls","dot","hide","isAnimationActive","label","legendType","xAxisId","yAxisId","id"];function LR(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function dl(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?LR(Object(r),!0).forEach(function(n){YQ(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):LR(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function YQ(t,e,r){return(e=KQ(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function KQ(t){var e=QQ(t,"string");return typeof e=="symbol"?e:e+""}function QQ(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function I3(t,e){if(t==null)return{};var r,n,i=JQ(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)r=a[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function JQ(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}function Eg(){return Eg=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Eg.apply(null,arguments)}var eJ=t=>{var{dataKey:e,name:r,stroke:n,legendType:i,hide:a}=t;return[{inactive:a,dataKey:e,type:i,color:n,value:cL(r,e),payload:t}]};function tJ(t){var{dataKey:e,data:r,stroke:n,strokeWidth:i,fill:a,name:c,hide:s,unit:g}=t;return{dataDefinedOnItem:r,positions:void 0,settings:{stroke:n,strokeWidth:i,fill:a,dataKey:e,nameKey:void 0,name:cL(c,e),hide:s,type:t.tooltipType,color:t.stroke,unit:g}}}var RN=(t,e)=>"".concat(e,"px ").concat(t-e,"px");function rJ(t,e){for(var r=t.length%2!==0?[...t,0]:t,n=[],i=0;i<e;++i)n=[...n,...r];return n}var nJ=(t,e,r)=>{var n=r.reduce((T,M)=>T+M);if(!n)return RN(e,t);for(var i=Math.floor(t/n),a=t%n,c=e-t,s=[],g=0,_=0;g<r.length;_+=r[g],++g)if(_+r[g]>a){s=[...r.slice(0,g),a-_];break}var v=s.length%2===0?[0,c]:[c];return[...rJ(r,i),...s,...v].map(T=>"".concat(T,"px")).join(", ")};function iJ(t,e){var r;if(Q.isValidElement(t))r=Q.cloneElement(t,e);else if(typeof t=="function")r=t(e);else{var n=gi("recharts-line-dot",typeof t!="boolean"?t.className:"");r=Q.createElement(mN,Eg({},e,{className:n}))}return r}function sJ(t,e){return t==null?!1:e?!0:t.length===1}function aJ(t){var{clipPathId:e,points:r,props:n}=t,{dot:i,dataKey:a,needClip:c}=n;if(!sJ(r,i))return null;var{id:s}=n,g=I3(n,GQ),_=l6(i),v=Bg(g),T=ha(i,!0),M=r.map((F,j)=>{var V=dl(dl(dl({key:"dot-".concat(j),r:3},v),T),{},{index:j,cx:F.x,cy:F.y,dataKey:a,value:F.value,payload:F.payload,points:r});return iJ(i,V)}),O={clipPath:c?"url(#clipPath-".concat(_?"":"dots-").concat(e,")"):void 0};return Q.createElement(Ny,Eg({className:"recharts-line-dots",key:"dots"},O),M)}function oJ(t){var{showLabels:e,children:r,points:n}=t,i=Q.useMemo(()=>n?.map(a=>{var c={x:a.x,y:a.y,width:0,height:0};return dl(dl({},c),{},{value:a.value,payload:a.payload,viewBox:c,parentViewBox:void 0,fill:void 0})}),[n]);return Q.createElement(KY,{value:e?i:null},r)}function BR(t){var{clipPathId:e,pathRef:r,points:n,strokeDasharray:i,props:a}=t,{type:c,layout:s,connectNulls:g,needClip:_}=a,v=I3(a,XQ),T=dl(dl({},ha(v,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:_?"url(#clipPath-".concat(e,")"):void 0,points:n,type:c,layout:s,connectNulls:g,strokeDasharray:i??a.strokeDasharray});return Q.createElement(Q.Fragment,null,n?.length>1&&Q.createElement(yL,Eg({},T,{pathRef:r})),Q.createElement(aJ,{points:n,clipPathId:e,props:a}))}function lJ(t){try{return t&&t.getTotalLength&&t.getTotalLength()||0}catch{return 0}}function cJ(t){var{clipPathId:e,props:r,pathRef:n,previousPointsRef:i,longestAnimatedLengthRef:a}=t,{points:c,strokeDasharray:s,isAnimationActive:g,animationBegin:_,animationDuration:v,animationEasing:T,animateNewValues:M,width:O,height:F,onAnimationEnd:j,onAnimationStart:V}=r,q=i.current,Y=wL(r,"recharts-line-"),[X,ae]=Q.useState(!1),ue=!X,ge=Q.useCallback(()=>{typeof j=="function"&&j(),ae(!1)},[j]),Le=Q.useCallback(()=>{typeof V=="function"&&V(),ae(!0)},[V]),qe=lJ(n.current),Ze=a.current;return Q.createElement(oJ,{points:c,showLabels:ue},r.children,Q.createElement(xL,{animationId:Y,begin:_,duration:v,isActive:g,easing:T,onAnimationEnd:ge,onAnimationStart:Le,key:Y},_t=>{var it=af(Ze,qe+Ze,_t),gt=Math.min(it,qe),Lt;if(g)if(s){var Ot="".concat(s).split(/[,\s]+/gim).map(we=>parseFloat(we));Lt=nJ(gt,qe,Ot)}else Lt=RN(qe,gt);else Lt=s==null?void 0:String(s);if(q){var Yt=q.length/c.length,ce=_t===1?c:c.map((we,Re)=>{var Ue=Math.floor(Re*Yt);if(q[Ue]){var at=q[Ue];return dl(dl({},we),{},{x:af(at.x,we.x,_t),y:af(at.y,we.y,_t)})}return M?dl(dl({},we),{},{x:af(O*2,we.x,_t),y:af(F/2,we.y,_t)}):dl(dl({},we),{},{x:we.x,y:we.y})});return i.current=ce,Q.createElement(BR,{props:r,points:ce,clipPathId:e,pathRef:n,strokeDasharray:Lt})}return _t>0&&qe>0&&(i.current=c,a.current=gt),Q.createElement(BR,{props:r,points:c,clipPathId:e,pathRef:n,strokeDasharray:Lt})}),Q.createElement(eK,{label:r.label}))}function uJ(t){var{clipPathId:e,props:r}=t,n=Q.useRef(null),i=Q.useRef(0),a=Q.useRef(null);return Q.createElement(cJ,{props:r,clipPathId:e,previousPointsRef:n,longestAnimatedLengthRef:i,pathRef:a})}var hJ=(t,e)=>({x:t.x,y:t.y,value:t.value,errorVal:Ga(t.payload,e)});class fJ extends Q.Component{render(){var e,{hide:r,dot:n,points:i,className:a,xAxisId:c,yAxisId:s,top:g,left:_,width:v,height:T,id:M,needClip:O}=this.props;if(r)return null;var F=gi("recharts-line",a),j=M,{r:V=3,strokeWidth:q=2}=(e=ha(n,!1))!==null&&e!==void 0?e:{r:3,strokeWidth:2},Y=l6(n),X=V*2+q;return Q.createElement(Q.Fragment,null,Q.createElement(Ny,{className:F},O&&Q.createElement("defs",null,Q.createElement($K,{clipPathId:j,xAxisId:c,yAxisId:s}),!Y&&Q.createElement("clipPath",{id:"clipPath-dots-".concat(j)},Q.createElement("rect",{x:_-X/2,y:g-X/2,width:v+X,height:T+X}))),Q.createElement(VK,{xAxisId:c,yAxisId:s,data:i,dataPointFormatter:hJ,errorBarOffset:0},Q.createElement(uJ,{props:this.props,clipPathId:j}))),Q.createElement(DK,{activeDot:this.props.activeDot,points:i,mainColor:this.props.stroke,itemDataKey:this.props.dataKey}))}}var ON={activeDot:!0,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",connectNulls:!1,dot:!0,fill:"#fff",hide:!1,isAnimationActive:!zy.isSsr,label:!1,legendType:"line",stroke:"#3182bd",strokeWidth:1,xAxisId:0,yAxisId:0};function dJ(t){var e=bc(t,ON),{activeDot:r,animateNewValues:n,animationBegin:i,animationDuration:a,animationEasing:c,connectNulls:s,dot:g,hide:_,isAnimationActive:v,label:T,legendType:M,xAxisId:O,yAxisId:F,id:j}=e,V=I3(e,ZQ),{needClip:q}=xN(O,F),Y=A3(),X=ZE(),ae=vc(),ue=br(_t=>qQ(_t,O,F,ae,j));if(X!=="horizontal"&&X!=="vertical"||ue==null||Y==null)return null;var{height:ge,width:Le,x:qe,y:Ze}=Y;return Q.createElement(fJ,Eg({},V,{id:j,connectNulls:s,dot:g,activeDot:r,animateNewValues:n,animationBegin:i,animationDuration:a,animationEasing:c,isAnimationActive:v,hide:_,label:T,legendType:M,xAxisId:O,yAxisId:F,points:ue,layout:X,height:ge,width:Le,left:qe,top:Ze,needClip:q}))}function pJ(t){var{layout:e,xAxis:r,yAxis:n,xAxisTicks:i,yAxisTicks:a,dataKey:c,bandSize:s,displayedData:g}=t;return g.map((_,v)=>{var T=Ga(_,c);if(e==="horizontal"){var M=pI({axis:r,ticks:i,bandSize:s,entry:_,index:v}),O=Ks(T)?null:n.scale(T);return{x:M,y:O,value:T,payload:_}}var F=Ks(T)?null:r.scale(T),j=pI({axis:n,ticks:a,bandSize:s,entry:_,index:v});return F==null||j==null?null:{x:F,y:j,value:T,payload:_}}).filter(Boolean)}function gJ(t){var e=bc(t,ON),r=vc();return Q.createElement(uK,{id:e.id,type:"line"},n=>Q.createElement(Q.Fragment,null,Q.createElement(sK,{legendPayload:eJ(e)}),Q.createElement(nK,{fn:tJ,args:e}),Q.createElement(mK,{type:"line",id:n,data:e.data,xAxisId:e.xAxisId,yAxisId:e.yAxisId,zAxisId:0,dataKey:e.dataKey,hide:e.hide,isPanorama:r}),Q.createElement(dJ,Eg({},e,{id:n}))))}var R3=Q.memo(gJ);R3.displayName="Line";var mJ=["dangerouslySetInnerHTML","ticks"],yJ=["id"],_J=["domain"],vJ=["domain"];function tA(){return tA=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},tA.apply(null,arguments)}function Jx(t,e){if(t==null)return{};var r,n,i=bJ(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)r=a[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function bJ(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}function xJ(t){var e=Za();return Q.useEffect(()=>(e(xK(t)),()=>{e(wK(t))}),[t,e]),null}var wJ=t=>{var{xAxisId:e,className:r}=t,n=br(hL),i=vc(),a="xAxis",c=br(V=>$y(V,a,e,i)),s=br(V=>MB(V,a,e,i)),g=br(V=>GG(V,e)),_=br(V=>JG(V,e)),v=br(V=>ZL(V,e));if(g==null||_==null||v==null)return null;var{dangerouslySetInnerHTML:T,ticks:M}=t,O=Jx(t,mJ),{id:F}=v,j=Jx(v,yJ);return Q.createElement(M3,tA({},O,j,{scale:c,x:_.x,y:_.y,width:g.width,height:g.height,className:gi("recharts-".concat(a," ").concat(a),r),viewBox:n,ticks:s}))},TJ={allowDataOverflow:ll.allowDataOverflow,allowDecimals:ll.allowDecimals,allowDuplicatedCategory:ll.allowDuplicatedCategory,height:ll.height,hide:!1,mirror:ll.mirror,orientation:ll.orientation,padding:ll.padding,reversed:ll.reversed,scale:ll.scale,tickCount:ll.tickCount,type:ll.type,xAxisId:0},SJ=t=>{var e,r,n,i,a,c=bc(t,TJ);return Q.createElement(Q.Fragment,null,Q.createElement(xJ,{interval:(e=c.interval)!==null&&e!==void 0?e:"preserveEnd",id:c.xAxisId,scale:c.scale,type:c.type,padding:c.padding,allowDataOverflow:c.allowDataOverflow,domain:c.domain,dataKey:c.dataKey,allowDuplicatedCategory:c.allowDuplicatedCategory,allowDecimals:c.allowDecimals,tickCount:c.tickCount,includeHidden:(r=c.includeHidden)!==null&&r!==void 0?r:!1,reversed:c.reversed,ticks:c.ticks,height:c.height,orientation:c.orientation,mirror:c.mirror,hide:c.hide,unit:c.unit,name:c.name,angle:(n=c.angle)!==null&&n!==void 0?n:0,minTickGap:(i=c.minTickGap)!==null&&i!==void 0?i:5,tick:(a=c.tick)!==null&&a!==void 0?a:!0,tickFormatter:c.tickFormatter}),Q.createElement(wJ,c))},AJ=(t,e)=>{var{domain:r}=t,n=Jx(t,_J),{domain:i}=e,a=Jx(e,vJ);return by(n,a)?Array.isArray(r)&&r.length===2&&Array.isArray(i)&&i.length===2?r[0]===i[0]&&r[1]===i[1]:by({domain:r},{domain:i}):!1},O3=Q.memo(SJ,AJ);O3.displayName="XAxis";var EJ=["dangerouslySetInnerHTML","ticks"],CJ=["id"],PJ=["domain"],MJ=["domain"];function rA(){return rA=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},rA.apply(null,arguments)}function e1(t,e){if(t==null)return{};var r,n,i=IJ(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)r=a[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function IJ(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}function RJ(t){var e=Za();return Q.useEffect(()=>(e(TK(t)),()=>{e(SK(t))}),[t,e]),null}var OJ=t=>{var{yAxisId:e,className:r,width:n,label:i}=t,a=Q.useRef(null),c=Q.useRef(null),s=br(hL),g=vc(),_=Za(),v="yAxis",T=br(ue=>$y(ue,v,e,g)),M=br(ue=>rX(ue,e)),O=br(ue=>tX(ue,e)),F=br(ue=>MB(ue,v,e,g)),j=br(ue=>YL(ue,e));if(Q.useLayoutEffect(()=>{if(!(n!=="auto"||!M||S3(i)||Q.isValidElement(i)||j==null)){var ue=a.current;if(ue){var ge=ue.getCalculatedWidth();Math.round(M.width)!==Math.round(ge)&&_(AK({id:e,width:ge}))}}},[F,M,_,i,e,n,j]),M==null||O==null||j==null)return null;var{dangerouslySetInnerHTML:V,ticks:q}=t,Y=e1(t,EJ),{id:X}=j,ae=e1(j,CJ);return Q.createElement(M3,rA({},Y,ae,{ref:a,labelRef:c,scale:T,x:O.x,y:O.y,tickTextProps:n==="auto"?{width:void 0}:{width:n},width:M.width,height:M.height,className:gi("recharts-".concat(v," ").concat(v),r),viewBox:s,ticks:F}))},kJ={allowDataOverflow:cl.allowDataOverflow,allowDecimals:cl.allowDecimals,allowDuplicatedCategory:cl.allowDuplicatedCategory,hide:!1,mirror:cl.mirror,orientation:cl.orientation,padding:cl.padding,reversed:cl.reversed,scale:cl.scale,tickCount:cl.tickCount,type:cl.type,width:cl.width,yAxisId:0},DJ=t=>{var e,r,n,i,a,c=bc(t,kJ);return Q.createElement(Q.Fragment,null,Q.createElement(RJ,{interval:(e=c.interval)!==null&&e!==void 0?e:"preserveEnd",id:c.yAxisId,scale:c.scale,type:c.type,domain:c.domain,allowDataOverflow:c.allowDataOverflow,dataKey:c.dataKey,allowDuplicatedCategory:c.allowDuplicatedCategory,allowDecimals:c.allowDecimals,tickCount:c.tickCount,padding:c.padding,includeHidden:(r=c.includeHidden)!==null&&r!==void 0?r:!1,reversed:c.reversed,ticks:c.ticks,width:c.width,orientation:c.orientation,mirror:c.mirror,hide:c.hide,unit:c.unit,name:c.name,angle:(n=c.angle)!==null&&n!==void 0?n:0,minTickGap:(i=c.minTickGap)!==null&&i!==void 0?i:5,tick:(a=c.tick)!==null&&a!==void 0?a:!0,tickFormatter:c.tickFormatter}),Q.createElement(OJ,c))},LJ=(t,e)=>{var{domain:r}=t,n=e1(t,PJ),{domain:i}=e,a=e1(e,MJ);return by(n,a)?Array.isArray(r)&&r.length===2&&Array.isArray(i)&&i.length===2?r[0]===i[0]&&r[1]===i[1]:by({domain:r},{domain:i}):!1},k3=Q.memo(DJ,LJ);k3.displayName="YAxis";var xT={exports:{}},wT={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var NR;function BJ(){if(NR)return wT;NR=1;var t=ky();function e(g,_){return g===_&&(g!==0||1/g===1/_)||g!==g&&_!==_}var r=typeof Object.is=="function"?Object.is:e,n=t.useSyncExternalStore,i=t.useRef,a=t.useEffect,c=t.useMemo,s=t.useDebugValue;return wT.useSyncExternalStoreWithSelector=function(g,_,v,T,M){var O=i(null);if(O.current===null){var F={hasValue:!1,value:null};O.current=F}else F=O.current;O=c(function(){function V(ue){if(!q){if(q=!0,Y=ue,ue=T(ue),M!==void 0&&F.hasValue){var ge=F.value;if(M(ge,ue))return X=ge}return X=ue}if(ge=X,r(Y,ue))return ge;var Le=T(ue);return M!==void 0&&M(ge,Le)?(Y=ue,ge):(Y=ue,X=Le)}var q=!1,Y,X,ae=v===void 0?null:v;return[function(){return V(_())},ae===null?void 0:function(){return V(ae())}]},[_,v,T,M]);var j=n(g,O[0],O[1]);return a(function(){F.hasValue=!0,F.value=j},[j]),s(j),j},wT}var zR;function NJ(){return zR||(zR=1,xT.exports=BJ()),xT.exports}NJ();function zJ(t){t()}function FJ(){let t=null,e=null;return{clear(){t=null,e=null},notify(){zJ(()=>{let r=t;for(;r;)r.callback(),r=r.next})},get(){const r=[];let n=t;for(;n;)r.push(n),n=n.next;return r},subscribe(r){let n=!0;const i=e={callback:r,next:null,prev:e};return i.prev?i.prev.next=i:t=i,function(){!n||t===null||(n=!1,i.next?i.next.prev=i.prev:e=i.prev,i.prev?i.prev.next=i.next:t=i.next)}}}}var FR={notify(){},get:()=>[]};function UJ(t,e){let r,n=FR,i=0,a=!1;function c(j){v();const V=n.subscribe(j);let q=!1;return()=>{q||(q=!0,V(),T())}}function s(){n.notify()}function g(){F.onStateChange&&F.onStateChange()}function _(){return a}function v(){i++,r||(r=t.subscribe(g),n=FJ())}function T(){i--,r&&i===0&&(r(),r=void 0,n.clear(),n=FR)}function M(){a||(a=!0,v())}function O(){a&&(a=!1,T())}const F={addNestedSub:c,notifyNestedSubs:s,handleChangeWrapper:g,isSubscribed:_,trySubscribe:M,tryUnsubscribe:O,getListeners:()=>n};return F}var jJ=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",VJ=jJ(),$J=()=>typeof navigator<"u"&&navigator.product==="ReactNative",HJ=$J(),WJ=()=>VJ||HJ?Q.useLayoutEffect:Q.useEffect,qJ=WJ(),GJ=Symbol.for("react-redux-context"),XJ=typeof globalThis<"u"?globalThis:{};function ZJ(){if(!Q.createContext)return{};const t=XJ[GJ]??=new Map;let e=t.get(Q.createContext);return e||(e=Q.createContext(null),t.set(Q.createContext,e)),e}var YJ=ZJ();function KJ(t){const{children:e,context:r,serverState:n,store:i}=t,a=Q.useMemo(()=>{const g=UJ(i);return{store:i,subscription:g,getServerState:n?()=>n:void 0}},[i,n]),c=Q.useMemo(()=>i.getState(),[i]);qJ(()=>{const{subscription:g}=a;return g.onStateChange=g.notifyNestedSubs,g.trySubscribe(),c!==i.getState()&&g.notifyNestedSubs(),()=>{g.tryUnsubscribe(),g.onStateChange=void 0}},[a,c]);const s=r||YJ;return Q.createElement(s.Provider,{value:a},e)}var QJ=KJ,JJ=(t,e)=>e,D3=wt([JJ,mi,WL,Rs,WB,Cf,oZ,da],fZ),L3=t=>{var e=t.currentTarget.getBoundingClientRect(),r=e.width/t.currentTarget.offsetWidth,n=e.height/t.currentTarget.offsetHeight;return{chartX:Math.round((t.clientX-e.left)/r),chartY:Math.round((t.clientY-e.top)/n)}},kN=gc("mouseClick"),DN=l0();DN.startListening({actionCreator:kN,effect:(t,e)=>{var r=t.payload,n=D3(e.getState(),L3(r));n?.activeIndex!=null&&e.dispatch(pX({activeIndex:n.activeIndex,activeDataKey:void 0,activeCoordinate:n.activeCoordinate}))}});var nA=gc("mouseMove"),LN=l0();LN.startListening({actionCreator:nA,effect:(t,e)=>{var r=t.payload,n=e.getState(),i=p3(n,n.tooltip.settings.shared),a=D3(n,L3(r));i==="axis"&&(a?.activeIndex!=null?e.dispatch(zB({activeIndex:a.activeIndex,activeDataKey:void 0,activeCoordinate:a.activeCoordinate})):e.dispatch(NB()))}});var UR={accessibilityLayer:!0,barCategoryGap:"10%",barGap:4,barSize:void 0,className:void 0,maxBarSize:void 0,stackOffset:"none",syncId:void 0,syncMethod:"index"},BN=wl({name:"rootProps",initialState:UR,reducers:{updateOptions:(t,e)=>{var r;t.accessibilityLayer=e.payload.accessibilityLayer,t.barCategoryGap=e.payload.barCategoryGap,t.barGap=(r=e.payload.barGap)!==null&&r!==void 0?r:UR.barGap,t.barSize=e.payload.barSize,t.maxBarSize=e.payload.maxBarSize,t.stackOffset=e.payload.stackOffset,t.syncId=e.payload.syncId,t.syncMethod=e.payload.syncMethod,t.className=e.payload.className}}}),eee=BN.reducer,{updateOptions:tee}=BN.actions,NN=wl({name:"polarOptions",initialState:null,reducers:{updatePolarOptions:(t,e)=>e.payload}}),{updatePolarOptions:c_e}=NN.actions,ree=NN.reducer,zN=gc("keyDown"),FN=gc("focus"),B3=l0();B3.startListening({actionCreator:zN,effect:(t,e)=>{var r=e.getState(),n=r.rootProps.accessibilityLayer!==!1;if(n){var{keyboardInteraction:i}=r.tooltip,a=t.payload;if(!(a!=="ArrowRight"&&a!=="ArrowLeft"&&a!=="Enter")){var c=Number(g3(i,Wy(r))),s=Cf(r);if(a==="Enter"){var g=Zx(r,"axis","hover",String(i.index));e.dispatch(ZS({active:!i.active,activeIndex:i.index,activeDataKey:i.dataKey,activeCoordinate:g}));return}var _=aX(r),v=_==="left-to-right"?1:-1,T=a==="ArrowRight"?1:-1,M=c+T*v;if(!(s==null||M>=s.length||M<0)){var O=Zx(r,"axis","hover",String(M));e.dispatch(ZS({active:!0,activeIndex:M.toString(),activeDataKey:void 0,activeCoordinate:O}))}}}}});B3.startListening({actionCreator:FN,effect:(t,e)=>{var r=e.getState(),n=r.rootProps.accessibilityLayer!==!1;if(n){var{keyboardInteraction:i}=r.tooltip;if(!i.active&&i.index==null){var a="0",c=Zx(r,"axis","hover",String(a));e.dispatch(ZS({activeDataKey:void 0,active:!0,activeIndex:a,activeCoordinate:c}))}}}});var sc=gc("externalEvent"),UN=l0();UN.startListening({actionCreator:sc,effect:(t,e)=>{if(t.payload.handler!=null){var r=e.getState(),n={activeCoordinate:KX(r),activeDataKey:ZX(r),activeIndex:qv(r),activeLabel:XB(r),activeTooltipIndex:qv(r),isTooltipActive:QX(r)};t.payload.handler(n,t.payload.reactEvent)}}});var nee=wt([Hy],t=>t.tooltipItemPayloads),iee=wt([nee,p0,(t,e,r)=>e,(t,e,r)=>r],(t,e,r,n)=>{var i=t.find(s=>s.settings.dataKey===n);if(i!=null){var{positions:a}=i;if(a!=null){var c=e(a,r);return c}}}),jN=gc("touchMove"),VN=l0();VN.startListening({actionCreator:jN,effect:(t,e)=>{var r=t.payload,n=e.getState(),i=p3(n,n.tooltip.settings.shared);if(i==="axis"){var a=D3(n,L3({clientX:r.touches[0].clientX,clientY:r.touches[0].clientY,currentTarget:r.currentTarget}));a?.activeIndex!=null&&e.dispatch(zB({activeIndex:a.activeIndex,activeDataKey:void 0,activeCoordinate:a.activeCoordinate}))}else if(i==="item"){var c,s=r.touches[0],g=document.elementFromPoint(s.clientX,s.clientY);if(!g||!g.getAttribute)return;var _=g.getAttribute(dW),v=(c=g.getAttribute(pW))!==null&&c!==void 0?c:void 0,T=iee(e.getState(),_,v);e.dispatch(dX({activeDataKey:v,activeIndex:_,activeCoordinate:T}))}}});var see=N6({brush:WK,cartesianAxis:EK,chartData:MZ,errorBars:BK,graphicalItems:gK,layout:FH,legend:MW,options:SZ,polarAxis:rK,polarOptions:ree,referenceElements:QK,rootProps:eee,tooltip:gX}),aee=function(e){return uH({reducer:see,preloadedState:e,middleware:r=>r({serializableCheck:!1}).concat([DN.middleware,LN.middleware,B3.middleware,UN.middleware,VN.middleware]),devTools:zy.devToolsEnabled})};function oee(t){var{preloadedState:e,children:r,reduxStoreName:n}=t,i=vc(),a=Q.useRef(null);if(i)return r;a.current==null&&(a.current=aee(e));var c=VE;return Q.createElement(QJ,{context:c,store:a.current},r)}function lee(t){var{layout:e,width:r,height:n,margin:i}=t,a=Za(),c=vc();return Q.useEffect(()=>{c||(a(BH(e)),a(NH({width:r,height:n})),a(LH(i)))},[a,c,e,r,n,i]),null}function cee(t){var e=Za();return Q.useEffect(()=>{e(tee(t))},[e,t]),null}var uee=["children"];function hee(t,e){if(t==null)return{};var r,n,i=fee(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)r=a[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function fee(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}function t1(){return t1=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},t1.apply(null,arguments)}var dee={width:"100%",height:"100%"},pee=Q.forwardRef((t,e)=>{var r=dL(),n=pL(),i=mL();if(!Vx(r)||!Vx(n))return null;var{children:a,otherAttributes:c,title:s,desc:g}=t,_,v;return typeof c.tabIndex=="number"?_=c.tabIndex:_=i?0:void 0,typeof c.role=="string"?v=c.role:v=i?"application":void 0,Q.createElement(c6,t1({},c,{title:s,desc:g,role:v,tabIndex:_,width:r,height:n,style:dee,ref:e}),a)}),gee=t=>{var{children:e}=t,r=br(Y1);if(!r)return null;var{width:n,height:i,y:a,x:c}=r;return Q.createElement(c6,{width:n,height:i,x:c,y:a},e)},jR=Q.forwardRef((t,e)=>{var{children:r}=t,n=hee(t,uee),i=vc();return i?Q.createElement(gee,null,r):Q.createElement(pee,t1({ref:e},n),r)});function mee(){var t=Za(),[e,r]=Q.useState(null),n=br(fW);return Q.useEffect(()=>{if(e!=null){var i=e.getBoundingClientRect(),a=i.width/e.offsetWidth;cu(a)&&a!==n&&t(zH(a))}},[e,t,n]),r}function VR(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function yee(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?VR(Object(r),!0).forEach(function(n){_ee(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):VR(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function _ee(t,e,r){return(e=vee(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function vee(t){var e=bee(t,"string");return typeof e=="symbol"?e:e+""}function bee(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var xee=Q.forwardRef((t,e)=>{var{children:r,className:n,height:i,onClick:a,onContextMenu:c,onDoubleClick:s,onMouseDown:g,onMouseEnter:_,onMouseLeave:v,onMouseMove:T,onMouseUp:M,onTouchEnd:O,onTouchMove:F,onTouchStart:j,style:V,width:q}=t,Y=Za(),[X,ae]=Q.useState(null),[ue,ge]=Q.useState(null);zZ();var Le=mee(),qe=Q.useCallback(Pe=>{Le(Pe),typeof e=="function"&&e(Pe),ae(Pe),ge(Pe)},[Le,e,ae,ge]),Ze=Q.useCallback(Pe=>{Y(kN(Pe)),Y(sc({handler:a,reactEvent:Pe}))},[Y,a]),_t=Q.useCallback(Pe=>{Y(nA(Pe)),Y(sc({handler:_,reactEvent:Pe}))},[Y,_]),it=Q.useCallback(Pe=>{Y(NB()),Y(sc({handler:v,reactEvent:Pe}))},[Y,v]),gt=Q.useCallback(Pe=>{Y(nA(Pe)),Y(sc({handler:T,reactEvent:Pe}))},[Y,T]),Lt=Q.useCallback(()=>{Y(FN())},[Y]),Ot=Q.useCallback(Pe=>{Y(zN(Pe.key))},[Y]),Yt=Q.useCallback(Pe=>{Y(sc({handler:c,reactEvent:Pe}))},[Y,c]),ce=Q.useCallback(Pe=>{Y(sc({handler:s,reactEvent:Pe}))},[Y,s]),we=Q.useCallback(Pe=>{Y(sc({handler:g,reactEvent:Pe}))},[Y,g]),Re=Q.useCallback(Pe=>{Y(sc({handler:M,reactEvent:Pe}))},[Y,M]),Ue=Q.useCallback(Pe=>{Y(sc({handler:j,reactEvent:Pe}))},[Y,j]),at=Q.useCallback(Pe=>{Y(jN(Pe)),Y(sc({handler:F,reactEvent:Pe}))},[Y,F]),pe=Q.useCallback(Pe=>{Y(sc({handler:O,reactEvent:Pe}))},[Y,O]);return Q.createElement(eN.Provider,{value:X},Q.createElement(CV.Provider,{value:ue},Q.createElement("div",{className:gi("recharts-wrapper",n),style:yee({position:"relative",cursor:"default",width:q,height:i},V),onClick:Ze,onContextMenu:Yt,onDoubleClick:ce,onFocus:Lt,onKeyDown:Ot,onMouseDown:we,onMouseEnter:_t,onMouseLeave:it,onMouseMove:gt,onMouseUp:Re,onTouchEnd:pe,onTouchMove:at,onTouchStart:Ue,ref:qe},r)))}),wee=["children","className","width","height","style","compact","title","desc"];function Tee(t,e){if(t==null)return{};var r,n,i=See(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)r=a[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function See(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}var Aee=Q.forwardRef((t,e)=>{var{children:r,className:n,width:i,height:a,style:c,compact:s,title:g,desc:_}=t,v=Tee(t,wee),T=Bg(v);return s?Q.createElement(jR,{otherAttributes:T,title:g,desc:_},r):Q.createElement(xee,{className:n,style:c,width:i,height:a,onClick:t.onClick,onMouseLeave:t.onMouseLeave,onMouseEnter:t.onMouseEnter,onMouseMove:t.onMouseMove,onMouseDown:t.onMouseDown,onMouseUp:t.onMouseUp,onContextMenu:t.onContextMenu,onDoubleClick:t.onDoubleClick,onTouchStart:t.onTouchStart,onTouchMove:t.onTouchMove,onTouchEnd:t.onTouchEnd},Q.createElement(jR,{otherAttributes:T,title:g,desc:_,ref:e},Q.createElement(eQ,null,r)))}),Eee=["width","height"];function iA(){return iA=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},iA.apply(null,arguments)}function Cee(t,e){if(t==null)return{};var r,n,i=Pee(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)r=a[n],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function Pee(t,e){if(t==null)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)!==-1)continue;r[n]=t[n]}return r}var Mee={top:5,right:5,bottom:5,left:5},Iee={accessibilityLayer:!0,layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:Mee,reverseStackOrder:!1,syncMethod:"index"},Ree=Q.forwardRef(function(e,r){var n,i=bc(e.categoricalChartProps,Iee),{width:a,height:c}=i,s=Cee(i,Eee);if(!Vx(a)||!Vx(c))return null;var{chartName:g,defaultTooltipEventType:_,validateTooltipEventTypes:v,tooltipPayloadSearcher:T,categoricalChartProps:M}=e,O={chartName:g,defaultTooltipEventType:_,validateTooltipEventTypes:v,tooltipPayloadSearcher:T,eventEmitter:void 0};return Q.createElement(oee,{preloadedState:{options:O},reduxStoreName:(n=M.id)!==null&&n!==void 0?n:g},Q.createElement(HK,{chartData:M.data}),Q.createElement(lee,{width:a,height:c,layout:i.layout,margin:i.margin}),Q.createElement(cee,{accessibilityLayer:i.accessibilityLayer,barCategoryGap:i.barCategoryGap,maxBarSize:i.maxBarSize,stackOffset:i.stackOffset,barGap:i.barGap,barSize:i.barSize,syncId:i.syncId,syncMethod:i.syncMethod,className:i.className}),Q.createElement(Aee,iA({},s,{width:a,height:c,ref:r})))}),Oee=["axis"],$N=Q.forwardRef((t,e)=>Q.createElement(Ree,{chartName:"LineChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:Oee,tooltipPayloadSearcher:wZ,categoricalChartProps:t,ref:e}));const $R=[{year:2012,"Builtup Area":191.92},{year:2014,"Builtup Area":192.19},{year:2016,"Builtup Area":214.56},{year:2018,"Builtup Area":266.34},{year:2020,"Builtup Area":327.52},{year:2022,"Builtup Area":345.42},{year:2024,"Builtup Area":386.12}];function kee(){return Se.jsxs("div",{className:"w-full h-auto p-4 mb-12",children:[Se.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-1",children:"Built-up Area Trend (20122024)"}),Se.jsx(sN,{width:"100%",height:350,children:Se.jsxs($N,{data:$R,margin:{top:20,right:80,left:30,bottom:20},children:[Se.jsx(EN,{strokeDasharray:"3 3",stroke:"#e5e7eb",vertical:!1}),Se.jsx(O3,{dataKey:"year",tick:{fontSize:12,fill:"#6b7280"},tickMargin:8,label:{value:"Year",position:"insideBottom",offset:-20}}),Se.jsx(k3,{tick:{fontSize:12,fill:"#6b7280"},tickFormatter:t=>`${t}`,domain:["dataMin - 20","dataMax + 20"],label:{value:"Total Builtup Area (sq km)",angle:-90,position:"insideLeft",offset:-20,style:{textAnchor:"middle"}}}),Se.jsx(iN,{contentStyle:{backgroundColor:"white",borderRadius:"8px",border:"1px solid #e5e7eb"},formatter:t=>[`${t} km`,"Built-up Area"]}),Se.jsx(R3,{type:"monotone",dataKey:"Builtup Area",stroke:"#6C2F2D",strokeWidth:3,dot:{r:4,strokeWidth:2,fill:"white"},children:Se.jsx(Ev,{dataKey:"Builtup Area",position:"top",formatter:t=>`${t}`,fill:"#6C2F2D",fontSize:12,content:t=>{const{x:e,y:r,value:n,index:i}=t;return i===$R.length-1?Se.jsx("text",{x:e+10,y:r-5,fill:"#6C2F2D",fontSize:13,children:`${n} km`}):null}})})]})})]})}const Dee="/assets/anugul-hS4UaIce.png",Lee="/assets/dnb_2012_24-yqtTxpaA.gif";function r1(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const N3=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),HR=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);HR&&parseFloat(HR[1]);const WR=globalThis,qR=globalThis.process||{},Bee=globalThis.navigator||{};function HN(t){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const r=typeof navigator<"u"&&navigator.userAgent;return!!(r&&r.indexOf("Electron")>=0)}function zg(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||HN()}function Nee(t){return zg()?HN()?"Electron":(Bee.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const WN="4.1.0";function zee(t){try{const e=window[t],r="__storage_test__";return e.setItem(r,r),e.removeItem(r),e}catch{return null}}class Fee{constructor(e,r,n="sessionStorage"){this.storage=zee(n),this.id=e,this.config=r,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const r=JSON.stringify(this.config);this.storage.setItem(this.id,r)}}_loadConfiguration(){let e={};if(this.storage){const r=this.storage.getItem(this.id);e=r?JSON.parse(r):{}}return Object.assign(this.config,e),this}}function Uee(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function jee(t,e=8){const r=Math.max(e-t.length,0);return`${" ".repeat(r)}${t}`}var n1;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(n1||(n1={}));const Vee=10;function GR(t){return typeof t!="string"?t:(t=t.toUpperCase(),n1[t]||n1.WHITE)}function $ee(t,e,r){return!zg&&typeof t=="string"&&(e&&(t=`\x1B[${GR(e)}m${t}\x1B[39m`),r&&(t=`\x1B[${GR(r)+Vee}m${t}\x1B[49m`)),t}function Hee(t,e=["constructor"]){const r=Object.getPrototypeOf(t),n=Object.getOwnPropertyNames(r),i=t;for(const a of n){const c=i[a];typeof c=="function"&&(e.find(s=>a===s)||(i[a]=c.bind(t)))}}function z3(t,e){if(!t)throw new Error("Assertion failed")}function Wm(){let t;if(zg()&&WR.performance)t=WR?.performance?.now?.();else if("hrtime"in qR){const e=qR?.hrtime?.();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}const qm={debug:zg()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Wee={enabled:!0,level:0};function Gm(){}const XR={},ZR={once:!0};class m0{constructor({id:e}={id:""}){this.VERSION=WN,this._startTs=Wm(),this._deltaTs=Wm(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new Fee(`__probe-${this.id}__`,Wee),this.timeStamp(`${this.id} started`),Hee(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Wm()-this._startTs).toPrecision(10))}getDelta(){return Number((Wm()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,r){this._storage.setConfiguration({[e]:r})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,r){if(!e)throw new Error(r||"Assertion failed")}warn(e){return this._getLogFunction(0,e,qm.warn,arguments,ZR)}error(e){return this._getLogFunction(0,e,qm.error,arguments)}deprecated(e,r){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${r}\` instead`)}removed(e,r){return this.error(`\`${e}\` has been removed. Use \`${r}\` instead`)}probe(e,r){return this._getLogFunction(e,r,qm.log,arguments,{time:!0,once:!0})}log(e,r){return this._getLogFunction(e,r,qm.debug,arguments)}info(e,r){return this._getLogFunction(e,r,console.info,arguments)}once(e,r){return this._getLogFunction(e,r,qm.debug||qm.info,arguments,ZR)}table(e,r,n){return r?this._getLogFunction(e,r,console.table||Gm,n&&[n],{tag:Gee(r)}):Gm}time(e,r){return this._getLogFunction(e,r,console.time?console.time:console.info)}timeEnd(e,r){return this._getLogFunction(e,r,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,r){return this._getLogFunction(e,r,console.timeStamp||Gm)}group(e,r,n={collapsed:!1}){const i=YR({logLevel:e,message:r,opts:n}),{collapsed:a}=n;return i.method=(a?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,r,n={}){return this.group(e,r,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Gm)}withGroup(e,r,n){this.group(e,r)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=qN(e)}_getLogFunction(e,r,n,i,a){if(this._shouldLog(e)){a=YR({logLevel:e,message:r,args:i,opts:a}),n=n||a.method,z3(n),a.total=this.getTotal(),a.delta=this.getDelta(),this._deltaTs=Wm();const c=a.tag||a.message;if(a.once&&c)if(!XR[c])XR[c]=Wm();else return Gm;return r=qee(this.id,a.message,a),n.bind(console,r,...a.args)}return Gm}}m0.VERSION=WN;function qN(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return z3(Number.isFinite(e)&&e>=0),e}function YR(t){const{logLevel:e,message:r}=t;t.logLevel=qN(e);const n=t.args?Array.from(t.args):[];for(;n.length&&n.shift()!==r;);switch(typeof e){case"string":case"function":r!==void 0&&n.unshift(r),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return z3(i==="string"||i==="object"),Object.assign(t,{args:n},t.opts)}function qee(t,e,r){if(typeof e=="string"){const n=r.time?jee(Uee(r.total)):"";e=r.time?`${t}: ${n}  ${e}`:`${t}: ${e}`,e=$ee(e,r.color,r.background)}return e}function Gee(t){for(const e in t)for(const r in t[e])return r||"untitled";return"empty"}const TT="4.3.3",Xee=TT[0]>="0"&&TT[0]<="9"?`v${TT}`:"";function Zee(){const t=new m0({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=Xee,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}const Yee=Zee();function Kee(t,e){return GN(t||{},e)}function GN(t,e,r=0){if(r>3)return e;const n={...t};for(const[i,a]of Object.entries(e))a&&typeof a=="object"&&!Array.isArray(a)?n[i]=GN(n[i]||{},e[i],r+1):n[i]=e[i];return n}const Qee="latest";function Jee(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const ete=Jee();function Ud(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const yg=typeof process!="object"||String(process)!=="[object process]"||process.browser,tte=typeof window<"u"&&typeof window.orientation<"u",KR=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);KR&&parseFloat(KR[1]);class rte{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,r){this.name=e,this.workerThread=r,this.result=new Promise((n,i)=>{this._resolve=n,this._reject=i})}postMessage(e,r){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:r})}done(e){Ud(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Ud(this.isRunning),this.isRunning=!1,this._reject(e)}}class ST{terminate(){}}const AT=new Map;function nte(t){Ud(t.source&&!t.url||!t.source&&t.url);let e=AT.get(t.source||t.url);return e||(t.url&&(e=ite(t.url),AT.set(t.url,e)),t.source&&(e=XN(t.source),AT.set(t.source,e))),Ud(e),e}function ite(t){if(!t.startsWith("http"))return t;const e=ste(t);return XN(e)}function XN(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function ste(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function ZN(t,e=!0,r){const n=r||new Set;if(t){if(QR(t))n.add(t);else if(QR(t.buffer))n.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const i in t)ZN(t[i],e,n)}}return r===void 0?Array.from(n):[]}function QR(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const ET=()=>{};class sA{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&yg||typeof ST<"u"&&!yg}constructor(e){const{name:r,source:n,url:i}=e;Ud(n||i),this.name=r,this.source=n,this.url=i,this.onMessage=ET,this.onError=a=>console.log(a),this.worker=yg?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=ET,this.onError=ET,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,r){r=r||ZN(e),this.worker.postMessage(e,r)}_getErrorFromErrorEvent(e){let r="Failed to load ";return r+=`worker ${this.name} from ${this.url}. `,e.message&&(r+=`${e.message} in `),e.lineno&&(r+=`:${e.lineno}:${e.colno}`),new Error(r)}_createBrowserWorker(){this._loadableURL=nte({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=r=>{r.data?this.onMessage(r.data):this.onError(new Error("No data received"))},e.onerror=r=>{this.onError(this._getErrorFromErrorEvent(r)),this.terminated=!0},e.onmessageerror=r=>console.error(r),e}_createNodeWorker(){let e;if(this.url){const n=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new ST(n,{eval:!1})}else if(this.source)e=new ST(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",r=>{this.onMessage(r)}),e.on("error",r=>{this.onError(r)}),e.on("exit",r=>{}),e}}class ate{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return sA.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,r=(i,a,c)=>i.done(c),n=(i,a)=>i.error(a)){const i=new Promise(a=>(this.jobQueue.push({name:e,onMessage:r,onError:n,onStart:a}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const r=this.jobQueue.shift();if(r){this.onDebug({message:"Starting job",name:r.name,workerThread:e,backlog:this.jobQueue.length});const n=new rte(r.name,e);e.onMessage=i=>r.onMessage(n,i.type,i.payload),e.onError=i=>r.onError(n,i),r.onStart(n);try{await n.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!yg||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new sA({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return tte?this.maxMobileConcurrency:this.maxConcurrency}}const ote={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Id{props;workerPools=new Map;static _workerFarm;static isSupported(){return sA.isSupported()}static getWorkerFarm(e={}){return Id._workerFarm=Id._workerFarm||new Id({}),Id._workerFarm.setProps(e),Id._workerFarm}constructor(e){this.props={...ote},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const r of this.workerPools.values())r.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:r,source:n,url:i}=e;let a=this.workerPools.get(r);return a||(a=new ate({name:r,source:n,url:i}),a.setProps(this._getWorkerPoolProps()),this.workerPools.set(r,a)),a}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function lte(t,e={}){const r=e[t.id]||{},n=yg?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let i=r.workerUrl;if(!i&&t.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(yg?i=`modules/${t.module}/dist/${n}`:i=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!i){let a=t.version;a==="latest"&&(a=Qee);const c=a?`@${a}`:"";i=`https://unpkg.com/@loaders.gl/${t.module}${c}/dist/${n}`}return Ud(i),i}function cte(t,e=ete){Ud(t,"no worker provided");const r=t.version;return!(!e||!r)}function ute(t,e){return!Id.isSupported()||!yg&&!e?._nodeWorkers?!1:t.worker&&e?.worker}async function hte(t,e,r,n,i){const a=t.id,c=lte(t,r),g=Id.getWorkerFarm(r).getWorkerPool({name:a,url:c});r=JSON.parse(JSON.stringify(r)),n=JSON.parse(JSON.stringify(n||{}));const _=await g.startJob("process-on-worker",fte.bind(null,i));return _.postMessage("process",{input:e,options:r,context:n}),await(await _.result).result}async function fte(t,e,r,n){switch(r){case"done":e.done(n);break;case"error":e.error(new Error(n.error));break;case"process":const{id:i,input:a,options:c}=n;try{const s=await t(a,c);e.postMessage("done",{id:i,result:s})}catch(s){const g=s instanceof Error?s.message:"unknown error";e.postMessage("error",{id:i,error:g})}break;default:console.warn(`parse-with-worker unknown message ${r}`)}}function dte(t,e,r){if(r=r||t.byteLength,t.byteLength<r||e.byteLength<r)return!1;const n=new Uint8Array(t),i=new Uint8Array(e);for(let a=0;a<n.length;++a)if(n[a]!==i[a])return!1;return!0}function pte(...t){return gte(t)}function gte(t){const e=t.map(a=>a instanceof ArrayBuffer?new Uint8Array(a):a),r=e.reduce((a,c)=>a+c.byteLength,0),n=new Uint8Array(r);let i=0;for(const a of e)n.set(a,i),i+=a.byteLength;return n.buffer}async function mte(t){const e=[];for await(const r of t)e.push(r);return pte(...e)}function JR(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class eO{constructor(e,r){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=r,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=JR(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(JR()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class ow{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,r="count"){return this._getOrCreate({name:e,type:r})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const r of Object.values(this.stats))e(r)}getTable(){const e={};return this.forEach(r=>{e[r.name]={time:r.time||0,count:r.count||0,average:r.getAverageTime()||0,hz:r.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(r=>this._getOrCreate(r))}_getOrCreate(e){const{name:r,type:n}=e;let i=this.stats[r];return i||(e instanceof eO?i=e:i=new eO(r,n),this.stats[r]=i),i}}let yte="";const tO={};function _te(t){for(const e in tO)if(t.startsWith(e)){const r=tO[e];t=t.replace(e,r)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${yte}${t}`),t}function vte(t){return t&&typeof t=="object"&&t.isBuffer}function YN(t){if(vte(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function KN(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function bte(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const xte=t=>typeof t=="boolean",Cv=t=>typeof t=="function",y0=t=>t!==null&&typeof t=="object",rO=t=>y0(t)&&t.constructor==={}.constructor,wte=t=>!!t&&typeof t[Symbol.iterator]=="function",Tte=t=>t&&typeof t[Symbol.asyncIterator]=="function",Fg=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Ug=t=>typeof Blob<"u"&&t instanceof Blob,Ste=t=>t&&typeof t=="object"&&t.isBuffer,Ate=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||y0(t)&&Cv(t.tee)&&Cv(t.cancel)&&Cv(t.getReader),Ete=t=>y0(t)&&Cv(t.read)&&Cv(t.pipe)&&xte(t.readable),QN=t=>Ate(t)||Ete(t);class Cte extends Error{constructor(e,r){super(e),this.reason=r.reason,this.url=r.url,this.response=r.response}reason;url;response}const Pte=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Mte=/^([-\w.]+\/[-\w.+]+)/;function nO(t,e){return t.toLowerCase()===e.toLowerCase()}function Ite(t){const e=Mte.exec(t);return e?e[1]:t}function iO(t){const e=Pte.exec(t);return e?e[1]:""}const JN=/\?.*/;function Rte(t){const e=t.match(JN);return e&&e[0]}function F3(t){return t.replace(JN,"")}function Ote(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function lw(t){return Fg(t)?t.url:Ug(t)?t.name||"":typeof t=="string"?t:""}function U3(t){if(Fg(t)){const e=t,r=e.headers.get("content-type")||"",n=F3(e.url);return Ite(r)||iO(n)}return Ug(t)?t.type||"":typeof t=="string"?iO(t):""}function kte(t){return Fg(t)?t.headers["content-length"]||-1:Ug(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function ez(t){if(Fg(t))return t;const e={},r=kte(t);r>=0&&(e["content-length"]=String(r));const n=lw(t),i=U3(t);i&&(e["content-type"]=i);const a=await Bte(t);a&&(e["x-first-bytes"]=a),typeof t=="string"&&(t=new TextEncoder().encode(t));const c=new Response(t,{headers:e});return Object.defineProperty(c,"url",{value:n}),c}async function Dte(t){if(!t.ok)throw await Lte(t)}async function Lte(t){const e=Ote(t.url);let r=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;r=r.length>100?`${r.slice(0,100)}...`:r;const n={reason:t.statusText,url:t.url,response:t};try{const i=t.headers.get("Content-Type");n.reason=!t.bodyUsed&&i?.includes("application/json")?await t.json():await t.text()}catch{}return new Cte(r,n)}async function Bte(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const r=t.slice(0,5);return await new Promise(n=>{const i=new FileReader;i.onload=a=>n(a?.target?.result),i.readAsDataURL(r)})}if(t instanceof ArrayBuffer){const r=t.slice(0,5);return`data:base64,${Nte(r)}`}return null}function Nte(t){let e="";const r=new Uint8Array(t);for(let n=0;n<r.byteLength;n++)e+=String.fromCharCode(r[n]);return btoa(e)}function zte(t){return!Fte(t)&&!Ute(t)}function Fte(t){return t.startsWith("http:")||t.startsWith("https:")}function Ute(t){return t.startsWith("data:")}async function sO(t,e){if(typeof t=="string"){const r=_te(t);return zte(r)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(r,e):await fetch(r,e)}return await ez(t)}const aO=new m0({id:"loaders.gl"});class jte{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class Vte{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const tz={fetch:null,mimeType:void 0,nothrow:!1,log:new Vte,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:N3,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},$te={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function rz(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function nz(){const t=rz();return t.globalOptions=t.globalOptions||{...tz},t.globalOptions}function Hte(t,e,r,n){return r=r||[],r=Array.isArray(r)?r:[r],Wte(t,r),Gte(e,t,n)}function Wte(t,e){oO(t,null,tz,$te,e);for(const r of e){const n=t&&t[r.id]||{},i=r.options&&r.options[r.id]||{},a=r.deprecatedOptions&&r.deprecatedOptions[r.id]||{};oO(n,r.id,i,a,e)}}function oO(t,e,r,n,i){const a=e||"Top level",c=e?`${e}.`:"";for(const s in t){const g=!e&&y0(t[s]),_=s==="baseUri"&&!e,v=s==="workerUrl"&&e;if(!(s in r)&&!_&&!v){if(s in n)aO.warn(`${a} loader option '${c}${s}' no longer supported, use '${n[s]}'`)();else if(!g){const T=qte(s,i);aO.warn(`${a} loader option '${c}${s}' not recognized. ${T}`)()}}}}function qte(t,e){const r=t.toLowerCase();let n="";for(const i of e)for(const a in i.options){if(t===a)return`Did you mean '${i.id}.${a}'?`;const c=a.toLowerCase();(r.startsWith(c)||c.startsWith(r))&&(n=n||`Did you mean '${i.id}.${a}'?`)}return n}function Gte(t,e,r){const i={...t.options||{}};return Xte(i,r),i.log===null&&(i.log=new jte),lO(i,nz()),lO(i,e),i}function lO(t,e){for(const r in e)if(r in e){const n=e[r];rO(n)&&rO(t[r])?t[r]={...t[r],...e[r]}:t[r]=e[r]}}function Xte(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function j3(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t?.extensions)):!1}function V3(t){r1(t,"null loader"),r1(j3(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t?.parseTextSync||t?.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const iz=()=>{const t=rz();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function Zte(t){const e=iz();t=Array.isArray(t)?t:[t];for(const r of t){const n=V3(r);e.find(i=>n===i)||e.unshift(n)}}function Yte(){return iz()}const Kte=/\.([^.]+)$/;async function Qte(t,e=[],r,n){if(!sz(t))return null;let i=cO(t,e,{...r,nothrow:!0},n);if(i)return i;if(Ug(t)&&(t=await t.slice(0,10).arrayBuffer(),i=cO(t,e,r,n)),!i&&!r?.nothrow)throw new Error(az(t));return i}function cO(t,e=[],r,n){if(!sz(t))return null;if(e&&!Array.isArray(e))return V3(e);let i=[];e&&(i=i.concat(e)),r?.ignoreRegisteredLoaders||i.push(...Yte()),ere(i);const a=Jte(t,i,r,n);if(!a&&!r?.nothrow)throw new Error(az(t));return a}function Jte(t,e,r,n){const i=lw(t),a=U3(t),c=F3(i)||n?.url;let s=null,g="";return r?.mimeType&&(s=CT(e,r?.mimeType),g=`match forced by supplied MIME type ${r?.mimeType}`),s=s||tre(e,c),g=g||(s?`matched url ${c}`:""),s=s||CT(e,a),g=g||(s?`matched MIME type ${a}`:""),s=s||nre(e,t),g=g||(s?`matched initial data ${oz(t)}`:""),r?.fallbackMimeType&&(s=s||CT(e,r?.fallbackMimeType),g=g||(s?`matched fallback MIME type ${a}`:"")),g&&Yee.log(1,`selectLoader selected ${s?.name}: ${g}.`),s}function sz(t){return!(t instanceof Response&&t.status===204)}function az(t){const e=lw(t),r=U3(t);let n="No valid loader found (";n+=e?`${KN(e)}, `:"no url provided, ",n+=`MIME type: ${r?`"${r}"`:"not provided"}, `;const i=t?oz(t):"";return n+=i?` first bytes: "${i}"`:"first bytes: not available",n+=")",n}function ere(t){for(const e of t)V3(e)}function tre(t,e){const r=e&&Kte.exec(e),n=r&&r[1];return n?rre(t,n):null}function rre(t,e){e=e.toLowerCase();for(const r of t)for(const n of r.extensions)if(n.toLowerCase()===e)return r;return null}function CT(t,e){for(const r of t)if(r.mimeTypes?.some(n=>nO(e,n))||nO(e,`application/x.${r.id}`))return r;return null}function nre(t,e){if(!e)return null;for(const r of t)if(typeof e=="string"){if(ire(e,r))return r}else if(ArrayBuffer.isView(e)){if(uO(e.buffer,e.byteOffset,r))return r}else if(e instanceof ArrayBuffer&&uO(e,0,r))return r;return null}function ire(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(n=>t.startsWith(n))}function uO(t,e,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some(i=>sre(t,e,r,i))}function sre(t,e,r,n){if(n instanceof ArrayBuffer)return dte(n,t,n.byteLength);switch(typeof n){case"function":return n(t);case"string":const i=aA(t,e,n.length);return n===i;default:return!1}}function oz(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?aA(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?aA(t,0,e):""}function aA(t,e,r){if(t.byteLength<e+r)return"";const n=new DataView(t);let i="";for(let a=0;a<r;a++)i+=String.fromCharCode(n.getUint8(e+a));return i}const are=256*1024;function*ore(t,e){const r=e?.chunkSize||are;let n=0;const i=new TextEncoder;for(;n<t.length;){const a=Math.min(t.length-n,r),c=t.slice(n,n+a);n+=a,yield i.encode(c)}}const lre=256*1024;function*cre(t,e={}){const{chunkSize:r=lre}=e;let n=0;for(;n<t.byteLength;){const i=Math.min(t.byteLength-n,r),a=new ArrayBuffer(i),c=new Uint8Array(t,n,i);new Uint8Array(a).set(c),n+=i,yield a}}const ure=1024*1024;async function*hre(t,e){const r=e?.chunkSize||ure;let n=0;for(;n<t.size;){const i=n+r,a=await t.slice(n,i).arrayBuffer();n=i,yield a}}function hO(t,e){return N3?fre(t,e):dre(t)}async function*fre(t,e){const r=t.getReader();let n;try{for(;;){const i=n||r.read();e?._streamReadAhead&&(n=r.read());const{done:a,value:c}=await i;if(a)return;yield YN(c)}}catch{r.releaseLock()}}async function*dre(t,e){for await(const r of t)yield YN(r)}function pre(t,e){if(typeof t=="string")return ore(t,e);if(t instanceof ArrayBuffer)return cre(t,e);if(Ug(t))return hre(t,e);if(QN(t))return hO(t,e);if(Fg(t))return hO(t.body,e);throw new Error("makeIterator")}const lz="Cannot convert supplied data type";function gre(t,e,r){if(e.text&&typeof t=="string")return t;if(Ste(t)&&(t=t.buffer),t instanceof ArrayBuffer){const n=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let n=t.buffer;const i=t.byteLength||t.length;return(t.byteOffset!==0||i!==n.byteLength)&&(n=n.slice(t.byteOffset,t.byteOffset+i)),n}throw new Error(lz)}async function mre(t,e,r){const n=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||n)return gre(t,e);if(Ug(t)&&(t=await ez(t)),Fg(t)){const i=t;return await Dte(i),e.binary?await i.arrayBuffer():await i.text()}if(QN(t)&&(t=pre(t,r)),wte(t)||Tte(t))return mte(t);throw new Error(lz)}function cz(t,e){const r=nz(),n=t||r;return typeof n.fetch=="function"?n.fetch:y0(n.fetch)?i=>sO(i,n.fetch):e?.fetch?e?.fetch:sO}function yre(t,e,r){if(r)return r;const n={fetch:cz(e,t),...t};if(n.url){const i=F3(n.url);n.baseUrl=i,n.queryString=Rte(n.url),n.filename=KN(i),n.baseUrl=bte(i)}return Array.isArray(n.loaders)||(n.loaders=null),n}function _re(t,e){if(t&&!Array.isArray(t))return t;let r;if(t&&(r=Array.isArray(t)?t:[t]),e&&e.loaders){const n=Array.isArray(e.loaders)?e.loaders:[e.loaders];r=r?[...r,...n]:n}return r&&r.length?r:void 0}async function i1(t,e,r,n){e&&!Array.isArray(e)&&!j3(e)&&(n=void 0,r=e,e=void 0),t=await t,r=r||{};const i=lw(t),c=_re(e,n),s=await Qte(t,c,r);return s?(r=Hte(r,s,c,i),n=yre({url:i,_parse:i1,loaders:c},r,n||null),await vre(s,t,r,n)):null}async function vre(t,e,r,n){if(cte(t),r=Kee(t.options,r),Fg(e)){const a=e,{ok:c,redirected:s,status:g,statusText:_,type:v,url:T}=a,M=Object.fromEntries(a.headers.entries());n.response={headers:M,ok:c,redirected:s,status:g,statusText:_,type:v,url:T}}e=await mre(e,t,r);const i=t;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,r,n);if(ute(t,r))return await hte(t,e,r,n,i1);if(i.parseText&&typeof e=="string")return await i.parseText(e,r,n);if(i.parse)return await i.parse(e,r,n);throw Ud(!i.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}async function s1(t,e,r,n){let i,a;!Array.isArray(e)&&!j3(e)?(i=[],a=e):(i=e,a=r);const c=cz(a);let s=t;return typeof t=="string"&&(s=await c(t)),Ug(t)&&(s=await c(t)),Array.isArray(i)?await i1(s,i,a):await i1(s,i,a)}const bre="4.3.3",xre=globalThis.loaders?.parseImageNode,oA=typeof Image<"u",lA=typeof ImageBitmap<"u",wre=!!xre,cA=N3?!0:wre;function Tre(t){switch(t){case"auto":return lA||oA||cA;case"imagebitmap":return lA;case"image":return oA;case"data":return cA;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function Sre(){if(lA)return"imagebitmap";if(oA)return"image";if(cA)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function Are(t){const e=Cre(t);if(!e)throw new Error("Not an image");return e}function Ere(t){switch(Are(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),r=e.getContext("2d");if(!r)throw new Error("getImageData");return e.width=t.width,e.height=t.height,r.drawImage(t,0,0),r.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function Cre(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const Pre=/^data:image\/svg\+xml/,Mre=/\.svg((\?|#).*)?$/;function $3(t){return t&&(Pre.test(t)||Mre.test(t))}function Ire(t,e){if($3(e)){let n=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(a){throw new Error(a.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return uz(t,e)}function uz(t,e){if($3(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function hz(t,e,r){const n=Ire(t,r),i=self.URL||self.webkitURL,a=typeof n!="string"&&i.createObjectURL(n);try{return await Rre(a||n,e)}finally{a&&i.revokeObjectURL(a)}}async function Rre(t,e){const r=new Image;return r.src=t,e.image&&e.image.decode&&r.decode?(await r.decode(),r):await new Promise((n,i)=>{try{r.onload=()=>n(r),r.onerror=a=>{const c=a instanceof Error?a.message:"error";i(new Error(c))}}catch(a){i(a)}})}const Ore={};let fO=!0;async function kre(t,e,r){let n;$3(r)?n=await hz(t,e,r):n=uz(t,r);const i=e&&e.imagebitmap;return await Dre(n,i)}async function Dre(t,e=null){if((Lre(e)||!fO)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(r){console.warn(r),fO=!1}return await createImageBitmap(t)}function Lre(t){for(const e in t||Ore)return!1;return!0}function Bre(t){return!Ure(t,"ftyp",4)||(t[8]&96)===0?null:Nre(t)}function Nre(t){switch(zre(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function zre(t,e,r){return String.fromCharCode(...t.slice(e,r))}function Fre(t){return[...t].map(e=>e.charCodeAt(0))}function Ure(t,e,r=0){const n=Fre(e);for(let i=0;i<n.length;++i)if(n[i]!==t[i+r])return!1;return!0}const rh=!1,Pv=!0;function fz(t){const e=_0(t);return Vre(e)||Wre(e)||$re(e)||Hre(e)||jre(e)}function jre(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),r=Bre(e);return r?{mimeType:r.mimeType,width:0,height:0}:null}function Vre(t){const e=_0(t);return e.byteLength>=24&&e.getUint32(0,rh)===2303741511?{mimeType:"image/png",width:e.getUint32(16,rh),height:e.getUint32(20,rh)}:null}function $re(t){const e=_0(t);return e.byteLength>=10&&e.getUint32(0,rh)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Pv),height:e.getUint16(8,Pv)}:null}function Hre(t){const e=_0(t);return e.byteLength>=14&&e.getUint16(0,rh)===16973&&e.getUint32(2,Pv)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Pv),height:e.getUint32(22,Pv)}:null}function Wre(t){const e=_0(t);if(!(e.byteLength>=3&&e.getUint16(0,rh)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:i}=qre();let a=2;for(;a+9<e.byteLength;){const c=e.getUint16(a,rh);if(i.has(c))return{mimeType:"image/jpeg",height:e.getUint16(a+5,rh),width:e.getUint16(a+7,rh)};if(!n.has(c))return null;a+=2,a+=e.getUint16(a,rh)}return null}function qre(){const t=new Set([65499,65476,65484,65501,65534]);for(let r=65504;r<65520;++r)t.add(r);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function _0(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function Gre(t,e){const{mimeType:r}=fz(t)||{},n=globalThis.loaders?.parseImageNode;return r1(n),await n(t,r)}async function Xre(t,e,r){e=e||{};const i=(e.image||{}).type||"auto",{url:a}=r||{},c=Zre(i);let s;switch(c){case"imagebitmap":s=await kre(t,e,a);break;case"image":s=await hz(t,e,a);break;case"data":s=await Gre(t);break;default:r1(!1)}return i==="data"&&(s=Ere(s)),s}function Zre(t){switch(t){case"auto":case"data":return Sre();default:return Tre(t),t}}const Yre=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],Kre=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],Qre={image:{type:"auto",decode:!0}},Jre={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:bre,mimeTypes:Kre,extensions:Yre,parse:Xre,tests:[t=>!!fz(new DataView(t))],options:Qre},Kr=new m0({id:"deck"});let uA={};function ene(t){uA=t}function ka(t,e,r,n){Kr.level>0&&uA[t]&&uA[t].call(null,e,r,n)}function tne(t){const e=t[0],r=t[t.length-1];return e==="{"&&r==="}"||e==="["&&r==="]"}const rne={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:tne,parseTextSync:JSON.parse};function nne(){const t="9.2.1",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(Kr.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:Kr,_registerLoggers:ene},Zte([rne,[Jre,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const ine=nne();function H3(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const PT={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function sne(t){const e={};for(const[r,n]of Object.entries(t))e[r]=ane(n);return e}function ane(t){let e=dO(t);if(e!=="object")return{value:t,...PT[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...PT[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=dO(t.value),{...t,...PT[e],type:e}):{type:"object",value:null};throw new Error("props")}function dO(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const one=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,lne=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,cne={vertex:one,fragment:lne},pO=/void\s+main\s*\([^)]*\)\s*\{\n?/,gO=/}\n?[^{}]*$/,MT=[],ox="__LUMA_INJECT_DECLARATIONS__";function une(t){const e={vertex:{},fragment:{}};for(const r in t){let n=t[r];const i=hne(r);typeof n=="string"&&(n={order:0,injection:n}),e[i][r]=n}return e}function hne(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function a1(t,e,r,n=!1){const i=e==="vertex";for(const a in r){const c=r[a];c.sort((g,_)=>g.order-_.order),MT.length=c.length;for(let g=0,_=c.length;g<_;++g)MT[g]=c[g].injection;const s=`${MT.join(`
`)}
`;switch(a){case"vs:#decl":i&&(t=t.replace(ox,s));break;case"vs:#main-start":i&&(t=t.replace(pO,g=>g+s));break;case"vs:#main-end":i&&(t=t.replace(gO,g=>s+g));break;case"fs:#decl":i||(t=t.replace(ox,s));break;case"fs:#main-start":i||(t=t.replace(pO,g=>g+s));break;case"fs:#main-end":i||(t=t.replace(gO,g=>s+g));break;default:t=t.replace(a,g=>g+s)}}return t=t.replace(ox,""),n&&(t=t.replace(/\}\s*$/,a=>a+cne[e])),t}function o1(t){t.map(e=>fne(e))}function fne(t){if(t.instance)return;o1(t.dependencies||[]);const{propTypes:e={},deprecations:r=[],inject:n={}}=t,i={normalizedInjections:une(n),parsedDeprecations:dne(r)};e&&(i.propValidators=sne(e)),t.instance=i;let a={};e&&(a=Object.entries(e).reduce((c,[s,g])=>{const _=g?.value;return _&&(c[s]=_),c},{})),t.defaultUniforms={...t.defaultUniforms,...a}}function dz(t,e,r){t.deprecations?.forEach(n=>{n.regex?.test(e)&&(n.deprecated?r.deprecated(n.old,n.new)():r.removed(n.old,n.new)())})}function dne(t){return t.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),t}function W3(t){o1(t);const e={},r={};pz({modules:t,level:0,moduleMap:e,moduleDepth:r});const n=Object.keys(r).sort((i,a)=>r[a]-r[i]).map(i=>e[i]);return o1(n),n}function pz(t){const{modules:e,level:r,moduleMap:n,moduleDepth:i}=t;if(r>=5)throw new Error("Possible loop in shader dependency graph");for(const a of e)n[a.name]=a,(i[a.name]===void 0||i[a.name]<r)&&(i[a.name]=r);for(const a of e)a.dependencies&&pz({modules:a.dependencies,level:r+1,moduleMap:n,moduleDepth:i})}function pne(t){switch(t?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function gne(t,e){if(Number(t.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=mO(t,mne),t;case"fragment":return t=mO(t,yne),t;default:throw new Error(e)}}const gz=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],mne=[...gz,[hA("attribute"),"in $1"],[hA("varying"),"out $1"]],yne=[...gz,[hA("varying"),"in $1"]];function mO(t,e){for(const[r,n]of e)t=t.replace(r,n);return t}function hA(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function mz(t,e){let r="";for(const n in t){const i=t[n];if(r+=`void ${i.signature} {
`,i.header&&(r+=`  ${i.header}`),e[n]){const a=e[n];a.sort((c,s)=>c.order-s.order);for(const c of a)r+=`  ${c.injection}
`}i.footer&&(r+=`  ${i.footer}`),r+=`}
`}return r}function yz(t){const e={vertex:{},fragment:{}};for(const r of t){let n,i;typeof r!="string"?(n=r,i=n.hook):(n={},i=r),i=i.trim();const[a,c]=i.split(":"),s=i.replace(/\(.+/,""),g=Object.assign(n,{signature:c});switch(a){case"vs":e.vertex[s]=g;break;case"fs":e.fragment[s]=g;break;default:throw new Error(a)}}return e}function _ne(t,e){return{name:vne(t,e),language:"glsl",version:bne(t)}}function vne(t,e="unnamed"){const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return n?n[1]:e}function bne(t){let e=100;const r=t.match(/[^\s]+/g);if(r&&r.length>=2&&r[0]==="#version"){const n=parseInt(r[1],10);Number.isFinite(n)&&(e=n)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const _z=`

${ox}
`,xne=`precision highp float;
`;function wne(t){const e=W3(t.modules||[]);return{source:Sne(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:vz(e)}}function Tne(t){const{vs:e,fs:r}=t,n=W3(t.modules||[]);return{vs:yO(t.platformInfo,{...t,source:e,stage:"vertex",modules:n}),fs:yO(t.platformInfo,{...t,source:r,stage:"fragment",modules:n}),getUniforms:vz(n)}}function Sne(t,e){const{source:r,stage:n,modules:i,hookFunctions:a=[],inject:c={},log:s}=e;H3(typeof r=="string","shader source must be a string");const g=r;let _="";const v=yz(a),T={},M={},O={};for(const j in c){const V=typeof c[j]=="string"?{injection:c[j],order:0}:c[j],q=/^(v|f)s:(#)?([\w-]+)$/.exec(j);if(q){const Y=q[2],X=q[3];Y?X==="decl"?M[j]=[V]:O[j]=[V]:T[j]=[V]}else O[j]=[V]}const F=i;for(const j of F){s&&dz(j,g,s);const V=bz(j,"wgsl");_+=V;const q=j.injections?.[n]||{};for(const Y in q){const X=/^(v|f)s:#([\w-]+)$/.exec(Y);if(X){const ue=X[2]==="decl"?M:O;ue[Y]=ue[Y]||[],ue[Y].push(q[Y])}else T[Y]=T[Y]||[],T[Y].push(q[Y])}}return _+=_z,_=a1(_,n,M),_+=mz(v[n],T),_+=g,_=a1(_,n,O),_}function yO(t,e){const{source:r,stage:n,language:i="glsl",modules:a,defines:c={},hookFunctions:s=[],inject:g={},prologue:_=!0,log:v}=e;H3(typeof r=="string","shader source must be a string");const T=i==="glsl"?_ne(r).version:-1,M=t.shaderLanguageVersion,O=T===100?"#version 100":"#version 300 es",j=r.split(`
`).slice(1).join(`
`),V={};a.forEach(ge=>{Object.assign(V,ge.defines)}),Object.assign(V,c);let q="";switch(i){case"wgsl":break;case"glsl":q=_?`${O}

// ----- PROLOGUE -------------------------
${`#define SHADER_TYPE_${n.toUpperCase()}`}

${pne(t)}
${n==="fragment"?xne:""}

// ----- APPLICATION DEFINES -------------------------

${Ane(V)}

`:`${O}
`;break}const Y=yz(s),X={},ae={},ue={};for(const ge in g){const Le=typeof g[ge]=="string"?{injection:g[ge],order:0}:g[ge],qe=/^(v|f)s:(#)?([\w-]+)$/.exec(ge);if(qe){const Ze=qe[2],_t=qe[3];Ze?_t==="decl"?ae[ge]=[Le]:ue[ge]=[Le]:X[ge]=[Le]}else ue[ge]=[Le]}for(const ge of a){v&&dz(ge,j,v);const Le=bz(ge,n);q+=Le;const qe=ge.instance?.normalizedInjections[n]||{};for(const Ze in qe){const _t=/^(v|f)s:#([\w-]+)$/.exec(Ze);if(_t){const gt=_t[2]==="decl"?ae:ue;gt[Ze]=gt[Ze]||[],gt[Ze].push(qe[Ze])}else X[Ze]=X[Ze]||[],X[Ze].push(qe[Ze])}}return q+="// ----- MAIN SHADER SOURCE -------------------------",q+=_z,q=a1(q,n,ae),q+=mz(Y[n],X),q+=j,q=a1(q,n,ue),i==="glsl"&&T!==M&&(q=gne(q,n)),q.trim()}function vz(t){return function(r){const n={};for(const i of t){const a=i.getUniforms?.(r,n);Object.assign(n,a)}return n}}function Ane(t={}){let e="";for(const r in t){const n=t[r];(n||Number.isFinite(n))&&(e+=`#define ${r.toUpperCase()} ${t[r]}
`)}return e}function bz(t,e){let r;switch(e){case"vertex":r=t.vs||"";break;case"fragment":r=t.fs||"";break;case"wgsl":r=t.source||"";break;default:H3(!1)}if(!t.name)throw new Error("Shader module must have a name");const n=t.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let i=`// ----- MODULE ${t.name} ---------------

`;return e!=="wgsl"&&(i+=`#define MODULE_${n}
`),i+=`${r}
`,i}const Ene=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,Cne=/^\s*\#\s*endif\s*$/;function Pne(t,e){const r=t.split(`
`),n=[];let i=!0,a=null;for(const c of r){const s=c.match(Ene),g=c.match(Cne);s?(a=s[1],i=!!e?.defines?.[a]):g?i=!0:i&&n.push(c)}return n.join(`
`)}class ug{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return ug.defaultShaderAssembler=ug.defaultShaderAssembler||new ug,ug.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(r=>r.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const r=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==r)}addShaderHook(e,r){r&&(e=Object.assign(r,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const r=this._getModuleList(e.modules),n=this._hookFunctions,{source:i,getUniforms:a}=wne({...e,source:e.source,modules:r,hookFunctions:n});return{source:e.platformInfo.shaderLanguage==="wgsl"?Pne(i):i,getUniforms:a,modules:r}}assembleGLSLShaderPair(e){const r=this._getModuleList(e.modules),n=this._hookFunctions;return{...Tne({...e,vs:e.vs,fs:e.fs,modules:r,hookFunctions:n}),modules:r}}_getModuleList(e=[]){const r=new Array(this._defaultModules.length+e.length),n={};let i=0;for(let a=0,c=this._defaultModules.length;a<c;++a){const s=this._defaultModules[a],g=s.name;r[i++]=s,n[g]=!0}for(let a=0,c=e.length;a<c;++a){const s=e[a],g=s.name;n[g]||(r[i++]=s,n[g]=!0)}return r.length=i,o1(r),r}}const Mne=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,Ine=`#version 300 es
${Mne}`;function Rne(t){const{input:e,inputChannels:r,output:n}={};if(!e)return Ine;if(!r)throw new Error("inputChannels");const i=One(r),a=kne(e,r);return`#version 300 es
in ${i} ${e};
out vec4 ${n};
void main() {
  ${n} = ${a};
}`}function One(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function kne(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}class Dne{stats=new Map;getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new ow({id:e})),this.stats.get(e)}}const xz=new Dne,Dt=new m0({id:"luma.gl"}),IT={};function cw(t="id"){IT[t]=IT[t]||1;const e=IT[t]++;return`${t}-${e}`}let Vn=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(e,r,n){if(!e)throw new Error("no device");this._device=e,this.props=Lne(r,n);const i=this.props.id!=="undefined"?this.props.id:cw(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),r=this[Symbol.toStringTag];e.get(`${r}s Active`).decrementCount()}trackAllocatedMemory(e,r=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(e),n.get(`${r} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").subtractCount(this.allocatedBytes),r.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),r=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${r}s Created`).incrementCount(),e.get(`${r}s Active`).incrementCount()}};function Lne(t,e){const r={...e};for(const n in t)t[n]!==void 0&&(r[n]=t[n]);return r}let Ni=class lx extends Vn{static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(e,r){const n={...r};(r.usage||0)&lx.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?n.indexType="uint32":r.data instanceof Uint16Array&&(n.indexType="uint16")),delete n.data,super(e,n,lx.defaultProps),this.usage=n.usage||0,this.indexType=n.indexType,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createBuffer({...this.props,...e})}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(e,r,n){const i=ArrayBuffer.isView(e)?e.buffer:e,a=Math.min(e?e.byteLength:n,lx.DEBUG_DATA_MAX_LENGTH);i===null?this.debugData=new ArrayBuffer(a):r===0&&n===i.byteLength?this.debugData=i.slice(0,a):this.debugData=i.slice(r,r+a)}static defaultProps={...Vn.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",onMapped:void 0}};function wz(t){const[e,r,n]=X3[t],i=t.includes("norm"),a=!i&&!t.startsWith("float"),c=t.startsWith("s");return{signedType:e,primitiveType:r,byteLength:n,normalized:i,integer:a,signed:c}}function Bne(t){const e=t;switch(e){case"uint8":return"unorm8";case"sint8":return"snorm8";case"uint16":return"unorm16";case"sint16":return"snorm16";default:return e}}function Nne(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}function q3(t){const e=ArrayBuffer.isView(t)?t.constructor:t;if(e===Uint8ClampedArray)return"uint8";const r=Object.values(X3).find(n=>e===n[4]);if(!r)throw new Error(e.name);return r[0]}function G3(t){const[,,,,e]=X3[t];return e}const X3={uint8:["uint8","u32",1,!1,Uint8Array],sint8:["sint8","i32",1,!1,Int8Array],unorm8:["uint8","f32",1,!0,Uint8Array],snorm8:["sint8","f32",1,!0,Int8Array],uint16:["uint16","u32",2,!1,Uint16Array],sint16:["sint16","i32",2,!1,Int16Array],unorm16:["uint16","u32",2,!0,Uint16Array],snorm16:["sint16","i32",2,!0,Int16Array],float16:["float16","f16",2,!1,Uint16Array],float32:["float32","f32",4,!1,Float32Array],uint32:["uint32","u32",4,!1,Uint32Array],sint32:["sint32","i32",4,!1,Int32Array]};function Z3(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[r,n]=t.split("x"),i=r,a=n?parseInt(n):1,c=wz(i),s={type:i,components:a,byteLength:c.byteLength*a,integer:c.integer,signed:c.signed,normalized:c.normalized};return e&&(s.webglOnly=!0),s}function zne(t,e,r){const n=r?Bne(t):t;switch(n){case"unorm8":return e===1?"unorm8":e===3?"unorm8x3-webgl":`${n}x${e}`;case"snorm8":case"uint8":case"sint8":case"uint16":case"sint16":case"unorm16":case"snorm16":case"float16":if(e===1||e===3)throw new Error(`size: ${e}`);return`${n}x${e}`;default:return e===1?n:`${n}x${e}`}}function Fne(t,e,r){if(!e||e>4)throw new Error(`size ${e}`);const n=e,i=q3(t);return zne(i,n,r)}function Une(t){let e;switch(t.primitiveType){case"f32":e="float32";break;case"i32":e="sint32";break;case"u32":e="uint32";break;case"f16":return t.components<=2?"float16x2":"float16x4"}return t.components===1?e:`${e}x${t.components}`}const Ma="texture-compression-bc",Un="texture-compression-astc",Ku="texture-compression-etc2",jne="texture-compression-etc1-webgl",zb="texture-compression-pvrtc-webgl",RT="texture-compression-atc-webgl",Fb="float32-renderable-webgl",OT="float16-renderable-webgl",Vne="rgb9e5ufloat-renderable-webgl",kT="snorm8-renderable-webgl",ov="norm16-renderable-webgl",DT="snorm16-renderable-webgl",Ub="float32-filterable",_O="float16-filterable-webgl";function Tz(t){const e=Wne[t];if(!e)throw new Error(`Unsupported texture format ${t}`);return e}const $ne={r8unorm:{},rg8unorm:{},"rgb8unorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},r8snorm:{render:kT},rg8snorm:{render:kT},"rgb8snorm-webgl":{},rgba8snorm:{render:kT},r8uint:{},rg8uint:{},rgba8uint:{},r8sint:{},rg8sint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},r16unorm:{f:ov},rg16unorm:{render:ov},"rgb16unorm-webgl":{f:ov},rgba16unorm:{render:ov},r16snorm:{f:DT},rg16snorm:{render:DT},"rgb16snorm-webgl":{f:ov},rgba16snorm:{render:DT},r16uint:{},rg16uint:{},rgba16uint:{},r16sint:{},rg16sint:{},rgba16sint:{},r16float:{render:OT,filter:"float16-filterable-webgl"},rg16float:{render:OT,filter:_O},rgba16float:{render:OT,filter:_O},r32uint:{},rg32uint:{},rgba32uint:{},r32sint:{},rg32sint:{},rgba32sint:{},r32float:{render:Fb,filter:Ub},rg32float:{render:!1,filter:Ub},"rgb32float-webgl":{render:Fb,filter:Ub},rgba32float:{render:Fb,filter:Ub},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},rgb9e5ufloat:{channels:"rgb",packed:!0,render:Vne},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:Fb},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},rgb10a2uint:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0}},Hne={"bc1-rgb-unorm-webgl":{f:Ma},"bc1-rgb-unorm-srgb-webgl":{f:Ma},"bc1-rgba-unorm":{f:Ma},"bc1-rgba-unorm-srgb":{f:Ma},"bc2-rgba-unorm":{f:Ma},"bc2-rgba-unorm-srgb":{f:Ma},"bc3-rgba-unorm":{f:Ma},"bc3-rgba-unorm-srgb":{f:Ma},"bc4-r-unorm":{f:Ma},"bc4-r-snorm":{f:Ma},"bc5-rg-unorm":{f:Ma},"bc5-rg-snorm":{f:Ma},"bc6h-rgb-ufloat":{f:Ma},"bc6h-rgb-float":{f:Ma},"bc7-rgba-unorm":{f:Ma},"bc7-rgba-unorm-srgb":{f:Ma},"etc2-rgb8unorm":{f:Ku},"etc2-rgb8unorm-srgb":{f:Ku},"etc2-rgb8a1unorm":{f:Ku},"etc2-rgb8a1unorm-srgb":{f:Ku},"etc2-rgba8unorm":{f:Ku},"etc2-rgba8unorm-srgb":{f:Ku},"eac-r11unorm":{f:Ku},"eac-r11snorm":{f:Ku},"eac-rg11unorm":{f:Ku},"eac-rg11snorm":{f:Ku},"astc-4x4-unorm":{f:Un},"astc-4x4-unorm-srgb":{f:Un},"astc-5x4-unorm":{f:Un},"astc-5x4-unorm-srgb":{f:Un},"astc-5x5-unorm":{f:Un},"astc-5x5-unorm-srgb":{f:Un},"astc-6x5-unorm":{f:Un},"astc-6x5-unorm-srgb":{f:Un},"astc-6x6-unorm":{f:Un},"astc-6x6-unorm-srgb":{f:Un},"astc-8x5-unorm":{f:Un},"astc-8x5-unorm-srgb":{f:Un},"astc-8x6-unorm":{f:Un},"astc-8x6-unorm-srgb":{f:Un},"astc-8x8-unorm":{f:Un},"astc-8x8-unorm-srgb":{f:Un},"astc-10x5-unorm":{f:Un},"astc-10x5-unorm-srgb":{f:Un},"astc-10x6-unorm":{f:Un},"astc-10x6-unorm-srgb":{f:Un},"astc-10x8-unorm":{f:Un},"astc-10x8-unorm-srgb":{f:Un},"astc-10x10-unorm":{f:Un},"astc-10x10-unorm-srgb":{f:Un},"astc-12x10-unorm":{f:Un},"astc-12x10-unorm-srgb":{f:Un},"astc-12x12-unorm":{f:Un},"astc-12x12-unorm-srgb":{f:Un},"pvrtc-rgb4unorm-webgl":{f:zb},"pvrtc-rgba4unorm-webgl":{f:zb},"pvrtc-rbg2unorm-webgl":{f:zb},"pvrtc-rgba2unorm-webgl":{f:zb},"etc1-rbg-unorm-webgl":{f:jne},"atc-rgb-unorm-webgl":{f:RT},"atc-rgba-unorm-webgl":{f:RT},"atc-rgbai-unorm-webgl":{f:RT}},Wne={...$ne,...Hne},qne=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],Gne=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;class Xne{getInfo(e){return vO(e)}isColor(e){return e.startsWith("rgba")||e.startsWith("bgra")||e.startsWith("rgb")}isDepthStencil(e){return e.startsWith("depth")||e.startsWith("stencil")}isCompressed(e){return qne.some(r=>e.startsWith(r))}getCapabilities(e){const r=Tz(e),n={format:e,create:r.f??!0,render:r.render??!0,filter:r.filter??!0,blend:r.blend??!0,store:r.store??!0},i=vO(e),a=e.startsWith("depth")||e.startsWith("stencil"),c=i?.signed,s=i?.integer,g=i?.webgl;return n.render&&=!c,n.filter&&=!a&&!c&&!s&&!g,n}}const cy=new Xne;function vO(t){let e=Zne(t);if(cy.isCompressed(t)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const n=Yne(t);n&&(e.blockWidth=n.blockWidth,e.blockHeight=n.blockHeight)}const r=Gne.exec(t);if(r){const[,n,i,a,c,s]=r,g=`${a}${i}`,_=wz(g),v=_.byteLength*8,T=n.length,M=[v,T>=2?v:0,T>=3?v:0,T>=4?v:0];e={format:t,attachment:e.attachment,dataType:_.signedType,components:T,channels:n,integer:_.integer,signed:_.signed,normalized:_.normalized,bitsPerChannel:M,bytesPerPixel:_.byteLength*n.length,packed:e.packed,srgb:e.srgb},s==="-webgl"&&(e.webgl=!0),c==="-srgb"&&(e.srgb=!0)}return t.endsWith("-webgl")&&(e.webgl=!0),t.endsWith("-srgb")&&(e.srgb=!0),e}function Zne(t){const e=Tz(t),r=e.bytesPerPixel||1,n=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:t,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||e.channels?.length||1,bytesPerPixel:r,bitsPerChannel:n,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function Yne(t){const r=/.*-(\d+)x(\d+)-.*/.exec(t);if(r){const[,n,i]=r;return{blockWidth:Number(n),blockHeight:Number(i)}}return null}function Kne(t){return typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement||typeof VideoFrame<"u"&&t instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas}function Qne(t){if(typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height};if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)return{width:t.naturalWidth,height:t.naturalHeight};if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)return{width:t.videoWidth,height:t.videoHeight};if(typeof VideoFrame<"u"&&t instanceof VideoFrame)return{width:t.displayWidth,height:t.displayHeight};throw new Error("Unknown image type")}class Jne{}class eie{features;disabledFeatures;constructor(e=[],r){this.features=new Set(e),this.disabledFeatures=r||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures?.[e]&&this.features.has(e)}}class Cg{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,webgl:{},onError:(e,r)=>{},onResize:(e,r)=>{const[n,i]=e.getDevicePixelSize();Dt.log(1,`${e} resized => ${n}x${i}px`)()},onPositionChange:(e,r)=>{const[n,i]=e.getPosition();Dt.log(1,`${e} repositioned => ${n},${i}`)()},onVisibilityChange:e=>Dt.log(1,`${e} Visibility changed ${e.isVisible}`)(),onDevicePixelRatioChange:(e,r)=>Dt.log(1,`${e} DPR changed ${r.oldRatio} => ${e.devicePixelRatio}`)(),debug:Dt.get("debug")||void 0,debugShaders:Dt.get("debug-shaders")||void 0,debugFramebuffers:!!Dt.get("debug-framebuffers"),debugFactories:!!Dt.get("debug-factories"),debugWebGL:!!Dt.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_reuseDevices:!1,_requestMaxLimits:!0,_cacheShaders:!1,_cachePipelines:!1,_cacheDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_handle:void 0};get[Symbol.toStringTag](){return"Device"}toString(){return`Device(${this.id})`}id;props;userData={};statsManager=xz;timestamp=0;_reused=!1;_lumaData={};_textureCaps={};constructor(e){this.props={...Cg.defaultProps,...e},this.id=this.props.id||cw(this[Symbol.toStringTag].toLowerCase())}getVertexFormatInfo(e){return Z3(e)}isVertexFormatSupported(e){return!0}getTextureFormatInfo(e){return cy.getInfo(e)}getTextureFormatCapabilities(e){let r=this._textureCaps[e];if(!r){const n=this._getDeviceTextureFormatCapabilities(e);r=this._getDeviceSpecificTextureFormatCapabilities(n),this._textureCaps[e]=r}return r}getMipLevelCount(e,r,n=1){const i=Math.max(e,r,n);return 1+Math.floor(Math.log2(i))}isExternalImage(e){return Kne(e)}getExternalImageSize(e){return Qne(e)}isTextureFormatSupported(e){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return cy.isCompressed(e)}pushDebugGroup(e){this.commandEncoder.pushDebugGroup(e)}popDebugGroup(){this.commandEncoder?.popDebugGroup()}insertDebugMarker(e){this.commandEncoder?.insertDebugMarker(e)}loseDevice(){return!1}incrementTimestamp(){return this.timestamp++}reportError(e,r,...n){return this.props.onError(e,r)?()=>{}:Dt.error(e.message,r,...n)}debug(){if(this.props.debug)debugger;else Dt.once(0,`'Type luma.log.set({debug: true}) in console to enable debug breakpoints',
or create a device with the 'debug: true' prop.`)()}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}beginRenderPass(e){return this.commandEncoder.beginRenderPass(e)}beginComputePass(e){return this.commandEncoder.beginComputePass(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,r){throw new Error("not implemented")}readPixelsToBufferWebGL(e,r){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,r){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_getDeviceTextureFormatCapabilities(e){const r=cy.getCapabilities(e),n=a=>(typeof a=="string"?this.features.has(a):a)??!0,i=n(r.create);return{format:e,create:i,render:i&&n(r.render),filter:i&&n(r.filter),blend:i&&n(r.blend),store:i&&n(r.store)}}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const r={...e};if((e.usage||0)&Ni.INDEX&&(e.indexType||(e.data instanceof Uint32Array?r.indexType="uint32":e.data instanceof Uint16Array&&(r.indexType="uint16")),!r.indexType))throw new Error("indices buffer content must be of type uint16 or uint32");return r}}const tie="set luma.log.level=1 (or higher) to trace rendering",bO="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.";class l1{static defaultProps={...Cg.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};stats=xz;log=Dt;VERSION="9.2.2";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw Dt.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),Dt.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");Dt.error("This version of luma.gl has already been initialized")()}Dt.log(1,`${this.VERSION} - ${tie}`)(),globalThis.luma=this}async createDevice(e={}){const r={...l1.defaultProps,...e},n=this.selectAdapter(r.type,r.adapters);if(!n)throw new Error(bO);return r.waitForPageLoad&&await n.pageLoaded,await n.create(r)}async attachDevice(e,r){const n=this._getTypeFromHandle(e,r.adapters),i=n&&this.selectAdapter(n,r.adapters);if(!i)throw new Error(bO);return await i?.attach?.(e,r)}registerAdapters(e){for(const r of e)this.preregisteredAdapters.set(r.type,r)}getSupportedAdapters(e=[]){const r=this._getAdapterMap(e);return Array.from(r).map(([,n])=>n).filter(n=>n.isSupported?.()).map(n=>n.type)}getBestAvailableAdapterType(e=[]){const r=["webgpu","webgl","null"],n=this._getAdapterMap(e);for(const i of r)if(n.get(i)?.isSupported?.())return i;return null}selectAdapter(e,r=[]){let n=e;e==="best-available"&&(n=this.getBestAvailableAdapterType(r));const i=this._getAdapterMap(r);return n&&i.get(n)||null}enforceWebGL2(e=!0,r=[]){const i=this._getAdapterMap(r).get("webgl");i||Dt.warn("enforceWebGL2: webgl adapter not found")(),i?.enforceWebGL2?.(e)}setDefaultDeviceProps(e){Object.assign(l1.defaultProps,e)}_getAdapterMap(e=[]){const r=new Map(this.preregisteredAdapters);for(const n of e)r.set(n.type,n);return r}_getTypeFromHandle(e,r=[]){return e instanceof WebGL2RenderingContext?"webgl":typeof GPUDevice<"u"&&e instanceof GPUDevice||e?.queue?"webgpu":e===null?"null":(e instanceof WebGLRenderingContext?Dt.warn("WebGL1 is not supported",e)():Dt.warn("Unknown handle type",e)(),null)}}const fA=new l1;class rie{get pageLoaded(){return sie()}}const nie=zg()&&typeof document<"u",iie=()=>nie&&document.readyState==="complete";let jb=null;function sie(){return jb||(iie()||typeof window>"u"?jb=Promise.resolve():jb=new Promise(t=>window.addEventListener("load",()=>t()))),jb}function aie(){let t,e;return{promise:new Promise((n,i)=>{t=n,e=i}),resolve:t,reject:e}}class hg{static isHTMLCanvas(e){return typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement}static isOffscreenCanvas(e){return typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas}static defaultProps={id:void 0,canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb",trackPosition:!1};id;props;canvas;htmlCanvas;offscreenCanvas;type;initialized;isInitialized=!1;isVisible=!0;cssWidth;cssHeight;devicePixelRatio;devicePixelWidth;devicePixelHeight;drawingBufferWidth;drawingBufferHeight;_initializedResolvers=aie();_resizeObserver;_intersectionObserver;_position;destroyed=!1;toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(e){if(this.props={...hg.defaultProps,...e},e=this.props,this.initialized=this._initializedResolvers.promise,zg()?e.canvas?typeof e.canvas=="string"?this.canvas=lie(e.canvas):this.canvas=e.canvas:this.canvas=cie(e):this.canvas={width:e.width||1,height:e.height||1},hg.isHTMLCanvas(this.canvas)?(this.id=e.id||this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):hg.isOffscreenCanvas(this.canvas)?(this.id=e.id||"offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas):(this.id=e.id||"node-canvas-context",this.type="node"),this.cssWidth=this.htmlCanvas?.clientWidth||this.canvas.width,this.cssHeight=this.htmlCanvas?.clientHeight||this.canvas.height,this.devicePixelWidth=this.canvas.width,this.devicePixelHeight=this.canvas.height,this.drawingBufferWidth=this.canvas.width,this.drawingBufferHeight=this.canvas.height,this.devicePixelRatio=globalThis.devicePixelRatio||1,this._position=[0,0],hg.isHTMLCanvas(this.canvas)){this._intersectionObserver=new IntersectionObserver(r=>this._handleIntersection(r)),this._intersectionObserver.observe(this.canvas),this._resizeObserver=new ResizeObserver(r=>this._handleResize(r));try{this._resizeObserver.observe(this.canvas,{box:"device-pixel-content-box"})}catch{this._resizeObserver.observe(this.canvas,{box:"content-box"})}setTimeout(()=>this._observeDevicePixelRatio(),0),this.props.trackPosition&&this._trackPosition()}}destroy(){this.destroyed=!0}setProps(e){return"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1,this._updateDrawingBufferSize()),this}getCSSSize(){return[this.cssWidth,this.cssHeight]}getPosition(){return this._position}getDevicePixelSize(){return[this.devicePixelWidth,this.devicePixelHeight]}getDrawingBufferSize(){return[this.drawingBufferWidth,this.drawingBufferHeight]}getMaxDrawingBufferSize(){const e=this.device.limits.maxTextureDimension2D;return[e,e]}setDrawingBufferSize(e,r){this.canvas.width=e,this.canvas.height=r,this.drawingBufferWidth=e,this.drawingBufferHeight=r}getDevicePixelRatio(){return typeof window<"u"&&window.devicePixelRatio||1}cssToDevicePixels(e,r=!0){const n=this.cssToDeviceRatio(),[i,a]=this.getDrawingBufferSize();return uie(e,n,i,a,r)}getPixelSize(){return this.getDevicePixelSize()}getAspect(){const[e,r]=this.getDevicePixelSize();return e/r}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),[r]=this.getCSSSize();return r?e/r:1}catch{return 1}}resize(e){this.setDrawingBufferSize(e.width,e.height)}_setAutoCreatedCanvasId(e){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}_handleIntersection(e){const r=e.find(i=>i.target===this.canvas);if(!r)return;const n=r.isIntersecting;this.isVisible!==n&&(this.isVisible=n,this.device.props.onVisibilityChange(this))}_handleResize(e){const r=e.find(g=>g.target===this.canvas);if(!r)return;this.cssWidth=r.contentBoxSize[0].inlineSize,this.cssHeight=r.contentBoxSize[0].blockSize;const n=this.getDevicePixelSize(),i=r.devicePixelContentBoxSize?.[0].inlineSize||r.contentBoxSize[0].inlineSize*devicePixelRatio,a=r.devicePixelContentBoxSize?.[0].blockSize||r.contentBoxSize[0].blockSize*devicePixelRatio,[c,s]=this.getMaxDrawingBufferSize();this.devicePixelWidth=Math.max(1,Math.min(i,c)),this.devicePixelHeight=Math.max(1,Math.min(a,s)),this._updateDrawingBufferSize(),this.device.props.onResize(this,{oldPixelSize:n})}_updateDrawingBufferSize(){if(this.props.autoResize){if(typeof this.props.useDevicePixels=="number"){const e=this.props.useDevicePixels;this.setDrawingBufferSize(this.cssWidth*e,this.cssHeight*e)}else this.props.useDevicePixels?this.setDrawingBufferSize(this.devicePixelWidth,this.devicePixelHeight):this.setDrawingBufferSize(this.cssWidth,this.cssHeight);this._updateDevice()}this._initializedResolvers.resolve(),this.isInitialized=!0,this.updatePosition()}_observeDevicePixelRatio(){const e=this.devicePixelRatio;this.devicePixelRatio=window.devicePixelRatio,this.updatePosition(),this.device.props.onDevicePixelRatioChange(this,{oldRatio:e}),matchMedia(`(resolution: ${this.devicePixelRatio}dppx)`).addEventListener("change",()=>this._observeDevicePixelRatio(),{once:!0})}_trackPosition(e=100){const r=setInterval(()=>{this.destroyed?clearInterval(r):this.updatePosition()},e)}updatePosition(){const e=this.htmlCanvas?.getBoundingClientRect();if(e){const r=[e.left,e.top];if(this._position??=r,r[0]!==this._position[0]||r[1]!==this._position[1]){const i=this._position;this._position=r,this.device.props.onPositionChange?.(this,{oldPosition:i})}}}}function oie(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e)throw new Error(`${t} is not an HTML element`);return e}return t||document.body}function lie(t){const e=document.getElementById(t);if(!hg.isHTMLCanvas(e))throw new Error("Object is not a canvas element");return e}function cie(t){const{width:e,height:r}=t,n=document.createElement("canvas");n.id=cw("lumagl-auto-created-canvas"),n.width=e||1,n.height=r||1,n.style.width=Number.isFinite(e)?`${e}px`:"100%",n.style.height=Number.isFinite(r)?`${r}px`:"100%",t?.visible||(n.style.visibility="hidden");const i=oie(t?.container||null);return i.insertBefore(n,i.firstChild),n}function uie(t,e,r,n,i){const a=t,c=xO(a[0],e,r);let s=wO(a[1],e,n,i),g=xO(a[0]+1,e,r);const _=g===r-1?g:g-1;g=wO(a[1]+1,e,n,i);let v;return i?(g=g===0?g:g+1,v=s,s=g):v=g===n-1?g:g-1,{x:c,y:s,width:Math.max(_-c+1,1),height:Math.max(v-s+1,1)}}function xO(t,e,r){return Math.min(Math.round(t*e),r-1)}function wO(t,e,r,n){return n?Math.max(0,r-1-Math.round(t*e)):Math.min(Math.round(t*e),r-1)}class Pg extends Vn{static defaultProps={...Vn.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(e,r){r=Pg.normalizeProps(e,r),super(e,r,Pg.defaultProps)}static normalizeProps(e,r){return r}}const hie={"1d":"1d","2d":"2d","2d-array":"2d",cube:"2d","cube-array":"2d","3d":"3d"};class Ps extends Vn{static SAMPLE=4;static STORAGE=8;static RENDER=16;static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static RENDER_ATTACHMENT=16;dimension;baseDimension;format;width;height;depth;mipLevels;updateTimestamp;get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}constructor(e,r){if(r=Ps.normalizeProps(e,r),super(e,r,Ps.defaultProps),this.dimension=this.props.dimension,this.baseDimension=hie[this.dimension],this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.mipLevels=this.props.mipLevels,this.props.width===void 0||this.props.height===void 0)if(e.isExternalImage(r.data)){const n=e.getExternalImageSize(r.data);this.width=n?.width||1,this.height=n?.height||1}else this.width=1,this.height=1,(this.props.width===void 0||this.props.height===void 0)&&Dt.warn(`${this} created with undefined width or height. This is deprecated. Use AsyncTexture instead.`)();this.updateTimestamp=e.incrementTimestamp()}setSampler(e){this.sampler=e instanceof Pg?e:this.device.createSampler(e)}clone(e){return this.device.createTexture({...this.props,...e})}static normalizeProps(e,r){const n={...r},{width:i,height:a}=n;return typeof i=="number"&&(n.width=Math.max(1,Math.ceil(i))),typeof a=="number"&&(n.height=Math.max(1,Math.ceil(a))),n}_initializeData(e){this.device.isExternalImage(e)?this.copyExternalImage({image:e,width:this.width,height:this.height,depth:this.depth,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}):e&&this.copyImageData({data:e,mipLevel:0,x:0,y:0,z:0,aspect:"all"})}_normalizeCopyImageDataOptions(e){const{width:r,height:n,depth:i}=this,a={...Ps.defaultCopyDataOptions,width:r,height:n,depth:i,...e},c=this.device.getTextureFormatInfo(this.format);if(!e.bytesPerRow&&!c.bytesPerPixel)throw new Error(`bytesPerRow must be provided for texture format ${this.format}`);return a.bytesPerRow=e.bytesPerRow||r*(c.bytesPerPixel||4),a.rowsPerImage=e.rowsPerImage||n,a}_normalizeCopyExternalImageOptions(e){const r=this.device.getExternalImageSize(e.image),n={...Ps.defaultCopyExternalImageOptions,...r,...e};return n.width=Math.min(n.width,this.width-n.x),n.height=Math.min(n.height,this.height-n.y),n}static defaultProps={...Vn.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",usage:Ps.TEXTURE|Ps.RENDER_ATTACHMENT|Ps.COPY_DST,width:void 0,height:void 0,depth:1,mipLevels:1,samples:void 0,sampler:{},view:void 0};static defaultCopyDataOptions={data:void 0,byteOffset:0,bytesPerRow:void 0,rowsPerImage:void 0,mipLevel:0,x:0,y:0,z:0,aspect:"all"};static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}}class uw extends Vn{get[Symbol.toStringTag](){return"TextureView"}constructor(e,r){super(e,r,uw.defaultProps)}static defaultProps={...Vn.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0}}function fie(t,e,r){let n="";const i=e.split(/\r?\n/),a=t.slice().sort((c,s)=>c.lineNum-s.lineNum);switch(r?.showSourceCode||"no"){case"all":let c=0;for(let s=1;s<=i.length;s++)for(n+=Sz(i[s-1],s,r);a.length>c&&a[c].lineNum===s;){const g=a[c++];n+=LT(g,i,g.lineNum,{...r,inlineSource:!1})}for(;a.length>c;){const s=a[c++];n+=LT(s,[],0,{...r,inlineSource:!1})}return n;case"issues":case"no":for(const s of t)n+=LT(s,i,s.lineNum,{inlineSource:r?.showSourceCode!=="no"});return n}}function LT(t,e,r,n){if(n?.inlineSource){const a=die(e,r),c=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${a}${c}${t.type.toUpperCase()}: ${t.message}

`}const i=t.type==="error"?"red":"#8B4000";return n?.html?`<div class='luma-compiler-log-error' style="color:${i};"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function die(t,e,r){let n="";for(let i=e-2;i<=e;i++){const a=t[i-1];a!==void 0&&(n+=Sz(a,e,r))}return n}function Sz(t,e,r){const n=r?.html?gie(t):t;return`${pie(String(e),4)}: ${n}${r?.html?"<br/>":`
`}`}function pie(t,e){let r="";for(let n=t.length;n<e;++n)r+=" ";return r+t}function gie(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}class hw extends Vn{get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(e,r){r={...r,debugShaders:r.debugShaders||e.props.debugShaders||"errors"},super(e,{id:mie(r),...r},hw.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const e=this.props.debugShaders;switch(e){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();e==="warnings"&&r?.length===0||this._displayShaderLog(r,this.id)}_displayShaderLog(e,r){if(typeof document>"u"||!document?.createElement)return;const n=r,i=`${this.stage} shader "${n}"`;let a=fie(e,this.source,{showSourceCode:"all",html:!0});const c=this.getTranslatedSource();c&&(a+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${c}</pre></code>`);const s=document.createElement("Button");s.innerHTML=`
<h1>Compilation error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${a}
</pre></code>`,s.style.top="10px",s.style.left="10px",s.style.position="absolute",s.style.zIndex="9999",s.style.width="100%",s.style.textAlign="left",document.body.appendChild(s),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),s.onclick=()=>{const _=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(_)}}static defaultProps={...Vn.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0}}function mie(t){return yie(t.source)||t.id||cw(`unnamed ${t.stage}-shader`)}function yie(t,e="unnamed"){const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return n?n[1]:e}class fw extends Vn{get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(e,r={}){super(e,r,fw.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(e){const r=this.colorAttachments.map(i=>i.texture.clone(e)),n=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer({...this.props,colorAttachments:r,depthStencilAttachment:n})}resize(e){let r=!e;if(e){const[n,i]=Array.isArray(e)?e:[e.width,e.height];r=r||i!==this.height||n!==this.width,this.width=n,this.height=i}r&&(Dt.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((r,n)=>{if(typeof r=="string"){const i=this.createColorTexture(r,n);return this.attachResource(i),i.view}return r instanceof Ps?r.view:r});const e=this.props.depthStencilAttachment;if(e)if(typeof e=="string"){const r=this.createDepthStencilTexture(e);this.attachResource(r),this.depthStencilAttachment=r.view}else e instanceof Ps?this.depthStencilAttachment=e.view:this.depthStencilAttachment=e}createColorTexture(e,r){return this.device.createTexture({id:`${this.id}-color-attachment-${r}`,usage:Ps.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:Ps.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})}resizeAttachments(e,r){for(let n=0;n<this.colorAttachments.length;++n)if(this.colorAttachments[n]){const i=this.colorAttachments[n].texture.clone({width:e,height:r});this.destroyAttachedResource(this.colorAttachments[n]),this.colorAttachments[n]=i.view,this.attachResource(i.view)}if(this.depthStencilAttachment){const n=this.depthStencilAttachment.texture.clone({width:e,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=n.view,this.attachResource(n)}this.updateAttachments()}static defaultProps={...Vn.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null}}class _g extends Vn{get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(e,r){super(e,r,_g.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}static defaultProps={...Vn.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",colorAttachmentFormats:void 0,depthStencilAttachmentFormat:void 0,parameters:{},bindings:{},uniforms:{}}}class sg extends Vn{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;get[Symbol.toStringTag](){return"RenderPass"}constructor(e,r){r=sg.normalizeProps(e,r),super(e,r,sg.defaultProps)}static normalizeProps(e,r){return r}static defaultProps={...Vn.defaultProps,framebuffer:null,parameters:void 0,clearColor:sg.defaultClearColor,clearColors:void 0,clearDepth:sg.defaultClearDepth,clearStencil:sg.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0}}class c1 extends Vn{get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(e,r){super(e,r,c1.defaultProps),this.shaderLayout=r.shaderLayout}static defaultProps={...Vn.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0}}class Y3 extends Vn{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,r){super(e,r,Y3.defaultProps)}static defaultProps={...Vn.defaultProps,measureExecutionTime:void 0}}class K3 extends Vn{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,r){super(e,r,K3.defaultProps)}static defaultProps={...Vn.defaultProps}}function Az(t){return xie[t]}function _ie(t){const[e,r]=bie[t],n=e==="i32"||e==="u32",i=e!=="u32",a=vie[e]*r;return{primitiveType:e,components:r,byteLength:a,integer:n,signed:i}}const vie={f32:4,f16:2,i32:4,u32:4},bie={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},xie={f32:{type:"f32",components:1},f16:{type:"f16",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<f16>":{type:"f16",components:2},"vec3<f16>":{type:"f16",components:3},"vec4<f16>":{type:"f16",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16},"mat2x2<f16>":{type:"f16",components:4},"mat2x3<f16>":{type:"f16",components:6},"mat2x4<f16>":{type:"f16",components:8},"mat3x2<f16>":{type:"f16",components:6},"mat3x3<f16>":{type:"f16",components:9},"mat3x4<f16>":{type:"f16",components:12},"mat4x2<f16>":{type:"f16",components:8},"mat4x3<f16>":{type:"f16",components:12},"mat4x4<f16>":{type:"f16",components:16},"mat2x2<i32>":{type:"i32",components:4},"mat2x3<i32>":{type:"i32",components:6},"mat2x4<i32>":{type:"i32",components:8},"mat3x2<i32>":{type:"i32",components:6},"mat3x3<i32>":{type:"i32",components:9},"mat3x4<i32>":{type:"i32",components:12},"mat4x2<i32>":{type:"i32",components:8},"mat4x3<i32>":{type:"i32",components:12},"mat4x4<i32>":{type:"i32",components:16},"mat2x2<u32>":{type:"u32",components:4},"mat2x3<u32>":{type:"u32",components:6},"mat2x4<u32>":{type:"u32",components:8},"mat3x2<u32>":{type:"u32",components:6},"mat3x3<u32>":{type:"u32",components:9},"mat3x4<u32>":{type:"u32",components:12},"mat4x2<u32>":{type:"u32",components:8},"mat4x3<u32>":{type:"u32",components:12},"mat4x4<u32>":{type:"u32",components:16}};function Ez(t,e){const r={};for(const n of t.attributes){const i=Tie(t,e,n.name);i&&(r[n.name]=i)}return r}function wie(t,e,r=16){const n=Ez(t,e),i=new Array(r).fill(null);for(const a of Object.values(n))i[a.location]=a;return i}function Tie(t,e,r){const n=Sie(t,r),i=Aie(e,r);if(!n)return null;const a=_ie(n.type),c=Une(a),s=i?.vertexFormat||c,g=Z3(s);return{attributeName:i?.attributeName||n.name,bufferName:i?.bufferName||n.name,location:n.location,shaderType:n.type,primitiveType:a.primitiveType,shaderComponents:a.components,vertexFormat:s,bufferDataType:g.type,bufferComponents:g.components,normalized:g.normalized,integer:a.integer,stepMode:i?.stepMode||n.stepMode||"vertex",byteOffset:i?.byteOffset||0,byteStride:i?.byteStride||0}}function Sie(t,e){const r=t.attributes.find(n=>n.name===e);return r||Dt.warn(`shader layout attribute "${e}" not present in shader`),r||null}function Aie(t,e){Eie(t);let r=Cie(t,e);return r||(r=Pie(t,e),r)?r:(Dt.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function Eie(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&Dt.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function Cie(t,e){for(const r of t)if(r.format&&r.name===e)return{attributeName:r.name,bufferName:e,stepMode:r.stepMode,vertexFormat:r.format,byteOffset:0,byteStride:r.byteStride||0};return null}function Pie(t,e){for(const r of t){let n=r.byteStride;if(typeof r.byteStride!="number")for(const a of r.attributes||[]){const c=Z3(a.format);n+=c.byteLength}const i=r.attributes?.find(a=>a.attribute===e);if(i)return{attributeName:i.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:i.format,byteOffset:i.byteOffset,byteStride:n}}return null}class Q3 extends Vn{static defaultProps={...Vn.defaultProps,shaderLayout:void 0,bufferLayout:[]};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(e,r){super(e,r,Q3.defaultProps),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=wie(r.shaderLayout,r.bufferLayout,this.maxVertexAttributes)}setConstantWebGL(e,r){this.device.reportError(new Error("constant attributes not supported"),this)()}}class J3 extends Vn{static defaultProps={...Vn.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,r){super(e,r,J3.defaultProps)}}class eC extends Vn{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,r){super(e,r,eC.defaultProps)}static defaultProps={...Vn.defaultProps,type:void 0,count:void 0}}let Vb;function Cz(t){return(!Vb||Vb.byteLength<t)&&(Vb=new ArrayBuffer(t)),Vb}function Mie(t,e){const r=Cz(t.BYTES_PER_ELEMENT*e);return new t(r,0,e)}function Iie(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function u1(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":Iie(t)}const Rie=1024;class Oie{layout={};byteLength;constructor(e,r={}){let n=0;for(const[a,c]of Object.entries(e)){const s=Az(c),{type:g,components:_}=s,v=_*(r?.[a]??1);n=Nne(n,v);const T=n;n+=v,this.layout[a]={type:g,size:v,offset:T}}n+=(4-n%4)%4;const i=n*4;this.byteLength=Math.max(i,Rie)}getData(e){const r=Cz(this.byteLength),n={i32:new Int32Array(r),u32:new Uint32Array(r),f32:new Float32Array(r),f16:new Uint16Array(r)};for(const[i,a]of Object.entries(e)){const c=this.layout[i];if(!c){Dt.warn(`Supplied uniform value ${i} not present in uniform block layout`)();continue}const{type:s,size:g,offset:_}=c,v=n[s];if(g===1){if(typeof a!="number"&&typeof a!="boolean"){Dt.warn(`Supplied value for single component uniform ${i} is not a number: ${a}`)();continue}v[_]=Number(a)}else{if(!u1(a)){Dt.warn(`Supplied value for multi component / array uniform ${i} is not a numeric array: ${a}`)();continue}v.set(a,_)}}return new Uint8Array(r,0,this.byteLength)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function kie(t,e,r=16){if(t!==e)return!1;const n=t,i=e;if(!u1(n))return!1;if(u1(i)&&n.length===i.length){for(let a=0;a<n.length;++a)if(i[a]!==n[a])return!1}return!0}function Die(t){return u1(t)?t.slice():t}class Lie{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name||"unnamed",e?.name&&e?.shaderLayout){const r=e?.shaderLayout.bindings?.find(i=>i.type==="uniform"&&i.name===e?.name);if(!r)throw new Error(e?.name);const n=r;for(const i of n.uniforms||[])this.bindingLayout[i.name]=i}}setUniforms(e){for(const[r,n]of Object.entries(e))this._setUniform(r,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${r}=${n}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,r){kie(this.uniforms[e],r)||(this.uniforms[e]=Die(r),this.modifiedUniforms[e]=!0,this.modified=!0)}}class Bie{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(const[r,n]of Object.entries(e)){const i=r,a=new Oie(n.uniformTypes??{},n.uniformSizes??{});this.uniformBufferLayouts.set(i,a);const c=new Lie({name:r});c.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(i,c)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[r,n]of Object.entries(e))this.uniformBlocks.get(r)?.setUniforms(n);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e)?.byteLength||0}getUniformBufferData(e){const r=this.uniformBlocks.get(e)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(e)?.getData(r)}createUniformBuffer(e,r,n){n&&this.setUniforms(n);const i=this.getUniformBufferByteLength(r),a=e.createBuffer({usage:Ni.UNIFORM|Ni.COPY_DST,byteLength:i}),c=this.getUniformBufferData(r);return a.write(c),a}getManagedUniformBuffer(e,r){if(!this.uniformBuffers.get(r)){const n=this.getUniformBufferByteLength(r),i=e.createBuffer({usage:Ni.UNIFORM|Ni.COPY_DST,byteLength:n});this.uniformBuffers.set(r,i)}return this.uniformBuffers.get(r)}updateUniformBuffers(){let e=!1;for(const r of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(r);e||=n}return e&&Dt.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const r=this.uniformBlocks.get(e);let n=this.uniformBuffers.get(e),i=!1;if(n&&r?.needsRedraw){i||=r.needsRedraw;const a=this.getUniformBufferData(e);n=this.uniformBuffers.get(e),n?.write(a);const c=this.uniformBlocks.get(e)?.getAllUniforms();Dt.log(4,`Writing to uniform buffer ${String(e)}`,a,c)()}return i}}let hc=class{constructor(e,r){this.name=e,this.attributes=r,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}};class TO{constructor(e,r,n){this.name=e,this.type=r,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Rd extends hc{constructor(e,r){super(e,r),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Bd extends hc{constructor(e,r){super(e,r),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class dA extends hc{constructor(e,r,n){super(e,n),this.format=r}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class Mg extends hc{constructor(e,r,n,i){super(e,n),this.format=r,this.access=i}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var Pd;(t=>{t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(Pd||(Pd={}));class $b{constructor(e,r,n,i,a,c,s){this.name=e,this.type=r,this.group=n,this.binding=i,this.attributes=a,this.resourceType=c,this.access=s}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Nie{constructor(e,r){this.name=e,this.type=r}}class zie{constructor(e,r,n,i){this.name=e,this.type=r,this.locationType=n,this.location=i,this.interpolation=null}}class SO{constructor(e,r,n,i){this.name=e,this.type=r,this.locationType=n,this.location=i}}class Fie{constructor(e,r,n,i){this.name=e,this.type=r,this.attributes=n,this.id=i}}class Uie{constructor(e,r,n){this.name=e,this.type=r,this.attributes=n}}class jie{constructor(e,r=null,n){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=r,this.attributes=n}}class Vie{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}function $ie(t){var e=(32768&t)>>15,r=(31744&t)>>10,n=1023&t;return r==0?(e?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):r==31?n?NaN:1/0*(e?-1:1):(e?-1:1)*Math.pow(2,r-15)*(1+n/Math.pow(2,10))}const Pz=new Float32Array(1),Hie=new Int32Array(Pz.buffer),Ia=new Uint16Array(1);function Wie(t){Pz[0]=t;const e=Hie[0],r=e>>31&1;let n=e>>23&255,i=8388607&e;if(n===255)return Ia[0]=r<<15|31744|(i!==0?512:0),Ia[0];if(n===0){if(i===0)return Ia[0]=r<<15,Ia[0];i|=8388608;let a=113;for(;!(8388608&i);)i<<=1,a--;return n=127-a,i&=8388607,n>0?(i=(i>>126-n)+(i>>127-n&1),Ia[0]=r<<15|n<<10|i>>13,Ia[0]):(Ia[0]=r<<15,Ia[0])}return n=n-127+15,n>=31?(Ia[0]=r<<15|31744,Ia[0]):n<=0?n<-10?(Ia[0]=r<<15,Ia[0]):(i=(8388608|i)>>1-n,Ia[0]=r<<15|i>>13,Ia[0]):(i>>=13,Ia[0]=r<<15|n<<10|i,Ia[0])}const tC=new Uint32Array(1),Mz=new Float32Array(tC.buffer,0,1);function AO(t){const e=112+(t>>6&31)<<23|(63&t)<<17;return tC[0]=e,Mz[0]}function qie(t,e,r,n,i,a,c,s,g){const _=n*(c>>=i)*(a>>=i)+r*c+e*s;switch(g){case"r8unorm":return[An(t,_,"8unorm",1)[0]];case"r8snorm":return[An(t,_,"8snorm",1)[0]];case"r8uint":return[An(t,_,"8uint",1)[0]];case"r8sint":return[An(t,_,"8sint",1)[0]];case"rg8unorm":{const v=An(t,_,"8unorm",2);return[v[0],v[1]]}case"rg8snorm":{const v=An(t,_,"8snorm",2);return[v[0],v[1]]}case"rg8uint":{const v=An(t,_,"8uint",2);return[v[0],v[1]]}case"rg8sint":{const v=An(t,_,"8sint",2);return[v[0],v[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const v=An(t,_,"8unorm",4);return[v[0],v[1],v[2],v[3]]}case"rgba8snorm":{const v=An(t,_,"8snorm",4);return[v[0],v[1],v[2],v[3]]}case"rgba8uint":{const v=An(t,_,"8uint",4);return[v[0],v[1],v[2],v[3]]}case"rgba8sint":{const v=An(t,_,"8sint",4);return[v[0],v[1],v[2],v[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const v=An(t,_,"8unorm",4);return[v[2],v[1],v[0],v[3]]}case"r16uint":return[An(t,_,"16uint",1)[0]];case"r16sint":return[An(t,_,"16sint",1)[0]];case"r16float":return[An(t,_,"16float",1)[0]];case"rg16uint":{const v=An(t,_,"16uint",2);return[v[0],v[1]]}case"rg16sint":{const v=An(t,_,"16sint",2);return[v[0],v[1]]}case"rg16float":{const v=An(t,_,"16float",2);return[v[0],v[1]]}case"rgba16uint":{const v=An(t,_,"16uint",4);return[v[0],v[1],v[2],v[3]]}case"rgba16sint":{const v=An(t,_,"16sint",4);return[v[0],v[1],v[2],v[3]]}case"rgba16float":{const v=An(t,_,"16float",4);return[v[0],v[1],v[2],v[3]]}case"r32uint":return[An(t,_,"32uint",1)[0]];case"r32sint":return[An(t,_,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[An(t,_,"32float",1)[0]];case"rg32uint":{const v=An(t,_,"32uint",2);return[v[0],v[1]]}case"rg32sint":{const v=An(t,_,"32sint",2);return[v[0],v[1]]}case"rg32float":{const v=An(t,_,"32float",2);return[v[0],v[1]]}case"rgba32uint":{const v=An(t,_,"32uint",4);return[v[0],v[1],v[2],v[3]]}case"rgba32sint":{const v=An(t,_,"32sint",4);return[v[0],v[1],v[2],v[3]]}case"rgba32float":{const v=An(t,_,"32float",4);return[v[0],v[1],v[2],v[3]]}case"rg11b10ufloat":{const v=new Uint32Array(t.buffer,_,1)[0],T=(4192256&v)>>11,M=(4290772992&v)>>22;return[AO(2047&v),AO(T),(function(O){const F=112+(O>>5&31)<<23|(31&O)<<18;return tC[0]=F,Mz[0]})(M),1]}}return null}function An(t,e,r,n){const i=[0,0,0,0];for(let a=0;a<n;++a)switch(r){case"8unorm":i[a]=t[e]/255,e++;break;case"8snorm":i[a]=t[e]/255*2-1,e++;break;case"8uint":i[a]=t[e],e++;break;case"8sint":i[a]=t[e]-127,e++;break;case"16uint":i[a]=t[e]|t[e+1]<<8,e+=2;break;case"16sint":i[a]=(t[e]|t[e+1]<<8)-32768,e+=2;break;case"16float":i[a]=$ie(t[e]|t[e+1]<<8),e+=2;break;case"32uint":case"32sint":i[a]=t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24,e+=4;break;case"32float":i[a]=new Float32Array(t.buffer,e,1)[0],e+=4}return i}function kn(t,e,r,n,i){for(let a=0;a<n;++a)switch(r){case"8unorm":t[e]=255*i[a],e++;break;case"8snorm":t[e]=.5*(i[a]+1)*255,e++;break;case"8uint":t[e]=i[a],e++;break;case"8sint":t[e]=i[a]+127,e++;break;case"16uint":new Uint16Array(t.buffer,e,1)[0]=i[a],e+=2;break;case"16sint":new Int16Array(t.buffer,e,1)[0]=i[a],e+=2;break;case"16float":{const c=Wie(i[a]);new Uint16Array(t.buffer,e,1)[0]=c,e+=2;break}case"32uint":new Uint32Array(t.buffer,e,1)[0]=i[a],e+=4;break;case"32sint":new Int32Array(t.buffer,e,1)[0]=i[a],e+=4;break;case"32float":new Float32Array(t.buffer,e,1)[0]=i[a],e+=4}return i}const BT={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class xc{constructor(){this.id=xc._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,r){if(e){r(h1.instance);for(const n of e)n instanceof Array?this.searchBlock(n,r):n.search(r);r(f1.instance)}}constEvaluate(e,r){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}xc._id=0;class h1 extends xc{}h1.instance=new h1;class f1 extends xc{}f1.instance=new f1;const Iz=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class Ai extends xc{constructor(){super()}}class Xv extends Ai{constructor(e,r,n,i,a,c){super(),this.calls=new Set,this.name=e,this.args=r,this.returnType=n,this.body=i,this.startLine=a,this.endLine=c}get astNodeType(){return"function"}search(e){if(this.attributes)for(const r of this.attributes)e(r);e(this);for(const r of this.args)e(r);this.searchBlock(this.body,e)}}class Gie extends Ai{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class Rz extends Ai{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class pA extends Ai{constructor(e,r){super(),this.body=e,this.loopId=r}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class Oz extends Ai{constructor(e,r,n,i){super(),this.init=e,this.condition=r,this.increment=n,this.body=i}get astNodeType(){return"for"}search(e){var r,n,i;(r=this.init)===null||r===void 0||r.search(e),(n=this.condition)===null||n===void 0||n.search(e),(i=this.increment)===null||i===void 0||i.search(e),this.searchBlock(this.body,e)}}class cf extends Ai{constructor(e,r,n,i,a){super(),this.attributes=null,this.name=e,this.type=r,this.storage=n,this.access=i,this.value=a}get astNodeType(){return"var"}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}}class rC extends Ai{constructor(e,r,n){super(),this.attributes=null,this.name=e,this.type=r,this.value=n}get astNodeType(){return"override"}search(e){var r;(r=this.value)===null||r===void 0||r.search(e)}}class Mv extends Ai{constructor(e,r,n,i,a){super(),this.attributes=null,this.name=e,this.type=r,this.storage=n,this.access=i,this.value=a}get astNodeType(){return"let"}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}}class cx extends Ai{constructor(e,r,n,i,a){super(),this.attributes=null,this.name=e,this.type=r,this.storage=n,this.access=i,this.value=a}get astNodeType(){return"const"}constEvaluate(e,r){return this.value.constEvaluate(e,r)}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}}var ty,gv,st,Xe;(t=>{t.increment="++",t.decrement="--"})(ty||(ty={})),(t=>{t.parse=function(e){const r=e;if(r=="parse")throw new Error("Invalid value for IncrementOperator");return t[r]}})(ty||(ty={}));class kz extends Ai{constructor(e,r){super(),this.operator=e,this.variable=r}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(t=>{t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(gv||(gv={})),(t=>{t.parse=function(e){const r=e;if(r=="parse")throw new Error("Invalid value for AssignOperator");return r}})(gv||(gv={}));class Dz extends Ai{constructor(e,r,n){super(),this.operator=e,this.variable=r,this.value=n}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class nC extends Ai{constructor(e,r){super(),this.name=e,this.args=r}get astNodeType(){return"call"}isBuiltin(){return Iz.has(this.name)}search(e){for(const r of this.args)r.search(e);e(this)}}class Lz extends Ai{constructor(e,r){super(),this.body=e,this.continuing=r}get astNodeType(){return"loop"}search(e){var r;this.searchBlock(this.body,e),(r=this.continuing)===null||r===void 0||r.search(e)}}class Bz extends Ai{constructor(e,r){super(),this.condition=e,this.cases=r}get astNodeType(){return"switch"}search(e){e(this);for(const r of this.cases)r.search(e)}}class Nz extends Ai{constructor(e,r,n,i){super(),this.condition=e,this.body=r,this.elseif=n,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class zz extends Ai{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var r;(r=this.value)===null||r===void 0||r.search(e)}}class Xie extends Ai{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class Zie extends Ai{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class Fz extends Ai{constructor(e,r){super(),this.severity=e,this.rule=r}get astNodeType(){return"diagnostic"}}class iC extends Ai{constructor(e,r){super(),this.name=e,this.type=r}get astNodeType(){return"alias"}}class Yie extends Ai{constructor(){super()}get astNodeType(){return"discard"}}class Uz extends Ai{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class jz extends Ai{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class Rt extends Ai{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let r=e[0];if(r.name==="f32")return r;for(let n=1;n<e.length;++n){const i=Rt._priority.get(r.name);Rt._priority.get(e[n].name)<i&&(r=e[n])}return r.name==="x32"?Rt.i32:r}getTypeName(){return this.name}}Rt.x32=new Rt("x32"),Rt.f32=new Rt("f32"),Rt.i32=new Rt("i32"),Rt.u32=new Rt("u32"),Rt.f16=new Rt("f16"),Rt.bool=new Rt("bool"),Rt.void=new Rt("void"),Rt._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class EO extends Rt{constructor(e){super(e)}}class nf extends Rt{constructor(e,r,n,i){super(e),this.members=r,this.startLine=n,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let r=0;r<this.members.length;r++)if(this.members[r].name==e)return r;return-1}search(e){for(const r of this.members)e(r)}}class Je extends Rt{constructor(e,r,n){super(e),this.format=r,this.access=n}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}Je.vec2f=new Je("vec2",Rt.f32,null),Je.vec3f=new Je("vec3",Rt.f32,null),Je.vec4f=new Je("vec4",Rt.f32,null),Je.vec2i=new Je("vec2",Rt.i32,null),Je.vec3i=new Je("vec3",Rt.i32,null),Je.vec4i=new Je("vec4",Rt.i32,null),Je.vec2u=new Je("vec2",Rt.u32,null),Je.vec3u=new Je("vec3",Rt.u32,null),Je.vec4u=new Je("vec4",Rt.u32,null),Je.vec2h=new Je("vec2",Rt.f16,null),Je.vec3h=new Je("vec3",Rt.f16,null),Je.vec4h=new Je("vec4",Rt.f16,null),Je.vec2b=new Je("vec2",Rt.bool,null),Je.vec3b=new Je("vec3",Rt.bool,null),Je.vec4b=new Je("vec4",Rt.bool,null),Je.mat2x2f=new Je("mat2x2",Rt.f32,null),Je.mat2x3f=new Je("mat2x3",Rt.f32,null),Je.mat2x4f=new Je("mat2x4",Rt.f32,null),Je.mat3x2f=new Je("mat3x2",Rt.f32,null),Je.mat3x3f=new Je("mat3x3",Rt.f32,null),Je.mat3x4f=new Je("mat3x4",Rt.f32,null),Je.mat4x2f=new Je("mat4x2",Rt.f32,null),Je.mat4x3f=new Je("mat4x3",Rt.f32,null),Je.mat4x4f=new Je("mat4x4",Rt.f32,null),Je.mat2x2h=new Je("mat2x2",Rt.f16,null),Je.mat2x3h=new Je("mat2x3",Rt.f16,null),Je.mat2x4h=new Je("mat2x4",Rt.f16,null),Je.mat3x2h=new Je("mat3x2",Rt.f16,null),Je.mat3x3h=new Je("mat3x3",Rt.f16,null),Je.mat3x4h=new Je("mat3x4",Rt.f16,null),Je.mat4x2h=new Je("mat4x2",Rt.f16,null),Je.mat4x3h=new Je("mat4x3",Rt.f16,null),Je.mat4x4h=new Je("mat4x4",Rt.f16,null),Je.mat2x2i=new Je("mat2x2",Rt.i32,null),Je.mat2x3i=new Je("mat2x3",Rt.i32,null),Je.mat2x4i=new Je("mat2x4",Rt.i32,null),Je.mat3x2i=new Je("mat3x2",Rt.i32,null),Je.mat3x3i=new Je("mat3x3",Rt.i32,null),Je.mat3x4i=new Je("mat3x4",Rt.i32,null),Je.mat4x2i=new Je("mat4x2",Rt.i32,null),Je.mat4x3i=new Je("mat4x3",Rt.i32,null),Je.mat4x4i=new Je("mat4x4",Rt.i32,null),Je.mat2x2u=new Je("mat2x2",Rt.u32,null),Je.mat2x3u=new Je("mat2x3",Rt.u32,null),Je.mat2x4u=new Je("mat2x4",Rt.u32,null),Je.mat3x2u=new Je("mat3x2",Rt.u32,null),Je.mat3x3u=new Je("mat3x3",Rt.u32,null),Je.mat3x4u=new Je("mat3x4",Rt.u32,null),Je.mat4x2u=new Je("mat4x2",Rt.u32,null),Je.mat4x3u=new Je("mat4x3",Rt.u32,null),Je.mat4x4u=new Je("mat4x4",Rt.u32,null);class ux extends Rt{constructor(e,r,n,i){super(e),this.storage=r,this.type=n,this.access=i}get astNodeType(){return"pointer"}}class Iv extends Rt{constructor(e,r,n,i){super(e),this.attributes=r,this.format=n,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class mv extends Rt{constructor(e,r,n){super(e),this.format=r,this.access=n}get astNodeType(){return"sampler"}}class uu extends xc{constructor(){super(),this.postfix=null}}class Ig extends uu{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class eh extends uu{constructor(e,r){super(),this.type=e,this.args=r}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const r of this.args)r.search(e)}constEvaluate(e,r){return r&&(r[0]=this.type),e.evalExpression(this,e.context)}}class sC extends uu{constructor(e,r){super(),this.cachedReturnValue=null,this.name=e,this.args=r}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return Iz.has(this.name)}constEvaluate(e,r){return e.evalExpression(this,e.context)}search(e){for(const r of this.args)r.search(e);e(this)}}class pl extends uu{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,r){return e.evalExpression(this,e.context)}}class Vz extends uu{constructor(e,r){super(),this.name=e,this.initializer=r}get astNodeType(){return"constExpr"}constEvaluate(e,r){if(this.initializer){const n=e.evalExpression(this.initializer,e.context);return n!==null&&this.postfix?n.getSubData(e,this.postfix,e.context):n}return null}search(e){this.initializer.search(e)}}class As extends uu{constructor(e,r){super(),this.value=e,this.type=r}get astNodeType(){return"literalExpr"}constEvaluate(e,r){return r!==void 0&&(r[0]=this.type),this.value}get isScalar(){return this.value instanceof Ge}get isVector(){return this.value instanceof Ae||this.value instanceof Sr}get scalarValue(){return this.value instanceof Ge?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof Ae||this.value instanceof Sr?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class $z extends uu{constructor(e,r){super(),this.type=e,this.value=r}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class xy extends uu{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class Hz extends uu{constructor(){super()}}class hs extends Hz{constructor(e,r){super(),this.operator=e,this.right=r}get astNodeType(){return"unaryOp"}constEvaluate(e,r){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class ru extends Hz{constructor(e,r,n){super(),this.operator=e,this.left=r,this.right=n}get astNodeType(){return"binaryOp"}_getPromotedType(e,r){return e.name===r.name?e:e.name==="f32"||r.name==="f32"?Rt.f32:e.name==="u32"||r.name==="u32"?Rt.u32:Rt.i32}constEvaluate(e,r){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class Wz extends xc{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class hx extends uu{constructor(){super()}get astNodeType(){return"default"}}class qz extends Wz{constructor(e,r){super(r),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class Gz extends Wz{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class CO extends xc{constructor(e,r,n){super(),this.name=e,this.type=r,this.attributes=n}get astNodeType(){return"argument"}}class Kie extends xc{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class PO extends xc{constructor(e,r,n){super(),this.name=e,this.type=r,this.attributes=n}get astNodeType(){return"member"}}class Xz extends xc{constructor(e,r){super(),this.name=e,this.value=r}get astNodeType(){return"attribute"}}class yc{constructor(e,r){this.parent=null,this.typeInfo=e,this.parent=r,this.id=yc._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,r,n,i){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,r,n){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}yc._id=0;class gA extends yc{constructor(){super(new hc("void",null),null)}toString(){return"void"}}gA.void=new gA;class Xm extends yc{constructor(e){super(new dA("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,r,n,i){this.reference.setDataValue(e,r,n,i)}getSubData(e,r,n){return r?this.reference.getSubData(e,r,n):this}toString(){return`&${this.reference.toString()}`}}class Ge extends yc{constructor(e,r,n=null){super(r,n),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!==0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",r)}clone(){if(this.data instanceof Float32Array)return new Ge(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Ge(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Ge(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,r,n,i){if(n)return void console.error("SetDataValue: Scalar data does not support postfix",n);if(!(r instanceof Ge))return void console.error("SetDataValue: Invalid value",r);let a=r.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?a=Math.floor(a):this.typeInfo.name==="bool"&&(a=a?1:0),this.data[0]=a}getSubData(e,r,n){return r?(console.error("getSubData: Scalar data does not support postfix",r),null):this}toString(){return`${this.value}`}}function Qie(t,e,r){const n=e.length;return n===2?r==="f32"?new Ae(new Float32Array(e),t.getTypeInfo("vec2f")):r==="i32"||r==="bool"?new Ae(new Int32Array(e),t.getTypeInfo("vec2i")):r==="u32"?new Ae(new Uint32Array(e),t.getTypeInfo("vec2u")):r==="f16"?new Ae(new Float32Array(e),t.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${r}`),null):n===3?r==="f32"?new Ae(new Float32Array(e),t.getTypeInfo("vec3f")):r==="i32"||r==="bool"?new Ae(new Int32Array(e),t.getTypeInfo("vec3i")):r==="u32"?new Ae(new Uint32Array(e),t.getTypeInfo("vec3u")):r==="f16"?new Ae(new Float32Array(e),t.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${r}`),null):n===4?r==="f32"?new Ae(new Float32Array(e),t.getTypeInfo("vec4f")):r==="i32"||r==="bool"?new Ae(new Int32Array(e),t.getTypeInfo("vec4i")):r==="u32"?new Ae(new Uint32Array(e),t.getTypeInfo("vec4u")):r==="f16"?new Ae(new Float32Array(e),t.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${r}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class Ae extends yc{constructor(e,r,n=null){if(super(r,n),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const i=this.typeInfo.name;i==="vec2f"||i==="vec3f"||i==="vec4f"?this.data=new Float32Array(e):i==="vec2i"||i==="vec3i"||i==="vec4i"?this.data=new Int32Array(e):i==="vec2u"||i==="vec3u"||i==="vec4u"?this.data=new Uint32Array(e):i==="vec2h"||i==="vec3h"||i==="vec4h"?this.data=new Float32Array(e):i==="vec2b"||i==="vec3b"||i==="vec4b"?this.data=new Int32Array(e):i==="vec2"||i==="vec3"||i==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${i}`)}}clone(){if(this.data instanceof Float32Array)return new Ae(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Ae(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Ae(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,r,n,i){n instanceof Ig?console.error("TODO: Set vector postfix"):r instanceof Ae?this.data=r.data:console.error("SetDataValue: Invalid value",r)}getSubData(e,r,n){if(r===null)return this;let i=e.getTypeInfo("f32");if(this.typeInfo instanceof Mg)i=this.typeInfo.format||i;else{const c=this.typeInfo.name;c==="vec2f"||c==="vec3f"||c==="vec4f"?i=e.getTypeInfo("f32"):c==="vec2i"||c==="vec3i"||c==="vec4i"?i=e.getTypeInfo("i32"):c==="vec2b"||c==="vec3b"||c==="vec4b"?i=e.getTypeInfo("bool"):c==="vec2u"||c==="vec3u"||c==="vec4u"?i=e.getTypeInfo("u32"):c==="vec2h"||c==="vec3h"||c==="vec4h"?i=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${c}`)}let a=this;for(;r!==null&&a!==null;){if(r instanceof xy){const c=r.index;let s=-1;if(c instanceof As){if(!(c.value instanceof Ge))return console.error(`GetSubData: Invalid array index ${c.value}`),null;s=c.value.value}else{const g=e.evalExpression(c,n);if(!(g instanceof Ge))return console.error("GetSubData: Unknown index type",c),null;s=g.value}if(s<0||s>=a.data.length)return console.error("GetSubData: Index out of range",s),null;if(a.data instanceof Float32Array){const g=new Float32Array(a.data.buffer,a.data.byteOffset+4*s,1);return new Ge(g,i)}if(a.data instanceof Int32Array){const g=new Int32Array(a.data.buffer,a.data.byteOffset+4*s,1);return new Ge(g,i)}if(a.data instanceof Uint32Array){const g=new Uint32Array(a.data.buffer,a.data.byteOffset+4*s,1);return new Ge(g,i)}throw"GetSubData: Invalid data type"}if(!(r instanceof Ig))return console.error("GetSubData: Unknown postfix",r),null;{const c=r.value.toLowerCase();if(c.length===1){let g=0;if(c==="x"||c==="r")g=0;else if(c==="y"||c==="g")g=1;else if(c==="z"||c==="b")g=2;else{if(c!=="w"&&c!=="a")return console.error(`GetSubData: Unknown member ${c}`),null;g=3}if(this.data instanceof Float32Array){let _=new Float32Array(this.data.buffer,this.data.byteOffset+4*g,1);return new Ge(_,i,this)}if(this.data instanceof Int32Array){let _=new Int32Array(this.data.buffer,this.data.byteOffset+4*g,1);return new Ge(_,i,this)}if(this.data instanceof Uint32Array){let _=new Uint32Array(this.data.buffer,this.data.byteOffset+4*g,1);return new Ge(_,i,this)}}const s=[];for(const g of c)g==="x"||g==="r"?s.push(this.data[0]):g==="y"||g==="g"?s.push(this.data[1]):g==="z"||g==="b"?s.push(this.data[2]):g==="w"||g==="a"?s.push(this.data[3]):console.error(`GetDataValue: Unknown member ${g}`);a=Qie(e,s,i.name)}r=r.postfix}return a}toString(){let e=`${this.data[0]}`;for(let r=1;r<this.data.length;++r)e+=`, ${this.data[r]}`;return e}}class Sr extends yc{constructor(e,r,n=null){super(r,n),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new Sr(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,r,n,i){n instanceof Ig?console.error("TODO: Set matrix postfix"):r instanceof Sr?this.data=r.data:console.error("SetDataValue: Invalid value",r)}getSubData(e,r,n){if(r===null)return this;const i=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof Mg)this.typeInfo.format;else if(i.endsWith("f"))e.getTypeInfo("f32");else if(i.endsWith("i"))e.getTypeInfo("i32");else if(i.endsWith("u"))e.getTypeInfo("u32");else{if(!i.endsWith("h"))return console.error(`GetDataValue: Unknown type ${i}`),null;e.getTypeInfo("f16")}if(r instanceof xy){const a=r.index;let c=-1;if(a instanceof As){if(!(a.value instanceof Ge))return console.error(`GetDataValue: Invalid array index ${a.value}`),null;c=a.value.value}else{const _=e.evalExpression(a,n);if(!(_ instanceof Ge))return console.error("GetDataValue: Unknown index type",a),null;c=_.value}if(c<0||c>=this.data.length)return console.error("GetDataValue: Index out of range",c),null;const s=i.endsWith("h")?"h":"f";let g;if(i==="mat2x2"||i==="mat2x2f"||i==="mat2x2h"||i==="mat3x2"||i==="mat3x2f"||i==="mat3x2h"||i==="mat4x2"||i==="mat4x2f"||i==="mat4x2h")g=new Ae(new Float32Array(this.data.buffer,this.data.byteOffset+2*c*4,2),e.getTypeInfo(`vec2${s}`));else if(i==="mat2x3"||i==="mat2x3f"||i==="mat2x3h"||i==="mat3x3"||i==="mat3x3f"||i==="mat3x3h"||i==="mat4x3"||i==="mat4x3f"||i==="mat4x3h")g=new Ae(new Float32Array(this.data.buffer,this.data.byteOffset+3*c*4,3),e.getTypeInfo(`vec3${s}`));else{if(i!=="mat2x4"&&i!=="mat2x4f"&&i!=="mat2x4h"&&i!=="mat3x4"&&i!=="mat3x4f"&&i!=="mat3x4h"&&i!=="mat4x4"&&i!=="mat4x4f"&&i!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${i}`),null;g=new Ae(new Float32Array(this.data.buffer,this.data.byteOffset+4*c*4,4),e.getTypeInfo(`vec4${s}`))}return r.postfix?g.getSubData(e,r.postfix,n):g}return console.error("GetDataValue: Invalid postfix",r),null}toString(){let e=`${this.data[0]}`;for(let r=1;r<this.data.length;++r)e+=`, ${this.data[r]}`;return e}}class Zi extends yc{constructor(e,r,n=0,i=null){super(r,i),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=n}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new Zi(e.buffer,this.typeInfo,0,null)}setDataValue(e,r,n,i){if(r===null)return void console.log("setDataValue: NULL data.");let a=this.offset,c=this.typeInfo;for(;n;){if(n instanceof xy)if(c instanceof Bd){const s=n.index;if(s instanceof As){if(!(s.value instanceof Ge))return void console.error(`SetDataValue: Invalid index type ${s.value}`);a+=s.value.value*c.stride}else{const g=e.evalExpression(s,i);if(!(g instanceof Ge))return void console.error("SetDataValue: Unknown index type",s);a+=g.value*c.stride}c=c.format}else console.error(`SetDataValue: Type ${c.getTypeName()} is not an array`);else{if(!(n instanceof Ig))return void console.error("SetDataValue: Unknown postfix type",n);{const s=n.value;if(c instanceof Rd){let g=!1;for(const _ of c.members)if(_.name===s){a+=_.offset,c=_.type,g=!0;break}if(!g)return void console.error(`SetDataValue: Member ${s} not found`)}else if(c instanceof hc){const g=c.getTypeName();let _=0;if(s==="x"||s==="r")_=0;else if(s==="y"||s==="g")_=1;else if(s==="z"||s==="b")_=2;else{if(s!=="w"&&s!=="a")return void console.error(`SetDataValue: Unknown member ${s}`);_=3}if(!(r instanceof Ge))return void console.error("SetDataValue: Invalid value",r);const v=r.value;return g==="vec2f"?void(new Float32Array(this.buffer,a,2)[_]=v):g==="vec3f"?void(new Float32Array(this.buffer,a,3)[_]=v):g==="vec4f"?void(new Float32Array(this.buffer,a,4)[_]=v):g==="vec2i"?void(new Int32Array(this.buffer,a,2)[_]=v):g==="vec3i"?void(new Int32Array(this.buffer,a,3)[_]=v):g==="vec4i"?void(new Int32Array(this.buffer,a,4)[_]=v):g==="vec2u"?void(new Uint32Array(this.buffer,a,2)[_]=v):g==="vec3u"?void(new Uint32Array(this.buffer,a,3)[_]=v):g==="vec4u"?void(new Uint32Array(this.buffer,a,4)[_]=v):void console.error(`SetDataValue: Type ${g} is not a struct`)}}}n=n.postfix}this.setData(e,r,c,a,i)}setData(e,r,n,i,a){const c=n.getTypeName();if(c!=="f32"&&c!=="f16")if(c!=="i32"&&c!=="atomic<i32>"&&c!=="x32")if(c!=="u32"&&c!=="atomic<u32>")if(c!=="bool"){if(c==="vec2f"||c==="vec2h"){const s=new Float32Array(this.buffer,i,2);return void(r instanceof Ae?(s[0]=r.data[0],s[1]=r.data[1]):(s[0]=r[0],s[1]=r[1]))}if(c==="vec3f"||c==="vec3h"){const s=new Float32Array(this.buffer,i,3);return void(r instanceof Ae?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2]):(s[0]=r[0],s[1]=r[1],s[2]=r[2]))}if(c==="vec4f"||c==="vec4h"){const s=new Float32Array(this.buffer,i,4);return void(r instanceof Ae?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3]))}if(c==="vec2i"){const s=new Int32Array(this.buffer,i,2);return void(r instanceof Ae?(s[0]=r.data[0],s[1]=r.data[1]):(s[0]=r[0],s[1]=r[1]))}if(c==="vec3i"){const s=new Int32Array(this.buffer,i,3);return void(r instanceof Ae?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2]):(s[0]=r[0],s[1]=r[1],s[2]=r[2]))}if(c==="vec4i"){const s=new Int32Array(this.buffer,i,4);return void(r instanceof Ae?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3]))}if(c==="vec2u"){const s=new Uint32Array(this.buffer,i,2);return void(r instanceof Ae?(s[0]=r.data[0],s[1]=r.data[1]):(s[0]=r[0],s[1]=r[1]))}if(c==="vec3u"){const s=new Uint32Array(this.buffer,i,3);return void(r instanceof Ae?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2]):(s[0]=r[0],s[1]=r[1],s[2]=r[2]))}if(c==="vec4u"){const s=new Uint32Array(this.buffer,i,4);return void(r instanceof Ae?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3]))}if(c==="vec2b"){const s=new Uint32Array(this.buffer,i,2);return void(r instanceof Ae?(s[0]=r.data[0],s[1]=r.data[1]):(s[0]=r[0],s[1]=r[1]))}if(c==="vec3b"){const s=new Uint32Array(this.buffer,i,3);return void(r instanceof Ae?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2]):(s[0]=r[0],s[1]=r[1],s[2]=r[2]))}if(c==="vec4b"){const s=new Uint32Array(this.buffer,i,4);return void(r instanceof Ae?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3]))}if(c==="mat2x2f"||c==="mat2x2h"){const s=new Float32Array(this.buffer,i,4);return void(r instanceof Sr?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3]))}if(c==="mat2x3f"||c==="mat2x3h"){const s=new Float32Array(this.buffer,i,6);return void(r instanceof Sr?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3],s[4]=r.data[4],s[5]=r.data[5]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[4]=r[4],s[5]=r[5]))}if(c==="mat2x4f"||c==="mat2x4h"){const s=new Float32Array(this.buffer,i,8);return void(r instanceof Sr?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3],s[4]=r.data[4],s[5]=r.data[5],s[6]=r.data[6],s[7]=r.data[7]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7]))}if(c==="mat3x2f"||c==="mat3x2h"){const s=new Float32Array(this.buffer,i,6);return void(r instanceof Sr?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3],s[4]=r.data[4],s[5]=r.data[5]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[4]=r[4],s[5]=r[5]))}if(c==="mat3x3f"||c==="mat3x3h"){const s=new Float32Array(this.buffer,i,9);return void(r instanceof Sr?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3],s[4]=r.data[4],s[5]=r.data[5],s[6]=r.data[6],s[7]=r.data[7],s[8]=r.data[8]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7],s[8]=r[8]))}if(c==="mat3x4f"||c==="mat3x4h"){const s=new Float32Array(this.buffer,i,12);return void(r instanceof Sr?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3],s[4]=r.data[4],s[5]=r.data[5],s[6]=r.data[6],s[7]=r.data[7],s[8]=r.data[8],s[9]=r.data[9],s[10]=r.data[10],s[11]=r.data[11]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7],s[8]=r[8],s[9]=r[9],s[10]=r[10],s[11]=r[11]))}if(c==="mat4x2f"||c==="mat4x2h"){const s=new Float32Array(this.buffer,i,8);return void(r instanceof Sr?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3],s[4]=r.data[4],s[5]=r.data[5],s[6]=r.data[6],s[7]=r.data[7]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7]))}if(c==="mat4x3f"||c==="mat4x3h"){const s=new Float32Array(this.buffer,i,12);return void(r instanceof Sr?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3],s[4]=r.data[4],s[5]=r.data[5],s[6]=r.data[6],s[7]=r.data[7],s[8]=r.data[8],s[9]=r.data[9],s[10]=r.data[10],s[11]=r.data[11]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7],s[8]=r[8],s[9]=r[9],s[10]=r[10],s[11]=r[11]))}if(c==="mat4x4f"||c==="mat4x4h"){const s=new Float32Array(this.buffer,i,16);return void(r instanceof Sr?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3],s[4]=r.data[4],s[5]=r.data[5],s[6]=r.data[6],s[7]=r.data[7],s[8]=r.data[8],s[9]=r.data[9],s[10]=r.data[10],s[11]=r.data[11],s[12]=r.data[12],s[13]=r.data[13],s[14]=r.data[14],s[15]=r.data[15]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7],s[8]=r[8],s[9]=r[9],s[10]=r[10],s[11]=r[11],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]))}if(r instanceof Zi){if(n===r.typeInfo)return void new Uint8Array(this.buffer,i,r.buffer.byteLength).set(new Uint8Array(r.buffer));console.error("SetDataValue: Type mismatch",c,r.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${c}`)}else r instanceof Ge&&(new Int32Array(this.buffer,i,1)[0]=r.value);else r instanceof Ge&&(new Uint32Array(this.buffer,i,1)[0]=r.value);else r instanceof Ge&&(new Int32Array(this.buffer,i,1)[0]=r.value);else r instanceof Ge&&(new Float32Array(this.buffer,i,1)[0]=r.value)}getSubData(e,r,n){var i,a,c;if(r===null)return this;let s=this.offset,g=this.typeInfo;for(;r;){if(r instanceof xy){const v=r.index,T=v instanceof uu?e.evalExpression(v,n):v;let M=0;if(T instanceof Ge?M=T.value:typeof T=="number"?M=T:console.error("GetDataValue: Invalid index type",v),g instanceof Bd)s+=M*g.stride,g=g.format;else{const O=g.getTypeName();O==="mat4x4"||O==="mat4x4f"||O==="mat4x4h"?(s+=16*M,g=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${g.getTypeName()} is not an array`)}}else{if(!(r instanceof Ig))return console.error("GetDataValue: Unknown postfix type",r),null;{const v=r.value;if(g instanceof Rd){let T=!1;for(const M of g.members)if(M.name===v){s+=M.offset,g=M.type,T=!0;break}if(!T)return console.error(`GetDataValue: Member ${v} not found`),null}else if(g instanceof hc){const T=g.getTypeName();if(T==="vec2f"||T==="vec3f"||T==="vec4f"||T==="vec2i"||T==="vec3i"||T==="vec4i"||T==="vec2u"||T==="vec3u"||T==="vec4u"||T==="vec2b"||T==="vec3b"||T==="vec4b"||T==="vec2h"||T==="vec3h"||T==="vec4h"||T==="vec2"||T==="vec3"||T==="vec4"){if(v.length>0&&v.length<5){let M="f";const O=[];for(let F=0;F<v.length;++F){const j=v[F].toLowerCase();let V=0;if(j==="x"||j==="r")V=0;else if(j==="y"||j==="g")V=1;else if(j==="z"||j==="b")V=2;else{if(j!=="w"&&j!=="a")return console.error(`Unknown member ${v}`),null;V=3}if(v.length===1){if(T.endsWith("f"))return this.buffer.byteLength<s+4*V+4?(console.log("Insufficient buffer data"),null):new Ge(new Float32Array(this.buffer,s+4*V,1),e.getTypeInfo("f32"),this);if(T.endsWith("h"))return new Ge(new Float32Array(this.buffer,s+4*V,1),e.getTypeInfo("f16"),this);if(T.endsWith("i"))return new Ge(new Int32Array(this.buffer,s+4*V,1),e.getTypeInfo("i32"),this);if(T.endsWith("b"))return new Ge(new Int32Array(this.buffer,s+4*V,1),e.getTypeInfo("bool"),this);if(T.endsWith("u"))return new Ge(new Uint32Array(this.buffer,s+4*V,1),e.getTypeInfo("i32"),this)}if(T==="vec2f")O.push(new Float32Array(this.buffer,s,2)[V]);else if(T==="vec3f"){if(s+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const q=new Float32Array(this.buffer,s,3);O.push(q[V])}else if(T==="vec4f")O.push(new Float32Array(this.buffer,s,4)[V]);else if(T==="vec2i")M="i",O.push(new Int32Array(this.buffer,s,2)[V]);else if(T==="vec3i")M="i",O.push(new Int32Array(this.buffer,s,3)[V]);else if(T==="vec4i")M="i",O.push(new Int32Array(this.buffer,s,4)[V]);else if(T==="vec2u"){M="u";const q=new Uint32Array(this.buffer,s,2);O.push(q[V])}else T==="vec3u"?(M="u",O.push(new Uint32Array(this.buffer,s,3)[V])):T==="vec4u"&&(M="u",O.push(new Uint32Array(this.buffer,s,4)[V]))}return O.length===2?g=e.getTypeInfo(`vec2${M}`):O.length===3?g=e.getTypeInfo(`vec3${M}`):O.length===4?g=e.getTypeInfo(`vec4${M}`):console.error(`GetDataValue: Invalid vector length ${O.length}`),new Ae(O,g,null)}return console.error(`GetDataValue: Unknown member ${v}`),null}return console.error(`GetDataValue: Type ${T} is not a struct`),null}}}r=r.postfix}const _=g.getTypeName();return _==="f32"?new Ge(new Float32Array(this.buffer,s,1),g,this):_==="i32"?new Ge(new Int32Array(this.buffer,s,1),g,this):_==="u32"?new Ge(new Uint32Array(this.buffer,s,1),g,this):_==="vec2f"?new Ae(new Float32Array(this.buffer,s,2),g,this):_==="vec3f"?new Ae(new Float32Array(this.buffer,s,3),g,this):_==="vec4f"?new Ae(new Float32Array(this.buffer,s,4),g,this):_==="vec2i"?new Ae(new Int32Array(this.buffer,s,2),g,this):_==="vec3i"?new Ae(new Int32Array(this.buffer,s,3),g,this):_==="vec4i"?new Ae(new Int32Array(this.buffer,s,4),g,this):_==="vec2u"?new Ae(new Uint32Array(this.buffer,s,2),g,this):_==="vec3u"?new Ae(new Uint32Array(this.buffer,s,3),g,this):_==="vec4u"?new Ae(new Uint32Array(this.buffer,s,4),g,this):g instanceof Mg&&g.name==="atomic"?((i=g.format)===null||i===void 0?void 0:i.name)==="u32"?new Ge(new Uint32Array(this.buffer,s,1)[0],g.format,this):((a=g.format)===null||a===void 0?void 0:a.name)==="i32"?new Ge(new Int32Array(this.buffer,s,1)[0],g.format,this):(console.error(`GetDataValue: Invalid atomic format ${(c=g.format)===null||c===void 0?void 0:c.name}`),null):new Zi(this.buffer,g,s,this)}toString(){let e="";if(this.typeInfo instanceof Bd)if(this.typeInfo.format.name==="f32"){const r=new Float32Array(this.buffer,this.offset);e=`[${r[0]}`;for(let n=1;n<r.length;++n)e+=`, ${r[n]}`}else if(this.typeInfo.format.name==="i32"){const r=new Int32Array(this.buffer,this.offset);e=`[${r[0]}`;for(let n=1;n<r.length;++n)e+=`, ${r[n]}`}else if(this.typeInfo.format.name==="u32"){const r=new Uint32Array(this.buffer,this.offset);e=`[${r[0]}`;for(let n=1;n<r.length;++n)e+=`, ${r[n]}`}else if(this.typeInfo.format.name==="vec2f"){const r=new Float32Array(this.buffer,this.offset);e=`[${r[0]}, ${r[1]}]`;for(let n=1;n<r.length/2;++n)e+=`, [${r[2*n]}, ${r[2*n+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const r=new Float32Array(this.buffer,this.offset);e=`[${r[0]}, ${r[1]}, ${r[2]}]`;for(let n=4;n<r.length;n+=4)e+=`, [${r[n]}, ${r[n+1]}, ${r[n+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const r=new Float32Array(this.buffer,this.offset);e=`[${r[0]}, ${r[1]}, ${r[2]}, ${r[3]}]`;for(let n=4;n<r.length;n+=4)e+=`, [${r[n]}, ${r[n+1]}, ${r[n+2]}, ${r[n+3]}]`}else e="[...]";else this.typeInfo instanceof Rd?e+="{...}":e="[...]";return e}}class sf extends yc{constructor(e,r,n,i){super(r,null),this.data=e,this.descriptor=n,this.view=i}clone(){return new sf(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,r;const n=this.descriptor.size;return n instanceof Array&&n.length>0?(e=n[0])!==null&&e!==void 0?e:0:n instanceof Object&&(r=n.width)!==null&&r!==void 0?r:0}get height(){var e,r;const n=this.descriptor.size;return n instanceof Array&&n.length>1?(e=n[1])!==null&&e!==void 0?e:0:n instanceof Object&&(r=n.height)!==null&&r!==void 0?r:0}get depthOrArrayLayers(){var e,r;const n=this.descriptor.size;return n instanceof Array&&n.length>2?(e=n[2])!==null&&e!==void 0?e:0:n instanceof Object&&(r=n.depthOrArrayLayers)!==null&&r!==void 0?r:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const r=[this.width,this.height,this.depthOrArrayLayers];for(let n=0;n<r.length;++n)r[n]=Math.max(1,r[n]>>e);return r}get texelByteSize(){const e=this.format,r=BT[e];return r?r.isDepthStencil?4:r.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,r=BT[e];return!!r&&r.isDepthStencil}getGpuSize(){const e=this.format,r=BT[e],n=this.width;if(!e||n<=0||!r)return-1;const i=this.height,a=this.depthOrArrayLayers,c=this.dimension;return n/r.blockWidth*(c==="1d"?1:i/r.blockHeight)*r.bytesPerBlock*a}getPixel(e,r,n=0,i=0){const a=this.texelByteSize,c=this.bytesPerRow,s=this.height,g=this.data[i];return qie(new Uint8Array(g),e,r,n,i,s,c,a,this.format)}setPixel(e,r,n,i,a){const c=this.texelByteSize,s=this.bytesPerRow,g=this.height,_=this.data[i];(function(v,T,M,O,F,j,V,q,Y,X){const ae=O*(V>>=F)*(j>>=F)+M*V+T*q;switch(Y){case"r8unorm":return void kn(v,ae,"8unorm",1,X);case"r8snorm":return void kn(v,ae,"8snorm",1,X);case"r8uint":return void kn(v,ae,"8uint",1,X);case"r8sint":return void kn(v,ae,"8sint",1,X);case"rg8unorm":return void kn(v,ae,"8unorm",2,X);case"rg8snorm":return void kn(v,ae,"8snorm",2,X);case"rg8uint":return void kn(v,ae,"8uint",2,X);case"rg8sint":return void kn(v,ae,"8sint",2,X);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void kn(v,ae,"8unorm",4,X);case"rgba8snorm":return void kn(v,ae,"8snorm",4,X);case"rgba8uint":return void kn(v,ae,"8uint",4,X);case"rgba8sint":return void kn(v,ae,"8sint",4,X);case"r16uint":return void kn(v,ae,"16uint",1,X);case"r16sint":return void kn(v,ae,"16sint",1,X);case"r16float":return void kn(v,ae,"16float",1,X);case"rg16uint":return void kn(v,ae,"16uint",2,X);case"rg16sint":return void kn(v,ae,"16sint",2,X);case"rg16float":return void kn(v,ae,"16float",2,X);case"rgba16uint":return void kn(v,ae,"16uint",4,X);case"rgba16sint":return void kn(v,ae,"16sint",4,X);case"rgba16float":return void kn(v,ae,"16float",4,X);case"r32uint":return void kn(v,ae,"32uint",1,X);case"r32sint":return void kn(v,ae,"32sint",1,X);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void kn(v,ae,"32float",1,X);case"rg32uint":return void kn(v,ae,"32uint",2,X);case"rg32sint":return void kn(v,ae,"32sint",2,X);case"rg32float":return void kn(v,ae,"32float",2,X);case"rgba32uint":return void kn(v,ae,"32uint",4,X);case"rgba32sint":return void kn(v,ae,"32sint",4,X);case"rgba32float":return void kn(v,ae,"32float",4,X);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(_),e,r,n,i,g,s,c,this.format,a)}}(t=>{t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(Xe||(Xe={}));class Ye{constructor(e,r,n){this.name=e,this.type=r,this.rule=n}toString(){return this.name}}class ve{}st=ve,ve.none=new Ye("",Xe.reserved,""),ve.eof=new Ye("EOF",Xe.token,""),ve.reserved={asm:new Ye("asm",Xe.reserved,"asm"),bf16:new Ye("bf16",Xe.reserved,"bf16"),do:new Ye("do",Xe.reserved,"do"),enum:new Ye("enum",Xe.reserved,"enum"),f16:new Ye("f16",Xe.reserved,"f16"),f64:new Ye("f64",Xe.reserved,"f64"),handle:new Ye("handle",Xe.reserved,"handle"),i8:new Ye("i8",Xe.reserved,"i8"),i16:new Ye("i16",Xe.reserved,"i16"),i64:new Ye("i64",Xe.reserved,"i64"),mat:new Ye("mat",Xe.reserved,"mat"),premerge:new Ye("premerge",Xe.reserved,"premerge"),regardless:new Ye("regardless",Xe.reserved,"regardless"),typedef:new Ye("typedef",Xe.reserved,"typedef"),u8:new Ye("u8",Xe.reserved,"u8"),u16:new Ye("u16",Xe.reserved,"u16"),u64:new Ye("u64",Xe.reserved,"u64"),unless:new Ye("unless",Xe.reserved,"unless"),using:new Ye("using",Xe.reserved,"using"),vec:new Ye("vec",Xe.reserved,"vec"),void:new Ye("void",Xe.reserved,"void")},ve.keywords={array:new Ye("array",Xe.keyword,"array"),atomic:new Ye("atomic",Xe.keyword,"atomic"),bool:new Ye("bool",Xe.keyword,"bool"),f32:new Ye("f32",Xe.keyword,"f32"),i32:new Ye("i32",Xe.keyword,"i32"),mat2x2:new Ye("mat2x2",Xe.keyword,"mat2x2"),mat2x3:new Ye("mat2x3",Xe.keyword,"mat2x3"),mat2x4:new Ye("mat2x4",Xe.keyword,"mat2x4"),mat3x2:new Ye("mat3x2",Xe.keyword,"mat3x2"),mat3x3:new Ye("mat3x3",Xe.keyword,"mat3x3"),mat3x4:new Ye("mat3x4",Xe.keyword,"mat3x4"),mat4x2:new Ye("mat4x2",Xe.keyword,"mat4x2"),mat4x3:new Ye("mat4x3",Xe.keyword,"mat4x3"),mat4x4:new Ye("mat4x4",Xe.keyword,"mat4x4"),ptr:new Ye("ptr",Xe.keyword,"ptr"),sampler:new Ye("sampler",Xe.keyword,"sampler"),sampler_comparison:new Ye("sampler_comparison",Xe.keyword,"sampler_comparison"),struct:new Ye("struct",Xe.keyword,"struct"),texture_1d:new Ye("texture_1d",Xe.keyword,"texture_1d"),texture_2d:new Ye("texture_2d",Xe.keyword,"texture_2d"),texture_2d_array:new Ye("texture_2d_array",Xe.keyword,"texture_2d_array"),texture_3d:new Ye("texture_3d",Xe.keyword,"texture_3d"),texture_cube:new Ye("texture_cube",Xe.keyword,"texture_cube"),texture_cube_array:new Ye("texture_cube_array",Xe.keyword,"texture_cube_array"),texture_multisampled_2d:new Ye("texture_multisampled_2d",Xe.keyword,"texture_multisampled_2d"),texture_storage_1d:new Ye("texture_storage_1d",Xe.keyword,"texture_storage_1d"),texture_storage_2d:new Ye("texture_storage_2d",Xe.keyword,"texture_storage_2d"),texture_storage_2d_array:new Ye("texture_storage_2d_array",Xe.keyword,"texture_storage_2d_array"),texture_storage_3d:new Ye("texture_storage_3d",Xe.keyword,"texture_storage_3d"),texture_depth_2d:new Ye("texture_depth_2d",Xe.keyword,"texture_depth_2d"),texture_depth_2d_array:new Ye("texture_depth_2d_array",Xe.keyword,"texture_depth_2d_array"),texture_depth_cube:new Ye("texture_depth_cube",Xe.keyword,"texture_depth_cube"),texture_depth_cube_array:new Ye("texture_depth_cube_array",Xe.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new Ye("texture_depth_multisampled_2d",Xe.keyword,"texture_depth_multisampled_2d"),texture_external:new Ye("texture_external",Xe.keyword,"texture_external"),u32:new Ye("u32",Xe.keyword,"u32"),vec2:new Ye("vec2",Xe.keyword,"vec2"),vec3:new Ye("vec3",Xe.keyword,"vec3"),vec4:new Ye("vec4",Xe.keyword,"vec4"),bitcast:new Ye("bitcast",Xe.keyword,"bitcast"),block:new Ye("block",Xe.keyword,"block"),break:new Ye("break",Xe.keyword,"break"),case:new Ye("case",Xe.keyword,"case"),continue:new Ye("continue",Xe.keyword,"continue"),continuing:new Ye("continuing",Xe.keyword,"continuing"),default:new Ye("default",Xe.keyword,"default"),diagnostic:new Ye("diagnostic",Xe.keyword,"diagnostic"),discard:new Ye("discard",Xe.keyword,"discard"),else:new Ye("else",Xe.keyword,"else"),enable:new Ye("enable",Xe.keyword,"enable"),fallthrough:new Ye("fallthrough",Xe.keyword,"fallthrough"),false:new Ye("false",Xe.keyword,"false"),fn:new Ye("fn",Xe.keyword,"fn"),for:new Ye("for",Xe.keyword,"for"),function:new Ye("function",Xe.keyword,"function"),if:new Ye("if",Xe.keyword,"if"),let:new Ye("let",Xe.keyword,"let"),const:new Ye("const",Xe.keyword,"const"),loop:new Ye("loop",Xe.keyword,"loop"),while:new Ye("while",Xe.keyword,"while"),private:new Ye("private",Xe.keyword,"private"),read:new Ye("read",Xe.keyword,"read"),read_write:new Ye("read_write",Xe.keyword,"read_write"),return:new Ye("return",Xe.keyword,"return"),requires:new Ye("requires",Xe.keyword,"requires"),storage:new Ye("storage",Xe.keyword,"storage"),switch:new Ye("switch",Xe.keyword,"switch"),true:new Ye("true",Xe.keyword,"true"),alias:new Ye("alias",Xe.keyword,"alias"),type:new Ye("type",Xe.keyword,"type"),uniform:new Ye("uniform",Xe.keyword,"uniform"),var:new Ye("var",Xe.keyword,"var"),override:new Ye("override",Xe.keyword,"override"),workgroup:new Ye("workgroup",Xe.keyword,"workgroup"),write:new Ye("write",Xe.keyword,"write"),r8unorm:new Ye("r8unorm",Xe.keyword,"r8unorm"),r8snorm:new Ye("r8snorm",Xe.keyword,"r8snorm"),r8uint:new Ye("r8uint",Xe.keyword,"r8uint"),r8sint:new Ye("r8sint",Xe.keyword,"r8sint"),r16uint:new Ye("r16uint",Xe.keyword,"r16uint"),r16sint:new Ye("r16sint",Xe.keyword,"r16sint"),r16float:new Ye("r16float",Xe.keyword,"r16float"),rg8unorm:new Ye("rg8unorm",Xe.keyword,"rg8unorm"),rg8snorm:new Ye("rg8snorm",Xe.keyword,"rg8snorm"),rg8uint:new Ye("rg8uint",Xe.keyword,"rg8uint"),rg8sint:new Ye("rg8sint",Xe.keyword,"rg8sint"),r32uint:new Ye("r32uint",Xe.keyword,"r32uint"),r32sint:new Ye("r32sint",Xe.keyword,"r32sint"),r32float:new Ye("r32float",Xe.keyword,"r32float"),rg16uint:new Ye("rg16uint",Xe.keyword,"rg16uint"),rg16sint:new Ye("rg16sint",Xe.keyword,"rg16sint"),rg16float:new Ye("rg16float",Xe.keyword,"rg16float"),rgba8unorm:new Ye("rgba8unorm",Xe.keyword,"rgba8unorm"),rgba8unorm_srgb:new Ye("rgba8unorm_srgb",Xe.keyword,"rgba8unorm_srgb"),rgba8snorm:new Ye("rgba8snorm",Xe.keyword,"rgba8snorm"),rgba8uint:new Ye("rgba8uint",Xe.keyword,"rgba8uint"),rgba8sint:new Ye("rgba8sint",Xe.keyword,"rgba8sint"),bgra8unorm:new Ye("bgra8unorm",Xe.keyword,"bgra8unorm"),bgra8unorm_srgb:new Ye("bgra8unorm_srgb",Xe.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new Ye("rgb10a2unorm",Xe.keyword,"rgb10a2unorm"),rg11b10float:new Ye("rg11b10float",Xe.keyword,"rg11b10float"),rg32uint:new Ye("rg32uint",Xe.keyword,"rg32uint"),rg32sint:new Ye("rg32sint",Xe.keyword,"rg32sint"),rg32float:new Ye("rg32float",Xe.keyword,"rg32float"),rgba16uint:new Ye("rgba16uint",Xe.keyword,"rgba16uint"),rgba16sint:new Ye("rgba16sint",Xe.keyword,"rgba16sint"),rgba16float:new Ye("rgba16float",Xe.keyword,"rgba16float"),rgba32uint:new Ye("rgba32uint",Xe.keyword,"rgba32uint"),rgba32sint:new Ye("rgba32sint",Xe.keyword,"rgba32sint"),rgba32float:new Ye("rgba32float",Xe.keyword,"rgba32float"),static_assert:new Ye("static_assert",Xe.keyword,"static_assert")},ve.tokens={decimal_float_literal:new Ye("decimal_float_literal",Xe.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new Ye("hex_float_literal",Xe.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new Ye("int_literal",Xe.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new Ye("uint_literal",Xe.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new Ye("name",Xe.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new Ye("ident",Xe.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new Ye("and",Xe.token,"&"),and_and:new Ye("and_and",Xe.token,"&&"),arrow:new Ye("arrow ",Xe.token,"->"),attr:new Ye("attr",Xe.token,"@"),forward_slash:new Ye("forward_slash",Xe.token,"/"),bang:new Ye("bang",Xe.token,"!"),bracket_left:new Ye("bracket_left",Xe.token,"["),bracket_right:new Ye("bracket_right",Xe.token,"]"),brace_left:new Ye("brace_left",Xe.token,"{"),brace_right:new Ye("brace_right",Xe.token,"}"),colon:new Ye("colon",Xe.token,":"),comma:new Ye("comma",Xe.token,","),equal:new Ye("equal",Xe.token,"="),equal_equal:new Ye("equal_equal",Xe.token,"=="),not_equal:new Ye("not_equal",Xe.token,"!="),greater_than:new Ye("greater_than",Xe.token,">"),greater_than_equal:new Ye("greater_than_equal",Xe.token,">="),shift_right:new Ye("shift_right",Xe.token,">>"),less_than:new Ye("less_than",Xe.token,"<"),less_than_equal:new Ye("less_than_equal",Xe.token,"<="),shift_left:new Ye("shift_left",Xe.token,"<<"),modulo:new Ye("modulo",Xe.token,"%"),minus:new Ye("minus",Xe.token,"-"),minus_minus:new Ye("minus_minus",Xe.token,"--"),period:new Ye("period",Xe.token,"."),plus:new Ye("plus",Xe.token,"+"),plus_plus:new Ye("plus_plus",Xe.token,"++"),or:new Ye("or",Xe.token,"|"),or_or:new Ye("or_or",Xe.token,"||"),paren_left:new Ye("paren_left",Xe.token,"("),paren_right:new Ye("paren_right",Xe.token,")"),semicolon:new Ye("semicolon",Xe.token,";"),star:new Ye("star",Xe.token,"*"),tilde:new Ye("tilde",Xe.token,"~"),underscore:new Ye("underscore",Xe.token,"_"),xor:new Ye("xor",Xe.token,"^"),plus_equal:new Ye("plus_equal",Xe.token,"+="),minus_equal:new Ye("minus_equal",Xe.token,"-="),times_equal:new Ye("times_equal",Xe.token,"*="),division_equal:new Ye("division_equal",Xe.token,"/="),modulo_equal:new Ye("modulo_equal",Xe.token,"%="),and_equal:new Ye("and_equal",Xe.token,"&="),or_equal:new Ye("or_equal",Xe.token,"|="),xor_equal:new Ye("xor_equal",Xe.token,"^="),shift_right_equal:new Ye("shift_right_equal",Xe.token,">>="),shift_left_equal:new Ye("shift_left_equal",Xe.token,"<<=")},ve.simpleTokens={"@":st.tokens.attr,"{":st.tokens.brace_left,"}":st.tokens.brace_right,":":st.tokens.colon,",":st.tokens.comma,"(":st.tokens.paren_left,")":st.tokens.paren_right,";":st.tokens.semicolon},ve.literalTokens={"&":st.tokens.and,"&&":st.tokens.and_and,"->":st.tokens.arrow,"/":st.tokens.forward_slash,"!":st.tokens.bang,"[":st.tokens.bracket_left,"]":st.tokens.bracket_right,"=":st.tokens.equal,"==":st.tokens.equal_equal,"!=":st.tokens.not_equal,">":st.tokens.greater_than,">=":st.tokens.greater_than_equal,">>":st.tokens.shift_right,"<":st.tokens.less_than,"<=":st.tokens.less_than_equal,"<<":st.tokens.shift_left,"%":st.tokens.modulo,"-":st.tokens.minus,"--":st.tokens.minus_minus,".":st.tokens.period,"+":st.tokens.plus,"++":st.tokens.plus_plus,"|":st.tokens.or,"||":st.tokens.or_or,"*":st.tokens.star,"~":st.tokens.tilde,_:st.tokens.underscore,"^":st.tokens.xor,"+=":st.tokens.plus_equal,"-=":st.tokens.minus_equal,"*=":st.tokens.times_equal,"/=":st.tokens.division_equal,"%=":st.tokens.modulo_equal,"&=":st.tokens.and_equal,"|=":st.tokens.or_equal,"^=":st.tokens.xor_equal,">>=":st.tokens.shift_right_equal,"<<=":st.tokens.shift_left_equal},ve.regexTokens={decimal_float_literal:st.tokens.decimal_float_literal,hex_float_literal:st.tokens.hex_float_literal,int_literal:st.tokens.int_literal,uint_literal:st.tokens.uint_literal,ident:st.tokens.ident},ve.storage_class=[st.keywords.function,st.keywords.private,st.keywords.workgroup,st.keywords.uniform,st.keywords.storage],ve.access_mode=[st.keywords.read,st.keywords.write,st.keywords.read_write],ve.sampler_type=[st.keywords.sampler,st.keywords.sampler_comparison],ve.sampled_texture_type=[st.keywords.texture_1d,st.keywords.texture_2d,st.keywords.texture_2d_array,st.keywords.texture_3d,st.keywords.texture_cube,st.keywords.texture_cube_array],ve.multisampled_texture_type=[st.keywords.texture_multisampled_2d],ve.storage_texture_type=[st.keywords.texture_storage_1d,st.keywords.texture_storage_2d,st.keywords.texture_storage_2d_array,st.keywords.texture_storage_3d],ve.depth_texture_type=[st.keywords.texture_depth_2d,st.keywords.texture_depth_2d_array,st.keywords.texture_depth_cube,st.keywords.texture_depth_cube_array,st.keywords.texture_depth_multisampled_2d],ve.texture_external_type=[st.keywords.texture_external],ve.any_texture_type=[...st.sampled_texture_type,...st.multisampled_texture_type,...st.storage_texture_type,...st.depth_texture_type,...st.texture_external_type],ve.texel_format=[st.keywords.r8unorm,st.keywords.r8snorm,st.keywords.r8uint,st.keywords.r8sint,st.keywords.r16uint,st.keywords.r16sint,st.keywords.r16float,st.keywords.rg8unorm,st.keywords.rg8snorm,st.keywords.rg8uint,st.keywords.rg8sint,st.keywords.r32uint,st.keywords.r32sint,st.keywords.r32float,st.keywords.rg16uint,st.keywords.rg16sint,st.keywords.rg16float,st.keywords.rgba8unorm,st.keywords.rgba8unorm_srgb,st.keywords.rgba8snorm,st.keywords.rgba8uint,st.keywords.rgba8sint,st.keywords.bgra8unorm,st.keywords.bgra8unorm_srgb,st.keywords.rgb10a2unorm,st.keywords.rg11b10float,st.keywords.rg32uint,st.keywords.rg32sint,st.keywords.rg32float,st.keywords.rgba16uint,st.keywords.rgba16sint,st.keywords.rgba16float,st.keywords.rgba32uint,st.keywords.rgba32sint,st.keywords.rgba32float],ve.const_literal=[st.tokens.int_literal,st.tokens.uint_literal,st.tokens.decimal_float_literal,st.tokens.hex_float_literal,st.keywords.true,st.keywords.false],ve.literal_or_ident=[st.tokens.ident,st.tokens.int_literal,st.tokens.uint_literal,st.tokens.decimal_float_literal,st.tokens.hex_float_literal,st.tokens.name],ve.element_count_expression=[st.tokens.int_literal,st.tokens.uint_literal,st.tokens.ident],ve.template_types=[st.keywords.vec2,st.keywords.vec3,st.keywords.vec4,st.keywords.mat2x2,st.keywords.mat2x3,st.keywords.mat2x4,st.keywords.mat3x2,st.keywords.mat3x3,st.keywords.mat3x4,st.keywords.mat4x2,st.keywords.mat4x3,st.keywords.mat4x4,st.keywords.atomic,st.keywords.bitcast,...st.any_texture_type],ve.attribute_name=[st.tokens.ident,st.keywords.block,st.keywords.diagnostic],ve.assignment_operators=[st.tokens.equal,st.tokens.plus_equal,st.tokens.minus_equal,st.tokens.times_equal,st.tokens.division_equal,st.tokens.modulo_equal,st.tokens.and_equal,st.tokens.or_equal,st.tokens.xor_equal,st.tokens.shift_right_equal,st.tokens.shift_left_equal],ve.increment_operators=[st.tokens.plus_plus,st.tokens.minus_minus];class MO{constructor(e,r,n,i,a){this.type=e,this.lexeme=r,this.line=n,this.start=i,this.end=a}toString(){return this.lexeme}isTemplateType(){return ve.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==ve.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class Jie{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new MO(ve.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let c=1;for(;c>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),c--,c==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),c++)}return!0}}const r=ve.simpleTokens[e];if(r)return this._addToken(r),!0;let n=ve.none;const i=this._isAlpha(e),a=e==="_";if(this._isAlphaNumeric(e)){let c=this._peekAhead();for(;this._isAlphaNumeric(c);)e+=this._advance(),c=this._peekAhead()}if(i){const c=ve.keywords[e];if(c)return this._addToken(c),!0}if(i||a)return this._addToken(ve.tokens.ident),!0;for(;;){let c=this._findType(e);const s=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(s=="=")return this._current++,e+=s,this._addToken(ve.tokens.minus_equal),!0;if(s=="-")return this._current++,e+=s,this._addToken(ve.tokens.minus_minus),!0;const g=this._tokens.length-1;if((ve.literal_or_ident.indexOf(this._tokens[g].type)!=-1||this._tokens[g].type==ve.tokens.paren_right)&&s!=">")return this._addToken(c),!0}if(e==">"&&(s==">"||s=="=")){let g=!1,_=this._tokens.length-1;for(let v=0;v<5&&_>=0&&ve.assignment_operators.indexOf(this._tokens[_].type)===-1;++v,--_)if(this._tokens[_].type===ve.tokens.less_than){_>0&&this._tokens[_-1].isArrayOrTemplateType()&&(g=!0);break}if(g)return this._addToken(c),!0}if(c===ve.none){let g=e,_=0;const v=2;for(let T=0;T<v;++T)if(g+=this._peekAhead(T),c=this._findType(g),c!==ve.none){_=T;break}if(c===ve.none)return n!==ve.none&&(this._current--,this._addToken(n),!0);e=g,this._current+=_+1}if(n=c,this._isAtEnd())break;e+=this._advance()}return n!==ve.none&&(this._addToken(n),!0)}_findType(e){for(const n in ve.regexTokens){const i=ve.regexTokens[n];if(this._match(e,i.rule))return i}return ve.literalTokens[e]||ve.none}_match(e,r){const n=r.exec(e);return n&&n.index==0&&n[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let r=this._source[this._current];return e=e||0,e++,this._current+=e,r}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const r=this._source.substring(this._start,this._current);this._tokens.push(new MO(e,r,this._line,this._start,this._current))}}function Zt(t){return Array.isArray(t)||t?.buffer instanceof ArrayBuffer}const d1=new Float32Array(1),ese=new Uint32Array(d1.buffer),tse=new Uint32Array(d1.buffer),p1=new Int32Array(1),rse=new Float32Array(p1.buffer),nse=new Uint32Array(p1.buffer),g1=new Uint32Array(1),ise=new Float32Array(g1.buffer),sse=new Int32Array(g1.buffer);function IO(t,e,r){if(e===r)return t;if(e==="f32"){if(r==="i32"||r==="x32")return d1[0]=t,ese[0];if(r==="u32")return d1[0]=t,tse[0]}else if(e==="i32"||e==="x32"){if(r==="f32")return p1[0]=t,rse[0];if(r==="u32")return p1[0]=t,nse[0]}else if(e==="u32"){if(r==="f32")return g1[0]=t,ise[0];if(r==="i32"||r==="x32")return g1[0]=t,sse[0]}return console.error(`Unsupported cast from ${e} to ${r}`),t}class ase{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class Hb{constructor(e,r){this.align=e,this.size=r}}class ih{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new Vie,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const r of e)r instanceof Xv&&this._functions.set(r.name,new ase(r));for(const r of e)if(r instanceof nf){const n=this.getTypeInfo(r,null);n instanceof Rd&&this.structs.push(n)}for(const r of e)if(r instanceof iC)this.aliases.push(this._getAliasInfo(r));else{if(r instanceof rC){const n=r,i=this._getAttributeNum(n.attributes,"id",0),a=n.type!=null?this.getTypeInfo(n.type,n.attributes):null;this.overrides.push(new Fie(n.name,a,n.attributes,i));continue}if(this._isUniformVar(r)){const n=r,i=this._getAttributeNum(n.attributes,"group",0),a=this._getAttributeNum(n.attributes,"binding",0),c=this.getTypeInfo(n.type,n.attributes),s=new $b(n.name,c,i,a,n.attributes,Pd.Uniform,n.access);s.access||(s.access="read"),this.uniforms.push(s);continue}if(this._isStorageVar(r)){const n=r,i=this._getAttributeNum(n.attributes,"group",0),a=this._getAttributeNum(n.attributes,"binding",0),c=this.getTypeInfo(n.type,n.attributes),s=this._isStorageTexture(c),g=new $b(n.name,c,i,a,n.attributes,s?Pd.StorageTexture:Pd.Storage,n.access);g.access||(g.access="read"),this.storage.push(g);continue}if(this._isTextureVar(r)){const n=r,i=this._getAttributeNum(n.attributes,"group",0),a=this._getAttributeNum(n.attributes,"binding",0),c=this.getTypeInfo(n.type,n.attributes),s=this._isStorageTexture(c),g=new $b(n.name,c,i,a,n.attributes,s?Pd.StorageTexture:Pd.Texture,n.access);g.access||(g.access="read"),s?this.storage.push(g):this.textures.push(g);continue}if(this._isSamplerVar(r)){const n=r,i=this._getAttributeNum(n.attributes,"group",0),a=this._getAttributeNum(n.attributes,"binding",0),c=this.getTypeInfo(n.type,n.attributes),s=new $b(n.name,c,i,a,n.attributes,Pd.Sampler,n.access);this.samplers.push(s);continue}}for(const r of e)if(r instanceof Xv){const n=this._getAttribute(r,"vertex"),i=this._getAttribute(r,"fragment"),a=this._getAttribute(r,"compute"),c=n||i||a,s=new jie(r.name,c?.name,r.attributes);s.attributes=r.attributes,s.startLine=r.startLine,s.endLine=r.endLine,this.functions.push(s),this._functions.get(r.name).info=s,c&&(this._functions.get(r.name).inUse=!0,s.inUse=!0,s.resources=this._findResources(r,!!c),s.inputs=this._getInputs(r.args),s.outputs=this._getOutputs(r.returnType),this.entry[c.name].push(s)),s.arguments=r.args.map(g=>new Uie(g.name,this.getTypeInfo(g.type,g.attributes),g.attributes)),s.returnType=r.returnType?this.getTypeInfo(r.returnType,r.attributes):null;continue}for(const r of this._functions.values())r.info&&(r.info.inUse=r.inUse,this._addCalls(r.node,r.info.calls));for(const r of this._functions.values())r.node.search(n=>{var i,a,c;if(n instanceof Xz){if(n.value)if(Zt(n.value))for(const s of n.value)for(const g of this.overrides)s===g.name&&((i=r.info)===null||i===void 0||i.overrides.push(g));else for(const s of this.overrides)n.value===s.name&&((a=r.info)===null||a===void 0||a.overrides.push(s))}else if(n instanceof pl)for(const s of this.overrides)n.name===s.name&&((c=r.info)===null||c===void 0||c.overrides.push(s))});for(const r of this.uniforms)this._markStructsInUse(r.type);for(const r of this.storage)this._markStructsInUse(r.type)}getFunctionInfo(e){for(const r of this.functions)if(r.name==e)return r;return null}getStructInfo(e){for(const r of this.structs)if(r.name==e)return r;return null}getOverrideInfo(e){for(const r of this.overrides)if(r.name==e)return r;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const r of e.members)this._markStructsInUse(r.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const r=this._getAlias(e.name);r&&this._markStructsInUse(r)}}_addCalls(e,r){var n;for(const i of e.calls){const a=(n=this._functions.get(i.name))===null||n===void 0?void 0:n.info;a&&r.add(a)}}findResource(e,r,n){if(n){for(const i of this.entry.compute)if(i.name===n){for(const a of i.resources)if(a.group==e&&a.binding==r)return a}for(const i of this.entry.vertex)if(i.name===n){for(const a of i.resources)if(a.group==e&&a.binding==r)return a}for(const i of this.entry.fragment)if(i.name===n){for(const a of i.resources)if(a.group==e&&a.binding==r)return a}}for(const i of this.uniforms)if(i.group==e&&i.binding==r)return i;for(const i of this.storage)if(i.group==e&&i.binding==r)return i;for(const i of this.textures)if(i.group==e&&i.binding==r)return i;for(const i of this.samplers)if(i.group==e&&i.binding==r)return i;return null}_findResource(e){for(const r of this.uniforms)if(r.name==e)return r;for(const r of this.storage)if(r.name==e)return r;for(const r of this.textures)if(r.name==e)return r;for(const r of this.samplers)if(r.name==e)return r;return null}_markStructsFromAST(e){const r=this.getTypeInfo(e,null);this._markStructsInUse(r)}_findResources(e,r){const n=[],i=this,a=[];return e.search(c=>{if(c instanceof h1)a.push({});else if(c instanceof f1)a.pop();else if(c instanceof cf){const s=c;r&&s.type!==null&&this._markStructsFromAST(s.type),a.length>0&&(a[a.length-1][s.name]=s)}else if(c instanceof eh){const s=c;r&&s.type!==null&&this._markStructsFromAST(s.type)}else if(c instanceof Mv){const s=c;r&&s.type!==null&&this._markStructsFromAST(s.type),a.length>0&&(a[a.length-1][s.name]=s)}else if(c instanceof pl){const s=c;if(a.length>0&&a[a.length-1][s.name])return;const g=i._findResource(s.name);g&&n.push(g)}else if(c instanceof sC){const s=c,g=i._functions.get(s.name);g&&(r&&(g.inUse=!0),e.calls.add(g.node),g.resources===null&&(g.resources=i._findResources(g.node,r)),n.push(...g.resources))}else if(c instanceof nC){const s=c,g=i._functions.get(s.name);g&&(r&&(g.inUse=!0),e.calls.add(g.node),g.resources===null&&(g.resources=i._findResources(g.node,r)),n.push(...g.resources))}}),[...new Map(n.map(c=>[c.name,c])).values()]}getBindGroups(){const e=[];function r(n,i){n>=e.length&&(e.length=n+1),e[n]===void 0&&(e[n]=[]),i>=e[n].length&&(e[n].length=i+1)}for(const n of this.uniforms)r(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.storage)r(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.textures)r(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.samplers)r(n.group,n.binding),e[n.group][n.binding]=n;return e}_getOutputs(e,r=void 0){if(r===void 0&&(r=[]),e instanceof nf)this._getStructOutputs(e,r);else{const n=this._getOutputInfo(e);n!==null&&r.push(n)}return r}_getStructOutputs(e,r){for(const n of e.members)if(n.type instanceof nf)this._getStructOutputs(n.type,r);else{const i=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(i!==null){const a=this.getTypeInfo(n.type,n.type.attributes),c=this._parseInt(i.value),s=new SO(n.name,a,i.name,c);r.push(s)}}}_getOutputInfo(e){const r=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(r!==null){const n=this.getTypeInfo(e,e.attributes),i=this._parseInt(r.value);return new SO("",n,r.name,i)}return null}_getInputs(e,r=void 0){r===void 0&&(r=[]);for(const n of e)if(n.type instanceof nf)this._getStructInputs(n.type,r);else{const i=this._getInputInfo(n);i!==null&&r.push(i)}return r}_getStructInputs(e,r){for(const n of e.members)if(n.type instanceof nf)this._getStructInputs(n.type,r);else{const i=this._getInputInfo(n);i!==null&&r.push(i)}}_getInputInfo(e){const r=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(r!==null){const n=this._getAttribute(e,"interpolation"),i=this.getTypeInfo(e.type,e.attributes),a=this._parseInt(r.value),c=new zie(e.name,i,r.name,a);return n!==null&&(c.interpolation=this._parseString(n.value)),c}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const r=parseInt(e);return isNaN(r)?e:r}_getAlias(e){for(const r of this.aliases)if(r.name==e)return r.type;return null}_getAliasInfo(e){return new Nie(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const r of this.structs)if(r.name==e)return r;for(const r of this.aliases)if(r.name==e)return r.type;return null}getTypeInfo(e,r=null){if(this._types.has(e))return this._types.get(e);if(e instanceof ux){const i=e.type?this.getTypeInfo(e.type,e.attributes):null,a=new dA(e.name,i,r);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof Iv){const i=e,a=i.format?this.getTypeInfo(i.format,i.attributes):null,c=new Bd(i.name,r);return c.format=a,c.count=i.count,this._types.set(e,c),this._updateTypeInfo(c),c}if(e instanceof nf){const i=e,a=new Rd(i.name,r);a.startLine=i.startLine,a.endLine=i.endLine;for(const c of i.members){const s=this.getTypeInfo(c.type,c.attributes);a.members.push(new TO(c.name,s,c.attributes))}return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof mv){const i=e,a=i.format instanceof Rt,c=i.format?a?this.getTypeInfo(i.format,null):new hc(i.format,null):null,s=new Mg(i.name,c,r,i.access);return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof Je){const i=e,a=i.format?this.getTypeInfo(i.format,null):null,c=new Mg(i.name,a,r,i.access);return this._types.set(e,c),this._updateTypeInfo(c),c}const n=new hc(e.name,r);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var r,n,i;const a=this._getTypeSize(e);if(e.size=(r=a?.size)!==null&&r!==void 0?r:0,e instanceof Bd&&e.format){const c=this._getTypeSize(e.format);e.stride=Math.max((n=c?.size)!==null&&n!==void 0?n:0,(i=c?.align)!==null&&i!==void 0?i:0),this._updateTypeInfo(e.format)}e instanceof dA&&this._updateTypeInfo(e.format),e instanceof Rd&&this._updateStructInfo(e)}_updateStructInfo(e){var r;let n=0,i=0,a=0,c=0;for(let s=0,g=e.members.length;s<g;++s){const _=e.members[s],v=this._getTypeSize(_);if(!v)continue;(r=this._getAlias(_.type.name))!==null&&r!==void 0||_.type;const T=v.align,M=v.size;n=this._roundUp(T,n+i),i=M,a=n,c=Math.max(c,T),_.offset=n,_.size=M,this._updateTypeInfo(_.type)}e.size=this._roundUp(c,a+i),e.align=c}_getTypeSize(e){var r,n;if(e==null)return null;const i=this._getAttributeNum(e.attributes,"size",0),a=this._getAttributeNum(e.attributes,"align",0);if(e instanceof TO&&(e=e.type),e instanceof hc){const c=this._getAlias(e.name);c!==null&&(e=c)}{const c=ih._typeInfo[e.name];if(c!==void 0){const s=((r=e.format)===null||r===void 0?void 0:r.name)==="f16"?2:1;return new Hb(Math.max(a,c.align/s),Math.max(i,c.size/s))}}{const c=ih._typeInfo[e.name.substring(0,e.name.length-1)];if(c){const s=e.name[e.name.length-1]==="h"?2:1;return new Hb(Math.max(a,c.align/s),Math.max(i,c.size/s))}}if(e instanceof Bd){let c=e,s=8,g=8;const _=this._getTypeSize(c.format);return _!==null&&(g=_.size,s=_.align),g=c.count*this._getAttributeNum((n=e?.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(s,g)),i&&(g=i),new Hb(Math.max(a,s),Math.max(i,g))}if(e instanceof Rd){let c=0,s=0,g=0,_=0,v=0;for(const T of e.members){const M=this._getTypeSize(T.type);M!==null&&(c=Math.max(M.align,c),g=this._roundUp(M.align,g+_),_=M.size,v=g)}return s=this._roundUp(c,v+_),new Hb(Math.max(a,c),Math.max(i,s))}return null}_isUniformVar(e){return e instanceof cf&&e.storage=="uniform"}_isStorageVar(e){return e instanceof cf&&e.storage=="storage"}_isTextureVar(e){return e instanceof cf&&e.type!==null&&ih._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof cf&&e.type!==null&&ih._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,r){const n=e;if(!n||!n.attributes)return null;const i=n.attributes;for(let a of i)if(a.name==r)return a;return null}_getAttributeNum(e,r,n){if(e===null)return n;for(let i of e)if(i.name==r){let a=i!==null&&i.value!==null?i.value:n;return a instanceof Array&&(a=a[0]),typeof a=="number"?a:typeof a=="string"?parseInt(a):n}return n}_roundUp(e,r){return Math.ceil(r/e)*e}}ih._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},ih._textureTypes=ve.any_texture_type.map(t=>t.name),ih._samplerTypes=ve.sampler_type.map(t=>t.name);let aC=0;class oC{constructor(e,r,n){this.id=aC++,this.name=e,this.value=r,this.node=n}clone(){return new oC(this.name,this.value,this.node)}}class lC{constructor(e){this.id=aC++,this.name=e.name,this.node=e}clone(){return new lC(this.node)}}class cC{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=aC++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var r;return this.variables.has(e)?(r=this.variables.get(e))!==null&&r!==void 0?r:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var r;return this.functions.has(e)?(r=this.functions.get(e))!==null&&r!==void 0?r:null:this.parent?this.parent.getFunction(e):null}createVariable(e,r,n){this.variables.set(e,new oC(e,r,n??null))}setVariable(e,r,n){const i=this.getVariable(e);i!==null?i.value=r:this.createVariable(e,r,n)}getVariableValue(e){var r;const n=this.getVariable(e);return(r=n?.value)!==null&&r!==void 0?r:null}clone(){return new cC(this)}}class ose{evalExpression(e,r){return null}getTypeInfo(e){return null}getVariableName(e,r){return""}}class lse{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,r){const n=this.exec.evalExpression(e.args[0],r);let i=!0;if(n instanceof Ae)return n.data.forEach(a=>{a||(i=!1)}),new Ge(i?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae){const i=n.data.some(a=>a);return new Ge(i?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,r){const n=this.exec.evalExpression(e.args[2],r);if(!(n instanceof Ge))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return n.value?this.exec.evalExpression(e.args[1],r):this.exec.evalExpression(e.args[0],r)}ArrayLength(e,r){let n=e.args[0];n instanceof hs&&(n=n.right);const i=this.exec.evalExpression(n,r);if(i instanceof Zi&&i.typeInfo.size===0){const a=i.typeInfo,c=i.buffer.byteLength/a.stride;return new Ge(c,this.getTypeInfo("u32"))}return new Ge(i.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae)return new Ae(n.data.map(a=>Math.abs(a)),n.typeInfo);const i=n;return new Ge(Math.abs(i.value),i.typeInfo)}Acos(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae)return new Ae(n.data.map(a=>Math.acos(a)),n.typeInfo);const i=n;return new Ge(Math.acos(i.value),n.typeInfo)}Acosh(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae)return new Ae(n.data.map(a=>Math.acosh(a)),n.typeInfo);const i=n;return new Ge(Math.acosh(i.value),n.typeInfo)}Asin(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae)return new Ae(n.data.map(a=>Math.asin(a)),n.typeInfo);const i=n;return new Ge(Math.asin(i.value),n.typeInfo)}Asinh(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae)return new Ae(n.data.map(a=>Math.asinh(a)),n.typeInfo);const i=n;return new Ge(Math.asinh(i.value),n.typeInfo)}Atan(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae)return new Ae(n.data.map(a=>Math.atan(a)),n.typeInfo);const i=n;return new Ge(Math.atan(i.value),n.typeInfo)}Atanh(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae)return new Ae(n.data.map(a=>Math.atanh(a)),n.typeInfo);const i=n;return new Ge(Math.atanh(i.value),n.typeInfo)}Atan2(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(n instanceof Ae&&i instanceof Ae)return new Ae(n.data.map((s,g)=>Math.atan2(s,i.data[g])),n.typeInfo);const a=n,c=i;return new Ge(Math.atan2(a.value,c.value),n.typeInfo)}Ceil(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae)return new Ae(n.data.map(a=>Math.ceil(a)),n.typeInfo);const i=n;return new Ge(Math.ceil(i.value),n.typeInfo)}_clamp(e,r,n){return Math.min(Math.max(e,r),n)}Clamp(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r),a=this.exec.evalExpression(e.args[2],r);if(n instanceof Ae&&i instanceof Ae&&a instanceof Ae)return new Ae(n.data.map((_,v)=>this._clamp(_,i.data[v],a.data[v])),n.typeInfo);const c=n,s=i,g=a;return new Ge(this._clamp(c.value,s.value,g.value),n.typeInfo)}Cos(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae)return new Ae(n.data.map(a=>Math.cos(a)),n.typeInfo);const i=n;return new Ge(Math.cos(i.value),n.typeInfo)}Cosh(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae)return new Ae(n.data.map(a=>Math.cosh(a)),n.typeInfo);const i=n;return new Ge(Math.cos(i.value),n.typeInfo)}CountLeadingZeros(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae)return new Ae(n.data.map(a=>Math.clz32(a)),n.typeInfo);const i=n;return new Ge(Math.clz32(i.value),n.typeInfo)}_countOneBits(e){let r=0;for(;e!==0;)1&e&&r++,e>>=1;return r}CountOneBits(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae)return new Ae(n.data.map(a=>this._countOneBits(a)),n.typeInfo);const i=n;return new Ge(this._countOneBits(i.value),n.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let r=0;for(;!(1&e);)e>>=1,r++;return r}CountTrailingZeros(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae)return new Ae(n.data.map(a=>this._countTrailingZeros(a)),n.typeInfo);const i=n;return new Ge(this._countTrailingZeros(i.value),n.typeInfo)}Cross(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(n instanceof Ae&&i instanceof Ae){if(n.data.length!==3||i.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const a=n.data,c=i.data;return new Ae([a[1]*c[2]-c[1]*a[2],a[2]*c[0]-c[2]*a[0],a[0]*c[1]-c[0]*a[1]],n.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,r){const n=this.exec.evalExpression(e.args[0],r),i=180/Math.PI;return n instanceof Ae?new Ae(n.data.map(a=>a*i),n.typeInfo):new Ge(n.value*i,this.getTypeInfo("f32"))}Determinant(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Sr){const i=n.data,a=n.typeInfo.getTypeName(),c=a.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(a==="mat2x2"||a==="mat2x2f"||a==="mat2x2h")return new Ge(i[0]*i[3]-i[1]*i[2],c);if(a==="mat2x3"||a==="mat2x3f"||a==="mat2x3h")return new Ge(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),c);if(a==="mat2x4"||a==="mat2x4f"||a==="mat2x4h")console.error(`TODO: Determinant for ${a}`);else if(a==="mat3x2"||a==="mat3x2f"||a==="mat3x2h")console.error(`TODO: Determinant for ${a}`);else{if(a==="mat3x3"||a==="mat3x3f"||a==="mat3x3h")return new Ge(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),c);a==="mat3x4"||a==="mat3x4f"||a==="mat3x4h"||a==="mat4x2"||a==="mat4x2f"||a==="mat4x2h"||a==="mat4x3"||a==="mat4x3f"||a==="mat4x3h"?console.error(`TODO: Determinant for ${a}`):a!=="mat4x4"&&a!=="mat4x4f"&&a!=="mat4x4h"||console.error(`TODO: Determinant for ${a}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(n instanceof Ae&&i instanceof Ae){let s=0;for(let g=0;g<n.data.length;++g)s+=(n.data[g]-i.data[g])*(n.data[g]-i.data[g]);return new Ge(Math.sqrt(s),this.getTypeInfo("f32"))}const a=n,c=i;return new Ge(Math.abs(a.value-c.value),n.typeInfo)}_dot(e,r){let n=0;for(let i=0;i<e.length;++i)n+=r[i]*e[i];return n}Dot(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);return n instanceof Ae&&i instanceof Ae?new Ge(this._dot(n.data,i.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,r){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,r){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae)return new Ae(n.data.map(a=>Math.exp(a)),n.typeInfo);const i=n;return new Ge(Math.exp(i.value),n.typeInfo)}Exp2(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae)return new Ae(n.data.map(a=>Math.pow(2,a)),n.typeInfo);const i=n;return new Ge(Math.pow(2,i.value),n.typeInfo)}ExtractBits(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r),a=this.exec.evalExpression(e.args[2],r);if(i.typeInfo.name!=="u32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(a.typeInfo.name!=="u32"&&a.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const c=i.value,s=a.value;if(n instanceof Ae)return new Ae(n.data.map(_=>_>>c&(1<<s)-1),n.typeInfo);if(n.typeInfo.name!=="i32"&&n.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const g=n.value;return new Ge(g>>c&(1<<s)-1,this.getTypeInfo("i32"))}FaceForward(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r),a=this.exec.evalExpression(e.args[2],r);if(n instanceof Ae&&i instanceof Ae&&a instanceof Ae){const c=this._dot(i.data,a.data);return new Ae(c<0?Array.from(n.data):n.data.map(s=>-s),n.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae)return new Ae(n.data.map(a=>this._firstLeadingBit(a)),n.typeInfo);const i=n;return new Ge(this._firstLeadingBit(i.value),n.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae)return new Ae(n.data.map(a=>this._firstTrailingBit(a)),n.typeInfo);const i=n;return new Ge(this._firstTrailingBit(i.value),n.typeInfo)}Floor(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae)return new Ae(n.data.map(a=>Math.floor(a)),n.typeInfo);const i=n;return new Ge(Math.floor(i.value),n.typeInfo)}Fma(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r),a=this.exec.evalExpression(e.args[2],r);if(n instanceof Ae&&i instanceof Ae&&a instanceof Ae)return n.data.length!==i.data.length||n.data.length!==a.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new Ae(n.data.map((_,v)=>_*i.data[v]+a.data[v]),n.typeInfo);const c=n,s=i,g=a;return new Ge(c.value*s.value+g.value,c.typeInfo)}Fract(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae)return new Ae(n.data.map(a=>a-Math.floor(a)),n.typeInfo);const i=n;return new Ge(i.value-Math.floor(i.value),n.typeInfo)}Frexp(e,r){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r),a=this.exec.evalExpression(e.args[2],r),c=this.exec.evalExpression(e.args[3],r);if(a.typeInfo.name!=="u32"&&a.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const s=a.value,g=(1<<c.value)-1<<s,_=~g;if(n instanceof Ae&&i instanceof Ae)return new Ae(n.data.map((M,O)=>M&_|i.data[O]<<s&g),n.typeInfo);const v=n.value,T=i.value;return new Ge(v&_|T<<s&g,n.typeInfo)}InverseSqrt(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae)return new Ae(n.data.map(a=>1/Math.sqrt(a)),n.typeInfo);const i=n;return new Ge(1/Math.sqrt(i.value),n.typeInfo)}Ldexp(e,r){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae){let a=0;return n.data.forEach(c=>{a+=c*c}),new Ge(Math.sqrt(a),this.getTypeInfo("f32"))}const i=n;return new Ge(Math.abs(i.value),n.typeInfo)}Log(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae)return new Ae(n.data.map(a=>Math.log(a)),n.typeInfo);const i=n;return new Ge(Math.log(i.value),n.typeInfo)}Log2(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae)return new Ae(n.data.map(a=>Math.log2(a)),n.typeInfo);const i=n;return new Ge(Math.log2(i.value),n.typeInfo)}Max(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(n instanceof Ae&&i instanceof Ae)return new Ae(n.data.map((s,g)=>Math.max(s,i.data[g])),n.typeInfo);const a=n,c=i;return new Ge(Math.max(a.value,c.value),n.typeInfo)}Min(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(n instanceof Ae&&i instanceof Ae)return new Ae(n.data.map((s,g)=>Math.min(s,i.data[g])),n.typeInfo);const a=n,c=i;return new Ge(Math.min(a.value,c.value),n.typeInfo)}Mix(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r),a=this.exec.evalExpression(e.args[2],r);if(n instanceof Ae&&i instanceof Ae&&a instanceof Ae)return new Ae(n.data.map((g,_)=>n.data[_]*(1-a.data[_])+i.data[_]*a.data[_]),n.typeInfo);const c=i,s=a;return new Ge(n.value*(1-s.value)+c.value*s.value,n.typeInfo)}Modf(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(n instanceof Ae&&i instanceof Ae)return new Ae(n.data.map((c,s)=>c%i.data[s]),n.typeInfo);const a=i;return new Ge(n.value%a.value,n.typeInfo)}Normalize(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae){const i=this.Length(e,r).value;return new Ae(n.data.map(a=>a/i),n.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(n instanceof Ae&&i instanceof Ae)return new Ae(n.data.map((s,g)=>Math.pow(s,i.data[g])),n.typeInfo);const a=n,c=i;return new Ge(Math.pow(a.value,c.value),n.typeInfo)}QuantizeToF16(e,r){const n=this.exec.evalExpression(e.args[0],r);return n instanceof Ae?new Ae(n.data.map(i=>i),n.typeInfo):new Ge(n.value,n.typeInfo)}Radians(e,r){const n=this.exec.evalExpression(e.args[0],r);return n instanceof Ae?new Ae(n.data.map(i=>i*Math.PI/180),n.typeInfo):new Ge(n.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,r){let n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(n instanceof Ae&&i instanceof Ae){const a=this._dot(n.data,i.data);return new Ae(n.data.map((c,s)=>c-2*a*i.data[s]),n.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,r){let n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r),a=this.exec.evalExpression(e.args[2],r);if(n instanceof Ae&&i instanceof Ae&&a instanceof Ge){const c=this._dot(i.data,n.data);return new Ae(n.data.map((s,g)=>{const _=1-a.value*a.value*(1-c*c);if(_<0)return 0;const v=Math.sqrt(_);return a.value*s-(a.value*c+v)*i.data[g]}),n.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,r){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae)return new Ae(n.data.map(a=>Math.round(a)),n.typeInfo);const i=n;return new Ge(Math.round(i.value),n.typeInfo)}Saturate(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae)return new Ae(n.data.map(a=>Math.min(Math.max(a,0),1)),n.typeInfo);const i=n;return new Ge(Math.min(Math.max(i.value,0),1),n.typeInfo)}Sign(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae)return new Ae(n.data.map(a=>Math.sign(a)),n.typeInfo);const i=n;return new Ge(Math.sign(i.value),n.typeInfo)}Sin(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae)return new Ae(n.data.map(a=>Math.sin(a)),n.typeInfo);const i=n;return new Ge(Math.sin(i.value),n.typeInfo)}Sinh(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae)return new Ae(n.data.map(a=>Math.sinh(a)),n.typeInfo);const i=n;return new Ge(Math.sinh(i.value),n.typeInfo)}_smoothstep(e,r,n){const i=Math.min(Math.max((n-e)/(r-e),0),1);return i*i*(3-2*i)}SmoothStep(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r),a=this.exec.evalExpression(e.args[2],r);if(a instanceof Ae&&n instanceof Ae&&i instanceof Ae)return new Ae(a.data.map((_,v)=>this._smoothstep(n.data[v],i.data[v],_)),a.typeInfo);const c=n,s=i,g=a;return new Ge(this._smoothstep(c.value,s.value,g.value),a.typeInfo)}Sqrt(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae)return new Ae(n.data.map(a=>Math.sqrt(a)),n.typeInfo);const i=n;return new Ge(Math.sqrt(i.value),n.typeInfo)}Step(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(i instanceof Ae&&n instanceof Ae)return new Ae(i.data.map((c,s)=>c<n.data[s]?0:1),i.typeInfo);const a=n;return new Ge(i.value<a.value?0:1,a.typeInfo)}Tan(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae)return new Ae(n.data.map(a=>Math.tan(a)),n.typeInfo);const i=n;return new Ge(Math.tan(i.value),n.typeInfo)}Tanh(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae)return new Ae(n.data.map(a=>Math.tanh(a)),n.typeInfo);const i=n;return new Ge(Math.tanh(i.value),n.typeInfo)}_getTransposeType(e){const r=e.getTypeName();return r==="mat2x2f"||r==="mat2x2h"?e:r==="mat2x3f"?this.getTypeInfo("mat3x2f"):r==="mat2x3h"?this.getTypeInfo("mat3x2h"):r==="mat2x4f"?this.getTypeInfo("mat4x2f"):r==="mat2x4h"?this.getTypeInfo("mat4x2h"):r==="mat3x2f"?this.getTypeInfo("mat2x3f"):r==="mat3x2h"?this.getTypeInfo("mat2x3h"):r==="mat3x3f"||r==="mat3x3h"?e:r==="mat3x4f"?this.getTypeInfo("mat4x3f"):r==="mat3x4h"?this.getTypeInfo("mat4x3h"):r==="mat4x2f"?this.getTypeInfo("mat2x4f"):r==="mat4x2h"?this.getTypeInfo("mat2x4h"):r==="mat4x3f"?this.getTypeInfo("mat3x4f"):r==="mat4x3h"?this.getTypeInfo("mat3x4h"):(r==="mat4x4f"||r==="mat4x4h"||console.error(`Invalid matrix type ${r}`),e)}Transpose(e,r){const n=this.exec.evalExpression(e.args[0],r);if(!(n instanceof Sr))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const i=this._getTransposeType(n.typeInfo);if(n.typeInfo.name==="mat2x2"||n.typeInfo.name==="mat2x2f"||n.typeInfo.name==="mat2x2h"){const a=n.data;return new Sr([a[0],a[2],a[1],a[3]],i)}if(n.typeInfo.name==="mat2x3"||n.typeInfo.name==="mat2x3f"||n.typeInfo.name==="mat2x3h"){const a=n.data;return new Sr([a[0],a[3],a[6],a[1],a[4],a[7]],i)}if(n.typeInfo.name==="mat2x4"||n.typeInfo.name==="mat2x4f"||n.typeInfo.name==="mat2x4h"){const a=n.data;return new Sr([a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13]],i)}if(n.typeInfo.name==="mat3x2"||n.typeInfo.name==="mat3x2f"||n.typeInfo.name==="mat3x2h"){const a=n.data;return new Sr([a[0],a[3],a[1],a[4],a[2],a[5]],i)}if(n.typeInfo.name==="mat3x3"||n.typeInfo.name==="mat3x3f"||n.typeInfo.name==="mat3x3h"){const a=n.data;return new Sr([a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]],i)}if(n.typeInfo.name==="mat3x4"||n.typeInfo.name==="mat3x4f"||n.typeInfo.name==="mat3x4h"){const a=n.data;return new Sr([a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14]],i)}if(n.typeInfo.name==="mat4x2"||n.typeInfo.name==="mat4x2f"||n.typeInfo.name==="mat4x2h"){const a=n.data;return new Sr([a[0],a[4],a[1],a[5],a[2],a[6]],i)}if(n.typeInfo.name==="mat4x3"||n.typeInfo.name==="mat4x3f"||n.typeInfo.name==="mat4x3h"){const a=n.data;return new Sr([a[0],a[4],a[8],a[1],a[5],a[9],a[2],a[6],a[10]],i)}if(n.typeInfo.name==="mat4x4"||n.typeInfo.name==="mat4x4f"||n.typeInfo.name==="mat4x4h"){const a=n.data;return new Sr([a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]],i)}return console.error(`Invalid matrix type ${n.typeInfo.name}`),null}Trunc(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Ae)return new Ae(n.data.map(a=>Math.trunc(a)),n.typeInfo);const i=n;return new Ge(Math.trunc(i.value),n.typeInfo)}Dpdx(e,r){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,r){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,r){return console.error("TODO: dpdxFine"),null}Dpdy(e,r){return console.error("TODO: dpdy"),null}DpdyCoarse(e,r){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,r){return console.error("TODO: dpdyFine"),null}Fwidth(e,r){return console.error("TODO: fwidth"),null}FwidthCoarse(e,r){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,r){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,r){const n=e.args[0],i=e.args.length>1?this.exec.evalExpression(e.args[1],r).value:0;if(n instanceof pl){const a=n.name,c=r.getVariableValue(a);if(c instanceof sf){if(i<0||i>=c.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const s=c.getMipLevelSize(i),g=c.dimension;return g==="1d"?new Ge(s[0],this.getTypeInfo("u32")):g==="3d"?new Ae(s,this.getTypeInfo("vec3u")):g==="2d"?new Ae(s.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${g} not found. Line ${e.line}`),null)}return console.error(`Texture ${a} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,r){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,r){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,r){const n=e.args[0],i=this.exec.evalExpression(e.args[1],r),a=e.args.length>2?this.exec.evalExpression(e.args[2],r).value:0;if(!(i instanceof Ae)||i.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(n instanceof pl){const c=n.name,s=r.getVariableValue(c);if(s instanceof sf){const g=Math.floor(i.data[0]),_=Math.floor(i.data[1]);if(g<0||g>=s.width||_<0||_>=s.height)return console.error(`Texture ${c} out of bounds. Line ${e.line}`),null;const v=s.getPixel(g,_,0,a);return v===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new Ae(v,this.getTypeInfo("vec4f"))}return console.error(`Texture ${c} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,r){const n=e.args[0];if(n instanceof pl){const i=n.name,a=r.getVariableValue(i);return a instanceof sf?new Ge(a.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,r){const n=e.args[0];if(n instanceof pl){const i=n.name,a=r.getVariableValue(i);return a instanceof sf?new Ge(a.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,r){const n=e.args[0];if(n instanceof pl){const i=n.name,a=r.getVariableValue(i);return a instanceof sf?new Ge(a.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,r){return console.error("TODO: textureSample"),null}TextureSampleBias(e,r){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,r){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,r){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,r){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,r){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,r){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,r){const n=e.args[0],i=this.exec.evalExpression(e.args[1],r),a=e.args.length===4?this.exec.evalExpression(e.args[2],r).value:0,c=e.args.length===4?this.exec.evalExpression(e.args[3],r).data:this.exec.evalExpression(e.args[2],r).data;if(c.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(i instanceof Ae)||i.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(n instanceof pl){const s=n.name,g=r.getVariableValue(s);if(g instanceof sf){const _=g.getMipLevelSize(0),v=Math.floor(i.data[0]),T=Math.floor(i.data[1]);return v<0||v>=_[0]||T<0||T>=_[1]?(console.error(`Texture ${s} out of bounds. Line ${e.line}`),null):(g.setPixel(v,T,0,a,Array.from(c)),null)}return console.error(`Texture ${s} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,r){let n=e.args[0];n instanceof hs&&(n=n.right);const i=this.exec.getVariableName(n,r);return r.getVariable(i).value.getSubData(this.exec,n.postfix,r)}AtomicStore(e,r){let n=e.args[0];n instanceof hs&&(n=n.right);const i=this.exec.getVariableName(n,r),a=r.getVariable(i);let c=e.args[1];const s=this.exec.evalExpression(c,r),g=a.value.getSubData(this.exec,n.postfix,r);return g instanceof Ge&&s instanceof Ge&&(g.value=s.value),a.value instanceof Zi&&a.value.setDataValue(this.exec,g,n.postfix,r),null}AtomicAdd(e,r){let n=e.args[0];n instanceof hs&&(n=n.right);const i=this.exec.getVariableName(n,r),a=r.getVariable(i);let c=e.args[1];const s=this.exec.evalExpression(c,r),g=a.value.getSubData(this.exec,n.postfix,r),_=new Ge(g.value,g.typeInfo);return g instanceof Ge&&s instanceof Ge&&(g.value+=s.value),a.value instanceof Zi&&a.value.setDataValue(this.exec,g,n.postfix,r),_}AtomicSub(e,r){let n=e.args[0];n instanceof hs&&(n=n.right);const i=this.exec.getVariableName(n,r),a=r.getVariable(i);let c=e.args[1];const s=this.exec.evalExpression(c,r),g=a.value.getSubData(this.exec,n.postfix,r),_=new Ge(g.value,g.typeInfo);return g instanceof Ge&&s instanceof Ge&&(g.value-=s.value),a.value instanceof Zi&&a.value.setDataValue(this.exec,g,n.postfix,r),_}AtomicMax(e,r){let n=e.args[0];n instanceof hs&&(n=n.right);const i=this.exec.getVariableName(n,r),a=r.getVariable(i);let c=e.args[1];const s=this.exec.evalExpression(c,r),g=a.value.getSubData(this.exec,n.postfix,r),_=new Ge(g.value,g.typeInfo);return g instanceof Ge&&s instanceof Ge&&(g.value=Math.max(g.value,s.value)),a.value instanceof Zi&&a.value.setDataValue(this.exec,g,n.postfix,r),_}AtomicMin(e,r){let n=e.args[0];n instanceof hs&&(n=n.right);const i=this.exec.getVariableName(n,r),a=r.getVariable(i);let c=e.args[1];const s=this.exec.evalExpression(c,r),g=a.value.getSubData(this.exec,n.postfix,r),_=new Ge(g.value,g.typeInfo);return g instanceof Ge&&s instanceof Ge&&(g.value=Math.min(g.value,s.value)),a.value instanceof Zi&&a.value.setDataValue(this.exec,g,n.postfix,r),_}AtomicAnd(e,r){let n=e.args[0];n instanceof hs&&(n=n.right);const i=this.exec.getVariableName(n,r),a=r.getVariable(i);let c=e.args[1];const s=this.exec.evalExpression(c,r),g=a.value.getSubData(this.exec,n.postfix,r),_=new Ge(g.value,g.typeInfo);return g instanceof Ge&&s instanceof Ge&&(g.value=g.value&s.value),a.value instanceof Zi&&a.value.setDataValue(this.exec,g,n.postfix,r),_}AtomicOr(e,r){let n=e.args[0];n instanceof hs&&(n=n.right);const i=this.exec.getVariableName(n,r),a=r.getVariable(i);let c=e.args[1];const s=this.exec.evalExpression(c,r),g=a.value.getSubData(this.exec,n.postfix,r),_=new Ge(g.value,g.typeInfo);return g instanceof Ge&&s instanceof Ge&&(g.value=g.value|s.value),a.value instanceof Zi&&a.value.setDataValue(this.exec,g,n.postfix,r),_}AtomicXor(e,r){let n=e.args[0];n instanceof hs&&(n=n.right);const i=this.exec.getVariableName(n,r),a=r.getVariable(i);let c=e.args[1];const s=this.exec.evalExpression(c,r),g=a.value.getSubData(this.exec,n.postfix,r),_=new Ge(g.value,g.typeInfo);return g instanceof Ge&&s instanceof Ge&&(g.value=g.value^s.value),a.value instanceof Zi&&a.value.setDataValue(this.exec,g,n.postfix,r),_}AtomicExchange(e,r){let n=e.args[0];n instanceof hs&&(n=n.right);const i=this.exec.getVariableName(n,r),a=r.getVariable(i);let c=e.args[1];const s=this.exec.evalExpression(c,r),g=a.value.getSubData(this.exec,n.postfix,r),_=new Ge(g.value,g.typeInfo);return g instanceof Ge&&s instanceof Ge&&(g.value=s.value),a.value instanceof Zi&&a.value.setDataValue(this.exec,g,n.postfix,r),_}AtomicCompareExchangeWeak(e,r){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,r){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,r){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,r){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,r){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,r){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,r){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,r){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,r){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,r){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,r){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,r){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,r){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,r){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,r){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,r){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,r){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,r){return null}TextureBarrier(e,r){return null}WorkgroupBarrier(e,r){return null}WorkgroupUniformLoad(e,r){return null}SubgroupAdd(e,r){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,r){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,r){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,r){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,r){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,r){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,r){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,r){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,r){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,r){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,r){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,r){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,r){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,r){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,r){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,r){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,r){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,r){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,r){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,r){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,r){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,r){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,r){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,r){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,r){return console.error("TODO: quadSwapY"),null}}const NT={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},Wa={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class Ra extends ose{constructor(e,r){var n;super(),this.ast=e??[],this.reflection=new ih,this.reflection.updateAST(this.ast),this.context=(n=r?.clone())!==null&&n!==void 0?n:new cC,this.builtins=new lse(this),this.typeInfo={bool:this.getTypeInfo(Rt.bool),i32:this.getTypeInfo(Rt.i32),u32:this.getTypeInfo(Rt.u32),f32:this.getTypeInfo(Rt.f32),f16:this.getTypeInfo(Rt.f16),vec2f:this.getTypeInfo(Je.vec2f),vec2u:this.getTypeInfo(Je.vec2u),vec2i:this.getTypeInfo(Je.vec2i),vec2h:this.getTypeInfo(Je.vec2h),vec3f:this.getTypeInfo(Je.vec3f),vec3u:this.getTypeInfo(Je.vec3u),vec3i:this.getTypeInfo(Je.vec3i),vec3h:this.getTypeInfo(Je.vec3h),vec4f:this.getTypeInfo(Je.vec4f),vec4u:this.getTypeInfo(Je.vec4u),vec4i:this.getTypeInfo(Je.vec4i),vec4h:this.getTypeInfo(Je.vec4h),mat2x2f:this.getTypeInfo(Je.mat2x2f),mat2x3f:this.getTypeInfo(Je.mat2x3f),mat2x4f:this.getTypeInfo(Je.mat2x4f),mat3x2f:this.getTypeInfo(Je.mat3x2f),mat3x3f:this.getTypeInfo(Je.mat3x3f),mat3x4f:this.getTypeInfo(Je.mat3x4f),mat4x2f:this.getTypeInfo(Je.mat4x2f),mat4x3f:this.getTypeInfo(Je.mat4x3f),mat4x4f:this.getTypeInfo(Je.mat4x4f)}}getVariableValue(e){var r,n;const i=(n=(r=this.context.getVariable(e))===null||r===void 0?void 0:r.value)!==null&&n!==void 0?n:null;if(i===null)return null;if(i instanceof Ge)return i.value;if(i instanceof Ae||i instanceof Sr)return Array.from(i.data);if(i instanceof Zi&&i.typeInfo instanceof Bd){if(i.typeInfo.format.name==="u32")return Array.from(new Uint32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="i32")return Array.from(new Int32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="f32")return Array.from(new Float32Array(i.buffer,i.offset,i.typeInfo.count))}return console.error(`Unsupported return variable type ${i.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,r,n,i){const a=this.context.clone();(i=i??{}).constants&&this._setOverrides(i.constants,a),this._execStatements(this.ast,a);const c=a.getFunction(e);if(!c)return void console.error(`Function ${e} not found`);if(typeof r=="number")r=[r,1,1];else{if(r.length===0)return void console.error("Invalid dispatch count");r.length===1?r=[r[0],1,1]:r.length===2?r=[r[0],r[1],1]:r.length>3&&(r=[r[0],r[1],r[2]])}const s=r[0],g=r[1],_=r[2],v=this.getTypeInfo("vec3u");a.setVariable("@num_workgroups",new Ae(r,v));const T=this.reflection.getFunctionInfo(e);T===null&&console.error(`Function ${e} not found in reflection data`);for(const M in n)for(const O in n[M]){const F=n[M][O];a.variables.forEach(j=>{var V;const q=j.node;if(q?.attributes){let Y=null,X=null;for(const ae of q.attributes)ae.name==="binding"?Y=ae.value:ae.name==="group"&&(X=ae.value);if(O==Y&&M==X){let ae=!1;for(const ue of T.resources)if(ue.name===j.name&&ue.group===parseInt(M)&&ue.binding===parseInt(O)){ae=!0;break}if(ae)if(F.texture!==void 0&&F.descriptor!==void 0){const ue=new sf(F.texture,this.getTypeInfo(q.type),F.descriptor,(V=F.texture.view)!==null&&V!==void 0?V:null);j.value=ue}else F.uniform!==void 0?j.value=new Zi(F.uniform,this.getTypeInfo(q.type)):j.value=new Zi(F,this.getTypeInfo(q.type))}}})}for(let M=0;M<_;++M)for(let O=0;O<g;++O)for(let F=0;F<s;++F)a.setVariable("@workgroup_id",new Ae([F,O,M],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(c,[F,O,M],a)}execStatement(e,r){if(e instanceof zz)return this.evalExpression(e.value,r);if(e instanceof Uz){if(e.condition){const n=this.evalExpression(e.condition,r);if(!(n instanceof Ge))throw new Error("Invalid break-if condition");if(!n.value)return null}return Ra._breakObj}if(e instanceof jz)return Ra._continueObj;if(e instanceof Mv)this._let(e,r);else if(e instanceof cf)this._var(e,r);else if(e instanceof cx)this._const(e,r);else if(e instanceof Xv)this._function(e,r);else{if(e instanceof Nz)return this._if(e,r);if(e instanceof Bz)return this._switch(e,r);if(e instanceof Oz)return this._for(e,r);if(e instanceof Rz)return this._while(e,r);if(e instanceof Lz)return this._loop(e,r);if(e instanceof pA){const n=r.clone();return n.currentFunctionName=r.currentFunctionName,this._execStatements(e.body,n)}if(e instanceof Dz)this._assign(e,r);else if(e instanceof kz)this._increment(e,r);else{if(e instanceof nf)return null;if(e instanceof rC){const n=e.name;r.getVariable(n)===null&&r.setVariable(n,new Ge(0,this.getTypeInfo("u32")))}else if(e instanceof nC)this._call(e,r);else{if(e instanceof Fz||e instanceof iC)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,r){return e instanceof ru?this._evalBinaryOp(e,r):e instanceof As?this._evalLiteral(e,r):e instanceof pl?this._evalVariable(e,r):e instanceof sC?this._evalCall(e,r):e instanceof eh?this._evalCreate(e,r):e instanceof Vz?this._evalConst(e,r):e instanceof $z?this._evalBitcast(e,r):e instanceof hs?this._evalUnaryOp(e,r):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var r;if(e instanceof Rt){const i=this.reflection.getTypeInfo(e);if(i!==null)return i}let n=(r=this.typeInfo[e])!==null&&r!==void 0?r:null;return n!==null||(n=this.reflection.getTypeInfoByName(e)),n}_setOverrides(e,r){for(const n in e){const i=e[n],a=this.reflection.getOverrideInfo(n);a!==null?(a.type===null&&(a.type=this.getTypeInfo("u32")),a.type.name==="u32"||a.type.name==="i32"||a.type.name==="f32"||a.type.name==="f16"?r.setVariable(n,new Ge(i,a.type)):a.type.name==="bool"?r.setVariable(n,new Ge(i?1:0,a.type)):a.type.name==="vec2"||a.type.name==="vec3"||a.type.name==="vec4"||a.type.name==="vec2f"||a.type.name==="vec3f"||a.type.name==="vec4f"||a.type.name==="vec2i"||a.type.name==="vec3i"||a.type.name==="vec4i"||a.type.name==="vec2u"||a.type.name==="vec3u"||a.type.name==="vec4u"||a.type.name==="vec2h"||a.type.name==="vec3h"||a.type.name==="vec4h"?r.setVariable(n,new Ae(i,a.type)):console.error(`Invalid constant type for ${n}`)):console.error(`Override ${n} does not exist in the shader.`)}}_dispatchWorkgroup(e,r,n){const i=[1,1,1];for(const v of e.node.attributes)if(v.name==="workgroup_size"){if(v.value.length>0){const T=n.getVariableValue(v.value[0]);i[0]=T instanceof Ge?T.value:parseInt(v.value[0])}if(v.value.length>1){const T=n.getVariableValue(v.value[1]);i[1]=T instanceof Ge?T.value:parseInt(v.value[1])}if(v.value.length>2){const T=n.getVariableValue(v.value[2]);i[2]=T instanceof Ge?T.value:parseInt(v.value[2])}}const a=this.getTypeInfo("vec3u"),c=this.getTypeInfo("u32");n.setVariable("@workgroup_size",new Ae(i,a));const s=i[0],g=i[1],_=i[2];for(let v=0,T=0;v<_;++v)for(let M=0;M<g;++M)for(let O=0;O<s;++O,++T){const F=[O,M,v],j=[O+r[0]*i[0],M+r[1]*i[1],v+r[2]*i[2]];n.setVariable("@local_invocation_id",new Ae(F,a)),n.setVariable("@global_invocation_id",new Ae(j,a)),n.setVariable("@local_invocation_index",new Ge(T,c)),this._dispatchExec(e,n)}}_dispatchExec(e,r){for(const n of e.node.args)for(const i of n.attributes)if(i.name==="builtin"){const a=`@${i.value}`,c=r.getVariable(a);c!==void 0&&r.variables.set(n.name,c)}this._execStatements(e.node.body,r)}getVariableName(e,r){for(;e instanceof hs;)e=e.right;return e instanceof pl?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,r){for(const n of e){if(n instanceof Array){const a=r.clone(),c=this._execStatements(n,a);if(c)return c;continue}const i=this.execStatement(n,r);if(i)return i}return null}_call(e,r){const n=r.clone();n.currentFunctionName=e.name;const i=r.getFunction(e.name);if(i){for(let a=0;a<i.node.args.length;++a){const c=i.node.args[a],s=this.evalExpression(e.args[a],n);n.setVariable(c.name,s,c)}this._execStatements(i.node.body,n)}else e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)&&this._evalCreate(e,r)}_increment(e,r){const n=this.getVariableName(e.variable,r),i=r.getVariable(n);i?e.operator==="++"?i.value instanceof Ge?i.value.value++:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):e.operator==="--"?i.value instanceof Ge?i.value.value--:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${n} not found. Line ${e.line}`)}_getVariableData(e,r){if(e instanceof pl){const n=this.getVariableName(e,r),i=r.getVariable(n);return i===null?(console.error(`Variable ${n} not found. Line ${e.line}`),null):i.value.getSubData(this,e.postfix,r)}if(e instanceof hs){if(e.operator==="*"){const n=this._getVariableData(e.right,r);return n instanceof Xm?n.reference.getSubData(this,e.postfix,r):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const n=this._getVariableData(e.right,r);return new Xm(n)}}return null}_assign(e,r){let n=null,i="<var>",a=null;if(e.variable instanceof hs){const g=this._getVariableData(e.variable,r),_=this.evalExpression(e.value,r),v=e.operator;if(v==="="){if(g instanceof Ge||g instanceof Ae||g instanceof Sr){if(_ instanceof Ge||_ instanceof Ae||_ instanceof Sr&&g.data.length===_.data.length)return void g.data.set(_.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(g instanceof Zi&&_ instanceof Zi&&g.buffer.byteLength-g.offset>=_.buffer.byteLength-_.offset)return void(g.buffer.byteLength%4==0?new Uint32Array(g.buffer,g.offset,g.typeInfo.size/4).set(new Uint32Array(_.buffer,_.offset,_.typeInfo.size/4)):new Uint8Array(g.buffer,g.offset,g.typeInfo.size).set(new Uint8Array(_.buffer,_.offset,_.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(v==="+=")return g instanceof Ge||g instanceof Ae||g instanceof Sr?_ instanceof Ge||_ instanceof Ae||_ instanceof Sr?void g.data.set(_.data.map((T,M)=>g.data[M]+T)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(v==="-=")return(g instanceof Ge||g instanceof Ae||g instanceof Sr)&&(_ instanceof Ge||_ instanceof Ae||_ instanceof Sr)?void g.data.set(_.data.map((T,M)=>g.data[M]-T)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof hs){if(e.variable.operator==="*"){i=this.getVariableName(e.variable.right,r);const g=r.getVariable(i);if(!(g&&g.value instanceof Xm))return void console.error(`Variable ${i} is not a pointer. Line ${e.line}`);n=g.value.reference;let _=e.variable.postfix;if(!_){let v=e.variable.right;for(;v instanceof hs;){if(v.postfix){_=v.postfix;break}v=v.right}}_&&(n=n.getSubData(this,_,r))}}else{a=e.variable.postfix,i=this.getVariableName(e.variable,r);const g=r.getVariable(i);if(g===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);n=g.value}if(n instanceof Xm&&(n=n.reference),n===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);const c=this.evalExpression(e.value,r),s=e.operator;if(s!=="="){const g=n.getSubData(this,a,r);if(g instanceof Ae&&c instanceof Ge){const _=g.data,v=c.value;if(s==="+=")for(let T=0;T<_.length;++T)_[T]+=v;else if(s==="-=")for(let T=0;T<_.length;++T)_[T]-=v;else if(s==="*=")for(let T=0;T<_.length;++T)_[T]*=v;else if(s==="/=")for(let T=0;T<_.length;++T)_[T]/=v;else if(s==="%=")for(let T=0;T<_.length;++T)_[T]%=v;else if(s==="&=")for(let T=0;T<_.length;++T)_[T]&=v;else if(s==="|=")for(let T=0;T<_.length;++T)_[T]|=v;else if(s==="^=")for(let T=0;T<_.length;++T)_[T]^=v;else if(s==="<<=")for(let T=0;T<_.length;++T)_[T]<<=v;else if(s===">>=")for(let T=0;T<_.length;++T)_[T]>>=v;else console.error(`Invalid operator ${s}. Line ${e.line}`)}else if(g instanceof Ae&&c instanceof Ae){const _=g.data,v=c.data;if(_.length!==v.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(s==="+=")for(let T=0;T<_.length;++T)_[T]+=v[T];else if(s==="-=")for(let T=0;T<_.length;++T)_[T]-=v[T];else if(s==="*=")for(let T=0;T<_.length;++T)_[T]*=v[T];else if(s==="/=")for(let T=0;T<_.length;++T)_[T]/=v[T];else if(s==="%=")for(let T=0;T<_.length;++T)_[T]%=v[T];else if(s==="&=")for(let T=0;T<_.length;++T)_[T]&=v[T];else if(s==="|=")for(let T=0;T<_.length;++T)_[T]|=v[T];else if(s==="^=")for(let T=0;T<_.length;++T)_[T]^=v[T];else if(s==="<<=")for(let T=0;T<_.length;++T)_[T]<<=v[T];else if(s===">>=")for(let T=0;T<_.length;++T)_[T]>>=v[T];else console.error(`Invalid operator ${s}. Line ${e.line}`)}else{if(!(g instanceof Ge&&c instanceof Ge))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);s==="+="?g.value+=c.value:s==="-="?g.value-=c.value:s==="*="?g.value*=c.value:s==="/="?g.value/=c.value:s==="%="?g.value%=c.value:s==="&="?g.value&=c.value:s==="|="?g.value|=c.value:s==="^="?g.value^=c.value:s==="<<="?g.value<<=c.value:s===">>="?g.value>>=c.value:console.error(`Invalid operator ${s}. Line ${e.line}`)}return void(n instanceof Zi&&n.setDataValue(this,g,a,r))}if(n instanceof Zi)n.setDataValue(this,c,a,r);else if(a){if(!(n instanceof Ae||n instanceof Sr))return void console.error(`Variable ${i} is not a vector or matrix. Line ${e.line}`);if(a instanceof xy){const g=this.evalExpression(a.index,r).value;if(n instanceof Ae){if(!(c instanceof Ge))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[g]=c.value}else{if(!(n instanceof Sr))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const _=this.evalExpression(a.index,r).value;if(_<0)return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(c instanceof Ae))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const v=n.typeInfo.getTypeName();if(v==="mat2x2"||v==="mat2x2f"||v==="mat2x2h"){if(!(_<2&&c.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[2*_]=c.data[0],n.data[2*_+1]=c.data[1]}else if(v==="mat2x3"||v==="mat2x3f"||v==="mat2x3h"){if(!(_<2&&c.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[3*_]=c.data[0],n.data[3*_+1]=c.data[1],n.data[3*_+2]=c.data[2]}else if(v==="mat2x4"||v==="mat2x4f"||v==="mat2x4h"){if(!(_<2&&c.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[4*_]=c.data[0],n.data[4*_+1]=c.data[1],n.data[4*_+2]=c.data[2],n.data[4*_+3]=c.data[3]}else if(v==="mat3x2"||v==="mat3x2f"||v==="mat3x2h"){if(!(_<3&&c.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[2*_]=c.data[0],n.data[2*_+1]=c.data[1]}else if(v==="mat3x3"||v==="mat3x3f"||v==="mat3x3h"){if(!(_<3&&c.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[3*_]=c.data[0],n.data[3*_+1]=c.data[1],n.data[3*_+2]=c.data[2]}else if(v==="mat3x4"||v==="mat3x4f"||v==="mat3x4h"){if(!(_<3&&c.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[4*_]=c.data[0],n.data[4*_+1]=c.data[1],n.data[4*_+2]=c.data[2],n.data[4*_+3]=c.data[3]}else if(v==="mat4x2"||v==="mat4x2f"||v==="mat4x2h"){if(!(_<4&&c.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[2*_]=c.data[0],n.data[2*_+1]=c.data[1]}else if(v==="mat4x3"||v==="mat4x3f"||v==="mat4x3h"){if(!(_<4&&c.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[3*_]=c.data[0],n.data[3*_+1]=c.data[1],n.data[3*_+2]=c.data[2]}else{if(v!=="mat4x4"&&v!=="mat4x4f"&&v!=="mat4x4h")return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(_<4&&c.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[4*_]=c.data[0],n.data[4*_+1]=c.data[1],n.data[4*_+2]=c.data[2],n.data[4*_+3]=c.data[3]}}}}}else if(a instanceof Ig){const g=a.value;if(!(n instanceof Ae))return void console.error(`Invalid assignment to ${g}. Variable ${i} is not a vector. Line ${e.line}`);if(c instanceof Ge){if(g.length>1)return void console.error(`Invalid assignment to ${g} for variable ${i}. Line ${e.line}`);if(g==="x")n.data[0]=c.value;else if(g==="y"){if(n.data.length<2)return void console.error(`Invalid assignment to ${g} for variable ${i}. Line ${e.line}`);n.data[1]=c.value}else if(g==="z"){if(n.data.length<3)return void console.error(`Invalid assignment to ${g} for variable ${i}. Line ${e.line}`);n.data[2]=c.value}else if(g==="w"){if(n.data.length<4)return void console.error(`Invalid assignment to ${g} for variable ${i}. Line ${e.line}`);n.data[3]=c.value}}else{if(!(c instanceof Ae))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(g.length!==c.data.length)return void console.error(`Invalid assignment to ${g} for variable ${i}. Line ${e.line}`);for(let _=0;_<g.length;++_){const v=g[_];if(v==="x"||v==="r")n.data[0]=c.data[_];else if(v==="y"||v==="g"){if(c.data.length<2)return void console.error(`Invalid assignment to ${v} for variable ${i}. Line ${e.line}`);n.data[1]=c.data[_]}else if(v==="z"||v==="b"){if(c.data.length<3)return void console.error(`Invalid assignment to ${v} for variable ${i}. Line ${e.line}`);n.data[2]=c.data[_]}else{if(v!=="w"&&v!=="a")return void console.error(`Invalid assignment to ${v} for variable ${i}. Line ${e.line}`);if(c.data.length<4)return void console.error(`Invalid assignment to ${v} for variable ${i}. Line ${e.line}`);n.data[3]=c.data[_]}}}}}else n instanceof Ge&&c instanceof Ge?n.value=c.value:n instanceof Ae&&c instanceof Ae||n instanceof Sr&&c instanceof Sr?n.data.set(c.data):console.error(`Invalid assignment to ${i}. Line ${e.line}`)}_function(e,r){const n=new lC(e);r.functions.set(e.name,n)}_const(e,r){let n=null;e.value!==null&&(n=this.evalExpression(e.value,r)),r.createVariable(e.name,n,e)}_let(e,r){let n=null;if(e.value!==null){if(n=this.evalExpression(e.value,r),n===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof hs||(n=n.clone())}else{const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||i==="array"){const a=new eh(e.type,[]);n=this._evalCreate(a,r)}}r.createVariable(e.name,n,e)}_var(e,r){let n=null;if(e.value!==null){if(n=this.evalExpression(e.value,r),n===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof hs||(n=n.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||e.type instanceof Iv||e.type instanceof nf||e.type instanceof Je){const a=new eh(e.type,[]);n=this._evalCreate(a,r)}}r.createVariable(e.name,n,e)}_switch(e,r){r=r.clone();const n=this.evalExpression(e.condition,r);if(!(n instanceof Ge))return console.error(`Invalid if condition. Line ${e.line}`),null;let i=null;for(const a of e.cases)if(a instanceof qz)for(const c of a.selectors){if(c instanceof hx){i=a;continue}const s=this.evalExpression(c,r);if(!(s instanceof Ge))return console.error(`Invalid case selector. Line ${e.line}`),null;if(s.value===n.value)return this._execStatements(a.body,r)}else a instanceof Gz&&(i=a);return i?this._execStatements(i.body,r):null}_if(e,r){r=r.clone();const n=this.evalExpression(e.condition,r);if(!(n instanceof Ge))return console.error(`Invalid if condition. Line ${e.line}`),null;if(n.value)return this._execStatements(e.body,r);for(const i of e.elseif){const a=this.evalExpression(i.condition,r);if(!(a instanceof Ge))return console.error(`Invalid if condition. Line ${e.line}`),null;if(a.value)return this._execStatements(i.body,r)}return e.else?this._execStatements(e.else,r):null}_getScalarValue(e){return e instanceof Ge?e.value:(console.error("Expected scalar value.",e),0)}_for(e,r){for(r=r.clone(),this.execStatement(e.init,r);this._getScalarValue(this.evalExpression(e.condition,r));){const n=this._execStatements(e.body,r);if(n===Ra._breakObj)break;if(n!==null&&n!==Ra._continueObj)return n;this.execStatement(e.increment,r)}return null}_loop(e,r){for(r=r.clone();;){const n=this._execStatements(e.body,r);if(n===Ra._breakObj)break;if(n===Ra._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,r)===Ra._breakObj)break}else if(n!==null)return n}return null}_while(e,r){for(r=r.clone();this._getScalarValue(this.evalExpression(e.condition,r));){const n=this._execStatements(e.body,r);if(n===Ra._breakObj)break;if(n!==Ra._continueObj&&n!==null)return n}return null}_evalBitcast(e,r){const n=this.evalExpression(e.value,r),i=e.type;if(n instanceof Ge){const a=IO(n.value,n.typeInfo.name,i.name);return new Ge(a,this.getTypeInfo(i))}if(n instanceof Ae){const a=n.typeInfo.getTypeName();let c="";if(a.endsWith("f"))c="f32";else if(a.endsWith("i"))c="i32";else if(a.endsWith("u"))c="u32";else if(a.endsWith("b"))c="bool";else{if(!a.endsWith("h"))return console.error(`Unknown vector type ${a}. Line ${e.line}`),null;c="f16"}const s=i.getTypeName();let g="";if(s.endsWith("f"))g="f32";else if(s.endsWith("i"))g="i32";else if(s.endsWith("u"))g="u32";else if(s.endsWith("b"))g="bool";else{if(!s.endsWith("h"))return console.error(`Unknown vector type ${g}. Line ${e.line}`),null;g="f16"}const _=(function(v,T,M){if(T===M)return v;const O=new Array(v.length);for(let F=0;F<v.length;F++)O[F]=IO(v[F],T,M);return O})(Array.from(n.data),c,g);return new Ae(_,this.getTypeInfo(i))}return console.error(`TODO: bitcast for ${n.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,r){return r.getVariableValue(e.name).clone().getSubData(this,e.postfix,r)}_evalCreate(e,r){var n;if(e instanceof eh){if(e.type===null)return gA.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,r);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,r);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,r)}}const i=e instanceof eh?e.type.name:e.name,a=e instanceof eh?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(a===null)return console.error(`Unknown type ${i}. Line ${e.line}`),null;if(a.size===0)return null;const c=new Zi(new ArrayBuffer(a.size),a,0);if(a instanceof Rd){if(e.args)for(let s=0;s<e.args.length;++s){const g=a.members[s],_=e.args[s],v=this.evalExpression(_,r);c.setData(this,v,g.type,g.offset,r)}}else if(a instanceof Bd){let s=0;if(e.args)for(let g=0;g<e.args.length;++g){const _=e.args[g],v=this.evalExpression(_,r);a.format===null&&(((n=v.typeInfo)===null||n===void 0?void 0:n.name)==="x32"?a.format=this.getTypeInfo("i32"):a.format=v.typeInfo),c.setData(this,v,a.format,s,r),s+=a.stride}}else console.error(`Unknown type "${i}". Line ${e.line}`);return e instanceof eh?c.getSubData(this,e.postfix,r):c}_evalLiteral(e,r){const n=this.getTypeInfo(e.type),i=n.name;return i==="x32"||i==="u32"||i==="f32"||i==="f16"||i==="i32"||i==="bool"?new Ge(e.scalarValue,n):i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"?this._callConstructorVec(e,r):i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"?this._callConstructorMatrix(e,r):e.value}_evalVariable(e,r){const n=r.getVariableValue(e.name);return n===null?n:n.getSubData(this,e.postfix,r)}_maxFormatTypeInfo(e){let r=e[0];if(r.name==="f32")return r;for(let n=1;n<e.length;++n){const i=Ra._priority.get(r.name);Ra._priority.get(e[n].name)<i&&(r=e[n])}return r.name==="x32"?this.getTypeInfo("i32"):r}_evalUnaryOp(e,r){const n=this.evalExpression(e.right,r);if(e.operator==="&")return new Xm(n);if(e.operator==="*")return n instanceof Xm?n.reference.getSubData(this,e.postfix,r):(console.error(`Invalid dereference. Line ${e.line}`),null);const i=n instanceof Ge?n.value:n instanceof Ae?Array.from(n.data):null;switch(e.operator){case"+":{if(Zt(i)){const s=i.map((g,_)=>+g);return new Ae(s,n.typeInfo)}const a=i,c=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Ge(+a,c)}case"-":{if(Zt(i)){const s=i.map((g,_)=>-g);return new Ae(s,n.typeInfo)}const a=i,c=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Ge(-a,c)}case"!":{if(Zt(i)){const s=i.map((g,_)=>g?0:1);return new Ae(s,n.typeInfo)}const a=i,c=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Ge(a?0:1,c)}case"~":{if(Zt(i)){const s=i.map((g,_)=>~g);return new Ae(s,n.typeInfo)}const a=i,c=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Ge(~a,c)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,r){const n=this.evalExpression(e.left,r),i=this.evalExpression(e.right,r),a=n instanceof Ge?n.value:n instanceof Ae||n instanceof Sr?Array.from(n.data):null,c=i instanceof Ge?i.value:i instanceof Ae||i instanceof Sr?Array.from(i.data):null;switch(e.operator){case"+":{if(Zt(a)&&Zt(c)){const v=a,T=c;if(v.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const M=v.map((O,F)=>O+T[F]);return new Ae(M,n.typeInfo)}if(Zt(a)){const v=c,T=a.map((M,O)=>M+v);return new Ae(T,n.typeInfo)}if(Zt(c)){const v=a,T=c.map((M,O)=>v+M);return new Ae(T,i.typeInfo)}const s=a,g=c,_=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Ge(s+g,_)}case"-":{if(Zt(a)&&Zt(c)){const v=a,T=c;if(v.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const M=v.map((O,F)=>O-T[F]);return new Ae(M,n.typeInfo)}if(Zt(a)){const v=c,T=a.map((M,O)=>M-v);return new Ae(T,n.typeInfo)}if(Zt(c)){const v=a,T=c.map((M,O)=>v-M);return new Ae(T,i.typeInfo)}const s=a,g=c,_=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Ge(s-g,_)}case"*":{if(Zt(a)&&Zt(c)){const v=a,T=c;if(n instanceof Sr&&i instanceof Sr){const M=(function(V,q,Y,X){if(Wa[q.name]===void 0||Wa[X.name]===void 0)return null;const ae=Wa[q.name][0],ue=Wa[q.name][1],ge=Wa[X.name][0];if(ae!==Wa[X.name][1])return null;const Le=new Array(ge*ue);for(let qe=0;qe<ue;qe++)for(let Ze=0;Ze<ge;Ze++){let _t=0;for(let it=0;it<ae;it++)_t+=V[it*ue+qe]*Y[Ze*ae+it];Le[qe*ge+Ze]=_t}return Le})(v,n.typeInfo,T,i.typeInfo);if(M===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const O=Wa[i.typeInfo.name][0],F=Wa[n.typeInfo.name][1],j=this.getTypeInfo(`mat${O}x${F}f`);return new Sr(M,j)}if(n instanceof Sr&&i instanceof Ae){const M=(function(O,F,j,V){if(Wa[F.name]===void 0||NT[V.name]===void 0)return null;const q=Wa[F.name][0],Y=Wa[F.name][1];if(q!==j.length)return null;const X=new Array(Y);for(let ae=0;ae<Y;ae++){let ue=0;for(let ge=0;ge<q;ge++)ue+=O[ge*Y+ae]*j[ge];X[ae]=ue}return X})(v,n.typeInfo,T,i.typeInfo);return M===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new Ae(M,i.typeInfo)}if(n instanceof Ae&&i instanceof Sr){const M=(function(O,F,j,V){if(NT[F.name]===void 0||Wa[V.name]===void 0)return null;const q=Wa[V.name][0],Y=Wa[V.name][1];if(Y!==O.length)return null;const X=[];for(let ae=0;ae<q;ae++){let ue=0;for(let ge=0;ge<Y;ge++)ue+=O[ge]*j[ge*q+ae];X[ae]=ue}return X})(v,n.typeInfo,T,i.typeInfo);return M===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new Ae(M,n.typeInfo)}{if(v.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const M=v.map((O,F)=>O*T[F]);return new Ae(M,n.typeInfo)}}if(Zt(a)){const v=c,T=a.map((M,O)=>M*v);return n instanceof Sr?new Sr(T,n.typeInfo):new Ae(T,n.typeInfo)}if(Zt(c)){const v=a,T=c.map((M,O)=>v*M);return i instanceof Sr?new Sr(T,i.typeInfo):new Ae(T,i.typeInfo)}const s=a,g=c,_=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Ge(s*g,_)}case"%":{if(Zt(a)&&Zt(c)){const v=a,T=c;if(v.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const M=v.map((O,F)=>O%T[F]);return new Ae(M,n.typeInfo)}if(Zt(a)){const v=c,T=a.map((M,O)=>M%v);return new Ae(T,n.typeInfo)}if(Zt(c)){const v=a,T=c.map((M,O)=>v%M);return new Ae(T,i.typeInfo)}const s=a,g=c,_=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Ge(s%g,_)}case"/":{if(Zt(a)&&Zt(c)){const v=a,T=c;if(v.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const M=v.map((O,F)=>O/T[F]);return new Ae(M,n.typeInfo)}if(Zt(a)){const v=c,T=a.map((M,O)=>M/v);return new Ae(T,n.typeInfo)}if(Zt(c)){const v=a,T=c.map((M,O)=>v/M);return new Ae(T,i.typeInfo)}const s=a,g=c,_=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Ge(s/g,_)}case"&":{if(Zt(a)&&Zt(c)){const v=a,T=c;if(v.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const M=v.map((O,F)=>O&T[F]);return new Ae(M,n.typeInfo)}if(Zt(a)){const v=c,T=a.map((M,O)=>M&v);return new Ae(T,n.typeInfo)}if(Zt(c)){const v=a,T=c.map((M,O)=>v&M);return new Ae(T,i.typeInfo)}const s=a,g=c,_=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Ge(s&g,_)}case"|":{if(Zt(a)&&Zt(c)){const v=a,T=c;if(v.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const M=v.map((O,F)=>O|T[F]);return new Ae(M,n.typeInfo)}if(Zt(a)){const v=c,T=a.map((M,O)=>M|v);return new Ae(T,n.typeInfo)}if(Zt(c)){const v=a,T=c.map((M,O)=>v|M);return new Ae(T,i.typeInfo)}const s=a,g=c,_=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Ge(s|g,_)}case"^":{if(Zt(a)&&Zt(c)){const v=a,T=c;if(v.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const M=v.map((O,F)=>O^T[F]);return new Ae(M,n.typeInfo)}if(Zt(a)){const v=c,T=a.map((M,O)=>M^v);return new Ae(T,n.typeInfo)}if(Zt(c)){const v=a,T=c.map((M,O)=>v^M);return new Ae(T,i.typeInfo)}const s=a,g=c,_=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Ge(s^g,_)}case"<<":{if(Zt(a)&&Zt(c)){const v=a,T=c;if(v.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const M=v.map((O,F)=>O<<T[F]);return new Ae(M,n.typeInfo)}if(Zt(a)){const v=c,T=a.map((M,O)=>M<<v);return new Ae(T,n.typeInfo)}if(Zt(c)){const v=a,T=c.map((M,O)=>v<<M);return new Ae(T,i.typeInfo)}const s=a,g=c,_=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Ge(s<<g,_)}case">>":{if(Zt(a)&&Zt(c)){const v=a,T=c;if(v.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const M=v.map((O,F)=>O>>T[F]);return new Ae(M,n.typeInfo)}if(Zt(a)){const v=c,T=a.map((M,O)=>M>>v);return new Ae(T,n.typeInfo)}if(Zt(c)){const v=a,T=c.map((M,O)=>v>>M);return new Ae(T,i.typeInfo)}const s=a,g=c,_=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Ge(s>>g,_)}case">":if(Zt(a)&&Zt(c)){const s=a,g=c;if(s.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=s.map((v,T)=>v>g[T]?1:0);return new Ae(_,n.typeInfo)}if(Zt(a)){const s=c,g=a.map((_,v)=>_>s?1:0);return new Ae(g,n.typeInfo)}if(Zt(c)){const s=a,g=c.map((_,v)=>s>_?1:0);return new Ae(g,i.typeInfo)}return new Ge(a>c?1:0,this.getTypeInfo("bool"));case"<":if(Zt(a)&&Zt(c)){const s=a,g=c;if(s.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=s.map((v,T)=>v<g[T]?1:0);return new Ae(_,n.typeInfo)}if(Zt(a)){const s=c,g=a.map((_,v)=>_<s?1:0);return new Ae(g,n.typeInfo)}if(Zt(c)){const s=a,g=c.map((_,v)=>s<_?1:0);return new Ae(g,i.typeInfo)}return new Ge(a<c?1:0,this.getTypeInfo("bool"));case"==":if(Zt(a)&&Zt(c)){const s=a,g=c;if(s.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=s.map((v,T)=>v===g[T]?1:0);return new Ae(_,n.typeInfo)}if(Zt(a)){const s=c,g=a.map((_,v)=>_==s?1:0);return new Ae(g,n.typeInfo)}if(Zt(c)){const s=a,g=c.map((_,v)=>s==_?1:0);return new Ae(g,i.typeInfo)}return new Ge(a===c?1:0,this.getTypeInfo("bool"));case"!=":if(Zt(a)&&Zt(c)){const s=a,g=c;if(s.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=s.map((v,T)=>v!==g[T]?1:0);return new Ae(_,n.typeInfo)}if(Zt(a)){const s=c,g=a.map((_,v)=>_!==s?1:0);return new Ae(g,n.typeInfo)}if(Zt(c)){const s=a,g=c.map((_,v)=>s!==_?1:0);return new Ae(g,i.typeInfo)}return new Ge(a!==c?1:0,this.getTypeInfo("bool"));case">=":if(Zt(a)&&Zt(c)){const s=a,g=c;if(s.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=s.map((v,T)=>v>=g[T]?1:0);return new Ae(_,n.typeInfo)}if(Zt(a)){const s=c,g=a.map((_,v)=>_>=s?1:0);return new Ae(g,n.typeInfo)}if(Zt(c)){const s=a,g=c.map((_,v)=>s>=_?1:0);return new Ae(g,i.typeInfo)}return new Ge(a>=c?1:0,this.getTypeInfo("bool"));case"<=":if(Zt(a)&&Zt(c)){const s=a,g=c;if(s.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=s.map((v,T)=>v<=g[T]?1:0);return new Ae(_,n.typeInfo)}if(Zt(a)){const s=c,g=a.map((_,v)=>_<=s?1:0);return new Ae(g,n.typeInfo)}if(Zt(c)){const s=a,g=c.map((_,v)=>s<=_?1:0);return new Ae(g,i.typeInfo)}return new Ge(a<=c?1:0,this.getTypeInfo("bool"));case"&&":if(Zt(a)&&Zt(c)){const s=a,g=c;if(s.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=s.map((v,T)=>v&&g[T]?1:0);return new Ae(_,n.typeInfo)}if(Zt(a)){const s=c,g=a.map((_,v)=>_&&s?1:0);return new Ae(g,n.typeInfo)}if(Zt(c)){const s=a,g=c.map((_,v)=>s&&_?1:0);return new Ae(g,i.typeInfo)}return new Ge(a&&c?1:0,this.getTypeInfo("bool"));case"||":if(Zt(a)&&Zt(c)){const s=a,g=c;if(s.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=s.map((v,T)=>v||g[T]?1:0);return new Ae(_,n.typeInfo)}if(Zt(a)){const s=c,g=a.map((_,v)=>_||s?1:0);return new Ae(g,n.typeInfo)}if(Zt(c)){const s=a,g=c.map((_,v)=>s||_?1:0);return new Ae(g,i.typeInfo)}return new Ge(a||c?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,r){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const n=r.clone();n.currentFunctionName=e.name;const i=r.getFunction(e.name);if(!i)return e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)?this._evalCreate(e,r):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let a=0;a<i.node.args.length;++a){const c=i.node.args[a],s=this.evalExpression(e.args[a],n);n.createVariable(c.name,s,c)}return this._execStatements(i.node.body,n)}_callBuiltinFunction(e,r){switch(e.name){case"all":return this.builtins.All(e,r);case"any":return this.builtins.Any(e,r);case"select":return this.builtins.Select(e,r);case"arrayLength":return this.builtins.ArrayLength(e,r);case"abs":return this.builtins.Abs(e,r);case"acos":return this.builtins.Acos(e,r);case"acosh":return this.builtins.Acosh(e,r);case"asin":return this.builtins.Asin(e,r);case"asinh":return this.builtins.Asinh(e,r);case"atan":return this.builtins.Atan(e,r);case"atanh":return this.builtins.Atanh(e,r);case"atan2":return this.builtins.Atan2(e,r);case"ceil":return this.builtins.Ceil(e,r);case"clamp":return this.builtins.Clamp(e,r);case"cos":return this.builtins.Cos(e,r);case"cosh":return this.builtins.Cosh(e,r);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,r);case"countOneBits":return this.builtins.CountOneBits(e,r);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,r);case"cross":return this.builtins.Cross(e,r);case"degrees":return this.builtins.Degrees(e,r);case"determinant":return this.builtins.Determinant(e,r);case"distance":return this.builtins.Distance(e,r);case"dot":return this.builtins.Dot(e,r);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,r);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,r);case"exp":return this.builtins.Exp(e,r);case"exp2":return this.builtins.Exp2(e,r);case"extractBits":return this.builtins.ExtractBits(e,r);case"faceForward":return this.builtins.FaceForward(e,r);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,r);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,r);case"floor":return this.builtins.Floor(e,r);case"fma":return this.builtins.Fma(e,r);case"fract":return this.builtins.Fract(e,r);case"frexp":return this.builtins.Frexp(e,r);case"insertBits":return this.builtins.InsertBits(e,r);case"inverseSqrt":return this.builtins.InverseSqrt(e,r);case"ldexp":return this.builtins.Ldexp(e,r);case"length":return this.builtins.Length(e,r);case"log":return this.builtins.Log(e,r);case"log2":return this.builtins.Log2(e,r);case"max":return this.builtins.Max(e,r);case"min":return this.builtins.Min(e,r);case"mix":return this.builtins.Mix(e,r);case"modf":return this.builtins.Modf(e,r);case"normalize":return this.builtins.Normalize(e,r);case"pow":return this.builtins.Pow(e,r);case"quantizeToF16":return this.builtins.QuantizeToF16(e,r);case"radians":return this.builtins.Radians(e,r);case"reflect":return this.builtins.Reflect(e,r);case"refract":return this.builtins.Refract(e,r);case"reverseBits":return this.builtins.ReverseBits(e,r);case"round":return this.builtins.Round(e,r);case"saturate":return this.builtins.Saturate(e,r);case"sign":return this.builtins.Sign(e,r);case"sin":return this.builtins.Sin(e,r);case"sinh":return this.builtins.Sinh(e,r);case"smoothstep":return this.builtins.SmoothStep(e,r);case"sqrt":return this.builtins.Sqrt(e,r);case"step":return this.builtins.Step(e,r);case"tan":return this.builtins.Tan(e,r);case"tanh":return this.builtins.Tanh(e,r);case"transpose":return this.builtins.Transpose(e,r);case"trunc":return this.builtins.Trunc(e,r);case"dpdx":return this.builtins.Dpdx(e,r);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,r);case"dpdxFine":return this.builtins.DpdxFine(e,r);case"dpdy":return this.builtins.Dpdy(e,r);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,r);case"dpdyFine":return this.builtins.DpdyFine(e,r);case"fwidth":return this.builtins.Fwidth(e,r);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,r);case"fwidthFine":return this.builtins.FwidthFine(e,r);case"textureDimensions":return this.builtins.TextureDimensions(e,r);case"textureGather":return this.builtins.TextureGather(e,r);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,r);case"textureLoad":return this.builtins.TextureLoad(e,r);case"textureNumLayers":return this.builtins.TextureNumLayers(e,r);case"textureNumLevels":return this.builtins.TextureNumLevels(e,r);case"textureNumSamples":return this.builtins.TextureNumSamples(e,r);case"textureSample":return this.builtins.TextureSample(e,r);case"textureSampleBias":return this.builtins.TextureSampleBias(e,r);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,r);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,r);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,r);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,r);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,r);case"textureStore":return this.builtins.TextureStore(e,r);case"atomicLoad":return this.builtins.AtomicLoad(e,r);case"atomicStore":return this.builtins.AtomicStore(e,r);case"atomicAdd":return this.builtins.AtomicAdd(e,r);case"atomicSub":return this.builtins.AtomicSub(e,r);case"atomicMax":return this.builtins.AtomicMax(e,r);case"atomicMin":return this.builtins.AtomicMin(e,r);case"atomicAnd":return this.builtins.AtomicAnd(e,r);case"atomicOr":return this.builtins.AtomicOr(e,r);case"atomicXor":return this.builtins.AtomicXor(e,r);case"atomicExchange":return this.builtins.AtomicExchange(e,r);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,r);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,r);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,r);case"pack4xI8":return this.builtins.Pack4xI8(e,r);case"pack4xU8":return this.builtins.Pack4xU8(e,r);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,r);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,r);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,r);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,r);case"pack2x16float":return this.builtins.Pack2x16float(e,r);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,r);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,r);case"unpack4xI8":return this.builtins.Unpack4xI8(e,r);case"unpack4xU8":return this.builtins.Unpack4xU8(e,r);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,r);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,r);case"unpack2x16float":return this.builtins.Unpack2x16float(e,r);case"storageBarrier":return this.builtins.StorageBarrier(e,r);case"textureBarrier":return this.builtins.TextureBarrier(e,r);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,r);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,r);case"subgroupAdd":return this.builtins.SubgroupAdd(e,r);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,r);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,r);case"subgroupAll":return this.builtins.SubgroupAll(e,r);case"subgroupAnd":return this.builtins.SubgroupAnd(e,r);case"subgroupAny":return this.builtins.SubgroupAny(e,r);case"subgroupBallot":return this.builtins.SubgroupBallot(e,r);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,r);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,r);case"subgroupElect":return this.builtins.SubgroupElect(e,r);case"subgroupMax":return this.builtins.SubgroupMax(e,r);case"subgroupMin":return this.builtins.SubgroupMin(e,r);case"subgroupMul":return this.builtins.SubgroupMul(e,r);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,r);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,r);case"subgroupOr":return this.builtins.SubgroupOr(e,r);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,r);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,r);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,r);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,r);case"subgroupXor":return this.builtins.SubgroupXor(e,r);case"quadBroadcast":return this.builtins.QuadBroadcast(e,r);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,r);case"quadSwapX":return this.builtins.QuadSwapX(e,r);case"quadSwapY":return this.builtins.QuadSwapY(e,r)}const n=r.getFunction(e.name);if(n){const i=r.clone();for(let a=0;a<n.node.args.length;++a){const c=n.node.args[a],s=this.evalExpression(e.args[a],i);i.setVariable(c.name,s,c)}return this._execStatements(n.node.body,i)}return null}_callConstructorValue(e,r){if(!e.args||e.args.length===0)return new Ge(0,this.getTypeInfo(e.type));const n=this.evalExpression(e.args[0],r);return n.typeInfo=this.getTypeInfo(e.type),n.getSubData(this,e.postfix,r).clone()}_callConstructorVec(e,r){const n=this.getTypeInfo(e.type),i=e.type.getTypeName(),a=NT[i];if(a===void 0)return console.error(`Invalid vec constructor ${i}. Line ${e.line}`),null;const c=[];if(e instanceof As)if(e.isVector){const s=e.vectorValue;for(const g of s)c.push(g)}else c.push(e.scalarValue);else if(e.args)for(const s of e.args){const g=this.evalExpression(s,r);if(g instanceof Ae){const _=g.data;for(let v=0;v<_.length;++v){let T=_[v];c.push(T)}}else if(g instanceof Ge){let _=g.value;c.push(_)}}if(e.type instanceof Je&&e.type.format===null&&(e.type.format=Je.f32),c.length===0){const s=new Array(a).fill(0);return new Ae(s,n).getSubData(this,e.postfix,r)}if(c.length===1)for(;c.length<a;)c.push(c[0]);return c.length<a?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new Ae(c.length>a?c.slice(0,a):c,n).getSubData(this,e.postfix,r)}_callConstructorMatrix(e,r){const n=this.getTypeInfo(e.type),i=e.type.getTypeName(),a=Wa[i];if(a===void 0)return console.error(`Invalid matrix constructor ${i}. Line ${e.line}`),null;const c=[];if(e instanceof As)if(e.isVector){const s=e.vectorValue;for(const g of s)c.push(g)}else c.push(e.scalarValue);else if(e.args)for(const s of e.args){const g=this.evalExpression(s,r);g instanceof Ae?c.push(...g.data):g instanceof Ge?c.push(g.value):g instanceof Sr&&c.push(...g.data)}if(n instanceof Mg&&n.format===null&&(n.format=this.getTypeInfo("f32")),c.length===0){const s=new Array(a[2]).fill(0);return new Sr(s,n).getSubData(this,e.postfix,r)}return c.length!==a[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new Sr(c,n).getSubData(this,e.postfix,r)}}Ra._breakObj=new yc(new hc("BREAK",null),null),Ra._continueObj=new yc(new hc("CONTINUE",null),null),Ra._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class cse{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class use{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new cse,this._exec=new Ra,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const r=[];for(;!this._isAtEnd();){const n=this._global_decl_or_directive();if(!n)break;r.push(n)}if(this._deferArrayCountEval.length>0){for(const n of this._deferArrayCountEval){const i=n.arrayType,a=n.countNode;if(a instanceof pl){const c=a.name,s=this._context.constants.get(c);if(s)try{const g=s.constEvaluate(this._exec);i.count=g}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const n of r)n.search(i=>{i instanceof PO||i instanceof ux?i.type=this._forwardType(i.type):i instanceof Iv?i.format=this._forwardType(i.format):i instanceof cf||i instanceof Mv||i instanceof cx?i.type=this._forwardType(i.type):i instanceof Xv?i.returnType=this._forwardType(i.returnType):i instanceof CO&&(i.type=this._forwardType(i.type))});return r}_forwardType(e){if(e instanceof EO){const r=this._getType(e.name);if(r)return r}else e instanceof ux?e.type=this._forwardType(e.type):e instanceof Iv&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const r=new Jie(e);this._tokens=r.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,r){return e.line=r??this._currentLine,e}_error(e,r){return{token:e,message:r,toString:()=>`${r}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==ve.eof}_match(e){if(e instanceof Ye)return!!this._check(e)&&(this._advance(),!0);for(let r=0,n=e.length;r<n;++r){const i=e[r];if(this._check(i))return this._advance(),!0}return!1}_consume(e,r){if(this._check(e))return this._advance();throw this._error(this._peek(),`${r}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const r=this._peek();if(e instanceof Array){const n=r.type;let i=!1;for(const a of e){if(n===a)return!0;a===ve.tokens.name&&(i=!0)}if(i){const a=ve.tokens.name.rule.exec(r.lexeme);if(a&&a.index==0&&a[0]==r.lexeme)return!0}return!1}if(r.type===e)return!0;if(e===ve.tokens.name){const n=ve.tokens.name.rule.exec(r.lexeme);return n&&n.index==0&&n[0]==r.lexeme}return!1}_advance(){var e,r;return this._currentLine=(r=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&r!==void 0?r:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(ve.tokens.semicolon)&&!this._isAtEnd(););if(this._match(ve.keywords.alias)){const r=this._type_alias();return this._consume(ve.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}if(this._match(ve.keywords.diagnostic)){const r=this._diagnostic();return this._consume(ve.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}if(this._match(ve.keywords.requires)){const r=this._requires_directive();return this._consume(ve.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}if(this._match(ve.keywords.enable)){const r=this._enable_directive();return this._consume(ve.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}const e=this._attribute();if(this._check(ve.keywords.var)){const r=this._global_variable_decl();return r!=null&&(r.attributes=e),this._consume(ve.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(ve.keywords.override)){const r=this._override_variable_decl();return r!=null&&(r.attributes=e),this._consume(ve.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(ve.keywords.let)){const r=this._global_let_decl();return r!=null&&(r.attributes=e),this._consume(ve.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(ve.keywords.const)){const r=this._global_const_decl();return r!=null&&(r.attributes=e),this._consume(ve.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(ve.keywords.struct)){const r=this._struct_decl();return r!=null&&(r.attributes=e),this._exec.reflection.updateAST([r]),r}if(this._check(ve.keywords.fn)){const r=this._function_decl();return r!=null&&(r.attributes=e),this._exec.reflection.updateAST([r]),r}return null}_function_decl(){if(!this._match(ve.keywords.fn))return null;const e=this._currentLine,r=this._consume(ve.tokens.ident,"Expected function name.").toString();this._consume(ve.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(ve.tokens.paren_right))do{if(this._check(ve.tokens.paren_right))break;const s=this._attribute(),g=this._consume(ve.tokens.name,"Expected argument name.").toString();this._consume(ve.tokens.colon,"Expected ':' for argument type.");const _=this._attribute(),v=this._type_decl();v!=null&&(v.attributes=_,n.push(this._updateNode(new CO(g,v,s))))}while(this._match(ve.tokens.comma));this._consume(ve.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(ve.tokens.arrow)){const s=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=s)}const a=this._compound_statement(),c=this._currentLine;return this._updateNode(new Xv(r,n,i,a,e,c),e)}_compound_statement(){const e=[];for(this._consume(ve.tokens.brace_left,"Expected '{' for block.");!this._check(ve.tokens.brace_right);){const r=this._statement();r!==null&&e.push(r)}return this._consume(ve.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(ve.tokens.semicolon)&&!this._isAtEnd(););if(this._check(ve.tokens.attr)&&this._attribute(),this._check(ve.keywords.if))return this._if_statement();if(this._check(ve.keywords.switch))return this._switch_statement();if(this._check(ve.keywords.loop))return this._loop_statement();if(this._check(ve.keywords.for))return this._for_statement();if(this._check(ve.keywords.while))return this._while_statement();if(this._check(ve.keywords.continuing))return this._continuing_statement();if(this._check(ve.keywords.static_assert))return this._static_assert_statement();if(this._check(ve.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(ve.keywords.return))e=this._return_statement();else if(this._check([ve.keywords.var,ve.keywords.let,ve.keywords.const]))e=this._variable_statement();else if(this._match(ve.keywords.discard))e=this._updateNode(new Yie);else if(this._match(ve.keywords.break)){const r=this._updateNode(new Uz);if(this._currentLoop.length>0){const n=this._currentLoop[this._currentLoop.length-1];r.loopId=n.id}e=r,this._check(ve.keywords.if)&&(this._advance(),r.condition=this._optional_paren_expression())}else if(this._match(ve.keywords.continue)){const r=this._updateNode(new jz);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${r.line}`);{const n=this._currentLoop[this._currentLoop.length-1];r.loopId=n.id}e=r}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(ve.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(ve.keywords.static_assert))return null;const e=this._currentLine,r=this._optional_paren_expression();return this._updateNode(new Gie(r),e)}_while_statement(){if(!this._match(ve.keywords.while))return null;const e=this._updateNode(new Rz(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(ve.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(ve.keywords.continuing))return null;const r=this._currentLine,n=this._compound_statement();return this._updateNode(new pA(n,e),r)}_for_statement(){if(!this._match(ve.keywords.for))return null;this._consume(ve.tokens.paren_left,"Expected '('.");const e=this._updateNode(new Oz(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(ve.tokens.semicolon)?null:this._for_init(),this._consume(ve.tokens.semicolon,"Expected ';'."),e.condition=this._check(ve.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(ve.tokens.semicolon,"Expected ';'."),e.increment=this._check(ve.tokens.paren_right)?null:this._for_increment(),this._consume(ve.tokens.paren_right,"Expected ')'."),this._check(ve.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(ve.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let r=null;return this._match(ve.tokens.equal)&&(r=this._short_circuit_or_expression()),this._updateNode(new cf(e.name,e.type,e.storage,e.access,r),e.line)}if(this._match(ve.keywords.let)){const e=this._currentLine,r=this._consume(ve.tokens.name,"Expected name for let.").toString();let n=null;if(this._match(ve.tokens.colon)){const a=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=a)}this._consume(ve.tokens.equal,"Expected '=' for let.");const i=this._short_circuit_or_expression();return this._updateNode(new Mv(r,n,null,null,i),e)}if(this._match(ve.keywords.const)){const e=this._currentLine,r=this._consume(ve.tokens.name,"Expected name for const.").toString();let n=null;if(this._match(ve.tokens.colon)){const a=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=a)}this._consume(ve.tokens.equal,"Expected '=' for const.");const i=this._short_circuit_or_expression();return n===null&&i instanceof As&&(n=i.type),this._updateNode(new cx(r,n,null,null,i),e)}return null}_increment_decrement_statement(){const e=this._current,r=this._unary_expression();if(r==null)return null;if(!this._check(ve.increment_operators))return this._current=e,null;const n=this._consume(ve.increment_operators,"Expected increment operator");return this._updateNode(new kz(n.type===ve.tokens.plus_plus?ty.increment:ty.decrement,r))}_assignment_statement(){let e=null;const r=this._currentLine;if(this._check(ve.tokens.brace_right))return null;let n=this._match(ve.tokens.underscore);if(n||(e=this._unary_expression()),!n&&e==null)return null;const i=this._consume(ve.assignment_operators,"Expected assignment operator."),a=this._short_circuit_or_expression();return this._updateNode(new Dz(gv.parse(i.lexeme),e,a),r)}_func_call_statement(){if(!this._check(ve.tokens.ident))return null;const e=this._currentLine,r=this._current,n=this._consume(ve.tokens.ident,"Expected function name."),i=this._argument_expression_list();return i===null?(this._current=r,null):this._updateNode(new nC(n.lexeme,i),e)}_loop_statement(){if(!this._match(ve.keywords.loop))return null;this._check(ve.tokens.attr)&&this._attribute(),this._consume(ve.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new Lz([],null));this._currentLoop.push(e);let r=this._statement();for(;r!==null;){if(Array.isArray(r))for(let n of r)e.body.push(n);else e.body.push(r);if(r instanceof pA){e.continuing=r;break}r=this._statement()}return this._currentLoop.pop(),this._consume(ve.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(ve.keywords.switch))return null;const e=this._updateNode(new Bz(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(ve.tokens.attr)&&this._attribute(),this._consume(ve.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(ve.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let r=!1;for(;this._check([ve.keywords.default,ve.keywords.case]);){if(this._match(ve.keywords.case)){const n=this._case_selectors();for(const a of n)if(a instanceof hx){if(r)throw this._error(this._previous(),"Multiple default cases in switch statement.");r=!0;break}this._match(ve.tokens.colon),this._check(ve.tokens.attr)&&this._attribute(),this._consume(ve.tokens.brace_left,"Exected '{' for switch case.");const i=this._case_body();this._consume(ve.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new qz(n,i)))}if(this._match(ve.keywords.default)){if(r)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(ve.tokens.colon),this._check(ve.tokens.attr)&&this._attribute(),this._consume(ve.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(ve.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new Gz(n)))}}return e}_case_selectors(){const e=[];for(this._match(ve.keywords.default)?e.push(this._updateNode(new hx)):e.push(this._shift_expression());this._match(ve.tokens.comma);)this._match(ve.keywords.default)?e.push(this._updateNode(new hx)):e.push(this._shift_expression());return e}_case_body(){if(this._match(ve.keywords.fallthrough))return this._consume(ve.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const r=this._case_body();return r.length==0?e:[...e,r[0]]}_if_statement(){if(!this._match(ve.keywords.if))return null;const e=this._currentLine,r=this._optional_paren_expression();this._check(ve.tokens.attr)&&this._attribute();const n=this._compound_statement();let i=[];this._match_elseif()&&(this._check(ve.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let a=null;return this._match(ve.keywords.else)&&(this._check(ve.tokens.attr)&&this._attribute(),a=this._compound_statement()),this._updateNode(new Nz(r,n,i,a),e)}_match_elseif(){return this._tokens[this._current].type===ve.keywords.else&&this._tokens[this._current+1].type===ve.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const r=this._optional_paren_expression(),n=this._compound_statement();return e.push(this._updateNode(new Kie(r,n))),this._match_elseif()&&(this._check(ve.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(ve.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new zz(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(ve.tokens.or_or);)e=this._updateNode(new ru(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(ve.tokens.and_and);)e=this._updateNode(new ru(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(ve.tokens.or);)e=this._updateNode(new ru(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(ve.tokens.xor);)e=this._updateNode(new ru(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(ve.tokens.and);)e=this._updateNode(new ru(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([ve.tokens.equal_equal,ve.tokens.not_equal])?this._updateNode(new ru(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([ve.tokens.less_than,ve.tokens.greater_than,ve.tokens.less_than_equal,ve.tokens.greater_than_equal]);)e=this._updateNode(new ru(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([ve.tokens.shift_left,ve.tokens.shift_right]);)e=this._updateNode(new ru(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([ve.tokens.plus,ve.tokens.minus]);)e=this._updateNode(new ru(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([ve.tokens.star,ve.tokens.forward_slash,ve.tokens.modulo]);)e=this._updateNode(new ru(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([ve.tokens.minus,ve.tokens.bang,ve.tokens.tilde,ve.tokens.star,ve.tokens.and])?this._updateNode(new hs(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),r=this._postfix_expression();return r&&(e.postfix=r),e}_postfix_expression(){if(this._match(ve.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(ve.tokens.bracket_right,"Expected ']'.");const r=this._updateNode(new xy(e)),n=this._postfix_expression();return n&&(r.postfix=n),r}if(this._match(ve.tokens.period)){const e=this._consume(ve.tokens.name,"Expected member name."),r=this._postfix_expression(),n=this._updateNode(new Ig(e.lexeme));return r&&(n.postfix=r),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const r=this._getStruct(e);if(r!==null)return r;switch(e){case"void":return Rt.void;case"bool":return Rt.bool;case"i32":return Rt.i32;case"u32":return Rt.u32;case"f32":return Rt.f32;case"f16":return Rt.f16;case"vec2f":return Je.vec2f;case"vec3f":return Je.vec3f;case"vec4f":return Je.vec4f;case"vec2i":return Je.vec2i;case"vec3i":return Je.vec3i;case"vec4i":return Je.vec4i;case"vec2u":return Je.vec2u;case"vec3u":return Je.vec3u;case"vec4u":return Je.vec4u;case"vec2h":return Je.vec2h;case"vec3h":return Je.vec3h;case"vec4h":return Je.vec4h;case"mat2x2f":return Je.mat2x2f;case"mat2x3f":return Je.mat2x3f;case"mat2x4f":return Je.mat2x4f;case"mat3x2f":return Je.mat3x2f;case"mat3x3f":return Je.mat3x3f;case"mat3x4f":return Je.mat3x4f;case"mat4x2f":return Je.mat4x2f;case"mat4x3f":return Je.mat4x3f;case"mat4x4f":return Je.mat4x4f;case"mat2x2h":return Je.mat2x2h;case"mat2x3h":return Je.mat2x3h;case"mat2x4h":return Je.mat2x4h;case"mat3x2h":return Je.mat3x2h;case"mat3x3h":return Je.mat3x3h;case"mat3x4h":return Je.mat3x4h;case"mat4x2h":return Je.mat4x2h;case"mat4x3h":return Je.mat4x3h;case"mat4x4h":return Je.mat4x4h;case"mat2x2i":return Je.mat2x2i;case"mat2x3i":return Je.mat2x3i;case"mat2x4i":return Je.mat2x4i;case"mat3x2i":return Je.mat3x2i;case"mat3x3i":return Je.mat3x3i;case"mat3x4i":return Je.mat3x4i;case"mat4x2i":return Je.mat4x2i;case"mat4x3i":return Je.mat4x3i;case"mat4x4i":return Je.mat4x4i;case"mat2x2u":return Je.mat2x2u;case"mat2x3u":return Je.mat2x3u;case"mat2x4u":return Je.mat2x4u;case"mat3x2u":return Je.mat3x2u;case"mat3x3u":return Je.mat3x3u;case"mat3x4u":return Je.mat3x4u;case"mat4x2u":return Je.mat4x2u;case"mat4x3u":return Je.mat4x3u;case"mat4x4u":return Je.mat4x4u}return null}_validateTypeRange(e,r){if(r.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(r.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(ve.tokens.ident)){const n=this._previous().toString();if(this._check(ve.tokens.paren_left)){const i=this._argument_expression_list(),a=this._getType(n);return a!==null?this._updateNode(new eh(a,i)):this._updateNode(new sC(n,i))}if(this._context.constants.has(n)){const i=this._context.constants.get(n);return this._updateNode(new Vz(n,i.value))}return this._updateNode(new pl(n))}if(this._match(ve.tokens.int_literal)){const n=this._previous().toString();let i=n.endsWith("i")||n.endsWith("i")?Rt.i32:n.endsWith("u")||n.endsWith("U")?Rt.u32:Rt.x32;const a=parseInt(n);return this._validateTypeRange(a,i),this._updateNode(new As(new Ge(a,this._exec.getTypeInfo(i)),i))}if(this._match(ve.tokens.uint_literal)){const n=parseInt(this._previous().toString());return this._validateTypeRange(n,Rt.u32),this._updateNode(new As(new Ge(n,this._exec.getTypeInfo(Rt.u32)),Rt.u32))}if(this._match([ve.tokens.decimal_float_literal,ve.tokens.hex_float_literal])){let n=this._previous().toString(),i=n.endsWith("h");i&&(n=n.substring(0,n.length-1));const a=parseFloat(n);this._validateTypeRange(a,i?Rt.f16:Rt.f32);const c=i?Rt.f16:Rt.f32;return this._updateNode(new As(new Ge(a,this._exec.getTypeInfo(c)),c))}if(this._match([ve.keywords.true,ve.keywords.false])){let n=this._previous().toString()===ve.keywords.true.rule;return this._updateNode(new As(new Ge(n?1:0,this._exec.getTypeInfo(Rt.bool)),Rt.bool))}if(this._check(ve.tokens.paren_left))return this._paren_expression();if(this._match(ve.keywords.bitcast)){this._consume(ve.tokens.less_than,"Expected '<'.");const n=this._type_decl();this._consume(ve.tokens.greater_than,"Expected '>'.");const i=this._paren_expression();return this._updateNode(new $z(n,i))}const e=this._type_decl(),r=this._argument_expression_list();return this._updateNode(new eh(e,r))}_argument_expression_list(){if(!this._match(ve.tokens.paren_left))return null;const e=[];do{if(this._check(ve.tokens.paren_right))break;const r=this._short_circuit_or_expression();e.push(r)}while(this._match(ve.tokens.comma));return this._consume(ve.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(ve.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(ve.tokens.paren_right),e}_paren_expression(){this._consume(ve.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(ve.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(ve.keywords.struct))return null;const e=this._currentLine,r=this._consume(ve.tokens.ident,"Expected name for struct.").toString();this._consume(ve.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(ve.tokens.brace_right);){const c=this._attribute(),s=this._consume(ve.tokens.name,"Expected variable name.").toString();this._consume(ve.tokens.colon,"Expected ':' for struct member type.");const g=this._attribute(),_=this._type_decl();_!=null&&(_.attributes=g),this._check(ve.tokens.brace_right)?this._match(ve.tokens.comma):this._consume(ve.tokens.comma,"Expected ',' for struct member."),n.push(this._updateNode(new PO(s,_,c)))}this._consume(ve.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,a=this._updateNode(new nf(r,n,e,i),e);return this._context.structs.set(r,a),a}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(ve.tokens.equal)){const r=this._const_expression();e.value=r}if(e.type!==null&&e.value instanceof As){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof As&&(e.type=e.value.type.name==="x32"?Rt.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(ve.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(ve.keywords.const))return null;const r=this._consume(ve.tokens.name,"Expected variable name"),n=this._currentLine;let i=null;if(this._match(ve.tokens.colon)){const g=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=g)}let a=null;this._consume(ve.tokens.equal,"const declarations require an assignment");const c=this._short_circuit_or_expression();try{let g=[Rt.f32],_=c.constEvaluate(this._exec,g);_ instanceof Ge&&this._validateTypeRange(_.value,g[0]),g[0]instanceof Je&&g[0].format===null&&_.typeInfo instanceof Mg&&_.typeInfo.format!==null&&(_.typeInfo.format.name==="f16"?g[0].format=Rt.f16:_.typeInfo.format.name==="f32"?g[0].format=Rt.f32:_.typeInfo.format.name==="i32"?g[0].format=Rt.i32:_.typeInfo.format.name==="u32"?g[0].format=Rt.u32:_.typeInfo.format.name==="bool"?g[0].format=Rt.bool:console.error(`TODO: impelement template format type ${_.typeInfo.format.name}`)),a=this._updateNode(new As(_,g[0])),this._exec.context.setVariable(r.toString(),_)}catch{a=c}if(i!==null&&a instanceof As){if(a.type.name!=="x32"&&i.getTypeName()!==a.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${a.type.name} to ${i.name}. Line:${this._currentLine}`);a.type=i,a.isScalar&&this._validateTypeRange(a.scalarValue,a.type)}else i===null&&a instanceof As&&(i=(e=a?.type)!==null&&e!==void 0?e:Rt.f32,i===Rt.x32&&(i=Rt.i32));const s=this._updateNode(new cx(r.toString(),i,"","",a),n);return this._context.constants.set(s.name,s),s}_global_let_decl(){if(!this._match(ve.keywords.let))return null;const e=this._currentLine,r=this._consume(ve.tokens.name,"Expected variable name");let n=null;if(this._match(ve.tokens.colon)){const a=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=a)}let i=null;if(this._match(ve.tokens.equal)&&(i=this._const_expression()),n!==null&&i instanceof As){if(i.type.name!=="x32"&&n.getTypeName()!==i.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${n.name}. Line:${this._currentLine}`);i.type=n}else n===null&&i instanceof As&&(n=i.type.name==="x32"?Rt.i32:i.type);return i instanceof As&&i.isScalar&&this._validateTypeRange(i.scalarValue,n),this._updateNode(new Mv(r.toString(),n,"","",i),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(ve.keywords.var))return null;const e=this._currentLine;let r="",n="";this._match(ve.tokens.less_than)&&(r=this._consume(ve.storage_class,"Expected storage_class.").toString(),this._match(ve.tokens.comma)&&(n=this._consume(ve.access_mode,"Expected access_mode.").toString()),this._consume(ve.tokens.greater_than,"Expected '>'."));const i=this._consume(ve.tokens.name,"Expected variable name");let a=null;if(this._match(ve.tokens.colon)){const c=this._attribute();a=this._type_decl(),a!=null&&(a.attributes=c)}return this._updateNode(new cf(i.toString(),a,r,n,null),e)}_override_decl(){if(!this._match(ve.keywords.override))return null;const e=this._consume(ve.tokens.name,"Expected variable name");let r=null;if(this._match(ve.tokens.colon)){const n=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=n)}return this._updateNode(new rC(e.toString(),r,null))}_diagnostic(){this._consume(ve.tokens.paren_left,"Expected '('");const e=this._consume(ve.tokens.ident,"Expected severity control name.");this._consume(ve.tokens.comma,"Expected ','");let r=this._consume(ve.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(ve.tokens.period)&&(r+=`.${this._consume(ve.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(ve.tokens.paren_right,"Expected ')'"),this._updateNode(new Fz(e.toString(),r))}_enable_directive(){const e=this._consume(ve.tokens.ident,"identity expected.");return this._updateNode(new Xie(e.toString()))}_requires_directive(){const e=[this._consume(ve.tokens.ident,"identity expected.").toString()];for(;this._match(ve.tokens.comma);){const r=this._consume(ve.tokens.ident,"identity expected.");e.push(r.toString())}return this._updateNode(new Zie(e))}_type_alias(){const e=this._consume(ve.tokens.ident,"identity expected.");this._consume(ve.tokens.equal,"Expected '=' for type alias.");let r=this._type_decl();if(r===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);const n=this._updateNode(new iC(e.toString(),r));return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([ve.tokens.ident,...ve.texel_format,ve.keywords.bool,ve.keywords.f32,ve.keywords.i32,ve.keywords.u32])){const n=this._advance().toString();if(this._context.structs.has(n))return this._context.structs.get(n);if(this._context.aliases.has(n))return this._context.aliases.get(n).type;if(!this._getType(n)){const i=this._updateNode(new EO(n));return this._forwardTypeCount++,i}return this._updateNode(new Rt(n))}let e=this._texture_sampler_types();if(e)return e;if(this._check(ve.template_types)){let n=this._advance().toString(),i=null,a=null;return this._match(ve.tokens.less_than)&&(i=this._type_decl(),a=null,this._match(ve.tokens.comma)&&(a=this._consume(ve.access_mode,"Expected access_mode for pointer").toString()),this._consume(ve.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new Je(n,i,a))}if(this._match(ve.keywords.ptr)){let n=this._previous().toString();this._consume(ve.tokens.less_than,"Expected '<' for pointer.");const i=this._consume(ve.storage_class,"Expected storage_class for pointer");this._consume(ve.tokens.comma,"Expected ',' for pointer.");const a=this._type_decl();let c=null;return this._match(ve.tokens.comma)&&(c=this._consume(ve.access_mode,"Expected access_mode for pointer").toString()),this._consume(ve.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new ux(n,i.toString(),a,c))}const r=this._attribute();if(this._match(ve.keywords.array)){let n=null,i=-1;const a=this._previous();let c=null;if(this._match(ve.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let g="";if(this._match(ve.tokens.comma)){c=this._shift_expression();try{g=c.constEvaluate(this._exec).toString(),c=null}catch{g="1"}}this._consume(ve.tokens.greater_than,"Expected '>' for array."),i=g?parseInt(g):0}const s=this._updateNode(new Iv(a.toString(),r,n,i));return c&&this._deferArrayCountEval.push({arrayType:s,countNode:c}),s}return null}_texture_sampler_types(){if(this._match(ve.sampler_type))return this._updateNode(new mv(this._previous().toString(),null,null));if(this._match(ve.depth_texture_type))return this._updateNode(new mv(this._previous().toString(),null,null));if(this._match(ve.sampled_texture_type)||this._match(ve.multisampled_texture_type)){const e=this._previous();this._consume(ve.tokens.less_than,"Expected '<' for sampler type.");const r=this._type_decl();return this._consume(ve.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new mv(e.toString(),r,null))}if(this._match(ve.storage_texture_type)){const e=this._previous();this._consume(ve.tokens.less_than,"Expected '<' for sampler type.");const r=this._consume(ve.texel_format,"Invalid texel format.").toString();this._consume(ve.tokens.comma,"Expected ',' after texel format.");const n=this._consume(ve.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(ve.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new mv(e.toString(),r,n))}return null}_attribute(){let e=[];for(;this._match(ve.tokens.attr);){const r=this._consume(ve.attribute_name,"Expected attribute name"),n=this._updateNode(new Xz(r.toString(),null));if(this._match(ve.tokens.paren_left)){if(n.value=this._consume(ve.literal_or_ident,"Expected attribute value").toString(),this._check(ve.tokens.comma)){this._advance();do{const i=this._consume(ve.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(i)}while(this._match(ve.tokens.comma))}this._consume(ve.tokens.paren_right,"Expected ')'")}e.push(n)}return e.length==0?null:e}}class hse extends ih{constructor(e){super(),e&&this.update(e)}update(e){const r=new use().parse(e);this.updateAST(r)}}function fse(t){const e={attributes:[],bindings:[]};let r;try{r=dse(t)}catch(a){return Dt.error(a.message)(),e}for(const a of r.uniforms){const c=[];for(const s of a.type?.members||[])c.push({name:s.name,type:RO(s.type)});e.bindings.push({type:"uniform",name:a.name,group:a.group,location:a.binding,members:c})}for(const a of r.textures)e.bindings.push({type:"texture",name:a.name,group:a.group,location:a.binding});for(const a of r.samplers)e.bindings.push({type:"sampler",name:a.name,group:a.group,location:a.binding});const n=r.entry.vertex[0],i=n?.inputs.length||0;for(let a=0;a<i;a++){const c=n.inputs[a];if(c.locationType==="location"){const s=RO(c.type);e.attributes.push({name:c.name,location:Number(c.location),type:s})}}return e}function RO(t){return t?.format?`${t.name}<${t.format.name}>`:t.name}function dse(t){try{return new hse(t)}catch(e){if(e instanceof Error)throw e;let r="WGSL parse error";throw typeof e=="object"&&e?.message&&(r+=`: ${e.message} `),typeof e=="object"&&e?.token&&(r+=e.token.line||""),new Error(r,{cause:e})}}const pse={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...pse}};const fc=globalThis.mathgl.config;function gse(t,{precision:e=fc.precision}={}){return t=mse(t),`${parseFloat(t.toPrecision(e))}`}function wy(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Od(t,e,r){return _se(t,n=>Math.max(e,Math.min(r,n)))}function m1(t,e,r){return wy(t)?t.map((n,i)=>m1(n,e[i],r)):r*e+(1-r)*t}function Zv(t,e,r){const n=fc.EPSILON;try{if(t===e)return!0;if(wy(t)&&wy(e)){if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(!Zv(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=fc.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{fc.EPSILON=n}}function mse(t){return Math.round(t/fc.EPSILON)*fc.EPSILON}function yse(t){return t.clone?t.clone():new Array(t.length)}function _se(t,e,r){if(wy(t)){const n=t;r=r||yse(n);for(let i=0;i<r.length&&i<n.length;++i){const a=typeof t=="number"?t:t[i];r[i]=e(a,i,r)}return r}return e(t)}class Zz extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,r=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+r];return this.check()}toArray(e=[],r=0){for(let n=0;n<this.ELEMENTS;++n)e[r+n]=this[n];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:wy(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(fc)}formatString(e){let r="";for(let n=0;n<this.ELEMENTS;++n)r+=(n>0?", ":"")+gse(this[n],e);return`${e.printTypes?this.constructor.name:""}[${r}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(!Zv(this[r],e[r]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(this[r]!==e[r])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,r,n){if(n===void 0)return this.lerp(this,e,r);for(let i=0;i<this.ELEMENTS;++i){const a=e[i],c=typeof r=="number"?r:r[i];this[i]=a+n*(c-a)}return this.check()}min(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(e[r],this[r]);return this.check()}max(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.max(e[r],this[r]);return this.check()}clamp(e,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),r[n]);return this.check()}add(...e){for(const r of e)for(let n=0;n<this.ELEMENTS;++n)this[n]+=r[n];return this.check()}subtract(...e){for(const r of e)for(let n=0;n<this.ELEMENTS;++n)this[n]-=r[n];return this.check()}scale(e){if(typeof e=="number")for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;else for(let r=0;r<this.ELEMENTS&&r<e.length;++r)this[r]*=e[r];return this.check()}multiplyByScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;return this.check()}check(){if(fc.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let r=0;r<this.ELEMENTS;++r)e=e&&Number.isFinite(this[r]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=e;return this.check()}addScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),r);return this.check()}get elements(){return this}}function vse(t,e){if(t.length!==e)return!1;for(let r=0;r<t.length;++r)if(!Number.isFinite(t[r]))return!1;return!0}function fl(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function zT(t,e,r=""){if(fc.debug&&!vse(t,e))throw new Error(`math.gl: ${r} some fields set to invalid numbers'`);return t}function OO(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class bse extends Zz{get x(){return this[0]}set x(e){this[0]=fl(e)}get y(){return this[1]}set y(e){this[1]=fl(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let r=0;r<this.ELEMENTS;++r)e+=this[r]*this[r];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let r=0;for(let n=0;n<this.ELEMENTS;++n){const i=this[n]-e[n];r+=i*i}return fl(r)}dot(e){let r=0;for(let n=0;n<this.ELEMENTS;++n)r+=this[n]*e[n];return fl(r)}normalize(){const e=this.magnitude();if(e!==0)for(let r=0;r<this.ELEMENTS;++r)this[r]/=e;return this.check()}multiply(...e){for(const r of e)for(let n=0;n<this.ELEMENTS;++n)this[n]*=r[n];return this.check()}divide(...e){for(const r of e)for(let n=0;n<this.ELEMENTS;++n)this[n]/=r[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return OO(e>=0&&e<this.ELEMENTS,"index is out of range"),fl(this[e])}setComponent(e,r){return OO(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=r,this.check()}addVectors(e,r){return this.copy(e).add(r)}subVectors(e,r){return this.copy(e).subtract(r)}multiplyVectors(e,r){return this.copy(e).multiply(r)}addScaledVector(e,r){return this.add(new this.constructor(e).multiplyScalar(r))}}const fx=1e-6;let Ty=typeof Float32Array<"u"?Float32Array:Array;function xse(){const t=new Ty(2);return Ty!=Float32Array&&(t[0]=0,t[1]=0),t}function kO(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function wse(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Yz(t,e,r,n){const i=e[0],a=e[1];return t[0]=i+n*(r[0]-i),t[1]=a+n*(r[1]-a),t}function Tse(t,e,r){const n=e[0],i=e[1];return t[0]=r[0]*n+r[4]*i+r[12],t[1]=r[1]*n+r[5]*i+r[13],t}(function(){const t=xse();return function(e,r,n,i,a,c){let s,g;for(r||(r=2),n||(n=0),i?g=Math.min(i*r+n,e.length):g=e.length,s=n;s<g;s+=r)t[0]=e[s],t[1]=e[s+1],a(t,t,c),e[s]=t[0],e[s+1]=t[1];return e}})();function Sse(t,e,r){const n=e[0],i=e[1],a=r[3]*n+r[7]*i||1;return t[0]=(r[0]*n+r[4]*i)/a,t[1]=(r[1]*n+r[5]*i)/a,t}function Kz(t,e,r){const n=e[0],i=e[1],a=e[2],c=r[3]*n+r[7]*i+r[11]*a||1;return t[0]=(r[0]*n+r[4]*i+r[8]*a)/c,t[1]=(r[1]*n+r[5]*i+r[9]*a)/c,t[2]=(r[2]*n+r[6]*i+r[10]*a)/c,t}function Ase(t,e,r){const n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i,t[2]=e[2],t}function Ese(){const t=new Ty(3);return Ty!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Cse(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function Pse(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Mse(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Ise(t,e,r){const n=e[0],i=e[1],a=e[2],c=r[0],s=r[1],g=r[2];return t[0]=i*g-a*s,t[1]=a*c-n*g,t[2]=n*s-i*c,t}function Qz(t,e,r){const n=e[0],i=e[1],a=e[2];let c=r[3]*n+r[7]*i+r[11]*a+r[15];return c=c||1,t[0]=(r[0]*n+r[4]*i+r[8]*a+r[12])/c,t[1]=(r[1]*n+r[5]*i+r[9]*a+r[13])/c,t[2]=(r[2]*n+r[6]*i+r[10]*a+r[14])/c,t}function Rse(t,e,r){const n=e[0],i=e[1],a=e[2];return t[0]=n*r[0]+i*r[3]+a*r[6],t[1]=n*r[1]+i*r[4]+a*r[7],t[2]=n*r[2]+i*r[5]+a*r[8],t}function Ose(t,e,r){const n=r[0],i=r[1],a=r[2],c=r[3],s=e[0],g=e[1],_=e[2];let v=i*_-a*g,T=a*s-n*_,M=n*g-i*s,O=i*M-a*T,F=a*v-n*M,j=n*T-i*v;const V=c*2;return v*=V,T*=V,M*=V,O*=2,F*=2,j*=2,t[0]=s+v+O,t[1]=g+T+F,t[2]=_+M+j,t}function kse(t,e,r,n){const i=[],a=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],a[0]=i[0],a[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),a[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t}function Dse(t,e,r,n){const i=[],a=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],a[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),a[1]=i[1],a[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t}function Lse(t,e,r,n){const i=[],a=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],a[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),a[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),a[2]=i[2],t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t}function Bse(t,e){const r=t[0],n=t[1],i=t[2],a=e[0],c=e[1],s=e[2],g=Math.sqrt((r*r+n*n+i*i)*(a*a+c*c+s*s)),_=g&&Mse(t,e)/g;return Math.acos(Math.min(Math.max(_,-1),1))}const Nse=Cse;(function(){const t=Ese();return function(e,r,n,i,a,c){let s,g;for(r||(r=3),n||(n=0),i?g=Math.min(i*r+n,e.length):g=e.length,s=n;s<g;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],a(t,t,c),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}})();const FT=[0,0,0];let Wb;class lh extends bse{static get ZERO(){return Wb||(Wb=new lh(0,0,0),Object.freeze(Wb)),Wb}constructor(e=0,r=0,n=0){super(-0,-0,-0),arguments.length===1&&wy(e)?this.copy(e):(fc.debug&&(fl(e),fl(r),fl(n)),this[0]=e,this[1]=r,this[2]=n)}set(e,r,n){return this[0]=e,this[1]=r,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return fc.debug&&(fl(e.x),fl(e.y),fl(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=fl(e)}angle(e){return Bse(this,e)}cross(e){return Ise(this,this,e),this.check()}rotateX({radians:e,origin:r=FT}){return kse(this,this,r,e),this.check()}rotateY({radians:e,origin:r=FT}){return Dse(this,this,r,e),this.check()}rotateZ({radians:e,origin:r=FT}){return Lse(this,this,r,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Qz(this,this,e),this.check()}transformAsVector(e){return Kz(this,this,e),this.check()}transformByMatrix3(e){return Rse(this,this,e),this.check()}transformByMatrix2(e){return Ase(this,this,e),this.check()}transformByQuaternion(e){return Ose(this,this,e),this.check()}}class zse extends Zz{toString(){let e="[";if(fc.printRowMajor){e+="row-major:";for(let r=0;r<this.RANK;++r)for(let n=0;n<this.RANK;++n)e+=` ${this[n*this.RANK+r]}`}else{e+="column-major:";for(let r=0;r<this.ELEMENTS;++r)e+=` ${this[r]}`}return e+="]",e}getElementIndex(e,r){return r*this.RANK+e}getElement(e,r){return this[r*this.RANK+e]}setElement(e,r,n){return this[r*this.RANK+e]=fl(n),this}getColumn(e,r=new Array(this.RANK).fill(-0)){const n=e*this.RANK;for(let i=0;i<this.RANK;++i)r[i]=this[n+i];return r}setColumn(e,r){const n=e*this.RANK;for(let i=0;i<this.RANK;++i)this[n+i]=r[i];return this}}function Fse(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Use(t,e){if(t===e){const r=e[1],n=e[2],i=e[3],a=e[6],c=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=a,t[11]=e[14],t[12]=i,t[13]=c,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function mA(t,e){const r=e[0],n=e[1],i=e[2],a=e[3],c=e[4],s=e[5],g=e[6],_=e[7],v=e[8],T=e[9],M=e[10],O=e[11],F=e[12],j=e[13],V=e[14],q=e[15],Y=r*s-n*c,X=r*g-i*c,ae=r*_-a*c,ue=n*g-i*s,ge=n*_-a*s,Le=i*_-a*g,qe=v*j-T*F,Ze=v*V-M*F,_t=v*q-O*F,it=T*V-M*j,gt=T*q-O*j,Lt=M*q-O*V;let Ot=Y*Lt-X*gt+ae*it+ue*_t-ge*Ze+Le*qe;return Ot?(Ot=1/Ot,t[0]=(s*Lt-g*gt+_*it)*Ot,t[1]=(i*gt-n*Lt-a*it)*Ot,t[2]=(j*Le-V*ge+q*ue)*Ot,t[3]=(M*ge-T*Le-O*ue)*Ot,t[4]=(g*_t-c*Lt-_*Ze)*Ot,t[5]=(r*Lt-i*_t+a*Ze)*Ot,t[6]=(V*ae-F*Le-q*X)*Ot,t[7]=(v*Le-M*ae+O*X)*Ot,t[8]=(c*gt-s*_t+_*qe)*Ot,t[9]=(n*_t-r*gt-a*qe)*Ot,t[10]=(F*ge-j*ae+q*Y)*Ot,t[11]=(T*ae-v*ge-O*Y)*Ot,t[12]=(s*Ze-c*it-g*qe)*Ot,t[13]=(r*it-n*Ze+i*qe)*Ot,t[14]=(j*X-F*ue-V*Y)*Ot,t[15]=(v*ue-T*X+M*Y)*Ot,t):null}function jse(t){const e=t[0],r=t[1],n=t[2],i=t[3],a=t[4],c=t[5],s=t[6],g=t[7],_=t[8],v=t[9],T=t[10],M=t[11],O=t[12],F=t[13],j=t[14],V=t[15],q=e*c-r*a,Y=e*s-n*a,X=r*s-n*c,ae=_*F-v*O,ue=_*j-T*O,ge=v*j-T*F,Le=e*ge-r*ue+n*ae,qe=a*ge-c*ue+s*ae,Ze=_*X-v*Y+T*q,_t=O*X-F*Y+j*q;return g*Le-i*qe+V*Ze-M*_t}function vg(t,e,r){const n=e[0],i=e[1],a=e[2],c=e[3],s=e[4],g=e[5],_=e[6],v=e[7],T=e[8],M=e[9],O=e[10],F=e[11],j=e[12],V=e[13],q=e[14],Y=e[15];let X=r[0],ae=r[1],ue=r[2],ge=r[3];return t[0]=X*n+ae*s+ue*T+ge*j,t[1]=X*i+ae*g+ue*M+ge*V,t[2]=X*a+ae*_+ue*O+ge*q,t[3]=X*c+ae*v+ue*F+ge*Y,X=r[4],ae=r[5],ue=r[6],ge=r[7],t[4]=X*n+ae*s+ue*T+ge*j,t[5]=X*i+ae*g+ue*M+ge*V,t[6]=X*a+ae*_+ue*O+ge*q,t[7]=X*c+ae*v+ue*F+ge*Y,X=r[8],ae=r[9],ue=r[10],ge=r[11],t[8]=X*n+ae*s+ue*T+ge*j,t[9]=X*i+ae*g+ue*M+ge*V,t[10]=X*a+ae*_+ue*O+ge*q,t[11]=X*c+ae*v+ue*F+ge*Y,X=r[12],ae=r[13],ue=r[14],ge=r[15],t[12]=X*n+ae*s+ue*T+ge*j,t[13]=X*i+ae*g+ue*M+ge*V,t[14]=X*a+ae*_+ue*O+ge*q,t[15]=X*c+ae*v+ue*F+ge*Y,t}function y1(t,e,r){const n=r[0],i=r[1],a=r[2];let c,s,g,_,v,T,M,O,F,j,V,q;return e===t?(t[12]=e[0]*n+e[4]*i+e[8]*a+e[12],t[13]=e[1]*n+e[5]*i+e[9]*a+e[13],t[14]=e[2]*n+e[6]*i+e[10]*a+e[14],t[15]=e[3]*n+e[7]*i+e[11]*a+e[15]):(c=e[0],s=e[1],g=e[2],_=e[3],v=e[4],T=e[5],M=e[6],O=e[7],F=e[8],j=e[9],V=e[10],q=e[11],t[0]=c,t[1]=s,t[2]=g,t[3]=_,t[4]=v,t[5]=T,t[6]=M,t[7]=O,t[8]=F,t[9]=j,t[10]=V,t[11]=q,t[12]=c*n+v*i+F*a+e[12],t[13]=s*n+T*i+j*a+e[13],t[14]=g*n+M*i+V*a+e[14],t[15]=_*n+O*i+q*a+e[15]),t}function uC(t,e,r){const n=r[0],i=r[1],a=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Vse(t,e,r,n){let i=n[0],a=n[1],c=n[2],s=Math.sqrt(i*i+a*a+c*c),g,_,v,T,M,O,F,j,V,q,Y,X,ae,ue,ge,Le,qe,Ze,_t,it,gt,Lt,Ot,Yt;return s<fx?null:(s=1/s,i*=s,a*=s,c*=s,_=Math.sin(r),g=Math.cos(r),v=1-g,T=e[0],M=e[1],O=e[2],F=e[3],j=e[4],V=e[5],q=e[6],Y=e[7],X=e[8],ae=e[9],ue=e[10],ge=e[11],Le=i*i*v+g,qe=a*i*v+c*_,Ze=c*i*v-a*_,_t=i*a*v-c*_,it=a*a*v+g,gt=c*a*v+i*_,Lt=i*c*v+a*_,Ot=a*c*v-i*_,Yt=c*c*v+g,t[0]=T*Le+j*qe+X*Ze,t[1]=M*Le+V*qe+ae*Ze,t[2]=O*Le+q*qe+ue*Ze,t[3]=F*Le+Y*qe+ge*Ze,t[4]=T*_t+j*it+X*gt,t[5]=M*_t+V*it+ae*gt,t[6]=O*_t+q*it+ue*gt,t[7]=F*_t+Y*it+ge*gt,t[8]=T*Lt+j*Ot+X*Yt,t[9]=M*Lt+V*Ot+ae*Yt,t[10]=O*Lt+q*Ot+ue*Yt,t[11]=F*Lt+Y*Ot+ge*Yt,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Jz(t,e,r){const n=Math.sin(r),i=Math.cos(r),a=e[4],c=e[5],s=e[6],g=e[7],_=e[8],v=e[9],T=e[10],M=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*i+_*n,t[5]=c*i+v*n,t[6]=s*i+T*n,t[7]=g*i+M*n,t[8]=_*i-a*n,t[9]=v*i-c*n,t[10]=T*i-s*n,t[11]=M*i-g*n,t}function $se(t,e,r){const n=Math.sin(r),i=Math.cos(r),a=e[0],c=e[1],s=e[2],g=e[3],_=e[8],v=e[9],T=e[10],M=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i-_*n,t[1]=c*i-v*n,t[2]=s*i-T*n,t[3]=g*i-M*n,t[8]=a*n+_*i,t[9]=c*n+v*i,t[10]=s*n+T*i,t[11]=g*n+M*i,t}function e5(t,e,r){const n=Math.sin(r),i=Math.cos(r),a=e[0],c=e[1],s=e[2],g=e[3],_=e[4],v=e[5],T=e[6],M=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i+_*n,t[1]=c*i+v*n,t[2]=s*i+T*n,t[3]=g*i+M*n,t[4]=_*i-a*n,t[5]=v*i-c*n,t[6]=T*i-s*n,t[7]=M*i-g*n,t}function Hse(t,e){const r=e[0],n=e[1],i=e[2],a=e[3],c=r+r,s=n+n,g=i+i,_=r*c,v=n*c,T=n*s,M=i*c,O=i*s,F=i*g,j=a*c,V=a*s,q=a*g;return t[0]=1-T-F,t[1]=v+q,t[2]=M-V,t[3]=0,t[4]=v-q,t[5]=1-_-F,t[6]=O+j,t[7]=0,t[8]=M+V,t[9]=O-j,t[10]=1-_-T,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Wse(t,e,r,n,i,a,c){const s=1/(r-e),g=1/(i-n),_=1/(a-c);return t[0]=a*2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a*2*g,t[6]=0,t[7]=0,t[8]=(r+e)*s,t[9]=(i+n)*g,t[10]=(c+a)*_,t[11]=-1,t[12]=0,t[13]=0,t[14]=c*a*2*_,t[15]=0,t}function qse(t,e,r,n,i){const a=1/Math.tan(e/2);if(t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0){const c=1/(n-i);t[10]=(i+n)*c,t[14]=2*i*n*c}else t[10]=-1,t[14]=-2*n;return t}const Gse=qse;function Xse(t,e,r,n,i,a,c){const s=1/(e-r),g=1/(n-i),_=1/(a-c);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*g,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*_,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*g,t[14]=(c+a)*_,t[15]=1,t}const Zse=Xse;function Yse(t,e,r,n){let i,a,c,s,g,_,v,T,M,O;const F=e[0],j=e[1],V=e[2],q=n[0],Y=n[1],X=n[2],ae=r[0],ue=r[1],ge=r[2];return Math.abs(F-ae)<fx&&Math.abs(j-ue)<fx&&Math.abs(V-ge)<fx?Fse(t):(T=F-ae,M=j-ue,O=V-ge,i=1/Math.sqrt(T*T+M*M+O*O),T*=i,M*=i,O*=i,a=Y*O-X*M,c=X*T-q*O,s=q*M-Y*T,i=Math.sqrt(a*a+c*c+s*s),i?(i=1/i,a*=i,c*=i,s*=i):(a=0,c=0,s=0),g=M*s-O*c,_=O*a-T*s,v=T*c-M*a,i=Math.sqrt(g*g+_*_+v*v),i?(i=1/i,g*=i,_*=i,v*=i):(g=0,_=0,v=0),t[0]=a,t[1]=g,t[2]=T,t[3]=0,t[4]=c,t[5]=_,t[6]=M,t[7]=0,t[8]=s,t[9]=v,t[10]=O,t[11]=0,t[12]=-(a*F+c*j+s*V),t[13]=-(g*F+_*j+v*V),t[14]=-(T*F+M*j+O*V),t[15]=1,t)}function Kse(){const t=new Ty(4);return Ty!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Qse(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function v0(t,e,r){const n=e[0],i=e[1],a=e[2],c=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*a+r[12]*c,t[1]=r[1]*n+r[5]*i+r[9]*a+r[13]*c,t[2]=r[2]*n+r[6]*i+r[10]*a+r[14]*c,t[3]=r[3]*n+r[7]*i+r[11]*a+r[15]*c,t}(function(){const t=Kse();return function(e,r,n,i,a,c){let s,g;for(r||(r=4),n||(n=0),i?g=Math.min(i*r+n,e.length):g=e.length,s=n;s<g;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],a(t,t,c),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}})();var yA;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(yA||(yA={}));const Jse=45*Math.PI/180,eae=1,UT=.1,jT=500,tae=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class ch extends zse{static get IDENTITY(){return nae()}static get ZERO(){return rae()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return yA}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,r,n,i,a,c,s,g,_,v,T,M,O,F,j,V){return this[0]=e,this[1]=r,this[2]=n,this[3]=i,this[4]=a,this[5]=c,this[6]=s,this[7]=g,this[8]=_,this[9]=v,this[10]=T,this[11]=M,this[12]=O,this[13]=F,this[14]=j,this[15]=V,this.check()}setRowMajor(e,r,n,i,a,c,s,g,_,v,T,M,O,F,j,V){return this[0]=e,this[1]=a,this[2]=_,this[3]=O,this[4]=r,this[5]=c,this[6]=v,this[7]=F,this[8]=n,this[9]=s,this[10]=T,this[11]=j,this[12]=i,this[13]=g,this[14]=M,this[15]=V,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(tae)}fromObject(e){return this.check()}fromQuaternion(e){return Hse(this,e),this.check()}frustum(e){const{left:r,right:n,bottom:i,top:a,near:c=UT,far:s=jT}=e;return s===1/0?iae(this,r,n,i,a,c):Wse(this,r,n,i,a,c,s),this.check()}lookAt(e){const{eye:r,center:n=[0,0,0],up:i=[0,1,0]}=e;return Yse(this,r,n,i),this.check()}ortho(e){const{left:r,right:n,bottom:i,top:a,near:c=UT,far:s=jT}=e;return Zse(this,r,n,i,a,c,s),this.check()}orthographic(e){const{fovy:r=Jse,aspect:n=eae,focalDistance:i=1,near:a=UT,far:c=jT}=e;DO(r);const s=r/2,g=i*Math.tan(s),_=g*n;return this.ortho({left:-_,right:_,bottom:-g,top:g,near:a,far:c})}perspective(e){const{fovy:r=45*Math.PI/180,aspect:n=1,near:i=.1,far:a=500}=e;return DO(r),Gse(this,r,n,i,a),this.check()}determinant(){return jse(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,r){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];const n=this.getScale(r),i=1/n[0],a=1/n[1],c=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*a,e[2]=this[2]*c,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*a,e[6]=this[6]*c,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*a,e[10]=this[10]*c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,r){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];const n=this.getScale(r),i=1/n[0],a=1/n[1],c=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*a,e[2]=this[2]*c,e[3]=this[4]*i,e[4]=this[5]*a,e[5]=this[6]*c,e[6]=this[8]*i,e[7]=this[9]*a,e[8]=this[10]*c,e}transpose(){return Use(this,this),this.check()}invert(){return mA(this,this),this.check()}multiplyLeft(e){return vg(this,e,this),this.check()}multiplyRight(e){return vg(this,this,e),this.check()}rotateX(e){return Jz(this,this,e),this.check()}rotateY(e){return $se(this,this,e),this.check()}rotateZ(e){return e5(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,r){return Vse(this,this,e,r),this.check()}scale(e){return uC(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return y1(this,this,e),this.check()}transform(e,r){return e.length===4?(r=v0(r||[-0,-0,-0,-0],e,this),zT(r,4),r):this.transformAsPoint(e,r)}transformAsPoint(e,r){const{length:n}=e;let i;switch(n){case 2:i=Tse(r||[-0,-0],e,this);break;case 3:i=Qz(r||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return zT(i,e.length),i}transformAsVector(e,r){let n;switch(e.length){case 2:n=Sse(r||[-0,-0],e,this);break;case 3:n=Kz(r||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return zT(n,e.length),n}transformPoint(e,r){return this.transformAsPoint(e,r)}transformVector(e,r){return this.transformAsPoint(e,r)}transformDirection(e,r){return this.transformAsVector(e,r)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,r,n){return this.identity().translate([e,r,n])}}let qb,Gb;function rae(){return qb||(qb=new ch([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(qb)),qb}function nae(){return Gb||(Gb=new ch,Object.freeze(Gb)),Gb}function DO(t){if(t>Math.PI*2)throw Error("expected radians")}function iae(t,e,r,n,i,a){const c=2*a/(r-e),s=2*a/(i-n),g=(r+e)/(r-e),_=(i+n)/(i-n),v=-1,T=-1,M=-2*a;return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=g,t[9]=_,t[10]=v,t[11]=T,t[12]=0,t[13]=0,t[14]=M,t[15]=0,t}function t5(t,e=[],r=0){const n=Math.fround(t),i=t-n;return e[r]=n,e[r+1]=i,e}function sae(t){return t-Math.fround(t)}function aae(t){const e=new Float32Array(32);for(let r=0;r<4;++r)for(let n=0;n<4;++n){const i=r*4+n;t5(t[n*4+r],e,i*2)}return e}const oae=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,lae={name:"fp32",vs:oae},cae=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,uae={ONE:1},hae={name:"fp64arithmetic",vs:cae,defaultUniforms:uae,uniformTypes:{ONE:"f32"},fp64ify:t5,fp64LowPart:sae,fp64ifyMatrix4:aae},fae=[0,1,1,1],dae=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,pae=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,LO={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:fae},vs:dae,fs:pae,getUniforms:gae};function gae(t={},e){const r={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)r.isHighlightActive=!1;else{r.isHighlightActive=!0;const n=t.highlightedObjectColor.slice(0,3);r.highlightedObjectColor=n}if(t.highlightColor){const n=Array.from(t.highlightColor,i=>i/255);Number.isFinite(n[3])||(n[3]=1),r.highlightColor=n}return t.isActive!==void 0&&(r.isActive=!!t.isActive,r.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(r.useFloatColors=!!t.useFloatColors),r}const BO=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,mae=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,yae=5,_ae=255;var Yv;(function(t){t[t.POINT=0]="POINT",t[t.DIRECTIONAL=1]="DIRECTIONAL"})(Yv||(Yv={}));const dx={props:{},uniforms:{},name:"lighting",defines:{},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:Yv.POINT,directionalLightCount:0,pointLightCount:0,ambientColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:mae,vs:BO,fs:BO,getUniforms:vae};function vae(t,e={}){if(t=t&&{...t},!t)return{...dx.defaultUniforms};t.lights&&(t={...t,...xae(t.lights),lights:void 0});const{ambientLight:r,pointLights:n,directionalLights:i}=t||{};if(!(r||n&&n.length>0||i&&i.length>0))return{...dx.defaultUniforms,enabled:0};const c={...dx.defaultUniforms,...e,...bae({ambientLight:r,pointLights:n,directionalLights:i})};return t.enabled!==void 0&&(c.enabled=t.enabled?1:0),c}function bae({ambientLight:t,pointLights:e=[],directionalLights:r=[]}){const n={};n.ambientColor=VT(t);let i=0;for(const a of e){n.lightType=Yv.POINT;const c=i;n[`lightColor${c}`]=VT(a),n[`lightPosition${c}`]=a.position,n[`lightAttenuation${c}`]=a.attenuation||[1,0,0],i++}for(const a of r){n.lightType=Yv.DIRECTIONAL;const c=i;n[`lightColor${c}`]=VT(a),n[`lightDirection${c}`]=a.direction,i++}return i>yae&&Dt.warn("MAX_LIGHTS exceeded")(),n.directionalLightCount=r.length,n.pointLightCount=e.length,n}function xae(t){const e={pointLights:[],directionalLights:[]};for(const r of t||[])switch(r.type){case"ambient":e.ambientLight=r;break;case"directional":e.directionalLights?.push(r);break;case"point":e.pointLights?.push(r);break}return e}function VT(t={}){const{color:e=[0,0,0],intensity:r=1}=t;return e.map(n=>n*r/_ae)}const wae=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,Tae=`#define MAX_LIGHTS 3

uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,Sae=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,r5={props:{},name:"gouraudMaterial",vs:Tae.replace("phongMaterial","gouraudMaterial"),fs:wae.replace("phongMaterial","gouraudMaterial"),source:Sae.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:!0},dependencies:[dx],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(t){const e={...t};return e.specularColor&&(e.specularColor=e.specularColor.map(r=>r/255)),{...r5.defaultUniforms,...e}}},NO=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,Aae={name:"layer",vs:NO,fs:NO,getUniforms:t=>({opacity:Math.pow(t.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},Eae=`

struct ColorUniforms {
  opacity: f32,
};

var<private> color: ColorUniforms = ColorUniforms(1.0);
// TODO (kaapp) avoiding binding index collisions to handle layer opacity 
// requires some thought.
// @group(0) @binding(0) var<uniform> color: ColorUniforms;

@must_use
fn deckgl_premultiplied_alpha(fragColor: vec4<f32>) -> vec4<f32> {
    return vec4(fragColor.rgb * fragColor.a, fragColor.a); 
};
`,Cae={name:"color",dependencies:[],source:Eae,getUniforms:t=>({}),uniformTypes:{opacity:"f32"}},Pae=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,n5="#define SMOOTH_EDGE_RADIUS 0.5",Mae=`${n5}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,Iae=`${n5}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,i5={name:"geometry",source:Pae,vs:Mae,fs:Iae},Rae=25;var fs;(function(t){t[t.Start=1]="Start",t[t.Move=2]="Move",t[t.End=4]="End",t[t.Cancel=8]="Cancel"})(fs||(fs={}));var Es;(function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.Up=4]="Up",t[t.Down=8]="Down",t[t.Horizontal=3]="Horizontal",t[t.Vertical=12]="Vertical",t[t.All=15]="All"})(Es||(Es={}));var Ur;(function(t){t[t.Possible=1]="Possible",t[t.Began=2]="Began",t[t.Changed=4]="Changed",t[t.Ended=8]="Ended",t[t.Recognized=8]="Recognized",t[t.Cancelled=16]="Cancelled",t[t.Failed=32]="Failed"})(Ur||(Ur={}));const Oae="compute",kae="auto",_A="manipulation",px="none",vA="pan-x",bA="pan-y";function Dae(t){if(t.includes(px))return px;const e=t.includes(vA),r=t.includes(bA);return e&&r?px:e||r?e?vA:bA:t.includes(_A)?_A:kae}class Lae{constructor(e,r){this.actions="",this.manager=e,this.set(r)}set(e){e===Oae&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const r of this.manager.recognizers)r.options.enable&&(e=e.concat(r.getTouchAction()));return Dae(e.join(" "))}}function _1(t){return t.trim().split(/\s+/g)}function $T(t,e,r){if(t)for(const n of _1(e))t.addEventListener(n,r,!1)}function HT(t,e,r){if(t)for(const n of _1(e))t.removeEventListener(n,r,!1)}function zO(t){return(t.ownerDocument||t).defaultView}function Bae(t,e){let r=t;for(;r;){if(r===e)return!0;r=r.parentNode}return!1}function s5(t){const e=t.length;if(e===1)return{x:Math.round(t[0].clientX),y:Math.round(t[0].clientY)};let r=0,n=0,i=0;for(;i<e;)r+=t[i].clientX,n+=t[i].clientY,i++;return{x:Math.round(r/e),y:Math.round(n/e)}}function FO(t){const e=[];let r=0;for(;r<t.pointers.length;)e[r]={clientX:Math.round(t.pointers[r].clientX),clientY:Math.round(t.pointers[r].clientY)},r++;return{timeStamp:Date.now(),pointers:e,center:s5(e),deltaX:t.deltaX,deltaY:t.deltaY}}function a5(t,e){const r=e.x-t.x,n=e.y-t.y;return Math.sqrt(r*r+n*n)}function UO(t,e){const r=e.clientX-t.clientX,n=e.clientY-t.clientY;return Math.sqrt(r*r+n*n)}function Nae(t,e){const r=e.x-t.x,n=e.y-t.y;return Math.atan2(n,r)*180/Math.PI}function jO(t,e){const r=e.clientX-t.clientX,n=e.clientY-t.clientY;return Math.atan2(n,r)*180/Math.PI}function o5(t,e){return t===e?Es.None:Math.abs(t)>=Math.abs(e)?t<0?Es.Left:Es.Right:e<0?Es.Up:Es.Down}function zae(t,e){const r=e.center;let n=t.offsetDelta,i=t.prevDelta;const a=t.prevInput;return(e.eventType===fs.Start||a?.eventType===fs.End)&&(i=t.prevDelta={x:a?.deltaX||0,y:a?.deltaY||0},n=t.offsetDelta={x:r.x,y:r.y}),{deltaX:i.x+(r.x-n.x),deltaY:i.y+(r.y-n.y)}}function l5(t,e,r){return{x:e/t||0,y:r/t||0}}function Fae(t,e){return UO(e[0],e[1])/UO(t[0],t[1])}function Uae(t,e){return jO(e[1],e[0])-jO(t[1],t[0])}function jae(t,e){const r=t.lastInterval||e,n=e.timeStamp-r.timeStamp;let i,a,c,s;if(e.eventType!==fs.Cancel&&(n>Rae||r.velocity===void 0)){const g=e.deltaX-r.deltaX,_=e.deltaY-r.deltaY,v=l5(n,g,_);a=v.x,c=v.y,i=Math.abs(v.x)>Math.abs(v.y)?v.x:v.y,s=o5(g,_),t.lastInterval=e}else i=r.velocity,a=r.velocityX,c=r.velocityY,s=r.direction;e.velocity=i,e.velocityX=a,e.velocityY=c,e.direction=s}function Vae(t,e){const{session:r}=t,{pointers:n}=e,{length:i}=n;r.firstInput||(r.firstInput=FO(e)),i>1&&!r.firstMultiple?r.firstMultiple=FO(e):i===1&&(r.firstMultiple=!1);const{firstInput:a,firstMultiple:c}=r,s=c?c.center:a.center,g=e.center=s5(n);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-a.timeStamp,e.angle=Nae(s,g),e.distance=a5(s,g);const{deltaX:_,deltaY:v}=zae(r,e);e.deltaX=_,e.deltaY=v,e.offsetDirection=o5(e.deltaX,e.deltaY);const T=l5(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=T.x,e.overallVelocityY=T.y,e.overallVelocity=Math.abs(T.x)>Math.abs(T.y)?T.x:T.y,e.scale=c?Fae(c.pointers,n):1,e.rotation=c?Uae(c.pointers,n):0,e.maxPointers=r.prevInput?e.pointers.length>r.prevInput.maxPointers?e.pointers.length:r.prevInput.maxPointers:e.pointers.length;let M=t.element;return Bae(e.srcEvent.target,M)&&(M=e.srcEvent.target),e.target=M,jae(r,e),e}function $ae(t,e,r){const n=r.pointers.length,i=r.changedPointers.length,a=e&fs.Start&&n-i===0,c=e&(fs.End|fs.Cancel)&&n-i===0;r.isFirst=!!a,r.isFinal=!!c,a&&(t.session={}),r.eventType=e;const s=Vae(t,r);t.emit("hammer.input",s),t.recognize(s),t.session.prevInput=s}let Hae=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=r=>{this.manager.options.enable&&this.handler(r)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,r){$ae(this.manager,e,r)}init(){$T(this.element,this.evEl,this.domHandler),$T(this.target,this.evTarget,this.domHandler),$T(zO(this.element),this.evWin,this.domHandler)}destroy(){HT(this.element,this.evEl,this.domHandler),HT(this.target,this.evTarget,this.domHandler),HT(zO(this.element),this.evWin,this.domHandler)}};const Wae={pointerdown:fs.Start,pointermove:fs.Move,pointerup:fs.End,pointercancel:fs.Cancel,pointerout:fs.Cancel},qae="pointerdown",Gae="pointermove pointerup pointercancel";class Xae extends Hae{constructor(e){super(e),this.evEl=qae,this.evWin=Gae,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:r}=this;let n=!1;const i=Wae[e.type],a=e.pointerType,c=a==="touch";let s=r.findIndex(g=>g.pointerId===e.pointerId);i&fs.Start&&(e.buttons||c)?s<0&&(r.push(e),s=r.length-1):i&(fs.End|fs.Cancel)&&(n=!0),!(s<0)&&(r[s]=e,this.callback(i,{pointers:r,changedPointers:[e],eventType:i,pointerType:a,srcEvent:e}),n&&r.splice(s,1))}}const Zae=["","webkit","Moz","MS","ms","o"];function Yae(t,e){const r=e[0].toUpperCase()+e.slice(1);for(const n of Zae){const i=n?n+r:e;if(i in t)return i}}const Kae=1,VO=2,$O={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class Qae{constructor(e,r){this.options={...$O,...r,cssProps:{...$O.cssProps,...r.cssProps},inputTarget:r.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new Xae(this),this.touchAction=new Lae(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?VO:Kae}recognize(e){const{session:r}=this;if(r.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let n;const{recognizers:i}=this;let{curRecognizer:a}=r;(!a||a&&a.state&Ur.Recognized)&&(a=r.curRecognizer=null);let c=0;for(;c<i.length;)n=i[c],r.stopped!==VO&&(!a||n===a||n.canRecognizeWith(a))?n.recognize(e):n.reset(),!a&&n.state&(Ur.Began|Ur.Changed|Ur.Ended)&&(a=r.curRecognizer=n),c++}get(e){const{recognizers:r}=this;for(let n=0;n<r.length;n++)if(r[n].options.event===e)return r[n];return null}add(e){if(Array.isArray(e)){for(const n of e)this.add(n);return this}const r=this.get(e.options.event);return r&&this.remove(r),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const n of e)this.remove(n);return this}const r=typeof e=="string"?this.get(e):e;if(r){const{recognizers:n}=this,i=n.indexOf(r);i!==-1&&(n.splice(i,1),this.touchAction.update())}return this}on(e,r){if(!e||!r)return;const{handlers:n}=this;for(const i of _1(e))n[i]=n[i]||[],n[i].push(r)}off(e,r){if(!e)return;const{handlers:n}=this;for(const i of _1(e))r?n[i]&&n[i].splice(n[i].indexOf(r),1):delete n[i]}emit(e,r){const n=this.handlers[e]&&this.handlers[e].slice();if(!n||!n.length)return;const i=r;i.type=e,i.preventDefault=function(){r.srcEvent.preventDefault()};let a=0;for(;a<n.length;)n[a](i),a++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:r}=this;if(r){for(const[n,i]of Object.entries(this.options.cssProps)){const a=Yae(r.style,n);e?(this.oldCssProps[a]=r.style[a],r.style[a]=i):r.style[a]=this.oldCssProps[a]||""}e||(this.oldCssProps={})}}}let Jae=1;function eoe(){return Jae++}function HO(t){return t&Ur.Cancelled?"cancel":t&Ur.Ended?"end":t&Ur.Changed?"move":t&Ur.Began?"start":""}class c5{constructor(e){this.options=e,this.id=eoe(),this.state=Ur.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const i of e)this.recognizeWith(i);return this}let r;if(typeof e=="string"){if(r=this.manager.get(e),!r)throw new Error(`Cannot find recognizer ${e}`)}else r=e;const{simultaneous:n}=this;return n[r.id]||(n[r.id]=r,r.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const n of e)this.dropRecognizeWith(n);return this}let r;return typeof e=="string"?r=this.manager.get(e):r=e,r&&delete this.simultaneous[r.id],this}requireFailure(e){if(Array.isArray(e)){for(const i of e)this.requireFailure(i);return this}let r;if(typeof e=="string"){if(r=this.manager.get(e),!r)throw new Error(`Cannot find recognizer ${e}`)}else r=e;const{requireFail:n}=this;return n.indexOf(r)===-1&&(n.push(r),r.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const n of e)this.dropRequireFailure(n);return this}let r;if(typeof e=="string"?r=this.manager.get(e):r=e,r){const n=this.requireFail.indexOf(r);n>-1&&this.requireFail.splice(n,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:r}=this;r<Ur.Ended&&this.manager.emit(this.options.event+HO(r),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),r>=Ur.Ended&&this.manager.emit(this.options.event+HO(r),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=Ur.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Ur.Failed|Ur.Possible)))return!1;e++}return!0}recognize(e){const r={...e};if(!this.options.enable){this.reset(),this.state=Ur.Failed;return}this.state&(Ur.Recognized|Ur.Cancelled|Ur.Failed)&&(this.state=Ur.Possible),this.state=this.process(r),this.state&(Ur.Began|Ur.Changed|Ur.Ended|Ur.Cancelled)&&this.tryEmit(r)}getEventNames(){return[this.options.event]}reset(){}}class u5 extends c5{attrTest(e){const r=this.options.pointers;return r===0||e.pointers.length===r}process(e){const{state:r}=this,{eventType:n}=e,i=r&(Ur.Began|Ur.Changed),a=this.attrTest(e);return i&&(n&fs.Cancel||!a)?r|Ur.Cancelled:i||a?n&fs.End?r|Ur.Ended:r&Ur.Began?r|Ur.Changed:Ur.Began:Ur.Failed}}class WO extends c5{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[_A]}process(e){const{options:r}=this,n=e.pointers.length===r.pointers,i=e.distance<r.threshold,a=e.deltaTime<r.time;if(this.reset(),e.eventType&fs.Start&&this.count===0)return this.failTimeout();if(i&&a&&n){if(e.eventType!==fs.End)return this.failTimeout();const c=this.pTime?e.timeStamp-this.pTime<r.interval:!0,s=!this.pCenter||a5(this.pCenter,e.center)<r.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!s||!c?this.count=1:this.count+=1,this._input=e,this.count%r.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Ur.Recognized,this.tryEmit(this._input)},r.interval),Ur.Began):Ur.Recognized}return Ur.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Ur.Failed},this.options.interval),Ur.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===Ur.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const toe=["","start","move","end","cancel","up","down","left","right"];class qO extends u5{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Es.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,r=[];return e&Es.Horizontal&&r.push(bA),e&Es.Vertical&&r.push(vA),r}getEventNames(){return toe.map(e=>this.options.event+e)}directionTest(e){const{options:r}=this;let n=!0,{distance:i}=e,{direction:a}=e;const c=e.deltaX,s=e.deltaY;return a&r.direction||(r.direction&Es.Horizontal?(a=c===0?Es.None:c<0?Es.Left:Es.Right,n=c!==this.pX,i=Math.abs(e.deltaX)):(a=s===0?Es.None:s<0?Es.Up:Es.Down,n=s!==this.pY,i=Math.abs(e.deltaY))),e.direction=a,n&&i>r.threshold&&!!(a&r.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&Ur.Began)||!(this.state&Ur.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const r=Es[e.direction].toLowerCase();r&&(e.additionalEvent=this.options.event+r),super.emit(e)}}const roe=["","start","move","end","cancel","in","out"];class noe extends u5{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[px]}getEventNames(){return roe.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&Ur.Began))}emit(e){if(e.scale!==1){const r=e.scale<1?"in":"out";e.additionalEvent=this.options.event+r}super.emit(e)}}class dw{constructor(e,r,n){this.element=e,this.callback=r,this.options=n}}const ioe=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",soe=ioe.indexOf("firefox")!==-1,GO=4.000244140625,aoe=40,ooe=.25;class loe extends dw{constructor(e,r,n){super(e,r,{enable:!0,...n}),this.handleEvent=i=>{if(!this.options.enable)return;let a=i.deltaY;globalThis.WheelEvent&&(soe&&i.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(a/=globalThis.devicePixelRatio),i.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(a*=aoe)),a!==0&&a%GO===0&&(a=Math.floor(a/GO)),i.shiftKey&&a&&(a=a*ooe),this.callback({type:"wheel",center:{x:i.clientX,y:i.clientY},delta:-a,srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,r){e==="wheel"&&(this.options.enable=r)}}const XO=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class coe extends dw{constructor(e,r,n){super(e,r,{enable:!0,...n}),this.handleEvent=a=>{this.handleOverEvent(a),this.handleOutEvent(a),this.handleEnterEvent(a),this.handleLeaveEvent(a),this.handleMoveEvent(a)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,XO.forEach(a=>e.addEventListener(a,this.handleEvent))}destroy(){XO.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,r){switch(e){case"pointermove":this.enableMoveEvent=r;break;case"pointerover":this.enableOverEvent=r;break;case"pointerout":this.enableOutEvent=r;break;case"pointerenter":this.enableEnterEvent=r;break;case"pointerleave":this.enableLeaveEvent=r;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,r){this.callback({type:e,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})}}const ZO=["keydown","keyup"];class uoe extends dw{constructor(e,r,n){super(e,r,{enable:!0,tabIndex:0,...n}),this.handleEvent=i=>{const a=i.target||i.srcElement;a.tagName==="INPUT"&&a.type==="text"||a.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:"keydown",srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:"keyup",srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",ZO.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){ZO.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,r){e==="keydown"&&(this.enableDownEvent=r),e==="keyup"&&(this.enableUpEvent=r)}}class hoe extends dw{constructor(e,r,n){super(e,r,n),this.handleEvent=i=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,r){e==="contextmenu"&&(this.options.enable=r)}}const YO=1,xA=2,KO=4,foe={pointerdown:YO,pointermove:xA,pointerup:KO,mousedown:YO,mousemove:xA,mouseup:KO},doe=0,poe=1,goe=2,moe=1,yoe=2,_oe=4;function voe(t){const e=foe[t.srcEvent.type];if(!e)return null;const{buttons:r,button:n}=t.srcEvent;let i=!1,a=!1,c=!1;return e===xA?(i=!!(r&moe),a=!!(r&_oe),c=!!(r&yoe)):(i=n===doe,a=n===poe,c=n===goe),{leftButton:i,middleButton:a,rightButton:c}}function boe(t,e){const r=t.center;if(!r)return null;const n=e.getBoundingClientRect(),i=n.width/e.offsetWidth||1,a=n.height/e.offsetHeight||1,c={x:(r.x-n.left-e.clientLeft)/i,y:(r.y-n.top-e.clientTop)/a};return{center:r,offsetCenter:c}}const xoe={srcElement:"root",priority:0};class woe{constructor(e,r){this.handleEvent=n=>{if(this.isEmpty())return;const i=this._normalizeEvent(n);let a=n.srcEvent.target;for(;a&&a!==i.rootElement;){if(this._emit(i,a),i.handled)return;a=a.parentNode}this._emit(i,"root")},this.eventManager=e,this.recognizerName=r,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,r,n,i=!1,a=!1){const{handlers:c,handlersByElement:s}=this,g={...xoe,...n};let _=s.get(g.srcElement);_||(_=[],s.set(g.srcElement,_));const v={type:e,handler:r,srcElement:g.srcElement,priority:g.priority};i&&(v.once=!0),a&&(v.passive=!0),c.push(v),this._active=this._active||!v.passive;let T=_.length-1;for(;T>=0&&!(_[T].priority>=v.priority);)T--;_.splice(T+1,0,v)}remove(e,r){const{handlers:n,handlersByElement:i}=this;for(let a=n.length-1;a>=0;a--){const c=n[a];if(c.type===e&&c.handler===r){n.splice(a,1);const s=i.get(c.srcElement);s.splice(s.indexOf(c),1),s.length===0&&i.delete(c.srcElement)}}this._active=n.some(a=>!a.passive)}_emit(e,r){const n=this.handlersByElement.get(r);if(n){let i=!1;const a=()=>{e.handled=!0},c=()=>{e.handled=!0,i=!0},s=[];for(let g=0;g<n.length;g++){const{type:_,handler:v,once:T}=n[g];if(v({...e,type:_,stopPropagation:a,stopImmediatePropagation:c}),T&&s.push(n[g]),i)break}for(let g=0;g<s.length;g++){const{type:_,handler:v}=s[g];this.remove(_,v)}}}_normalizeEvent(e){const r=this.eventManager.getElement();return{...e,...voe(e),...boe(e,r),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:r}}}function Toe(t){if("recognizer"in t)return t;let e;const r=Array.isArray(t)?[...t]:[t];if(typeof r[0]=="function"){const n=r.shift(),i=r.shift()||{};e=new n(i)}else e=r.shift();return{recognizer:e,recognizeWith:typeof r[0]=="string"?[r[0]]:r[0],requireFailure:typeof r[1]=="string"?[r[1]]:r[1]}}class Soe{constructor(e=null,r={}){if(this._onBasicInput=n=>{this.manager.emit(n.srcEvent.type,n)},this._onOtherEvent=n=>{this.manager.emit(n.type,n)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...r},this.events=new Map,this.element=e,!!e){this.manager=new Qae(e,this.options);for(const n of this.options.recognizers){const{recognizer:i,recognizeWith:a,requireFailure:c}=Toe(n);this.manager.add(i),a&&i.recognizeWith(a),c&&i.requireFailure(c)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new loe(e,this._onOtherEvent,{enable:!1}),this.moveInput=new coe(e,this._onOtherEvent,{enable:!1}),this.keyInput=new uoe(e,this._onOtherEvent,{enable:!1,tabIndex:r.tabIndex}),this.contextmenuInput=new hoe(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,r,n){this._addEventHandler(e,r,n,!1)}once(e,r,n){this._addEventHandler(e,r,n,!0)}watch(e,r,n){this._addEventHandler(e,r,n,!1,!0)}off(e,r){this._removeEventHandler(e,r)}_toggleRecognizer(e,r){const{manager:n}=this;if(!n)return;const i=n.get(e);i&&(i.set({enable:r}),n.touchAction.update()),this.wheelInput?.enableEventType(e,r),this.moveInput?.enableEventType(e,r),this.keyInput?.enableEventType(e,r),this.contextmenuInput?.enableEventType(e,r)}_addEventHandler(e,r,n,i,a){if(typeof e!="string"){n=r;for(const[_,v]of Object.entries(e))this._addEventHandler(_,v,n,i,a);return}const{manager:c,events:s}=this;if(!c)return;let g=s.get(e);if(!g){const _=this._getRecognizerName(e)||e;g=new woe(this,_),s.set(e,g),c&&c.on(e,g.handleEvent)}g.add(e,r,n,i,a),g.isEmpty()||this._toggleRecognizer(g.recognizerName,!0)}_removeEventHandler(e,r){if(typeof e!="string"){for(const[a,c]of Object.entries(e))this._removeEventHandler(a,c);return}const{events:n}=this,i=n.get(e);if(i&&(i.remove(e,r),i.isEmpty())){const{recognizerName:a}=i;let c=!1;for(const s of n.values())if(s.recognizerName===a&&!s.isEmpty()){c=!0;break}c||this._toggleRecognizer(a,!1)}}_getRecognizerName(e){return this.manager.recognizers.find(r=>r.getEventNames().includes(e))?.options.event}}const cn={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(cn,"IDENTITY",{get:()=>(Kr.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const cc={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},vf={common:0,meters:1,pixels:2},wA={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},QO={multipan:[qO,{threshold:10,direction:Es.Vertical,pointers:2}],pinch:[noe,{},null,["multipan"]],pan:[qO,{threshold:1},["pinch"],["multipan"]],dblclick:[WO,{event:"dblclick",taps:2}],click:[WO,{event:"click"},null,["dblclick"]]};function Aoe(t,e){if(t===e)return!0;if(Array.isArray(t)){const r=t.length;if(!e||e.length!==r)return!1;for(let n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}return!1}function b0(t){let e={},r;return n=>{for(const i in n)if(!Aoe(n[i],e[i])){r=t(n),e=n;break}return r}}const JO=[0,0,0,0],Eoe=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],h5=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Coe=[0,0,0],f5=[0,0,0],Poe=b0(Roe);function d5(t,e,r=f5){r.length<3&&(r=[r[0],r[1],0]);let n=r,i,a=!0;switch(e===cn.LNGLAT_OFFSETS||e===cn.METER_OFFSETS?i=r:i=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case cc.WEB_MERCATOR:(e===cn.LNGLAT||e===cn.CARTESIAN)&&(i=[0,0,0],a=!1);break;case cc.WEB_MERCATOR_AUTO_OFFSET:e===cn.LNGLAT?n=i:e===cn.CARTESIAN&&(n=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],i=t.unprojectPosition(n),n[0]-=r[0],n[1]-=r[1],n[2]-=r[2]);break;case cc.IDENTITY:n=t.position.map(Math.fround),n[2]=n[2]||0;break;case cc.GLOBE:a=!1,i=null;break;default:a=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:n,offsetMode:a}}function Moe(t,e,r){const{viewMatrixUncentered:n,projectionMatrix:i}=t;let{viewMatrix:a,viewProjectionMatrix:c}=t,s=JO,g=JO,_=t.cameraPosition;const{geospatialOrigin:v,shaderCoordinateOrigin:T,offsetMode:M}=d5(t,e,r);return M&&(g=t.projectPosition(v||T),_=[_[0]-g[0],_[1]-g[1],_[2]-g[2]],g[3]=1,s=v0([],g,c),a=n||a,c=vg([],i,a),c=vg([],c,Eoe)),{viewMatrix:a,viewProjectionMatrix:c,projectionCenter:s,originCommon:g,cameraPosCommon:_,shaderCoordinateOrigin:T,geospatialOrigin:v}}function Ioe({viewport:t,devicePixelRatio:e=1,modelMatrix:r=null,coordinateSystem:n=cn.DEFAULT,coordinateOrigin:i=f5,autoWrapLongitude:a=!1}){n===cn.DEFAULT&&(n=t.isGeospatial?cn.LNGLAT:cn.CARTESIAN);const c=Poe({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i});return c.wrapLongitude=a,c.modelMatrix=r||h5,c}function Roe({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:n}){const{projectionCenter:i,viewProjectionMatrix:a,originCommon:c,cameraPosCommon:s,shaderCoordinateOrigin:g,geospatialOrigin:_}=Moe(t,r,n),v=t.getDistanceScales(),T=[t.width*e,t.height*e],M=v0([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,O={coordinateSystem:r,projectionMode:t.projectionMode,coordinateOrigin:g,commonOrigin:c.slice(0,3),center:i,pseudoMeters:!!t._pseudoMeters,viewportSize:T,devicePixelRatio:e,focalDistance:M,commonUnitsPerMeter:v.unitsPerMeter,commonUnitsPerWorldUnit:v.unitsPerMeter,commonUnitsPerWorldUnit2:Coe,scale:t.scale,wrapLongitude:!1,viewProjectionMatrix:a,modelMatrix:h5,cameraPosition:s};if(_){const F=t.getDistanceScales(_);switch(r){case cn.METER_OFFSETS:O.commonUnitsPerWorldUnit=F.unitsPerMeter,O.commonUnitsPerWorldUnit2=F.unitsPerMeter2;break;case cn.LNGLAT:case cn.LNGLAT_OFFSETS:t._pseudoMeters||(O.commonUnitsPerMeter=F.unitsPerMeter),O.commonUnitsPerWorldUnit=F.unitsPerDegree,O.commonUnitsPerWorldUnit2=F.unitsPerDegree2;break;case cn.CARTESIAN:O.commonUnitsPerWorldUnit=[1,1,F.unitsPerMeter[2]],O.commonUnitsPerWorldUnit2=[0,0,F.unitsPerMeter2[2]];break}}return O}const Ooe=Object.keys(cn).map(t=>`const COORDINATE_SYSTEM_${t}: i32 = ${cn[t]};`).join(""),koe=Object.keys(cc).map(t=>`const PROJECTION_MODE_${t}: i32 = ${cc[t]};`).join(""),Doe=Object.keys(vf).map(t=>`const UNIT_${t.toUpperCase()}: i32 = ${vf[t]};`).join(""),Loe=`${Ooe}
${koe}
${Doe}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,Boe=`${Loe}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,Noe=Object.keys(cn).map(t=>`const int COORDINATE_SYSTEM_${t} = ${cn[t]};`).join(""),zoe=Object.keys(cc).map(t=>`const int PROJECTION_MODE_${t} = ${cc[t]};`).join(""),Foe=Object.keys(vf).map(t=>`const int UNIT_${t.toUpperCase()} = ${vf[t]};`).join(""),Uoe=`${Noe}
${zoe}
${Foe}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,joe={};function Voe(t=joe){return"viewport"in t?Ioe(t):{}}const hC={name:"project",dependencies:[lae,i5],source:Boe,vs:Uoe,getUniforms:Voe,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},$oe=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,Hoe=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,x0={name:"project32",dependencies:[hC],source:$oe,vs:Hoe};function Woe(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function uy(t,e){const r=v0([],e,t);return Qse(r,r,1/r[3]),r}function ek(t,e){const r=t%e;return r<0?e+r:r}function TA(t,e,r){return t<e?e:t>r?r:t}function qoe(t){return Math.log(t)*Math.LOG2E}const fC=Math.log2||qoe;function bf(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const su=Math.PI,p5=su/4,dc=su/180,SA=180/su,Sy=512,v1=4003e4,Xb=85.051129,Goe=1.5;function Xoe(t){return fC(t)}function b1(t){const[e,r]=t;bf(Number.isFinite(e)),bf(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude");const n=e*dc,i=r*dc,a=Sy*(n+su)/(2*su),c=Sy*(su+Math.log(Math.tan(p5+i*.5)))/(2*su);return[a,c]}function Ay(t){const[e,r]=t,n=e/Sy*(2*su)-su,i=2*(Math.atan(Math.exp(r/Sy*(2*su)-su))-p5);return[n*SA,i*SA]}function Zoe(t){const{latitude:e}=t;bf(Number.isFinite(e));const r=Math.cos(e*dc);return Xoe(v1*r)-9}function WT(t){const e=Math.cos(t*dc);return Sy/v1/e}function AA(t){const{latitude:e,longitude:r,highPrecision:n=!1}=t;bf(Number.isFinite(e)&&Number.isFinite(r));const i=Sy,a=Math.cos(e*dc),c=i/360,s=c/a,g=i/v1/a,_={unitsPerMeter:[g,g,g],metersPerUnit:[1/g,1/g,1/g],unitsPerDegree:[c,s,g],degreesPerUnit:[1/c,1/s,1/g]};if(n){const v=dc*Math.tan(e*dc)/a,T=c*v/2,M=i/v1*v,O=M/s*g;_.unitsPerDegree2=[0,T,M],_.unitsPerMeter2=[O,0,O]}return _}function g5(t,e){const[r,n,i]=t,[a,c,s]=e,{unitsPerMeter:g,unitsPerMeter2:_}=AA({longitude:r,latitude:n,highPrecision:!0}),v=b1(t);v[0]+=a*(g[0]+_[0]*c),v[1]+=c*(g[1]+_[1]*c);const T=Ay(v),M=(i||0)+(s||0);return Number.isFinite(i)||Number.isFinite(s)?[T[0],T[1],M]:T}function Yoe(t){const{height:e,pitch:r,bearing:n,altitude:i,scale:a,center:c}=t,s=Woe();y1(s,s,[0,0,-i]),Jz(s,s,-r*dc),e5(s,s,n*dc);const g=a/e;return uC(s,s,[g,g,g]),c&&y1(s,s,Pse([],c)),s}function Koe(t){const{width:e,height:r,altitude:n,pitch:i=0,offset:a,center:c,scale:s,nearZMultiplier:g=1,farZMultiplier:_=1}=t;let{fovy:v=x1(Goe)}=t;n!==void 0&&(v=x1(n));const T=v*dc,M=i*dc,O=m5(v);let F=O;c&&(F+=c[2]*s/Math.cos(M)/r);const j=T*(.5+(a?a[1]:0)/r),V=Math.sin(j)*F/Math.sin(TA(Math.PI/2-M-j,.01,Math.PI-.01)),q=Math.sin(M)*V+F,Y=F*10,X=Math.min(q*_,Y);return{fov:T,aspect:e/r,focalDistance:O,near:g,far:X}}function x1(t){return 2*Math.atan(.5/t)*SA}function m5(t){return .5/Math.tan(.5*t*dc)}function y5(t,e){const[r,n,i=0]=t;return bf(Number.isFinite(r)&&Number.isFinite(n)&&Number.isFinite(i)),uy(e,[r,n,i,1])}function dC(t,e,r=0){const[n,i,a]=t;if(bf(Number.isFinite(n)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(a))return uy(e,[n,i,a,1]);const c=uy(e,[n,i,0,1]),s=uy(e,[n,i,1,1]),g=c[2],_=s[2],v=g===_?0:((r||0)-g)/(_-g);return Yz([],c,s,v)}function Qoe(t){const{width:e,height:r,bounds:n,minExtent:i=0,maxZoom:a=24,offset:c=[0,0]}=t,[[s,g],[_,v]]=n,T=Joe(t.padding),M=b1([s,TA(v,-Xb,Xb)]),O=b1([_,TA(g,-Xb,Xb)]),F=[Math.max(Math.abs(O[0]-M[0]),i),Math.max(Math.abs(O[1]-M[1]),i)],j=[e-T.left-T.right-Math.abs(c[0])*2,r-T.top-T.bottom-Math.abs(c[1])*2];bf(j[0]>0&&j[1]>0);const V=j[0]/F[0],q=j[1]/F[1],Y=(T.right-T.left)/2/V,X=(T.top-T.bottom)/2/q,ae=[(O[0]+M[0])/2+Y,(O[1]+M[1])/2+X],ue=Ay(ae),ge=Math.min(a,fC(Math.abs(Math.min(V,q))));return bf(Number.isFinite(ge)),{longitude:ue[0],latitude:ue[1],zoom:ge}}function Joe(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(bf(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const tk=Math.PI/180;function ele(t,e=0){const{width:r,height:n,unproject:i}=t,a={targetZ:e},c=i([0,n],a),s=i([r,n],a);let g,_;const v=t.fovy?.5*t.fovy*tk:Math.atan(.5/t.altitude),T=(90-t.pitch)*tk;return v>T-.01?(g=rk(t,0,e),_=rk(t,r,e)):(g=i([0,0],a),_=i([r,0],a)),[c,s,_,g]}function rk(t,e,r){const{pixelUnprojectionMatrix:n}=t,i=uy(n,[e,0,1,1]),a=uy(n,[e,t.height,1,1]),s=(r*t.distanceScales.unitsPerMeter[2]-i[2])/(a[2]-i[2]),g=Yz([],i,a,s),_=Ay(g);return _.push(r),_}const nk=512;function tle(t){const{width:e,height:r,pitch:n=0}=t;let{longitude:i,latitude:a,zoom:c,bearing:s=0}=t;(i<-180||i>180)&&(i=ek(i+180,360)-180),(s<-180||s>180)&&(s=ek(s+180,360)-180);const g=fC(r/nk);if(c<=g)c=g,a=0;else{const _=r/2/Math.pow(2,c),v=Ay([0,_])[1];if(a<v)a=v;else{const T=Ay([0,nk-_])[1];a>T&&(a=T)}}return{width:e,height:r,longitude:i,latitude:a,zoom:c,pitch:n,bearing:s}}const _5=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,rle=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,nle=`
${_5}
${rle}
`,ile=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,sle=`
${_5}
${ile}
`,ale=b0(hle),ole=b0(fle),lle=[0,0,0,1],cle=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function ule(t,e){const[r,n,i]=t,a=dC([r,n,i],e);return Number.isFinite(i)?a:[a[0],a[1],0]}function hle({viewport:t,center:e}){return new ch(t.viewProjectionMatrix).invert().transform(e)}function fle({viewport:t,shadowMatrices:e}){const r=[],n=t.pixelUnprojectionMatrix,i=t.isGeospatial?void 0:1,a=[[0,0,i],[t.width,0,i],[0,t.height,i],[t.width,t.height,i],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(c=>ule(c,n));for(const c of e){const s=c.clone().translate(new lh(t.center).negate()),g=a.map(v=>s.transform(v)),_=new ch().ortho({left:Math.min(...g.map(v=>v[0])),right:Math.max(...g.map(v=>v[0])),bottom:Math.min(...g.map(v=>v[1])),top:Math.max(...g.map(v=>v[1])),near:Math.min(...g.map(v=>-v[2])),far:Math.max(...g.map(v=>-v[2]))});r.push(_.multiplyRight(c))}return r}function dle(t){const{shadowEnabled:e=!0,project:r}=t;if(!e||!r||!t.shadowMatrices||!t.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const n=hC.getUniforms(r),i=ale({viewport:r.viewport,center:n.center}),a=[],c=ole({shadowMatrices:t.shadowMatrices,viewport:r.viewport}).slice();for(let g=0;g<t.shadowMatrices.length;g++){const _=c[g],v=_.clone().translate(new lh(r.viewport.center).negate());n.coordinateSystem===cn.LNGLAT&&n.projectionMode===cc.WEB_MERCATOR?(c[g]=v,a[g]=i):(c[g]=_.clone().multiplyRight(cle),a[g]=v.transform(i))}const s={drawShadowMap:!!t.drawToShadowMap,useShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,color:t.shadowColor||lle,lightId:t.shadowLightId||0,lightCount:t.shadowMatrices.length,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};for(let g=0;g<c.length;g++)s[`viewProjectionMatrix${g}`]=c[g],s[`projectCenter${g}`]=a[g];for(let g=0;g<2;g++)s[`shadow_uShadowMap${g}`]=t.shadowMaps&&t.shadowMaps[g]||t.dummyShadowMap;return s}const ik={name:"shadow",dependencies:[hC],vs:nle,fs:sle,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:dle,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},w0={...LO,defaultUniforms:{...LO.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},ple=[i5],gle=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],mle=[];function yle(t){const e=ug.getDefaultShaderAssembler();for(const n of ple)e.addDefaultModule(n);e._hookFunctions.length=0;const r=t==="glsl"?gle:mle;for(const n of r)e.addShaderHook(n);return e}const _le=[255,255,255],vle=1;let ble=0;class v5{constructor(e={}){this.type="ambient";const{color:r=_le}=e,{intensity:n=vle}=e;this.id=e.id||`ambient-${ble++}`,this.color=r,this.intensity=n}}const xle=[255,255,255],wle=1,Tle=[0,0,-1];let Sle=0;class EA{constructor(e={}){this.type="directional";const{color:r=xle}=e,{intensity:n=wle}=e,{direction:i=Tle}=e,{_shadow:a=!1}=e;this.id=e.id||`directional-${Sle++}`,this.color=r,this.intensity=n,this.type="directional",this.direction=new lh(i).normalize().toArray(),this.shadow=a}getProjectedLight(e){return this}}class Ale{constructor(e,r={id:"pass"}){const{id:n}=r;this.id=n,this.device=e,this.props={...r}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class pC extends Ale{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[r,n]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,a=e.clearColor??(i?[0,0,0,0]:!1),c=i?1:!1,s=i?0:!1,g=e.colorMask??15,_={viewport:[0,0,r,n]};e.colorMask&&(_.colorMask=g),e.scissorRect&&(_.scissorRect=e.scissorRect);const v=this.device.beginRenderPass({framebuffer:e.target,parameters:_,clearColor:a,clearDepth:c,clearStencil:s});try{return this._drawLayers(v,e)}finally{v.end(),this.device.submit()}}_drawLayers(e,r){const{target:n,shaderModuleProps:i,viewports:a,views:c,onViewportActive:s,clearStack:g=!0}=r;r.pass=r.pass||"unknown",g&&(this._lastRenderIndex=-1);const _=[];for(const v of a){const T=c&&c[v.id];s?.(v);const M=this._getDrawLayerParams(v,r),O=v.subViewports||[v];for(const F of O){const j=this._drawLayersInViewport(e,{target:n,shaderModuleProps:i,viewport:F,view:T,pass:r.pass,layers:r.layers},M);_.push(j)}}return _}_getDrawLayerParams(e,{layers:r,pass:n,isPicking:i=!1,layerFilter:a,cullRect:c,effects:s,shaderModuleProps:g},_=!1){const v=[],T=b5(this._lastRenderIndex+1),M={layer:r[0],viewport:e,isPicking:i,renderPass:n,cullRect:c},O={};for(let F=0;F<r.length;F++){const j=r[F],V=this._shouldDrawLayer(j,M,a,O),q={shouldDrawLayer:V};V&&!_&&(q.shouldDrawLayer=!0,q.layerRenderIndex=T(j,V),q.shaderModuleProps=this._getShaderModuleProps(j,s,n,g),q.layerParameters={...j.context.deck?.props.parameters,...this.getLayerParameters(j,F,e)}),v[F]=q}return v}_drawLayersInViewport(e,{layers:r,shaderModuleProps:n,pass:i,target:a,viewport:c,view:s},g){const _=Ele(this.device,{shaderModuleProps:n,target:a,viewport:c});if(s){const{clear:T,clearColor:M,clearDepth:O,clearStencil:F}=s.props;if(T){let j=[0,0,0,0],V=1,q=0;Array.isArray(M)?j=[...M.slice(0,3),M[3]||255].map(X=>X/255):M===!1&&(j=!1),O!==void 0&&(V=O),F!==void 0&&(q=F),this.device.beginRenderPass({framebuffer:a,parameters:{viewport:_,scissorRect:_},clearColor:j,clearDepth:V,clearStencil:q}).end()}}const v={totalCount:r.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:_});for(let T=0;T<r.length;T++){const M=r[T],O=g[T],{shouldDrawLayer:F}=O;if(F&&M.props.pickable&&v.pickableCount++,M.isComposite&&v.compositeCount++,M.isDrawable&&O.shouldDrawLayer){const{layerRenderIndex:j,shaderModuleProps:V,layerParameters:q}=O;v.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,j),V.project&&(V.project.viewport=c),M.context.renderPass=e;try{M._drawLayer({renderPass:e,shaderModuleProps:V,uniforms:{layerIndex:j},parameters:q})}catch(Y){M.raiseError(Y,`drawing ${M} to ${i}`)}}}return v}shouldDrawLayer(e){return!0}getShaderModuleProps(e,r,n){return null}getLayerParameters(e,r,n){return e.props.parameters}_shouldDrawLayer(e,r,n,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;r.layer=e;let c=e.parent;for(;c;){if(!c.props.visible||!c.filterSubLayer(r))return!1;r.layer=c,c=c.parent}if(n){const s=r.layer.id;if(s in i||(i[s]=n(r)),!i[s])return!1}return e.activateViewport(r.viewport),!0}_getShaderModuleProps(e,r,n,i){const a=this.device.canvasContext.cssToDeviceRatio(),c=e.internalState?.propsInTransition||e.props,s={layer:c,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:a,modelMatrix:c.modelMatrix,coordinateSystem:c.coordinateSystem,coordinateOrigin:c.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(r)for(const g of r)sk(s,g.getShaderModuleProps?.(e,s));return sk(s,this.getShaderModuleProps(e,r,s),i)}}function b5(t=0,e={}){const r={},n=(i,a)=>{const c=i.props._offset,s=i.id,g=i.parent&&i.parent.id;let _;if(g&&!(g in e)&&n(i.parent,!1),g in r){const v=r[g]=r[g]||b5(e[g],e);_=v(i,a),r[s]=v}else Number.isFinite(c)?(_=c+(e[g]||0),r[s]=null):_=t;return a&&_>=t&&(t=_+1),e[s]=_,_};return n}function Ele(t,{shaderModuleProps:e,target:r,viewport:n}){const i=e?.project?.devicePixelRatio??t.canvasContext.cssToDeviceRatio(),[,a]=t.canvasContext.getDrawingBufferSize(),c=r?r.height:a,s=n;return[s.x*i,c-(s.y+s.height)*i,s.width*i,s.height*i]}function sk(t,...e){for(const r of e)if(r)for(const n in r)t[n]?Object.assign(t[n],r[n]):t[n]=r[n];return t}class Cle extends pC{constructor(e,r){super(e,r);const n=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),i=e.createTexture({format:"depth16unorm",width:1,height:1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[n],depthStencilAttachment:i})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const r=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],a=i.width*n,c=i.height*n,s=[1,1,1,1];(a!==r.width||c!==r.height)&&r.resize({width:a,height:c}),super.render({...e,clearColor:s,target:r,pass:"shadow"})}getLayerParameters(e,r,n){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,r,n){return{shadow:{project:n.project,drawToShadowMap:!0}}}}const Ple={color:[255,255,255],intensity:1},ak=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],Mle=[0,0,0,200/255];class gC{constructor(e={}){this.id="lighting-effect",this.shadowColor=Mle,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:r,deck:n}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(r),n._addDefaultShaderModule(ik),this.dummyShadowMap=r.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const r in e){const n=e[r];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(r=>r.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:r,viewports:n,onViewportActive:i,views:a}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let c=0;c<this.shadowPasses.length;c++)this.shadowPasses[c].render({layers:e,layerFilter:r,viewports:n,onViewportActive:i,views:a,shaderModuleProps:{shadow:{shadowLightId:c,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,r){const n=this.shadow?{project:r.project,shadowMaps:this.shadowPasses.map(c=>c.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},i={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(c=>c.getProjectedLight({layer:e})),pointLights:this.pointLights.map(c=>c.getProjectedLight({layer:e}))},a=e.props.material;return{shadow:n,lighting:i,phongMaterial:a,gouraudMaterial:a}}cleanup(e){for(const r of this.shadowPasses)r.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(ik))}_calculateMatrices(){const e=[];for(const r of this.directionalLights){const n=new ch().lookAt({eye:new lh(r.direction).negate()});e.push(n)}return e}_createShadowPasses(e){for(let r=0;r<this.directionalLights.length;r++){const n=new Cle(e);this.shadowPasses[r]=n}}_applyDefaultLights(){const{ambientLight:e,pointLights:r,directionalLights:n}=this;!e&&r.length===0&&n.length===0&&(this.ambientLight=new v5(Ple),this.directionalLights.push(new EA(ak[0]),new EA(ak[1])))}}class Ile{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,r,{size:n=1,type:i,padding:a=0,copy:c=!1,initialize:s=!1,maxCount:g}){const _=i||e&&e.constructor||Float32Array,v=r*n+a;if(ArrayBuffer.isView(e)){if(v<=e.length)return e;if(v*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new _(e.buffer,0,v)}let T=1/0;g&&(T=g*n+a);const M=this._allocate(_,v,s,T);return e&&c?M.set(e):s||M.fill(0,0,4),this._release(e),M}release(e){this._release(e)}_allocate(e,r,n,i){let a=Math.max(Math.ceil(r*this.opts.overAlloc),1);a>i&&(a=i);const c=this._pool,s=e.BYTES_PER_ELEMENT*a,g=c.findIndex(_=>_.byteLength>=s);if(g>=0){const _=new e(c.splice(g,1)[0],0,a);return n&&_.fill(0),_}return new e(a)}_release(e){if(!ArrayBuffer.isView(e))return;const r=this._pool,{buffer:n}=e,{byteLength:i}=n,a=r.findIndex(c=>c.byteLength>=i);a<0?r.push(n):(a>0||r.length<this.opts.poolSize)&&r.splice(a,0,n),r.length>this.opts.poolSize&&r.shift()}}const Ey=new Ile;function yv(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Rle(t){return[t[12],t[13],t[14]]}function Ole(t){return{left:Zm(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Zm(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Zm(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Zm(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Zm(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Zm(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const ok=new lh;function Zm(t,e,r,n){ok.set(t,e,r);const i=ok.len();return{distance:n/i,normal:new lh(-t/i,-e/i,-r/i)}}function kle(t){return t-Math.fround(t)}let lv;function qT(t,e){const{size:r=1,startIndex:n=0}=e,i=e.endIndex!==void 0?e.endIndex:t.length,a=(i-n)/r;lv=Ey.allocate(lv,a,{type:Float32Array,size:r*2});let c=n,s=0;for(;c<i;){for(let g=0;g<r;g++){const _=t[c++];lv[s+g]=_,lv[s+g+r]=kle(_)}s+=r*2}return lv.subarray(0,a*r*2)}function Dle(t){let e=null,r=!1;for(const n of t)n&&(e?(r||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],r=!0),e[0][0]=Math.min(e[0][0],n[0][0]),e[0][1]=Math.min(e[0][1],n[0][1]),e[1][0]=Math.max(e[1][0],n[1][0]),e[1][1]=Math.max(e[1][1],n[1][1])):e=n);return e}const Lle=Math.PI/180,Ble=yv(),lk=[0,0,0],Nle={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function zle({width:t,height:e,orthographic:r,fovyRadians:n,focalDistance:i,padding:a,near:c,far:s}){const g=t/e,_=r?new ch().orthographic({fovy:n,aspect:g,focalDistance:i,near:c,far:s}):new ch().perspective({fovy:n,aspect:g,near:c,far:s});if(a){const{left:v=0,right:T=0,top:M=0,bottom:O=0}=a,F=Od((v+t-T)/2,0,t)-t/2,j=Od((M+e-O)/2,0,e)-e/2;_[8]-=F*2/t,_[9]+=j*2/e}return _}class T0{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||Nle,this.focalDistance=e.focalDistance||1,this.position=e.position||lk,this.modelMatrix=e.modelMatrix||null;const{longitude:r,latitude:n}=e;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(r),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?cc.WEB_MERCATOR:cc.WEB_MERCATOR_AUTO_OFFSET:cc.IDENTITY}equals(e){return e instanceof T0?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Zv(e.projectionMatrix,this.projectionMatrix)&&Zv(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:r=!0}={}){const n=this.projectPosition(e),i=y5(n,this.pixelProjectionMatrix),[a,c]=i,s=r?c:this.height-c;return e.length===2?[a,s]:[a,s,i[2]]}unproject(e,{topLeft:r=!0,targetZ:n}={}){const[i,a,c]=e,s=r?a:this.height-a,g=n&&n*this.distanceScales.unitsPerMeter[2],_=dC([i,s,c],this.pixelUnprojectionMatrix,g),[v,T,M]=this.unprojectPosition(_);return Number.isFinite(c)?[v,T,M]:Number.isFinite(n)?[v,T,n]:[v,T]}projectPosition(e){const[r,n]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[r,n,i]}unprojectPosition(e){const[r,n]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[r,n,i]}projectFlat(e){if(this.isGeospatial){const r=b1(e);return r[1]=Od(r[1],-318,830),r}return e}unprojectFlat(e){return this.isGeospatial?Ay(e):e}getBounds(e={}){const r={targetZ:e.z||0},n=this.unproject([0,0],r),i=this.unproject([this.width,0],r),a=this.unproject([0,this.height],r),c=this.unproject([this.width,this.height],r);return[Math.min(n[0],i[0],a[0],c[0]),Math.min(n[1],i[1],a[1],c[1]),Math.max(n[0],i[0],a[0],c[0]),Math.max(n[1],i[1],a[1],c[1])]}getDistanceScales(e){return e&&this.isGeospatial?AA({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:r,width:n=1,height:i=1}){return e<this.x+this.width&&this.x<e+n&&r<this.y+this.height&&this.y<r+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,Ole(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,r){return null}_initProps(e){const r=e.longitude,n=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=Zoe({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||AA({latitude:n,longitude:r}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:a,modelMatrix:c}=e;let s=lk;if(a&&(s=c?new ch(c).transformAsVector(a,[]):a),this.isGeospatial){const g=this.projectPosition([r,n,0]);this.center=new lh(s).scale(this.distanceScales.unitsPerMeter).add(g)}else this.center=this.projectPosition(s)}_initMatrices(e){const{viewMatrix:r=Ble,projectionMatrix:n=null,orthographic:i=!1,fovyRadians:a,fovy:c=75,near:s=.1,far:g=1e3,padding:_=null,focalDistance:v=1}=e;this.viewMatrixUncentered=r,this.viewMatrix=new ch().multiplyRight(r).translate(new lh(this.center).negate()),this.projectionMatrix=n||zle({width:this.width,height:this.height,orthographic:i,fovyRadians:a||c*Lle,focalDistance:v,padding:_,near:s,far:g});const T=yv();vg(T,T,this.projectionMatrix),vg(T,T,this.viewMatrix),this.viewProjectionMatrix=T,this.viewMatrixInverse=mA([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=Rle(this.viewMatrixInverse);const M=yv(),O=yv();uC(M,M,[this.width/2,-this.height/2,1]),y1(M,M,[1,-1,0]),vg(O,M,this.viewProjectionMatrix),this.pixelProjectionMatrix=O,this.pixelUnprojectionMatrix=mA(yv(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Kr.warn("Pixel project matrix not invertible")()}}T0.displayName="Viewport";class Cy extends T0{constructor(e={}){const{latitude:r=0,longitude:n=0,zoom:i=0,pitch:a=0,bearing:c=0,nearZMultiplier:s=.1,farZMultiplier:g=1.01,nearZ:_,farZ:v,orthographic:T=!1,projectionMatrix:M,repeat:O=!1,worldOffset:F=0,position:j,padding:V,legacyMeterSizes:q=!1}=e;let{width:Y,height:X,altitude:ae=1.5}=e;const ue=Math.pow(2,i);Y=Y||1,X=X||1;let ge,Le=null;if(M)ae=M[5]/2,ge=x1(ae);else{e.fovy?(ge=e.fovy,ae=m5(ge)):ge=x1(ae);let Ze;if(V){const{top:_t=0,bottom:it=0}=V;Ze=[0,Od((_t+X-it)/2,0,X)-X/2]}Le=Koe({width:Y,height:X,scale:ue,center:j&&[0,0,j[2]*WT(r)],offset:Ze,pitch:a,fovy:ge,nearZMultiplier:s,farZMultiplier:g}),Number.isFinite(_)&&(Le.near=_),Number.isFinite(v)&&(Le.far=v)}let qe=Yoe({height:X,pitch:a,bearing:c,scale:ue,altitude:ae});F&&(qe=new ch().translate([512*F,0,0]).multiplyLeft(qe)),super({...e,width:Y,height:X,viewMatrix:qe,longitude:n,latitude:r,zoom:i,...Le,fovy:ge,focalDistance:ae}),this.latitude=r,this.longitude=n,this.zoom=i,this.pitch=a,this.bearing=c,this.altitude=ae,this.fovy=ge,this.orthographic=T,this._subViewports=O?[]:null,this._pseudoMeters=q,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),r=Math.floor((e[0]+180)/360),n=Math.ceil((e[2]-180)/360);for(let i=r;i<=n;i++){const a=i?new Cy({...this,worldOffset:i}):this;this._subViewports.push(a)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[r,n]=this.projectFlat(e),i=(e[2]||0)*WT(e[1]);return[r,n,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[r,n]=this.unprojectFlat(e),i=(e[2]||0)/WT(n);return[r,n,i]}addMetersToLngLat(e,r){return g5(e,r)}panByPosition(e,r){const n=dC(r,this.pixelUnprojectionMatrix),i=this.projectFlat(e),a=kO([],i,wse([],n)),c=kO([],this.center,a),[s,g]=this.unprojectFlat(c);return{longitude:s,latitude:g}}getBounds(e={}){const r=ele(this,e.z||0);return[Math.min(r[0][0],r[1][0],r[2][0],r[3][0]),Math.min(r[0][1],r[1][1],r[2][1],r[3][1]),Math.max(r[0][0],r[1][0],r[2][0],r[3][0]),Math.max(r[0][1],r[1][1],r[2][1],r[3][1])]}fitBounds(e,r={}){const{width:n,height:i}=this,{longitude:a,latitude:c,zoom:s}=Qoe({width:n,height:i,bounds:e,...r});return new Cy({width:n,height:i,longitude:a,latitude:c,zoom:s})}}Cy.displayName="WebMercatorViewport";const ck=[0,0,0];function GT(t,e,r=!1){const n=e.projectPosition(t);if(r&&e instanceof Cy){const[i,a,c=0]=t,s=e.getDistanceScales([i,a]);n[2]=c*s.unitsPerMeter[2]}return n}function Fle(t){const{viewport:e,modelMatrix:r,coordinateOrigin:n}=t;let{coordinateSystem:i,fromCoordinateSystem:a,fromCoordinateOrigin:c}=t;return i===cn.DEFAULT&&(i=e.isGeospatial?cn.LNGLAT:cn.CARTESIAN),a===void 0&&(a=i),c===void 0&&(c=n),{viewport:e,coordinateSystem:i,coordinateOrigin:n,modelMatrix:r,fromCoordinateSystem:a,fromCoordinateOrigin:c}}function x5(t,{viewport:e,modelMatrix:r,coordinateSystem:n,coordinateOrigin:i,offsetMode:a}){let[c,s,g=0]=t;switch(r&&([c,s,g]=v0([],[c,s,g,1],r)),n){case cn.LNGLAT:return GT([c,s,g],e,a);case cn.LNGLAT_OFFSETS:return GT([c+i[0],s+i[1],g+(i[2]||0)],e,a);case cn.METER_OFFSETS:return GT(g5(i,[c,s,g]),e,a);case cn.CARTESIAN:default:return e.isGeospatial?[c+i[0],s+i[1],g+i[2]]:e.projectPosition([c,s,g])}}function Ule(t,e){const{viewport:r,coordinateSystem:n,coordinateOrigin:i,modelMatrix:a,fromCoordinateSystem:c,fromCoordinateOrigin:s}=Fle(e),{autoOffset:g=!0}=e,{geospatialOrigin:_=ck,shaderCoordinateOrigin:v=ck,offsetMode:T=!1}=g?d5(r,n,i):{},M=x5(t,{viewport:r,modelMatrix:a,coordinateSystem:c,coordinateOrigin:s,offsetMode:T});if(T){const O=r.projectPosition(_||v);Nse(M,M,O)}return M}const Rg=Math.PI/180,jle=1e3*60*60*24,Vle=2440588,$le=2451545,w1=Rg*23.4397,Hle=357.5291,Wle=.98560028,qle=280.147,Gle=360.9856235;function Xle(t,e,r){const n=Rg*-r,i=Rg*e,a=Yle(t),c=ice(a),s=tce(a,n)-c.rightAscension;return{azimuth:Jle(s,i,c.declination),altitude:ece(s,i,c.declination)}}function uk(t,e,r){const{azimuth:n,altitude:i}=Xle(t,e,r);return[Math.sin(n)*Math.cos(i),Math.cos(n)*Math.cos(i),-Math.sin(i)]}function Zle(t){return(typeof t=="number"?t:t.getTime())/jle-.5+Vle}function Yle(t){return Zle(t)-$le}function Kle(t,e){const r=t;return Math.atan2(Math.sin(r)*Math.cos(w1)-Math.tan(e)*Math.sin(w1),Math.cos(r))}function Qle(t,e){const r=t;return Math.asin(Math.sin(e)*Math.cos(w1)+Math.cos(e)*Math.sin(w1)*Math.sin(r))}function Jle(t,e,r){const n=t,i=e,a=r;return Math.atan2(Math.sin(n),Math.cos(n)*Math.sin(i)-Math.tan(a)*Math.cos(i))}function ece(t,e,r){const n=t,i=e,a=r;return Math.asin(Math.sin(i)*Math.sin(a)+Math.cos(i)*Math.cos(a)*Math.cos(n))}function tce(t,e){return Rg*(qle+Gle*t)-e}function rce(t){return Rg*(Hle+Wle*t)}function nce(t){const e=t,r=Rg*(1.9148*Math.sin(e)+.02*Math.sin(2*e)+3e-4*Math.sin(3*e)),n=Rg*102.9372;return e+r+n+Math.PI}function ice(t){const e=rce(t),r=nce(e);return{declination:Qle(r,0),rightAscension:Kle(r,0)}}class sce extends EA{constructor(e){super(e),this.timestamp=e.timestamp}getProjectedLight({layer:e}){const{viewport:r}=e.context;if(r.resolution&&r.resolution>0){const[i,a,c]=uk(this.timestamp,0,0);this.direction=[i,-c,a]}else{const{latitude:i,longitude:a}=r;this.direction=uk(this.timestamp,i,a)}return this}}let ace=1,oce=1;class w5{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){const{delay:r=0,duration:n=Number.POSITIVE_INFINITY,rate:i=1,repeat:a=1}=e,c=ace++,s={time:0,delay:r,duration:n,rate:i,repeat:a};return this._setChannelTime(s,this.time),this.channels.set(c,s),c}removeChannel(e){this.channels.delete(e);for(const[r,n]of this.animations)n.channel===e&&this.detachAnimation(r)}isFinished(e){const r=this.channels.get(e);return r===void 0?!1:this.time>=r.delay+r.duration*r.repeat}getTime(e){if(e===void 0)return this.time;const r=this.channels.get(e);return r===void 0?-1:r.time}setTime(e){this.time=Math.max(0,e);const r=this.channels.values();for(const i of r)this._setChannelTime(i,this.time);const n=this.animations.values();for(const i of n){const{animation:a,channel:c}=i;a.setTime(this.getTime(c))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,r){const n=oce++;return this.animations.set(n,{animation:e,channel:r}),e.setTime(this.getTime(r)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,r){const n=r-e.delay,i=e.duration*e.repeat;n>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}function lce(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function cce(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}let uce=0;class mC{static defaultAnimationLoopProps={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>console.error(e),stats:fA.stats.get(`animation-loop-${uce++}`),autoResizeViewport:!1};device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(e){if(this.props={...mC.defaultAnimationLoopProps,...e},e=this.props,!e.device)throw new Error("No device provided");this.stats=e.stats||new ow({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}reportError(e){this.props.onError(e),this._error=e}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const r=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(r),r}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=lce(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(cce(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeViewport()}_initializeAnimationProps(){const e=this.device?.getDefaultCanvasContext();if(!this.device||!e)throw new Error("loop");const r=e?.canvas,n=e.props.useDevicePixels;this.animationProps={animationLoop:this,device:this.device,canvasContext:e,canvas:r,useDevicePixels:n,timeline:this.timeline,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:r,aspect:n}=this._getSizeAndAspect();(e!==this.animationProps.width||r!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=r,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.getDefaultCanvasContext().canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const r=document.createElement("div");r.style.position="absolute",r.style.left="10px",r.style.bottom="10px",r.style.width="300px",r.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(r);const n=this.props.onAddHTML(r);n&&(r.innerHTML=n)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};const[e,r]=this.device?.getDefaultCanvasContext().getDevicePixelSize()||[1,1];let n=1;const i=this.device?.getDefaultCanvasContext().canvas;return i&&i.clientHeight?n=i.clientWidth/i.clientHeight:e>0&&r>0&&(n=e/r),{width:e,height:r,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const XT={};function S0(t="id"){XT[t]=XT[t]||1;const e=XT[t]++;return`${t}-${e}`}class hk{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){if(this.id=e.id||S0("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&Ni.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(const e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function hce(t,e){if(e instanceof hk)return e;const r=fce(t,e),{attributes:n,bufferLayout:i}=dce(t,e);return new hk({topology:e.topology||"triangle-list",bufferLayout:i,vertexCount:e.vertexCount,indices:r,attributes:n})}function fce(t,e){if(!e.indices)return;const r=e.indices.value;return t.createBuffer({usage:Ni.INDEX,data:r})}function dce(t,e){const r=[],n={};for(const[a,c]of Object.entries(e.attributes)){let s=a;switch(a){case"POSITION":s="positions";break;case"NORMAL":s="normals";break;case"TEXCOORD_0":s="texCoords";break;case"COLOR_0":s="colors";break}if(c){n[s]=t.createBuffer({data:c.value,id:`${a}-buffer`});const{value:g,size:_,normalized:v}=c;r.push({name:s,format:Fne(g,_,v)})}}const i=e._calculateVertexCount(e.attributes,e.indices);return{attributes:n,bufferLayout:r,vertexCount:i}}class yC{static defaultProps={..._g.defaultProps};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new yC(e),e._lumaData.defaultPipelineFactory}device;cachingEnabled;destroyPolicy;debug;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};get[Symbol.toStringTag](){return"PipelineFactory"}toString(){return`PipelineFactory(${this.device.id})`}constructor(e){this.device=e,this.cachingEnabled=e.props._cachePipelines,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=e.props.debugFactories}createRenderPipeline(e){if(!this.cachingEnabled)return this.device.createRenderPipeline(e);const r={..._g.defaultProps,...e},n=this._renderPipelineCache,i=this._hashRenderPipeline(r);let a=n[i]?.pipeline;return a?(n[i].useCount++,this.debug&&Dt.warn(`${this}: ${n[i].pipeline} reused, count=${n[i].useCount}, (id=${e.id})`)()):(a=this.device.createRenderPipeline({...r,id:r.id?`${r.id}-cached`:S0("unnamed-cached")}),a.hash=i,n[i]={pipeline:a,useCount:1},this.debug&&Dt.warn(`${this}: ${a} created, count=${n[i].useCount}`)()),a}createComputePipeline(e){if(!this.cachingEnabled)return this.device.createComputePipeline(e);const r={...c1.defaultProps,...e},n=this._computePipelineCache,i=this._hashComputePipeline(r);let a=n[i]?.pipeline;return a?(n[i].useCount++,this.debug&&Dt.warn(`${this}: ${n[i].pipeline} reused, count=${n[i].useCount}, (id=${e.id})`)()):(a=this.device.createComputePipeline({...r,id:r.id?`${r.id}-cached`:void 0}),a.hash=i,n[i]={pipeline:a,useCount:1},this.debug&&Dt.warn(`${this}: ${a} created, count=${n[i].useCount}`)()),a}release(e){if(!this.cachingEnabled){e.destroy();return}const r=this._getCache(e),n=e.hash;r[n].useCount--,r[n].useCount===0?(this._destroyPipeline(e),this.debug&&Dt.warn(`${this}: ${e} released and destroyed`)()):r[n].useCount<0?(Dt.error(`${this}: ${e} released, useCount < 0, resetting`)(),r[n].useCount=0):this.debug&&Dt.warn(`${this}: ${e} released, count=${r[n].useCount}`)()}_destroyPipeline(e){const r=this._getCache(e);switch(this.destroyPolicy){case"never":return!1;case"unused":return delete r[e.hash],e.destroy(),!0}}_getCache(e){let r;if(e instanceof c1&&(r=this._computePipelineCache),e instanceof _g&&(r=this._renderPipelineCache),!r)throw new Error(`${this}`);if(!r[e.hash])throw new Error(`${this}: ${e} matched incorrect entry`);return r}_hashComputePipeline(e){const{type:r}=this.device,n=this._getHash(e.shader.source);return`${r}/C/${n}`}_hashRenderPipeline(e){const r=e.vs?this._getHash(e.vs.source):0,n=e.fs?this._getHash(e.fs.source):0,i="-",a=this._getHash(JSON.stringify(e.bufferLayout)),{type:c}=this.device;switch(c){case"webgl":return`${c}/R/${r}/${n}V${i}BL${a}`;case"webgpu":default:const s=this._getHash(JSON.stringify(e.parameters));return`${c}/R/${r}/${n}V${i}T${e.topology}P${s}BL${a}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}class _C{static defaultProps={...hw.defaultProps};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new _C(e),e._lumaData.defaultShaderFactory}device;cachingEnabled;destroyPolicy;debug;_cache={};get[Symbol.toStringTag](){return"ShaderFactory"}toString(){return`${this[Symbol.toStringTag]}(${this.device.id})`}constructor(e){this.device=e,this.cachingEnabled=e.props._cacheShaders,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=!0}createShader(e){if(!this.cachingEnabled)return this.device.createShader(e);const r=this._hashShader(e);let n=this._cache[r];if(n)n.useCount++,this.debug&&Dt.warn(`${this}: Reusing shader ${n.shader.id} count=${n.useCount}`)();else{const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[r]=n={shader:i,useCount:1},this.debug&&Dt.warn(`${this}: Created new shader ${i.id}`)()}return n.shader}release(e){if(!this.cachingEnabled){e.destroy();return}const r=this._hashShader(e),n=this._cache[r];if(n)if(n.useCount--,n.useCount===0)this.destroyPolicy==="unused"&&(delete this._cache[r],n.shader.destroy(),this.debug&&Dt.warn(`${this}: Releasing shader ${e.id}, destroyed`)());else{if(n.useCount<0)throw new Error(`ShaderFactory: Shader ${e.id} released too many times`);this.debug&&Dt.warn(`${this}: Releasing shader ${e.id} count=${n.useCount}`)()}}_hashShader(e){return`${e.stage}:${e.source}`}}function pce(t,e){const r={},n="Values";if(t.attributes.length===0&&!t.varyings?.length)return{"No attributes or varyings":{[n]:"N/A"}};for(const i of t.attributes)if(i){const a=`${i.location} ${i.name}: ${i.type}`;r[`in ${a}`]={[n]:i.stepMode||"vertex"}}for(const i of t.varyings||[]){const a=`${i.location} ${i.name}`;r[`out ${a}`]={[n]:JSON.stringify(i)}}return r}let Xs=null,ZT=null;function gce(t,{id:e,minimap:r,opaque:n,top:i="0",left:a="0",rgbaScale:c=1}){Xs||(Xs=document.createElement("canvas"),Xs.id=e,Xs.title=e,Xs.style.zIndex="100",Xs.style.position="absolute",Xs.style.top=i,Xs.style.left=a,Xs.style.border="blue 5px solid",Xs.style.transform="scaleY(-1)",document.body.appendChild(Xs),ZT=Xs.getContext("2d")),(Xs.width!==t.width||Xs.height!==t.height)&&(Xs.width=t.width/2,Xs.height=t.height/2,Xs.style.width="400px",Xs.style.height="400px");const s=t.device.readPixelsToArrayWebGL(t),g=ZT?.createImageData(t.width,t.height);if(g){for(let v=0;v<s.length;v+=4)g.data[0+v+0]=s[v+0]*c,g.data[0+v+1]=s[v+1]*c,g.data[0+v+2]=s[v+2]*c,g.data[0+v+3]=n?255:s[v+3]*c;ZT?.putImageData(g,0,0)}}function CA(t,e,r){if(t===e)return!0;if(!r||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!CA(t[n],e[n],r-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const a of n)if(!e.hasOwnProperty(a)||!CA(t[a],e[a],r-1))return!1;return!0}return!1}class YT{bufferLayouts;constructor(e){this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(r=>r.name===e)||null}getAttributeNamesForBuffer(e){return e.attributes?e.attributes?.map(r=>r.attribute):[e.name]}mergeBufferLayouts(e,r){const n=[...e];for(const i of r){const a=n.findIndex(c=>c.name===i.name);a<0?n.push(i):n[a]=i}return n}getBufferIndex(e){const r=this.bufferLayouts.findIndex(n=>n.name===e);return r===-1&&Dt.warn(`BufferLayout: Missing buffer for "${e}".`)(),r}}function mce(t,e){const r=Object.fromEntries(t.attributes.map(i=>[i.name,i.location])),n=e.slice();return n.sort((i,a)=>{const c=i.attributes?i.attributes.map(v=>v.attribute):[i.name],s=a.attributes?a.attributes.map(v=>v.attribute):[a.name],g=Math.min(...c.map(v=>r[v])),_=Math.min(...s.map(v=>r[v]));return g-_}),n}function yce(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function _ce(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":!1}function vce(t){return yce(t)||_ce(t)}function bce(t){return vce(t)||typeof t=="number"||typeof t=="boolean"}function xce(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(r=>{const n=t[r];bce(n)?e.uniforms[r]=n:e.bindings[r]=n}),e}class wce{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(e,r){Object.assign(this.options,r);const n=W3(Object.values(e).filter(i=>i.dependencies));for(const i of n)e[i.name]=i;Dt.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[i,a]of Object.entries(e))this._addModule(a),a.name&&i!==a.name&&!this.options.disableWarnings&&Dt.warn(`Module name: ${i} vs ${a.name}`)()}destroy(){}setProps(e){for(const r of Object.keys(e)){const n=r,i=e[n]||{},a=this.modules[n];if(!a){this.options.disableWarnings||Dt.warn(`Module ${r} not found`)();continue}const c=this.moduleUniforms[n],s=this.moduleBindings[n],g=a.getUniforms?.(i,c)||i,{uniforms:_,bindings:v}=xce(g);this.moduleUniforms[n]={...c,..._},this.moduleBindings[n]={...s,...v}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const r of Object.values(this.moduleBindings))Object.assign(e,r);return e}getDebugTable(){const e={};for(const[r,n]of Object.entries(this.moduleUniforms))for(const[i,a]of Object.entries(n))e[`${r}.${i}`]={type:this.modules[r].uniformTypes?.[i],value:String(a)};return e}_addModule(e){const r=e.name;this.moduleUniforms[r]=e.defaultUniforms||{},this.moduleBindings[r]={}}}let Tce="";async function Sce(t,e){const r=new Image;return r.crossOrigin="anonymous",r.src=t.startsWith("http")?t:Tce+t,await r.decode(),e?await createImageBitmap(r,e):await createImageBitmap(r)}const Ace=["+X","-X","+Y","-Y","+Z","-Z"],Ece=["+X","-X","+Y","-Y","+Z","-Z"];class Rv{device;id;props;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(e,r){this.device=e;const n=S0("async-texture");this.props={...Rv.defaultProps,id:n,...r},this.id=this.props.id,r={...r},typeof r?.data=="string"&&r.dimension==="2d"&&(r.data=Sce(r.data)),r.mipmaps&&(r.mipLevels="auto"),this.ready=new Promise((i,a)=>{this.resolveReady=()=>{this.isReady=!0,i()},this.rejectReady=a}),this.initAsync(r)}async initAsync(e){const r=e.data,n=await T5(r).then(void 0,this.rejectReady);if(this.destroyed)return;const i=this.props.width&&this.props.height?{width:this.props.width,height:this.props.height}:this.getTextureDataSize(n);if(!i)throw new Error("Texture size could not be determined");const a={...i,...e,data:void 0,mipLevels:1},c=this.device.getMipLevelCount(a.width,a.height);if(a.mipLevels=this.props.mipLevels==="auto"?c:Math.min(c,this.props.mipLevels),this.texture=this.device.createTexture(a),this.sampler=this.texture.sampler,this.view=this.texture.view,e.data)switch(this.props.dimension){case"1d":this._setTexture1DData(this.texture,n);break;case"2d":this._setTexture2DData(n);break;case"3d":this._setTexture3DData(this.texture,n);break;case"2d-array":this._setTextureArrayData(this.texture,n);break;case"cube":this._setTextureCubeData(this.texture,n);break;case"cube-array":this._setTextureCubeArrayData(this.texture,n);break}this.props.mipmaps&&this.generateMipmaps(),Dt.info(1,`${this} loaded`),this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}generateMipmaps(){this.texture.generateMipmapsWebGL()}setSampler(e={}){this.texture.setSampler(e instanceof Pg?e:this.device.createSampler(e))}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const r=this.texture;this.texture=r.clone(e),r.destroy()}return!0}isTextureLevelData(e){const r=e?.data;return ArrayBuffer.isView(r)}getTextureDataSize(e){if(!e||ArrayBuffer.isView(e))return null;if(Array.isArray(e))return this.getTextureDataSize(e[0]);if(this.device.isExternalImage(e))return this.device.getExternalImageSize(e);if(e&&typeof e=="object"&&e.constructor===Object){const n=Object.values(e)[0];return{width:n.width,height:n.height}}throw new Error("texture size deduction failed")}getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}setTextureData(e){}_setTexture1DData(e,r){throw new Error("setTexture1DData not supported in WebGL.")}_setTexture2DData(e,r=0){if(!this.texture)throw new Error("Texture not initialized");const n=this._normalizeTextureData(e);n.length>1&&this.props.mipmaps!==!1&&Dt.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let i=0;i<n.length;i++){const a=n[i];this.device.isExternalImage(a)?this.texture.copyExternalImage({image:a,depth:r,mipLevel:i,flipY:!0}):this.texture.copyImageData({data:a.data,mipLevel:i})}}_setTexture3DData(e,r){if(this.texture?.props.dimension!=="3d")throw new Error(this.id);for(let n=0;n<r.length;n++)this._setTexture2DData(r[n],n)}_setTextureCubeData(e,r){if(this.texture?.props.dimension!=="cube")throw new Error(this.id);for(const[n,i]of Object.entries(r)){const a=Ece.indexOf(n);this._setTexture2DData(i,a)}}_setTextureArrayData(e,r){if(this.texture?.props.dimension!=="2d-array")throw new Error(this.id);for(let n=0;n<r.length;n++)this._setTexture2DData(r[n],n)}_setTextureCubeArrayData(e,r){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}_setTextureCubeFaceData(e,r,n,i=0){Array.isArray(r)&&r.length>1&&this.props.mipmaps!==!1&&Dt.warn(`${this.id} has mipmap and multiple LODs.`)();const a=Ace.indexOf(n);this._setTexture2DData(r,a)}_normalizeTextureData(e){const r=this.texture;let n;return ArrayBuffer.isView(e)?n=[{data:e,width:r.width,height:r.height}]:Array.isArray(e)?n=e:n=[e],n}static defaultProps={...Ps.defaultProps,data:null,mipmaps:!1}}async function T5(t){if(t=await t,Array.isArray(t))return await Promise.all(t.map(T5));if(t&&typeof t=="object"&&t.constructor===Object){const e=t,r=await Promise.all(Object.values(e)),n=Object.keys(e),i={};for(let a=0;a<n.length;a++)i[n[a]]=r[a];return i}return t}const eg=2,Cce=1e4;class ou{static defaultProps={..._g.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:ug.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(e,r){this.props={...ou.defaultProps,...r},r=this.props,this.id=r.id||S0("model"),this.device=e,Object.assign(this.userData,r.userData);const n=Object.fromEntries(this.props.modules?.map(g=>[g.name,g])||[]),i=r.shaderInputs||new wce(n,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(i);const a=Mce(e),c=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:g,getUniforms:_}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:a,...this.props,modules:c});this.source=g,this._getModuleUniforms=_,this.props.shaderLayout||=fse(this.source)}else{const{vs:g,fs:_,getUniforms:v}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:a,...this.props,modules:c});this.vs=g,this.fs=_,this._getModuleUniforms=v}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,r.geometry&&this.setGeometry(r.geometry),this.pipelineFactory=r.pipelineFactory||yC.getDefaultPipelineFactory(this.device),this.shaderFactory=r.shaderFactory||_C.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in r&&(this.isInstanced=r.isInstanced),r.instanceCount&&this.setInstanceCount(r.instanceCount),r.vertexCount&&this.setVertexCount(r.vertexCount),r.indexBuffer&&this.setIndexBuffer(r.indexBuffer),r.attributes&&this.setAttributes(r.attributes),r.constantAttributes&&this.setConstantAttributes(r.constantAttributes),r.bindings&&this.setBindings(r.bindings),r.transformFeedback&&(this.transformFeedback=r.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const r=this._areBindingsLoading();if(r)return Dt.info(eg,`>>> DRAWING ABORTED ${this.id}: ${r} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let n;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const i=this._getBindings();this.pipeline.setBindings(i,{disableWarnings:this.props.disableWarnings});const{indexBuffer:a}=this.vertexArray,c=a?a.byteLength/(a.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:c,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){this._gpuGeometry?.destroy();const r=e&&hce(this.device,e);if(r){this.setTopology(r.topology||"triangle-list");const n=new YT(this.bufferLayout);this.bufferLayout=n.mergeBufferLayouts(r.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(r)}this._gpuGeometry=r}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const r=new YT(this.bufferLayout);this.bufferLayout=this._gpuGeometry?r.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){CA(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new Bie(this.shaderInputs.modules);for(const[r,n]of Object.entries(this.shaderInputs.modules))if(Pce(n)){const i=this._uniformStore.getManagedUniformBuffer(this.device,r);this.bindings[`${r}Uniforms`]=i}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,r){const n=r?.disableWarnings??this.props.disableWarnings;e.indices&&Dt.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=mce(this.pipeline.shaderLayout,this.bufferLayout);const i=new YT(this.bufferLayout);for(const[a,c]of Object.entries(e)){const s=i.getBufferLayout(a);if(!s){n||Dt.warn(`Model(${this.id}): Missing layout for buffer "${a}".`)();continue}const g=i.getAttributeNamesForBuffer(s);let _=!1;for(const v of g){const T=this._attributeInfos[v];if(T){const M=this.device.type==="webgpu"?i.getBufferIndex(T.bufferName):T.location;this.vertexArray.setBuffer(M,c),_=!0}}!_&&!n&&Dt.warn(`Model(${this.id}): Ignoring buffer "${c.id}" for unknown attribute "${a}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,r){for(const[n,i]of Object.entries(e)){const a=this._attributeInfos[n];a?this.vertexArray.setConstantWebGL(a.location,i):(r?.disableWarnings??this.props.disableWarnings)||Dt.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof Rv&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[r,n]of Object.entries(this.bindings))n instanceof Rv?n.isReady&&(e[r]=n.texture):e[r]=n;return e}_getBindingsUpdateTimestamp(){let e=0;for(const r of Object.values(this.bindings))r instanceof uw?e=Math.max(e,r.texture.updateTimestamp):r instanceof Ni||r instanceof Ps?e=Math.max(e,r.updateTimestamp):r instanceof Rv?e=r.texture?Math.max(e,r.texture.updateTimestamp):1/0:r instanceof Pg||(e=Math.max(e,r.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const r={...e.attributes};for(const[n]of Object.entries(r))!this.pipeline.shaderLayout.attributes.find(i=>i.name===n)&&n!=="positions"&&delete r[n];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(r,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,r=null;this.pipeline&&(Dt.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,r=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let i=null;this.source?i=n:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:n,fs:i}),this._attributeInfos=Ez(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),r&&this.shaderFactory.release(r)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){const e=Dt.level>3?0:Cce;Dt.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,Dt.group(eg,`>>> DRAWING MODEL ${this.id}`,{collapsed:Dt.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=pce(this.pipeline.shaderLayout,this.id);Dt.table(eg,e)();const r=this.shaderInputs.getDebugTable();Dt.table(eg,r)();const n=this._getAttributeDebugTable();Dt.table(eg,this._attributeInfos)(),Dt.table(eg,n)(),Dt.groupEnd(eg)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){const r=this.device.props.debugFramebuffers;if(this._drawCount++,!r)return;const n=e.props.framebuffer;n&&gce(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[r,n]of Object.entries(this._attributeInfos)){const i=this.vertexArray.attributes[n.location];e[n.location]={name:r,type:n.shaderType,values:i?this._getBufferOrConstantValues(i,n.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:r}=this.vertexArray,n=r.indexType==="uint32"?new Uint32Array(r.debugData):new Uint16Array(r.debugData);e.indices={name:"indices",type:r.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,r){const n=G3(r);return(e instanceof Ni?new n(e.debugData):e).toString()}}function Pce(t){return!!(t.uniformTypes&&!Ice(t.uniformTypes))}function Mce(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function Ice(t){for(const e in t)return!1;return!0}class Py{device;model;transformFeedback;static defaultProps={...ou.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(e){return e?.info?.type==="webgl"}constructor(e,r=Py.defaultProps){if(!Py.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new ou(this.device,{id:r.id||"buffer-transform-model",fs:r.fs||Rne(),topology:r.topology||"point-list",varyings:r.outputs||r.varyings,...r}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:r.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e?.inputBuffers&&this.model.setAttributes(e.inputBuffers),e?.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const r=this.device.beginRenderPass(e);this.model.draw(r),r.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const r=this.getBuffer(e);if(!r)throw new Error("BufferTransform#getBuffer");if(r instanceof Ni)return r.readAsync();const{buffer:n,byteOffset:i=0,byteLength:a=n.byteLength}=r;return n.readAsync(i,a)}}class My{id;topology;vertexCount;indices;attributes;userData={};constructor(e){const{attributes:r={},indices:n=null,vertexCount:i=null}=e;this.id=e.id||S0("geometry"),this.topology=e.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[a,c]of Object.entries(r)){const s=ArrayBuffer.isView(c)?{value:c}:c;if(!ArrayBuffer.isView(s.value))throw new Error(`${this._print(a)}: must be typed array or object with value as typed array`);if((a==="POSITION"||a==="positions")&&!s.size&&(s.size=3),a==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=s}else this.attributes[a]=s}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,r){return this}_calculateVertexCount(e,r){if(r)return r.value.length;let n=1/0;for(const i of Object.values(e)){const{value:a,size:c,constant:s}=i;!s&&a&&c!==void 0&&c>=1&&(n=Math.min(n,a.length/c))}return n}}const Rce={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant",blendAlphaDstFactor:"zero"};class S5 extends pC{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:r,views:n,viewports:i,onViewportActive:a,pickingFBO:c,deviceRect:{x:s,y:g,width:_,height:v},cullRect:T,effects:M,pass:O="picking",pickZ:F,shaderModuleProps:j}){this.pickZ=F;const V=this._resetColorEncoder(F),q=[s,g,_,v],Y=super.render({target:c,layers:e,layerFilter:r,views:n,viewports:i,onViewportActive:a,cullRect:T,effects:M?.filter(ae=>ae.useInPicking),pass:O,isPicking:!0,shaderModuleProps:j,clearColor:[0,0,0,0],colorMask:15,scissorRect:q});return this._colorEncoderState=null,{decodePickingColor:V&&kce.bind(null,V),stats:Y}}shouldDrawLayer(e){const{pickable:r,operation:n}=e.props;return r&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getShaderModuleProps(e,r,n){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,r,n){const i={...e.props.parameters},{pickable:a,operation:c}=e.props;return!this._colorEncoderState||c.includes("terrain")?i.blend=!1:a&&c.includes("draw")&&(Object.assign(i,Rce),i.blend=!0,i.blendColor=Oce(this._colorEncoderState,e,n)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function Oce(t,e,r){const{byLayer:n,byAlpha:i}=t;let a,c=n.get(e);return c?(c.viewports.push(r),a=c.a):(a=n.size+1,a<=255?(c={a,layer:e,viewports:[r]},n.set(e,c),i[a]=c):(Kr.warn("Too many pickable layers, only picking the first 255")(),a=0)),[0,0,0,a/255]}function kce(t,e){const r=t.byAlpha[e[3]];return r&&{pickedLayer:r.layer,pickedViewports:r.viewports,pickedObjectIndex:r.layer.decodePickingColor(e)}}const Qm={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},T1=Symbol.for("component"),Nd=Symbol.for("propTypes"),KT=Symbol.for("deprecatedProps"),hy=Symbol.for("asyncPropDefaults"),Og=Symbol.for("asyncPropOriginal"),kd=Symbol.for("asyncPropResolved");function vC(t,e=()=>!0){return Array.isArray(t)?A5(t,e,[]):e(t)?[t]:[]}function A5(t,e,r){let n=-1;for(;++n<t.length;){const i=t[n];Array.isArray(i)?A5(i,e,r):e(i)&&r.push(i)}return r}function Dce({target:t,source:e,start:r=0,count:n=1}){const i=e.length,a=n*i;let c=0;for(let s=r;c<i;c++)t[s++]=e[c];for(;c<a;)c<a-c?(t.copyWithin(r+c,r,r+c),c*=2):(t.copyWithin(r+c,r,r+a-c),c=a);return t}class Lce{constructor(e,r,n){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=n,this.setData(r)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,r){if(e===this._data&&!r)return;this._data=e;const n=++this._loadCount;let i=e;typeof e=="string"&&(i=s1(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(a=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=a)}).catch(a=>{this._loadCount===n&&(this.isLoaded=!0,this._error=a||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const a of this._subscribers)a.onChange(this.getData())}}class Bce{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:r,forceUpdate:n=!1,persistent:i=!0}){let a=this._resources[e];a?a.setData(r,n):(a=new Lce(e,r,this._context),this._resources[e]=a),a.persistent=i}remove(e){const r=this._resources[e];r&&(r.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const r=this._consumers[e];if(r){for(const n in r){const i=r[n],a=this._resources[i.resourceId];a&&a.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:r,consumerId:n,requestId:i="default"}){const{_resources:a,protocol:c}=this;e.startsWith(c)&&(e=e.replace(c,""),a[e]||this.add({resourceId:e,data:null,persistent:!1}));const s=a[e];if(this._track(n,i,s,r),s)return s.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,r,n,i){const a=this._consumers,c=a[e]=a[e]||{};let s=c[r];const g=s&&s.resourceId&&this._resources[s.resourceId];g&&(g.unsubscribe(s),this.prune()),n&&(s?(s.onChange=i,s.resourceId=n.id):s={onChange:i,resourceId:n.id},c[r]=s,n.subscribe(s))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const r=this._resources[e];!r.persistent&&!r.inUse()&&(r.delete(),delete this._resources[e])}}}const Nce="layerManager.setLayers",zce="layerManager.activateViewport";class Fce{constructor(e,r){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=s=>{ka(zce,this,s),s&&(this.context.viewport=s)};const{deck:n,stats:i,viewport:a,timeline:c}=r||{};this.layers=[],this.resourceManager=new Bce({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:n,shaderAssembler:yle(e?.info?.shadingLanguage||"glsl"),defaultShaderModules:[Aae],renderPass:void 0,stats:i||new ow({id:"deck.gl"}),viewport:a||new T0({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:c||new w5,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let r=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const i=n.getNeedsRedraw(e);r=r||i}return r}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(r=>e.find(n=>r.id.indexOf(n)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,r){ka(Nce,this,r,e),this._lastRenderedLayers=e;const n=vC(e,Boolean);for(const i of n)i.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:r}=this.context;r.find(n=>n.name===e.name)||(r.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:r}=this.context,n=r.findIndex(i=>i.name===e.name);n>=0&&(r.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(e,r,n){n.raiseError(r,`${e} of ${n}`)}_updateLayers(e,r){const n={};for(const c of e)n[c.id]?Kr.warn(`Multiple old layers with same id ${c.id}`)():n[c.id]=c;if(this._defaultShaderModulesChanged){for(const c of e)c.setNeedsUpdate(),c.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(r,n,i),this._finalizeOldLayers(n);let a=!1;for(const c of i)if(c.hasUniformTransition()){a=`Uniform transition in ${c}`;break}this._needsUpdate=a,this.layers=i}_updateSublayersRecursively(e,r,n){for(const i of e){i.context=this.context;const a=r[i.id];a===null&&Kr.warn(`Multiple new layers with same id ${i.id}`)(),r[i.id]=null;let c=null;try{this._debug&&a!==i&&i.validateProps(),a?(this._transferLayerState(a,i),this._updateLayer(i)):this._initializeLayer(i),n.push(i),c=i.isComposite?i.getSubLayers():null}catch(s){this._handleError("matching",s,i)}c&&this._updateSublayersRecursively(c,r,n)}}_finalizeOldLayers(e){for(const r in e){const n=e[r];n&&this._finalizeLayer(n)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Qm.INITIALIZED}catch(r){this._handleError("initialization",r,e)}}_transferLayerState(e,r){r._transferState(e),r.lifecycle=Qm.MATCHED,r!==e&&(e.lifecycle=Qm.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(r){this._handleError("update",r,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=Qm.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Qm.FINALIZED}catch(r){this._handleError("finalization",r,e)}}}function uc(t,e,r){if(t===e)return!0;if(!r||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!uc(t[n],e[n],r-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const a of n)if(!e.hasOwnProperty(a)||!uc(t[a],e[a],r-1))return!1;return!0}return!1}class Uce{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const r=this.controllers[e];r&&r.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const r=this.controllers[e];r&&r.updateTransition()}}getViewports(e){return e?this._viewports.filter(r=>r.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(r=>{e[r.id]=r}),e}getView(e){return this.views.find(r=>r.id===e)}getViewState(e){const r=typeof e=="string"?this.getView(e):e,n=r&&this.viewState[r.getViewStateId()]||this.viewState;return r?r.filterViewState(n):n}getViewport(e){return this._viewportMap[e]}unproject(e,r){const n=this.getViewports(),i={x:e[0],y:e[1]};for(let a=n.length-1;a>=0;--a){const c=n[a];if(c.containsPixel(i)){const s=e.slice();return s[0]-=c.x,s[1]-=c.y,c.unproject(s,r)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,r){(e!==this.width||r!==this.height)&&(this.width=e,this.height=r,this.setNeedsUpdate("Size changed"))}_setViews(e){e=vC(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!uc(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Kr.warn("missing `viewState` or `initialViewState`")()}_createController(e,r){const n=r.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:a=>this.getView(e.id)?.makeViewport({viewState:a,width:this.width,height:this.height})})}_updateController(e,r,n,i){const a=e.controller;if(a&&n){const c={...r,...a,id:e.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!i||i.constructor!==a.type)&&(i=this._createController(e,c)),i&&i.setProps(c),i}return null}_rebuildViewports(){const{views:e}=this,r=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let i=e.length;i--;){const a=e[i],c=this.getViewState(a),s=a.makeViewport({viewState:c,width:this.width,height:this.height});let g=r[a.id];const _=!!a.controller;_&&!g&&(n=!0),(n||!_)&&g&&(g.finalize(),g=null),this.controllers[a.id]=this._updateController(a,c,s,g),s&&this._viewports.unshift(s)}for(const i in r){const a=r[i];a&&!this.controllers[i]&&a.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,r){return e.length!==r.length?!0:e.some((n,i)=>!e[i].equals(r[i]))}}const jce=/([0-9]+\.?[0-9]*)(%|px)/;function Td(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=jce.exec(t);if(e&&e.length>=3){const r=e[2]==="%",n=parseFloat(e[1]);return{position:r?n/100:n,relative:r}}default:throw new Error(`Could not parse position string ${t}`)}}function Sd(t,e){return t.relative?Math.round(t.position*e):t.position}class Iy{constructor(e){const{id:r,x:n=0,y:i=0,width:a="100%",height:c="100%",padding:s=null}=e;this.id=r||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Td(n),this._y=Td(i),this._width=Td(a),this._height=Td(c),this._padding=s&&{left:Td(s.left||0),right:Td(s.right||0),top:Td(s.top||0),bottom:Td(s.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&uc(this.props,e.props,2)}clone(e){const r=this.constructor;return new r({...this.props,...e})}makeViewport({width:e,height:r,viewState:n}){n=this.filterViewState(n);const i=this.getDimensions({width:e,height:r});if(!i.height||!i.width)return null;const a=this.getViewportType(n);return new a({...n,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const r={...e};for(const n in this.props.viewState)n!=="id"&&(r[n]=this.props.viewState[n]);return r}return e}getDimensions({width:e,height:r}){const n={x:Sd(this._x,e),y:Sd(this._y,r),width:Sd(this._width,e),height:Sd(this._height,r)};return this._padding&&(n.padding={left:Sd(this._padding.left,e),top:Sd(this._padding.top,r),right:Sd(this._padding.right,e),bottom:Sd(this._padding.bottom,r)}),n}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class pw{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:e,settings:r}=this;this._handle=e.addChannel({delay:e.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const fk=()=>{},PA={BREAK:1,SNAP_TO_END:2,IGNORE:3},Vce=t=>t,$ce=PA.BREAK;class Hce{constructor(e){this._onTransitionUpdate=r=>{const{time:n,settings:{interpolator:i,startProps:a,endProps:c,duration:s,easing:g}}=r,_=g(n/s),v=i.interpolateProps(a,c,_);this.propsInTransition=this.getControllerState({...this.props,...v}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new pw(e.timeline),this.onViewStateChange=e.onViewStateChange||fk,this.onStateChange=e.onStateChange||fk}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let r=!1;const n=this.props;if(this.props=e,!n||this._shouldIgnoreViewportChange(n,e))return!1;if(this._isTransitionEnabled(e)){let i=n;if(this.transition.inProgress){const{interruption:a,endProps:c}=this.transition.settings;i={...n,...a===PA.SNAP_TO_END?c:this.propsInTransition||n}}this._triggerTransition(i,e),r=!0}else this.transition.cancel();return r}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:r,transitionInterpolator:n}=e;return(r>0||r==="auto")&&!!n}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,r){return this.transition.inProgress?this.transition.settings.interruption===PA.IGNORE||this._isUpdateDueToCurrentTransition(r):this._isTransitionEnabled(r)?r.transitionInterpolator.arePropsEqual(e,r):!0}_triggerTransition(e,r){const n=this.getControllerState(e),i=this.getControllerState(r).shortestPathFrom(n),a=r.transitionInterpolator,c=a.getDuration?a.getDuration(e,r):r.transitionDuration;if(c===0)return;const s=a.initializeProps(e,i);this.propsInTransition={};const g={duration:c,easing:r.transitionEasing||Vce,interpolator:a,interruption:r.transitionInterruption||$ce,startProps:s.start,endProps:s.end,onStart:r.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(r.onTransitionInterrupt),onEnd:this._onTransitionEnd(r.onTransitionEnd)};this.transition.start(g),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return r=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(r)}}}function ca(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class Wce{constructor(e){const{compare:r,extract:n,required:i}=e;this._propsToCompare=r,this._propsToExtract=n||r,this._requiredProps=i}arePropsEqual(e,r){for(const n of this._propsToCompare)if(!(n in e)||!(n in r)||!Zv(e[n],r[n]))return!1;return!0}initializeProps(e,r){const n={},i={};for(const a of this._propsToExtract)(a in e||a in r)&&(n[a]=e[a],i[a]=r[a]);return this._checkRequiredProps(n),this._checkRequiredProps(i),{start:n,end:i}}getDuration(e,r){return r.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(r=>{const n=e[r];ca(Number.isFinite(n)||Array.isArray(n),`${r} is required for transition`)})}}const qce=["longitude","latitude","zoom","bearing","pitch"],Gce=["longitude","latitude","zoom"];class E5 extends Wce{constructor(e={}){const r=Array.isArray(e)?e:e.transitionProps,n=Array.isArray(e)?{}:e;n.transitionProps=Array.isArray(r)?{compare:r,required:r}:r||{compare:qce,required:Gce},super(n.transitionProps),this.opts=n}initializeProps(e,r){const n=super.initializeProps(e,r),{makeViewport:i,around:a}=this.opts;if(i&&a){const c=i(e),s=i(r),g=c.unproject(a);n.start.around=a,Object.assign(n.end,{around:s.project(g),aroundPosition:g,width:r.width,height:r.height})}return n}interpolateProps(e,r,n){const i={};for(const a of this._propsToExtract)i[a]=m1(e[a]||0,r[a]||0,n);if(r.aroundPosition&&this.opts.makeViewport){const a=this.opts.makeViewport({...r,...i});Object.assign(i,a.panByPosition(r.aroundPosition,m1(e.around,r.around,n)))}return i}}const tf={transitionDuration:0},Xce=300,Zb=t=>1-(1-t)*(1-t),Ym={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},tg={};class Zce{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new Hce({...e,getControllerState:r=>new this.ControllerState(r),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const r=this._eventStartBlocked;switch(e.type){case"panstart":return r?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return r?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return r?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:r,y:n}=this.props,{offsetCenter:i}=e;return[i.x-r,i.y-n]}isPointInBounds(e,r){const{width:n,height:i}=this.props;if(r&&r.handled)return!1;const a=e[0]>=0&&e[0]<=n&&e[1]>=0&&e[1]<=i;return a&&r&&r.stopPropagation(),a}isFunctionKeyPressed(e){const{srcEvent:r}=e;return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const r=setTimeout(()=>{this._eventStartBlocked===r&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=r}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:r}=e;this.inertia=Number.isFinite(r)?r:r===!0?Xce:0;const{scrollZoom:n=!0,dragPan:i=!0,dragRotate:a=!0,doubleClickZoom:c=!0,touchZoom:s=!0,touchRotate:g=!1,keyboard:_=!0}=e,v=!!this.onViewStateChange;this.toggleEvents(Ym.WHEEL,v&&n),this.toggleEvents(Ym.PAN,v),this.toggleEvents(Ym.PINCH,v&&(s||g)),this.toggleEvents(Ym.MULTI_PAN,v&&g),this.toggleEvents(Ym.DOUBLE_CLICK,v&&c),this.toggleEvents(Ym.KEYBOARD,v&&_),this.scrollZoom=n,this.dragPan=i,this.dragRotate=a,this.doubleClickZoom=c,this.touchZoom=s,this.touchRotate=g,this.keyboard=_}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,r){this.eventManager&&e.forEach(n=>{this._events[n]!==r&&(this._events[n]=r,r?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(e,r=null,n={}){const i={...e.getViewportProps(),...r},a=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(n),a){const c=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:c,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;let n=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);const i=this.controllerState[n?"panStart":"rotateStart"]({pos:r});return this._panMove=n,this.updateViewport(i,tf,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const r=this.getCenter(e),n=this.controllerState.pan({pos:r});return this.updateViewport(n,tf,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:r}=this;if(this.dragPan&&r&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*r/2,n[1]+e.velocityY*r/2],a=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:Zb},{isDragging:!1,isPanning:!0})}else{const n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const r=this.getCenter(e),n=this.controllerState.rotate({pos:r});return this.updateViewport(n,tf,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:r}=this;if(this.dragRotate&&r&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*r/2,n[1]+e.velocityY*r/2],a=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:Zb},{isDragging:!1,isRotating:!0})}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;e.srcEvent.preventDefault();const{speed:n=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:a}=e;let c=2/(1+Math.exp(-Math.abs(a*n)));a<0&&c!==0&&(c=1/c);const s=i?{...this._getTransitionProps({around:r}),transitionDuration:250}:tf,g=this.controllerState.zoom({pos:r,scale:c});return this.updateViewport(g,s,{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;const n=this.controllerState.rotateStart({pos:r});return this.updateViewport(n,tf,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const r=this.getCenter(e);r[0]-=e.deltaX;const n=this.controllerState.rotate({pos:r});return this.updateViewport(n,tf,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:r}=this;if(this.touchRotate&&r&&e.velocityY){const n=this.getCenter(e),i=[n[0],n[1]+=e.velocityY*r/2],a=this.controllerState.rotate({pos:i});this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:Zb},{isDragging:!1,isRotating:!0}),this.blockEvents(r)}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;const n=this.controllerState.zoomStart({pos:r}).rotateStart({pos:r});return tg._startPinchRotation=e.rotation,tg._lastPinchEvent=e,this.updateViewport(n,tf,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let r=this.controllerState;if(this.touchZoom){const{scale:n}=e,i=this.getCenter(e);r=r.zoom({pos:i,scale:n})}if(this.touchRotate){const{rotation:n}=e;r=r.rotate({deltaAngleX:tg._startPinchRotation-n})}return this.updateViewport(r,tf,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),tg._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:r}=this,{_lastPinchEvent:n}=tg;if(this.touchZoom&&r&&n&&e.scale!==n.scale){const i=this.getCenter(e);let a=this.controllerState.rotateEnd();const c=Math.log2(e.scale),s=(c-Math.log2(n.scale))/(e.deltaTime-n.deltaTime),g=Math.pow(2,c+s*r/2);a=a.zoom({pos:i,scale:g}).zoomEnd(),this.updateViewport(a,{...this._getTransitionProps({around:i}),transitionDuration:r,transitionEasing:Zb},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(r)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return tg._startPinchRotation=null,tg._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;const n=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:r,scale:n?.5:2});return this.updateViewport(i,this._getTransitionProps({around:r}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const r=this.isFunctionKeyPressed(e),{zoomSpeed:n,moveSpeed:i,rotateSpeedX:a,rotateSpeedY:c}=this.keyboard===!0?{}:this.keyboard,{controllerState:s}=this;let g;const _={};switch(e.srcEvent.code){case"Minus":g=r?s.zoomOut(n).zoomOut(n):s.zoomOut(n),_.isZooming=!0;break;case"Equal":g=r?s.zoomIn(n).zoomIn(n):s.zoomIn(n),_.isZooming=!0;break;case"ArrowLeft":r?(g=s.rotateLeft(a),_.isRotating=!0):(g=s.moveLeft(i),_.isPanning=!0);break;case"ArrowRight":r?(g=s.rotateRight(a),_.isRotating=!0):(g=s.moveRight(i),_.isPanning=!0);break;case"ArrowUp":r?(g=s.rotateUp(c),_.isRotating=!0):(g=s.moveUp(i),_.isPanning=!0);break;case"ArrowDown":r?(g=s.rotateDown(c),_.isRotating=!0):(g=s.moveDown(i),_.isPanning=!0);break;default:return!1}return this.updateViewport(g,this._getTransitionProps(),_),!0}_getTransitionProps(e){const{transition:r}=this;return!r||!r.transitionInterpolator?tf:e?{...r,transitionInterpolator:new E5({...e,...r.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:r}}class Yce{constructor(e,r){this._viewportProps=this.applyConstraints(e),this._state=r}getViewportProps(){return this._viewportProps}getState(){return this._state}}const dk=5,Kce=1.2;class Qce extends Yce{constructor(e){const{width:r,height:n,latitude:i,longitude:a,zoom:c,bearing:s=0,pitch:g=0,altitude:_=1.5,position:v=[0,0,0],maxZoom:T=20,minZoom:M=0,maxPitch:O=60,minPitch:F=0,startPanLngLat:j,startZoomLngLat:V,startRotatePos:q,startBearing:Y,startPitch:X,startZoom:ae,normalize:ue=!0}=e;ca(Number.isFinite(a)),ca(Number.isFinite(i)),ca(Number.isFinite(c)),super({width:r,height:n,latitude:i,longitude:a,zoom:c,bearing:s,pitch:g,altitude:_,maxZoom:T,minZoom:M,maxPitch:O,minPitch:F,normalize:ue,position:v},{startPanLngLat:j,startZoomLngLat:V,startRotatePos:q,startBearing:Y,startPitch:X,startZoom:ae}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:r}){const n=this.getState().startPanLngLat||this._unproject(r);if(!n)return this;const a=this.makeViewport(this.getViewportProps()).panByPosition(n,e);return this._getUpdatedState(a)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:r=0,deltaAngleY:n=0}){const{startRotatePos:i,startBearing:a,startPitch:c}=this.getState();if(!i||a===void 0||c===void 0)return this;let s;return e?s=this._getNewRotation(e,i,c,a):s={bearing:a+r,pitch:c+n},this._getUpdatedState(s)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:r,scale:n}){let{startZoom:i,startZoomLngLat:a}=this.getState();if(a||(i=this.getViewportProps().zoom,a=this._unproject(r)||this._unproject(e)),!a)return this;const{maxZoom:c,minZoom:s}=this.getViewportProps();let g=i+Math.log2(n);g=Od(g,s,c);const _=this.makeViewport({...this.getViewportProps(),zoom:g});return this._getUpdatedState({zoom:g,..._.panByPosition(a,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const r=e.getViewportProps(),n={...this.getViewportProps()},{bearing:i,longitude:a}=n;return Math.abs(i-r.bearing)>180&&(n.bearing=i<0?i+360:i-360),Math.abs(a-r.longitude)>180&&(n.longitude=a<0?a+360:a-360),n}applyConstraints(e){const{maxZoom:r,minZoom:n,zoom:i}=e;e.zoom=Od(i,n,r);const{maxPitch:a,minPitch:c,pitch:s}=e;e.pitch=Od(s,c,a);const{normalize:g=!0}=e;return g&&Object.assign(e,tle(e)),e}_zoomFromCenter(e){const{width:r,height:n}=this.getViewportProps();return this.zoom({pos:[r/2,n/2],scale:e})}_panFromCenter(e){const{width:r,height:n}=this.getViewportProps();return this.pan({startPos:[r/2,n/2],pos:[r/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const r=this.makeViewport(this.getViewportProps());return e&&r.unproject(e)}_getNewRotation(e,r,n,i){const a=e[0]-r[0],c=e[1]-r[1],s=e[1],g=r[1],{width:_,height:v}=this.getViewportProps(),T=a/_;let M=0;c>0?Math.abs(v-g)>dk&&(M=c/(g-v)*Kce):c<0&&g>dk&&(M=1-s/g),M=Od(M,-1,1);const{minPitch:O,maxPitch:F}=this.getViewportProps(),j=i+180*T;let V=n;return M>0?V=n+M*(F-n):M<0&&(V=n-M*(O-n)),{pitch:V,bearing:j}}}class Jce extends Zce{constructor(){super(...arguments),this.ControllerState=Qce,this.transition={transitionDuration:300,transitionInterpolator:new E5({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const r=this.props;super.setProps(e),(!r||r.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class C5 extends Iy{constructor(e={}){super(e)}getViewportType(){return Cy}get ControllerType(){return Jce}}C5.displayName="MapView";const eue=new gC;function tue(t,e){const r=t.order??1/0,n=e.order??1/0;return r-n}class rue{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const r=this._defaultEffects;if(!r.find(n=>n.id===e.id)){const n=r.findIndex(i=>tue(i,e)>0);n<0?r.push(e):r.splice(n,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(uc(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}getEffects(){return this._resolvedEffects}_setEffects(e){const r={};for(const i of this.effects)r[i.id]=i;const n=[];for(const i of e){const a=r[i.id];let c=i;a&&a!==i?a.setProps?(a.setProps(i.props),c=a):a.cleanup(this._context):a||i.setup(this._context),n.push(c),delete r[i.id]}for(const i in r)r[i].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),e.some(i=>i instanceof gC)||this._resolvedEffects.push(eue),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class nue extends pC{shouldDrawLayer(e){const{operation:r}=e.props;return r.includes("draw")||r.includes("terrain")}}const iue="deckRenderer.renderLayers";class sue{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new nue(e),this.pickLayersPass=new S5(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const r=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};n.effects&&this._preRender(n.effects,n);const i=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const a=r.render({...n,target:i});n.effects&&(this.lastPostProcessEffect&&(n.clearCanvas=e.clearCanvas===void 0?!0:e.clearCanvas),this._postRender(n.effects,n)),this.renderCount++,ka(iue,this,a,e)}needsRedraw(e={clearRedrawFlags:!1}){const r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}finalize(){const{renderBuffers:e}=this;for(const r of e)r.delete();e.length=0}_preRender(e,r){this.lastPostProcessEffect=null,r.preRenderStats=r.preRenderStats||{};for(const n of e)r.preRenderStats[n.id]=n.preRender(r),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,r=this.device.canvasContext.getDrawingBufferSize(),[n,i]=r;e.length===0&&[0,1].map(a=>{const c=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"},width:n,height:i});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${a}`,colorAttachments:[c]}))});for(const a of e)a.resize(r)}_postRender(e,r){const{renderBuffers:n}=this,i={...r,inputBuffer:n[0],swapBuffer:n[1]};for(const a of e)if(a.postRender){i.target=a.id===this.lastPostProcessEffect?r.target:void 0;const c=a.postRender(i);i.inputBuffer=c,i.swapBuffer=c===n[0]?n[1]:n[0]}}}const aue={pickedColor:null,pickedObjectIndex:-1};function pk({pickedColors:t,decodePickingColor:e,deviceX:r,deviceY:n,deviceRadius:i,deviceRect:a}){const{x:c,y:s,width:g,height:_}=a;let v=i*i,T=-1,M=0;for(let O=0;O<_;O++){const F=O+s-n,j=F*F;if(j>v)M+=4*g;else for(let V=0;V<g;V++){if(t[M+3]-1>=0){const Y=V+c-r,X=Y*Y+j;X<=v&&(v=X,T=M)}M+=4}}if(T>=0){const O=t.slice(T,T+4),F=e(O);if(F){const j=Math.floor(T/4/g),V=T/4-j*g;return{...F,pickedColor:O,pickedX:c+V,pickedY:s+j}}Kr.error("Picked non-existent layer. Is picking buffer corrupt?")()}return aue}function gk({pickedColors:t,decodePickingColor:e}){const r=new Map;if(t){for(let n=0;n<t.length;n+=4)if(t[n+3]-1>=0){const a=t.slice(n,n+4),c=a.join(",");if(!r.has(c)){const s=e(a);s?r.set(c,{...s,color:a}):Kr.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(r.values())}function MA({pickInfo:t,viewports:e,pixelRatio:r,x:n,y:i,z:a}){let c=e[0];e.length>1&&(c=oue(t?.pickedViewports||e,{x:n,y:i}));let s;if(c){const g=[n-c.x,i-c.y];a!==void 0&&(g[2]=a),s=c.unproject(g)}return{color:null,layer:null,viewport:c,index:-1,picked:!1,x:n,y:i,pixel:[n,i],coordinate:s,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:r}}function mk(t){const{pickInfo:e,lastPickedInfo:r,mode:n,layers:i}=t,{pickedColor:a,pickedLayer:c,pickedObjectIndex:s}=e,g=c?[c]:[];if(n==="hover"){const T=r.index,M=r.layerId,O=c?c.props.id:null;if(O!==M||s!==T){if(O!==M){const F=i.find(j=>j.props.id===M);F&&g.unshift(F)}r.layerId=O,r.index=s,r.info=null}}const _=MA(t),v=new Map;return v.set(null,_),g.forEach(T=>{let M={..._};T===c&&(M.color=a,M.index=s,M.picked=!0),M=IA({layer:T,info:M,mode:n});const O=M.layer;T===c&&n==="hover"&&(r.info=M),v.set(O.id,M),n==="hover"&&O.updateAutoHighlight(M)}),v}function IA({layer:t,info:e,mode:r}){for(;t&&e;){const n=e.layer||null;e.sourceLayer=n,e.layer=t,e=t.getPickingInfo({info:e,mode:r,sourceLayer:n}),t=t.parent}return e}function oue(t,e){for(let r=t.length-1;r>=0;r--){const n=t[r];if(n.containsPixel(e))return n}return t[0]}class lue{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new S5(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObjectAsync(e){return this._pickClosestObjectAsync(e)}pickObjectsAsync(e){return this._pickVisibleObjectsAsync(e)}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:r,layers:n,viewports:i},a=this.lastPickedInfo.info){const c=a&&a.layer&&a.layer.id,s=a&&a.viewport&&a.viewport.id,g=c?n.find(M=>M.id===c):null,_=s&&i.find(M=>M.id===s)||i[0],v=_&&_.unproject([e-_.x,r-_.y]);return{...a,...{x:e,y:r,viewport:_,coordinate:v,layer:g}}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const r=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=r}const{canvas:e}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:e.width,height:e.height}),this.depthFBO?.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const r=e.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return r.length?r:null}async _pickClosestObjectAsync({layers:e,views:r,viewports:n,x:i,y:a,radius:c=0,depth:s=1,mode:g="query",unproject3D:_,onViewportActive:v,effects:T}){const M=this.device.canvasContext.cssToDeviceRatio(),O=this._getPickable(e);if(!O||n.length===0)return{result:[],emptyInfo:MA({viewports:n,x:i,y:a,pixelRatio:M})};this._resizeBuffer();const F=this.device.canvasContext.cssToDevicePixels([i,a],!0),j=[F.x+Math.floor(F.width/2),F.y+Math.floor(F.height/2)],V=Math.round(c*M),{width:q,height:Y}=this.pickingFBO,X=this._getPickingRect({deviceX:j[0],deviceY:j[1],deviceRadius:V,deviceWidth:q,deviceHeight:Y}),ae={x:i-c,y:a-c,width:c*2+1,height:c*2+1};let ue;const ge=[],Le=new Set;for(let qe=0;qe<s;qe++){let Ze;if(X){const it=this._drawAndSample({layers:O,views:r,viewports:n,onViewportActive:v,deviceRect:X,cullRect:ae,effects:T,pass:`picking:${g}`});Ze=pk({...it,deviceX:j[0],deviceY:j[1],deviceRadius:V,deviceRect:X})}else Ze={pickedColor:null,pickedObjectIndex:-1};let _t;if(Ze.pickedLayer&&_&&this.depthFBO){const{pickedColors:it}=this._drawAndSample({layers:[Ze.pickedLayer],views:r,viewports:n,onViewportActive:v,deviceRect:{x:Ze.pickedX,y:Ze.pickedY,width:1,height:1},cullRect:ae,effects:T,pass:`picking:${g}:z`},!0);it[3]&&(_t=it[0])}Ze.pickedLayer&&qe+1<s&&(Le.add(Ze.pickedLayer),Ze.pickedLayer.disablePickingIndex(Ze.pickedObjectIndex)),ue=mk({pickInfo:Ze,lastPickedInfo:this.lastPickedInfo,mode:g,layers:O,viewports:n,x:i,y:a,z:_t,pixelRatio:M});for(const it of ue.values())it.layer&&ge.push(it);if(!Ze.pickedColor)break}for(const qe of Le)qe.restorePickingColors();return{result:ge,emptyInfo:ue.get(null)}}_pickClosestObject({layers:e,views:r,viewports:n,x:i,y:a,radius:c=0,depth:s=1,mode:g="query",unproject3D:_,onViewportActive:v,effects:T}){const M=this.device.canvasContext.cssToDeviceRatio(),O=this._getPickable(e);if(!O||n.length===0)return{result:[],emptyInfo:MA({viewports:n,x:i,y:a,pixelRatio:M})};this._resizeBuffer();const F=this.device.canvasContext.cssToDevicePixels([i,a],!0),j=[F.x+Math.floor(F.width/2),F.y+Math.floor(F.height/2)],V=Math.round(c*M),{width:q,height:Y}=this.pickingFBO,X=this._getPickingRect({deviceX:j[0],deviceY:j[1],deviceRadius:V,deviceWidth:q,deviceHeight:Y}),ae={x:i-c,y:a-c,width:c*2+1,height:c*2+1};let ue;const ge=[],Le=new Set;for(let qe=0;qe<s;qe++){let Ze;if(X){const it=this._drawAndSample({layers:O,views:r,viewports:n,onViewportActive:v,deviceRect:X,cullRect:ae,effects:T,pass:`picking:${g}`});Ze=pk({...it,deviceX:j[0],deviceY:j[1],deviceRadius:V,deviceRect:X})}else Ze={pickedColor:null,pickedObjectIndex:-1};let _t;if(Ze.pickedLayer&&_&&this.depthFBO){const{pickedColors:it}=this._drawAndSample({layers:[Ze.pickedLayer],views:r,viewports:n,onViewportActive:v,deviceRect:{x:Ze.pickedX,y:Ze.pickedY,width:1,height:1},cullRect:ae,effects:T,pass:`picking:${g}:z`},!0);it[3]&&(_t=it[0])}Ze.pickedLayer&&qe+1<s&&(Le.add(Ze.pickedLayer),Ze.pickedLayer.disablePickingIndex(Ze.pickedObjectIndex)),ue=mk({pickInfo:Ze,lastPickedInfo:this.lastPickedInfo,mode:g,layers:O,viewports:n,x:i,y:a,z:_t,pixelRatio:M});for(const it of ue.values())it.layer&&ge.push(it);if(!Ze.pickedColor)break}for(const qe of Le)qe.restorePickingColors();return{result:ge,emptyInfo:ue.get(null)}}async _pickVisibleObjectsAsync({layers:e,views:r,viewports:n,x:i,y:a,width:c=1,height:s=1,mode:g="query",maxObjects:_=null,onViewportActive:v,effects:T}){const M=this._getPickable(e);if(!M||n.length===0)return[];this._resizeBuffer();const O=this.device.canvasContext.cssToDeviceRatio(),F=this.device.canvasContext.cssToDevicePixels([i,a],!0),j=F.x,V=F.y+F.height,q=this.device.canvasContext.cssToDevicePixels([i+c,a+s],!0),Y=q.x+q.width,X=q.y,ae={x:j,y:X,width:Y-j,height:V-X},ue=this._drawAndSample({layers:M,views:r,viewports:n,onViewportActive:v,deviceRect:ae,cullRect:{x:i,y:a,width:c,height:s},effects:T,pass:`picking:${g}`}),ge=gk(ue),Le=new Map,qe=[],Ze=Number.isFinite(_);for(let _t=0;_t<ge.length&&!(Ze&&qe.length>=_);_t++){const it=ge[_t];let gt={color:it.pickedColor,layer:null,index:it.pickedObjectIndex,picked:!0,x:i,y:a,pixelRatio:O};gt=IA({layer:it.pickedLayer,info:gt,mode:g});const Lt=gt.layer.id;Le.has(Lt)||Le.set(Lt,new Set);const Ot=Le.get(Lt),Yt=gt.object??gt.index;Ot.has(Yt)||(Ot.add(Yt),qe.push(gt))}return qe}_pickVisibleObjects({layers:e,views:r,viewports:n,x:i,y:a,width:c=1,height:s=1,mode:g="query",maxObjects:_=null,onViewportActive:v,effects:T}){const M=this._getPickable(e);if(!M||n.length===0)return[];this._resizeBuffer();const O=this.device.canvasContext.cssToDeviceRatio(),F=this.device.canvasContext.cssToDevicePixels([i,a],!0),j=F.x,V=F.y+F.height,q=this.device.canvasContext.cssToDevicePixels([i+c,a+s],!0),Y=q.x+q.width,X=q.y,ae={x:j,y:X,width:Y-j,height:V-X},ue=this._drawAndSample({layers:M,views:r,viewports:n,onViewportActive:v,deviceRect:ae,cullRect:{x:i,y:a,width:c,height:s},effects:T,pass:`picking:${g}`}),ge=gk(ue),Le=new Map,qe=[],Ze=Number.isFinite(_);for(let _t=0;_t<ge.length&&!(Ze&&qe.length>=_);_t++){const it=ge[_t];let gt={color:it.pickedColor,layer:null,index:it.pickedObjectIndex,picked:!0,x:i,y:a,pixelRatio:O};gt=IA({layer:it.pickedLayer,info:gt,mode:g});const Lt=gt.layer.id;Le.has(Lt)||Le.set(Lt,new Set);const Ot=Le.get(Lt),Yt=gt.object??gt.index;Ot.has(Yt)||(Ot.add(Yt),qe.push(gt))}return qe}async _drawAndSampleAsync({layers:e,views:r,viewports:n,onViewportActive:i,deviceRect:a,cullRect:c,effects:s,pass:g},_=!1){const v=_?this.depthFBO:this.pickingFBO,T={layers:e,layerFilter:this.layerFilter,views:r,viewports:n,onViewportActive:i,pickingFBO:v,deviceRect:a,cullRect:c,effects:s,pass:g,pickZ:_,preRenderStats:{},isPicking:!0};for(const Y of s)Y.useInPicking&&(T.preRenderStats[Y.id]=Y.preRender(T));const{decodePickingColor:M}=this.pickLayersPass.render(T),{x:O,y:F,width:j,height:V}=a,q=new(_?Float32Array:Uint8Array)(j*V*4);return this.device.readPixelsToArrayWebGL(v,{sourceX:O,sourceY:F,sourceWidth:j,sourceHeight:V,target:q}),{pickedColors:q,decodePickingColor:M}}_drawAndSample({layers:e,views:r,viewports:n,onViewportActive:i,deviceRect:a,cullRect:c,effects:s,pass:g},_=!1){const v=_?this.depthFBO:this.pickingFBO,T={layers:e,layerFilter:this.layerFilter,views:r,viewports:n,onViewportActive:i,pickingFBO:v,deviceRect:a,cullRect:c,effects:s,pass:g,pickZ:_,preRenderStats:{},isPicking:!0};for(const Y of s)Y.useInPicking&&(T.preRenderStats[Y.id]=Y.preRender(T));const{decodePickingColor:M}=this.pickLayersPass.render(T),{x:O,y:F,width:j,height:V}=a,q=new(_?Float32Array:Uint8Array)(j*V*4);return this.device.readPixelsToArrayWebGL(v,{sourceX:O,sourceY:F,sourceWidth:j,sourceHeight:V,target:q}),{pickedColors:q,decodePickingColor:M}}_getPickingRect({deviceX:e,deviceY:r,deviceRadius:n,deviceWidth:i,deviceHeight:a}){const c=Math.max(0,e-n),s=Math.max(0,r-n),g=Math.min(i,e+n+1)-c,_=Math.min(a,r+n+1)-s;return g<=0||_<=0?null:{x:c,y:s,width:g,height:_}}}const cue={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},uue="top-left",yk="__root";class hue{constructor({deck:e,parentElement:r}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,r?.classList.add("deck-widget-container"),this.parentElement=r}getWidgets(){return this.resolvedWidgets}setProps(e){if(e.widgets&&!uc(e.widgets,this.widgets,1)){const r=e.widgets.filter(Boolean);this._setWidgets(r)}}finalize(){for(const e of this.getWidgets())this._removeWidget(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(r=>r.id===e.id)||(this._addWidget(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}onRedraw({viewports:e,layers:r}){const n=e.reduce((i,a)=>(i[a.id]=a,i),{});for(const i of this.getWidgets()){const{viewId:a}=i;if(a){const c=n[a];c&&(i.onViewportChange&&i.onViewportChange(c),i.onRedraw?.({viewports:[c],layers:r}))}else{if(i.onViewportChange)for(const c of e)i.onViewportChange(c);i.onRedraw?.({viewports:e,layers:r})}}this.lastViewports=n,this._updateContainers()}onHover(e,r){for(const n of this.getWidgets()){const{viewId:i}=n;(!i||i===e.viewport?.id)&&n.onHover?.(e,r)}}onEvent(e,r){const n=wA[r.type];if(n)for(const i of this.getWidgets()){const{viewId:a}=i;(!a||a===e.viewport?.id)&&i[n]?.(e,r)}}_setWidgets(e){const r={};for(const n of this.resolvedWidgets)r[n.id]=n;this.resolvedWidgets.length=0;for(const n of this.defaultWidgets)r[n.id]=null,this.resolvedWidgets.push(n);for(let n of e){const i=r[n.id];i?i.viewId!==n.viewId||i.placement!==n.placement?(this._removeWidget(i),this._addWidget(n)):n!==i&&(i.setProps(n.props),n=i):this._addWidget(n),r[n.id]=null,this.resolvedWidgets.push(n)}for(const n in r){const i=r[n];i&&this._removeWidget(i)}this.widgets=e}_addWidget(e){const{viewId:r=null,placement:n=uue}=e;e.widgetManager=this,e.deck=this.deck,e.rootElement=e._onAdd({deck:this.deck,viewId:r}),e.rootElement&&this._getContainer(r,n).append(e.rootElement),e.updateHTML()}_removeWidget(e){e.onRemove?.(),e.rootElement&&e.rootElement.remove(),e.rootElement=void 0,e.deck=void 0,e.widgetManager=void 0}_getContainer(e,r){const n=e||yk;let i=this.containers[n];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",this.parentElement?.append(i),this.containers[n]=i);let a=i.querySelector(`.${r}`);return a||(a=globalThis.document.createElement("div"),a.className=r,a.style.position="absolute",a.style.zIndex="2",Object.assign(a.style,cue[r]),i.append(a)),a}_updateContainers(){const e=this.deck.width,r=this.deck.height;for(const n in this.containers){const i=this.lastViewports[n]||null,a=n===yk||i,c=this.containers[n];a?(c.style.display="block",c.style.left=`${i?i.x:0}px`,c.style.top=`${i?i.y:0}px`,c.style.width=`${i?i.width:e}px`,c.style.height=`${i?i.height:r}px`):c.style.display="none"}}}function _k(t,e){e&&Object.entries(e).map(([r,n])=>{r.startsWith("--")?t.style.setProperty(r,n):t.style[r]=n})}function fue(t,e){e&&Object.keys(e).map(r=>{r.startsWith("--")?t.style.removeProperty(r):t.style[r]=""})}class bC{constructor(e){this.viewId=null,this.props={...this.constructor.defaultProps,...e},this.id=this.props.id}setProps(e){const r=this.props,n=this.rootElement;n&&r.className!==e.className&&(r.className&&n.classList.remove(r.className),e.className&&n.classList.add(e.className)),n&&!uc(r.style,e.style,1)&&(fue(n,r.style),_k(n,e.style)),Object.assign(this.props,e),this.updateHTML()}updateHTML(){this.rootElement&&this.onRenderHTML(this.rootElement)}onCreateRootElement(){const e=["deck-widget",this.className,this.props.className],r=document.createElement("div");return e.filter(n=>typeof n=="string"&&n.length>0).forEach(n=>r.classList.add(n)),_k(r,this.props.style),r}_onAdd(e){return this.onAdd(e)??this.onCreateRootElement()}onAdd(e){}onRemove(){}onViewportChange(e){}onRedraw(e){}onHover(e,r){}onClick(e,r){}onDrag(e,r){}onDragStart(e,r){}onDragEnd(e,r){}}bC.defaultProps={id:"widget",style:{},className:""};const due={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class P5 extends bC{constructor(e={}){super(e),this.id="default-tooltip",this.placement="fill",this.className="deck-tooltip",this.isVisible=!1,this.setProps(e)}onCreateRootElement(){const e=document.createElement("div");return e.className=this.className,Object.assign(e.style,due),e}onRenderHTML(e){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:r}=this,n=r&&r.props.getTooltip;if(!n)return;const i=n(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,r,n){const i=this.rootElement;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${r}px, ${n}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}}P5.defaultProps={...bC.defaultProps};var ry;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(ry||(ry={}));const pue={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},gue=t=>({drawBuffersWEBGL(e){return t.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),mue=t=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return t.createVertexArray()},deleteVertexArrayOES(e){return t.deleteVertexArray(e)},isVertexArrayOES(e){return t.isVertexArray(e)},bindVertexArrayOES(e){return t.bindVertexArray(e)}}),yue=t=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return t.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return t.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return t.vertexAttribDivisor(...e)}});function _ue(t=!0){const e=HTMLCanvasElement.prototype;if(!t&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(r,n){if(r==="webgl"||r==="experimental-webgl"){const i=this.originalGetContext("webgl2",n);return i instanceof HTMLElement&&vue(i),i}return this.originalGetContext(r,n)}}function vue(t){t.getExtension("EXT_color_buffer_float");const e={...pue,WEBGL_disjoint_timer_query:t.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:gue(t),OES_vertex_array_object:mue(t),ANGLE_instanced_arrays:yue(t)},r=t.getExtension;t.getExtension=function(i){const a=r.call(t,i);return a||(i in e?e[i]:null)};const n=t.getSupportedExtensions;t.getSupportedExtensions=function(){return(n.apply(t)||[])?.concat(Object.keys(e))}}async function M5(t,e){const r=document.getElementsByTagName("head")[0];if(!r)throw new Error("loadScript");const n=document.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",t),new Promise((i,a)=>{n.onload=i,n.onerror=c=>a(new Error(`Unable to load script '${t}': ${c}`)),r.appendChild(n)})}const bue=1;let al=null,vk=!1;const xC={debugSpectorJS:Dt.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function xue(t){if(!globalThis.SPECTOR)try{await M5(t.debugSpectorJSUrl||xC.debugSpectorJSUrl)}catch(e){Dt.warn(String(e))}}function wue(t){if(t={...xC,...t},!t.debugSpectorJS)return null;if(!al&&globalThis.SPECTOR&&!globalThis.luma?.spector){Dt.probe(bue,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:e}=globalThis.SPECTOR;al=new e,globalThis.luma&&(globalThis.luma.spector=al)}if(!al)return null;if(vk||(vk=!0,al.spyCanvases(),al?.onCaptureStarted.add(e=>Dt.info("Spector capture started:",e)()),al?.onCapture.add(e=>{Dt.info("Spector capture complete:",e)(),al?.getResultUI(),al?.resultView.display(),al?.resultView.addCapture(e)})),t.gl){const e=t.gl,r=e.device;al?.startCapture(t.gl,500),e.device=r,new Promise(n=>setTimeout(n,2e3)).then(n=>{Dt.info("Spector capture stopped after 2 seconds")(),al?.stopCapture()})}return al}const Tue="https://unpkg.com/webgl-debug@2.0.1/index.js";function I5(t){return t.luma=t.luma||{},t.luma}async function Sue(){zg()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await M5(Tue))}function Aue(t,e={}){return e.debugWebGL||e.traceWebGL?Cue(t,e):Eue(t)}function Eue(t){const e=I5(t);return e.realContext?e.realContext:t}function Cue(t,e){if(!globalThis.WebGLDebugUtils)return Dt.warn("webgl-debug not loaded")(),t;const r=I5(t);if(r.debugContext)return r.debugContext;globalThis.WebGLDebugUtils.init({...ry,...t});const n=globalThis.WebGLDebugUtils.makeDebugContext(t,Pue.bind(null,e),Mue.bind(null,e));for(const c in ry)!(c in n)&&typeof ry[c]=="number"&&(n[c]=ry[c]);class i{}Object.setPrototypeOf(n,Object.getPrototypeOf(t)),Object.setPrototypeOf(i,n);const a=Object.create(i);return r.realContext=t,r.debugContext=a,a.debug=!0,a}function bk(t,e){e=Array.from(e).map(n=>n===void 0?"undefined":n);let r=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return r=`${r.slice(0,100)}${r.length>100?"...":""}`,`gl.${t}(${r})`}function Pue(t,e,r,n){n=Array.from(n).map(s=>s===void 0?"undefined":s);const i=globalThis.WebGLDebugUtils.glEnumToString(e),a=globalThis.WebGLDebugUtils.glFunctionArgsToString(r,n),c=`${i} in gl.${r}(${a})`;Dt.error(c)();debugger}function Mue(t,e,r){let n="";Dt.level>=1&&(n=bk(e,r),t.traceWebGL&&Dt.log(1,n)());for(const i of r)if(i===void 0){n=n||bk(e,r);debugger}}const Yb=1;class Iue extends rie{type="webgl";constructor(){super(),Cg.defaultProps={...Cg.defaultProps,...xC}}enforceWebGL2(e){_ue(e)}isSupported(){return typeof WebGL2RenderingContext<"u"}isDeviceHandle(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?!0:(typeof WebGLRenderingContext<"u"&&e instanceof WebGLRenderingContext&&Dt.warn("WebGL1 is not supported",e)(),!1)}async attach(e,r={}){const{WebGLDevice:n}=await lu(async()=>{const{WebGLDevice:a}=await Promise.resolve().then(()=>Bk);return{WebGLDevice:a}},void 0);if(e instanceof n)return e;if(e?.device instanceof n)return e.device;if(!Rue(e))throw new Error("Invalid WebGL2RenderingContext");const i=r.createCanvasContext===!0?{}:r.createCanvasContext;return new n({...r,_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1,...i}})}async create(e={}){const{WebGLDevice:r}=await lu(async()=>{const{WebGLDevice:n}=await Promise.resolve().then(()=>Bk);return{WebGLDevice:n}},void 0);Dt.groupCollapsed(Yb,"WebGLDevice created")();try{const n=[];(e.debugWebGL||e.debug)&&n.push(Sue()),e.debugSpectorJS&&n.push(xue(e));const i=await Promise.allSettled(n);for(const s of i)s.status==="rejected"&&Dt.error(`Failed to initialize debug libraries ${s.reason}`)();const a=new r(e),c=`${a._reused?"Reusing":"Created"} device with WebGL2 ${a.props.debug?"debug ":""}context: ${a.info.vendor}, ${a.info.renderer} for canvas: ${a.canvasContext.id}`;return Dt.probe(Yb,c)(),Dt.table(Yb,a.info)(),a}finally{Dt.groupEnd(Yb)()}}}function Rue(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}const QT=new Iue,wC={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},us=(t,e,r)=>e?t.enable(r):t.disable(r),xk=(t,e,r)=>t.hint(r,e),ol=(t,e,r)=>t.pixelStorei(r,e),wk=(t,e,r)=>{const n=r===36006?36009:36008;return t.bindFramebuffer(n,e)},cv=(t,e,r)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[r];t.bindBuffer(i,e)};function JT(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const Oue={3042:us,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:us,2885:(t,e)=>t.cullFace(e),2929:us,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:us,35723:xk,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>t.bindTransformFeedback?.(36386,e),34229:(t,e)=>t.bindVertexArray(e),36006:wk,36010:wk,34964:cv,36662:cv,36663:cv,35053:cv,35055:cv,2886:(t,e)=>t.frontFace(e),33170:xk,2849:(t,e)=>t.lineWidth(e),32823:us,32824:"polygonOffset",10752:"polygonOffset",35977:us,32926:us,32928:us,32938:"sampleCoverage",32939:"sampleCoverage",3089:us,3088:(t,e)=>t.scissor(...e),2960:us,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:us,10754:us,12288:us,12289:us,12290:us,12291:us,12292:us,12293:us,12294:us,12295:us,3333:ol,3317:ol,37440:ol,37441:ol,37443:ol,3330:ol,3332:ol,3331:ol,3314:ol,32878:ol,3316:ol,3315:ol,32877:ol,framebuffer:(t,e)=>{const r=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,r)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const r=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...r)},blendFunc:(t,e)=>{const r=e?.length===2?[...e,...e]:e;t.blendFuncSeparate(...r)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(e[0],e[1]||!1),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=JT(e)?e:[e,e];const[r,n]=e;t.stencilMaskSeparate(1028,r),t.stencilMaskSeparate(1029,n)},stencilFunc:(t,e)=>{e=JT(e)&&e.length===3?[...e,...e]:e;const[r,n,i,a,c,s]=e;t.stencilFuncSeparate(1028,r,n,i),t.stencilFuncSeparate(1029,a,c,s)},stencilOp:(t,e)=>{e=JT(e)&&e.length===3?[...e,...e]:e;const[r,n,i,a,c,s]=e;t.stencilOpSeparate(1028,r,n,i),t.stencilOpSeparate(1029,a,c,s)},viewport:(t,e)=>t.viewport(...e)};function Gi(t,e,r){return e[t]!==void 0?e[t]:r[t]}const kue={blendEquation:(t,e,r)=>t.blendEquationSeparate(Gi(32777,e,r),Gi(34877,e,r)),blendFunc:(t,e,r)=>t.blendFuncSeparate(Gi(32969,e,r),Gi(32968,e,r),Gi(32971,e,r),Gi(32970,e,r)),polygonOffset:(t,e,r)=>t.polygonOffset(Gi(32824,e,r),Gi(10752,e,r)),sampleCoverage:(t,e,r)=>t.sampleCoverage(Gi(32938,e,r),Gi(32939,e,r)),stencilFuncFront:(t,e,r)=>t.stencilFuncSeparate(1028,Gi(2962,e,r),Gi(2967,e,r),Gi(2963,e,r)),stencilFuncBack:(t,e,r)=>t.stencilFuncSeparate(1029,Gi(34816,e,r),Gi(36003,e,r),Gi(36004,e,r)),stencilOpFront:(t,e,r)=>t.stencilOpSeparate(1028,Gi(2964,e,r),Gi(2965,e,r),Gi(2966,e,r)),stencilOpBack:(t,e,r)=>t.stencilOpSeparate(1029,Gi(34817,e,r),Gi(34818,e,r),Gi(34819,e,r))},Tk={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,r)=>t({[e]:r}),hint:(t,e,r)=>t({[e]:r}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,r)=>t({36007:r}),bindTransformFeedback:(t,e,r)=>t({36389:r}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,r)=>{switch(e){case 36160:return t({36006:r,36010:r});case 36009:return t({36006:r});case 36008:return t({36010:r});default:return null}},bindBuffer:(t,e,r)=>{const n={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return n?t({[n]:r}):{valueChanged:!0}},blendColor:(t,e,r,n,i)=>t({32773:new Float32Array([e,r,n,i])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,r)=>t({32777:e,34877:r}),blendFunc:(t,e,r)=>t({32969:e,32968:r,32971:e,32970:r}),blendFuncSeparate:(t,e,r,n,i)=>t({32969:e,32968:r,32971:n,32970:i}),clearColor:(t,e,r,n,i)=>t({3106:new Float32Array([e,r,n,i])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,r,n,i)=>t({3107:[e,r,n,i]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,r)=>t({2928:new Float32Array([e,r])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,r)=>t({32824:e,10752:r}),sampleCoverage:(t,e,r)=>t({32938:e,32939:r}),scissor:(t,e,r,n,i)=>t({3088:new Int32Array([e,r,n,i])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,r)=>t({[e===1028?2968:36005]:r}),stencilFunc:(t,e,r,n)=>t({2962:e,2967:r,2963:n,34816:e,36003:r,36004:n}),stencilFuncSeparate:(t,e,r,n,i)=>t({[e===1028?2962:34816]:r,[e===1028?2967:36003]:n,[e===1028?2963:36004]:i}),stencilOp:(t,e,r,n)=>t({2964:e,2965:r,2966:n,34817:e,34818:r,34819:n}),stencilOpSeparate:(t,e,r,n,i)=>t({[e===1028?2964:34817]:r,[e===1028?2965:34818]:n,[e===1028?2966:34819]:i}),viewport:(t,e,r,n,i)=>t({2978:[e,r,n,i]})},Qu=(t,e)=>t.isEnabled(e),Sk={3042:Qu,2884:Qu,2929:Qu,3024:Qu,32823:Qu,32926:Qu,32928:Qu,3089:Qu,2960:Qu,35977:Qu},Due=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function qy(t,e){if(Bue(e))return;const r={};for(const i in e){const a=Number(i),c=Oue[i];c&&(typeof c=="string"?r[c]=!0:c(t,e[i],a))}const n=t.state&&t.state.cache;if(n)for(const i in r){const a=kue[i];a(t,e,n)}}function R5(t,e=wC){if(typeof e=="number"){const i=e,a=Sk[i];return a?a(t,i):t.getParameter(i)}const r=Array.isArray(e)?e:Object.keys(e),n={};for(const i of r){const a=Sk[i];n[i]=a?a(t,Number(i)):t.getParameter(Number(i))}return n}function Lue(t){qy(t,wC)}function Bue(t){for(const e in t)return!1;return!0}function Nue(t,e){if(t===e)return!0;if(Ak(t)&&Ak(e)&&t.length===e.length){for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}return!1}function Ak(t){return Array.isArray(t)||ArrayBuffer.isView(t)}class bg{static get(e){return e.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(e,r){this.gl=e,this.log=r?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];qy(this.gl,e),this.stateStack.pop()}trackState(e,r){if(this.cache=r?.copyState?R5(e):Object.assign({},wC),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,Fue(e);for(const n in Tk){const i=Tk[n];zue(e,n,i)}Ek(e,"getParameter"),Ek(e,"isEnabled")}_updateCache(e){let r=!1,n;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const a in e){const c=e[a],s=this.cache[a];Nue(c,s)||(r=!0,n=s,i&&!(a in i)&&(i[a]=s),this.cache[a]=c)}return{valueChanged:r,oldValue:n}}}function Ek(t,e){const r=t[e].bind(t);t[e]=function(i){if(i===void 0||Due.has(i))return r(i);const a=bg.get(t);return i in a.cache||(a.cache[i]=r(i)),a.enable?a.cache[i]:r(i)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function zue(t,e,r){if(!t[e])return;const n=t[e].bind(t);t[e]=function(...a){const c=bg.get(t),{valueChanged:s,oldValue:g}=r(c._updateCache,...a);return s&&n(...a),g},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function Fue(t){const e=t.useProgram.bind(t);t.useProgram=function(n){const i=bg.get(t);i.program!==n&&(e(n),i.program=n)}}function Uue(t,e,r){let n="";const i={preserveDrawingBuffer:!0,...r};let a=null;if(a||=t.getContext("webgl2",i),i.failIfMajorPerformanceCaveat&&(n||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),!a&&!r.failIfMajorPerformanceCaveat&&(i.failIfMajorPerformanceCaveat=!1,a=t.getContext("webgl2",i),a.luma||={},a.luma.softwareRenderer=!0),a||(a=t.getContext("webgl",{}),a&&(a=null,n||="Your browser only supports WebGL1")),!a)throw n||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${n}`);const{onContextLost:c,onContextRestored:s}=e;return t.addEventListener("webglcontextlost",g=>c(g),!1),t.addEventListener("webglcontextrestored",g=>s(g),!1),a.luma||={},a}function Ry(t,e,r){return r[e]===void 0&&(r[e]=t.getExtension(e)||null),r[e]}function jue(t,e){const r=t.getParameter(7936),n=t.getParameter(7937);Ry(t,"WEBGL_debug_renderer_info",e);const i=e.WEBGL_debug_renderer_info,a=t.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),c=t.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),s=a||r,g=c||n,_=t.getParameter(7938),v=O5(s,g),T=Vue(s,g),M=$ue(s,g);return{type:"webgl",gpu:v,gpuType:M,gpuBackend:T,vendor:s,renderer:g,version:_,shadingLanguage:"glsl",shadingLanguageVersion:300}}function O5(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function Vue(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function $ue(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(O5(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function k5(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const _v="WEBGL_compressed_texture_s3tc",vv="WEBGL_compressed_texture_s3tc_srgb",ny="EXT_texture_compression_rgtc",iy="EXT_texture_compression_bptc",Hue="WEBGL_compressed_texture_etc",Wue="WEBGL_compressed_texture_astc",que="WEBGL_compressed_texture_etc1",Gue="WEBGL_compressed_texture_pvrtc",Xue="WEBGL_compressed_texture_atc",Ck="EXT_texture_norm16",Pk="EXT_render_snorm",Zue="EXT_color_buffer_float",TC={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[Pk],"norm16-renderable-webgl":[Ck],"snorm16-renderable-webgl":[Ck,Pk],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[_v,vv,ny,iy],"texture-compression-bc5-webgl":[ny],"texture-compression-bc7-webgl":[iy],"texture-compression-etc2":[Hue],"texture-compression-astc":[Wue],"texture-compression-etc1-webgl":[que],"texture-compression-pvrtc-webgl":[Gue],"texture-compression-atc-webgl":[Xue]};function Yue(t){return t in TC}function Kue(t,e,r){return(TC[e]||[]).every(i=>Ry(t,i,r))}const SC={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},r16unorm:{gl:33322,rb:!0},r16snorm:{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},rg16unorm:{gl:33324},rg16snorm:{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},rgb10a2uint:{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},rgba16unorm:{gl:32859,rb:!0},rgba16snorm:{gl:36763},"rgb32float-webgl":{gl:34837,x:Zue,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:_v},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:vv},"bc1-rgba-unorm":{gl:33777,x:_v},"bc1-rgba-unorm-srgb":{gl:35916,x:vv},"bc2-rgba-unorm":{gl:33778,x:_v},"bc2-rgba-unorm-srgb":{gl:35918,x:vv},"bc3-rgba-unorm":{gl:33779,x:_v},"bc3-rgba-unorm-srgb":{gl:35919,x:vv},"bc4-r-unorm":{gl:36283,x:ny},"bc4-r-snorm":{gl:36284,x:ny},"bc5-rg-unorm":{gl:36285,x:ny},"bc5-rg-snorm":{gl:36286,x:ny},"bc6h-rgb-ufloat":{gl:36495,x:iy},"bc6h-rgb-float":{gl:36494,x:iy},"bc7-rgba-unorm":{gl:36492,x:iy},"bc7-rgba-unorm-srgb":{gl:36493,x:iy},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function Que(t,e,r){let n=e.create;const i=SC[e.format];return i?.gl===void 0&&(n=!1),i?.x&&(n=n&&!!Ry(t,i.x,r)),{format:e.format,create:n&&e.create,render:n&&e.render,filter:n&&e.filter,blend:n&&e.blend,store:n&&e.store}}function D5(t){const e=SC[t],r=the(t),n=cy.getInfo(t);return n.compressed&&(e.dataFormat=r),{internalFormat:r,format:e?.dataFormat||ehe(n.channels,n.integer,n.normalized,r),type:n.dataType?k5(n.dataType):e?.types?.[0]||5121,compressed:n.compressed||!1}}function Jue(t){switch(cy.getInfo(t).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${t}`)}}function ehe(t,e,r,n){if(n===6408||n===6407)return n;switch(t){case"r":return e&&!r?36244:6403;case"rg":return e&&!r?33320:33319;case"rgb":return e&&!r?36248:6407;case"rgba":return e&&!r?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function the(t){const r=SC[t]?.gl;if(r===void 0)throw new Error(`Unsupported texture format ${t}`);return r}const Mk={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class rhe extends eie{gl;extensions;testedFeatures=new Set;constructor(e,r,n){super([],n),this.gl=e,this.extensions=r,Ry(e,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const e=this.getFeatures();for(const r of e)this.has(r)&&(yield r);return[]}has(e){return this.disabledFeatures?.[e]?!1:(this.testedFeatures.has(e)||(this.testedFeatures.add(e),Yue(e)&&Kue(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){const e=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of e)this.has(r)}getFeatures(){return[...Object.keys(Mk),...Object.keys(TC)]}getWebGLFeature(e){const r=Mk[e];return typeof r=="string"?!!Ry(this.gl,r,this.extensions):!!r}}class nhe extends Jne{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderVariables(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(e){super(),this.gl=e}getParameter(e){return this.limits[e]===void 0&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0}}class Ov extends fw{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(e,r){super(e,r);const n=r.handle===null;this.device=e,this.gl=e.gl,this.handle=this.props.handle||n?this.props.handle:this.gl.createFramebuffer(),n||(e._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const e=this.gl.bindFramebuffer(36160,this.handle);for(let r=0;r<this.colorAttachments.length;++r){const n=this.colorAttachments[r];if(n){const i=36064+r;this._attachTextureView(i,n)}}if(this.depthStencilAttachment){const r=Jue(this.depthStencilAttachment.props.format);this._attachTextureView(r,this.depthStencilAttachment)}if(this.device.props.debug){const r=this.gl.checkFramebufferStatus(36160);if(r!==36053)throw new Error(`Framebuffer ${she(r)}`)}this.gl.bindFramebuffer(36160,e)}_attachTextureView(e,r){const{gl:n}=this.device,{texture:i}=r,a=r.props.baseMipLevel,c=r.props.baseArrayLayer;switch(n.bindTexture(i.glTarget,i.handle),i.glTarget){case 35866:case 32879:n.framebufferTextureLayer(36160,e,i.handle,a,c);break;case 34067:const s=ihe(c);n.framebufferTexture2D(36160,e,s,i.handle,a);break;case 3553:n.framebufferTexture2D(36160,e,3553,i.handle,a);break;default:throw new Error("Illegal texture type")}n.bindTexture(i.glTarget,null)}}function ihe(t){return t<34069?t+34069:t}function she(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class ahe extends hg{device;handle=null;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(e,r){super(r),this.device=e,this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this._updateDevice()}getCurrentFramebuffer(){return this._framebuffer=this._framebuffer||new Ov(this.device,{handle:null}),this._framebuffer}_updateDevice(){}}const eS={};function ohe(t="id"){eS[t]=eS[t]||1;const e=eS[t]++;return`${t}-${e}`}class kv extends Ni{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength=0;bytesUsed=0;constructor(e,r={}){super(e,r),this.device=e,this.gl=this.device.gl;const n=typeof r=="object"?r.handle:void 0;this.handle=n||this.gl.createBuffer(),e._setWebGLDebugMetadata(this.handle,this,{spector:{...this.props,data:typeof this.props.data}}),this.glTarget=lhe(this.props.usage),this.glUsage=che(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}_initWithData(e,r=0,n=e.byteLength+r){const i=this.glTarget;this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,this.glUsage),this.gl.bufferSubData(i,r,e),this.gl.bindBuffer(i,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(e,r,n),this.trackAllocatedMemory(n)}_initWithByteLength(e){let r=e;e===0&&(r=new Float32Array(0));const n=this.glTarget;return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,r,this.glUsage),this.gl.bindBuffer(n,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}write(e,r=0){const n=ArrayBuffer.isView(e)?e:new Uint8Array(e),i=36663;this.gl.bindBuffer(i,this.handle),this.gl.bufferSubData(i,r,n),this.gl.bindBuffer(i,null),this._setDebugData(e,r,e.byteLength)}async mapAndWriteAsync(e,r=0,n=this.byteLength-r){const i=new ArrayBuffer(n);await e(i,"copied"),this.write(i,r)}async readAsync(e=0,r){return this.readSyncWebGL(e,r)}async mapAndReadAsync(e,r=0,n){const i=await this.readAsync(r,n);return await e(i.buffer,"copied")}readSyncWebGL(e=0,r){r=r??this.byteLength-e;const n=new Uint8Array(r),i=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,n,i,r),this.gl.bindBuffer(36662,null),this._setDebugData(n,e,r),n}}function lhe(t){return t&Ni.INDEX?34963:t&Ni.VERTEX?34962:t&Ni.UNIFORM?35345:34962}function che(t){return t&Ni.INDEX||t&Ni.VERTEX?35044:t&Ni.UNIFORM?35048:35044}function uhe(t){const e=t.split(/\r?\n/),r=[];for(const n of e){if(n.length<=1)continue;const i=n.split(":");if(i.length===2){const[T,M]=i;r.push({message:M.trim(),type:Ik(T),lineNum:0,linePos:0});continue}const[a,c,s,...g]=i;let _=parseInt(s,10);isNaN(_)&&(_=0);let v=parseInt(c,10);isNaN(v)&&(v=0),r.push({message:g.join(":").trim(),type:Ik(a),lineNum:_,linePos:v})}return r}function Ik(t){const e=["warning","error","info"],r=t.toLowerCase();return e.includes(r)?r:"info"}class hhe extends hw{device;handle;constructor(e,r){switch(super(e,r),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}e._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0,this.handle.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>(this._getCompilationStatus(),this.compilationStatus))}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const e=this.device.gl.getShaderInfoLog(this.handle);return e?uhe(e):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(e){e=e.startsWith("#version ")?e:`#version 300 es
${e}`;const{gl:r}=this.device;if(r.shaderSource(this.handle,e),r.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}Dt.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Dt.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const e=async i=>await new Promise(a=>setTimeout(a,i));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:n}=this.device;for(;;){if(n.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function fhe(t,e,r,n){if(mhe(e))return n(t);const i=t;i.pushState();try{return dhe(t,e),qy(i.gl,r),n(t)}finally{i.popState()}}function dhe(t,e){const r=t,{gl:n}=r;if(e.cullMode)switch(e.cullMode){case"none":n.disable(2884);break;case"front":n.enable(2884),n.cullFace(1028);break;case"back":n.enable(2884),n.cullFace(1029);break}if(e.frontFace&&n.frontFace(xg("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&n.enable(34383),e.depthBias!==void 0&&(n.enable(32823),n.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const a=r.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,c=xg("provokingVertex",e.provokingVertex,{first:36429,last:36430});a?.provokingVertexWEBGL(c)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const a=r.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,c=xg("polygonMode",e.polygonMode,{fill:6914,line:6913});a?.polygonModeWEBGL(1028,c),a?.polygonModeWEBGL(1029,c)}e.polygonOffsetLine&&n.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&n.enable(12288),e.clipDistance1&&n.enable(12289),e.clipDistance2&&n.enable(12290),e.clipDistance3&&n.enable(12291),e.clipDistance4&&n.enable(12292),e.clipDistance5&&n.enable(12293),e.clipDistance6&&n.enable(12294),e.clipDistance7&&n.enable(12295)),e.depthWriteEnabled!==void 0&&n.depthMask(ghe("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?n.enable(2929):n.disable(2929),n.depthFunc(RA("depthCompare",e.depthCompare))),e.stencilWriteMask){const i=e.stencilWriteMask;n.stencilMaskSeparate(1028,i),n.stencilMaskSeparate(1029,i)}if(e.stencilReadMask&&Dt.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const i=e.stencilReadMask||4294967295,a=RA("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?n.enable(2960):n.disable(2960),n.stencilFuncSeparate(1028,a,0,i),n.stencilFuncSeparate(1029,a,0,i)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const i=tS("stencilPassOperation",e.stencilPassOperation),a=tS("stencilFailOperation",e.stencilFailOperation),c=tS("stencilDepthFailOperation",e.stencilDepthFailOperation);n.stencilOpSeparate(1028,a,c,i),n.stencilOpSeparate(1029,a,c,i)}switch(e.blend){case!0:n.enable(3042);break;case!1:n.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const i=Rk("blendColorOperation",e.blendColorOperation||"add"),a=Rk("blendAlphaOperation",e.blendAlphaOperation||"add");n.blendEquationSeparate(i,a);const c=Kb("blendColorSrcFactor",e.blendColorSrcFactor||"one"),s=Kb("blendColorDstFactor",e.blendColorDstFactor||"zero"),g=Kb("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),_=Kb("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");n.blendFuncSeparate(c,s,g,_)}}function RA(t,e){return xg(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function tS(t,e){return xg(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function Rk(t,e){return xg(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function Kb(t,e,r="color"){return xg(t,e,{one:1,zero:0,src:768,"one-minus-src":769,dst:774,"one-minus-dst":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,constant:r==="color"?32769:32771,"one-minus-constant":r==="color"?32770:32772,src1:768,"one-minus-src1":769,"src1-alpha":770,"one-minus-src1-alpha":771})}function phe(t,e){return`Illegal parameter ${e} for ${t}`}function xg(t,e,r){if(!(e in r))throw new Error(phe(t,e));return r[e]}function ghe(t,e){return e}function mhe(t){let e=!0;for(const r in t){e=!1;break}return e}function L5(t){const e={};return t.addressModeU&&(e[10242]=rS(t.addressModeU)),t.addressModeV&&(e[10243]=rS(t.addressModeV)),t.addressModeW&&(e[32882]=rS(t.addressModeW)),t.magFilter&&(e[10240]=OA(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=yhe(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=RA("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function rS(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function OA(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function yhe(t,e="none"){if(!e)return OA(t);switch(e){case"none":return OA(t);case"nearest":switch(t){case"nearest":return 9984;case"linear":return 9985}break;case"linear":switch(t){case"nearest":return 9986;case"linear":return 9987}}}class _he extends Pg{device;handle;parameters;constructor(e,r){super(e,r),this.device=e,this.parameters=L5(r),this.handle=r.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(const[r,n]of Object.entries(e)){const i=Number(r);switch(i){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,i,n);break;default:this.device.gl.samplerParameteri(this.handle,i,n);break}}}}function Kv(t,e,r){if(vhe(e))return r(t);const{nocatch:n=!0}=e,i=bg.get(t);i.push(),qy(t,e);let a;if(n)a=r(t),i.pop();else try{a=r(t)}finally{i.pop()}return a}function vhe(t){for(const e in t)return!1;return!0}class sy extends uw{device;gl;handle;texture;constructor(e,r){super(e,{...Ps.defaultProps,...r}),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}class Dv extends Ps{device;gl;handle;sampler=void 0;view;glTarget;glFormat;glType;glInternalFormat;compressed;_textureUnit=0;constructor(e,r){super(e,r),this.device=e,this.gl=this.device.gl;const n=D5(this.props.format);this.glTarget=bhe(this.props.dimension),this.glInternalFormat=n.internalFormat,this.glFormat=n.format,this.glType=n.type,this.compressed=n.compressed,this.handle=this.props.handle||this.gl.createTexture(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.gl.bindTexture(this.glTarget,this.handle);const{dimension:i,width:a,height:c,depth:s,mipLevels:g,glTarget:_,glInternalFormat:v}=this;switch(i){case"2d":case"cube":this.gl.texStorage2D(_,g,v,a,c);break;case"2d-array":case"3d":this.gl.texStorage3D(_,g,v,a,c,s);break;default:throw new Error(i)}this.gl.bindTexture(this.glTarget,null),this._initializeData(r.data),this.setSampler(this.props.sampler),this.view=new sy(this.device,{...this.props,texture:this}),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(e){return new sy(this.device,{...e,texture:this})}setSampler(e={}){super.setSampler(e);const r=L5(this.sampler.props);this._setSamplerParameters(r)}copyImageData(e){const r=this._normalizeCopyImageDataOptions(e),n=r.data,{width:i,height:a,depth:c}=this,{mipLevel:s=0,byteOffset:g=0,x:_=0,y:v=0,z:T=0}=r,{glFormat:M,glType:O,compressed:F}=this,j=Ok(this.glTarget,this.dimension,c),V=this.compressed?{}:{3314:r.bytesPerRow,32878:r.rowsPerImage};this.gl.bindTexture(j,this.handle),Kv(this.gl,V,()=>{switch(this.dimension){case"2d":case"cube":F?this.gl.compressedTexSubImage2D(j,s,_,v,i,a,M,n,g):this.gl.texSubImage2D(j,s,_,v,i,a,M,O,n,g);break;case"2d-array":case"3d":F?this.gl.compressedTexSubImage3D(j,s,_,v,T,i,a,c,M,n,g):this.gl.texSubImage3D(j,s,_,v,T,i,a,c,M,O,n,g);break;default:}}),this.gl.bindTexture(j,null)}copyExternalImage(e){const r=this._normalizeCopyExternalImageOptions(e);if(r.sourceX||r.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");const{glFormat:n,glType:i}=this,{image:a,depth:c,mipLevel:s,x:g,y:_,z:v,width:T,height:M}=r,O=Ok(this.glTarget,this.dimension,c),F=r.flipY?{37440:!0}:{};return this.gl.bindTexture(this.glTarget,this.handle),Kv(this.gl,F,()=>{switch(this.dimension){case"2d":case"cube":this.gl.texSubImage2D(O,s,g,_,T,M,n,i,a);break;case"2d-array":case"3d":this.gl.texSubImage3D(O,s,g,_,v,T,M,c,n,i,a);break;default:}}),this.gl.bindTexture(this.glTarget,null),{width:r.width,height:r.height}}generateMipmapsWebGL(e){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(Dt.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!e?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(n){Dt.warn(`Error generating mipmap for ${this}: ${n.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}_setSamplerParameters(e){Dt.log(2,`${this.id} sampler parameters`,this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[r,n]of Object.entries(e)){const i=Number(r),a=n;switch(i){case 33082:case 33083:this.gl.texParameterf(this.glTarget,i,a);break;case 10240:case 10241:this.gl.texParameteri(this.glTarget,i,a);break;case 10242:case 10243:case 32882:this.gl.texParameteri(this.glTarget,i,a);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,i,a);break;case 34892:case 34893:this.gl.texParameteri(this.glTarget,i,a);break}}this.gl.bindTexture(this.glTarget,null)}_getActiveUnit(){return this.gl.getParameter(34016)-33984}_bind(e){const{gl:r}=this;return e!==void 0&&(this._textureUnit=e,r.activeTexture(33984+e)),r.bindTexture(this.glTarget,this.handle),e}_unbind(e){const{gl:r}=this;return e!==void 0&&(this._textureUnit=e,r.activeTexture(33984+e)),r.bindTexture(this.glTarget,null),e}}function bhe(t){switch(t){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(t)}function Ok(t,e,r){return e==="cube"?34069+r:t}function xhe(t){return Ahe[t]}function AC(t){return She[t]}function whe(t){return!!B5[t]}function The(t){return B5[t]}const She={5126:"f32",35664:"vec2<f32>",35665:"vec3<f32>",35666:"vec4<f32>",5124:"i32",35667:"vec2<i32>",35668:"vec3<i32>",35669:"vec4<i32>",5125:"u32",36294:"vec2<u32>",36295:"vec3<u32>",36296:"vec4<u32>",35670:"f32",35671:"vec2<f32>",35672:"vec3<f32>",35673:"vec4<f32>",35674:"mat2x2<f32>",35685:"mat2x3<f32>",35686:"mat2x4<f32>",35687:"mat3x2<f32>",35675:"mat3x3<f32>",35688:"mat3x4<f32>",35689:"mat4x2<f32>",35690:"mat4x3<f32>",35676:"mat4x4<f32>"},B5={35678:{viewDimension:"2d",sampleType:"float"},35680:{viewDimension:"cube",sampleType:"float"},35679:{viewDimension:"3d",sampleType:"float"},35682:{viewDimension:"3d",sampleType:"depth"},36289:{viewDimension:"2d-array",sampleType:"float"},36292:{viewDimension:"2d-array",sampleType:"depth"},36293:{viewDimension:"cube",sampleType:"float"},36298:{viewDimension:"2d",sampleType:"sint"},36299:{viewDimension:"3d",sampleType:"sint"},36300:{viewDimension:"cube",sampleType:"sint"},36303:{viewDimension:"2d-array",sampleType:"uint"},36306:{viewDimension:"2d",sampleType:"uint"},36307:{viewDimension:"3d",sampleType:"uint"},36308:{viewDimension:"cube",sampleType:"uint"},36311:{viewDimension:"2d-array",sampleType:"uint"}},Ahe={uint8:5121,sint8:5120,unorm8:5121,snorm8:5120,uint16:5123,sint16:5122,unorm16:5123,snorm16:5122,uint32:5125,sint32:5124,float16:5131,float32:5126};function Ehe(t,e){const r={attributes:[],bindings:[]};r.attributes=Che(t,e);const n=Ihe(t,e);for(const s of n){const g=s.uniforms.map(_=>({name:_.name,format:_.format,byteOffset:_.byteOffset,byteStride:_.byteStride,arrayLength:_.arrayLength}));r.bindings.push({type:"uniform",name:s.name,group:0,location:s.location,visibility:(s.vertex?1:0)&(s.fragment?2:0),minBindingSize:s.byteLength,uniforms:g})}const i=Mhe(t,e);let a=0;for(const s of i)if(whe(s.type)){const{viewDimension:g,sampleType:_}=The(s.type);r.bindings.push({type:"texture",name:s.name,group:0,location:a,viewDimension:g,sampleType:_}),s.textureUnit=a,a+=1}i.length&&(r.uniforms=i);const c=Phe(t,e);return c?.length&&(r.varyings=c),r}function Che(t,e){const r=[],n=t.getProgramParameter(e,35721);for(let i=0;i<n;i++){const a=t.getActiveAttrib(e,i);if(!a)throw new Error("activeInfo");const{name:c,type:s}=a,g=t.getAttribLocation(e,c);if(g>=0){const _=AC(s),v=/instance/i.test(c)?"instance":"vertex";r.push({name:c,location:g,stepMode:v,type:_})}}return r.sort((i,a)=>i.location-a.location),r}function Phe(t,e){const r=[],n=t.getProgramParameter(e,35971);for(let i=0;i<n;i++){const a=t.getTransformFeedbackVarying(e,i);if(!a)throw new Error("activeInfo");const{name:c,type:s,size:g}=a,_=AC(s),{type:v,components:T}=Az(_);r.push({location:i,name:c,type:v,size:g*T})}return r.sort((i,a)=>i.location-a.location),r}function Mhe(t,e){const r=[],n=t.getProgramParameter(e,35718);for(let i=0;i<n;i++){const a=t.getActiveUniform(e,i);if(!a)throw new Error("activeInfo");const{name:c,size:s,type:g}=a,{name:_,isArray:v}=Rhe(c);let T=t.getUniformLocation(e,_);const M={location:T,name:_,size:s,type:g,isArray:v};if(r.push(M),M.size>1)for(let O=0;O<M.size;O++){const F=`${_}[${O}]`;T=t.getUniformLocation(e,F);const j={...M,name:F,location:T};r.push(j)}}return r}function Ihe(t,e){const r=(a,c)=>t.getActiveUniformBlockParameter(e,a,c),n=[],i=t.getProgramParameter(e,35382);for(let a=0;a<i;a++){const c={name:t.getActiveUniformBlockName(e,a)||"",location:r(a,35391),byteLength:r(a,35392),vertex:r(a,35396),fragment:r(a,35398),uniformCount:r(a,35394),uniforms:[]},s=r(a,35395)||[],g=t.getActiveUniforms(e,s,35383),_=t.getActiveUniforms(e,s,35384),v=t.getActiveUniforms(e,s,35387),T=t.getActiveUniforms(e,s,35388);for(let M=0;M<c.uniformCount;++M){const O=t.getActiveUniform(e,s[M]);if(!O)throw new Error("activeInfo");const F=AC(g[M]);c.uniforms.push({name:O.name,format:F,type:g[M],arrayLength:_[M],byteOffset:v[M],byteStride:T[M]})}n.push(c)}return n.sort((a,c)=>a.location-c.location),n}function Rhe(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const r=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!r||r.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:r[1],length:r[2]?1:0,isArray:!!r[2]}}function Ohe(t,e,r,n){const i=t;let a=n;a===!0&&(a=1),a===!1&&(a=0);const c=typeof a=="number"?[a]:a;switch(r){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof n!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,n);case 5126:return t.uniform1fv(e,c);case 35664:return t.uniform2fv(e,c);case 35665:return t.uniform3fv(e,c);case 35666:return t.uniform4fv(e,c);case 5124:return t.uniform1iv(e,c);case 35667:return t.uniform2iv(e,c);case 35668:return t.uniform3iv(e,c);case 35669:return t.uniform4iv(e,c);case 35670:return t.uniform1iv(e,c);case 35671:return t.uniform2iv(e,c);case 35672:return t.uniform3iv(e,c);case 35673:return t.uniform4iv(e,c);case 5125:return i.uniform1uiv(e,c,1);case 36294:return i.uniform2uiv(e,c,2);case 36295:return i.uniform3uiv(e,c,3);case 36296:return i.uniform4uiv(e,c,4);case 35674:return t.uniformMatrix2fv(e,!1,c);case 35675:return t.uniformMatrix3fv(e,!1,c);case 35676:return t.uniformMatrix4fv(e,!1,c);case 35685:return i.uniformMatrix2x3fv(e,!1,c);case 35686:return i.uniformMatrix2x4fv(e,!1,c);case 35687:return i.uniformMatrix3x2fv(e,!1,c);case 35688:return i.uniformMatrix3x4fv(e,!1,c);case 35689:return i.uniformMatrix4x2fv(e,!1,c);case 35690:return i.uniformMatrix4x3fv(e,!1,c)}throw new Error("Illegal uniform")}function khe(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(t)}}function Dhe(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(t)}}const kk=4;class Lhe extends _g{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};get[Symbol.toStringTag](){return"WEBGLRenderPipeline"}constructor(e,r){super(e,r),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:{id:this.props.id}}),this.vs=r.vs,this.fs=r.fs;const{varyings:n,bufferMode:i=35981}=r;n&&n.length>0&&(this.varyings=n,this.device.gl.transformFeedbackVaryings(this.handle,n,i)),this._linkShaders(),Dt.time(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=Ehe(this.device.gl,this.handle),Dt.timeEnd(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=r.shaderLayout?Bhe(this.introspectedLayout,r.shaderLayout):this.introspectedLayout}destroy(){this.handle&&(this.device.gl.useProgram(null),this.device.gl.deleteProgram(this.handle),this.destroyed=!0,this.handle.destroyed=!0,this.handle=null)}setBindings(e,r){for(const[n,i]of Object.entries(e)){const a=this.shaderLayout.bindings.find(c=>c.name===n)||this.shaderLayout.bindings.find(c=>c.name===`${n}Uniforms`);if(!a){const c=this.shaderLayout.bindings.map(s=>`"${s.name}"`).join(", ");r?.disableWarnings||Dt.warn(`No binding "${n}" in render pipeline "${this.id}", expected one of ${c}`,i)();continue}switch(i||Dt.warn(`Unsetting binding "${n}" in render pipeline "${this.id}"`)(),a.type){case"uniform":if(!(i instanceof kv)&&!(i.buffer instanceof kv))throw new Error("buffer value");break;case"texture":if(!(i instanceof sy||i instanceof Dv||i instanceof Ov))throw new Error(`${this} Bad texture binding for ${n}`);break;case"sampler":Dt.warn(`Ignoring sampler ${n}`)();break;default:throw new Error(a.type)}this.bindings[n]=i}}draw(e){const{renderPass:r,parameters:n=this.props.parameters,topology:i=this.props.topology,vertexArray:a,vertexCount:c,instanceCount:s,isInstanced:g=!1,firstVertex:_=0,transformFeedback:v}=e,T=khe(i),M=!!a.indexBuffer,O=a.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return Dt.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return Dt.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),a.bindBeforeRender(r),v&&v.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const F=r;return fhe(this.device,n,F.glParameters,()=>{M&&g?this.device.gl.drawElementsInstanced(T,c||0,O,_,s||0):M?this.device.gl.drawElements(T,c||0,O,_):g?this.device.gl.drawArraysInstanced(T,_,c||0,s||0):this.device.gl.drawArrays(T,_,c||0),v&&v.end()}),a.unbindAfterRender(r),!0}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Dt.time(kk,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),Dt.timeEnd(kk,`linkProgram for ${this.id}`)(),Dt.level,!this.device.features.has("compilation-status-async-webgl")){const n=this._getLinkStatus();this._reportLinkStatus(n);return}Dt.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Dt.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}async _reportLinkStatus(e){switch(e){case"success":return;default:const r=e==="link-error"?"Link error":"Validation error";switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`${this} ${r} during compilation of ${this.vs}`);case"pending":await this.vs.asyncCompilationStatus,this.vs.debugShader();break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`${this} ${r} during compilation of ${this.fs}`);case"pending":await this.fs.asyncCompilationStatus,this.fs.debugShader();break}const n=this.device.gl.getProgramInfoLog(this.handle);this.device.reportError(new Error(`${r} during ${e}: ${n}`),this)(),this.device.debug()}}_getLinkStatus(){const{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation-error")):(this.linkStatus="error","link-error")}async _waitForLinkComplete(){const e=async i=>await new Promise(a=>setTimeout(a,i));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:n}=this.device;for(;;){if(n.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const r of this.shaderLayout.bindings)!this.bindings[r.name]&&!this.bindings[r.name.replace(/Uniforms$/,"")]&&(Dt.warn(`Binding ${r.name} not found in ${this.id}`)(),e=!1);return e}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:e}=this.device;e.useProgram(this.handle);let r=0,n=0;for(const i of this.shaderLayout.bindings){const a=this.bindings[i.name]||this.bindings[i.name.replace(/Uniforms$/,"")];if(!a)throw new Error(`No value for binding ${i.name} in ${this.id}`);switch(i.type){case"uniform":const{name:c}=i,s=e.getUniformBlockIndex(this.handle,c);if(s===4294967295)throw new Error(`Invalid uniform block name ${c}`);e.uniformBlockBinding(this.handle,n,s),a instanceof kv?e.bindBufferBase(35345,n,a.handle):e.bindBufferRange(35345,n,a.buffer.handle,a.offset||0,a.size||a.buffer.byteLength-a.offset),n+=1;break;case"texture":if(!(a instanceof sy||a instanceof Dv||a instanceof Ov))throw new Error("texture");let g;if(a instanceof sy)g=a.texture;else if(a instanceof Dv)g=a;else if(a instanceof Ov&&a.colorAttachments[0]instanceof sy)Dt.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),g=a.colorAttachments[0].texture;else throw new Error("No texture");e.activeTexture(33984+r),e.bindTexture(g.glTarget,g.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${i.type}' not supported in WebGL`)}}}_applyUniforms(){for(const e of this.shaderLayout.uniforms||[]){const{name:r,location:n,type:i,textureUnit:a}=e,c=this.uniforms[r]??a;c!==void 0&&Ohe(this.device.gl,n,i,c)}}}function Bhe(t,e){const r={...t,attributes:t.attributes.map(n=>({...n}))};for(const n of e?.attributes||[]){const i=r.attributes.find(a=>a.name===n.name);i?(i.type=n.type||i.type,i.stepMode=n.stepMode||i.stepMode):Dt.warn(`shader layout attribute ${n.name} not present in shader`)}return r}class Nhe extends K3{device;handle=null;commands=[];constructor(e){super(e,{}),this.device=e}_executeCommands(e=this.commands){for(const r of e)switch(r.name){case"copy-buffer-to-buffer":zhe(this.device,r.options);break;case"copy-buffer-to-texture":Fhe(this.device,r.options);break;case"copy-texture-to-buffer":Uhe(this.device,r.options);break;case"copy-texture-to-texture":jhe(this.device,r.options);break;default:throw new Error(r.name)}}}function zhe(t,e){const r=e.sourceBuffer,n=e.destinationBuffer;t.gl.bindBuffer(36662,r.handle),t.gl.bindBuffer(36663,n.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function Fhe(t,e){throw new Error("Not implemented")}function Uhe(t,e){const{sourceTexture:r,mipLevel:n=0,aspect:i="all",width:a=e.sourceTexture.width,height:c=e.sourceTexture.height,depthOrArrayLayers:s=0,origin:g=[0,0],destinationBuffer:_,byteOffset:v=0,bytesPerRow:T,rowsPerImage:M}=e;if(i!=="all")throw new Error("aspect not supported in WebGL");if(n!==0||s!==0||T||M)throw new Error("not implemented");const{framebuffer:O,destroyFramebuffer:F}=N5(r);let j;try{const V=_,q=a||O.width,Y=c||O.height,X=D5(O.colorAttachments[0].texture.props.format),ae=X.format,ue=X.type;t.gl.bindBuffer(35051,V.handle),j=t.gl.bindFramebuffer(36160,O.handle),t.gl.readPixels(g[0],g[1],q,Y,ae,ue,v)}finally{t.gl.bindBuffer(35051,null),j!==void 0&&t.gl.bindFramebuffer(36160,j),F&&O.destroy()}}function jhe(t,e){const{sourceTexture:r,destinationMipLevel:n=0,origin:i=[0,0],destinationOrigin:a=[0,0],destinationTexture:c}=e;let{width:s=e.destinationTexture.width,height:g=e.destinationTexture.height}=e;const{framebuffer:_,destroyFramebuffer:v}=N5(r),[T,M]=i,[O,F,j]=a,V=t.gl.bindFramebuffer(36160,_.handle);let q,Y;if(c instanceof Dv)q=c,s=Number.isFinite(s)?s:q.width,g=Number.isFinite(g)?g:q.height,q._bind(0),Y=q.glTarget;else throw new Error("invalid destination");switch(Y){case 3553:case 34067:t.gl.copyTexSubImage2D(Y,n,O,F,T,M,s,g);break;case 35866:case 32879:t.gl.copyTexSubImage3D(Y,n,O,F,j,T,M,s,g);break}q&&q._unbind(),t.gl.bindFramebuffer(36160,V),v&&_.destroy()}function N5(t){if(t instanceof Ps){const{width:e,height:r,id:n}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${n}`,width:e,height:r,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}const Vhe=[1,2,4,8];class $he extends sg{device;handle=null;glParameters={};constructor(e,r){super(e,r),this.device=e;let n;if(!r?.parameters?.viewport)if(r?.framebuffer){const{width:a,height:c}=r.framebuffer;n=[0,0,a,c]}else{const[a,c]=e.getDefaultCanvasContext().getDrawingBufferSize();n=[0,0,a,c]}this.device.pushState(),this.setParameters({viewport:n,...this.props.parameters});const i=this.props.framebuffer;if(this.props.framebuffer&&i?.handle){const a=this.props.framebuffer.colorAttachments.map((c,s)=>36064+s);this.device.gl.drawBuffers(a)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){const r={...this.glParameters};r.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(r.viewport=e.viewport.slice(0,4),r.depthRange=[e.viewport[4],e.viewport[5]]):r.viewport=e.viewport),e.scissorRect&&(r.scissorTest=!0,r.scissor=e.scissorRect),e.blendConstant&&(r.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),r[2967]=e.stencilReference),"colorMask"in e&&(r.colorMask=Vhe.map(n=>!!(n&e.colorMask))),this.glParameters=r,qy(this.device.gl,r)}beginOcclusionQuery(e){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){const e={...this.glParameters};let r=0;this.props.clearColors&&this.props.clearColors.forEach((n,i)=>{n&&this.clearColorBuffer(i,n)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(r|=16384,e.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=256,e.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=1024,e.clearStencil=this.props.clearStencil),r!==0&&Kv(this.device.gl,e,()=>{this.device.gl.clear(r)})}clearColorBuffer(e=0,r=[0,0,0,0]){Kv(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,e,r);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,e,r);break;case Float32Array:this.device.gl.clearBufferfv(6144,e,r);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}class Dk extends Y3{device;handle=null;commandBuffer;constructor(e,r){super(e,r),this.device=e,this.commandBuffer=new Nhe(e)}destroy(){}finish(){return this.commandBuffer}beginRenderPass(e){return new $he(this.device,e)}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,r,n){}}function Hhe(t){const{target:e,source:r,start:n=0,count:i=1}=t,a=r.length,c=i*a;let s=0;for(let g=n;s<a;s++)e[g++]=r[s];for(;s<c;)s<c-s?(e.copyWithin(n+s,n,n+s),s*=2):(e.copyWithin(n+s,n,n+c-s),s=c);return t.target}class EC extends Q3{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(e){return Nee()==="Chrome"}constructor(e,r){super(e,r),this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const r=e;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(e,r){const n=r;if(n.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:i,type:a,stride:c,offset:s,normalized:g,integer:_,divisor:v}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,n.handle),_?this.device.gl.vertexAttribIPointer(e,i,a,c,s):this.device.gl.vertexAttribPointer(e,i,a,g,c,s),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,v||0),this.attributes[e]=n,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,r){this._enable(e,!1),this.attributes[e]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const r=this.attributes[e];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(e,r)}}_getAccessor(e){const r=this.attributeInfos[e];if(!r)throw new Error(`Unknown attribute location ${e}`);const n=k5(r.bufferDataType);return{size:r.bufferComponents,type:n,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(e,r=!0){const i=EC.isConstantAttributeZeroSupported(this.device)||e!==0;(r||i)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,r){const n=Whe(r),i=n.byteLength*e,a=n.length*e;if(this.buffer&&i!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${i} !== ${this.buffer.byteLength}.`);let c=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:i}),c||=!qhe(n,this.bufferValue),c){const s=Mie(r.constructor,a);Hhe({target:s,source:n,start:0,count:a}),this.buffer.write(s),this.bufferValue=r}return this.buffer}}function Whe(t){return Array.isArray(t)?new Float32Array(t):t}function qhe(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}class Ghe extends J3{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(e,r){super(e,r),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(Dhe(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in e)this.setBuffer(r,e[r])})}setBuffer(e,r){const n=this._getVaryingIndex(e),{buffer:i,byteLength:a,byteOffset:c}=this._getBufferRange(r);if(n<0){this.unusedBuffers[e]=i,Dt.warn(`${this.id} unusedBuffers varying buffer ${e}`)();return}this.buffers[n]={buffer:i,byteLength:a,byteOffset:c},this.bindOnUse||this._bindBuffer(n,i,c,a)}getBuffer(e){if(Lk(e))return this.buffers[e]||null;const r=this._getVaryingIndex(e);return r>=0?this.buffers[r]:null}bind(e=this.handle){if(typeof e!="function")return this.gl.bindTransformFeedback(36386,e),this;let r;return this._bound?r=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof kv)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:r,byteOffset:n=0,byteLength:i=e.buffer.byteLength}=e;return{buffer:r,byteOffset:n,byteLength:i}}_getVaryingIndex(e){if(Lk(e))return Number(e);for(const r of this.layout.varyings||[])if(e===r.name)return r.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:r,byteLength:n,byteOffset:i}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),r,i,n)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,r,n=0,i){const a=r&&r.handle;!a||i===void 0?this.gl.bindBufferBase(35982,e,a):this.gl.bindBufferRange(35982,e,a,n,i)}}function Lk(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class Xhe extends eC{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(e,r){if(super(e,r),this.device=e,r.count>1)throw new Error("WebGL QuerySet can only have one value");const n=this.device.gl.createQuery();if(!n)throw new Error("WebGL query not supported");this.handle=n,Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((n,i)=>{const a=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):r++>e?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(a)};requestAnimationFrame(a)}),this._pollingPromise}}function z5(t){switch(t){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function Zhe(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function Yhe(t){return Khe[t]}const Khe={5124:"sint32",5125:"uint32",5122:"sint16",5123:"uint16",5120:"sint8",5121:"uint8",5126:"float32",5131:"float16",33635:"uint16",32819:"uint16",32820:"uint16",33640:"uint32",35899:"uint32",35902:"uint32",34042:"uint32",36269:"uint32"};function Qhe(t,e){const{sourceX:r=0,sourceY:n=0,sourceAttachment:i=0}=e||{};let{target:a=null,sourceWidth:c,sourceHeight:s,sourceDepth:g,sourceFormat:_,sourceType:v}=e||{};const{framebuffer:T,deleteFramebuffer:M}=F5(t),{gl:O,handle:F}=T;c||=T.width,s||=T.height;const j=T.colorAttachments[i]?.texture;if(!j)throw new Error(`Invalid framebuffer attachment ${i}`);g=j?.depth||1,_||=j?.glFormat||6408,v||=j?.glType||5121,a=tfe(a,v,_,c,s);const V=q3(a);v=v||xhe(V);const q=O.bindFramebuffer(36160,F);return O.readBuffer(36064+i),O.readPixels(r,n,c,s,_,v,a),O.readBuffer(36064),O.bindFramebuffer(36160,q||null),M&&T.destroy(),a}function Jhe(t,e){const{target:r,sourceX:n=0,sourceY:i=0,sourceFormat:a=6408,targetByteOffset:c=0}=e||{};let{sourceWidth:s,sourceHeight:g,sourceType:_}=e||{};const{framebuffer:v,deleteFramebuffer:T}=F5(t);s=s||v.width,g=g||v.height;const M=v;_=_||5121;let O=r;if(!O){const j=z5(a),V=Zhe(_),q=c+s*g*j*V;O=M.device.createBuffer({byteLength:q})}const F=t.device.createCommandEncoder();return F.copyTextureToBuffer({sourceTexture:t,width:s,height:g,origin:[n,i],destinationBuffer:O,byteOffset:c}),F.destroy(),T&&v.destroy(),O}function F5(t){return t instanceof fw?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:efe(t),deleteFramebuffer:!0}}function efe(t,e){const{device:r,width:n,height:i,id:a}=t;return r.createFramebuffer({...e,id:`framebuffer-for-${a}`,width:n,height:i,colorAttachments:[t]})}function tfe(t,e,r,n,i,a){if(t)return t;e||=5121;const c=Yhe(e),s=G3(c),g=z5(r);return new s(n*i*g)}class kA extends Cg{type="webgl";handle;features;limits;info;canvasContext;preferredColorFormat="rgba8unorm";preferredDepthFormat="depth24plus";commandEncoder;lost;_resolveContextLost;gl;_constants;_extensions={};_polyfilled=!1;spectorJS;get[Symbol.toStringTag](){return"WebGLDevice"}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}isVertexFormatSupported(e){switch(e){case"unorm8x4-bgra":return!1;default:return!0}}constructor(e){super({...e,id:e.id||ohe("webgl-device")});const r=Cg._getCanvasContextProps(e);if(!r)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let n=r.canvas?.gl?.device;if(n)throw new Error(`WebGL context already attached to device ${n.id}`);this.canvasContext=new ahe(this,r),this.lost=new Promise(v=>{this._resolveContextLost=v});const i={...e.webgl};r.alphaMode==="premultiplied"&&(i.premultipliedAlpha=!0),e.powerPreference!==void 0&&(i.powerPreference=e.powerPreference);const c=this.props._handle||Uue(this.canvasContext.canvas,{onContextLost:v=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:v=>console.log("WebGL context restored")},i);if(!c)throw new Error("WebGL context creation failed");if(n=c.device,n){if(e._reuseDevices)return Dt.log(1,`Not creating a new Device, instead returning a reference to Device ${n.id} already attached to WebGL context`,n)(),n._reused=!0,n;throw new Error(`WebGL context already attached to device ${n.id}`)}this.handle=c,this.gl=c,this.spectorJS=wue({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=jue(this.gl,this._extensions),this.limits=new nhe(this.gl),this.features=new rhe(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),new bg(this.gl,{log:(...v)=>Dt.log(1,...v)()}).trackState(this.gl,{copyState:!1});const g=e.debugWebGL||e.debug,_=e.debugWebGL;g&&(this.gl=Aue(this.gl,{debugWebGL:g,traceWebGL:_}),Dt.warn("WebGL debug mode activated. Performance reduced.")(),e.debugWebGL&&(Dt.level=Math.max(Dt.level,1))),this.commandEncoder=new Dk(this,{id:`${this}-command-encoder`})}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}getTextureByteAlignment(){return 4}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const r=this._normalizeBufferProps(e);return new kv(this,r)}createTexture(e){return new Dv(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new _he(this,e)}createShader(e){return new hhe(this,e)}createFramebuffer(e){return new Ov(this,e)}createVertexArray(e){return new EC(this,e)}createTransformFeedback(e){return new Ghe(this,e)}createQuerySet(e){return new Xhe(this,e)}createRenderPipeline(e){return new Lhe(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}createCommandEncoder(e={}){return new Dk(this,e)}submit(e){e||(e=this.commandEncoder.finish(),this.commandEncoder.destroy(),this.commandEncoder=this.createCommandEncoder({id:`${this.id}-default-encoder`})),e._executeCommands()}readPixelsToArrayWebGL(e,r){return Qhe(e,r)}readPixelsToBufferWebGL(e,r){return Jhe(e,r)}setParametersWebGL(e){qy(this.gl,e)}getParametersWebGL(e){return R5(this.gl,e)}withParametersWebGL(e,r){return Kv(this.gl,e,r)}resetWebGL(){Dt.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),Lue(this.gl)}_getDeviceSpecificTextureFormatCapabilities(e){return Que(this.gl,e,this._extensions)}loseDevice(){let e=!1;const n=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return n&&(e=!0,n.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),e}pushState(){bg.get(this.gl).push()}popState(){bg.get(this.gl).pop()}getGLKey(e,r){const n=Number(e);for(const i in this.gl)if(this.gl[i]===n)return`GL.${i}`;return r?.emptyIfUnknown?"":String(e)}getGLKeys(e){const r={emptyIfUnknown:!0};return Object.entries(e).reduce((n,[i,a])=>(n[`${i}:${this.getGLKey(i,r)}`]=`${a}:${this.getGLKey(a,r)}`,n),{})}setConstantAttributeWebGL(e,r){const n=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(n).fill(null);const i=this._constants[e];switch(i&&sfe(i,r)&&Dt.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=r,r.constructor){case Float32Array:rfe(this,e,r);break;case Int32Array:nfe(this,e,r);break;case Uint32Array:ife(this,e,r);break;default:throw new Error("constant")}}getExtension(e){return Ry(this.gl,e,this._extensions),this._extensions}_setWebGLDebugMetadata(e,r,n){e.luma=r;const i={props:n.spector,id:n.spector.id};e.__SPECTOR_Metadata=i}}function rfe(t,e,r){switch(r.length){case 1:t.gl.vertexAttrib1fv(e,r);break;case 2:t.gl.vertexAttrib2fv(e,r);break;case 3:t.gl.vertexAttrib3fv(e,r);break;case 4:t.gl.vertexAttrib4fv(e,r);break}}function nfe(t,e,r){t.gl.vertexAttribI4iv(e,r)}function ife(t,e,r){t.gl.vertexAttribI4uiv(e,r)}function sfe(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}const Bk=Object.freeze(Object.defineProperty({__proto__:null,WebGLDevice:kA},Symbol.toStringTag,{value:"Module"}));function Ad(){}const afe=({isDragging:t})=>t?"grabbing":"grab",U5={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Ad,onWebGLInitialized:Ad,onResize:Ad,onViewStateChange:Ad,onInteractionStateChange:Ad,onBeforeRender:Ad,onAfterRender:Ad,onLoad:Ad,onError:t=>Kr.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:afe,getTooltip:null,debug:!1,drawPickingColors:!1};class CC{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new ow({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=n=>{const{_pickRequest:i}=this;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;{const a=n.offsetCenter;if(!a)return;i.x=a.x,i.y=a.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n},this._onEvent=n=>{const i=wA[n.type],a=n.offsetCenter;if(!i||!a||!this.layerManager)return;const c=this.layerManager.getLayers(),s=this.deckPicker.getLastPickedObject({x:a.x,y:a.y,layers:c,viewports:this.getViewports(a)},this._lastPointerDownInfo),{layer:g}=s,_=g&&(g[i]||g.props[i]),v=this.props[i];let T=!1;_&&(T=_.call(g,s,n)),T||(v?.(s,n),this.widgetManager.onEvent(s,n))},this._onPointerDown=n=>{if(this.device?.type==="webgpu")return;const i=n.offsetCenter,a=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=a.result[0]||a.emptyInfo},this.props={...U5,...e},e=this.props,e.viewState&&e.initialViewState&&Kr.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let r=this.device;!r&&e.gl&&(e.gl instanceof WebGLRenderingContext&&Kr.error("WebGL1 context not supported.")(),r=QT.attach(e.gl,this.props.deviceProps)),r||(r=this._createDevice(e)),this.animationLoop=this._createAnimationLoop(r,e),this.setProps(e),e._typedArrayManagerProps&&Ey.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Kr.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Kr.removed("onLayerClick","onClick")(),e.initialViewState&&!uc(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const r=Object.create(this.props);if(Object.assign(r,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),e.device&&e.device.id!==this.device?.id&&(this.animationLoop?.stop(),this.canvas!==e.device.canvasContext?.canvas&&(this.canvas?.remove(),this.eventManager?.destroy(),this.canvas=null),Kr.log(`recreating animation loop for new device! id=${e.device.id}`)(),this.animationLoop=this._createAnimationLoop(e.device,e),this.animationLoop.start()),this.animationLoop?.setProps(r),e.useDevicePixels!==void 0&&this.device?.canvasContext?.canvas instanceof HTMLCanvasElement){this.device.canvasContext.props.useDevicePixels=e.useDevicePixels;const n=this.device.canvasContext.canvas,i={target:n,contentBoxSize:[{inlineSize:n.clientWidth,blockSize:n.clientHeight}],devicePixelContentBoxSize:[{inlineSize:n.clientWidth,blockSize:n.clientHeight}],borderBoxSize:[{inlineSize:n.clientWidth,blockSize:n.clientHeight}]};this.device.canvasContext._handleResize([i])}this.layerManager&&(this.viewManager.setProps(r),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(r),this.effectManager.setProps(r),this.deckRenderer.setProps(r),this.deckPicker.setProps(r),this.widgetManager.setProps(r)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let r=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),a=this.effectManager.needsRedraw(e),c=this.deckRenderer.needsRedraw(e);return r=r||n||i||a||c,r}redraw(e){if(!this.layerManager)return;let r=this.needsRedraw({clearRedrawFlags:!0});r=e||r,r&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(r):this._drawLayers(r))}get isInitialized(){return this.viewManager!==null}getViews(){return ca(this.viewManager),this.viewManager.views}getViewports(e){return ca(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const r=this._pick("pickObject","pickObject Time",e).result;return r.length?r[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,r=!1){for(const n in e)this.layerManager.resourceManager.add({resourceId:n,data:e[n],forceUpdate:r})}_removeResources(e){for(const r of e)this.layerManager.resourceManager.remove(r)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,r,n){ca(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(r).timeStart();const a=this.deckPicker[e]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return i.get(r).timeEnd(),a}_createCanvas(e){let r=e.canvas;return typeof r=="string"&&(r=document.getElementById(r),ca(r)),r||(r=document.createElement("canvas"),r.id=e.id||"deckgl-overlay",e.width&&typeof e.width=="number"&&(r.width=e.width),e.height&&typeof e.height=="number"&&(r.height=e.height),(e.parent||document.body).appendChild(r)),Object.assign(r.style,e.style),r}_setCanvasSize(e){if(!this.canvas)return;const{width:r,height:n}=e;if(r||r===0){const i=Number.isFinite(r)?`${r}px`:r;this.canvas.style.width=i}if(n||n===0){const i=Number.isFinite(n)?`${n}px`:n;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=i}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const r=e.clientWidth??e.width,n=e.clientHeight??e.height;(r!==this.width||n!==this.height)&&(this.width=r,this.height=n,this.viewManager?.setProps({width:r,height:n}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:r,height:n}))}_createAnimationLoop(e,r){const{gl:n,onError:i}=r;return new mC({device:e,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:a=>this._setDevice(a.device),onRender:this._onRenderFrame.bind(this),onError:i})}_createDevice(e){const r=this.props.deviceProps?.createCanvasContext,n=typeof r=="object"?r:void 0,i={adapters:[],...e.deviceProps};i.adapters.includes(QT)||i.adapters.push(QT);const a={alphaMode:this.props.deviceProps?.type==="webgpu"?"premultiplied":void 0};return fA.createDevice({_reuseDevices:!0,type:"webgl",...i,createCanvasContext:{...a,...n,canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!0}})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,r=Array.isArray(e)?e:e?[e]:[new C5({id:"default-view"})];return r.length&&this.props.controller&&(r[0].props.controller=this.props.controller),r}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:r,emptyInfo:n}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=r.length>0;let i=n,a=!1;for(const c of r)i=c,a=c.layer?.onHover(c,e.event)||a;a||(this.props.onHover?.(i,e.event),this.widgetManager.onHover(i,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas,!this.canvas.isConnected&&this.props.parent&&this.props.parent.insertBefore(this.canvas,this.props.parent.firstChild)),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const r=new w5;r.play(),this.animationLoop.attachTimeline(r),this.eventManager=new Soe(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(QO).map(i=>{const[a,c,s,g]=QO[i],_=this.props.eventRecognizerOptions?.[i],v={...c,..._,event:i};return{recognizer:new a(v),recognizeWith:s,requestFailure:g}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const i in wA)this.eventManager.on(i,this._onEvent);this.viewManager=new Uce({timeline:r,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new Fce(this.device,{deck:this,stats:this.stats,viewport:n,timeline:r}),this.effectManager=new rue({deck:this,device:this.device}),this.deckRenderer=new sue(this.device),this.deckPicker=new lue(this.device),this.widgetManager=new hue({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new P5),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,r){const{device:n,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:i});const a={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...r};this.deckRenderer?.renderLayers(a),a.pass==="screen"&&this.widgetManager.onRedraw({viewports:a.viewports,layers:a.layers}),this.props.onAfterRender({device:n,gl:i})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Kr.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const r=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:r},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const r=this.animationLoop.stats;e.get("GPU Time").addTime(r.get("GPU Time").lastTiming),e.get("CPU Time").addTime(r.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:r}=this;e.fps=r.get("frameRate").getHz(),e.setPropsTime=r.get("setProps Time").time,e.updateAttributesTime=r.get("Update Attributes").time,e.framesRedrawn=r.get("Redraw Count").count,e.pickTime=r.get("pickObject Time").time+r.get("pickMultipleObjects Time").time+r.get("pickObjects Time").time,e.pickCount=r.get("Pick Count").count,e.gpuTime=r.get("GPU Time").time,e.cpuTime=r.get("CPU Time").time,e.gpuTimePerFrame=r.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=r.get("CPU Time").getAverageTime();const n=fA.stats.get("Memory Usage");e.bufferMemory=n.get("Buffer Memory").count,e.textureMemory=n.get("Texture Memory").count,e.renderbufferMemory=n.get("Renderbuffer Memory").count,e.gpuMemory=n.get("GPU Memory").count}}CC.defaultProps=U5;CC.VERSION=ine;function ofe(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return G3(t)}}const lfe=q3;function Qb(t,e,r){const n=r==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:t,format:e.size>1?`${n}x${e.size}`:e.type,byteOffset:e.offset||0}}function fg(t){return t.stride||t.size*t.bytesPerElement}function cfe(t,e){return t.type===e.type&&t.size===e.size&&fg(t)===fg(e)&&(t.offset||0)===(e.offset||0)}function DA(t,e){e.offset&&Kr.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const r=fg(t),n=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,i=e.elementOffset||0,a=n*r+i*t.bytesPerElement+(t.offset||0);return{...e,offset:a,stride:r}}function ufe(t,e){const r=DA(t,e);return{high:r,low:{...r,offset:r.offset+t.size*4}}}class hfe{constructor(e,r,n){this._buffer=null,this.device=e,this.id=r.id||"",this.size=r.size||1;const i=r.logicalType||r.type,a=i==="float64";let{defaultValue:c}=r;c=Number.isFinite(c)?[c]:c||new Array(this.size).fill(0);let s;a?s="float32":!i&&r.isIndexed?s="uint32":s=i||"float32";let g=ofe(i||s);this.doublePrecision=a,a&&r.fp64===!1&&(g=Float32Array),this.value=null,this.settings={...r,defaultType:g,defaultValue:c,logicalType:i,type:s,normalized:s.includes("norm"),size:this.size,bytesPerElement:g.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*fg(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Ey.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,r=null){const n={};if(this.state.constant){const i=this.value;if(r){const a=DA(this.getAccessor(),r),c=a.offset/i.BYTES_PER_ELEMENT,s=a.size||this.size;n[e]=i.subarray(c,c+s)}else n[e]=i}else n[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${e}64Low`]=n[e]:n[`${e}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(e=this.id,r=null){const n=this.getAccessor(),i=[],a={name:this.id,byteStride:fg(n),attributes:i};if(this.doublePrecision){const c=ufe(n,r||{});i.push(Qb(e,{...n,...c.high},this.device.type),Qb(`${e}64Low`,{...n,...c.low},this.device.type))}else if(r){const c=DA(n,r);i.push(Qb(e,{...n,...c},this.device.type))}else i.push(Qb(e,n,this.device.type));return a}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const r=Array.from(this.value);e=[r,r]}else{const{value:r,numInstances:n,size:i}=this,a=n*i;if(r&&a&&r.length>=a){const c=new Array(i).fill(1/0),s=new Array(i).fill(-1/0);for(let g=0;g<a;)for(let _=0;_<i;_++){const v=r[g++];v<c[_]&&(c[_]=v),v>s[_]&&(s[_]=v)}e=[c,s]}}return this.state.bounds=e,e}setData(e){const{state:r}=this;let n;ArrayBuffer.isView(e)?n={value:e}:e instanceof Ni?n={buffer:e}:n=e;const i={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)i.type="float32";else{const c=lfe(n.value);i.type=i.normalized?c.replace("int","norm"):c}i.bytesPerElement=n.value.BYTES_PER_ELEMENT,i.stride=fg(i)}if(r.bounds=null,n.constant){let a=n.value;if(a=this._normalizeValue(a,[],0),this.settings.normalized&&(a=this.normalizeConstant(a)),!(!r.constant||!this._areValuesEqual(a,this.value)))return!1;r.externalBuffer=null,r.constant=!0,this.value=ArrayBuffer.isView(a)?a:new Float32Array(a)}else if(n.buffer){const a=n.buffer;r.externalBuffer=a,r.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let a=n.value;r.externalBuffer=null,r.constant=!1,this.value=a;let{buffer:c}=this;const s=fg(i),g=(i.vertexOffset||0)*s;if(this.doublePrecision&&a instanceof Float64Array&&(a=qT(a,i)),this.settings.isIndexed){const v=this.settings.defaultType;a.constructor!==v&&(a=new v(a))}const _=a.byteLength+g+s*2;(!c||c.byteLength<_)&&(c=this._createBuffer(_)),c.write(a,g)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;const r=this.value,{startOffset:n=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&r instanceof Float64Array?qT(r,{size:this.size,startIndex:n,endIndex:i}):r.subarray(n,i),n*r.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,r=!1){const{state:n}=this,i=n.allocatedValue,a=Ey.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:r});this.value=a;const{byteOffset:c}=this;let{buffer:s}=this;return(!s||s.byteLength<a.byteLength+c)&&(s=this._createBuffer(a.byteLength+c),r&&i&&s.write(i instanceof Float64Array?qT(i,this):i,c)),n.allocatedValue=a,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:r}=e;if(!ArrayBuffer.isView(r))throw new Error(`Attribute ${this.id} value is not TypedArray`);const n=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=r.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${r.constructor.name}`);!(r instanceof n)&&this.settings.normalized&&!("normalized"in e)&&Kr.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(r=>(r+128)/255*2-1);case"snorm16":return new Float32Array(e).map(r=>(r+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(r=>r/255);case"unorm16":return new Float32Array(e).map(r=>r/65535);default:return e}}_normalizeValue(e,r,n){const{defaultValue:i,size:a}=this.settings;if(Number.isFinite(e))return r[n]=e,r;if(!e){let c=a;for(;--c>=0;)r[n+c]=i[c];return r}switch(a){case 4:r[n+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:r[n+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:r[n+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:r[n+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let c=a;for(;--c>=0;)r[n+c]=Number.isFinite(e[c])?e[c]:i[c]}return r}_areValuesEqual(e,r){if(!e||!r)return!1;const{size:n}=this;for(let i=0;i<n;i++)if(e[i]!==r[i])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();const{isIndexed:r,type:n}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(r?Ni.INDEX:Ni.VERTEX)|Ni.COPY_DST,indexType:r?n:void 0,byteLength:e}),this._buffer}}const Nk=[],zk=[];function gw(t,e=0,r=1/0){let n=Nk;const i={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?n=t:t.length>0&&(zk.length=t.length,n=zk):n=Nk,(e>0||Number.isFinite(r))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(e,r),i.index=e-1),{iterable:n,objectInfo:i}}function j5(t){return t&&t[Symbol.asyncIterator]}function V5(t,e){const{size:r,stride:n,offset:i,startIndices:a,nested:c}=e,s=t.BYTES_PER_ELEMENT,g=n?n/s:r,_=i?i/s:0,v=Math.floor((t.length-_)/g);return(T,{index:M,target:O})=>{if(!a){const q=M*g+_;for(let Y=0;Y<r;Y++)O[Y]=t[q+Y];return O}const F=a[M],j=a[M+1]||v;let V;if(c){V=new Array(j-F);for(let q=F;q<j;q++){const Y=q*g+_;O=new Array(r);for(let X=0;X<r;X++)O[X]=t[Y+X];V[q-F]=O}}else if(g===r)V=t.subarray(F*r+_,j*r+_);else{V=new t.constructor((j-F)*r);let q=0;for(let Y=F;Y<j;Y++){const X=Y*g+_;for(let ae=0;ae<r;ae++)V[q++]=t[X+ae]}}return V}}const ffe=[],gx=[[0,1/0]];function dfe(t,e){if(t===gx||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const r=[],n=t.length;let i=0;for(let a=0;a<n;a++){const c=t[a];c[1]<e[0]?(r.push(c),i=a+1):c[0]>e[1]?r.push(c):e=[Math.min(c[0],e[0]),Math.max(c[1],e[1])]}return r.splice(i,0,e),r}const pfe={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function $5(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const r=t.type||"interpolation";return{...pfe[r],...e,...t,type:r}}class H5 extends hfe{constructor(e,r){super(e,r,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:gx}),this.constant=!1,this.settings.update=r.update||(r.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const r=this.state.needsRedraw;return this.state.needsRedraw=r&&!e,r}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var r;(r=this.state).layoutChanged||(r.layoutChanged=!cfe(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:r}=this.settings,n=this.settings.transition,i=Array.isArray(r)?e[r.find(a=>e[a])]:e[r];return $5(i,n)}setNeedsUpdate(e=this.id,r){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),r){const{startRow:n=0,endRow:i=1/0}=r;this.state.updateRanges=dfe(this.state.updateRanges,[n,i])}else this.state.updateRanges=gx}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=ffe}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:r,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(e,r.updateRanges!==gx),!0):!1}updateBuffer({numInstances:e,data:r,props:n,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:a},settings:{update:c,noAlloc:s}}=this;let g=!0;if(c){for(const[_,v]of a)c.call(i,this,{data:r,startRow:_,endRow:v,props:n,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[_,v]of a){const T=Number.isFinite(_)?this.getVertexOffset(_):0,M=Number.isFinite(v)?this.getVertexOffset(v):s||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:T,endOffset:M})}this._checkAttributeArray()}else g=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),g}setConstantValue(e,r){const n=this.device.type==="webgpu";if(n||r===void 0||typeof r=="function"){if(n&&typeof r!="function"){const c=this._normalizeValue(r,[],0);this._areValuesEqual(c,this.value)||this.setNeedsUpdate("WebGPU constant updated")}return!1}const i=this.settings.transform&&e?this.settings.transform.call(e,r):r;return this.setData({constant:!0,value:i})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(e){const{state:r}=this;return e?(this.clearNeedsUpdate(),r.lastExternalBuffer===e||(r.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(r.lastExternalBuffer=null,!1)}setBinaryValue(e,r=null){const{state:n,settings:i}=this;if(!e)return n.binaryValue=null,n.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(n.binaryValue===e)return this.clearNeedsUpdate(),!0;if(n.binaryValue=e,this.setNeedsRedraw(),i.transform||r!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const c=e;ca(ArrayBuffer.isView(c.value),`invalid ${i.accessor}`);const s=!!c.size&&c.size!==this.size;return n.binaryAccessor=V5(c.value,{size:c.size||this.size,stride:c.stride,offset:c.offset,startIndices:r,nested:s}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:r}=this;return(r?e<r.length?r[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,r=super.getValue();if(!e)return r;for(const n in e)Object.assign(r,super.getValue(n,e[n]));return r}getBufferLayout(e){this.state.layoutChanged=!1;const r=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:i}=this.settings;if(i==="dynamic"?n.stepMode=e?e.isInstanced?"instance":"vertex":"instance":n.stepMode=i??"vertex",!r)return n;for(const a in r){const c=super._getBufferLayout(a,r[a]);n.attributes.push(...c.attributes)}return n}_autoUpdater(e,{data:r,startRow:n,endRow:i,props:a,numInstances:c}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:s,state:g,value:_,size:v,startIndices:T}=e,{accessor:M,transform:O}=s;let F=g.binaryAccessor||(typeof M=="function"?M:a[M]);typeof F!="function"&&typeof M=="string"&&(F=()=>a[M]),ca(typeof F=="function",`accessor "${M}" is not a function`);let j=e.getVertexOffset(n);const{iterable:V,objectInfo:q}=gw(r,n,i);for(const Y of V){q.index++;let X=F(Y,q);if(O&&(X=O.call(this,X)),T){const ae=(q.index<T.length-1?T[q.index+1]:c)-T[q.index];if(X&&Array.isArray(X[0])){let ue=j;for(const ge of X)e._normalizeValue(ge,_,ue),ue+=v}else X&&X.length>v?_.set(X,j):(e._normalizeValue(X,q.target,0),Dce({target:_,source:q.target,start:j,count:ae}));j+=ae*v}else e._normalizeValue(X,_,j),j+=v}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,r=Math.min(4,this.size);if(e&&e.length>=r){let n=!0;switch(r){case 4:n=n&&Number.isFinite(e[3]);case 3:n=n&&Number.isFinite(e[2]);case 2:n=n&&Number.isFinite(e[1]);case 1:n=n&&Number.isFinite(e[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function nS(t){const{source:e,target:r,start:n=0,size:i,getData:a}=t,c=t.end||r.length,s=e.length,g=c-n;if(s>g){r.set(e.subarray(0,g),n);return}if(r.set(e,n),!a)return;let _=s;for(;_<g;){const v=a(_,e);for(let T=0;T<i;T++)r[n+_]=v[T]||0,_++}}function gfe({source:t,target:e,size:r,getData:n,sourceStartIndices:i,targetStartIndices:a}){if(!i||!a)return nS({source:t,target:e,size:r,getData:n}),e;let c=0,s=0;const g=n&&((v,T)=>n(v+s,T)),_=Math.min(i.length,a.length);for(let v=1;v<_;v++){const T=i[v]*r,M=a[v]*r;nS({source:t.subarray(c,T),target:e,start:s,end:M,size:r,getData:g}),c=T,s=M}return s<e.length&&nS({source:[],target:e,start:s,size:r,getData:g}),e}function mfe(t){const{device:e,settings:r,value:n}=t,i=new H5(e,r);return i.setData({value:n instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:r.normalized}),i}function W5(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function q5(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function G5(t){t.push(t.shift())}function yfe(t,e){const{doublePrecision:r,settings:n,value:i,size:a}=t,c=r&&i instanceof Float64Array?2:1;let s=0;const{shaderAttributes:g}=t.settings;if(g)for(const _ of Object.values(g))s=Math.max(s,_.vertexOffset??0);return(n.noAlloc?i.length:(e+s)*a)*c}function X5({device:t,source:e,target:r}){return(!r||r.byteLength<e.byteLength)&&(r?.destroy(),r=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),r}function Z5({device:t,buffer:e,attribute:r,fromLength:n,toLength:i,fromStartIndices:a,getData:c=s=>s}){const s=r.doublePrecision&&r.value instanceof Float64Array?2:1,g=r.size*s,_=r.byteOffset,v=r.settings.bytesPerElement<4?_/r.settings.bytesPerElement*4:_,T=r.startIndices,M=a&&T,O=r.isConstant;if(!M&&e&&n>=i)return e;const F=r.value instanceof Float64Array?Float32Array:r.value.constructor,j=O?r.value:new F(r.getBuffer().readSyncWebGL(_,i*F.BYTES_PER_ELEMENT).buffer);if(r.settings.normalized&&!O){const X=c;c=(ae,ue)=>r.normalizeConstant(X(ae,ue))}const V=O?(X,ae)=>c(j,ae):(X,ae)=>c(j.subarray(X+_,X+_+g),ae),q=e?new Float32Array(e.readSyncWebGL(v,n*4).buffer):new Float32Array(0),Y=new Float32Array(i);return gfe({source:q,target:Y,sourceStartIndices:a,targetStartIndices:T,size:g,getData:V}),(!e||e.byteLength<Y.byteLength+v)&&(e?.destroy(),e=t.createBuffer({byteLength:Y.byteLength+v,usage:35050})),e.write(Y,v),e}class Y5{constructor({device:e,attribute:r,timeline:n}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new pw(n),this.attribute=r,this.attributeInTransition=mfe(r),this.currentStartIndices=r.startIndices}get inProgress(){return this.transition.inProgress}start(e,r,n=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=yfe(this.attribute,r),this.transition.start({...e,duration:n})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class _fe extends Y5{constructor({device:e,attribute:r,timeline:n}){super({device:e,attribute:r,timeline:n}),this.type="interpolation",this.transform=wfe(e,r)}start(e,r){const n=this.currentLength,i=this.currentStartIndices;if(super.start(e,r,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:a,attribute:c}=this;G5(a),a[0]=Z5({device:this.device,buffer:a[0],attribute:c,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),a[1]=X5({device:this.device,source:a[0],target:a[1]}),this.setBuffer(a[1]);const{transform:s}=this,g=s.model;let _=Math.floor(this.currentLength/c.size);K5(c)&&(_/=2),g.setVertexCount(_),c.isConstant?(g.setAttributes({aFrom:a[0]}),g.setConstantAttributes({aTo:c.value})):g.setAttributes({aFrom:a[0],aTo:c.getBuffer()}),s.transformFeedback.setBuffers({vCurrent:a[1]})}onUpdate(){const{duration:e,easing:r}=this.settings,{time:n}=this.transition;let i=n/e;r&&(i=r(i));const{model:a}=this.transform,c={time:i};a.shaderInputs.setProps({interpolation:c}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const vfe=`uniform interpolationUniforms {
  float time;
} interpolation;
`,Fk={name:"interpolation",vs:vfe,uniformTypes:{time:"f32"}},bfe=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,xfe=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function K5(t){return t.doublePrecision&&t.value instanceof Float64Array}function wfe(t,e){const r=e.size,n=W5(r),i=q5(r),a=e.getBufferLayout();return K5(e)?new Py(t,{vs:xfe,bufferLayout:[{name:"aFrom",byteStride:8*r,attributes:[{attribute:"aFrom",format:i,byteOffset:0},{attribute:"aFrom64Low",format:i,byteOffset:4*r}]},{name:"aTo",byteStride:8*r,attributes:[{attribute:"aTo",format:i,byteOffset:0},{attribute:"aTo64Low",format:i,byteOffset:4*r}]}],modules:[hae,Fk],defines:{ATTRIBUTE_TYPE:n,ATTRIBUTE_SIZE:r},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Py(t,{vs:bfe,bufferLayout:[{name:"aFrom",format:i},{name:"aTo",format:a.attributes[0].format}],modules:[Fk],defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"],disableWarnings:!0})}class Tfe extends Y5{constructor({device:e,attribute:r,timeline:n}){super({device:e,attribute:r,timeline:n}),this.type="spring",this.texture=Mfe(e),this.framebuffer=Ife(e,this.texture),this.transform=Pfe(e,r)}start(e,r){const n=this.currentLength,i=this.currentStartIndices;super.start(e,r);const{buffers:a,attribute:c}=this;for(let g=0;g<2;g++)a[g]=Z5({device:this.device,buffer:a[g],attribute:c,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});a[2]=X5({device:this.device,source:a[0],target:a[2]}),this.setBuffer(a[1]);const{model:s}=this.transform;s.setVertexCount(Math.floor(this.currentLength/c.size)),c.isConstant?s.setConstantAttributes({aTo:c.value}):s.setAttributes({aTo:c.getBuffer()})}onUpdate(){const{buffers:e,transform:r,framebuffer:n,transition:i}=this,a=this.settings;r.model.setAttributes({aPrev:e[0],aCur:e[1]}),r.transformFeedback.setBuffers({vNext:e[2]});const c={stiffness:a.stiffness,damping:a.damping};r.model.shaderInputs.setProps({spring:c}),r.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),G5(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const Sfe=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,Afe={name:"spring",vs:Sfe,uniformTypes:{damping:"f32",stiffness:"f32"}},Efe=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,Cfe=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function Pfe(t,e){const r=W5(e.size),n=q5(e.size);return new Py(t,{vs:Efe,fs:Cfe,bufferLayout:[{name:"aPrev",format:n},{name:"aCur",format:n},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[Afe],defines:{ATTRIBUTE_TYPE:r},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function Mfe(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",width:1,height:1})}function Ife(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const Rfe={interpolation:_fe,spring:Tfe};class Ofe{constructor(e,{id:r,timeline:n}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=r,this.device=e,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:r,numInstances:n}){this.numInstances=n||1;for(const i in e){const a=e[i],c=a.getTransitionSetting(r);c&&this._updateAttribute(i,a,c)}for(const i in this.transitions){const a=e[i];(!a||!a.getTransitionSetting(r))&&this._removeTransition(i)}}hasAttribute(e){const r=this.transitions[e];return r&&r.inProgress}getAttributes(){const e={};for(const r in this.transitions){const n=this.transitions[r];n.inProgress&&(e[r]=n.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const r in this.transitions)this.transitions[r].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,r,n){const i=this.transitions[e];let a=!i||i.type!==n.type;if(a){i&&this._removeTransition(e);const c=Rfe[n.type];c?this.transitions[e]=new c({attribute:r,timeline:this.timeline,device:this.device}):(Kr.error(`unsupported transition type '${n.type}'`)(),a=!1)}(a||r.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(n,this.numInstances))}}const Uk="attributeManager.invalidate",kfe="attributeManager.updateStart",Dfe="attributeManager.updateEnd",Lfe="attribute.updateStart",Bfe="attribute.allocate",Nfe="attribute.updateEnd";class zfe{constructor(e,{id:r="attribute-manager",stats:n,timeline:i}={}){this.mergeBoundsMemoized=b0(Dle),this.id=r,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new Ofe(e,{id:`${r}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const r=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,r&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const r of e)this.attributes[r]!==void 0&&(this.attributes[r].delete(),delete this.attributes[r])}invalidate(e,r){const n=this._invalidateTrigger(e,r);ka(Uk,this,e,n)}invalidateAll(e){for(const r in this.attributes)this.attributes[r].setNeedsUpdate(r,e);ka(Uk,this,"all")}update({data:e,numInstances:r,startIndices:n=null,transitions:i,props:a={},buffers:c={},context:s={}}){let g=!1;ka(kfe,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const _ in this.attributes){const v=this.attributes[_],T=v.settings.accessor;v.startIndices=n,v.numInstances=r,a[_]&&Kr.removed(`props.${_}`,`data.attributes.${_}`)(),v.setExternalBuffer(c[_])||v.setBinaryValue(typeof T=="string"?c[T]:void 0,e.startIndices)||typeof T=="string"&&!c[T]&&v.setConstantValue(s,a[T])||v.needsUpdate()&&(g=!0,this._updateAttribute({attribute:v,numInstances:r,data:e,props:a,context:s})),this.needsRedraw=this.needsRedraw||v.needsRedraw()}g&&ka(Dfe,this,r),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:r,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,r=e.run();return this.needsRedraw=this.needsRedraw||r,r}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const r=e.map(n=>this.attributes[n]?.getBounds());return this.mergeBoundsMemoized(r)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:r,attributeTransitionManager:n}=this,i={...n.getAttributes()};for(const a in r){const c=r[a];c.needsRedraw(e)&&!n.hasAttribute(a)&&(i[a]=c)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(r=>r.getBufferLayout(e))}_add(e,r){for(const n in e){const i=e[n],a={...i,id:n,size:i.isIndexed&&1||i.size||1,...r};this.attributes[n]=new H5(this.device,a)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const r in this.attributes)this.attributes[r].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(r)});this.updateTriggers=e}_invalidateTrigger(e,r){const{attributes:n,updateTriggers:i}=this,a=i[e];return a&&a.forEach(c=>{const s=n[c];s&&s.setNeedsUpdate(s.id,r)}),a}_updateAttribute(e){const{attribute:r,numInstances:n}=e;if(ka(Lfe,r),r.constant){r.setConstantValue(e.context,r.value);return}r.allocate(n)&&ka(Bfe,r,n),r.updateBuffer(e)&&(this.needsRedraw=!0,ka(Nfe,r,n))}}class Ffe extends pw{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:r,toValue:n,duration:i,easing:a}}=this,c=a(e/i);this._value=m1(r,n,c)}}const jk=1e-5;function Vk(t,e,r,n,i){const a=e-t,s=(r-e)*i,g=-a*n;return s+g+a+e}function Ufe(t,e,r,n,i){if(Array.isArray(r)){const a=[];for(let c=0;c<r.length;c++)a[c]=Vk(t[c],e[c],r[c],n,i);return a}return Vk(t,e,r,n,i)}function $k(t,e){if(Array.isArray(t)){let r=0;for(let n=0;n<t.length;n++){const i=t[n]-e[n];r+=i*i}return Math.sqrt(r)}return Math.abs(t-e)}class jfe extends pw{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:r,damping:n,stiffness:i}=this.settings,{_prevValue:a=e,_currValue:c=e}=this;let s=Ufe(a,c,r,n,i);const g=$k(s,r),_=$k(s,c);g<jk&&_<jk&&(s=r,this.end()),this._prevValue=c,this._currValue=s}}const Vfe={interpolation:Ffe,spring:jfe};class $fe{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,r,n,i){const{transitions:a}=this;if(a.has(e)){const g=a.get(e),{value:_=g.settings.fromValue}=g;r=_,this.remove(e)}if(i=$5(i),!i)return;const c=Vfe[i.type];if(!c){Kr.error(`unsupported transition type '${i.type}'`)();return}const s=new c(this.timeline);s.start({...i,fromValue:r,toValue:n}),a.set(e,s)}remove(e){const{transitions:r}=this;r.has(e)&&(r.get(e).cancel(),r.delete(e))}update(){const e={};for(const[r,n]of this.transitions)n.update(),e[r]=n.value,n.inProgress||this.remove(r);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function Hfe(t){const e=t[Nd];for(const r in e){const n=e[r],{validate:i}=n;if(i&&!i(t[r],n))throw new Error(`Invalid prop ${r}: ${t[r]}`)}}function Wfe(t,e){const r=Q5({newProps:t,oldProps:e,propTypes:t[Nd],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=Gfe(t,e);let i=!1;return n||(i=Xfe(t,e)),{dataChanged:n,propsChanged:r,updateTriggersChanged:i,extensionsChanged:Zfe(t,e),transitionsChanged:qfe(t,e)}}function qfe(t,e){if(!t.transitions)return!1;const r={},n=t[Nd];let i=!1;for(const a in t.transitions){const c=n[a],s=c&&c.type;(s==="number"||s==="color"||s==="array")&&LA(t[a],e[a],c)&&(r[a]=!0,i=!0)}return i?r:!1}function Q5({newProps:t,oldProps:e,ignoreProps:r={},propTypes:n={},triggerName:i="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${i} changed shallowly`;if(typeof e!="object"||e===null)return`${i} changed shallowly`;for(const a of Object.keys(t))if(!(a in r)){if(!(a in e))return`${i}.${a} added`;const c=LA(t[a],e[a],n[a]);if(c)return`${i}.${a} ${c}`}for(const a of Object.keys(e))if(!(a in r)){if(!(a in t))return`${i}.${a} dropped`;if(!Object.hasOwnProperty.call(t,a)){const c=LA(t[a],e[a],n[a]);if(c)return`${i}.${a} ${c}`}}return!1}function LA(t,e,r){let n=r&&r.equal;return n&&!n(t,e,r)||!n&&(n=t&&e&&t.equals,n&&!n.call(t,e))?"changed deeply":!n&&e!==t?"changed shallowly":null}function Gfe(t,e){if(e===null)return"oldProps is null, initial diff";let r=!1;const{dataComparator:n,_dataDiff:i}=t;return n?n(t.data,e.data)||(r="Data comparator detected a change"):t.data!==e.data&&(r="A new data container was supplied"),r&&i&&(r=i(t.data,e.data)||r),r}function Xfe(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&Hk(t,e,"all"))return{all:!0};const r={};let n=!1;for(const i in t.updateTriggers)i!=="all"&&Hk(t,e,i)&&(r[i]=!0,n=!0);return n?r:!1}function Zfe(t,e){if(e===null)return!0;const r=e.extensions,{extensions:n}=t;if(n===r)return!1;if(!r||!n||n.length!==r.length)return!0;for(let i=0;i<n.length;i++)if(!n[i].equals(r[i]))return!0;return!1}function Hk(t,e,r){let n=t.updateTriggers[r];n=n??{};let i=e.updateTriggers[r];return i=i??{},Q5({oldProps:i,newProps:n,triggerName:r})}const Yfe="count(): argument not an object",Kfe="count(): argument not a container";function Qfe(t){if(!ede(t))throw new Error(Yfe);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(Jfe(t))return Object.keys(t).length;throw new Error(Kfe)}function Jfe(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function ede(t){return t!==null&&typeof t=="object"}function Wk(t,e){if(!e)return t;const r={...t,...e};if("defines"in e&&(r.defines={...t.defines,...e.defines}),"modules"in e&&(r.modules=(t.modules||[]).concat(e.modules),e.modules.some(n=>n.name==="project64"))){const n=r.modules.findIndex(i=>i.name==="project32");n>=0&&r.modules.splice(n,1)}if("inject"in e)if(!t.inject)r.inject=e.inject;else{const n={...t.inject};for(const i in e.inject)n[i]=(n[i]||"")+e.inject[i];r.inject=n}return r}const tde={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},BA={};function rde(t,e,r,n){if(r instanceof Ps)return r;r.constructor&&r.constructor.name!=="Object"&&(r={data:r});let i=null;r.compressed&&(i={minFilter:"linear",mipmapFilter:r.data.length>1?"nearest":"linear"});const{width:a,height:c}=r.data,s=e.createTexture({...r,sampler:{...tde,...i,...n},mipLevels:e.getMipLevelCount(a,c)});return s.generateMipmapsWebGL(),BA[s.id]=t,s}function nde(t,e){!e||!(e instanceof Ps)||BA[e.id]===t&&(e.delete(),delete BA[e.id])}const ide={boolean:{validate(t,e){return!0},equal(t,e,r){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||NA(t)&&(t.length===3||t.length===4)},equal(t,e,r){return uc(t,e,1)}},accessor:{validate(t,e){const r=S1(t);return r==="function"||r===S1(e.value)},equal(t,e,r){return typeof e=="function"?!0:uc(t,e,1)}},array:{validate(t,e){return e.optional&&!t||NA(t)},equal(t,e,r){const{compare:n}=r,i=Number.isInteger(n)?n:n?1:0;return n?uc(t,e,i):t===e}},object:{equal(t,e,r){if(r.ignore)return!0;const{compare:n}=r,i=Number.isInteger(n)?n:n?1:0;return n?uc(t,e,i):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,r){return!r.compare&&r.ignore!==!1||t===e}},data:{transform:(t,e,r)=>{if(!t)return t;const{dataTransform:n}=r.props;return n?n(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,r)=>{const n=r.context;return!n||!n.device?null:rde(r.id,n.device,t,{...e.parameters,...r.props.textureParameters})},release:(t,e,r)=>{nde(r.id,t)}}};function sde(t){const e={},r={},n={};for(const[i,a]of Object.entries(t)){const c=a?.deprecatedFor;if(c)n[i]=Array.isArray(c)?c:[c];else{const s=ade(i,a);e[i]=s,r[i]=s.value}}return{propTypes:e,defaultProps:r,deprecatedProps:n}}function ade(t,e){switch(S1(e)){case"object":return uv(t,e);case"array":return uv(t,{type:"array",value:e,compare:!1});case"boolean":return uv(t,{type:"boolean",value:e});case"number":return uv(t,{type:"number",value:e});case"function":return uv(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function uv(t,e){return"type"in e?{name:t,...ide[e.type],...e}:"value"in e?{name:t,type:S1(e.value),...e}:{name:t,type:"object",value:e}}function NA(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function S1(t){return NA(t)?"array":t===null?"null":typeof t}function ode(t,e){let r;for(let a=e.length-1;a>=0;a--){const c=e[a];"extensions"in c&&(r=c.extensions)}const n=zA(t.constructor,r),i=Object.create(n);i[T1]=t,i[Og]={},i[kd]={};for(let a=0;a<e.length;++a){const c=e[a];for(const s in c)i[s]=c[s]}return Object.freeze(i),i}const lde="_mergedDefaultProps";function zA(t,e){if(!(t instanceof mw.constructor))return{};let r=lde;if(e)for(const i of e){const a=i.constructor;a&&(r+=`:${a.extensionName||a.name}`)}const n=J5(t,r);return n||(t[r]=cde(t,e||[]))}function cde(t,e){if(!t.prototype)return null;const n=Object.getPrototypeOf(t),i=zA(n),a=J5(t,"defaultProps")||{},c=sde(a),s=Object.assign(Object.create(null),i,c.defaultProps),g=Object.assign(Object.create(null),i?.[Nd],c.propTypes),_=Object.assign(Object.create(null),i?.[KT],c.deprecatedProps);for(const v of e){const T=zA(v.constructor);T&&(Object.assign(s,T),Object.assign(g,T[Nd]),Object.assign(_,T[KT]))}return ude(s,t),fde(s,g),hde(s,_),s[Nd]=g,s[KT]=_,e.length===0&&!PC(t,"_propTypes")&&(t._propTypes=g),s}function ude(t,e){const r=pde(e);Object.defineProperties(t,{id:{writable:!0,value:r}})}function hde(t,e){for(const r in e)Object.defineProperty(t,r,{enumerable:!1,set(n){const i=`${this.id}: ${r}`;for(const a of e[r])PC(this,a)||(this[a]=n);Kr.deprecated(i,e[r].join("/"))()}})}function fde(t,e){const r={},n={};for(const i in e){const a=e[i],{name:c,value:s}=a;a.async&&(r[c]=s,n[c]=dde(c))}t[hy]=r,t[Og]={},Object.defineProperties(t,n)}function dde(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||j5(e)?this[Og][t]=e:this[kd][t]=e},get(){if(this[kd]){if(t in this[kd])return this[kd][t]||this[hy][t];if(t in this[Og]){const e=this[T1]&&this[T1].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[hy][t]}}return this[hy][t]}}}function PC(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function J5(t,e){return PC(t,e)&&t[e]}function pde(t){const e=t.componentName;return e||Kr.warn(`${t.name}.componentName not specified`)(),e||t.name}let gde=0;class mw{constructor(...e){this.props=ode(this,e),this.id=this.props.id,this.count=gde++}clone(e){const{props:r}=this,n={};for(const i in r[hy])i in r[kd]?n[i]=r[kd][i]:i in r[Og]&&(n[i]=r[Og][i]);return new this.constructor({...r,...n,...e})}}mw.componentName="Component";mw.defaultProps={};const mde=Object.freeze({});class yde{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const r=this.asyncProps[e];r&&r.type&&r.type.release&&r.type.release(r.resolvedValue,r.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||mde}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const r=this.asyncProps[e];return r&&r.resolvedValue}isAsyncPropLoading(e){if(e){const r=this.asyncProps[e];return!!(r&&r.pendingLoadCount>0&&r.pendingLoadCount!==r.resolvedLoadCount)}for(const r in this.asyncProps)if(this.isAsyncPropLoading(r))return!0;return!1}reloadAsyncProp(e,r){this._watchPromise(e,Promise.resolve(r))}setAsyncProps(e){this.component=e[T1]||this.component;const r=e[kd]||{},n=e[Og]||e,i=e[hy]||{};for(const a in r){const c=r[a];this._createAsyncPropData(a,i[a]),this._updateAsyncProp(a,c),r[a]=this.getAsyncProp(a)}for(const a in n){const c=n[a];this._createAsyncPropData(a,i[a]),this._updateAsyncProp(a,c)}}_fetch(e,r){return null}_onResolve(e,r){}_onError(e,r){}_updateAsyncProp(e,r){if(this._didAsyncInputValueChange(e,r)){if(typeof r=="string"&&(r=this._fetch(e,r)),r instanceof Promise){this._watchPromise(e,r);return}if(j5(r)){this._resolveAsyncIterable(e,r);return}this._setPropValue(e,r)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,r){const n=this.asyncProps[e];return r===n.resolvedValue||r===n.lastValue?!1:(n.lastValue=r,!0)}_setPropValue(e,r){this._freezeAsyncOldProps();const n=this.asyncProps[e];n&&(r=this._postProcessValue(n,r),n.resolvedValue=r,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(e,r,n){const i=this.asyncProps[e];i&&n>=i.resolvedLoadCount&&r!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=r,i.resolvedLoadCount=n,this.onAsyncPropUpdated(e,r))}_watchPromise(e,r){const n=this.asyncProps[e];if(n){n.pendingLoadCount++;const i=n.pendingLoadCount;r.then(a=>{this.component&&(a=this._postProcessValue(n,a),this._setAsyncPropValue(e,a,i),this._onResolve(e,a))}).catch(a=>{this._onError(e,a)})}}async _resolveAsyncIterable(e,r){if(e!=="data"){this._setPropValue(e,r);return}const n=this.asyncProps[e];if(!n)return;n.pendingLoadCount++;const i=n.pendingLoadCount;let a=[],c=0;for await(const s of r){if(!this.component)return;const{dataTransform:g}=this.component.props;g?a=g(s,a):a=a.concat(s),Object.defineProperty(a,"__diff",{enumerable:!1,value:[{startRow:c,endRow:a.length}]}),c=a.length,this._setAsyncPropValue(e,a,i)}this._onResolve(e,a)}_postProcessValue(e,r){const n=e.type;return n&&this.component&&(n.release&&n.release(e.resolvedValue,n,this.component),n.transform)?n.transform(r,n,this.component):r}_createAsyncPropData(e,r){if(!this.asyncProps[e]){const i=this.component&&this.component.props[Nd];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:r,pendingLoadCount:0,resolvedLoadCount:0}}}}class _de extends yde{constructor({attributeManager:e,layer:r}){super(r),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,r){const n=this.layer,i=n?.props.fetch;return i?i(r,{propName:e,layer:n}):super._fetch(e,r)}_onResolve(e,r){const n=this.layer;if(n){const i=n.props.onDataLoad;e==="data"&&i&&i(r,{propName:e,layer:n})}}_onError(e,r){const n=this.layer;n&&n.raiseError(r,`loading ${e} of ${this.layer}`)}}const vde="layer.changeFlag",bde="layer.initialize",xde="layer.update",wde="layer.finalize",Tde="layer.matched",qk=2**24-1,Sde=Object.freeze([]),Ade=b0(({oldViewport:t,viewport:e})=>t.equals(e));let tu=new Uint8ClampedArray(0);const Ede={data:{type:"data",value:Sde,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:r,loaders:n,loadOptions:i,signal:a})=>{const{resourceManager:c}=r.context;i=i||r.getLoadOptions(),n=n||r.props.loaders,a&&(i={...i,fetch:{...i?.fetch,signal:a}});let s=c.contains(t);return!s&&!i&&(c.add({resourceId:t,data:s1(t,n),persistent:!1}),s=!0),s?c.subscribe({resourceId:t,onChange:g=>r.internalState?.reloadAsyncProp(e,g),consumerId:r.id,requestId:e}):s1(t,n,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:cn.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Pf extends mw{constructor(){super(...arguments),this.internalState=null,this.lifecycle=Qm.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){ca(this.internalState);const r=this.internalState.viewport||this.context.viewport,n=x5(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,a,c]=y5(n,r.pixelProjectionMatrix);return e.length===2?[i,a]:[i,a,c]}unproject(e){return ca(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,r){ca(this.internalState);const n=this.internalState.viewport||this.context.viewport;return Ule(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...r})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const r of this.getModels())r.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===cn.DEFAULT||e===cn.LNGLAT||e===cn.CARTESIAN}onHover(e,r){return this.props.onHover&&this.props.onHover(e,r)||!1}onClick(e,r){return this.props.onClick&&this.props.onClick(e,r)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,r=[]){return r[0]=e+1&255,r[1]=e+1>>8&255,r[2]=e+1>>8>>8&255,r}decodePickingColor(e){ca(e instanceof Uint8Array);const[r,n,i]=e;return r+n*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:Qfe(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){e=Wk(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const r of this.props.extensions)e=Wk(e,r.getShaders.call(this,r));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const r=this.getAttributeManager(),{dataChanged:n}=e.changeFlags;if(n&&r)if(Array.isArray(n))for(const i of n)r.invalidateAll(i);else r.invalidateAll();if(r){const{props:i}=e,a=this.internalState.hasPickingBuffer,c=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(s=>s.getNeedsPickingBuffer.call(this,s));if(a!==c){this.internalState.hasPickingBuffer=c;const{pickingColors:s,instancePickingColors:g}=r.attributes,_=s||g;_&&(c&&_.constant&&(_.constant=!1,r.invalidate(_.id)),!_.value&&!c&&(_.constant=!0,_.value=[0,0,0]))}}}finalizeState(e){for(const n of this.getModels())n.destroy();const r=this.getAttributeManager();r&&r.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const r of this.getModels())r.draw(e.renderPass)}getPickingInfo({info:e,mode:r,sourceLayer:n}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,r){r&&(e=new Error(`${r}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;const r=this.internalState.viewport;this.internalState.viewport=e,(!r||!Ade({oldViewport:r,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const r=this.getAttributeManager();r&&(e==="all"?r.invalidateAll():r.invalidate(e))}updateAttributes(e){let r=!1;for(const n in e)e[n].layoutChanged()&&(r=!0);for(const n of this.getModels())this._setModelAttributes(n,e,r)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const r=this.props,n=this.getNumInstances(),i=this.getStartIndices();e.update({data:r.data,numInstances:n,startIndices:i,props:r,transitions:r.transitions,buffers:r.data.attributes,context:this});const a=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(a)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const r=e.update(),n=Object.create(this.props);for(const i in r)Object.defineProperty(n,i,{value:r[i]});return n}return this.props}calculateInstancePickingColors(e,{numInstances:r}){if(e.constant)return;const n=Math.floor(tu.length/4);if(this.internalState.usesPickingColorCache=!0,n<r){r>qk&&Kr.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),tu=Ey.allocate(tu,r,{size:4,copy:!0,maxCount:Math.max(r,qk)});const i=Math.floor(tu.length/4),a=[0,0,0];for(let c=n;c<i;c++)this.encodePickingColor(c,a),tu[c*4+0]=a[0],tu[c*4+1]=a[1],tu[c*4+2]=a[2],tu[c*4+3]=0}e.value=tu.subarray(0,r*4)}_setModelAttributes(e,r,n=!1){if(!Object.keys(r).length)return;if(n){const s=this.getAttributeManager();e.setBufferLayout(s.getBufferLayouts(e)),r=s.getAttributes()}const i=e.userData?.excludeAttributes||{},a={},c={};for(const s in r){if(i[s])continue;const g=r[s].getValue();for(const _ in g){const v=g[_];v instanceof Ni?r[s].settings.isIndexed?e.setIndexBuffer(v):a[_]=v:v&&(c[_]=v)}}e.setAttributes(a),e.setConstantAttributes(c)}disablePickingIndex(e){const r=this.props.data;if(!("attributes"in r)){this._disablePickingIndex(e);return}const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,a=n||i,c=a&&r.attributes&&r.attributes[a.id];if(c&&c.value){const s=c.value,g=this.encodePickingColor(e);for(let _=0;_<r.length;_++){const v=a.getVertexOffset(_);s[v]===g[0]&&s[v+1]===g[1]&&s[v+2]===g[2]&&this._disablePickingIndex(_)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:r,instancePickingColors:n}=this.getAttributeManager().attributes,i=r||n;if(!i)return;const a=i.getVertexOffset(e),c=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(c-a),a)}restorePickingColors(){const{pickingColors:e,instancePickingColors:r}=this.getAttributeManager().attributes,n=e||r;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==tu.buffer&&(n.value=tu.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){ca(!this.internalState),ca(Number.isFinite(this.props.coordinateSystem)),ka(bde,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new _de({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Kr.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new $fe(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const r of this.props.extensions)r.initializeState.call(this,this.context,r);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){ka(Tde,this,this===e);const{state:r,internalState:n}=e;this!==e&&(this.internalState=n,this.state=r,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(ka(xde,this,e),!e)return;const r=this.props,n=this.context,i=this.internalState,a=n.viewport,c=this._updateUniformTransition();i.propsInTransition=c,n.viewport=i.viewport||a,this.props=c;try{const s=this._getUpdateParams(),g=this.getModels();if(n.device)this.updateState(s);else try{this.updateState(s)}catch{}for(const v of this.props.extensions)v.updateState.call(this,s,v);this.setNeedsRedraw(),this._updateAttributes();const _=this.getModels()[0]!==g[0];this._postUpdate(s,_)}finally{n.viewport=a,this.props=r,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){ka(wde,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:r=null,uniforms:n={},parameters:i={}}){this._updateAttributeTransition();const a=this.props,c=this.context;this.props=this.internalState.propsInTransition||a;try{r&&this.setShaderModuleProps(r);const{getPolygonOffset:s}=this.props,g=s&&s(n)||[0,0];c.device instanceof kA&&c.device.setParametersWebGL({polygonOffset:g});for(const _ of this.getModels())_.device.type==="webgpu"?_.setParameters({..._.parameters,...i}):_.setParameters(i);if(c.device instanceof kA)c.device.withParametersWebGL(i,()=>{const _={renderPass:e,shaderModuleProps:r,uniforms:n,parameters:i,context:c};for(const v of this.props.extensions)v.draw.call(this,_,v);this.draw(_)});else{const _={renderPass:e,shaderModuleProps:r,uniforms:n,parameters:i,context:c};for(const v of this.props.extensions)v.draw.call(this,_,v);this.draw(_)}}finally{this.props=a}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:r}=this.internalState;for(const i in e)if(e[i]){let a=!1;switch(i){case"dataChanged":const c=e[i],s=r[i];c&&Array.isArray(s)&&(r.dataChanged=Array.isArray(c)?s.concat(c):c,a=!0);default:r[i]||(r[i]=e[i],a=!0)}a&&ka(vde,this,i,e)}const n=!!(r.dataChanged||r.updateTriggersChanged||r.propsChanged||r.extensionsChanged);r.propsOrDataChanged=n,r.somethingChanged=n||r.viewportChanged||r.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,r){const n=Wfe(e,r);if(n.updateTriggersChanged)for(const i in n.updateTriggersChanged)n.updateTriggersChanged[i]&&this.invalidateAttribute(i);if(n.transitionsChanged)for(const i in n.transitionsChanged)this.internalState.uniformTransitions.add(i,r[i],e[i],e.transitions?.[i]);return this.setChangeFlags(n)}validateProps(){Hfe(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const r={highlightedObjectColor:e.picked?e.color:null},{highlightColor:n}=this.props;e.picked&&typeof n=="function"&&(r.highlightColor=n(e)),this.setShaderModuleProps({picking:r}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new zfe(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,r){const{props:n,oldProps:i}=e,a=this.state.model;a?.isInstanced&&a.setInstanceCount(this.getNumInstances());const{autoHighlight:c,highlightedObjectIndex:s,highlightColor:g}=n;if(r||i.autoHighlight!==c||i.highlightedObjectIndex!==s||i.highlightColor!==g){const _={};Array.isArray(g)&&(_.highlightColor=g),(r||i.autoHighlight!==c||s!==i.highlightedObjectIndex)&&(_.highlightedObjectColor=Number.isFinite(s)&&s>=0?this.encodePickingColor(s):null),this.setShaderModuleProps({picking:_})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let r=!1;r=r||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),i=n?n.getNeedsRedraw(e):!1;if(r=r||i,r)for(const a of this.props.extensions)a.onNeedsRedraw.call(this,a);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,r}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Pf.defaultProps=Ede;Pf.layerName="Layer";const Cde="compositeLayer.renderLayers";class MC extends Pf{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:r}=e;return r&&r.__source&&r.__source.parent&&r.__source.parent.id===this.id&&(e.object=r.__source.object,e.index=r.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,r){return r&&r.length}getSubLayerClass(e,r){const{_subLayerProps:n}=this.props;return n&&n[e]&&n[e].type||r}getSubLayerRow(e,r,n){return e.__source={parent:this,object:r,index:n},e}getSubLayerAccessor(e){if(typeof e=="function"){const r={index:-1,data:this.props.data,target:[]};return(n,i)=>n&&n.__source?(r.index=n.__source.index,e(n.__source.object,r)):e(n,i)}return e}getSubLayerProps(e={}){const{opacity:r,pickable:n,visible:i,parameters:a,getPolygonOffset:c,highlightedObjectIndex:s,autoHighlight:g,highlightColor:_,coordinateSystem:v,coordinateOrigin:T,wrapLongitude:M,positionFormat:O,modelMatrix:F,extensions:j,fetch:V,operation:q,_subLayerProps:Y}=this.props,X={id:"",updateTriggers:{},opacity:r,pickable:n,visible:i,parameters:a,getPolygonOffset:c,highlightedObjectIndex:s,autoHighlight:g,highlightColor:_,coordinateSystem:v,coordinateOrigin:T,wrapLongitude:M,positionFormat:O,modelMatrix:F,extensions:j,fetch:V,operation:q},ae=Y&&e.id&&Y[e.id],ue=ae&&ae.updateTriggers,ge=e.id||"sublayer";if(ae){const Le=this.props[Nd],qe=e.type?e.type._propTypes:{};for(const Ze in ae){const _t=qe[Ze]||Le[Ze];_t&&_t.type==="accessor"&&(ae[Ze]=this.getSubLayerAccessor(ae[Ze]))}}Object.assign(X,e,ae),X.id=`${this.props.id}-${ge}`,X.updateTriggers={all:this.props.updateTriggers?.all,...e.updateTriggers,...ue};for(const Le of j){const qe=Le.getSubLayerProps.call(this,Le);qe&&Object.assign(X,qe,{updateTriggers:Object.assign(X.updateTriggers,qe.updateTriggers)})}return X}_updateAutoHighlight(e){for(const r of this.getSubLayers())r.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,r){let n=this.internalState.subLayers;const i=!n||this.needsUpdate();if(i){const a=this.renderLayers();n=vC(a,Boolean),this.internalState.subLayers=n}ka(Cde,this,i,n);for(const a of n)a.parent=this}}MC.layerName="CompositeLayer";class eF{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:r={}}=e;this.typedArrayManager=Ey,this.attributes={},this._attributeDefs=r,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:r,buffers:n={},getGeometry:i,geometryBuffer:a,positionFormat:c,dataChanged:s,normalize:g=!0}=this.opts;if(this.data=r,this.getGeometry=i,this.positionSize=a&&a.size||(c==="XY"?2:3),this.buffers=n,this.normalize=g,a&&(ca(r.startIndices),this.getGeometry=this.getGeometryFromBuffer(a),g||(n.vertexPositions=a)),this.geometryBuffer=n.vertexPositions,Array.isArray(s))for(const _ of s)this._rebuildGeometry(_);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:r}){this._rebuildGeometry({startRow:e,endRow:r})}getGeometryFromBuffer(e){const r=e.value||e;return ArrayBuffer.isView(r)?V5(r,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,r){const{attributes:n,buffers:i,_attributeDefs:a,typedArrayManager:c}=this;for(const s in a)if(s in i)c.release(n[s]),n[s]=null;else{const g=a[s];g.copy=r,n[s]=c.allocate(n[s],e,g)}}_forEachGeometry(e,r,n){const{data:i,getGeometry:a}=this,{iterable:c,objectInfo:s}=gw(i,r,n);for(const g of c){s.index++;const _=a?a(g,s):null;e(_,s.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:r,vertexStarts:n,instanceCount:i}=this;const{data:a,geometryBuffer:c}=this,{startRow:s=0,endRow:g=1/0}=e||{},_={};if(e||(r=[0],n=[0]),this.normalize||!c)this._forEachGeometry((T,M)=>{const O=T&&this.normalizeGeometry(T);_[M]=O,n[M+1]=n[M]+(O?this.getGeometrySize(O):0)},s,g),i=n[n.length-1];else if(n=a.startIndices,i=n[a.length]||0,ArrayBuffer.isView(c))i=i||c.length/this.positionSize;else if(c instanceof Ni){const T=this.positionSize*4;i=i||c.byteLength/T}else if(c.buffer){const T=c.stride||this.positionSize*4;i=i||c.buffer.byteLength/T}else if(c.value){const T=c.value,M=c.stride/T.BYTES_PER_ELEMENT||this.positionSize;i=i||T.length/M}this._allocate(i,!!e),this.indexStarts=r,this.vertexStarts=n,this.instanceCount=i;const v={};this._forEachGeometry((T,M)=>{const O=_[M]||T;v.vertexStart=n[M],v.indexStart=r[M];const F=M<n.length-1?n[M+1]:i;v.geometrySize=F-n[M],v.geometryIndex=M,this.updateGeometryAttributes(O,v)},s,g),this.vertexCount=r[r.length-1]}}const Pde=typeof window<"u"?Q.useLayoutEffect:Q.useEffect;function A1(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const Mde={position:"absolute",zIndex:-1};function tF(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(r=>tF(r,e));if(yw(t)){if(Ide(t))return e.style=Mde,Q.cloneElement(t,e);if(Rde(t))return Q.cloneElement(t,e)}return t}function yw(t){return t&&typeof t=="object"&&"type"in t||!1}function Ide(t){return t.props?.mapStyle}function Rde(t){const e=t.type;return e&&e.deckGLViewProps}function FA(t){if(typeof t=="function")return Q.createElement(Iy,{},t);if(Array.isArray(t))return t.map(FA);if(yw(t)){if(t.type===Q.Fragment)return FA(t.props.children);if(A1(t.type,Iy))return t}return t}function Ode({children:t,layers:e=[],views:r=null}){const n=[],i=[],a={};return Q.Children.forEach(FA(t),c=>{if(yw(c)){const s=c.type;if(A1(s,Pf)){const g=kde(s,c.props);i.push(g)}else n.push(c);if(A1(s,Iy)&&s!==Iy&&c.props.id){const g=new s(c.props);a[g.id]=g}}else c&&n.push(c)}),Object.keys(a).length>0&&(Array.isArray(r)?r.forEach(c=>{a[c.id]=c}):r&&(a[r.id]=r),r=Object.values(a)),e=i.length>0?[...i,...e]:e,{layers:e,children:n,views:r}}function kde(t,e){const r={},n=t.defaultProps||{};for(const i in e)n[i]!==e[i]&&(r[i]=e[i]);return new t(r)}const Dde=Q.createContext();function Lde({children:t,deck:e,ContextProvider:r=Dde.Provider}){const{viewManager:n}=e||{};if(!n||!n.views.length)return[];const i={},a=n.views[0].id;for(const c of t){let s=a,g=c;yw(c)&&A1(c.type,Iy)&&(s=c.props.id||a,g=c.props.children);const _=n.getViewport(s),v=n.getViewState(s);if(_){v.padding=_.padding;const{x:T,y:M,width:O,height:F}=_;g=tF(g,{x:T,y:M,width:O,height:F,viewport:_,viewState:v}),i[s]||(i[s]={viewport:_,children:[]}),i[s].children.push(g)}}return Object.keys(i).map(c=>{const{viewport:s,children:g}=i[c],{x:_,y:v,width:T,height:M}=s,O={position:"absolute",left:_,top:v,width:T,height:M},F=`view-${c}`,j=Q.createElement("div",{key:F,id:F,style:O},...g),V={deck:e,viewport:s,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:Y=>{Y.viewId=c,e._onViewStateChange(Y)},widgets:[]},q=`view-${c}-context`;return Q.createElement(r,{key:q,value:V},j)})}const Bde={mixBlendMode:null};function Nde({width:t,height:e,style:r}){const n={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},i={left:0,top:0};if(r)for(const a in r)a in Bde?i[a]=r[a]:n[a]=r[a];return{containerStyle:n,canvasStyle:i}}function zde(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function rF(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function Fde(t,e,r){const n=new e({...r,_customRender:r.deviceProps?.adapters?.[0]?.type==="webgpu"?void 0:i=>{t.redrawReason=i;const a=n.getViewports();t.lastRenderedViewports!==a?t.forceUpdate():rF(t)}});return n}function Ude(t,e){const[r,n]=Q.useState(0),a=Q.useRef({control:null,version:r,forceUpdate:()=>n(ue=>ue+1)}).current,c=Q.useRef(null),s=Q.useRef(null),g=Q.useMemo(()=>Ode(t),[t.layers,t.views,t.children]);let _=!0;const v=ue=>_&&t.viewState?(a.viewStateUpdateRequested=ue,null):(a.viewStateUpdateRequested=null,t.onViewStateChange?.(ue)),T=ue=>{_?a.interactionStateUpdateRequested=ue:(a.interactionStateUpdateRequested=null,t.onInteractionStateChange?.(ue))},M=Q.useMemo(()=>{const ue={widgets:[],...t,style:null,width:"100%",height:"100%",parent:c.current,canvas:s.current,layers:g.layers,views:g.views,onViewStateChange:v,onInteractionStateChange:T};return delete ue._customRender,a.deck&&a.deck.setProps(ue),ue},[t]);Q.useEffect(()=>{const ue=t.Deck||CC;return a.deck=Fde(a,ue,{...M,parent:c.current,canvas:s.current}),()=>a.deck?.finalize()},[]),Pde(()=>{rF(a);const{viewStateUpdateRequested:ue,interactionStateUpdateRequested:ge}=a;ue&&v(ue),ge&&T(ge),a.deck?.isInitialized&&a.deck.redraw("Initial render")}),Q.useImperativeHandle(e,()=>zde(a),[]);const O=a.deck&&a.deck.isInitialized?a.deck.getViewports():void 0,{ContextProvider:F,width:j="100%",height:V="100%",id:q,style:Y}=t,{containerStyle:X,canvasStyle:ae}=Q.useMemo(()=>Nde({width:j,height:V,style:Y}),[j,V,Y]);if(!a.viewStateUpdateRequested&&a.lastRenderedViewports===O||a.version!==r){a.lastRenderedViewports=O,a.version=r;const ue=Lde({children:g.children,deck:a.deck,ContextProvider:F}),ge=Q.createElement("canvas",{key:"canvas",id:q||"deckgl-overlay",ref:s,style:ae});a.control=Q.createElement("div",{id:`${q||"deckgl"}-wrapper`,ref:c,style:X},[ge,ue])}return _=!1,a.control}const jde=Q.forwardRef(Ude),Gk=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeBasis;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,Vde={name:"icon",vs:Gk,fs:Gk,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeBasis:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},$de=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float iconConstraint = icon.sizeBasis == 0.0 ? iconSize.x : iconSize.y;
float instanceScale = iconConstraint == 0.0 ? 0.0 : sizePixels / iconConstraint;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,Hde=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Wde=1024,qde=4,Xk=()=>{},Zk={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Gde={x:0,y:0,width:0,height:0};function Xde(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function Zde(t,e,r,n){const i=Math.min(r/e.width,n/e.height),a=Math.floor(e.width*i),c=Math.floor(e.height*i);return i===1?{image:e,width:a,height:c}:(t.canvas.height=c,t.canvas.width=a,t.clearRect(0,0,a,c),t.drawImage(e,0,0,e.width,e.height,0,0,a,c),{image:t.canvas,width:a,height:c})}function Qv(t){return t&&(t.id||t.url)}function Yde(t,e,r,n){const{width:i,height:a,device:c}=t,s=c.createTexture({format:"rgba8unorm",width:e,height:r,sampler:n,mipLevels:c.getMipLevelCount(e,r)}),g=c.createCommandEncoder();return g.copyTextureToTexture({sourceTexture:t,destinationTexture:s,width:i,height:a}),g.finish(),s.generateMipmapsWebGL(),t.destroy(),s}function Yk(t,e,r){for(let n=0;n<e.length;n++){const{icon:i,xOffset:a}=e[n],c=Qv(i);t[c]={...i,x:a,y:r}}}function Kde({icons:t,buffer:e,mapping:r={},xOffset:n=0,yOffset:i=0,rowHeight:a=0,canvasWidth:c}){let s=[];for(let g=0;g<t.length;g++){const _=t[g],v=Qv(_);if(!r[v]){const{height:T,width:M}=_;n+M+e>c&&(Yk(r,s,i),n=0,i=a+i+e,a=0,s=[]),s.push({icon:_,xOffset:n}),n=n+M+e,a=Math.max(a,T)}}return s.length>0&&Yk(r,s,i),{mapping:r,rowHeight:a,xOffset:n,yOffset:i,canvasWidth:c,canvasHeight:Xde(a+i+e)}}function Qde(t,e,r){if(!t||!e)return null;r=r||{};const n={},{iterable:i,objectInfo:a}=gw(t);for(const c of i){a.index++;const s=e(c,a),g=Qv(s);if(!s)throw new Error("Icon is missing.");if(!s.url)throw new Error("Icon url is missing.");!n[g]&&(!r[g]||s.url!==r[g].url)&&(n[g]={...s,source:c,sourceIndex:a.index})}return n}class Jde{constructor(e,{onUpdate:r=Xk,onError:n=Xk}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=qde,this._canvasWidth=Wde,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=r,this.onError=n}finalize(){this._texture?.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const r=this._autoPacking?Qv(e):e;return this._mapping[r]||Gde}setProps({loadOptions:e,autoPacking:r,iconAtlas:n,iconMapping:i,textureParameters:a}){e&&(this._loadOptions=e),r!==void 0&&(this._autoPacking=r),i&&(this._mapping=i),n&&(this._texture?.delete(),this._texture=null,this._externalTexture=n),a&&(this._samplerParameters=a)}get isLoaded(){return this._pendingCount===0}packIcons(e,r){if(!this._autoPacking||typeof document>"u")return;const n=Object.values(Qde(e,r,this._mapping)||{});if(n.length>0){const{mapping:i,xOffset:a,yOffset:c,rowHeight:s,canvasHeight:g}=Kde({icons:n,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=s,this._mapping=i,this._xOffset=a,this._yOffset=c,this._canvasHeight=g,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",data:null,width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||Zk,mipLevels:this.device.getMipLevelCount(this._canvasWidth,this._canvasHeight)})),this._texture.height!==this._canvasHeight&&(this._texture=Yde(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||Zk)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(n),this._texture?.generateMipmapsWebGL()}}_loadIcons(e){const r=this._canvas.getContext("2d",{willReadFrequently:!0});for(const n of e)this._pendingCount++,s1(n.url,this._loadOptions).then(i=>{const a=Qv(n),c=this._mapping[a],{x:s,y:g,width:_,height:v}=c,{image:T,width:M,height:O}=Zde(r,i,_,v);this._texture?.copyExternalImage({image:T,x:s+(_-M)/2,y:g+(v-O)/2,width:M,height:O}),c.width=M,c.height=O,this._texture?.generateMipmapsWebGL(),this.onUpdate()}).catch(i=>{this.onError({url:n.url,source:n.source,sourceIndex:n.sourceIndex,loadOptions:this._loadOptions,error:i})}).finally(()=>{this._pendingCount--})}}const nF=[0,0,0,255],epe={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeBasis:"height",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:nF},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class _w extends Pf{getShaders(){return super.getShaders({vs:$de,fs:Hde,modules:[x0,w0,Vde]})}initializeState(){this.state={iconManager:new Jde(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:nF},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:r,oldProps:n,changeFlags:i}=e,a=this.getAttributeManager(),{iconAtlas:c,iconMapping:s,data:g,getIcon:_,textureParameters:v}=r,{iconManager:T}=this.state;if(typeof c=="string")return;const M=c||this.internalState.isAsyncPropLoading("iconAtlas");T.setProps({loadOptions:r.loadOptions,autoPacking:!M,iconAtlas:c,iconMapping:M?s:null,textureParameters:v}),M?n.iconMapping!==r.iconMapping&&a.invalidate("getIcon"):(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getIcon))&&T.packIcons(g,_),i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),a.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:r,sizeBasis:n,sizeMinPixels:i,sizeMaxPixels:a,sizeUnits:c,billboard:s,alphaCutoff:g}=this.props,{iconManager:_}=this.state,v=_.getTexture();if(v){const T=this.state.model,M={iconsTexture:v,iconsTextureDim:[v.width,v.height],sizeUnits:vf[c],sizeScale:r,sizeBasis:n==="height"?1:0,sizeMinPixels:i,sizeMaxPixels:a,billboard:s,alphaCutoff:g};T.shaderInputs.setProps({icon:M}),T.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new ou(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new My({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){const r=this.getCurrentLayer()?.props.onIconError;r?r(e):Kr.error(e.error.message)()}getInstanceOffset(e){const{width:r,height:n,anchorX:i=r/2,anchorY:a=n/2}=this.state.iconManager.getIconMapping(e);return[r/2-i,n/2-a]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:r,y:n,width:i,height:a}=this.state.iconManager.getIconMapping(e);return[r,n,i,a]}}_w.defaultProps=epe;_w.layerName="IconLayer";const Kk=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,tpe={name:"scatterplot",vs:Kk,fs:Kk,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},rpe=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,npe=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,ipe=`// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  // Apply premultiplied alpha as required by transparent canvas
  fragColor = deckgl_premultiplied_alpha(fragColor);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,Qk=[0,0,0,255],spe={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:Qk},getLineColor:{type:"accessor",value:Qk},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class IC extends Pf{getShaders(){return super.getShaders({vs:rpe,fs:npe,source:ipe,modules:[x0,Cae,w0,tpe]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:r,radiusScale:n,radiusMinPixels:i,radiusMaxPixels:a,stroked:c,filled:s,billboard:g,antialiasing:_,lineWidthUnits:v,lineWidthScale:T,lineWidthMinPixels:M,lineWidthMaxPixels:O}=this.props,F={stroked:c,filled:s,billboard:g,antialiasing:_,radiusUnits:vf[r],radiusScale:n,radiusMinPixels:i,radiusMaxPixels:a,lineWidthUnits:vf[v],lineWidthScale:T,lineWidthMinPixels:M,lineWidthMaxPixels:O},j=this.state.model;j.shaderInputs.setProps({scatterplot:F}),this.context.device.type==="webgpu"&&(j.instanceCount=this.props.data.length),j.draw(this.context.renderPass)}_getModel(){const e=this.context.device.type==="webgpu"?{depthWriteEnabled:!0,depthCompare:"less-equal"}:void 0,r=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new ou(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new My({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(r)}}}),isInstanced:!0,parameters:e})}}IC.defaultProps=spe;IC.layerName="ScatterplotLayer";const iF={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function sF(t,e,r={}){return ape(t,r)!==e?(lpe(t,r),!0):!1}function ape(t,e={}){return Math.sign(ope(t,e))}const Jk={x:0,y:1,z:2};function ope(t,e={}){const{start:r=0,end:n=t.length,plane:i="xy"}=e,a=e.size||2;let c=0;const s=Jk[i[0]],g=Jk[i[1]];for(let _=r,v=n-a;_<n;_+=a)c+=(t[_+s]-t[v+s])*(t[_+g]+t[v+g]),v=_;return c/2}function lpe(t,e){const{start:r=0,end:n=t.length,size:i=2}=e,a=(n-r)/i,c=Math.floor(a/2);for(let s=0;s<c;++s){const g=r+s*i,_=r+(a-1-s)*i;for(let v=0;v<i;++v){const T=t[g+v];t[g+v]=t[_+v],t[_+v]=T}}}function au(t,e){const r=e.length,n=t.length;if(n>0){let i=!0;for(let a=0;a<r;a++)if(t[n-r+a]!==e[a]){i=!1;break}if(i)return!1}for(let i=0;i<r;i++)t[n+i]=e[i];return!0}function UA(t,e){const r=e.length;for(let n=0;n<r;n++)t[n]=e[n]}function Jv(t,e,r,n,i=[]){const a=n+e*r;for(let c=0;c<r;c++)i[c]=t[a+c];return i}function jA(t,e,r,n,i=[]){let a,c;if(r&8)a=(n[3]-t[1])/(e[1]-t[1]),c=3;else if(r&4)a=(n[1]-t[1])/(e[1]-t[1]),c=1;else if(r&2)a=(n[2]-t[0])/(e[0]-t[0]),c=2;else if(r&1)a=(n[0]-t[0])/(e[0]-t[0]),c=0;else return null;for(let s=0;s<t.length;s++)i[s]=(c&1)===s?n[c]:a*(e[s]-t[s])+t[s];return i}function mx(t,e){let r=0;return t[0]<e[0]?r|=1:t[0]>e[2]&&(r|=2),t[1]<e[1]?r|=4:t[1]>e[3]&&(r|=8),r}function aF(t,e){const{size:r=2,broken:n=!1,gridResolution:i=10,gridOffset:a=[0,0],startIndex:c=0,endIndex:s=t.length}=e||{},g=(s-c)/r;let _=[];const v=[_],T=Jv(t,0,r,c);let M,O;const F=lF(T,i,a,[]),j=[];au(_,T);for(let V=1;V<g;V++){for(M=Jv(t,V,r,c,M),O=mx(M,F);O;){jA(T,M,O,F,j);const q=mx(j,F);q&&(jA(T,j,q,F,j),O=q),au(_,j),UA(T,j),upe(F,i,O),n&&_.length>r&&(_=[],v.push(_),au(_,T)),O=mx(M,F)}au(_,M),UA(T,M)}return n?v:v[0]}const eD=0,cpe=1;function oF(t,e=null,r){if(!t.length)return[];const{size:n=2,gridResolution:i=10,gridOffset:a=[0,0],edgeTypes:c=!1}=r||{},s=[],g=[{pos:t,types:c?new Array(t.length/n).fill(cpe):null,holes:e||[]}],_=[[],[]];let v=[];for(;g.length;){const{pos:T,types:M,holes:O}=g.shift();hpe(T,n,O[0]||T.length,_),v=lF(_[0],i,a,v);const F=mx(_[1],v);if(F){let j=tD(T,M,n,0,O[0]||T.length,v,F);const V={pos:j[0].pos,types:j[0].types,holes:[]},q={pos:j[1].pos,types:j[1].types,holes:[]};g.push(V,q);for(let Y=0;Y<O.length;Y++)j=tD(T,M,n,O[Y],O[Y+1]||T.length,v,F),j[0]&&(V.holes.push(V.pos.length),V.pos=Jb(V.pos,j[0].pos),c&&(V.types=Jb(V.types,j[0].types))),j[1]&&(q.holes.push(q.pos.length),q.pos=Jb(q.pos,j[1].pos),c&&(q.types=Jb(q.types,j[1].types)))}else{const j={positions:T};c&&(j.edgeTypes=M),O.length&&(j.holeIndices=O),s.push(j)}}return s}function tD(t,e,r,n,i,a,c){const s=(i-n)/r,g=[],_=[],v=[],T=[],M=[];let O,F,j;const V=Jv(t,s-1,r,n);let q=Math.sign(c&8?V[1]-a[3]:V[0]-a[2]),Y=e&&e[s-1],X=0,ae=0;for(let ue=0;ue<s;ue++)O=Jv(t,ue,r,n,O),F=Math.sign(c&8?O[1]-a[3]:O[0]-a[2]),j=e&&e[n/r+ue],F&&q&&q!==F&&(jA(V,O,c,a,M),au(g,M)&&v.push(Y),au(_,M)&&T.push(Y)),F<=0?(au(g,O)&&v.push(j),X-=F):v.length&&(v[v.length-1]=eD),F>=0?(au(_,O)&&T.push(j),ae+=F):T.length&&(T[T.length-1]=eD),UA(V,O),q=F,Y=j;return[X?{pos:g,types:e&&v}:null,ae?{pos:_,types:e&&T}:null]}function lF(t,e,r,n){const i=Math.floor((t[0]-r[0])/e)*e+r[0],a=Math.floor((t[1]-r[1])/e)*e+r[1];return n[0]=i,n[1]=a,n[2]=i+e,n[3]=a+e,n}function upe(t,e,r){r&8?(t[1]+=e,t[3]+=e):r&4?(t[1]-=e,t[3]-=e):r&2?(t[0]+=e,t[2]+=e):r&1&&(t[0]-=e,t[2]-=e)}function hpe(t,e,r,n){let i=1/0,a=-1/0,c=1/0,s=-1/0;for(let g=0;g<r;g+=e){const _=t[g],v=t[g+1];i=_<i?_:i,a=_>a?_:a,c=v<c?v:c,s=v>s?v:s}return n[0][0]=i,n[0][1]=c,n[1][0]=a,n[1][1]=s,n}function Jb(t,e){for(let r=0;r<e.length;r++)t.push(e[r]);return t}const fpe=85.051129;function dpe(t,e){const{size:r=2,startIndex:n=0,endIndex:i=t.length,normalize:a=!0}=e||{},c=t.slice(n,i);cF(c,r,0,i-n);const s=aF(c,{size:r,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(a)for(const g of s)uF(g,r);return s}function ppe(t,e=null,r){const{size:n=2,normalize:i=!0,edgeTypes:a=!1}=r||{};e=e||[];const c=[],s=[];let g=0,_=0;for(let T=0;T<=e.length;T++){const M=e[T]||t.length,O=_,F=gpe(t,n,g,M);for(let j=F;j<M;j++)c[_++]=t[j];for(let j=g;j<F;j++)c[_++]=t[j];cF(c,n,O,_),mpe(c,n,O,_,r?.maxLatitude),g=M,s[T]=_}s.pop();const v=oF(c,s,{size:n,gridResolution:360,gridOffset:[-180,-180],edgeTypes:a});if(i)for(const T of v)uF(T.positions,n);return v}function gpe(t,e,r,n){let i=-1,a=-1;for(let c=r+1;c<n;c+=e){const s=Math.abs(t[c]);s>i&&(i=s,a=c-1)}return a}function mpe(t,e,r,n,i=fpe){const a=t[r],c=t[n-e];if(Math.abs(a-c)>180){const s=Jv(t,0,e,r);s[0]+=Math.round((c-a)/360)*360,au(t,s),s[1]=Math.sign(s[1])*i,au(t,s),s[0]=a,au(t,s)}}function cF(t,e,r,n){let i=t[0],a;for(let c=r;c<n;c+=e){a=t[c];const s=a-i;(s>180||s<-180)&&(a-=Math.round(s/360)*360),t[c]=i=a}}function uF(t,e){let r;const n=t.length/e;for(let a=0;a<n&&(r=t[a*e],(r+180)%360===0);a++);const i=-Math.round(r/360)*360;if(i!==0)for(let a=0;a<n;a++)t[a*e]+=i}function ype(t,e,r,n){let i;if(Array.isArray(t[0])){const a=t.length*e;i=new Array(a);for(let c=0;c<t.length;c++)for(let s=0;s<e;s++)i[c*e+s]=t[c][s]||0}else i=t;return r?aF(i,{size:e,gridResolution:r}):n?dpe(i,{size:e}):i}const _pe=1,vpe=2,iS=4;class bpe extends eF{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?ype(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(rD(e)){let n=0;for(const i of e)n+=this.getGeometrySize(i);return n}const r=this.getPathLength(e);return r<2?0:this.isClosed(e)?r<3?0:r+2:r}updateGeometryAttributes(e,r){if(r.geometrySize!==0)if(e&&rD(e))for(const n of e){const i=this.getGeometrySize(n);r.geometrySize=i,this.updateGeometryAttributes(n,r),r.vertexStart+=i}else this._updateSegmentTypes(e,r),this._updatePositions(e,r)}_updateSegmentTypes(e,r){const n=this.attributes.segmentTypes,i=e?this.isClosed(e):!1,{vertexStart:a,geometrySize:c}=r;n.fill(0,a,a+c),i?(n[a]=iS,n[a+c-2]=iS):(n[a]+=_pe,n[a+c-2]+=vpe),n[a+c-1]=iS}_updatePositions(e,r){const{positions:n}=this.attributes;if(!n||!e)return;const{vertexStart:i,geometrySize:a}=r,c=new Array(3);for(let s=i,g=0;g<a;s++,g++)this.getPointOnPath(e,g,c),n[s*3]=c[0],n[s*3+1]=c[1],n[s*3+2]=c[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,r,n=[]){const{positionSize:i}=this;r*i>=e.length&&(r+=1-e.length/i);const a=r*i;return n[0]=e[a],n[1]=e[a+1],n[2]=i===3&&e[a+2]||0,n}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:r}=this,n=e.length-r;return e[0]===e[n]&&e[1]===e[n+1]&&(r===2||e[2]===e[n+2])}}function rD(t){return Array.isArray(t[0])}const nD=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,xpe={name:"path",vs:nD,fs:nD,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},wpe=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Tpe=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,hF=[0,0,0,255],Spe={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:hF},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},sS={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class RC extends Pf{getShaders(){return super.getShaders({vs:wpe,fs:Tpe,modules:[x0,w0,xpe]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:sS,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:sS,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:sS,defaultValue:hF},instancePickingColors:{size:4,type:"uint8",accessor:(n,{index:i,target:a})=>this.encodePickingColor(n&&n.__source?n.__source.index:i,a)}}),this.setState({pathTesselator:new bpe({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:r,changeFlags:n}=e,i=this.getAttributeManager();if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPath)){const{pathTesselator:c}=this.state,s=r.data.attributes||{};c.updateGeometry({data:r.data,geometryBuffer:s.getPath,buffers:s,normalize:!r._pathType,loop:r._pathType==="loop",getGeometry:r.getPath,positionFormat:r.positionFormat,wrapLongitude:r.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:n.dataChanged}),this.setState({numInstances:c.instanceCount,startIndices:c.vertexStarts}),n.dataChanged||i.invalidateAll()}n.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),i.invalidateAll())}getPickingInfo(e){const r=super.getPickingInfo(e),{index:n}=r,i=this.props.data;return i[0]&&i[0].__source&&(r.object=i.find(a=>a.__source.index===n)),r}disablePickingIndex(e){const r=this.props.data;if(r[0]&&r[0].__source)for(let n=0;n<r.length;n++)r[n].__source.index===e&&this._disablePickingIndex(n);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:r,capRounded:n,billboard:i,miterLimit:a,widthUnits:c,widthScale:s,widthMinPixels:g,widthMaxPixels:_}=this.props,v=this.state.model,T={jointType:Number(r),capType:Number(n),billboard:i,widthUnits:vf[c],widthScale:s,miterLimit:a,widthMinPixels:g,widthMaxPixels:_};v.shaderInputs.setProps({path:T}),v.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],r=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new ou(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new My({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(r),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:r}=this.state;e.startIndices=r.vertexStarts,e.value=r.get("positions")}calculateSegmentTypes(e){const{pathTesselator:r}=this.state;e.startIndices=r.vertexStarts,e.value=r.get("segmentTypes")}}RC.defaultProps=Spe;RC.layerName="PathLayer";var ex={exports:{}},iD;function Ape(){if(iD)return ex.exports;iD=1,ex.exports=t,ex.exports.default=t;function t(ce,we,Re){Re=Re||2;var Ue=we&&we.length,at=Ue?we[0]*Re:ce.length,pe=e(ce,0,at,Re,!0),Pe=[];if(!pe||pe.next===pe.prev)return Pe;var rt,vt,At,$t,Gt,nr,Et;if(Ue&&(pe=g(ce,we,pe,Re)),ce.length>80*Re){rt=At=ce[0],vt=$t=ce[1];for(var Wt=Re;Wt<at;Wt+=Re)Gt=ce[Wt],nr=ce[Wt+1],Gt<rt&&(rt=Gt),nr<vt&&(vt=nr),Gt>At&&(At=Gt),nr>$t&&($t=nr);Et=Math.max(At-rt,$t-vt),Et=Et!==0?32767/Et:0}return n(pe,Pe,Re,rt,vt,Et,0),Pe}function e(ce,we,Re,Ue,at){var pe,Pe;if(at===Yt(ce,we,Re,Ue)>0)for(pe=we;pe<Re;pe+=Ue)Pe=gt(pe,ce[pe],ce[pe+1],Pe);else for(pe=Re-Ue;pe>=we;pe-=Ue)Pe=gt(pe,ce[pe],ce[pe+1],Pe);return Pe&&ae(Pe,Pe.next)&&(Lt(Pe),Pe=Pe.next),Pe}function r(ce,we){if(!ce)return ce;we||(we=ce);var Re=ce,Ue;do if(Ue=!1,!Re.steiner&&(ae(Re,Re.next)||X(Re.prev,Re,Re.next)===0)){if(Lt(Re),Re=we=Re.prev,Re===Re.next)break;Ue=!0}else Re=Re.next;while(Ue||Re!==we);return we}function n(ce,we,Re,Ue,at,pe,Pe){if(ce){!Pe&&pe&&O(ce,Ue,at,pe);for(var rt=ce,vt,At;ce.prev!==ce.next;){if(vt=ce.prev,At=ce.next,pe?a(ce,Ue,at,pe):i(ce)){we.push(vt.i/Re|0),we.push(ce.i/Re|0),we.push(At.i/Re|0),Lt(ce),ce=At.next,rt=At.next;continue}if(ce=At,ce===rt){Pe?Pe===1?(ce=c(r(ce),we,Re),n(ce,we,Re,Ue,at,pe,2)):Pe===2&&s(ce,we,Re,Ue,at,pe):n(r(ce),we,Re,Ue,at,pe,1);break}}}}function i(ce){var we=ce.prev,Re=ce,Ue=ce.next;if(X(we,Re,Ue)>=0)return!1;for(var at=we.x,pe=Re.x,Pe=Ue.x,rt=we.y,vt=Re.y,At=Ue.y,$t=at<pe?at<Pe?at:Pe:pe<Pe?pe:Pe,Gt=rt<vt?rt<At?rt:At:vt<At?vt:At,nr=at>pe?at>Pe?at:Pe:pe>Pe?pe:Pe,Et=rt>vt?rt>At?rt:At:vt>At?vt:At,Wt=Ue.next;Wt!==we;){if(Wt.x>=$t&&Wt.x<=nr&&Wt.y>=Gt&&Wt.y<=Et&&q(at,rt,pe,vt,Pe,At,Wt.x,Wt.y)&&X(Wt.prev,Wt,Wt.next)>=0)return!1;Wt=Wt.next}return!0}function a(ce,we,Re,Ue){var at=ce.prev,pe=ce,Pe=ce.next;if(X(at,pe,Pe)>=0)return!1;for(var rt=at.x,vt=pe.x,At=Pe.x,$t=at.y,Gt=pe.y,nr=Pe.y,Et=rt<vt?rt<At?rt:At:vt<At?vt:At,Wt=$t<Gt?$t<nr?$t:nr:Gt<nr?Gt:nr,mr=rt>vt?rt>At?rt:At:vt>At?vt:At,Mt=$t>Gt?$t>nr?$t:nr:Gt>nr?Gt:nr,Cr=j(Et,Wt,we,Re,Ue),cr=j(mr,Mt,we,Re,Ue),or=ce.prevZ,ur=ce.nextZ;or&&or.z>=Cr&&ur&&ur.z<=cr;){if(or.x>=Et&&or.x<=mr&&or.y>=Wt&&or.y<=Mt&&or!==at&&or!==Pe&&q(rt,$t,vt,Gt,At,nr,or.x,or.y)&&X(or.prev,or,or.next)>=0||(or=or.prevZ,ur.x>=Et&&ur.x<=mr&&ur.y>=Wt&&ur.y<=Mt&&ur!==at&&ur!==Pe&&q(rt,$t,vt,Gt,At,nr,ur.x,ur.y)&&X(ur.prev,ur,ur.next)>=0))return!1;ur=ur.nextZ}for(;or&&or.z>=Cr;){if(or.x>=Et&&or.x<=mr&&or.y>=Wt&&or.y<=Mt&&or!==at&&or!==Pe&&q(rt,$t,vt,Gt,At,nr,or.x,or.y)&&X(or.prev,or,or.next)>=0)return!1;or=or.prevZ}for(;ur&&ur.z<=cr;){if(ur.x>=Et&&ur.x<=mr&&ur.y>=Wt&&ur.y<=Mt&&ur!==at&&ur!==Pe&&q(rt,$t,vt,Gt,At,nr,ur.x,ur.y)&&X(ur.prev,ur,ur.next)>=0)return!1;ur=ur.nextZ}return!0}function c(ce,we,Re){var Ue=ce;do{var at=Ue.prev,pe=Ue.next.next;!ae(at,pe)&&ue(at,Ue,Ue.next,pe)&&Ze(at,pe)&&Ze(pe,at)&&(we.push(at.i/Re|0),we.push(Ue.i/Re|0),we.push(pe.i/Re|0),Lt(Ue),Lt(Ue.next),Ue=ce=pe),Ue=Ue.next}while(Ue!==ce);return r(Ue)}function s(ce,we,Re,Ue,at,pe){var Pe=ce;do{for(var rt=Pe.next.next;rt!==Pe.prev;){if(Pe.i!==rt.i&&Y(Pe,rt)){var vt=it(Pe,rt);Pe=r(Pe,Pe.next),vt=r(vt,vt.next),n(Pe,we,Re,Ue,at,pe,0),n(vt,we,Re,Ue,at,pe,0);return}rt=rt.next}Pe=Pe.next}while(Pe!==ce)}function g(ce,we,Re,Ue){var at=[],pe,Pe,rt,vt,At;for(pe=0,Pe=we.length;pe<Pe;pe++)rt=we[pe]*Ue,vt=pe<Pe-1?we[pe+1]*Ue:ce.length,At=e(ce,rt,vt,Ue,!1),At===At.next&&(At.steiner=!0),at.push(V(At));for(at.sort(_),pe=0;pe<at.length;pe++)Re=v(at[pe],Re);return Re}function _(ce,we){return ce.x-we.x}function v(ce,we){var Re=T(ce,we);if(!Re)return we;var Ue=it(Re,ce);return r(Ue,Ue.next),r(Re,Re.next)}function T(ce,we){var Re=we,Ue=ce.x,at=ce.y,pe=-1/0,Pe;do{if(at<=Re.y&&at>=Re.next.y&&Re.next.y!==Re.y){var rt=Re.x+(at-Re.y)*(Re.next.x-Re.x)/(Re.next.y-Re.y);if(rt<=Ue&&rt>pe&&(pe=rt,Pe=Re.x<Re.next.x?Re:Re.next,rt===Ue))return Pe}Re=Re.next}while(Re!==we);if(!Pe)return null;var vt=Pe,At=Pe.x,$t=Pe.y,Gt=1/0,nr;Re=Pe;do Ue>=Re.x&&Re.x>=At&&Ue!==Re.x&&q(at<$t?Ue:pe,at,At,$t,at<$t?pe:Ue,at,Re.x,Re.y)&&(nr=Math.abs(at-Re.y)/(Ue-Re.x),Ze(Re,ce)&&(nr<Gt||nr===Gt&&(Re.x>Pe.x||Re.x===Pe.x&&M(Pe,Re)))&&(Pe=Re,Gt=nr)),Re=Re.next;while(Re!==vt);return Pe}function M(ce,we){return X(ce.prev,ce,we.prev)<0&&X(we.next,ce,ce.next)<0}function O(ce,we,Re,Ue){var at=ce;do at.z===0&&(at.z=j(at.x,at.y,we,Re,Ue)),at.prevZ=at.prev,at.nextZ=at.next,at=at.next;while(at!==ce);at.prevZ.nextZ=null,at.prevZ=null,F(at)}function F(ce){var we,Re,Ue,at,pe,Pe,rt,vt,At=1;do{for(Re=ce,ce=null,pe=null,Pe=0;Re;){for(Pe++,Ue=Re,rt=0,we=0;we<At&&(rt++,Ue=Ue.nextZ,!!Ue);we++);for(vt=At;rt>0||vt>0&&Ue;)rt!==0&&(vt===0||!Ue||Re.z<=Ue.z)?(at=Re,Re=Re.nextZ,rt--):(at=Ue,Ue=Ue.nextZ,vt--),pe?pe.nextZ=at:ce=at,at.prevZ=pe,pe=at;Re=Ue}pe.nextZ=null,At*=2}while(Pe>1);return ce}function j(ce,we,Re,Ue,at){return ce=(ce-Re)*at|0,we=(we-Ue)*at|0,ce=(ce|ce<<8)&16711935,ce=(ce|ce<<4)&252645135,ce=(ce|ce<<2)&858993459,ce=(ce|ce<<1)&1431655765,we=(we|we<<8)&16711935,we=(we|we<<4)&252645135,we=(we|we<<2)&858993459,we=(we|we<<1)&1431655765,ce|we<<1}function V(ce){var we=ce,Re=ce;do(we.x<Re.x||we.x===Re.x&&we.y<Re.y)&&(Re=we),we=we.next;while(we!==ce);return Re}function q(ce,we,Re,Ue,at,pe,Pe,rt){return(at-Pe)*(we-rt)>=(ce-Pe)*(pe-rt)&&(ce-Pe)*(Ue-rt)>=(Re-Pe)*(we-rt)&&(Re-Pe)*(pe-rt)>=(at-Pe)*(Ue-rt)}function Y(ce,we){return ce.next.i!==we.i&&ce.prev.i!==we.i&&!qe(ce,we)&&(Ze(ce,we)&&Ze(we,ce)&&_t(ce,we)&&(X(ce.prev,ce,we.prev)||X(ce,we.prev,we))||ae(ce,we)&&X(ce.prev,ce,ce.next)>0&&X(we.prev,we,we.next)>0)}function X(ce,we,Re){return(we.y-ce.y)*(Re.x-we.x)-(we.x-ce.x)*(Re.y-we.y)}function ae(ce,we){return ce.x===we.x&&ce.y===we.y}function ue(ce,we,Re,Ue){var at=Le(X(ce,we,Re)),pe=Le(X(ce,we,Ue)),Pe=Le(X(Re,Ue,ce)),rt=Le(X(Re,Ue,we));return!!(at!==pe&&Pe!==rt||at===0&&ge(ce,Re,we)||pe===0&&ge(ce,Ue,we)||Pe===0&&ge(Re,ce,Ue)||rt===0&&ge(Re,we,Ue))}function ge(ce,we,Re){return we.x<=Math.max(ce.x,Re.x)&&we.x>=Math.min(ce.x,Re.x)&&we.y<=Math.max(ce.y,Re.y)&&we.y>=Math.min(ce.y,Re.y)}function Le(ce){return ce>0?1:ce<0?-1:0}function qe(ce,we){var Re=ce;do{if(Re.i!==ce.i&&Re.next.i!==ce.i&&Re.i!==we.i&&Re.next.i!==we.i&&ue(Re,Re.next,ce,we))return!0;Re=Re.next}while(Re!==ce);return!1}function Ze(ce,we){return X(ce.prev,ce,ce.next)<0?X(ce,we,ce.next)>=0&&X(ce,ce.prev,we)>=0:X(ce,we,ce.prev)<0||X(ce,ce.next,we)<0}function _t(ce,we){var Re=ce,Ue=!1,at=(ce.x+we.x)/2,pe=(ce.y+we.y)/2;do Re.y>pe!=Re.next.y>pe&&Re.next.y!==Re.y&&at<(Re.next.x-Re.x)*(pe-Re.y)/(Re.next.y-Re.y)+Re.x&&(Ue=!Ue),Re=Re.next;while(Re!==ce);return Ue}function it(ce,we){var Re=new Ot(ce.i,ce.x,ce.y),Ue=new Ot(we.i,we.x,we.y),at=ce.next,pe=we.prev;return ce.next=we,we.prev=ce,Re.next=at,at.prev=Re,Ue.next=Re,Re.prev=Ue,pe.next=Ue,Ue.prev=pe,Ue}function gt(ce,we,Re,Ue){var at=new Ot(ce,we,Re);return Ue?(at.next=Ue.next,at.prev=Ue,Ue.next.prev=at,Ue.next=at):(at.prev=at,at.next=at),at}function Lt(ce){ce.next.prev=ce.prev,ce.prev.next=ce.next,ce.prevZ&&(ce.prevZ.nextZ=ce.nextZ),ce.nextZ&&(ce.nextZ.prevZ=ce.prevZ)}function Ot(ce,we,Re){this.i=ce,this.x=we,this.y=Re,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}t.deviation=function(ce,we,Re,Ue){var at=we&&we.length,pe=at?we[0]*Re:ce.length,Pe=Math.abs(Yt(ce,0,pe,Re));if(at)for(var rt=0,vt=we.length;rt<vt;rt++){var At=we[rt]*Re,$t=rt<vt-1?we[rt+1]*Re:ce.length;Pe-=Math.abs(Yt(ce,At,$t,Re))}var Gt=0;for(rt=0;rt<Ue.length;rt+=3){var nr=Ue[rt]*Re,Et=Ue[rt+1]*Re,Wt=Ue[rt+2]*Re;Gt+=Math.abs((ce[nr]-ce[Wt])*(ce[Et+1]-ce[nr+1])-(ce[nr]-ce[Et])*(ce[Wt+1]-ce[nr+1]))}return Pe===0&&Gt===0?0:Math.abs((Gt-Pe)/Pe)};function Yt(ce,we,Re,Ue){for(var at=0,pe=we,Pe=Re-Ue;pe<Re;pe+=Ue)at+=(ce[Pe]-ce[pe])*(ce[pe+1]+ce[Pe+1]),Pe=pe;return at}return t.flatten=function(ce){for(var we=ce[0][0].length,Re={vertices:[],holes:[],dimensions:we},Ue=0,at=0;at<ce.length;at++){for(var pe=0;pe<ce[at].length;pe++)for(var Pe=0;Pe<we;Pe++)Re.vertices.push(ce[at][pe][Pe]);at>0&&(Ue+=ce[at-1].length,Re.holes.push(Ue))}return Re},ex.exports}var Epe=Ape();const Cpe=xl(Epe),tx=iF.CLOCKWISE,sD=iF.COUNTER_CLOCKWISE,Dd={};function Ppe(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function bv(t){return"positions"in t?t.positions:t}function yx(t){return"holeIndices"in t?t.holeIndices:null}function Mpe(t){return Array.isArray(t[0])}function Ipe(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function Rpe(t){const e=t[0],r=t[t.length-1];return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]}function Ope(t,e,r,n){for(let i=0;i<e;i++)if(t[r+i]!==t[n-e+i])return!1;return!0}function aD(t,e,r,n,i){let a=e;const c=r.length;for(let s=0;s<c;s++)for(let g=0;g<n;g++)t[a++]=r[s][g]||0;if(!Rpe(r))for(let s=0;s<n;s++)t[a++]=r[0][s]||0;return Dd.start=e,Dd.end=a,Dd.size=n,sF(t,i,Dd),a}function oD(t,e,r,n,i=0,a,c){a=a||r.length;const s=a-i;if(s<=0)return e;let g=e;for(let _=0;_<s;_++)t[g++]=r[i+_];if(!Ope(r,n,i,a))for(let _=0;_<n;_++)t[g++]=r[i+_];return Dd.start=e,Dd.end=g,Dd.size=n,sF(t,c,Dd),g}function kpe(t,e){Ppe(t);const r=[],n=[];if("positions"in t){const{positions:i,holeIndices:a}=t;if(a){let c=0;for(let s=0;s<=a.length;s++)c=oD(r,c,i,e,a[s-1],a[s],s===0?tx:sD),n.push(c);return n.pop(),{positions:r,holeIndices:n}}t=i}if(!Mpe(t))return oD(r,0,t,e,0,r.length,tx),r;if(!Ipe(t)){let i=0;for(const[a,c]of t.entries())i=aD(r,i,c,e,a===0?tx:sD),n.push(i);return n.pop(),{positions:r,holeIndices:n}}return aD(r,0,t,e,tx),r}function aS(t,e,r){const n=t.length/3;let i=0;for(let a=0;a<n;a++){const c=(a+1)%n;i+=t[a*3+e]*t[c*3+r],i-=t[c*3+e]*t[a*3+r]}return Math.abs(i/2)}function lD(t,e,r,n){const i=t.length/3;for(let a=0;a<i;a++){const c=a*3,s=t[c+0],g=t[c+1],_=t[c+2];t[c+e]=s,t[c+r]=g,t[c+n]=_}}function Dpe(t,e,r,n){let i=yx(t);i&&(i=i.map(s=>s/e));let a=bv(t);const c=n&&e===3;if(r){const s=a.length;a=a.slice();const g=[];for(let _=0;_<s;_+=e){g[0]=a[_],g[1]=a[_+1],c&&(g[2]=a[_+2]);const v=r(g);a[_]=v[0],a[_+1]=v[1],c&&(a[_+2]=v[2])}}if(c){const s=aS(a,0,1),g=aS(a,0,2),_=aS(a,1,2);if(!s&&!g&&!_)return[];s>g&&s>_||(g>_?(r||(a=a.slice()),lD(a,0,2,1)):(r||(a=a.slice()),lD(a,2,0,1)))}return Cpe(a,i,e)}class Lpe extends eF{constructor(e){const{fp64:r,IndexType:n=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:r?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:n,size:1}}})}get(e){const{attributes:r}=this;return e==="indices"?r.indices&&r.indices.subarray(0,this.vertexCount):r[e]}updateGeometry(e){super.updateGeometry(e);const r=this.buffers.indices;if(r)this.vertexCount=(r.value||r).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const r=kpe(e,this.positionSize);return this.opts.resolution?oF(bv(r),yx(r),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?ppe(bv(r),yx(r),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):r}return e}getGeometrySize(e){if(cD(e)){let r=0;for(const n of e)r+=this.getGeometrySize(n);return r}return bv(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,r){if(e&&cD(e))for(const n of e){const i=this.getGeometrySize(n);r.geometrySize=i,this.updateGeometryAttributes(n,r),r.vertexStart+=i,r.indexStart=this.indexStarts[r.geometryIndex+1]}else{const n=e;this._updateIndices(n,r),this._updatePositions(n,r),this._updateVertexValid(n,r)}}_updateIndices(e,{geometryIndex:r,vertexStart:n,indexStart:i}){const{attributes:a,indexStarts:c,typedArrayManager:s}=this;let g=a.indices;if(!g||!e)return;let _=i;const v=Dpe(e,this.positionSize,this.opts.preproject,this.opts.full3d);g=s.allocate(g,i+v.length,{copy:!0});for(let T=0;T<v.length;T++)g[_++]=v[T]+n;c[r+1]=i+v.length,a.indices=g}_updatePositions(e,{vertexStart:r,geometrySize:n}){const{attributes:{positions:i},positionSize:a}=this;if(!i||!e)return;const c=bv(e);for(let s=r,g=0;g<n;s++,g++){const _=c[g*a],v=c[g*a+1],T=a>2?c[g*a+2]:0;i[s*3]=_,i[s*3+1]=v,i[s*3+2]=T}}_updateVertexValid(e,{vertexStart:r,geometrySize:n}){const{positionSize:i}=this,a=this.attributes.vertexValid,c=e&&yx(e);if(e&&e.edgeTypes?a.set(e.edgeTypes,r):a.fill(1,r,r+n),c)for(let s=0;s<c.length;s++)a[r+c[s]/i-1]=0;a[r+n-1]=0}}function cD(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const uD=`uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,Bpe={name:"solidPolygon",vs:uD,fs:uD,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},fF=`in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Npe=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${fF}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,zpe=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${fF}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,Fpe=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,E1=[0,0,0,255],Upe={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:E1},getLineColor:{type:"accessor",value:E1},material:!0},rx={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class OC extends Pf{getShaders(e){return super.getShaders({vs:e==="top"?Npe:zpe,fs:Fpe,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[x0,r5,w0,Bpe]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:r}=this.props;const{_full3d:n}=this.props;e.isGeospatial&&r===cn.DEFAULT&&(r=cn.LNGLAT);let i;r===cn.LNGLAT&&(n?i=e.projectPosition.bind(e):i=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new Lpe({preproject:i,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const a=this.getAttributeManager(),c=!0;a.remove(["instancePickingColors"]),a.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:c},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:rx,accessor:"getPolygon",update:this.calculatePositions,noAlloc:c,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:c},elevations:{size:1,stepMode:"dynamic",transition:rx,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:rx,accessor:"getFillColor",defaultValue:E1},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:rx,accessor:"getLineColor",defaultValue:E1},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(s,{index:g,target:_})=>this.encodePickingColor(s&&s.__source?s.__source.index:g,_)}})}getPickingInfo(e){const r=super.getPickingInfo(e),{index:n}=r,i=this.props.data;return i[0]&&i[0].__source&&(r.object=i.find(a=>a.__source.index===n)),r}disablePickingIndex(e){const r=this.props.data;if(r[0]&&r[0].__source)for(let n=0;n<r.length;n++)r[n].__source.index===e&&this._disablePickingIndex(n);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:r,filled:n,wireframe:i,elevationScale:a}=this.props,{topModel:c,sideModel:s,wireframeModel:g,polygonTesselator:_}=this.state,v={extruded:!!r,elevationScale:a,isWireframe:!1};g&&i&&(g.setInstanceCount(_.instanceCount-1),g.shaderInputs.setProps({solidPolygon:{...v,isWireframe:!0}}),g.draw(this.context.renderPass)),s&&n&&(s.setInstanceCount(_.instanceCount-1),s.shaderInputs.setProps({solidPolygon:v}),s.draw(this.context.renderPass)),c&&n&&(c.setVertexCount(_.vertexCount),c.shaderInputs.setProps({solidPolygon:v}),c.draw(this.context.renderPass))}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:r,oldProps:n,changeFlags:i}=e,a=this.getAttributeManager();(i.extensionsChanged||r.filled!==n.filled||r.extruded!==n.extruded)&&(this.state.models?.forEach(s=>s.destroy()),this.setState(this._getModels()),a.invalidateAll())}updateGeometry({props:e,oldProps:r,changeFlags:n}){if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon)){const{polygonTesselator:a}=this.state,c=e.data.attributes||{};a.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:c.getPolygon,buffers:c,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:n.dataChanged,full3d:e._full3d}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),n.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:r,extruded:n}=this.props;let i,a,c;if(r){const s=this.getShaders("top");s.defines.NON_INSTANCED_MODEL=1;const g=this.getAttributeManager().getBufferLayouts({isInstanced:!1});i=new ou(this.context.device,{...s,id:`${e}-top`,topology:"triangle-list",bufferLayout:g,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(n){const s=this.getAttributeManager().getBufferLayouts({isInstanced:!0});a=new ou(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:s,geometry:new My({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),c=new ou(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:s,geometry:new My({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[a,c,i].filter(Boolean),topModel:i,sideModel:a,wireframeModel:c}}calculateIndices(e){const{polygonTesselator:r}=this.state;e.startIndices=r.indexStarts,e.value=r.get("indices")}calculatePositions(e){const{polygonTesselator:r}=this.state;e.startIndices=r.vertexStarts,e.value=r.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}OC.defaultProps=Upe;OC.layerName="SolidPolygonLayer";function jpe({data:t,getIndex:e,dataRange:r,replace:n}){const{startRow:i=0,endRow:a=1/0}=r,c=t.length;let s=c,g=c;for(let M=0;M<c;M++){const O=e(t[M]);if(s>M&&O>=i&&(s=M),O>=a){g=M;break}}let _=s;const T=g-s!==n.length?t.slice(g):void 0;for(let M=0;M<n.length;M++)t[_++]=n[M];if(T){for(let M=0;M<T.length;M++)t[_++]=T[M];t.length=_}return{startRow:s,endRow:s+n.length}}function Vpe(t,e){if(!t)return null;const r="startIndices"in t?t.startIndices[e]:e,n=t.featureIds.value[r];return r!==-1?$pe(t,n,r):null}function $pe(t,e,r){const n={properties:{...t.properties[e]}};for(const i in t.numericProps)n.properties[i]=t.numericProps[i].value[r];return n}function Hpe(t,e){const r={points:null,lines:null,polygons:null};for(const n in r){const i=t[n].globalFeatureIds.value;r[n]=new Uint8ClampedArray(i.length*4);const a=[];for(let c=0;c<i.length;c++)e(i[c],a),r[n][c*4+0]=a[0],r[n][c*4+1]=a[1],r[n][c*4+2]=a[2],r[n][c*4+3]=255}return r}const hD=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,Wpe={name:"sdf",vs:hD,fs:hD,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},qpe=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,oS=192/256,fD=[],Gpe={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class kC extends _w{getShaders(){const e=super.getShaders();return{...e,modules:[...e.modules,Wpe],fs:qpe}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(r,{index:n,target:i})=>this.encodePickingColor(n,i)}})}updateState(e){super.updateState(e);const{props:r,oldProps:n}=e;let{outlineColor:i}=r;i!==n.outlineColor&&(i=i.map(a=>a/255),i[3]=Number.isFinite(i[3])?i[3]:1,this.setState({outlineColor:i})),!r.sdf&&r.outlineWidth&&Kr.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:r,smoothing:n,outlineWidth:i}=this.props,{outlineColor:a}=this.state,c=i?Math.max(n,oS*(1-i)):-1,s=this.state.model,g={buffer:oS,outlineBuffer:c,gamma:n,enabled:!!r,outlineColor:a};if(s.shaderInputs.setProps({sdf:g}),super.draw(e),r&&i){const{iconManager:_}=this.state;_.getTexture()&&(s.shaderInputs.setProps({sdf:{...g,outlineBuffer:oS}}),s.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(r=>super.getInstanceOffset(r)):fD}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(r=>super.getInstanceIconFrame(r)):fD}}kC.defaultProps=Gpe;kC.layerName="MultiIconLayer";const Lv=1e20;class Xpe{constructor({fontSize:e=24,buffer:r=3,radius:n=8,cutoff:i=.25,fontFamily:a="sans-serif",fontWeight:c="normal",fontStyle:s="normal",lang:g=null}={}){this.buffer=r,this.cutoff=i,this.radius=n,this.lang=g;const _=this.size=e+r*4,v=this._createCanvas(_),T=this.ctx=v.getContext("2d",{willReadFrequently:!0});T.font=`${s} ${c} ${e}px ${a}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(_*_),this.gridInner=new Float64Array(_*_),this.f=new Float64Array(_),this.z=new Float64Array(_+1),this.v=new Uint16Array(_)}_createCanvas(e){const r=document.createElement("canvas");return r.width=r.height=e,r}draw(e){const{width:r,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:a,actualBoundingBoxRight:c}=this.ctx.measureText(e),s=Math.ceil(n),g=0,_=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(c-a))),v=Math.min(this.size-this.buffer,s+Math.ceil(i)),T=_+2*this.buffer,M=v+2*this.buffer,O=Math.max(T*M,0),F=new Uint8ClampedArray(O),j={data:F,width:T,height:M,glyphWidth:_,glyphHeight:v,glyphTop:s,glyphLeft:g,glyphAdvance:r};if(_===0||v===0)return j;const{ctx:V,buffer:q,gridInner:Y,gridOuter:X}=this;this.lang&&(V.lang=this.lang),V.clearRect(q,q,_,v),V.fillText(e,q,q+s);const ae=V.getImageData(q,q,_,v);X.fill(Lv,0,O),Y.fill(0,0,O);for(let ue=0;ue<v;ue++)for(let ge=0;ge<_;ge++){const Le=ae.data[4*(ue*_+ge)+3]/255;if(Le===0)continue;const qe=(ue+q)*T+ge+q;if(Le===1)X[qe]=0,Y[qe]=Lv;else{const Ze=.5-Le;X[qe]=Ze>0?Ze*Ze:0,Y[qe]=Ze<0?Ze*Ze:0}}dD(X,0,0,T,M,T,this.f,this.v,this.z),dD(Y,q,q,_,v,T,this.f,this.v,this.z);for(let ue=0;ue<O;ue++){const ge=Math.sqrt(X[ue])-Math.sqrt(Y[ue]);F[ue]=Math.round(255-255*(ge/this.radius+this.cutoff))}return j}}function dD(t,e,r,n,i,a,c,s,g){for(let _=e;_<e+n;_++)pD(t,r*a+_,a,i,c,s,g);for(let _=r;_<r+i;_++)pD(t,_*a+e,1,n,c,s,g)}function pD(t,e,r,n,i,a,c){a[0]=0,c[0]=-Lv,c[1]=Lv,i[0]=t[e];for(let s=1,g=0,_=0;s<n;s++){i[s]=t[e+s*r];const v=s*s;do{const T=a[g];_=(i[s]-i[T]+v-T*T)/(s-T)/2}while(_<=c[g]&&--g>-1);g++,a[g]=s,c[g]=_,c[g+1]=Lv}for(let s=0,g=0;s<n;s++){for(;c[g+1]<s;)g++;const _=a[g],v=s-_;t[e+s*r]=i[_]+v*v}}const Zpe=32,Ype=[];function Kpe(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function Qpe({characterSet:t,getFontWidth:e,fontHeight:r,buffer:n,maxCanvasWidth:i,mapping:a={},xOffset:c=0,yOffset:s=0}){let g=0,_=c;const v=r+n*2;for(const T of t)if(!a[T]){const M=e(T);_+M+n*2>i&&(_=0,g++),a[T]={x:_+n,y:s+g*v+n,width:M,height:v,layoutWidth:M,layoutHeight:r},_+=M+n*2}return{mapping:a,xOffset:_,yOffset:s+g*v,canvasHeight:Kpe(s+(g+1)*v)}}function dF(t,e,r,n){let i=0;for(let a=e;a<r;a++){const c=t[a];i+=n[c]?.layoutWidth||0}return i}function pF(t,e,r,n,i,a){let c=e,s=0;for(let g=e;g<r;g++){const _=dF(t,g,g+1,i);s+_>n&&(c<g&&a.push(g),c=g,s=0),s+=_}return s}function Jpe(t,e,r,n,i,a){let c=e,s=e,g=e,_=0;for(let v=e;v<r;v++)if((t[v]===" "||t[v+1]===" "||v+1===r)&&(g=v+1),g>s){let T=dF(t,s,g,i);_+T>n&&(c<s&&(a.push(s),c=s,_=0),T>n&&(T=pF(t,s,g,n,i,a),c=a[a.length-1])),s=g,_+=T}return _}function ege(t,e,r,n,i=0,a){a===void 0&&(a=t.length);const c=[];return e==="break-all"?pF(t,i,a,r,n,c):Jpe(t,i,a,r,n,c),c}function tge(t,e,r,n,i,a){let c=0,s=0;for(let g=e;g<r;g++){const _=t[g],v=n[_];v?(s||(s=v.layoutHeight),i[g]=c+v.layoutWidth/2,c+=v.layoutWidth):(Kr.warn(`Missing character: ${_} (${_.codePointAt(0)})`)(),i[g]=c,c+=Zpe)}a[0]=c,a[1]=s}function rge(t,e,r,n,i){const a=Array.from(t),c=a.length,s=new Array(c),g=new Array(c),_=new Array(c),v=(r==="break-word"||r==="break-all")&&isFinite(n)&&n>0,T=[0,0],M=[0,0];let O=0,F=0,j=0;for(let V=0;V<=c;V++){const q=a[V];if((q===`
`||V===c)&&(j=V),j>F){const Y=v?ege(a,r,n,i,F,j):Ype;for(let X=0;X<=Y.length;X++){const ae=X===0?F:Y[X-1],ue=X<Y.length?Y[X]:j;tge(a,ae,ue,i,s,M);for(let ge=ae;ge<ue;ge++){const Le=a[ge],qe=i[Le]?.layoutOffsetY||0;g[ge]=O+M[1]/2+qe,_[ge]=M[0]}O=O+M[1]*e,T[0]=Math.max(T[0],M[0])}F=j}q===`
`&&(s[F]=0,g[F]=0,_[F]=0,F++)}return T[1]=O,{x:s,y:g,rowWidth:_,size:T}}function nge({value:t,length:e,stride:r,offset:n,startIndices:i,characterSet:a}){const c=t.BYTES_PER_ELEMENT,s=r?r/c:1,g=n?n/c:0,_=i[e]||Math.ceil((t.length-g)/s),v=a&&new Set,T=new Array(e);let M=t;if(s>1||g>0){const O=t.constructor;M=new O(_);for(let F=0;F<_;F++)M[F]=t[F*s+g]}for(let O=0;O<e;O++){const F=i[O],j=i[O+1]||_,V=M.subarray(F,j);T[O]=String.fromCodePoint.apply(null,V),v&&V.forEach(v.add,v)}if(v)for(const O of v)a.add(String.fromCodePoint(O));return{texts:T,characterCount:_}}class gF{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const r=this._cache[e];return r&&(this._deleteOrder(e),this._appendOrder(e)),r}set(e,r){this._cache[e]?(this.delete(e),this._cache[e]=r,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=r,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const r=this._order.indexOf(e);r>=0&&this._order.splice(r,1)}_appendOrder(e){this._order.push(e)}}function ige(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const fy={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:ige(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},gD=1024,mD=.9,yD=1.2,mF=3;let C1=new gF(mF);function sge(t,e){let r;typeof e=="string"?r=new Set(Array.from(e)):r=new Set(e);const n=C1.get(t);if(!n)return r;for(const i in n.mapping)r.has(i)&&r.delete(i);return r}function age(t,e){for(let r=0;r<t.length;r++)e.data[4*r+3]=t[r]}function _D(t,e,r,n){t.font=`${n} ${r}px ${e}`,t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function oge(t){Kr.assert(Number.isFinite(t)&&t>=mF,"Invalid cache limit"),C1=new gF(t)}class lge{constructor(){this.props={...fy}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:r}=this.props;return(e*yD+r*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const r=sge(this._key,this.props.characterSet),n=C1.get(this._key);if(n&&r.size===0){this._atlas!==n&&(this._atlas=n);return}const i=this._generateFontAtlas(r,n);this._atlas=i,C1.set(this._key,i)}_generateFontAtlas(e,r){const{fontFamily:n,fontWeight:i,fontSize:a,buffer:c,sdf:s,radius:g,cutoff:_}=this.props;let v=r&&r.data;v||(v=document.createElement("canvas"),v.width=gD);const T=v.getContext("2d",{willReadFrequently:!0});_D(T,n,a,i);const{mapping:M,canvasHeight:O,xOffset:F,yOffset:j}=Qpe({getFontWidth:V=>T.measureText(V).width,fontHeight:a*yD,buffer:c,characterSet:e,maxCanvasWidth:gD,...r&&{mapping:r.mapping,xOffset:r.xOffset,yOffset:r.yOffset}});if(v.height!==O){const V=T.getImageData(0,0,v.width,v.height);v.height=O,T.putImageData(V,0,0)}if(_D(T,n,a,i),s){const V=new Xpe({fontSize:a,buffer:c,radius:g,cutoff:_,fontFamily:n,fontWeight:`${i}`});for(const q of e){const{data:Y,width:X,height:ae,glyphTop:ue}=V.draw(q);M[q].width=X,M[q].layoutOffsetY=a*mD-ue;const ge=T.createImageData(X,ae);age(Y,ge),T.putImageData(ge,M[q].x,M[q].y)}}else for(const V of e)T.fillText(V,M[V].x,M[V].y+c+a*mD);return{xOffset:F,yOffset:j,mapping:M,data:v,width:v.width,height:v.height}}_getKey(){const{fontFamily:e,fontWeight:r,fontSize:n,buffer:i,sdf:a,radius:c,cutoff:s}=this.props;return a?`${e} ${r} ${n} ${i} ${c} ${s}`:`${e} ${r} ${n} ${i}`}}const vD=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 borderRadius;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,cge={name:"textBackground",vs:vD,fs:vD,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",borderRadius:"vec4<f32>",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},uge=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,hge=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
float round_rect(vec2 p, vec2 size, vec4 radii) {
vec2 pixelPositionCB = (p - 0.5) * size;
vec2 sizeCB = size * 0.5;
float maxBorderRadius = min(size.x, size.y) * 0.5;
vec4 borderRadius = vec4(min(radii, maxBorderRadius));
borderRadius.xy =
(pixelPositionCB.x > 0.0) ? borderRadius.xy : borderRadius.zw;
borderRadius.x = (pixelPositionCB.y > 0.0) ? borderRadius.x : borderRadius.y;
vec2 q = abs(pixelPositionCB) - sizeCB + borderRadius.x;
return -(min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - borderRadius.x);
}
float rect(vec2 p, vec2 size) {
vec2 pixelPosition = p * size;
return min(min(pixelPosition.x, size.x - pixelPosition.x),
min(pixelPosition.y, size.y - pixelPosition.y));
}
vec4 get_stroked_fragColor(float dist) {
float isBorder = smoothedge(dist, vLineWidth);
return mix(vFillColor, vLineColor, isBorder);
}
void main(void) {
geometry.uv = uv;
if (textBackground.borderRadius != vec4(0.0)) {
float distToEdge = round_rect(uv, dimensions, textBackground.borderRadius);
if (textBackground.stroked) {
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
float shapeAlpha = smoothedge(-distToEdge, 0.0);
fragColor.a *= shapeAlpha;
} else {
if (textBackground.stroked) {
float distToEdge = rect(uv, dimensions);
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,fge={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,borderRadius:{type:"object",value:0},padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class DC extends Pf{getShaders(){return super.getShaders({vs:uge,fs:hge,modules:[x0,w0,cge]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:r}=e;r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:r,sizeScale:n,sizeUnits:i,sizeMinPixels:a,sizeMaxPixels:c,getLineWidth:s}=this.props;let{padding:g,borderRadius:_}=this.props;g.length<4&&(g=[g[0],g[1],g[0],g[1]]),Array.isArray(_)||(_=[_,_,_,_]);const v=this.state.model,T={billboard:r,stroked:!!s,borderRadius:_,padding:g,sizeUnits:vf[i],sizeScale:n,sizeMinPixels:a,sizeMaxPixels:c};v.shaderInputs.setProps({textBackground:T}),v.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,0,1,1,1];return new ou(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new My({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}}DC.defaultProps=fge;DC.layerName="TextBackgroundLayer";const bD={start:1,middle:0,end:-1},xD={top:1,center:0,bottom:-1},lS=[0,0,0,255],dge=1,pge={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:lS},getBorderWidth:{type:"accessor",value:0},backgroundBorderRadius:{type:"object",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:fy.characterSet},fontFamily:fy.fontFamily,fontWeight:fy.fontWeight,lineHeight:dge,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:lS},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:lS},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class LC extends MC{constructor(){super(...arguments),this.getBoundingRect=(e,r)=>{let{size:[n,i]}=this.transformParagraph(e,r);const{fontSize:a}=this.state.fontAtlasManager.props;n/=a,i/=a;const{getTextAnchor:c,getAlignmentBaseline:s}=this.props,g=bD[typeof c=="function"?c(e,r):c],_=xD[typeof s=="function"?s(e,r):s];return[(g-1)*n/2,(_-1)*i/2,n,i]},this.getIconOffsets=(e,r)=>{const{getTextAnchor:n,getAlignmentBaseline:i}=this.props,{x:a,y:c,rowWidth:s,size:[g,_]}=this.transformParagraph(e,r),v=bD[typeof n=="function"?n(e,r):n],T=xD[typeof i=="function"?i(e,r):i],M=a.length,O=new Array(M*2);let F=0;for(let j=0;j<M;j++){const V=(1-v)*(g-s[j])/2;O[F++]=(v-1)*g/2+V+a[j],O[F++]=(T-1)*_/2+c[j]}return O}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new lge},this.props.maxWidth>0&&Kr.once(1,"v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:r,oldProps:n,changeFlags:i}=e;(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||r.lineHeight!==n.lineHeight||r.wordBreak!==n.wordBreak||r.maxWidth!==n.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:r,fontWeight:n}=this.props,{fontAtlasManager:i,characterSet:a}=this.state,c={...e,characterSet:a,fontFamily:r,fontWeight:n};if(!i.mapping)return i.setProps(c),!0;for(const s in c)if(c[s]!==i.props[s])return i.setProps(c),!0;return!1}_updateText(){const{data:e,characterSet:r}=this.props,n=e.attributes?.getText;let{getText:i}=this.props,a=e.startIndices,c;const s=r==="auto"&&new Set;if(n&&a){const{texts:g,characterCount:_}=nge({...ArrayBuffer.isView(n)?{value:n}:n,length:e.length,startIndices:a,characterSet:s});c=_,i=(v,{index:T})=>g[T]}else{const{iterable:g,objectInfo:_}=gw(e);a=[0],c=0;for(const v of g){_.index++;const T=Array.from(i(v,_)||"");s&&T.forEach(s.add,s),c+=T.length,a.push(c)}}this.setState({getText:i,startIndices:a,numInstances:c,characterSet:s||r})}transformParagraph(e,r){const{fontAtlasManager:n}=this.state,i=n.mapping,a=this.state.getText,{wordBreak:c,lineHeight:s,maxWidth:g}=this.props,_=a(e,r)||"";return rge(_,s,c,g*n.props.fontSize,i)}renderLayers(){const{startIndices:e,numInstances:r,getText:n,fontAtlasManager:{scale:i,atlas:a,mapping:c},styleVersion:s}=this.state,{data:g,_dataDiff:_,getPosition:v,getColor:T,getSize:M,getAngle:O,getPixelOffset:F,getBackgroundColor:j,getBorderColor:V,getBorderWidth:q,backgroundBorderRadius:Y,backgroundPadding:X,background:ae,billboard:ue,fontSettings:ge,outlineWidth:Le,outlineColor:qe,sizeScale:Ze,sizeUnits:_t,sizeMinPixels:it,sizeMaxPixels:gt,transitions:Lt,updateTriggers:Ot}=this.props,Yt=this.getSubLayerClass("characters",kC),ce=this.getSubLayerClass("background",DC);return[ae&&new ce({getFillColor:j,getLineColor:V,getLineWidth:q,borderRadius:Y,padding:X,getPosition:v,getSize:M,getAngle:O,getPixelOffset:F,billboard:ue,sizeScale:Ze,sizeUnits:_t,sizeMinPixels:it,sizeMaxPixels:gt,transitions:Lt&&{getPosition:Lt.getPosition,getAngle:Lt.getAngle,getSize:Lt.getSize,getFillColor:Lt.getBackgroundColor,getLineColor:Lt.getBorderColor,getLineWidth:Lt.getBorderWidth,getPixelOffset:Lt.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:Ot.getPosition,getAngle:Ot.getAngle,getSize:Ot.getSize,getFillColor:Ot.getBackgroundColor,getLineColor:Ot.getBorderColor,getLineWidth:Ot.getBorderWidth,getPixelOffset:Ot.getPixelOffset,getBoundingRect:{getText:Ot.getText,getTextAnchor:Ot.getTextAnchor,getAlignmentBaseline:Ot.getAlignmentBaseline,styleVersion:s}}}),{data:g.attributes&&g.attributes.background?{length:g.length,attributes:g.attributes.background}:g,_dataDiff:_,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new Yt({sdf:ge.sdf,smoothing:Number.isFinite(ge.smoothing)?ge.smoothing:fy.smoothing,outlineWidth:Le/(ge.radius||fy.radius),outlineColor:qe,iconAtlas:a,iconMapping:c,getPosition:v,getColor:T,getSize:M,getAngle:O,getPixelOffset:F,billboard:ue,sizeScale:Ze*i,sizeUnits:_t,sizeMinPixels:it*i,sizeMaxPixels:gt*i,transitions:Lt&&{getPosition:Lt.getPosition,getAngle:Lt.getAngle,getColor:Lt.getColor,getSize:Lt.getSize,getPixelOffset:Lt.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:Ot.getText,getPosition:Ot.getPosition,getAngle:Ot.getAngle,getColor:Ot.getColor,getSize:Ot.getSize,getPixelOffset:Ot.getPixelOffset,getIconOffsets:{getTextAnchor:Ot.getTextAnchor,getAlignmentBaseline:Ot.getAlignmentBaseline,styleVersion:s}}}),{data:g,_dataDiff:_,startIndices:e,numInstances:r,getIconOffsets:this.getIconOffsets,getIcon:n})]}static set fontAtlasCacheLimit(e){oge(e)}}LC.defaultProps=pge;LC.layerName="TextLayer";const _x={circle:{type:IC,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:_w,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:LC,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},vx={type:RC,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},VA={type:OC,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function hv({type:t,props:e}){const r={};for(const n in e)r[n]=t.defaultProps[e[n]];return r}function cS(t,e){const{transitions:r,updateTriggers:n}=t.props,i={updateTriggers:{},transitions:r&&{getPosition:r.geometry}};for(const a in e){const c=e[a];let s=t.props[a];a.startsWith("get")&&(s=t.getSubLayerAccessor(s),i.updateTriggers[c]=n[a],r&&(i.transitions[c]=r[a])),i[c]=s}return i}function gge(t){if(Array.isArray(t))return t;switch(Kr.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return Kr.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function wD(t,e,r={}){const n={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:i=0,endRow:a=t.length}=r;for(let c=i;c<a;c++){const s=t[c],{geometry:g}=s;if(g)if(g.type==="GeometryCollection"){Kr.assert(Array.isArray(g.geometries),"GeoJSON does not have geometries array");const{geometries:_}=g;for(let v=0;v<_.length;v++){const T=_[v];TD(T,n,e,s,c)}}else TD(g,n,e,s,c)}return n}function TD(t,e,r,n,i){const{type:a,coordinates:c}=t,{pointFeatures:s,lineFeatures:g,polygonFeatures:_,polygonOutlineFeatures:v}=e;if(!yge(a,c)){Kr.warn(`${a} coordinates are malformed`)();return}switch(a){case"Point":s.push(r({geometry:t},n,i));break;case"MultiPoint":c.forEach(T=>{s.push(r({geometry:{type:"Point",coordinates:T}},n,i))});break;case"LineString":g.push(r({geometry:t},n,i));break;case"MultiLineString":c.forEach(T=>{g.push(r({geometry:{type:"LineString",coordinates:T}},n,i))});break;case"Polygon":_.push(r({geometry:t},n,i)),c.forEach(T=>{v.push(r({geometry:{type:"LineString",coordinates:T}},n,i))});break;case"MultiPolygon":c.forEach(T=>{_.push(r({geometry:{type:"Polygon",coordinates:T}},n,i)),T.forEach(M=>{v.push(r({geometry:{type:"LineString",coordinates:M}},n,i))})});break}}const mge={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function yge(t,e){let r=mge[t];for(Kr.assert(r,`Unknown GeoJSON type ${t}`);e&&--r>0;)e=e[0];return e&&Number.isFinite(e[0])}function yF(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function nx(t){return t.geometry.coordinates}function _ge(t,e){const r=yF(),{pointFeatures:n,lineFeatures:i,polygonFeatures:a,polygonOutlineFeatures:c}=t;return r.points.data=n,r.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),r.points.getPosition=nx,r.lines.data=i,r.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),r.lines.getPath=nx,r.polygons.data=a,r.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),r.polygons.getPolygon=nx,r.polygonsOutline.data=c,r.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),r.polygonsOutline.getPath=nx,r}function vge(t,e){const r=yF(),{points:n,lines:i,polygons:a}=t,c=Hpe(t,e);r.points.data={length:n.positions.value.length/n.positions.size,attributes:{...n.attributes,getPosition:n.positions,instancePickingColors:{size:4,value:c.points}},properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},r.lines.data={length:i.pathIndices.value.length-1,startIndices:i.pathIndices.value,attributes:{...i.attributes,getPath:i.positions,instancePickingColors:{size:4,value:c.lines}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},r.lines._pathType="open";const s=a.positions.value.length/a.positions.size,g=Array(s).fill(1);for(const _ of a.primitivePolygonIndices.value)g[_-1]=0;return r.polygons.data={length:a.polygonIndices.value.length-1,startIndices:a.polygonIndices.value,attributes:{...a.attributes,getPolygon:a.positions,instanceVertexValid:{size:1,value:new Uint16Array(g)},pickingColors:{size:4,value:c.polygons}},properties:a.properties,numericProps:a.numericProps,featureIds:a.featureIds},r.polygons._normalize=!1,a.triangles&&(r.polygons.data.attributes.indices=a.triangles.value),r.polygonsOutline.data={length:a.primitivePolygonIndices.value.length-1,startIndices:a.primitivePolygonIndices.value,attributes:{...a.attributes,getPath:a.positions,instancePickingColors:{size:4,value:c.polygons}},properties:a.properties,numericProps:a.numericProps,featureIds:a.featureIds},r.polygonsOutline._pathType="open",r}const bge=["points","linestrings","polygons"],xge={...hv(_x.circle),...hv(_x.icon),...hv(_x.text),...hv(vx),...hv(VA),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class BC extends MC{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:r}){if(!r.dataChanged)return;const{data:n}=this.props,i=n&&"points"in n&&"polygons"in n&&"lines"in n;this.setState({binary:i}),i?this._updateStateBinary({props:e,changeFlags:r}):this._updateStateJSON({props:e,changeFlags:r})}_updateStateBinary({props:e,changeFlags:r}){const n=vge(e.data,this.encodePickingColor);this.setState({layerProps:n})}_updateStateJSON({props:e,changeFlags:r}){const n=gge(e.data),i=this.getSubLayerRow.bind(this);let a={};const c={};if(Array.isArray(r.dataChanged)){const g=this.state.features;for(const _ in g)a[_]=g[_].slice(),c[_]=[];for(const _ of r.dataChanged){const v=wD(n,i,_);for(const T in g)c[T].push(jpe({data:a[T],getIndex:M=>M.__source.index,dataRange:_,replace:v[T]}))}}else a=wD(n,i);const s=_ge(a,c);this.setState({features:a,featuresDiff:c,layerProps:s})}getPickingInfo(e){const r=super.getPickingInfo(e),{index:n,sourceLayer:i}=r;return r.featureType=bge.find(a=>i.id.startsWith(`${this.id}-${a}-`)),n>=0&&i.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(r.index=this.props.data.points.globalFeatureIds.value[n]),r}_updateAutoHighlight(e){const r=`${this.id}-points-`,n=e.featureType==="points";for(const i of this.getSubLayers())i.id.startsWith(r)===n&&i.updateAutoHighlight(e)}_renderPolygonLayer(){const{extruded:e,wireframe:r}=this.props,{layerProps:n}=this.state,i="polygons-fill",a=this.shouldRenderSubLayer(i,n.polygons?.data)&&this.getSubLayerClass(i,VA.type);if(a){const c=cS(this,VA.props),s=e&&r;return s||delete c.getLineColor,c.updateTriggers.lineColors=s,new a(c,this.getSubLayerProps({id:i,updateTriggers:c.updateTriggers}),n.polygons)}return null}_renderLineLayers(){const{extruded:e,stroked:r}=this.props,{layerProps:n}=this.state,i="polygons-stroke",a="linestrings",c=!e&&r&&this.shouldRenderSubLayer(i,n.polygonsOutline?.data)&&this.getSubLayerClass(i,vx.type),s=this.shouldRenderSubLayer(a,n.lines?.data)&&this.getSubLayerClass(a,vx.type);if(c||s){const g=cS(this,vx.props);return[c&&new c(g,this.getSubLayerProps({id:i,updateTriggers:g.updateTriggers}),n.polygonsOutline),s&&new s(g,this.getSubLayerProps({id:a,updateTriggers:g.updateTriggers}),n.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:r,binary:n}=this.state;let{highlightedObjectIndex:i}=this.props;!n&&Number.isFinite(i)&&(i=r.points.data.findIndex(s=>s.__source.index===i));const a=new Set(e.split("+")),c=[];for(const s of a){const g=`points-${s}`,_=_x[s],v=_&&this.shouldRenderSubLayer(g,r.points?.data)&&this.getSubLayerClass(g,_.type);if(v){const T=cS(this,_.props);let M=r.points;if(s==="text"&&n){const{instancePickingColors:O,...F}=M.data.attributes;M={...M,data:{...M.data,attributes:F}}}c.push(new v(T,this.getSubLayerProps({id:g,updateTriggers:T.updateTriggers,highlightedObjectIndex:i}),M))}}return c}renderLayers(){const{extruded:e}=this.props,r=this._renderPolygonLayer(),n=this._renderLineLayers(),i=this._renderPointLayers();return[!e&&r,n,i,e&&r]}getSubLayerAccessor(e){const{binary:r}=this.state;return!r||typeof e!="function"?super.getSubLayerAccessor(e):(n,i)=>{const{data:a,index:c}=i,s=Vpe(a,c);return e(s,i)}}}BC.layerName="GeoJsonLayer";BC.defaultProps=xge;const wge=Q.createContext(null);function Tge(t,e){const r=Array.isArray(t)?t[0]:t?t.x:0,n=Array.isArray(t)?t[1]:t?t.y:0,i=Array.isArray(e)?e[0]:e?e.x:0,a=Array.isArray(e)?e[1]:e?e.y:0;return r===i&&n===a}function th(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!th(t[r],e[r]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(const i of r)if(!e.hasOwnProperty(i)||!th(t[i],e[i]))return!1;return!0}return!1}function SD(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function AD(t,e){const r=e.viewState||e,n={};if("longitude"in r&&"latitude"in r&&(r.longitude!==t.center.lng||r.latitude!==t.center.lat)){const i=t.center.constructor;n.center=new i(r.longitude,r.latitude)}return"zoom"in r&&r.zoom!==t.zoom&&(n.zoom=r.zoom),"bearing"in r&&r.bearing!==t.bearing&&(n.bearing=r.bearing),"pitch"in r&&r.pitch!==t.pitch&&(n.pitch=r.pitch),r.padding&&t.padding&&!th(r.padding,t.padding)&&(n.padding=r.padding),n}const Sge=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ED(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const n of t.layers)e[n.id]=n;const r=t.layers.map(n=>{let i=null;"interactive"in n&&(i=Object.assign({},n),delete i.interactive);const a=e[n.ref];if(a){i=i||Object.assign({},n),delete i.ref;for(const c of Sge)c in a&&(i[c]=a[c])}return i||n});return{...t,layers:r}}const CD={version:8,sources:{},layers:[]},PD={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},MD={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},ID={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},Age=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],Ege=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Oy{constructor(e,r,n){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=i=>{const a=this.props[ID[i.type]];a?a(i):i.type==="error"&&console.error(i.error)},this._onCameraEvent=i=>{if(this._internalUpdate)return;i.viewState=this._propsedCameraUpdate||SD(this._map.transform);const a=this.props[MD[i.type]];a&&a(i)},this._onCameraUpdate=i=>this._internalUpdate?i:(this._propsedCameraUpdate=SD(i),AD(i,this.props)),this._onPointerEvent=i=>{(i.type==="mousemove"||i.type==="mouseout")&&this._updateHover(i);const a=this.props[PD[i.type]];a&&(this.props.interactiveLayerIds&&i.type!=="mouseover"&&i.type!=="mouseout"&&(i.features=this._hoveredFeatures||this._queryRenderedFeatures(i.point)),a(i),delete i.features)},this._MapClass=e,this.props=r,this._initialize(n)}get map(){return this._map}setProps(e){const r=this.props;this.props=e;const n=this._updateSettings(e,r),i=this._updateSize(e),a=this._updateViewState(e);this._updateStyle(e,r),this._updateStyleComponents(e),this._updateHandlers(e,r),(n||i||a&&!this._map.isMoving())&&this.redraw()}static reuse(e,r){const n=Oy.savedMaps.pop();if(!n)return null;const i=n.map,a=i.getContainer();for(r.className=a.className;a.childNodes.length>0;)r.appendChild(a.childNodes[0]);i._container=r;const c=i._resizeObserver;c&&(c.disconnect(),c.observe(r)),n.setProps({...e,styleDiffing:!1}),i.resize();const{initialViewState:s}=e;return s&&(s.bounds?i.fitBounds(s.bounds,{...s.fitBoundsOptions,duration:0}):n._updateViewState(s)),i.isStyleLoaded()?i.fire("load"):i.once("style.load",()=>i.fire("load")),i._update(),n}_initialize(e){const{props:r}=this,{mapStyle:n=CD}=r,i={...r,...r.initialViewState,container:e,style:ED(n)},a=i.initialViewState||i.viewState||i;if(Object.assign(i,{center:[a.longitude||0,a.latitude||0],zoom:a.zoom||0,pitch:a.pitch||0,bearing:a.bearing||0}),r.gl){const s=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=s,r.gl)}const c=new this._MapClass(i);a.padding&&c.setPadding(a.padding),r.cursor&&(c.getCanvas().style.cursor=r.cursor),c.transformCameraUpdate=this._onCameraUpdate,c.on("style.load",()=>{this._styleComponents={light:c.getLight(),sky:c.getSky(),projection:c.getProjection?.(),terrain:c.getTerrain()},this._updateStyleComponents(this.props)}),c.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const s in PD)c.on(s,this._onPointerEvent);for(const s in MD)c.on(s,this._onCameraEvent);for(const s in ID)c.on(s,this._onEvent);this._map=c}recycle(){this.map.getContainer().querySelector("[mapboxgl-children]")?.remove(),Oy.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_updateSize(e){const{viewState:r}=e;if(r){const n=this._map;if(r.width!==n.transform.width||r.height!==n.transform.height)return n.resize(),!0}return!1}_updateViewState(e){const r=this._map,n=r.transform;if(!r.isMoving()){const a=AD(n,e);if(Object.keys(a).length>0)return this._internalUpdate=!0,r.jumpTo(a),this._internalUpdate=!1,!0}return!1}_updateSettings(e,r){const n=this._map;let i=!1;for(const a of Age)a in e&&!th(e[a],r[a])&&(i=!0,n[`set${a[0].toUpperCase()}${a.slice(1)}`]?.call(n,e[a]));return i}_updateStyle(e,r){if(e.cursor!==r.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==r.mapStyle){const{mapStyle:n=CD,styleDiffing:i=!0}=e,a={diff:i};"localIdeographFontFamily"in e&&(a.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(ED(n),a)}}_updateStyleComponents({light:e,projection:r,sky:n,terrain:i}){const a=this._map,c=this._styleComponents;a.style._loaded&&(e&&!th(e,c.light)&&(c.light=e,a.setLight(e)),r&&!th(r,c.projection)&&r!==c.projection?.type&&(c.projection=typeof r=="string"?{type:r}:r,a.setProjection?.(c.projection)),n&&!th(n,c.sky)&&(c.sky=n,a.setSky(n)),i!==void 0&&!th(i,c.terrain)&&(!i||a.getSource(i.source))&&(c.terrain=i,a.setTerrain(i)))}_updateHandlers(e,r){const n=this._map;for(const i of Ege){const a=e[i]??!0,c=r[i]??!0;th(a,c)||(a?n[i].enable(a):n[i].disable())}}_queryRenderedFeatures(e){const r=this._map,{interactiveLayerIds:n=[]}=this.props;try{return r.queryRenderedFeatures(e,{layers:n.filter(r.getLayer.bind(r))})}catch{return[]}}_updateHover(e){const{props:r}=this;if(r.interactiveLayerIds&&(r.onMouseMove||r.onMouseEnter||r.onMouseLeave)){const i=e.type,a=this._hoveredFeatures?.length>0,c=this._queryRenderedFeatures(e.point),s=c.length>0;!s&&a&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=c,s&&!a&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=i}else this._hoveredFeatures=null}}Oy.savedMaps=[];const Cge=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function Pge(t){if(!t)return null;const e=t.map,r={getMap:()=>e};for(const n of Mge(e))!(n in r)&&!Cge.includes(n)&&(r[n]=e[n].bind(e));return r}function Mge(t){const e=new Set;let r=t;for(;r;){for(const n of Object.getOwnPropertyNames(r))n[0]!=="_"&&typeof t[n]=="function"&&n!=="fire"&&n!=="setEventedParent"&&e.add(n);r=Object.getPrototypeOf(r)}return Array.from(e)}const Ige=typeof document<"u"?Q.useLayoutEffect:Q.useEffect;function Rge(t,e){const{RTLTextPlugin:r,maxParallelImageRequests:n,workerCount:i,workerUrl:a}=e;if(r&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"){const{pluginUrl:c,lazy:s=!0}=typeof r=="string"?{pluginUrl:r}:r;t.setRTLTextPlugin(c,g=>{g&&console.error(g)},s)}n!==void 0&&t.setMaxParallelImageRequests(n),i!==void 0&&t.setWorkerCount(i),a!==void 0&&t.setWorkerUrl(a)}const vw=Q.createContext(null);function Oge(t,e){const r=Q.useContext(wge),[n,i]=Q.useState(null),a=Q.useRef(),{current:c}=Q.useRef({mapLib:null,map:null});Q.useEffect(()=>{const _=t.mapLib;let v=!0,T;return Promise.resolve(_||lu(()=>Promise.resolve().then(()=>QF),void 0)).then(M=>{if(!v)return;if(!M)throw new Error("Invalid mapLib");const O="Map"in M?M:M.default;if(!O.Map)throw new Error("Invalid mapLib");Rge(O,t),t.reuseMaps&&(T=Oy.reuse(t,a.current)),T||(T=new Oy(O.Map,t,a.current)),c.map=Pge(T),c.mapLib=O,i(T),r?.onMapMount(c.map,t.id)}).catch(M=>{const{onError:O}=t;O?O({type:"error",target:null,originalEvent:null,error:M}):console.error(M)}),()=>{v=!1,T&&(r?.onMapUnmount(t.id),t.reuseMaps?T.recycle():T.destroy())}},[]),Ige(()=>{n&&n.setProps(t)}),Q.useImperativeHandle(e,()=>c.map,[n]);const s=Q.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),g={height:"100%"};return Q.createElement("div",{id:t.id,ref:a,style:s},n&&Q.createElement(vw.Provider,{value:c},Q.createElement("div",{"mapboxgl-children":"",style:g},t.children)))}const kge=Q.forwardRef(Oge),Dge=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Mf(t,e){if(!t||!e)return;const r=t.style;for(const n in e){const i=e[n];Number.isFinite(i)&&!Dge.test(n)?r[n]=`${i}px`:r[n]=i}}function _F(t,e){if(t===e)return null;const r=RD(t),n=RD(e),i=[];for(const a of n)r.has(a)||i.push(a);for(const a of r)n.has(a)||i.push(a);return i.length===0?null:i}function RD(t){return new Set(t?t.trim().split(/\s+/):[])}Q.memo(Q.forwardRef((t,e)=>{const{map:r,mapLib:n}=Q.useContext(vw),i=Q.useRef({props:t}),a=Q.useMemo(()=>{let q=!1;Q.Children.forEach(t.children,ae=>{ae&&(q=!0)});const Y={...t,element:q?document.createElement("div"):void 0},X=new n.Marker(Y);return X.setLngLat([t.longitude,t.latitude]),X.getElement().addEventListener("click",ae=>{i.current.props.onClick?.({type:"click",target:X,originalEvent:ae})}),X.on("dragstart",ae=>{const ue=ae;ue.lngLat=a.getLngLat(),i.current.props.onDragStart?.(ue)}),X.on("drag",ae=>{const ue=ae;ue.lngLat=a.getLngLat(),i.current.props.onDrag?.(ue)}),X.on("dragend",ae=>{const ue=ae;ue.lngLat=a.getLngLat(),i.current.props.onDragEnd?.(ue)}),X},[]);Q.useEffect(()=>(a.addTo(r.getMap()),()=>{a.remove()}),[]);const{longitude:c,latitude:s,offset:g,style:_,draggable:v=!1,popup:T=null,rotation:M=0,rotationAlignment:O="auto",pitchAlignment:F="auto"}=t;Q.useEffect(()=>{Mf(a.getElement(),_)},[_]),Q.useImperativeHandle(e,()=>a,[]);const j=i.current.props;(a.getLngLat().lng!==c||a.getLngLat().lat!==s)&&a.setLngLat([c,s]),g&&!Tge(a.getOffset(),g)&&a.setOffset(g),a.isDraggable()!==v&&a.setDraggable(v),a.getRotation()!==M&&a.setRotation(M),a.getRotationAlignment()!==O&&a.setRotationAlignment(O),a.getPitchAlignment()!==F&&a.setPitchAlignment(F),a.getPopup()!==T&&a.setPopup(T);const V=_F(j.className,t.className);if(V)for(const q of V)a.toggleClassName(q);return i.current.props=t,zE.createPortal(t.children,a.getElement())}));Q.memo(Q.forwardRef((t,e)=>{const{map:r,mapLib:n}=Q.useContext(vw),i=Q.useMemo(()=>document.createElement("div"),[]),a=Q.useRef({props:t}),c=Q.useMemo(()=>{const s={...t},g=new n.Popup(s);return g.setLngLat([t.longitude,t.latitude]),g.once("open",_=>{a.current.props.onOpen?.(_)}),g},[]);if(Q.useEffect(()=>{const s=g=>{a.current.props.onClose?.(g)};return c.on("close",s),c.setDOMContent(i).addTo(r.getMap()),()=>{c.off("close",s),c.isOpen()&&c.remove()}},[]),Q.useEffect(()=>{Mf(c.getElement(),t.style)},[t.style]),Q.useImperativeHandle(e,()=>c,[]),c.isOpen()){const s=a.current.props;(c.getLngLat().lng!==t.longitude||c.getLngLat().lat!==t.latitude)&&c.setLngLat([t.longitude,t.latitude]),t.offset&&!th(s.offset,t.offset)&&c.setOffset(t.offset),(s.anchor!==t.anchor||s.maxWidth!==t.maxWidth)&&(c.options.anchor=t.anchor,c.setMaxWidth(t.maxWidth));const g=_F(s.className,t.className);if(g)for(const _ of g)c.toggleClassName(_);a.current.props=t}return zE.createPortal(t.children,i)}));function jg(t,e,r,n){const i=Q.useContext(vw),a=Q.useMemo(()=>t(i),[]);return Q.useEffect(()=>{const c=e,s=null,g=typeof e=="function"?e:null,{map:_}=i;return _.hasControl(a)||(_.addControl(a,c?.position),s&&s(i)),()=>{g&&g(i),_.hasControl(a)&&_.removeControl(a)}},[]),a}function Lge(t){const e=jg(({mapLib:r})=>new r.AttributionControl(t),{position:t.position});return Q.useEffect(()=>{Mf(e._container,t.style)},[t.style]),null}Q.memo(Lge);function Bge(t){const e=jg(({mapLib:r})=>new r.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return Q.useEffect(()=>{Mf(e._controlContainer,t.style)},[t.style]),null}Q.memo(Bge);function Nge(t,e){const r=Q.useRef({props:t}),n=jg(({mapLib:i})=>{const a=new i.GeolocateControl(t),c=a._setupUI;return a._setupUI=()=>{a._container.hasChildNodes()||c()},a.on("geolocate",s=>{r.current.props.onGeolocate?.(s)}),a.on("error",s=>{r.current.props.onError?.(s)}),a.on("outofmaxbounds",s=>{r.current.props.onOutOfMaxBounds?.(s)}),a.on("trackuserlocationstart",s=>{r.current.props.onTrackUserLocationStart?.(s)}),a.on("trackuserlocationend",s=>{r.current.props.onTrackUserLocationEnd?.(s)}),a},{position:t.position});return r.current.props=t,Q.useImperativeHandle(e,()=>n,[]),Q.useEffect(()=>{Mf(n._container,t.style)},[t.style]),null}Q.memo(Q.forwardRef(Nge));function zge(t){const e=jg(({mapLib:r})=>new r.NavigationControl(t),{position:t.position});return Q.useEffect(()=>{Mf(e._container,t.style)},[t.style]),null}Q.memo(zge);function Fge(t){const e=jg(({mapLib:a})=>new a.ScaleControl(t),{position:t.position}),r=Q.useRef(t),n=r.current;r.current=t;const{style:i}=t;return t.maxWidth!==void 0&&t.maxWidth!==n.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==n.unit&&e.setUnit(t.unit),Q.useEffect(()=>{Mf(e._container,i)},[i]),null}Q.memo(Fge);function Uge(t){const e=jg(({mapLib:r})=>new r.TerrainControl(t),{position:t.position});return Q.useEffect(()=>{Mf(e._container,t.style)},[t.style]),null}Q.memo(Uge);function jge(t){const e=jg(({mapLib:r})=>new r.LogoControl(t),{position:t.position});return Q.useEffect(()=>{Mf(e._container,t.style)},[t.style]),null}Q.memo(jge);const Vge="https://dicratiler.blob.core.windows.net/dicra-dev/unfpa/Data/pop_2024.json",$ge={latitude:21.11117946909088,longitude:84.90014,zoom:8,pitch:45,bearing:0},Hge="https://basemaps.cartocdn.com/gl/positron-nolabels-gl-style/style.json",Wge=new v5({intensity:1}),qge=new sce({timestamp:Date.now(),intensity:1});function Gge({width:t="100%",height:e="500px"}){const[r,n]=Q.useState(null),[i]=Q.useState(()=>[new gC({ambientLight:Wge,sunLight:qge})]);if(Q.useEffect(()=>{fetch(Vge).then(g=>g.json()).then(g=>n(g)).catch(g=>console.error("Failed to load GeoJSON:",g))},[]),!r)return Se.jsx("div",{children:"Loading map..."});const a=r.features.map(g=>g.properties.DN);Math.min(...a),Math.max(...a);const c=R1().domain([0,80,8e3,18e3,25e3]).range([[255,255,178],[254,204,92],[253,141,60],[240,59,32],[189,0,38]]),s=[new BC({id:"geojson-layer",data:r,extruded:!0,wireframe:!0,filled:!0,opacity:.8,getElevation:g=>g.properties.DN*5,getFillColor:g=>c(g.properties.DN),getLineColor:[255,255,255],pickable:!0})];return Se.jsx("div",{className:"relative w-full rounded-lg",children:Se.jsxs("div",{className:"relative w-full h-[600px] overflow-hidden select-none rounded-lg shadow-md bg-white",children:[Se.jsx("div",{className:"absolute top-4 left-4 z-30 bg-white text-gray-800 px-3 py-1 rounded-md text-sm font-medium shadow",children:"Population Density 3D"}),Se.jsx("div",{className:"w-full h-full",children:Se.jsx(jde,{initialViewState:$ge,controller:!0,layers:s,effects:i,style:{width:"100%",height:"100%"},getTooltip:({object:g})=>g&&`Population Density: ${g.properties.DN}`,children:Se.jsx(kge,{reuseMaps:!0,mapStyle:Hge})})})]})})}const Xge="/assets/urban_1-BneNB4t9.webp",Zge="/assets/urban_2-DNPCqMRv.webp",Yge="/assets/industry_1-COrVifPR.webp",Kge="/assets/industry_2-CchNpYkW.webp",Qge=({data:t,nameKey:e})=>{const r=Object.keys(t[0]).filter(i=>i!==e),n=i=>r.map(a=>({year:a,value:Number(i[a].replace(/,/g,""))}));return Se.jsx("div",{className:"min-w-full w-full overflow-x-auto",children:Se.jsxs("table",{className:"min-w-full table-fixed divide-y divide-gray-200 text-left",children:[Se.jsxs("thead",{className:"bg-gray-200",children:[Se.jsxs("tr",{children:[Se.jsx("th",{rowSpan:2,className:"px-4 py-2 text-left",children:e}),Se.jsx("th",{colSpan:r.length,className:"px-4 py-2 text-center",children:"Builtup Area (m)"}),Se.jsx("th",{rowSpan:2,className:"px-4 py-2 text-left",children:"Trendline"})]}),Se.jsx("tr",{children:r.map(i=>Se.jsx("th",{className:"px-4 py-2 text-left",children:i},i))})]}),Se.jsx("tbody",{className:"divide-y divide-gray-200",children:t.map((i,a)=>Se.jsxs("tr",{children:[Se.jsx("td",{className:"px-4 py-2 font-medium text-left",children:i[e]}),r.map(c=>Se.jsx("td",{className:"px-4 py-2 text-right",children:i[c]},c)),Se.jsx("td",{className:"py-2 text-center",children:Se.jsx("div",{className:"w-[180px] h-[80px]",children:Se.jsx(sN,{width:"100%",height:"100%",children:Se.jsxs($N,{data:n(i),margin:{right:15,left:15},children:[Se.jsx(O3,{dataKey:"year",tick:{fontSize:10},interval:2,axisLine:!1,tickLine:!1}),Se.jsx(k3,{hide:!0,domain:["auto","auto"]}),Se.jsx(iN,{contentStyle:{fontSize:"12px"},labelStyle:{fontWeight:"bold"}}),Se.jsx(R3,{type:"monotone",dataKey:"value",stroke:"#6C2F2D",strokeWidth:2,dot:!1})]})})})})]},a))})]})})};function Jge(){const t=Q.useRef(null),e=Q.useRef(null),[r,n]=Q.useState(!0),[i,a]=Q.useState(!0),c="https://dicratiler.blob.core.windows.net/dicra-dev/unfpa/Data/anugul_boundary.pmtiles",s="https://dicratiler.blob.core.windows.net/dicra-dev/unfpa/Data/anugul_built_up_vector_2010.pmtiles",g="https://dicratiler.blob.core.windows.net/dicra-dev/unfpa/Data/anugul_built_up_vector_2025.pmtiles";return Q.useEffect(()=>{const _=new CE;return gl.addProtocol("pmtiles",_.tile),e.current=new gl.Map({container:t.current,style:"https://basemaps.cartocdn.com/gl/positron-nolabels-gl-style/style.json",center:[85.09764,20.8365],zoom:12,minZoom:12}),e.current.on("load",()=>{e.current.dragPan.disable(),e.current.scrollZoom.disable(),e.current.addSource("vector2024",{type:"vector",url:`pmtiles://${g}`}),e.current.addLayer({id:"vector2024-fill",type:"fill",source:"vector2024","source-layer":"zcta",layout:{visibility:i?"visible":"none"},paint:{"fill-color":"#6C2F2D","fill-opacity":1}}),e.current.addSource("vector2011",{type:"vector",url:`pmtiles://${s}`}),e.current.addLayer({id:"vector2011-fill",type:"fill",source:"vector2011","source-layer":"zcta",layout:{visibility:r?"visible":"none"},paint:{"fill-color":"#eb8c72","fill-opacity":1}}),e.current.addSource("boundary",{type:"vector",url:`pmtiles://${c}`}),e.current.addLayer({id:"boundary-line",type:"line",source:"boundary","source-layer":"zcta",paint:{"line-color":"#000000","line-width":1}})}),()=>{e.current&&e.current.remove()}},[]),Q.useEffect(()=>{e.current?.getLayer("vector2011-fill")&&e.current.setLayoutProperty("vector2011-fill","visibility",r?"visible":"none")},[r]),Q.useEffect(()=>{e.current?.getLayer("vector2024-fill")&&e.current.setLayoutProperty("vector2024-fill","visibility",i?"visible":"none")},[i]),Se.jsxs("div",{className:"relative w-full h-[600px] rounded-lg",children:[Se.jsxs("div",{className:"absolute top-2 left-2 z-30 bg-white p-3 rounded shadow-md space-y-2",children:[Se.jsx("div",{children:Se.jsxs("label",{children:[Se.jsx("input",{type:"checkbox",checked:i,onChange:_=>a(_.target.checked),className:"mr-1"}),"Urban sprawl 2024"]})}),Se.jsx("div",{children:Se.jsxs("label",{children:[Se.jsx("input",{type:"checkbox",checked:r,onChange:_=>n(_.target.checked),className:"mr-1"}),"Urban sprawl 2011"]})})]}),Se.jsx("div",{ref:t,className:"w-full h-full rounded-lg overflow-hidden"})]})}function eme(){const t=Q.useRef(null),e=Q.useRef(null),r=Q.useRef(null),[n,i]=Q.useState(-10),[a,c]=Q.useState(!1),s=Q.useRef(null),g=Q.useRef(null),_=[{year:"2012",url:"https://dicratiler.blob.core.windows.net/dicra-dev/unfpa/Data/NTL_2012.tif"},{year:"2024",url:"https://dicratiler.blob.core.windows.net/dicra-dev/unfpa/Data/NTL_2024.tif"}],[v,T]=Q.useState(_[0].url),[M,O]=Q.useState(_[1].url),F="https://basemaps.cartocdn.com/gl/positron-nolabels-gl-style/style.json";return Q.useEffect(()=>{if(r.current){const V=r.current.getBoundingClientRect();i(V.width/2)}const j=()=>{if(r.current){const V=r.current.getBoundingClientRect();i(V.width/2)}};return window.addEventListener("resize",j),()=>window.removeEventListener("resize",j)},[]),Q.useEffect(()=>{gl.addProtocol("cog",z4);const j=new CE;return gl.addProtocol("pmtiles",j.tile),()=>gl.removeProtocol("pmtiles")},[]),Q.useEffect(()=>{const V=[84.90014,21.11117946909088];s.current=new gl.Map({container:t.current,style:F,center:V,zoom:8,minZoom:8}),s.current.on("load",()=>{s.current.addSource("leftNTL",{type:"raster",url:`cog://${v}#color:["#FFFFFF","#CC5252", "#CC0000", "#7A0000", "#67000D"],0,100,c`,tileSize:256}),s.current.addLayer({id:"ndvi-left",type:"raster",source:"leftNTL",paint:{"raster-opacity":1}}),s.current.addSource("leftVector",{type:"vector",url:"pmtiles://https://dicratiler.blob.core.windows.net/dicra-dev/unfpa/Data/anugul_boundary.pmtiles"}),s.current.addLayer({id:"vector-outline-left",type:"line",source:"leftVector","source-layer":"zcta",paint:{"line-color":"black","line-width":1}})}),g.current=new gl.Map({container:e.current,style:F,center:V,zoom:8,minZoom:8}),g.current.on("load",()=>{g.current.addSource("rightNTL",{type:"raster",url:`cog://${M}#color:#color:["#FFFFFF","#CC5252", "#CC0000", "#7A0000", "#67000D"],0,100,c`,tileSize:256}),g.current.addLayer({id:"ndvi-right",type:"raster",source:"rightNTL",paint:{"raster-opacity":1}}),g.current.addSource("rightVector",{type:"vector",url:"pmtiles://https://dicratiler.blob.core.windows.net/dicra-dev/unfpa/Data/anugul_boundary.pmtiles"}),g.current.addLayer({id:"vector-outline-right",type:"line",source:"rightVector","source-layer":"zcta",paint:{"line-color":"black","line-width":1}})});let q=!1;const Y=(X,ae)=>{X.on("move",()=>{q||(q=!0,ae.jumpTo({center:X.getCenter(),zoom:X.getZoom(),bearing:X.getBearing(),pitch:X.getPitch()}),q=!1)})};return Y(s.current,g.current),Y(g.current,s.current),()=>{s.current.remove(),g.current.remove()}},[]),Q.useEffect(()=>{s.current&&s.current.getSource("leftNTL")&&s.current.getSource("leftNTL").setUrl(`cog://${v}#color:#color:["#FFFFFF","#CC5252", "#CC0000", "#7A0000", "#67000D"],0,100,c`)},[v]),Q.useEffect(()=>{g.current&&g.current.getSource("rightNTL")&&g.current.getSource("rightNTL").setUrl(`cog://${M}#color:#color:["#FFFFFF","#CC5252", "#CC0000", "#7A0000", "#67000D"]
,0,100,c`)},[M]),Q.useEffect(()=>{const j=q=>{if(!a)return;const Y=q.clientX||q.touches&&q.touches[0].clientX;if(!r.current)return;const X=r.current.getBoundingClientRect(),ae=Math.max(0,Math.min(X.width,Y-X.left));i(ae)},V=()=>c(!1);return window.addEventListener("mousemove",j),window.addEventListener("mouseup",V),window.addEventListener("touchmove",j),window.addEventListener("touchend",V),()=>{window.removeEventListener("mousemove",j),window.removeEventListener("mouseup",V),window.removeEventListener("touchmove",j),window.removeEventListener("touchend",V)}},[a]),Se.jsx("div",{className:"relative w-full rounded-lg",children:Se.jsxs("div",{ref:r,className:"relative w-full h-[600px] overflow-hidden select-none rounded-lg",children:[Se.jsx("div",{className:"absolute top-4 left-4 z-30 bg-white text-gray-800 px-3 py-1 rounded-md text-sm font-medium shadow",children:"2012"}),Se.jsx("div",{className:"absolute top-4 right-4 z-30 bg-white text-gray-800 px-3 py-1 rounded-md text-sm font-medium shadow",children:"2024"}),Se.jsx("div",{ref:t,className:"relative w-full h-[600px] overflow-hidden select-none"}),Se.jsx("div",{ref:e,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",clipPath:`inset(0 0 0 ${n}px)`,pointerEvents:"none",overflow:"hidden"}}),Se.jsx("div",{onMouseDown:()=>c(!0),onTouchStart:()=>c(!0),className:"absolute top-0 z-20 flex items-center justify-center w-0.5 h-full bg-sky-500 cursor-ew-resize",style:{left:`${n-.5}px`},children:Se.jsx("div",{className:"absolute w-6 h-6 rounded-full bg-sky-500 border-2 border-white shadow-lg flex items-center justify-center",children:Se.jsxs("span",{className:"text-white text-sm",children:["< ",""," >"]})})})]})})}const tme="/assets/population_2024-jOEwu076.png",rme="/assets/infra-BOKEQv55.webp",nme=[{"Sub District":"Industrial",2011:"29,39,003",2015:"42,72,001",2020:"46,08,897",2024:"50,14,895"},{"Sub District":"Anugul",2011:"45,96,181",2015:"54,35,776",2020:"61,17,994",2024:"66,15,072"},{"Sub District":"Talcher Sadar	",2011:"27,95,921",2015:"33,43,597",2020:"39,70,644",2024:"44,73,497"},{"Sub District":"Kaniha",2011:"19,62,965",2015:"25,65,415",2020:"30,56,392",2024:"34,15,158"},{"Sub District":"Banarpal",2011:"24,14,593",2015:"29,01,107",2020:"32,81,237",2024:"37,12,724"}],ime=()=>Se.jsx("section",{className:"py-12",style:{background:"#FAFAF8"},children:Se.jsxs("div",{className:"container mx-auto px-4 max-w-4xl",children:[Se.jsxs("div",{className:"mb-8 text-gray-800",children:[Se.jsxs("p",{className:"text-md font-medium mb-2",children:[" ","How urban growth, industries, mining and developments have reshaped where people live in the heart of Odisha."]}),Se.jsx("p",{className:"text-sm",children:"PUBLISHED OCT 15, 2025"})]}),Se.jsxs("div",{className:"prose prose-lg max-w-none mb-12",children:[Se.jsx("h2",{className:"text-2xl md:text-3xl font-medium text-gray-800 mb-6",children:"Introduction"}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:"Anugul, Odisha A quiet district in the heart of Odisha, Anugul has transformed into a bustling industrial hub over the past two decades. Home to major coal mines, power plants, and steel industries, the district has witnessed significant economic growth. But how have rapid urban growth, industrialization, and other developments impacted its population? With the last official census conducted in 2011, a clear picture of Anugul's current demographic landscape has been missing. Now, by harnessing the power of satellite imagery and machine learning, a new data-driven narrative is emerging, offering a glimpse into the district's unseen population dynamics."}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:"A data visualization story prepared on the subject reveals a compelling correlation between industrial expansion, land use changes, and estimated population growth in Anugul. By analyzing various satellite data streams, it's possible to piece together a story of a district in transition, where economic opportunities are drawing in new residents, leading to significant changes in the physical and social fabric of the region."}),Se.jsx("h3",{className:"text-xl md:text-2xl font-medium text-gray-800 mb-6",children:"Baseline snapshot - Anugul"}),Se.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[Se.jsxs("div",{children:[Se.jsx("div",{className:"overflow-hidden rounded-lg",children:Se.jsx("img",{src:Dee,alt:"Anugul",className:"w-full"})}),Se.jsx("p",{className:"mt-2 text-sm italic text-gray-600",children:"Population statistics of Anugul, Odisha based on 2011 census."})]}),Se.jsxs("div",{className:"md:w-1/2 grid grid-cols-2 gap-x-12 gap-y-5",children:[Se.jsxs("div",{children:[Se.jsx("p",{className:"text-gray-500 uppercase tracking-wider text-sm",children:"AREA"}),Se.jsx("p",{className:"text-[1.6rem] font-medium",children:"6375 sq.km"})]}),Se.jsxs("div",{children:[Se.jsx("p",{className:"text-gray-500 uppercase tracking-wider text-sm",children:"TOTAL POPULATION"}),Se.jsx("p",{className:"text-[1.6rem] font-medium",children:"12,73,821"})]}),Se.jsxs("div",{children:[Se.jsx("p",{className:"text-gray-500 uppercase tracking-wider text-sm",children:"MALE POPULATION"}),Se.jsx("p",{className:"text-[1.6rem] font-medium",children:"6,55,718"})]}),Se.jsxs("div",{children:[Se.jsx("p",{className:"text-gray-500 uppercase tracking-wider text-sm",children:"FEMALE POPULATION"}),Se.jsx("p",{className:"text-[1.6rem] font-medium",children:"6,18,103"})]}),Se.jsxs("div",{children:[Se.jsx("p",{className:"text-gray-500 uppercase tracking-wider text-sm",children:"CHILD POPULATION"}),Se.jsx("p",{className:"text-[1.6rem] font-medium",children:"1,52,403"})]}),Se.jsxs("div",{children:[Se.jsx("p",{className:"text-gray-500 uppercase tracking-wider text-sm",children:"URBAN POPULATION"}),Se.jsx("p",{className:"text-[1.6rem] font-medium",children:"2,06,546"})]}),Se.jsxs("div",{children:[Se.jsx("p",{className:"text-gray-500 uppercase tracking-wider text-sm",children:"RURAL POPULATION"}),Se.jsx("p",{className:"text-[1.6rem] font-medium",children:"10,67,275"})]}),Se.jsxs("div",{children:[Se.jsx("p",{className:"text-gray-500 uppercase tracking-wider text-sm",children:"LITERACY RATE"}),Se.jsx("p",{className:"text-[1.6rem] font-medium",children:"77.53%"})]})]})]})]}),Se.jsxs("div",{className:"prose prose-lg max-w-none mb-12",children:[Se.jsx("h2",{className:"text-2xl md:text-3xl font-medium text-gray-800 mb-6",children:"Population Estimation"}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:"This project leveraged geospatial technology and Artificial Intelligence (AI) to develop a robust methodology for estimating population figures for Anugul, effectively supplementing traditional census efforts to support informed policy and planning. The approach established a baseline relationship between demographic data and remotely sensed features from 2011 and successfully applied this model to more recent imagery."}),Se.jsx("h3",{className:"text-xl md:text-2xl font-medium text-gray-800 mb-6",children:"Datasets"}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:"To develop this model and conduct the study, we utilized the following datasets:"}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:Se.jsxs("ol",{class:"list-decimal  pl-6 space-y-2",children:[Se.jsx("li",{children:"Census 2011 data"}),Se.jsx("li",{children:"Built-up area"}),Se.jsx("li",{children:"Nightlight data"}),Se.jsx("li",{children:"Vegetation, water & other indices"}),Se.jsx("li",{children:"Administrative boundaries & other geospatial datasets"})]})}),Se.jsx("h3",{className:"text-xl md:text-2xl font-medium text-gray-800 mb-6",children:"Output"}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:"The model produced high-resolution population estimates for the district from 2012 to 2024, presented in a gridded format as visualized below. In the 2024 map, darker pixels indicate areas with higher population density, while lighter pixels represent areas with lower population values."}),Se.jsxs("div",{className:"relative mb-6",children:[Se.jsxs("div",{className:"absolute top-4 left-4 z-30 bg-white text-gray-800 px-3 py-1 rounded-md text-sm font-medium shadow",children:["Population 2024"," "]}),Se.jsx("img",{src:tme,alt:"Where people live today",className:"w-full h-auto rounded-lg shadow-md"}),Se.jsx("p",{className:"mt-3 text-sm italic text-gray-600",children:"Population Estimation Map of Anugul 2024"})]}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:"Even with all the industrialization, most of Anugul's population still lives in rural areas. However, people are not spread out evenly. Villages near main roads and rivers have more people than those in the hilly, more remote parts of the district."}),Se.jsxs("p",{className:"text-gray-700 leading-relaxed mb-6",children:[Se.jsx("p",{className:"text-center",children:Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:Se.jsx(Gge,{})})}),Se.jsx("p",{className:"italic text-sm text-gray-600",style:{marginTop:"-8px"},children:"Population Density 3D"})]})]}),Se.jsx("hr",{class:"border-gray-300 my-4 mb-10"}),Se.jsxs("div",{className:"prose prose-lg max-w-none mb-12",children:[Se.jsx("h2",{className:"text-2xl md:text-3xl font-medium text-gray-800 mb-6",children:"Proxy Data Analysis"}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:"We will now focus on studying and analyzing the population dynamics of the district. This involves examining trends in population growth using built-up area, nightlight, and other geospatial datasets over time, to gain insights into the factors driving these changes."}),Se.jsx("h3",{className:"text-xl md:text-2xl font-medium text-gray-800 mb-6",children:"Built-up Study"}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:"Between 2011 and 2024, Anuguls urban centers grew significantly. Satellite imageries show built-up areas expanding in the Anugul-Talcher region, illustrating the nature of this growth, with urban development radiating outward from multiple nodes rather than a single central point. Visually mapping the decade long evolution from a primarily agrarian landscape to an industrial-urban corridor."}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:Se.jsxs("div",{className:"prose prose-lg max-w-none",children:[Se.jsx(cV,{}),Se.jsx("p",{className:"mt-2 text-sm italic text-gray-600",children:"Built-up area 2011 vs 2024"})]})}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:"The Anugul District underwent a rapid and extensive socio-spatial transformation between 2011 and the mid-2020s, a trend demonstrably linked to industrial development. Remote sensing analysis from 2012 to 2024, which includes data from this time frame, confirms a substantial increase in built-up areas. The pattern of growth is not focused on a single city center but is multi-nodal, with development radiating outward from several distinct industrial and urban nodes. This pattern of urban sprawl is intrinsically linked to the establishment and expansion of major industrial and mining facilities. The region is home to public sector undertakings and large-scale private industries in key sectors, including coal mining, thermal power generation (NTPC), and aluminum smelting (NALCO, JSPL). This concentration of industry establishes the corridor's economic and developmental trajectory."}),Se.jsx("p",{className:"text-gray-700 leading-relaxed",children:Se.jsx("div",{className:"prose prose-lg max-w-none",children:Se.jsx(kee,{})})}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6 pl-4 border-l-4 font-medium",style:{borderColor:"#6C2F2D"},children:"Anugul District recorded a nearly twofold increase in its built-up area between 2011 and 2024, demonstrating rapid and widespread urban and infrastructural growth across multiple sub-districts."}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:"The table below lists the sub districts with the highest (top 5) increase in built-up area from 2011 to 2024, along with the trend over time."}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:Se.jsx("p",{className:"text-center mb-6",children:Se.jsxs("div",{className:"prose prose-lg max-w-none mb-12",children:[Se.jsx("h2",{className:"text-xl md:text-2xl font-medium text-gray-800 mb-6"}),Se.jsx(Qge,{data:nme,nameKey:"Sub District"})]})})})]}),Se.jsxs("div",{className:"prose prose-lg max-w-none mb-12",children:[Se.jsx("h3",{className:"text-xl md:text-2xl font-medium text-gray-800 mb-6",children:"Night Lights Study"}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:"Pictures of the Earth at night show how much Anugul has changed. The areas around Talcher have become much brighter, tripling in brightness, which reflects the rapid industrial growth. These bright areas line up with industrial zones and new roads. In contrast, many rural areas remain dark, indicating that the economic growth has not been evenly spread across the district."}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:Se.jsxs("div",{className:"prose prose-lg max-w-none",children:[Se.jsx(eme,{}),Se.jsx("p",{className:"mt-2 text-sm italic text-gray-600",children:"Nightlight Map 2012 vs 2024"})]})}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:Se.jsx("p",{className:"text-center mb-6",children:Se.jsx("img",{src:Lee,alt:"dnb animated gif",className:"w-full h-auto rounded-lg bg-white shadow-md p-6"})})}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:Se.jsx("div",{className:"w-full h-64 bg-gray-200 flex items-center justify-center rounded-lg mb-6",children:Se.jsx("span",{className:"text-gray-600 text-lg italic",children:"Night light trend"})})}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:"Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum."}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:Se.jsx("p",{className:"text-center mb-6",children:Se.jsx("div",{className:"w-full h-64 bg-gray-200 flex items-center justify-center rounded-lg",children:Se.jsx("span",{className:"text-gray-600 text-lg italic",children:"Night light table"})})})}),Se.jsx("h3",{className:"text-xl md:text-2xl font-medium text-gray-800 mb-6",children:"Vegitation and Others"}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:"Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum."}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:Se.jsxs("div",{className:"prose prose-lg max-w-none",children:[Se.jsx("div",{className:"w-full h-64 bg-gray-200 flex items-center justify-center rounded-lg",children:Se.jsx("span",{className:"text-gray-600 text-lg italic",children:"Vegetation Map"})}),Se.jsx("p",{className:"mt-2 text-sm italic text-gray-600",children:"Vegitation"})]})}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:Se.jsx("div",{className:"w-full h-64 bg-gray-200 flex items-center justify-center rounded-lg",children:Se.jsx("span",{className:"text-gray-600 text-lg italic",children:"Vegetation trend"})})}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:"Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum."}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:Se.jsx("p",{className:"text-center mb-6",children:Se.jsx("div",{className:"w-full h-64 bg-gray-200 flex items-center justify-center rounded-lg",children:Se.jsx("span",{className:"text-gray-600 text-lg italic",children:"Vegetation table"})})})})]}),Se.jsxs("div",{className:"prose prose-lg max-w-none mb-12",children:[Se.jsx("h2",{className:"text-2xl md:text-3xl font-medium text-gray-800 mb-6",children:"Population Dynamics Analysis"}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:"By examining multi-temporal satellite imagery and related geospatial datasets, several contributing factors were identified:"}),Se.jsxs("p",{className:"text-gray-700 leading-relaxed mb-6",children:[Se.jsx("h3",{className:"text-xl md:text-2xl font-medium text-gray-800 mb-6",children:"Urban Sprawl"}),"Urban sprawl describes the expansion of cities and towns into surrounding rural areas. In Anugul, this has been a defining feature of its development over the past few decades. Instead of growing in a compact, organized way, the urban areas have spread out, often in a scattered and unplanned manner.",Se.jsxs("div",{className:"prose prose-lg max-w-none mb-6 mt-6",children:[Se.jsx(Jge,{}),Se.jsx("p",{className:"mt-2 italic text-sm text-gray-600",children:"Urban Sprawl 2011 vs 2024"})]}),Se.jsxs("p",{className:"text-gray-700 leading-relaxed mb-6",children:[Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:"Provided below is the satellite imagery showing the urbanization that has happened in 12 years across a few sub-districts, Anugul and Colliery"}),Se.jsx("p",{className:"mb-6",children:Se.jsxs("p",{children:[Se.jsx("img",{src:Xge,alt:"dnb animated gif",className:"w-full h-auto rounded-lg shadow-md p-6"}),Se.jsx("p",{className:"mt-2 text-sm italic text-gray-600",children:"Urban sprawl in the sub-district areas of Anugul"})]})})]}),Se.jsxs("p",{className:"text-gray-700 leading-relaxed mb-6",children:[Se.jsx("p",{className:"mb-6",children:Se.jsxs("p",{children:[Se.jsx("img",{src:Zge,alt:"dnb animated gif",className:"w-full h-auto rounded-lg shadow-md p-6"}),Se.jsx("p",{className:"mt-2 text-sm italic text-gray-600",children:"Urban sprawl in the sub-district areas of Colliery"})]})}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:"The expansion of Anuguls urban sprawl has brought about multiple areas of densely populated areas. Particularly bringing more migration from other States and districts as part of the industrialization workforce and local migration from the village areas to the central regions."})]}),Se.jsxs("p",{className:"text-gray-700 leading-relaxed mb-6",children:[Se.jsx("h3",{className:"text-xl md:text-2xl font-medium text-gray-800 mb-6",children:"The Mining Belt Effect"}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:"Mining has been the districts key economic engine  and a defining feature in its rapid demographic evolution. Talchers coalfields have expanded rapidly over the past decade and employ nearly 41% of its workforce from within the district, establishing itself as an economic magnet pulling in a massive workforce and supporting secondary industries across the coalfield regions."}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:"Below are the mining areas of (names of the two areas in the two maps) that shows the creation of new coalmines, processing plants amongst other supporting infrastructure"}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:Se.jsx("p",{className:"mb-6 mt-6",children:Se.jsxs("p",{children:[Se.jsx("img",{src:Yge,alt:"dnb animated gif",className:"w-full h-auto rounded-lg bg-white shadow-md p-6"}),Se.jsx("p",{className:"mt-2 text-sm italic text-gray-600",children:"Mining projects completed in the (area name) from 2012 to 2024"})]})})}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:Se.jsx("p",{className:" mb-6",children:Se.jsxs("p",{children:[Se.jsx("img",{src:Kge,alt:"dnb animated gif",className:"w-full h-auto rounded-lg bg-white shadow-md p-6"}),Se.jsx("p",{className:"mt-2 text-sm italic text-gray-600",children:"Mining projects completed in the (area name) from 2012 to 2024."})]})})}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:"The opencast coal mining activities have expanded mining areas from a negligible 0.69 square kilometers to 30.47 square kilometers and more. The entire coalfields span approximately 1,800 square kilometers with coal-bearing areas of 1,000 square kilometers, producing over 95 million tonnes of coal in 2022 and is projected to reach 300 million tonnes annually by 2030 with worker populations set to double by then."})]}),Se.jsxs("p",{className:"text-gray-700 leading-relaxed mb-6",children:[Se.jsx("h3",{className:"text-xl md:text-2xl font-medium text-gray-800 mb-6",children:"Infrastructure Development"}),"The construction of new roads and railway lines has played a crucial role. For example, projects to improve National Highway 55, which passes through Anugul, and the development of new railway lines aim to better connect the region's industrial and mining centers. These improved transportation links make it easier to move goods and people, encouraging the growth of new settlements and industries. In late 2022, the Chief Minister of Odisha launched numerous development projects in Anugul, including improved irrigation, new bus terminals, and bridges, further boosting the district's infrastructure.",Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:Se.jsxs("p",{className:"mb-6 mt-6",children:[Se.jsx("p",{className:"",children:Se.jsx("img",{src:rme,alt:"dnb animated gif",className:"w-full h-auto rounded-lg bg-white shadow-md p-6"})}),Se.jsx("p",{className:"mt-2 text-sm italic text-gray-600",children:"Latlong: 20.815122780256594, 85.0688213042713"})]})})]}),Se.jsxs("p",{className:"text-gray-700 leading-relaxed mb-6",children:[Se.jsx("h3",{className:"text-xl md:text-2xl font-medium text-gray-800 mb-6",children:"Relocation of Local Population"}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:"As part of the industrialization efforts in the coalfield regions, large swathes of families get displaced and relocated as part of land acquisition. One such example is of the Mahanadi Coal Fields Limited (MCL) mining operations in the Talcher coalfield resulting in the displacement of families, with 8 opencast projects alone affecting around 400+ families. These families were relocated to designated sites in the nearby villages, such as the Kuio Jungle, Handidhua & Ghantapada areas of Talcher with many other families ultimately resettled at sites of their own choosing."}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:Se.jsx("p",{className:"text-center mb-6",children:Se.jsx("div",{className:"w-full h-64 bg-gray-200 flex items-center justify-center rounded-lg",children:Se.jsx("span",{className:"text-gray-600 text-lg italic",children:"Relocation image"})})})}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:"As indicated in the Satellite imagery above, more residential units and built-up areas were created in these villages as part of resettlement"})]}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:Se.jsx("h3",{className:"text-xl md:text-2xl font-medium text-gray-800 mb-6",children:"Reduction In Agriland"})}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:"Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum."}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:Se.jsx("p",{className:"text-center mb-6",children:Se.jsx("div",{className:"w-full h-64 bg-gray-200 flex items-center justify-center rounded-lg",children:Se.jsx("span",{className:"text-gray-600 text-lg italic",children:"image"})})})}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:"Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum."})]})]}),Se.jsxs("div",{className:"prose prose-lg max-w-none mb-12",children:[Se.jsx("h2",{className:"text-2xl md:text-3xl font-medium text-gray-800 mb-6",children:"Insights"}),Se.jsx("p",{className:"text-gray-700 leading-relaxed mb-6",children:Se.jsx("div",{className:"bg-white rounded-lg shadow-md p-6 border border-gray-200",children:Se.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[Se.jsx("li",{children:"Industrialization drives growth  Subdistricts like Talcher Sadar, Industrial, Kaniha, and Anugul saw the highest population rise, directly linked to coal mining, power plants, and industrial expansion."}),Se.jsx("li",{children:"Urban spillover effect  Areas such as Banarpal and Samal Barrage experienced moderate growth due to proximity to industrial hubs, drawing migrants and expanding infrastructure.. ."}),Se.jsx("li",{children:"Infrastructure-led recovery  Palalahada and Rengali Damsite showed renewed growth after 2020 due to new roads, expanded housing, and dam-related human activity."}),Se.jsx("li",{children:"Agricultural stability  Khamar, Athmallik, and Handapa displayed stagnant or slow growth, reflecting limited industrialization and primarily rural livelihoods"})]})})})]})]})}),sme=()=>Se.jsx("footer",{className:"bg-gray-800 text-white py-0",style:{backgroundColor:"#333333"},children:Se.jsx("div",{className:"container mx-auto px-4",children:Se.jsx("div",{className:"mt-0 pt-8 pb-8 text-center text-gray-400",children:Se.jsx("p",{children:" 2025 Misteo. All rights reserved."})})})});function ame(){return Se.jsxs("div",{className:"min-h-screen bg-white ",children:[Se.jsx(ZF,{}),Se.jsx(ime,{}),Se.jsx(sme,{})]})}/**
 * react-router v7.9.4
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var OD="popstate";function ome(t={}){function e(n,i){let{pathname:a,search:c,hash:s}=n.location;return $A("",{pathname:a,search:c,hash:s},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function r(n,i){return typeof i=="string"?i:e0(i)}return cme(e,r,null,t)}function Ms(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function uh(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function lme(){return Math.random().toString(36).substring(2,10)}function kD(t,e){return{usr:t.state,key:t.key,idx:e}}function $A(t,e,r=null,n){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?A0(e):e,state:r,key:e&&e.key||n||lme()}}function e0({pathname:t="/",search:e="",hash:r=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),r&&r!=="#"&&(t+=r.charAt(0)==="#"?r:"#"+r),t}function A0(t){let e={};if(t){let r=t.indexOf("#");r>=0&&(e.hash=t.substring(r),t=t.substring(0,r));let n=t.indexOf("?");n>=0&&(e.search=t.substring(n),t=t.substring(0,n)),t&&(e.pathname=t)}return e}function cme(t,e,r,n={}){let{window:i=document.defaultView,v5Compat:a=!1}=n,c=i.history,s="POP",g=null,_=v();_==null&&(_=0,c.replaceState({...c.state,idx:_},""));function v(){return(c.state||{idx:null}).idx}function T(){s="POP";let V=v(),q=V==null?null:V-_;_=V,g&&g({action:s,location:j.location,delta:q})}function M(V,q){s="PUSH";let Y=$A(j.location,V,q);_=v()+1;let X=kD(Y,_),ae=j.createHref(Y);try{c.pushState(X,"",ae)}catch(ue){if(ue instanceof DOMException&&ue.name==="DataCloneError")throw ue;i.location.assign(ae)}a&&g&&g({action:s,location:j.location,delta:1})}function O(V,q){s="REPLACE";let Y=$A(j.location,V,q);_=v();let X=kD(Y,_),ae=j.createHref(Y);c.replaceState(X,"",ae),a&&g&&g({action:s,location:j.location,delta:0})}function F(V){return ume(V)}let j={get action(){return s},get location(){return t(i,c)},listen(V){if(g)throw new Error("A history only accepts one active listener");return i.addEventListener(OD,T),g=V,()=>{i.removeEventListener(OD,T),g=null}},createHref(V){return e(i,V)},createURL:F,encodeLocation(V){let q=F(V);return{pathname:q.pathname,search:q.search,hash:q.hash}},push:M,replace:O,go(V){return c.go(V)}};return j}function ume(t,e=!1){let r="http://localhost";typeof window<"u"&&(r=window.location.origin!=="null"?window.location.origin:window.location.href),Ms(r,"No window.location.(origin|href) available to create URL");let n=typeof t=="string"?t:e0(t);return n=n.replace(/ $/,"%20"),!e&&n.startsWith("//")&&(n=r+n),new URL(n,r)}function vF(t,e,r="/"){return hme(t,e,r,!1)}function hme(t,e,r,n){let i=typeof e=="string"?A0(e):e,a=xf(i.pathname||"/",r);if(a==null)return null;let c=bF(t);fme(c);let s=null;for(let g=0;s==null&&g<c.length;++g){let _=Tme(a);s=xme(c[g],_,n)}return s}function bF(t,e=[],r=[],n="",i=!1){let a=(c,s,g=i,_)=>{let v={relativePath:_===void 0?c.path||"":_,caseSensitive:c.caseSensitive===!0,childrenIndex:s,route:c};if(v.relativePath.startsWith("/")){if(!v.relativePath.startsWith(n)&&g)return;Ms(v.relativePath.startsWith(n),`Absolute route path "${v.relativePath}" nested under path "${n}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),v.relativePath=v.relativePath.slice(n.length)}let T=pf([n,v.relativePath]),M=r.concat(v);c.children&&c.children.length>0&&(Ms(c.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${T}".`),bF(c.children,e,M,T,g)),!(c.path==null&&!c.index)&&e.push({path:T,score:vme(T,c.index),routesMeta:M})};return t.forEach((c,s)=>{if(c.path===""||!c.path?.includes("?"))a(c,s);else for(let g of xF(c.path))a(c,s,!0,g)}),e}function xF(t){let e=t.split("/");if(e.length===0)return[];let[r,...n]=e,i=r.endsWith("?"),a=r.replace(/\?$/,"");if(n.length===0)return i?[a,""]:[a];let c=xF(n.join("/")),s=[];return s.push(...c.map(g=>g===""?a:[a,g].join("/"))),i&&s.push(...c),s.map(g=>t.startsWith("/")&&g===""?"/":g)}function fme(t){t.sort((e,r)=>e.score!==r.score?r.score-e.score:bme(e.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}var dme=/^:[\w-]+$/,pme=3,gme=2,mme=1,yme=10,_me=-2,DD=t=>t==="*";function vme(t,e){let r=t.split("/"),n=r.length;return r.some(DD)&&(n+=_me),e&&(n+=gme),r.filter(i=>!DD(i)).reduce((i,a)=>i+(dme.test(a)?pme:a===""?mme:yme),n)}function bme(t,e){return t.length===e.length&&t.slice(0,-1).every((n,i)=>n===e[i])?t[t.length-1]-e[e.length-1]:0}function xme(t,e,r=!1){let{routesMeta:n}=t,i={},a="/",c=[];for(let s=0;s<n.length;++s){let g=n[s],_=s===n.length-1,v=a==="/"?e:e.slice(a.length)||"/",T=P1({path:g.relativePath,caseSensitive:g.caseSensitive,end:_},v),M=g.route;if(!T&&_&&r&&!n[n.length-1].route.index&&(T=P1({path:g.relativePath,caseSensitive:g.caseSensitive,end:!1},v)),!T)return null;Object.assign(i,T.params),c.push({params:i,pathname:pf([a,T.pathname]),pathnameBase:Cme(pf([a,T.pathnameBase])),route:M}),T.pathnameBase!=="/"&&(a=pf([a,T.pathnameBase]))}return c}function P1(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[r,n]=wme(t.path,t.caseSensitive,t.end),i=e.match(r);if(!i)return null;let a=i[0],c=a.replace(/(.)\/+$/,"$1"),s=i.slice(1);return{params:n.reduce((_,{paramName:v,isOptional:T},M)=>{if(v==="*"){let F=s[M]||"";c=a.slice(0,a.length-F.length).replace(/(.)\/+$/,"$1")}const O=s[M];return T&&!O?_[v]=void 0:_[v]=(O||"").replace(/%2F/g,"/"),_},{}),pathname:a,pathnameBase:c,pattern:t}}function wme(t,e=!1,r=!0){uh(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let n=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(c,s,g)=>(n.push({paramName:s,isOptional:g!=null}),g?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(n.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),n]}function Tme(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return uh(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function xf(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let r=e.endsWith("/")?e.length-1:e.length,n=t.charAt(r);return n&&n!=="/"?null:t.slice(r)||"/"}function Sme(t,e="/"){let{pathname:r,search:n="",hash:i=""}=typeof t=="string"?A0(t):t;return{pathname:r?r.startsWith("/")?r:Ame(r,e):e,search:Pme(n),hash:Mme(i)}}function Ame(t,e){let r=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?r.length>1&&r.pop():i!=="."&&r.push(i)}),r.length>1?r.join("/"):"/"}function uS(t,e,r,n){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(n)}].  Please separate it out to the \`to.${r}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function Eme(t){return t.filter((e,r)=>r===0||e.route.path&&e.route.path.length>0)}function wF(t){let e=Eme(t);return e.map((r,n)=>n===e.length-1?r.pathname:r.pathnameBase)}function TF(t,e,r,n=!1){let i;typeof t=="string"?i=A0(t):(i={...t},Ms(!i.pathname||!i.pathname.includes("?"),uS("?","pathname","search",i)),Ms(!i.pathname||!i.pathname.includes("#"),uS("#","pathname","hash",i)),Ms(!i.search||!i.search.includes("#"),uS("#","search","hash",i)));let a=t===""||i.pathname==="",c=a?"/":i.pathname,s;if(c==null)s=r;else{let T=e.length-1;if(!n&&c.startsWith("..")){let M=c.split("/");for(;M[0]==="..";)M.shift(),T-=1;i.pathname=M.join("/")}s=T>=0?e[T]:"/"}let g=Sme(i,s),_=c&&c!=="/"&&c.endsWith("/"),v=(a||c===".")&&r.endsWith("/");return!g.pathname.endsWith("/")&&(_||v)&&(g.pathname+="/"),g}var pf=t=>t.join("/").replace(/\/\/+/g,"/"),Cme=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),Pme=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,Mme=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function Ime(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}var SF=["POST","PUT","PATCH","DELETE"];new Set(SF);var Rme=["GET",...SF];new Set(Rme);var Gy=Q.createContext(null);Gy.displayName="DataRouter";var bw=Q.createContext(null);bw.displayName="DataRouterState";Q.createContext(!1);var AF=Q.createContext({isTransitioning:!1});AF.displayName="ViewTransition";var Ome=Q.createContext(new Map);Ome.displayName="Fetchers";var kme=Q.createContext(null);kme.displayName="Await";var hh=Q.createContext(null);hh.displayName="Navigation";var xw=Q.createContext(null);xw.displayName="Location";var If=Q.createContext({outlet:null,matches:[],isDataRoute:!1});If.displayName="Route";var NC=Q.createContext(null);NC.displayName="RouteError";function Dme(t,{relative:e}={}){Ms(E0(),"useHref() may be used only in the context of a <Router> component.");let{basename:r,navigator:n}=Q.useContext(hh),{hash:i,pathname:a,search:c}=C0(t,{relative:e}),s=a;return r!=="/"&&(s=a==="/"?r:pf([r,a])),n.createHref({pathname:s,search:c,hash:i})}function E0(){return Q.useContext(xw)!=null}function Vg(){return Ms(E0(),"useLocation() may be used only in the context of a <Router> component."),Q.useContext(xw).location}var EF="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function CF(t){Q.useContext(hh).static||Q.useLayoutEffect(t)}function Lme(){let{isDataRoute:t}=Q.useContext(If);return t?Xme():Bme()}function Bme(){Ms(E0(),"useNavigate() may be used only in the context of a <Router> component.");let t=Q.useContext(Gy),{basename:e,navigator:r}=Q.useContext(hh),{matches:n}=Q.useContext(If),{pathname:i}=Vg(),a=JSON.stringify(wF(n)),c=Q.useRef(!1);return CF(()=>{c.current=!0}),Q.useCallback((g,_={})=>{if(uh(c.current,EF),!c.current)return;if(typeof g=="number"){r.go(g);return}let v=TF(g,JSON.parse(a),i,_.relative==="path");t==null&&e!=="/"&&(v.pathname=v.pathname==="/"?e:pf([e,v.pathname])),(_.replace?r.replace:r.push)(v,_.state,_)},[e,r,a,i,t])}Q.createContext(null);function C0(t,{relative:e}={}){let{matches:r}=Q.useContext(If),{pathname:n}=Vg(),i=JSON.stringify(wF(r));return Q.useMemo(()=>TF(t,JSON.parse(i),n,e==="path"),[t,i,n,e])}function Nme(t,e,r,n,i){Ms(E0(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:a}=Q.useContext(hh),{matches:c}=Q.useContext(If),s=c[c.length-1],g=s?s.params:{},_=s?s.pathname:"/",v=s?s.pathnameBase:"/",T=s&&s.route;{let Y=T&&T.path||"";PF(_,!T||Y.endsWith("*")||Y.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${_}" (under <Route path="${Y}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${Y}"> to <Route path="${Y==="/"?"*":`${Y}/*`}">.`)}let M=Vg(),O;O=M;let F=O.pathname||"/",j=F;if(v!=="/"){let Y=v.replace(/^\//,"").split("/");j="/"+F.replace(/^\//,"").split("/").slice(Y.length).join("/")}let V=vF(t,{pathname:j});return uh(T||V!=null,`No routes matched location "${O.pathname}${O.search}${O.hash}" `),uh(V==null||V[V.length-1].route.element!==void 0||V[V.length-1].route.Component!==void 0||V[V.length-1].route.lazy!==void 0,`Matched leaf route at location "${O.pathname}${O.search}${O.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),Vme(V&&V.map(Y=>Object.assign({},Y,{params:Object.assign({},g,Y.params),pathname:pf([v,a.encodeLocation?a.encodeLocation(Y.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:Y.pathname]),pathnameBase:Y.pathnameBase==="/"?v:pf([v,a.encodeLocation?a.encodeLocation(Y.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:Y.pathnameBase])})),c,r,n,i)}function zme(){let t=Gme(),e=Ime(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),r=t instanceof Error?t.stack:null,n="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:n},a={padding:"2px 4px",backgroundColor:n},c=null;return console.error("Error handled by React Router default ErrorBoundary:",t),c=Q.createElement(Q.Fragment,null,Q.createElement("p",null," Hey developer "),Q.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Q.createElement("code",{style:a},"ErrorBoundary")," or"," ",Q.createElement("code",{style:a},"errorElement")," prop on your route.")),Q.createElement(Q.Fragment,null,Q.createElement("h2",null,"Unexpected Application Error!"),Q.createElement("h3",{style:{fontStyle:"italic"}},e),r?Q.createElement("pre",{style:i},r):null,c)}var Fme=Q.createElement(zme,null),Ume=class extends Q.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.unstable_onError?this.props.unstable_onError(t,e):console.error("React Router caught the following error during render",t)}render(){return this.state.error!==void 0?Q.createElement(If.Provider,{value:this.props.routeContext},Q.createElement(NC.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function jme({routeContext:t,match:e,children:r}){let n=Q.useContext(Gy);return n&&n.static&&n.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=e.route.id),Q.createElement(If.Provider,{value:t},r)}function Vme(t,e=[],r=null,n=null,i=null){if(t==null){if(!r)return null;if(r.errors)t=r.matches;else if(e.length===0&&!r.initialized&&r.matches.length>0)t=r.matches;else return null}let a=t,c=r?.errors;if(c!=null){let _=a.findIndex(v=>v.route.id&&c?.[v.route.id]!==void 0);Ms(_>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(c).join(",")}`),a=a.slice(0,Math.min(a.length,_+1))}let s=!1,g=-1;if(r)for(let _=0;_<a.length;_++){let v=a[_];if((v.route.HydrateFallback||v.route.hydrateFallbackElement)&&(g=_),v.route.id){let{loaderData:T,errors:M}=r,O=v.route.loader&&!T.hasOwnProperty(v.route.id)&&(!M||M[v.route.id]===void 0);if(v.route.lazy||O){s=!0,g>=0?a=a.slice(0,g+1):a=[a[0]];break}}}return a.reduceRight((_,v,T)=>{let M,O=!1,F=null,j=null;r&&(M=c&&v.route.id?c[v.route.id]:void 0,F=v.route.errorElement||Fme,s&&(g<0&&T===0?(PF("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),O=!0,j=null):g===T&&(O=!0,j=v.route.hydrateFallbackElement||null)));let V=e.concat(a.slice(0,T+1)),q=()=>{let Y;return M?Y=F:O?Y=j:v.route.Component?Y=Q.createElement(v.route.Component,null):v.route.element?Y=v.route.element:Y=_,Q.createElement(jme,{match:v,routeContext:{outlet:_,matches:V,isDataRoute:r!=null},children:Y})};return r&&(v.route.ErrorBoundary||v.route.errorElement||T===0)?Q.createElement(Ume,{location:r.location,revalidation:r.revalidation,component:F,error:M,children:q(),routeContext:{outlet:null,matches:V,isDataRoute:!0},unstable_onError:n}):q()},null)}function zC(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function $me(t){let e=Q.useContext(Gy);return Ms(e,zC(t)),e}function Hme(t){let e=Q.useContext(bw);return Ms(e,zC(t)),e}function Wme(t){let e=Q.useContext(If);return Ms(e,zC(t)),e}function FC(t){let e=Wme(t),r=e.matches[e.matches.length-1];return Ms(r.route.id,`${t} can only be used on routes that contain a unique "id"`),r.route.id}function qme(){return FC("useRouteId")}function Gme(){let t=Q.useContext(NC),e=Hme("useRouteError"),r=FC("useRouteError");return t!==void 0?t:e.errors?.[r]}function Xme(){let{router:t}=$me("useNavigate"),e=FC("useNavigate"),r=Q.useRef(!1);return CF(()=>{r.current=!0}),Q.useCallback(async(i,a={})=>{uh(r.current,EF),r.current&&(typeof i=="number"?t.navigate(i):await t.navigate(i,{fromRouteId:e,...a}))},[t,e])}var LD={};function PF(t,e,r){!e&&!LD[t]&&(LD[t]=!0,uh(!1,r))}Q.memo(Zme);function Zme({routes:t,future:e,state:r,unstable_onError:n}){return Nme(t,void 0,r,n,e)}function Yme({basename:t="/",children:e=null,location:r,navigationType:n="POP",navigator:i,static:a=!1}){Ms(!E0(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let c=t.replace(/^\/*/,"/"),s=Q.useMemo(()=>({basename:c,navigator:i,static:a,future:{}}),[c,i,a]);typeof r=="string"&&(r=A0(r));let{pathname:g="/",search:_="",hash:v="",state:T=null,key:M="default"}=r,O=Q.useMemo(()=>{let F=xf(g,c);return F==null?null:{location:{pathname:F,search:_,hash:v,state:T,key:M},navigationType:n}},[c,g,_,v,T,M,n]);return uh(O!=null,`<Router basename="${c}"> is not able to match the URL "${g}${_}${v}" because it does not start with the basename, so the <Router> won't render anything.`),O==null?null:Q.createElement(hh.Provider,{value:s},Q.createElement(xw.Provider,{children:e,value:O}))}var bx="get",xx="application/x-www-form-urlencoded";function ww(t){return t!=null&&typeof t.tagName=="string"}function Kme(t){return ww(t)&&t.tagName.toLowerCase()==="button"}function Qme(t){return ww(t)&&t.tagName.toLowerCase()==="form"}function Jme(t){return ww(t)&&t.tagName.toLowerCase()==="input"}function eye(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function tye(t,e){return t.button===0&&(!e||e==="_self")&&!eye(t)}var ix=null;function rye(){if(ix===null)try{new FormData(document.createElement("form"),0),ix=!1}catch{ix=!0}return ix}var nye=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function hS(t){return t!=null&&!nye.has(t)?(uh(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${xx}"`),null):t}function iye(t,e){let r,n,i,a,c;if(Qme(t)){let s=t.getAttribute("action");n=s?xf(s,e):null,r=t.getAttribute("method")||bx,i=hS(t.getAttribute("enctype"))||xx,a=new FormData(t)}else if(Kme(t)||Jme(t)&&(t.type==="submit"||t.type==="image")){let s=t.form;if(s==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let g=t.getAttribute("formaction")||s.getAttribute("action");if(n=g?xf(g,e):null,r=t.getAttribute("formmethod")||s.getAttribute("method")||bx,i=hS(t.getAttribute("formenctype"))||hS(s.getAttribute("enctype"))||xx,a=new FormData(s,t),!rye()){let{name:_,type:v,value:T}=t;if(v==="image"){let M=_?`${_}.`:"";a.append(`${M}x`,"0"),a.append(`${M}y`,"0")}else _&&a.append(_,T)}}else{if(ww(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');r=bx,n=null,i=xx,c=t}return a&&i==="text/plain"&&(c=a,a=void 0),{action:n,method:r.toLowerCase(),encType:i,formData:a,body:c}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function UC(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function sye(t,e,r){let n=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return n.pathname==="/"?n.pathname=`_root.${r}`:e&&xf(n.pathname,e)==="/"?n.pathname=`${e.replace(/\/$/,"")}/_root.${r}`:n.pathname=`${n.pathname.replace(/\/$/,"")}.${r}`,n}async function aye(t,e){if(t.id in e)return e[t.id];try{let r=await import(t.module);return e[t.id]=r,r}catch(r){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(r),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function oye(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function lye(t,e,r){let n=await Promise.all(t.map(async i=>{let a=e.routes[i.route.id];if(a){let c=await aye(a,r);return c.links?c.links():[]}return[]}));return fye(n.flat(1).filter(oye).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function BD(t,e,r,n,i,a){let c=(g,_)=>r[_]?g.route.id!==r[_].route.id:!0,s=(g,_)=>r[_].pathname!==g.pathname||r[_].route.path?.endsWith("*")&&r[_].params["*"]!==g.params["*"];return a==="assets"?e.filter((g,_)=>c(g,_)||s(g,_)):a==="data"?e.filter((g,_)=>{let v=n.routes[g.route.id];if(!v||!v.hasLoader)return!1;if(c(g,_)||s(g,_))return!0;if(g.route.shouldRevalidate){let T=g.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:r[0]?.params||{},nextUrl:new URL(t,window.origin),nextParams:g.params,defaultShouldRevalidate:!0});if(typeof T=="boolean")return T}return!0}):[]}function cye(t,e,{includeHydrateFallback:r}={}){return uye(t.map(n=>{let i=e.routes[n.route.id];if(!i)return[];let a=[i.module];return i.clientActionModule&&(a=a.concat(i.clientActionModule)),i.clientLoaderModule&&(a=a.concat(i.clientLoaderModule)),r&&i.hydrateFallbackModule&&(a=a.concat(i.hydrateFallbackModule)),i.imports&&(a=a.concat(i.imports)),a}).flat(1))}function uye(t){return[...new Set(t)]}function hye(t){let e={},r=Object.keys(t).sort();for(let n of r)e[n]=t[n];return e}function fye(t,e){let r=new Set;return new Set(e),t.reduce((n,i)=>{let a=JSON.stringify(hye(i));return r.has(a)||(r.add(a),n.push({key:a,link:i})),n},[])}function MF(){let t=Q.useContext(Gy);return UC(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function dye(){let t=Q.useContext(bw);return UC(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var jC=Q.createContext(void 0);jC.displayName="FrameworkContext";function IF(){let t=Q.useContext(jC);return UC(t,"You must render this element inside a <HydratedRouter> element"),t}function pye(t,e){let r=Q.useContext(jC),[n,i]=Q.useState(!1),[a,c]=Q.useState(!1),{onFocus:s,onBlur:g,onMouseEnter:_,onMouseLeave:v,onTouchStart:T}=e,M=Q.useRef(null);Q.useEffect(()=>{if(t==="render"&&c(!0),t==="viewport"){let j=q=>{q.forEach(Y=>{c(Y.isIntersecting)})},V=new IntersectionObserver(j,{threshold:.5});return M.current&&V.observe(M.current),()=>{V.disconnect()}}},[t]),Q.useEffect(()=>{if(n){let j=setTimeout(()=>{c(!0)},100);return()=>{clearTimeout(j)}}},[n]);let O=()=>{i(!0)},F=()=>{i(!1),c(!1)};return r?t!=="intent"?[a,M,{}]:[a,M,{onFocus:fv(s,O),onBlur:fv(g,F),onMouseEnter:fv(_,O),onMouseLeave:fv(v,F),onTouchStart:fv(T,O)}]:[!1,M,{}]}function fv(t,e){return r=>{t&&t(r),r.defaultPrevented||e(r)}}function gye({page:t,...e}){let{router:r}=MF(),n=Q.useMemo(()=>vF(r.routes,t,r.basename),[r.routes,t,r.basename]);return n?Q.createElement(yye,{page:t,matches:n,...e}):null}function mye(t){let{manifest:e,routeModules:r}=IF(),[n,i]=Q.useState([]);return Q.useEffect(()=>{let a=!1;return lye(t,e,r).then(c=>{a||i(c)}),()=>{a=!0}},[t,e,r]),n}function yye({page:t,matches:e,...r}){let n=Vg(),{manifest:i,routeModules:a}=IF(),{basename:c}=MF(),{loaderData:s,matches:g}=dye(),_=Q.useMemo(()=>BD(t,e,g,i,n,"data"),[t,e,g,i,n]),v=Q.useMemo(()=>BD(t,e,g,i,n,"assets"),[t,e,g,i,n]),T=Q.useMemo(()=>{if(t===n.pathname+n.search+n.hash)return[];let F=new Set,j=!1;if(e.forEach(q=>{let Y=i.routes[q.route.id];!Y||!Y.hasLoader||(!_.some(X=>X.route.id===q.route.id)&&q.route.id in s&&a[q.route.id]?.shouldRevalidate||Y.hasClientLoader?j=!0:F.add(q.route.id))}),F.size===0)return[];let V=sye(t,c,"data");return j&&F.size>0&&V.searchParams.set("_routes",e.filter(q=>F.has(q.route.id)).map(q=>q.route.id).join(",")),[V.pathname+V.search]},[c,s,n,i,_,e,t,a]),M=Q.useMemo(()=>cye(v,i),[v,i]),O=mye(v);return Q.createElement(Q.Fragment,null,T.map(F=>Q.createElement("link",{key:F,rel:"prefetch",as:"fetch",href:F,...r})),M.map(F=>Q.createElement("link",{key:F,rel:"modulepreload",href:F,...r})),O.map(({key:F,link:j})=>Q.createElement("link",{key:F,nonce:r.nonce,...j})))}function _ye(...t){return e=>{t.forEach(r=>{typeof r=="function"?r(e):r!=null&&(r.current=e)})}}var RF=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{RF&&(window.__reactRouterVersion="7.9.4")}catch{}function vye({basename:t,children:e,window:r}){let n=Q.useRef();n.current==null&&(n.current=ome({window:r,v5Compat:!0}));let i=n.current,[a,c]=Q.useState({action:i.action,location:i.location}),s=Q.useCallback(g=>{Q.startTransition(()=>c(g))},[c]);return Q.useLayoutEffect(()=>i.listen(s),[i,s]),Q.createElement(Yme,{basename:t,children:e,location:a.location,navigationType:a.action,navigator:i})}var OF=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,kF=Q.forwardRef(function({onClick:e,discover:r="render",prefetch:n="none",relative:i,reloadDocument:a,replace:c,state:s,target:g,to:_,preventScrollReset:v,viewTransition:T,...M},O){let{basename:F}=Q.useContext(hh),j=typeof _=="string"&&OF.test(_),V,q=!1;if(typeof _=="string"&&j&&(V=_,RF))try{let Ze=new URL(window.location.href),_t=_.startsWith("//")?new URL(Ze.protocol+_):new URL(_),it=xf(_t.pathname,F);_t.origin===Ze.origin&&it!=null?_=it+_t.search+_t.hash:q=!0}catch{uh(!1,`<Link to="${_}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let Y=Dme(_,{relative:i}),[X,ae,ue]=pye(n,M),ge=Tye(_,{replace:c,state:s,target:g,preventScrollReset:v,relative:i,viewTransition:T});function Le(Ze){e&&e(Ze),Ze.defaultPrevented||ge(Ze)}let qe=Q.createElement("a",{...M,...ue,href:V||Y,onClick:q||a?e:Le,ref:_ye(O,ae),target:g,"data-discover":!j&&r==="render"?"true":void 0});return X&&!j?Q.createElement(Q.Fragment,null,qe,Q.createElement(gye,{page:Y})):qe});kF.displayName="Link";var bye=Q.forwardRef(function({"aria-current":e="page",caseSensitive:r=!1,className:n="",end:i=!1,style:a,to:c,viewTransition:s,children:g,..._},v){let T=C0(c,{relative:_.relative}),M=Vg(),O=Q.useContext(bw),{navigator:F,basename:j}=Q.useContext(hh),V=O!=null&&Pye(T)&&s===!0,q=F.encodeLocation?F.encodeLocation(T).pathname:T.pathname,Y=M.pathname,X=O&&O.navigation&&O.navigation.location?O.navigation.location.pathname:null;r||(Y=Y.toLowerCase(),X=X?X.toLowerCase():null,q=q.toLowerCase()),X&&j&&(X=xf(X,j)||X);const ae=q!=="/"&&q.endsWith("/")?q.length-1:q.length;let ue=Y===q||!i&&Y.startsWith(q)&&Y.charAt(ae)==="/",ge=X!=null&&(X===q||!i&&X.startsWith(q)&&X.charAt(q.length)==="/"),Le={isActive:ue,isPending:ge,isTransitioning:V},qe=ue?e:void 0,Ze;typeof n=="function"?Ze=n(Le):Ze=[n,ue?"active":null,ge?"pending":null,V?"transitioning":null].filter(Boolean).join(" ");let _t=typeof a=="function"?a(Le):a;return Q.createElement(kF,{..._,"aria-current":qe,className:Ze,ref:v,style:_t,to:c,viewTransition:s},typeof g=="function"?g(Le):g)});bye.displayName="NavLink";var xye=Q.forwardRef(({discover:t="render",fetcherKey:e,navigate:r,reloadDocument:n,replace:i,state:a,method:c=bx,action:s,onSubmit:g,relative:_,preventScrollReset:v,viewTransition:T,...M},O)=>{let F=Eye(),j=Cye(s,{relative:_}),V=c.toLowerCase()==="get"?"get":"post",q=typeof s=="string"&&OF.test(s),Y=X=>{if(g&&g(X),X.defaultPrevented)return;X.preventDefault();let ae=X.nativeEvent.submitter,ue=ae?.getAttribute("formmethod")||c;F(ae||X.currentTarget,{fetcherKey:e,method:ue,navigate:r,replace:i,state:a,relative:_,preventScrollReset:v,viewTransition:T})};return Q.createElement("form",{ref:O,method:V,action:j,onSubmit:n?g:Y,...M,"data-discover":!q&&t==="render"?"true":void 0})});xye.displayName="Form";function wye(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function DF(t){let e=Q.useContext(Gy);return Ms(e,wye(t)),e}function Tye(t,{target:e,replace:r,state:n,preventScrollReset:i,relative:a,viewTransition:c}={}){let s=Lme(),g=Vg(),_=C0(t,{relative:a});return Q.useCallback(v=>{if(tye(v,e)){v.preventDefault();let T=r!==void 0?r:e0(g)===e0(_);s(t,{replace:T,state:n,preventScrollReset:i,relative:a,viewTransition:c})}},[g,s,_,r,n,e,t,i,a,c])}var Sye=0,Aye=()=>`__${String(++Sye)}__`;function Eye(){let{router:t}=DF("useSubmit"),{basename:e}=Q.useContext(hh),r=qme();return Q.useCallback(async(n,i={})=>{let{action:a,method:c,encType:s,formData:g,body:_}=iye(n,e);if(i.navigate===!1){let v=i.fetcherKey||Aye();await t.fetch(v,r,i.action||a,{preventScrollReset:i.preventScrollReset,formData:g,body:_,formMethod:i.method||c,formEncType:i.encType||s,flushSync:i.flushSync})}else await t.navigate(i.action||a,{preventScrollReset:i.preventScrollReset,formData:g,body:_,formMethod:i.method||c,formEncType:i.encType||s,replace:i.replace,state:i.state,fromRouteId:r,flushSync:i.flushSync,viewTransition:i.viewTransition})},[t,e,r])}function Cye(t,{relative:e}={}){let{basename:r}=Q.useContext(hh),n=Q.useContext(If);Ms(n,"useFormAction must be used inside a RouteContext");let[i]=n.matches.slice(-1),a={...C0(t||".",{relative:e})},c=Vg();if(t==null){a.search=c.search;let s=new URLSearchParams(a.search),g=s.getAll("index");if(g.some(v=>v==="")){s.delete("index"),g.filter(T=>T).forEach(T=>s.append("index",T));let v=s.toString();a.search=v?`?${v}`:""}}return(!t||t===".")&&i.route.index&&(a.search=a.search?a.search.replace(/^\?/,"?index&"):"?index"),r!=="/"&&(a.pathname=a.pathname==="/"?r:pf([r,a.pathname])),e0(a)}function Pye(t,{relative:e}={}){let r=Q.useContext(AF);Ms(r!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:n}=DF("useViewTransitionState"),i=C0(t,{relative:e});if(!r.isTransitioning)return!1;let a=xf(r.currentLocation.pathname,n)||r.currentLocation.pathname,c=xf(r.nextLocation.pathname,n)||r.nextLocation.pathname;return P1(i.pathname,c)!=null||P1(i.pathname,a)!=null}qF.createRoot(document.getElementById("root")).render(Se.jsx(Q.StrictMode,{children:Se.jsx(vye,{children:Se.jsx(ame,{})})}));export{Mye as L,Iye as a,xl as g};
